/*! For license information please see src_modules_table-component_js.js.LICENSE.txt */
(self.webpackChunk=self.webpackChunk||[]).push([["src_modules_table-component_js"],{"./src/modules/table-component.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   TableComponent: () => (/* binding */ TableComponent)\n/* harmony export */ });\n/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! dompurify */ \"./node_modules/dompurify/dist/purify.js\");\n/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(dompurify__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var deep_equal__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! deep-equal */ \"./node_modules/deep-equal/index.js\");\n/* harmony import */ var deep_equal__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(deep_equal__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _modules_utils_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../modules/utils.js */ \"./src/modules/utils.js\");\n/* harmony import */ var _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../modules/modules-config.js */ \"./src/modules/modules-config.js\");\n\n\n\n\nlet instance = [];\n// valid fetch urlparts\nconst fetchfroms = {\n  collectionlist: '/gui/collectionlist/',\n  prjlist: '/gui/prjlist/',\n  prjsamplestats: '/gui/prjsamplestats',\n  userslist: '/gui/admin/userslist/',\n  prjpredict: '/gui/prjsforprediction/'\n};\n// specifc css\nconst tablecss = {\n  showfull: 'showfull',\n  tipinline: \"tip-inline\",\n  searchresults: \"search-results\",\n  selectaction: \"selectaction\",\n  absinput: 'absinput',\n  disabled: 'table-disabled',\n  ascending: 'table-ascending',\n  descending: 'table-descending',\n  tipover: 'tipover absolute z-10 text-stone-50 rounded bg-stone-600 px-2 py-0.5 -mt-5 ml-12 ',\n  hide: 'hide',\n  nowrap: 'truncate',\n};\nconst tableselectors = {\n  table: '.table-table',\n  wrapper: '.table-wrapper',\n  top: '.table-top',\n  input: '.table-input',\n  search: '.table-search',\n  export: '.button-export',\n  filters: '.table-filters',\n  sorter: '.table-sorter',\n  details: 'details[data-what=\"about\"]',\n  tip: '.' + _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_3__.css.component.table.tip,\n  tipover: '.tipover',\n  wait: 'wait-please',\n  sorton: '.sorton',\n};\n\nObject.freeze(tablecss);\nObject.freeze(tableselectors);\nconst dynamics = {};\n\nclass TableComponent {\n  instanceid = null;\n  grid = {\n    columns: [],\n    active: [],\n    hidden: [],\n    data: []\n  };\n  domdef = {\n    columns: [],\n    data: [],\n  };\n  wrapper = null;\n  dom = null;\n  params = null;\n  _events = {};\n  eventnames = {\n    init: \"table.init\",\n    update: \"table.update\",\n    refresh: \"table.refresh\",\n    resize: \"table.resize\",\n    search: \"table.search\",\n    searchend: \"table.searchend\",\n    sorting: \"table.sorting\",\n    sorted: \"table.sorted\",\n    load: \"table.loaded\",\n    dismiss: 'table.dismiss'\n  }\n  labels = {\n    placeholder: \"Search...\",\n    perPage: \"{select} entries per page\",\n    noRows: \"No entries found\",\n    info: \"Showing {start} to {end} of {rows} entries\",\n    noResults: \"No result match your search query\"\n  };\n  cellidname = \"id\";\n  searching = false;\n  sorting = false;\n  initialized = false;\n  plugins = {};\n  constructor(container, options = {}) {\n    if (!container) return;\n    container = container instanceof HTMLElement ? container : document.querySelector(container);\n    if (!container) return;\n    //can select multiples tables in one page  or load data in the same table\n    this.instanceid = (container.dataset.instanceid) ? container.dataset.instanceid : document.querySelectorAll('table').length;\n    if (!instance[this.instanceid] || !deep_equal__WEBPACK_IMPORTED_MODULE_1___default()(container.dataset, instance[this.instanceid].params)) {\n      this.init(container);\n    } else this.refresh();\n    return instance[this.instanceid];\n\n  }\n  init(container) {\n    (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_2__.add_custom_events)(this);\n    this.params = container.dataset;\n    let table = container.querySelector('table');\n    if (!table) {\n      table = document.createElement('table');\n      container.appendChild(table);\n    }\n    table.id = 'table-' + container.id;\n    table.classList.add(tableselectors.table.substr(1))\n    this.dom = table;\n    let top = {\n      nodename: \"DIV\",\n      attributes: {\n        class: tableselectors.top.substr(1)\n      }\n    };\n    if (this.params.searchable) top.childnodes = [{\n      nodename: \"DIV\",\n      attributes: {\n        class: tableselectors.search.substr(1)\n      },\n      html: `<input type=\"search\" name=\"table-search\" placeholder=\"${this.labels.placeholder}\" class=\"${tableselectors.input.substr(1)}  ${_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_3__.css.input} ${_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_3__.css.hide}\">`\n    }];\n    let wrapper = this.objToElement({\n      nodename: 'DIV',\n      attributes: {\n        class: tableselectors.wrapper.substr(1)\n      },\n      childnodes: [top]\n    });\n    container.appendChild(wrapper);\n    wrapper.appendChild(table);\n    this.wrapper = wrapper;\n\n    this.labels = (this.params.labels) ? this.params.labels : this.labels;\n    // cellid\n    this.cellidname = (this.params.hasOwnProperty(\"cellid\")) ? this.params.cellid : this.cellidname;\n    // only valid from values - fetchfroms\n    this.params.from = (this.params.from) ? dompurify__WEBPACK_IMPORTED_MODULE_0___default().sanitize(this.params.from) : null;\n\n    const from = (this.params.from) ? ((Object.keys(fetchfroms).indexOf(this.params.from) >= 0) ? fetchfroms[this.params.from] : null) : null;\n    if (from) {\n      if (this.params.defer) this.deferLoad(container, from);\n      else this.fetchData(container, from);\n    } else this.tableActivate(container);\n    this.dt = Date.now();\n  }\n\n  waitActivate(container) {\n    let waitdiv = container.querySelector('#' + tableselectors.wait);\n    if (!waitdiv) {\n      waitdiv = document.createElement('div');\n      waitdiv.id = tableselectors.wait;\n      container.append(waitdiv);\n    }\n    this.waitdiv = waitdiv;\n  }\n\n  waitDesactivate(message = null, type = 'info') {\n    if (!this.waitdiv) return;\n    if (message) this.waitdiv.innerHTML = `<div class=\"alert is-${type}\">${message}</div>`;\n    else this.waitdiv.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_3__.css.hide);\n  }\n\n  deferLoad(container, from) {\n    const btn = container.querySelector(this.params.defer);\n    if (!btn) return;\n\n    btn.addEventListener('click', (e) => {\n      this.fetchData(container, from);\n      btn.remove();\n    });\n  }\n\n  fetchData(container, fromurl, pagestart = 0) {\n    this.waitActivate(container);\n    const pagesize = (this.params.pagesize) ? this.params.pagesize : 0;\n    let from = fromurl;\n    if (this.params.fromid) from += '/' + this.params.fromid;\n\n    let query = (this.params.import) ? {\n      typeimport: dompurify__WEBPACK_IMPORTED_MODULE_0___default().sanitize(this.params.import),\n      window_start: pagestart,\n      window_size: pagesize,\n      gz: true,\n    } : ((pagesize) ? {\n      window_start: pagestart,\n      window_size: pagesize,\n      listall: ((this.params.listall) ? this.params.listall : false)\n    } : ((this.params.listall) ? {\n      listall: ((this.params.listall) ? this.params.listall : false)\n    } : {}));\n    const queryparams = new URLSearchParams(window.location.search);\n    const querykeys = this.cellidname + 's';\n    if (querykeys.length) {\n      for (const entry of queryparams.entries()) {\n        if (querykeys.indexOf(entry[0]) >= 0) query[entry[0]] = entry[1];\n      }\n    }\n    if (Object.keys(query).length) from += '?' + new URLSearchParams(query);\n    this.dt = Date.now();\n    fetch(from, (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_2__.fetchSettings)()).then(response => {\n      if (response.ok) return response.json();\n      else return Promise.reject(response);\n    }).then(async tabledef => {\n      if (this.waitdiv) this.waitdiv.innerHTML = ((this.waitdiv.dataset.loaded) ? dompurify__WEBPACK_IMPORTED_MODULE_0___default().sanitize(this.waitdiv.dataset.loaded) : _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_3__.default_messages.dataloaded);\n      if (pagestart === 0) {\n        console.log('seconds to fetch', (Date.now() - this.dt) / 1000);\n        this.dt = Date.now();\n        await this.tableActivate(container, tabledef);\n      } else if (tabledef.length) this.domInsertRows(tabledef);\n      else pagesize = 0;\n      if (pagesize > 0) this.fetchData(container, fromurl, pagestart + pagesize);\n    }).catch((err) => { /* print error from response */\n      this.waitDesactivate(err.status + ` ` + err.statusText, 'error');\n    })\n  }\n  async dataToTable(tabledef) {\n\n    if (!tabledef.data) return;\n    if (tabledef.columns) {\n      await this.convertColumns(tabledef);\n      let tr;\n      let thead = this.dom.tHead;\n      if (!thead) {\n        // create table headings\n        thead = document.createElement('thead');\n        tr = document.createElement('tr');\n        this.dom.appendChild(thead);\n      } else if (!thead.querySelector('tr')) {\n        tr = document.createElement('tr');\n\n      } else {\n        tr = thead.querySelector('tr');\n        tr.innerHTML = ``;\n      }\n      let tbody = (this.dom.tBodies.length) ? this.dom.tBodies[0] : null;\n      if (!tbody) {\n        tbody = document.createElement('tbody');\n        this.dom.appendChild(tbody);\n      }\n      const isjson = (!tabledef.hasOwnProperty('data') || (tabledef.hasOwnProperty('type') && tabledef.type === \"json\"));\n\n      this.grid.columns.forEach((column, index) => {\n\n        if (!column.hidden) {\n          const th = document.createElement('th');\n          th.innerHTML = dompurify__WEBPACK_IMPORTED_MODULE_0___default().sanitize(column.label);\n          if (column.sort) th.dataset.sort = column.sort;\n          if (column.format) th.dataset.type = column.type;\n          if (column.name) th.dataset.name = column.name;\n          // TODO - find a place to define col import props\n          // set headings dataset values for import module\n          if (this.params.import)['selectcells', 'what', 'autocomplete', 'parts', 'value'].forEach(prop => {\n            if (column.hasOwnProperty(prop)) th.dataset[prop] = column[prop];\n          });\n          th.dataset.sortable = (column.sortable) ? true : false;\n          tr.appendChild(th);\n          this.grid.active.push(index);\n        } else this.grid.hidden.push(index);\n\n      });\n\n\n      thead.appendChild(tr);\n      const datalastused = (this.params.lastused && this.params.lastused.length > 0) ? [] : null;\n      //#TODO lastused reorder\n      if (isjson) {\n        this.grid.data = [];\n        tabledef.data.forEach((data, i) => {\n          const row = [];\n          let j = 0;\n          Object.entries(tabledef.columns).forEach(([key, column], i) => {\n            if (!column.hasOwnProperty('emptydata')) {\n              if (data.hasOwnProperty(key)) row[j] = data[key];\n              else if (column.field && data.hasOwnProperty(column.field)) row[j] = data[column.field];\n              else row[j] = null;\n              j++;\n            }\n          });\n          this.grid.data.push(row);\n        });\n      } else this.grid.data = tabledef.data;\n\n      const tfoot = this.dom.tFoot;\n      if (this.grid.active.length === 0) {\n        tbody.innerHTML = `<tr><td>${this.labels.noRows}</td</tr>`;\n        if (tfoot) tfoot.remove();\n        return;\n      } else if (tfoot && tfoot.querySelector('tr')) {\n        const tf = tfoot.querySelector('tr').childNodes;\n        this.grid.hidden.forEach(i => {\n          tf[i].remove();\n        });\n      };\n\n      this.renderTbody(tbody);\n    }\n  }\n\n  tableToData() {\n    if (!this.dom.querySelector('thead')) return;\n    const datalastused = (this.params.lastused && this.params.lastused.length > 0) ? [] : null;\n    this.dom.classList.add(tablecss.hide);\n    const cell_to_obj = (cell) => {\n      const obj = {\n        data: cell.innerText,\n      }\n      if (cell.innerText !== cell.innerHTML) obj.html = cell.innerHTML;\n      return obj;\n    }\n    const ths = (this.dom.querySelectorAll('thead tr th').length) ? this.dom.querySelectorAll('thead tr th') : this.dom.querySelectorAll('thead tr td');\n    const trs = this.dom.querySelectorAll('tbody tr');\n    let active = 0,\n      hidden = 0;\n\n    function find_label(th) {\n      if (th.childNodes.length) return find_label(th.childNodes[0]);\n      else return th.innerText;\n    }\n    ths.forEach((th, index) => {\n      const col = Object.assign({}, th.dataset);\n      if (col.mask) th.classList.add('hidden');\n      if (col.hidden && (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_2__.string_to_boolean)(col.hidden)) {\n        col.hidden = true;\n        th.remove();\n      }\n      col.label = find_label(th);\n      if (col.type) {\n        col.format = col.type;\n        delete col.type;\n      }\n      col.index = index;\n      if (col.hidden) this.grid.hidden.push(index);\n      else this.grid.active.push(index);\n      this.grid.columns.push(col);\n    });\n    const cellid = this.getCellId(this.cellidname);\n    trs.forEach((tr, i) => {\n      if (cellid < 0) tr.dataset[this.cellidname] = i;\n      else if (i === cellid) tr.dataset[this.cellidname] = this.getCellData(i, this.cellidname, cellid);\n      const data = [];\n      tr.querySelectorAll('th,td').forEach((td, index) => {\n        if (this.grid.columns[index].hasOwnProperty('mask')) td.classList.add('hidden');\n        if (this.grid.hidden.indexOf(index) >= 0) td.remove();\n        data.push(td.innerText);\n      });\n      this.grid.data.push(data)\n    });\n\n    this.dom.querySelectorAll('tfoot tr th').forEach((td, index) => {\n      if (this.grid.columns[index].hasOwnProperty('mask')) td.classList.add('hidden');\n      if (this.grid.hidden.indexOf(index) >= 0) td.remove();\n    });\n    this.dom.classList.remove(tablecss.hide);\n    return;\n  }\n  renderTbody(tbody) {\n    const l = this.grid.data.length;\n    for (let i = 0; i < l; i++) {\n      const tr = this.createTableRow(this.grid.data[i], i);\n      tbody.append(tr);\n    };\n\n\n\n  }\n  async tableActivate(container, tabledef = null) {\n    this.on(this.eventnames.init, () => {\n      // hide and move waitdiv in the wrapper for inner elements display\n      this.dom.classList.remove(tablecss.hide);\n      this.waitDesactivate();\n      if (this.afterLoad) this.afterLoad();\n      // move import zones and/or search zone - reorg the page display\n      //container.style.top = container.offsetTop + 'px';\n      // fetch once the same table\n      container.dataset.table = this.params.table = true;\n\n    });\n    this.on(this.eventnames.load, () => {\n      this.initSearch();\n      this.initSort();\n      this.initPlugins(container);\n      console.log('plugin loaded', (Date.now() - this.dt) / 1000);\n    });\n    // dismiss table when dismiss modal\n    this.on(this.eventnames.dismiss, (e) => {\n      this.destroy();\n    });\n    if (tabledef) tabledef = await this.dataToTable(tabledef);\n    else await this.tableToData();\n    if (this.grid.data.length) this.emit(this.eventnames.load);\n    setTimeout(() => {\n      this.emit(this.eventnames.init);\n      this.initialized = true;\n    }, 10)\n    instance[this.instanceid] = this;\n\n  }\n\n  tableAppendRows(rows) {\n    console.log('rows');\n  }\n  destroy() {\n    if (this.dataImport) this.dataImport = null;\n    this.dom = null;\n    delete instance[this.instanceid];\n  }\n  refresh(e) {\n    if (this.dataImport && this.dataImport.selectors) this.dataImport.selectors.forEach(selector => {\n      if (this.disabled) this.disabled = false;\n    });\n  }\n  labelFormatter(column) {\n    let align = ``;\n    if (['number', 'progress', 'decimal'].find(format => format === column.format)) align = _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_3__.css.right;\n    if (column.subfield) return `${column.label} <span class=\"sublabel\">${column.sublabel}</span>`;\n    else if (column.label) return `<span class=\"${align}\">${column.label}</span>`;\n    else return ``;\n  }\n  getCellId(name, state = null) {\n    let cols = this.grid.columns.filter(column => (column.name === name));\n    return (cols.length) ? cols[0].index : -1;\n  }\n\n  getCellData(rowIndex, name, cellIndex = null) {\n    cellIndex = (cellIndex === null) ? this.getCellId(name) : cellIndex;\n    if (cellIndex < 0) return null;\n    return (this.grid.data.length) ? ((this.grid.data[rowIndex]) ? this.grid.data[rowIndex][cellIndex] : null) : null;\n  }\n\n  rowAttributes(tr, index) {\n    const id = this.getCellData(index, this.cellidname);\n    tr.dataset[this.cellidname] = id;\n    if (this.setRowAttributes) tr = this.setRowAttributes(this, tr, id);\n    return tr;\n  }\n\n  createTableRow(row, index, isheader = false) {\n    const tr = document.createElement('tr');\n    let td;\n    this.grid.columns.forEach(column => {\n      if (column.hasOwnProperty('hidden') && column.hidden === true) return;\n      const cell = row[column.index];\n      if (column.hasOwnProperty(\"render\")) {\n        td = column.render(cell, index, column.index);\n        td.nodename = (isheader) ? 'TH' : 'TD';\n        td = this.objToElement(td);\n      } else {\n        td = (isheader) ? document.createElement('th') : document.createElement('td');\n        td.appendChild(document.createTextNode(cell));\n      }\n      tr.appendChild(td);\n    })\n    return this.rowAttributes(tr, index);\n  }\n\n  objToElement(obj) {\n    if (obj.nodename === \"#text\") return document.createTextNode(obj.data);\n    const el = document.createElement(obj.nodename);\n    if (obj.hasOwnProperty(\"html\")) el.innerHTML = obj.html;\n    else el.textContent = obj.data;\n    if (obj.hasOwnProperty(\"attributes\")) {\n      for (const attr in obj.attributes) {\n        el.setAttribute(attr, obj.attributes[attr]);\n      }\n    }\n    if (obj.hasOwnProperty(\"childnodes\")) {\n      obj.childnodes.forEach(childnode => {\n\n        el.appendChild(this.objToElement(childnode));\n      });\n\n    }\n    return el;\n  }\n\n  setTextNode(value) {\n    return {\n      nodename: \"#text\",\n      data: value\n    };\n  }\n  async getFormatters() {\n    let formatters = {\n      controls: (value, rowIndex, cellIndex, td = {}) => {\n        const column = this.grid.columns[cellIndex];\n        const id = this.getCellData(rowIndex, column.field);\n        const actions = (column.actions) ? column.actions : null;\n        if (!actions) return ``;\n        let controls = [];\n        Object.entries(actions).forEach(([key, action]) => {\n          controls.push({\n            nodename: \"A\",\n            attributes: {\n              class: `btn is-${key} `,\n              href: `${action.link}${id}`\n            },\n            childnodes: [this.setTextNode(action.label)]\n          });\n\n        });\n        if (!td.hasOwnProperty('attributes')) td.attributes = {};\n        td.attributes.class = _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_3__.css.component.table.controls;\n        td.childnodes = controls;\n        return td;\n      },\n      select: (value, rowIndex, cellIndex, td = {}) => {\n        const column = this.grid.columns[cellIndex];\n        value = (isNaN(value)) ? this.getCellData(rowIndex, column.field) : value;\n\n        td.childnodes = [{\n          nodename: \"INPUT\",\n          attributes: {\n            type: \"radio\",\n            name: `${this.instanceid}select`,\n            value: String(value)\n          }\n        }];\n        return td;\n      },\n      selectmultiple: (value, rowIndex, cellIndex, td = {}) => {\n        const column = this.grid.columns[cellIndex];\n        value = (isNaN(value)) ? ((column.hasOwnProperty('field')) ? this.getCellData(rowIndex, column.field) : value) : value;\n        td.childnodes = [{\n          nodename: \"INPUT\",\n          attributes: {\n            type: \"checkbox\",\n            name: `${this.instanceid}select[]`,\n            value: String(value)\n          }\n        }];\n        return td;\n      },\n      decimal: (value, rowIndex, cellIndex, td = {}) => {\n        if (isNaN(value)) value = 0;\n        value = parseFloat(value).toFixed(2);\n        if (value - parseInt(value) === 0) value = parseInt(value);\n        if (!td.hasOwnProperty('attributes')) td.attributes = {};\n        td.attributes.class = _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_3__.css.number;\n        td.childnodes = [this.setTextNode(value)];\n        return td;\n      },\n      number: (value, rowIndex, cellIndex, td = {}) => {\n        if (isNaN(value)) value = 0;\n        if (!td.hasOwnProperty('attributes')) td.attributes = {};\n        td.attributes.class = _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_3__.css.number;\n        td.childnodes = [this.setTextNode(value)];\n        return td;\n      },\n      check: (value, rowIndex, cellIndex, td = {}) => {\n        if (isNaN(value)) value = ``;\n        switch (value) {\n          case true:\n          case 'Y':\n          case 1:\n            value = \"\";\n            break;\n          default:\n            value = \"no-\";\n            break;\n        }\n        const icon = {\n          nodename: \"I\",\n          attributes: {\n            class: `icon-sm  icon-${value}check `\n          },\n          childnodes: []\n        }\n        const column = this.grid.columns[cellIndex];\n        const id = this.getCellData(rowIndex, this.cellidname);\n        if (column.hasOwnProperty(\"toggle\")) td.childnodes = [{\n          nodename: \"A\",\n          attributes: {\n            \"data-request\": \"toggle\",\n            \"data-action\": `${column.toggle.link}/${id}`,\n            \"href\": \"javascript:void()\"\n\n          },\n          childnodes: [icon]\n\n        }]\n        else td.childnodes = [icon];\n        return td;\n      },\n      text: (value, rowIndex, cellIndex, td = {}) => {\n        if (value === null) td.childnodes = [];\n        else {\n          value = value.replaceAll('\\r\\n', ', ');\n          if (value !== ``) td.childnodes = [{\n            nodename: \"DIV\",\n            attributes: {\n              class: _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_3__.css.component.table.tip\n            },\n            childnodes: [this.setTextNode(value)]\n          }];\n          else td.childnodes = [];\n        }\n        return td;\n      },\n      default: (value, rowIndex, cellIndex, td = {}) => {\n        if (value === null || value === ``) td.childnodes = [];\n        else td.childnodes = [this.setTextNode(value)];\n        return td;\n      }\n\n    }\n    let tablecustom = null;\n\n    switch (this.params.from) {\n      case 'collectionlist':\n        tablecustom = await __webpack_require__.e(/*! import() */ \"src_modules_table-collection_js\").then(__webpack_require__.bind(__webpack_require__, /*! ../modules/table-collection.js */ \"./src/modules/table-collection.js\"));\n        this.cellidname = _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_3__.models.id;\n        break;\n      case 'prjlist':\n        tablecustom = await __webpack_require__.e(/*! import() */ \"src_modules_table-project_js\").then(__webpack_require__.bind(__webpack_require__, /*! ../modules/table-project.js */ \"./src/modules/table-project.js\"));\n        this.cellidname = _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_3__.models.projid;\n        break;\n      case 'prjsamplestats':\n        tablecustom = await __webpack_require__.e(/*! import() */ \"src_modules_table-sample_js\").then(__webpack_require__.bind(__webpack_require__, /*! ../modules/table-sample.js */ \"./src/modules/table-sample.js\"));\n        this.cellidname = _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_3__.models.sampleid;\n        break;\n      case \"prjpredict\":\n        tablecustom = await __webpack_require__.e(/*! import() */ \"src_modules_table-prediction_js\").then(__webpack_require__.bind(__webpack_require__, /*! ../modules/table-prediction.js */ \"./src/modules/table-prediction.js\"));\n        this.cellidname = _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_3__.models.projid;\n\n        break;\n    }\n\n    return (tablecustom) ? { ...formatters,\n      ...tablecustom.default(this)\n    } : formatters;\n\n\n  }\n  async convertColumns(tabledef) {\n    const columns = (tabledef.columns) ? tabledef.columns : ((this.params.columns) ? JSON.parse(this.params.columns) : null);\n    if (!columns) return;\n    const formatters = await this.getFormatters();\n    //\n    const fields = [];\n    Object.entries(tabledef.columns).forEach(([key, column]) => {\n      if (!column.hasOwnProperty('emptydata')) fields.push(key);\n    });\n    const map_column = (key, column, index) => {\n      if (!column) return {\n        index: index,\n        name: key,\n        hidden: true\n      };\n      let col = {\n        index: index,\n        name: key,\n        label: this.labelFormatter(column),\n        sortable: true,\n\n      };\n      col.index = (column.hasOwnProperty('emptydata')) ? fields.indexOf(column.emptydata) : fields.indexOf(key);\n      if (column.notsortable) col.sortable = false;\n      else if (column.sortable) col.sort = col.sortable;\n      col.searchable = (col.notsearchable) ? false : true;\n      if (column.hidden) col.hidden = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_2__.string_to_boolean)(column.hidden);\n      if (['number', 'decimal'].find(format => format === column.format)) col.type = 'number';\n      let render = null;\n      switch (key) {\n        case 'select':\n          const select = (column.select && column.select == \"controls\") ? \"controls\" : ((column.selectcells) ? \"imports\" : column.select);\n          if (select) {\n            col = { ...column,\n              ...col\n            }\n\n            col.sortable = col.searchable = false;\n          }\n          break;\n      }\n      if (!column.hasOwnProperty('hidden')) {\n        const select = (column.select && column.select == _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_3__.models.controls) ? _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_3__.models.controls : ((column.selectcells) ? _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_3__.models.imports : column.select)\n        const format = (column.format) ? column.format : ((column.subfield) ? column.subfield : ((select) ? select : \"default\"));\n        if (formatters && formatters[format]) col.render = formatters[format];\n\n      }\n      return col;\n    }\n\n    this.grid.columns = Object.entries(columns).map(([key, column], index) => map_column(key, column, index));\n  }\n  initEvents() {\n    this.on(this.eventnames.update, () => {\n      if (this.dom.classList.contains(tablecss.hide)) this.dom.classList.remove(tablecss.hide);\n\n    });\n  }\n  initPlugins(container) {\n    if (!this.grid.data.length) return;\n    if (this.params.import && this.initImport) this.initImport(this);\n    if (this.params.expand) this.makeExpandable(container);\n    if (this.params.export) this.makeExportable(container);\n    if (this.params.details || this.dom.querySelector(tableselectors.details)) this.initDetails();\n    else this.initEvents();\n    if (this.params.onselect) this.initSelect(container);\n    if (this.dom.querySelector(tableselectors.tip)) this.initTips();\n    if (this.dom.querySelectorAll('thead [data-altsort]').length) this.initAlternateSort(this.dom.querySelectorAll('thead [data-altsort]'));\n    if (this.params.filters) {\n      const top = this.wrapper.querySelector(tableselectors.top);\n      if (top && top.children.length) {\n        const filters = document.querySelector(tableselectors.filters);\n        // insert  filters node  in datatable top\n        if (filters) top.prepend(filters);\n      }\n    }\n  }\n  initSort() {\n\n    const ths = this.dom.querySelectorAll('thead th');\n    let index = 0;\n    this.grid.columns.forEach((column, i) => {\n      if (column.hasOwnProperty('hidden')) return;\n      if (column.sortable) {\n        const th = ths[index];\n        const a = document.createElement('a');\n        a.classList.add(tableselectors.sorter.substr(1));\n        a.appendChild(th.childNodes[0]);\n        th.appendChild(a);\n        th.childNodes.forEach(child => {\n          th.appendChild(child);\n        });\n\n        a.addEventListener('click', (e) => {\n          e.stopImmediatePropagation();\n          if (this.sorting === true || this.searching === true) {\n            e.preventDefault();\n            return false;\n          }\n          this.sortColumn(th, column.index);\n        });\n      }\n      index++;\n    });\n    this.sorting = false;\n    // remove details when sorting\n    this.on(this.eventnames.sorting, (direction, index) => {\n\n      if (this.plugins.hasOwnProperty('jsDetail')) this.plugins['jsDetail'].activeDetail(false);\n      this.dom.querySelectorAll('.table-sorter').forEach((a, i) => {\n        a.classList.add(((i === index) ? _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_3__.css.wait : _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_3__.css.disabled));\n      });\n      this.sorting = true;\n    });\n    // remove details when sorting\n    this.on(this.eventnames.sorted, (direction, index) => {\n      this.dom.querySelectorAll('.table-sorter').forEach((a, i) => {\n        a.classList.remove(((i === index) ? _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_3__.css.wait : _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_3__.css.disabled))\n      });\n      this.sorting = false;\n    });\n  }\n  sortColumn(th, index, dir = null) {\n    dir = (dir === null) ? ((th.classList.contains(tablecss.ascending)) ? false : (th.classList.contains(tablecss.descending)) ? true : ((th.dataset.sort) ? false : true)) : dir;\n    th.classList.toggle(tablecss.ascending);\n    th.classList.toggle(tablecss.descending);\n    this.emit(this.eventnames.sorting, dir, th.cellIndex);\n    let rows = this.grid.data.map((row, i) => {\n      const cell = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_2__.is_object)(row[index]) ? JSON.stringify(row[index]) : ((Array.isArray(row[index])) ? row[index][0] : row[index]);\n      return {\n        value: typeof cell === \"string\" ? cell.toLowerCase() : ((cell === null) ? 0 : cell),\n        row: i\n      }\n    });\n\n    const compare_coldata = function(a, b) {\n      const x = (dir ? a.value : b.value);\n      const y = (dir ? b.value : a.value);\n      return x.localeCompare(y, undefined, {\n        numeric: true,\n        sensitivity: 'base'\n      });\n\n    };\n\n    if (dir === false) {\n      th.classList.remove(tablecss.ascending);\n      th.classList.add(tablecss.descending);\n      th.setAttribute(\"aria-sort\", \"descending\");\n    } else {\n      th.classList.remove(tablecss.descending);\n      th.classList.add(tablecss.ascending);\n      th.setAttribute(\"aria-sort\", \"ascending\");\n    }\n\n    /* Clear asc/desc class names from the last sorted column's th if it isn't the same as the one that was just clicked */\n    if (this.dom.dataset.lastth !== undefined && th.cellIndex != this.dom.dataset.lastth) {\n      const headings = this.dom.querySelectorAll(\"thead th\");\n      headings[this.dom.dataset.lastth].classList.remove(tablecss.descending);\n      headings[this.dom.dataset.lastth].classList.remove(tablecss.ascending);\n      headings[this.dom.dataset.lastth].removeAttribute(\"aria-sort\");\n\n    }\n    this.dom.dataset.lastth = th.cellIndex;\n    const collator = new Intl.Collator(undefined, {\n      numeric: true,\n      sensitivity: 'base'\n    })\n    rows.sort((a, b) => {\n      return collator.compare((dir ? a.value : b.value), (dir ? b.value : a.value))\n    });\n    /*rows.sort((a, b) => {\n      return compare_coldata(a, b);\n    });*/\n    const tbody = this.dom.querySelector('tbody');\n    const clone = tbody.cloneNode();\n    const trs = tbody.querySelectorAll('tr');\n    tbody.innerHTML = ``;\n    const sorted = [];\n    rows.forEach((r, i) => {\n      clone.appendChild(trs[r.row]);\n      sorted.push(this.grid.data[r.row]);\n\n    });\n    this.grid.data = sorted;\n    this.dom.replaceChild(clone, tbody);\n\n    this.emit(this.eventnames.sorted, dir, th.cellIndex);\n\n\n  }\n\n  tableSearch(input, casesensitive = false) {\n    function search_string(str, casesensitive) {\n      str = (casesensitive) ? str : str.toLowerCase();\n      return str; // str.replace(/[-[\\]{}()*+?.,\\\\^$|#]/g, '\\\\$&');\n    }\n\n    function search_queries(str, casesensitive) {\n      str = search_string(str, casesensitive);\n      let strs = [];\n      let phrase;\n      while ((phrase = str.match(/\"([^\"]+)\"/)) !== null) {\n\n        strs.push(phrase[1]);\n        str = str.substring(0, phrase.index) + str.substring(phrase.index + phrase[0].length);\n      }\n      // Get remaining space-separated words (if any)\n      str = str.trim();\n      if (str.length) strs = strs.concat(str.split(/\\s+/));\n      return strs;\n    }\n\n    let queries = search_queries(input.value);\n    let datas = this.grid.data,\n      indexes = [];\n    const trs = this.dom.querySelectorAll('tbody tr');\n    const cellid = this.getCellId(this.cellidname);\n    queries.forEach(qry => {\n      indexes = [];\n      datas = datas.filter((data, j) => {\n        const found = data.filter(cell => {\n          switch (typeof cell) {\n            case 'object':\n              cell = (cell) ? cell : ``;\n              try {\n                cell = JSON.stringify(cell);\n              } catch (err) {\n                console.log('search', err);\n                cell = ``;\n              }\n              break;\n            case 'array':\n              cell = cell.join(' ');\n              break;\n            default:\n              cell = String(cell);\n              break;\n          }\n\n          return ((casesensitive) ? cell.indexOf(qry) > -1 : cell.toLowerCase().indexOf(qry)) > -1;\n        });\n\n        if (found.length > 0) {\n          if (cellid < 0) indexes.push(String(j));\n          else indexes.push(String(data[cellid]));\n          return data;\n        }\n      });\n    });\n\n    trs.forEach((tr, index) => {\n      const val = (tr.dataset[this.cellidname] !== null) ? tr.dataset[this.cellidname] : tr.cells[cellid].textContent;\n      if ((queries.length > 0 && indexes.length === 0) || indexes.indexOf(val) < 0) tr.hidden = true;\n      else tr.hidden = false;\n    });\n\n  }\n\n  initSearch() {\n    if (this.grid.data.length < 10) return this.toggleAddOns();\n    else this.toggleAddOns([tableselectors.search + ' input'], true);\n    this.searching = false;\n    // search items\n    const searchinput = this.wrapper.querySelector(tableselectors.search + ' input');\n    if (!searchinput) return;\n    let searchstring = ``;\n    const search_terms = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_2__.debounce)((el) => {\n      searchstring = el.value;\n      this.tableSearch(el);\n    }, 500);\n    searchinput.addEventListener(\"keyup\", (e) => {\n      e.preventDefault();\n      search_terms(e.currentTarget);\n    })\n    searchinput.addEventListener(\"click\", (e) => {\n\n      if (searchstring !== e.currentTarget.value) search_terms(e.currentTarget);\n\n    })\n    let timesearch = false;\n    this.on(this.eventnames.search, (query, matched) => {\n      if (this.plugins.hasOwnProperty('jsDetail')) this.plugins['jsDetail'].activeDetail(false);\n      this.searching = true;\n    });\n    this.on(this.eventnames.searchend, (query, matched) => {\n\n      this.searching = false;\n    });\n    this.on(this.eventnames.update, () => {\n      if (timesearch === false) {\n        timesearch = true;\n        setTimeout(() => {\n          refresh_details();\n          delete this.dom.dataset.issearching;\n          timesearch = false;\n        }, 300);\n      }\n    });\n  }\n  initSelect(container) {\n    const inputs = this.dom.querySelectorAll('input[name^=\"' + this.instanceid + '\"]');\n    if (inputs.length === 0) return;\n    const inputname = inputs[0].name;\n    let selectaction = container.querySelector('.' + tablecss.selectaction);\n    if (!selectaction) return;\n    document.body.append(selectaction);\n    selectaction.querySelector('a').addEventListener('click', (e) => {\n      let vals = [];\n      inputs.forEach(input => {\n        if (input.checked) vals.push(input.value);\n      });\n      if (selectaction.dataset.input) {\n        document.getElementById(selectaction.dataset.input).value = vals.join(',');\n        if (selectaction.dataset.form) document.getElementById(selectaction.dataset.form).submit();\n      } else e.currentTarget.href = this.params.onselect + encodeURI(vals.join(','));\n\n    });\n    const close = selectaction.querySelector('[data-dismiss]');\n    if (close) close.addEventListener('click', (e) => {\n      e.preventDefault();\n      e.stopImmediatePropagation();\n      popup_selected(null, null);\n    });\n\n    const popup_selected = (top = null, left = null, forceclose = false) => {\n      if (selectaction.dataset.close) {\n        document.body.append(selectaction);\n        close.classList.remove('hidden');\n        selectaction.classList.add(tablecss.absinput);\n      }\n      if (top !== null && left !== null) {\n        selectaction.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_3__.css.hide);\n        selectaction.style.top = top + 'px';\n        selectaction.style.left = left + 'px';\n\n      } else {\n        if (forceclose === true) {\n          selectaction.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_3__.css.hide);\n          delete selectaction.dataset.close;\n        } else {\n          selectaction.dataset.close = true;\n          close.classList.add('hidden');\n          const toptable = this.wrapper.querySelector(tableselectors.top) ? this.wrapper.querySelector(tableselectors.top) : this.wrapper;\n          toptable.prepend(selectaction);\n          selectaction.classList.remove(tablecss.absinput);\n\n        }\n      }\n    }\n    inputs.forEach(input => {\n      input.addEventListener('change', (e) => {\n        if (input.checked) popup_selected(input.offsetTop, input.offsetLeft);\n        else if (this.dom.querySelectorAll('input[name^=\"' + this.instanceid + '\"]:checked').length === 0) popup_selected(null, null, true);\n      });\n    });\n    if (this.dom.querySelectorAll('input[name^=\"' + this.instanceid + '\"]:checked').length > 0) {\n      selectaction.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_3__.css.hide);\n      popup_selected(null, null);\n    }\n  }\n  async initDetails() { // TODO : generic\n    // about - one div to display cell details make it appear as table row expanding\n    const wrapper = this.wrapper;\n\n    const about = wrapper.querySelector('#' + tablecss.tipinline) ? wrapper.querySelector('#' + tablecss.tipinline) : tablecss.tipinline;\n    if (!dynamics.JsDetail) {\n      const {\n        JsDetail\n      } = await\n      __webpack_require__.e(/*! import() */ \"src_modules_js-detail_js\").then(__webpack_require__.bind(__webpack_require__, /*! ../modules/js-detail.js */ \"./src/modules/js-detail.js\"));\n      dynamics.JsDetail = JsDetail;\n    }\n    const jsDetail = new dynamics.JsDetail(about, wrapper, {\n      waitdiv: this.waitdiv\n    }); // specific to about details in table\n    // hide / show disable details zone\n    const callbackclose = (el, callback = null) => {\n      jsDetail.activeDetail(false);\n      if (callback) callback();\n    }\n\n    const callbackopen = (el, callback = null) => {\n      jsDetail.activeDetail(true);\n      if (jsDetail.current && jsDetail.current === el) {\n        jsDetail.expandDetail(el);\n        if (callback) callback();\n      } else {\n        if (jsDetail.current) jsDetail.current.querySelector('summary').click();\n        const url = this.params.detailsurl + el.dataset.id + '?' +\n          new URLSearchParams({\n            partial: true\n          });\n        jsDetail.activeDetail(true);\n        // append to cell details and display\n\n        fetch(url, (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_2__.fetchSettings)()).then(response => response.text()).then(html => {\n          jsDetail.expandDetail(el, html);\n          if (callback) callback();\n        }).catch(err => {\n          console.log('request', err);\n        })\n      }\n\n    }\n    if (!dynamics.JsAccordion) {\n      const {\n        JsAccordion\n      } = await __webpack_require__.e(/*! import() */ \"src_modules_js-accordion_js\").then(__webpack_require__.bind(__webpack_require__, /*! ../modules/js-accordion.js */ \"./src/modules/js-accordion.js\"));\n      dynamics.JsAccordion = JsAccordion;\n    }\n\n    const refresh_details = () => {\n      if (this.dom.classList.contains(tablecss.hide)) this.dom.classList.remove(tablecss.hide);\n      const details = this.dom.querySelectorAll(tableselectors.details);\n      if (!details) return;\n      details.forEach(item => {\n        if (!item.dataset.id) return;\n\n        item = new dynamics.JsAccordion(item, callbackopen, callbackclose, jsDetail.detail);\n      });\n    }\n    this.plugins['jsDetail'] = jsDetail;\n    refresh_details();\n  }\n\n  initAlternateSort(cols) {\n\n    let tdcols = [];\n    cols.forEach(col => {\n      const tdcol = col.closest('th');\n      Object.entries(col.dataset).forEach(([k, v]) => {\n        tdcol.dataset[k] = v;\n        col.classList.add('inline-block')\n      });\n      tdcols.push(tdcol);\n    });\n    cols = tdcols;\n    // end fix\n\n    let coltosort;\n    const sortalternate = (col) => {\n      let todir;\n      // keep the same dir if sort on col changes\n      if (parseInt(col.dataset.sortactive) === parseInt(coltosort)) {\n        todir = (col.classList.contains(tablecss.ascending)) ? 'desc' : ((col.classList.contains(tablecss.descending)) ? 'asc' : 'asc');\n      } else todir = (col.classList.contains(tablecss.ascending)) ? 'asc' : (col.classList.contains(tablecss.descending)) ? 'desc' : 'asc';\n      //  this.grid.columns.sort(coltosort, todir);\n\n      this.sortColumn(col, coltosort, todir);\n\n    }\n    cols.forEach(col => {\n      const altsort = (col.dataset.altsort) ? col.dataset.altsort.split(',') : null;\n      if (!altsort) return;\n      const csssorter = col.querySelector(tableselectors.sorter);\n      if (csssorter) csssorter.classList.add(tablecss.disabled);\n      const control = col.querySelector(tableselectors.sorton);\n      // prevents imbricated links\n      col.append(control);\n      const triggers = col.querySelectorAll('[role=\"button\"]');\n\n      col.addEventListener('click', (e) => {\n        e.preventDefault();\n        sortalternate(col);\n      }, false);\n      const changecoltosort = (cl, index) => {\n        if (index === 0) coltosort = this.grid.columns.findIndex(column => (column.index === cl.cellIndex));\n        else coltosort = this.grid.columns.findIndex(column => (column.name === altsort[index - 1]));\n      }\n      col.dataset.sortactive = col.cellIndex;\n      triggers.forEach((trigger, index) => {\n        trigger.addEventListener('click', (e) => {\n          e.preventDefault();\n          const active = e.currentTarget.parentElement.querySelector('.' + _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_3__.css.active);\n          if (active) active.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_3__.css.active);\n          e.currentTarget.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_3__.css.active);\n          changecoltosort(col, index);\n        });\n      });\n      if (col.dataset.tip) {\n\n        Object.values(this.dom.rows).forEach((row, index) => {\n          if (index === 0) return;\n          const coltip = this.grid.columns.findIndex(column => (column.name === altsort[parseInt(col.dataset.tip) - 1]));\n\n          if (row.cells.length === 0 || coltip === col.cellIndex) return;\n          row.cells[col.cellIndex].addEventListener('mouseenter', (e) => {\n\n            const tip = document.createElement('div');\n            tip.setAttribute('class', tablecss.tipover);\n            tip.innerHTML = row.cells[coltip].innerHTML;\n            e.currentTarget.append(tip);\n          });\n          row.cells[col.cellIndex].addEventListener('mouseout', (e) => {\n            const tip = e.currentTarget.querySelector(tableselectors.tipover);\n            if (tip) tip.remove();\n          });\n        });\n      }\n    });\n\n  }\n\n\n  closeShowfull() {\n    const showfull = document.querySelector('.' + _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_3__.css.component.table.tip + '.' + tablecss.showfull);\n    if (showfull) showfull.click();\n  }\n  makeExpandable(container) {\n    if (container.querySelector('table').offsetHeight < container.offsetHeight) return;\n    const btn = document.createElement('div');\n    btn.classList.add('button-expand');\n    btn.classList.add('border-t');\n    btn.title = this.params.expand;\n    btn.innerHTML = `<span class=\"small-caps block mx-auto p-0\">${this.params.expand}</span><i class=\"clear-both p-0 mx-auto icon icon-chevron-down hover:fill-secondblue-500\"></i><span class=\"small-caps block mx-auto p-0 hidden\">${\n                  this.params.shrink}</span>`;\n    container.parentElement.insertBefore(btn, container.nextElementSibling);\n    container.classList.add('overflow-y-hidden');\n    container.classList.remove('max-tabstat-h');\n    container.parentElement.style.height = 'auto';\n    const h = parseInt(this.wrapper.querySelector('tbody tr').offsetHeight) * ((this.params.maxrows) ? this.params.maxrows : 20);\n    container.classList.add('max-h-[' + h + 'px]');\n    container.style.height = h + 'px';\n    btn.addEventListener('click', (e) => {\n      this.closeShowfull();\n      btn.classList.toggle('border-t');\n      btn.classList.toggle('border-b');\n      const ico = btn.querySelector('i');\n      ico.classList.toggle('icon-chevron-down');\n      ico.classList.toggle('icon-chevron-up');\n      container.classList.toggle('overflow-y-hidden');\n      container.classList.toggle('max-h-[' + h + 'px]');\n      btn.querySelectorAll('span').forEach(span => {\n        span.classList.toggle('hidden');\n      });\n      if (container.classList.contains('overflow-y-hidden')) container.style.height = h + 'px';\n      else container.style.height = 'auto';\n    });\n  }\n  makeExportable(container) {\n    const btn = document.createElement('div');\n    btn.classList.add(tableselectors.export.slice(1));\n    btn.classList.add('is-pick');\n    btn.innerHTML = `<i class=\"icon icon-arrow-down-on-square\"></i><span>${((this.params.exportlabel) ? this.params.exportlabel : 'export statistics ')}</span>`;\n    this.wrapper.prepend(btn);\n    const columns = this.grid.columns;\n    let exclude_columns = [];\n    this.grid.columns.forEach((column, index) => {\n      if (column.name === 'select') exclude_columns.push(column.index);\n    });\n    btn.addEventListener('click', async (e) => {\n      e.preventDefault();\n      if (!this.dynamics) this.dynamics = {};\n      if (!this.dynamics.exportCSV) {\n        const {\n          exportCSV // or exportJSON, exportSQL\n        } = await\n        __webpack_require__.e(/*! import() */ \"src_modules_js-export-csv_js\").then(__webpack_require__.bind(__webpack_require__, /*! ../modules/js-export-csv.js */ \"./src/modules/js-export-csv.js\"));\n\n        this.dynamics.exportCSV = exportCSV;\n      }\n      let str = this.dynamics.exportCSV(this, {\n        download: false,\n        linedelimiter: \"\\n\",\n        columndelimiter: \"\\t\",\n        skipcolumns: exclude_columns\n      });\n      str = encodeURI(`data:text/tsv;charset=utf-8,${str}`);\n\n      (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_2__.download_url)(str, ((container.id) ? container.id : 'stats_proj') + '.tsv');\n\n    });\n  }\n  initTips() {\n    // show big cell content\n    let current = null;\n    this.dom.querySelectorAll(tableselectors.tip).forEach(tip => {\n      tip.addEventListener('mouseenter', (e) => {\n        if (tip.classList.contains(tablecss.showfull) || (tip.scrollHeight > tip.offsetHeight)) {\n          tip.style.cursor = 'pointer';\n        }\n      });\n      tip.addEventListener('click', (e) => {\n        const styleparent = window.getComputedStyle(tip.parentElement);\n        const style = window.getComputedStyle(tip.parentElement);\n        if (tip.classList.contains(tablecss.showfull)) {\n          tip.classList.remove(tablecss.showfull);\n          tip.parentElement.style.minHeight = 'none';\n          tip.parentElement.style.height = 'auto';\n          tip.style.maxWidth = tip.style.minWidth = 'none';\n          if (tip.dataset.p) {\n            tip.style.paddingLeft = tip.dataset.p.l;\n            tip.style.paddingRight = tip.dataset.p.r;\n            tip.style.paddingTop = tip.dataset.p.t;\n            tip.style.paddingLeft = tip.dataset.p.b;\n          }\n          current = null;\n        } else if (tip.scrollHeight > tip.offsetHeight) {\n          if (current) current.classList.remove(tablecss.showfull);\n\n          const h = parseInt(tip.clientHeight);\n          tip.parentElement.style.minHeight = tip.parentElement.style.height = (((h < parseInt(styleparent.maxHeight)) ? h : parseInt(styleparent.maxHeight)) - 2 * parseInt(styleparent.padding)) + 'px';\n\n          if (!tip.dataset.p) tip.dataset.p = {\n            l: style.paddingLeft,\n            r: style.paddingRight,\n            t: style.paddingTop,\n            b: style.paddingBottom\n          };\n          tip.style.maxWidth = tip.style.minWidth = tip.clientWidth + 'px';\n          tip.classList.add(tablecss.showfull);\n          tip.style.top = (parseInt(tip.offsetTop) - parseInt(styleparent.padding)) + 'px';\n\n          current = tip;\n        }\n\n      });\n    });\n  }\n  toggleAddOns(list = null, on = false) {\n    list = (list) ? list : [tableselectors.search + ' input', tableselectors.export];\n    const addons = [];\n    let addon;\n    list.forEach(addon => {\n      addon = this.wrapper.querySelector(addon);\n      if (addon) {\n        if (on) addon.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_3__.css.hide)\n        else addon.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_3__.css.hide);\n      }\n    });\n  }\n\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJFQUEyRSw2RUFBNkU7QUFDeEo7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1YsUUFBUSw4TEFBcUM7O0FBRTdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLHFDQUFxQyxnQkFBZ0IsSUFBSTs7QUFFekQsTUFBTSwrREFBWTs7QUFFbEIsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQSxPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1Q0FBdUMsMkRBQUc7QUFDMUMsaUNBQWlDLDJEQUFHO0FBQ3BDO0FBQ0EsS0FBSztBQUNMOztBQUVBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vc3JjL21vZHVsZXMvdGFibGUtY29tcG9uZW50LmpzPzVlZTEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IERPTVB1cmlmeSBmcm9tICdkb21wdXJpZnknO1xuaW1wb3J0IGVxdWFsIGZyb20gJ2RlZXAtZXF1YWwnO1xuaW1wb3J0IHtcbiAgYWRkX2N1c3RvbV9ldmVudHMsXG4gIGZldGNoU2V0dGluZ3MsXG4gIGRvd25sb2FkX3VybCxcbiAgc3RyaW5nX3RvX2Jvb2xlYW4sXG4gIHNvcnRfaXRlbXMsXG4gIGlzX29iamVjdCxcbiAgZGVib3VuY2UsXG59IGZyb20gJy4uL21vZHVsZXMvdXRpbHMuanMnO1xuaW1wb3J0IHtcbiAgY3NzLFxuICBtb2RlbHMsXG4gIGRvbXNlbGVjdG9ycyxcbiAgZGVmYXVsdF9tZXNzYWdlc1xufSBmcm9tICcuLi9tb2R1bGVzL21vZHVsZXMtY29uZmlnLmpzJztcbmxldCBpbnN0YW5jZSA9IFtdO1xuLy8gdmFsaWQgZmV0Y2ggdXJscGFydHNcbmNvbnN0IGZldGNoZnJvbXMgPSB7XG4gIGNvbGxlY3Rpb25saXN0OiAnL2d1aS9jb2xsZWN0aW9ubGlzdC8nLFxuICBwcmpsaXN0OiAnL2d1aS9wcmpsaXN0LycsXG4gIHByanNhbXBsZXN0YXRzOiAnL2d1aS9wcmpzYW1wbGVzdGF0cycsXG4gIHVzZXJzbGlzdDogJy9ndWkvYWRtaW4vdXNlcnNsaXN0LycsXG4gIHByanByZWRpY3Q6ICcvZ3VpL3ByanNmb3JwcmVkaWN0aW9uLydcbn07XG4vLyBzcGVjaWZjIGNzc1xuY29uc3QgdGFibGVjc3MgPSB7XG4gIHNob3dmdWxsOiAnc2hvd2Z1bGwnLFxuICB0aXBpbmxpbmU6IFwidGlwLWlubGluZVwiLFxuICBzZWFyY2hyZXN1bHRzOiBcInNlYXJjaC1yZXN1bHRzXCIsXG4gIHNlbGVjdGFjdGlvbjogXCJzZWxlY3RhY3Rpb25cIixcbiAgYWJzaW5wdXQ6ICdhYnNpbnB1dCcsXG4gIGRpc2FibGVkOiAndGFibGUtZGlzYWJsZWQnLFxuICBhc2NlbmRpbmc6ICd0YWJsZS1hc2NlbmRpbmcnLFxuICBkZXNjZW5kaW5nOiAndGFibGUtZGVzY2VuZGluZycsXG4gIHRpcG92ZXI6ICd0aXBvdmVyIGFic29sdXRlIHotMTAgdGV4dC1zdG9uZS01MCByb3VuZGVkIGJnLXN0b25lLTYwMCBweC0yIHB5LTAuNSAtbXQtNSBtbC0xMiAnLFxuICBoaWRlOiAnaGlkZScsXG4gIG5vd3JhcDogJ3RydW5jYXRlJyxcbn07XG5jb25zdCB0YWJsZXNlbGVjdG9ycyA9IHtcbiAgdGFibGU6ICcudGFibGUtdGFibGUnLFxuICB3cmFwcGVyOiAnLnRhYmxlLXdyYXBwZXInLFxuICB0b3A6ICcudGFibGUtdG9wJyxcbiAgaW5wdXQ6ICcudGFibGUtaW5wdXQnLFxuICBzZWFyY2g6ICcudGFibGUtc2VhcmNoJyxcbiAgZXhwb3J0OiAnLmJ1dHRvbi1leHBvcnQnLFxuICBmaWx0ZXJzOiAnLnRhYmxlLWZpbHRlcnMnLFxuICBzb3J0ZXI6ICcudGFibGUtc29ydGVyJyxcbiAgZGV0YWlsczogJ2RldGFpbHNbZGF0YS13aGF0PVwiYWJvdXRcIl0nLFxuICB0aXA6ICcuJyArIGNzcy5jb21wb25lbnQudGFibGUudGlwLFxuICB0aXBvdmVyOiAnLnRpcG92ZXInLFxuICB3YWl0OiAnd2FpdC1wbGVhc2UnLFxuICBzb3J0b246ICcuc29ydG9uJyxcbn07XG5cbk9iamVjdC5mcmVlemUodGFibGVjc3MpO1xuT2JqZWN0LmZyZWV6ZSh0YWJsZXNlbGVjdG9ycyk7XG5jb25zdCBkeW5hbWljcyA9IHt9O1xuXG5leHBvcnQgY2xhc3MgVGFibGVDb21wb25lbnQge1xuICBpbnN0YW5jZWlkID0gbnVsbDtcbiAgZ3JpZCA9IHtcbiAgICBjb2x1bW5zOiBbXSxcbiAgICBhY3RpdmU6IFtdLFxuICAgIGhpZGRlbjogW10sXG4gICAgZGF0YTogW11cbiAgfTtcbiAgZG9tZGVmID0ge1xuICAgIGNvbHVtbnM6IFtdLFxuICAgIGRhdGE6IFtdLFxuICB9O1xuICB3cmFwcGVyID0gbnVsbDtcbiAgZG9tID0gbnVsbDtcbiAgcGFyYW1zID0gbnVsbDtcbiAgX2V2ZW50cyA9IHt9O1xuICBldmVudG5hbWVzID0ge1xuICAgIGluaXQ6IFwidGFibGUuaW5pdFwiLFxuICAgIHVwZGF0ZTogXCJ0YWJsZS51cGRhdGVcIixcbiAgICByZWZyZXNoOiBcInRhYmxlLnJlZnJlc2hcIixcbiAgICByZXNpemU6IFwidGFibGUucmVzaXplXCIsXG4gICAgc2VhcmNoOiBcInRhYmxlLnNlYXJjaFwiLFxuICAgIHNlYXJjaGVuZDogXCJ0YWJsZS5zZWFyY2hlbmRcIixcbiAgICBzb3J0aW5nOiBcInRhYmxlLnNvcnRpbmdcIixcbiAgICBzb3J0ZWQ6IFwidGFibGUuc29ydGVkXCIsXG4gICAgbG9hZDogXCJ0YWJsZS5sb2FkZWRcIixcbiAgICBkaXNtaXNzOiAndGFibGUuZGlzbWlzcydcbiAgfVxuICBsYWJlbHMgPSB7XG4gICAgcGxhY2Vob2xkZXI6IFwiU2VhcmNoLi4uXCIsXG4gICAgcGVyUGFnZTogXCJ7c2VsZWN0fSBlbnRyaWVzIHBlciBwYWdlXCIsXG4gICAgbm9Sb3dzOiBcIk5vIGVudHJpZXMgZm91bmRcIixcbiAgICBpbmZvOiBcIlNob3dpbmcge3N0YXJ0fSB0byB7ZW5kfSBvZiB7cm93c30gZW50cmllc1wiLFxuICAgIG5vUmVzdWx0czogXCJObyByZXN1bHQgbWF0Y2ggeW91ciBzZWFyY2ggcXVlcnlcIlxuICB9O1xuICBjZWxsaWRuYW1lID0gXCJpZFwiO1xuICBzZWFyY2hpbmcgPSBmYWxzZTtcbiAgc29ydGluZyA9IGZhbHNlO1xuICBpbml0aWFsaXplZCA9IGZhbHNlO1xuICBwbHVnaW5zID0ge307XG4gIGNvbnN0cnVjdG9yKGNvbnRhaW5lciwgb3B0aW9ucyA9IHt9KSB7XG4gICAgaWYgKCFjb250YWluZXIpIHJldHVybjtcbiAgICBjb250YWluZXIgPSBjb250YWluZXIgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCA/IGNvbnRhaW5lciA6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoY29udGFpbmVyKTtcbiAgICBpZiAoIWNvbnRhaW5lcikgcmV0dXJuO1xuICAgIC8vY2FuIHNlbGVjdCBtdWx0aXBsZXMgdGFibGVzIGluIG9uZSBwYWdlICBvciBsb2FkIGRhdGEgaW4gdGhlIHNhbWUgdGFibGVcbiAgICB0aGlzLmluc3RhbmNlaWQgPSAoY29udGFpbmVyLmRhdGFzZXQuaW5zdGFuY2VpZCkgPyBjb250YWluZXIuZGF0YXNldC5pbnN0YW5jZWlkIDogZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgndGFibGUnKS5sZW5ndGg7XG4gICAgaWYgKCFpbnN0YW5jZVt0aGlzLmluc3RhbmNlaWRdIHx8ICFlcXVhbChjb250YWluZXIuZGF0YXNldCwgaW5zdGFuY2VbdGhpcy5pbnN0YW5jZWlkXS5wYXJhbXMpKSB7XG4gICAgICB0aGlzLmluaXQoY29udGFpbmVyKTtcbiAgICB9IGVsc2UgdGhpcy5yZWZyZXNoKCk7XG4gICAgcmV0dXJuIGluc3RhbmNlW3RoaXMuaW5zdGFuY2VpZF07XG5cbiAgfVxuICBpbml0KGNvbnRhaW5lcikge1xuICAgIGFkZF9jdXN0b21fZXZlbnRzKHRoaXMpO1xuICAgIHRoaXMucGFyYW1zID0gY29udGFpbmVyLmRhdGFzZXQ7XG4gICAgbGV0IHRhYmxlID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJ3RhYmxlJyk7XG4gICAgaWYgKCF0YWJsZSkge1xuICAgICAgdGFibGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0YWJsZScpO1xuICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHRhYmxlKTtcbiAgICB9XG4gICAgdGFibGUuaWQgPSAndGFibGUtJyArIGNvbnRhaW5lci5pZDtcbiAgICB0YWJsZS5jbGFzc0xpc3QuYWRkKHRhYmxlc2VsZWN0b3JzLnRhYmxlLnN1YnN0cigxKSlcbiAgICB0aGlzLmRvbSA9IHRhYmxlO1xuICAgIGxldCB0b3AgPSB7XG4gICAgICBub2RlbmFtZTogXCJESVZcIixcbiAgICAgIGF0dHJpYnV0ZXM6IHtcbiAgICAgICAgY2xhc3M6IHRhYmxlc2VsZWN0b3JzLnRvcC5zdWJzdHIoMSlcbiAgICAgIH1cbiAgICB9O1xuICAgIGlmICh0aGlzLnBhcmFtcy5zZWFyY2hhYmxlKSB0b3AuY2hpbGRub2RlcyA9IFt7XG4gICAgICBub2RlbmFtZTogXCJESVZcIixcbiAgICAgIGF0dHJpYnV0ZXM6IHtcbiAgICAgICAgY2xhc3M6IHRhYmxlc2VsZWN0b3JzLnNlYXJjaC5zdWJzdHIoMSlcbiAgICAgIH0sXG4gICAgICBodG1sOiBgPGlucHV0IHR5cGU9XCJzZWFyY2hcIiBuYW1lPVwidGFibGUtc2VhcmNoXCIgcGxhY2Vob2xkZXI9XCIke3RoaXMubGFiZWxzLnBsYWNlaG9sZGVyfVwiIGNsYXNzPVwiJHt0YWJsZXNlbGVjdG9ycy5pbnB1dC5zdWJzdHIoMSl9ICAke2Nzcy5pbnB1dH0gJHtjc3MuaGlkZX1cIj5gXG4gICAgfV07XG4gICAgbGV0IHdyYXBwZXIgPSB0aGlzLm9ialRvRWxlbWVudCh7XG4gICAgICBub2RlbmFtZTogJ0RJVicsXG4gICAgICBhdHRyaWJ1dGVzOiB7XG4gICAgICAgIGNsYXNzOiB0YWJsZXNlbGVjdG9ycy53cmFwcGVyLnN1YnN0cigxKVxuICAgICAgfSxcbiAgICAgIGNoaWxkbm9kZXM6IFt0b3BdXG4gICAgfSk7XG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHdyYXBwZXIpO1xuICAgIHdyYXBwZXIuYXBwZW5kQ2hpbGQodGFibGUpO1xuICAgIHRoaXMud3JhcHBlciA9IHdyYXBwZXI7XG5cbiAgICB0aGlzLmxhYmVscyA9ICh0aGlzLnBhcmFtcy5sYWJlbHMpID8gdGhpcy5wYXJhbXMubGFiZWxzIDogdGhpcy5sYWJlbHM7XG4gICAgLy8gY2VsbGlkXG4gICAgdGhpcy5jZWxsaWRuYW1lID0gKHRoaXMucGFyYW1zLmhhc093blByb3BlcnR5KFwiY2VsbGlkXCIpKSA/IHRoaXMucGFyYW1zLmNlbGxpZCA6IHRoaXMuY2VsbGlkbmFtZTtcbiAgICAvLyBvbmx5IHZhbGlkIGZyb20gdmFsdWVzIC0gZmV0Y2hmcm9tc1xuICAgIHRoaXMucGFyYW1zLmZyb20gPSAodGhpcy5wYXJhbXMuZnJvbSkgPyBET01QdXJpZnkuc2FuaXRpemUodGhpcy5wYXJhbXMuZnJvbSkgOiBudWxsO1xuXG4gICAgY29uc3QgZnJvbSA9ICh0aGlzLnBhcmFtcy5mcm9tKSA/ICgoT2JqZWN0LmtleXMoZmV0Y2hmcm9tcykuaW5kZXhPZih0aGlzLnBhcmFtcy5mcm9tKSA+PSAwKSA/IGZldGNoZnJvbXNbdGhpcy5wYXJhbXMuZnJvbV0gOiBudWxsKSA6IG51bGw7XG4gICAgaWYgKGZyb20pIHtcbiAgICAgIGlmICh0aGlzLnBhcmFtcy5kZWZlcikgdGhpcy5kZWZlckxvYWQoY29udGFpbmVyLCBmcm9tKTtcbiAgICAgIGVsc2UgdGhpcy5mZXRjaERhdGEoY29udGFpbmVyLCBmcm9tKTtcbiAgICB9IGVsc2UgdGhpcy50YWJsZUFjdGl2YXRlKGNvbnRhaW5lcik7XG4gICAgdGhpcy5kdCA9IERhdGUubm93KCk7XG4gIH1cblxuICB3YWl0QWN0aXZhdGUoY29udGFpbmVyKSB7XG4gICAgbGV0IHdhaXRkaXYgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcignIycgKyB0YWJsZXNlbGVjdG9ycy53YWl0KTtcbiAgICBpZiAoIXdhaXRkaXYpIHtcbiAgICAgIHdhaXRkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgIHdhaXRkaXYuaWQgPSB0YWJsZXNlbGVjdG9ycy53YWl0O1xuICAgICAgY29udGFpbmVyLmFwcGVuZCh3YWl0ZGl2KTtcbiAgICB9XG4gICAgdGhpcy53YWl0ZGl2ID0gd2FpdGRpdjtcbiAgfVxuXG4gIHdhaXREZXNhY3RpdmF0ZShtZXNzYWdlID0gbnVsbCwgdHlwZSA9ICdpbmZvJykge1xuICAgIGlmICghdGhpcy53YWl0ZGl2KSByZXR1cm47XG4gICAgaWYgKG1lc3NhZ2UpIHRoaXMud2FpdGRpdi5pbm5lckhUTUwgPSBgPGRpdiBjbGFzcz1cImFsZXJ0IGlzLSR7dHlwZX1cIj4ke21lc3NhZ2V9PC9kaXY+YDtcbiAgICBlbHNlIHRoaXMud2FpdGRpdi5jbGFzc0xpc3QuYWRkKGNzcy5oaWRlKTtcbiAgfVxuXG4gIGRlZmVyTG9hZChjb250YWluZXIsIGZyb20pIHtcbiAgICBjb25zdCBidG4gPSBjb250YWluZXIucXVlcnlTZWxlY3Rvcih0aGlzLnBhcmFtcy5kZWZlcik7XG4gICAgaWYgKCFidG4pIHJldHVybjtcblxuICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICB0aGlzLmZldGNoRGF0YShjb250YWluZXIsIGZyb20pO1xuICAgICAgYnRuLnJlbW92ZSgpO1xuICAgIH0pO1xuICB9XG5cbiAgZmV0Y2hEYXRhKGNvbnRhaW5lciwgZnJvbXVybCwgcGFnZXN0YXJ0ID0gMCkge1xuICAgIHRoaXMud2FpdEFjdGl2YXRlKGNvbnRhaW5lcik7XG4gICAgY29uc3QgcGFnZXNpemUgPSAodGhpcy5wYXJhbXMucGFnZXNpemUpID8gdGhpcy5wYXJhbXMucGFnZXNpemUgOiAwO1xuICAgIGxldCBmcm9tID0gZnJvbXVybDtcbiAgICBpZiAodGhpcy5wYXJhbXMuZnJvbWlkKSBmcm9tICs9ICcvJyArIHRoaXMucGFyYW1zLmZyb21pZDtcblxuICAgIGxldCBxdWVyeSA9ICh0aGlzLnBhcmFtcy5pbXBvcnQpID8ge1xuICAgICAgdHlwZWltcG9ydDogRE9NUHVyaWZ5LnNhbml0aXplKHRoaXMucGFyYW1zLmltcG9ydCksXG4gICAgICB3aW5kb3dfc3RhcnQ6IHBhZ2VzdGFydCxcbiAgICAgIHdpbmRvd19zaXplOiBwYWdlc2l6ZSxcbiAgICAgIGd6OiB0cnVlLFxuICAgIH0gOiAoKHBhZ2VzaXplKSA/IHtcbiAgICAgIHdpbmRvd19zdGFydDogcGFnZXN0YXJ0LFxuICAgICAgd2luZG93X3NpemU6IHBhZ2VzaXplLFxuICAgICAgbGlzdGFsbDogKCh0aGlzLnBhcmFtcy5saXN0YWxsKSA/IHRoaXMucGFyYW1zLmxpc3RhbGwgOiBmYWxzZSlcbiAgICB9IDogKCh0aGlzLnBhcmFtcy5saXN0YWxsKSA/IHtcbiAgICAgIGxpc3RhbGw6ICgodGhpcy5wYXJhbXMubGlzdGFsbCkgPyB0aGlzLnBhcmFtcy5saXN0YWxsIDogZmFsc2UpXG4gICAgfSA6IHt9KSk7XG4gICAgY29uc3QgcXVlcnlwYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHdpbmRvdy5sb2NhdGlvbi5zZWFyY2gpO1xuICAgIGNvbnN0IHF1ZXJ5a2V5cyA9IHRoaXMuY2VsbGlkbmFtZSArICdzJztcbiAgICBpZiAocXVlcnlrZXlzLmxlbmd0aCkge1xuICAgICAgZm9yIChjb25zdCBlbnRyeSBvZiBxdWVyeXBhcmFtcy5lbnRyaWVzKCkpIHtcbiAgICAgICAgaWYgKHF1ZXJ5a2V5cy5pbmRleE9mKGVudHJ5WzBdKSA+PSAwKSBxdWVyeVtlbnRyeVswXV0gPSBlbnRyeVsxXTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKE9iamVjdC5rZXlzKHF1ZXJ5KS5sZW5ndGgpIGZyb20gKz0gJz8nICsgbmV3IFVSTFNlYXJjaFBhcmFtcyhxdWVyeSk7XG4gICAgdGhpcy5kdCA9IERhdGUubm93KCk7XG4gICAgZmV0Y2goZnJvbSwgZmV0Y2hTZXR0aW5ncygpKS50aGVuKHJlc3BvbnNlID0+IHtcbiAgICAgIGlmIChyZXNwb25zZS5vaykgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcbiAgICAgIGVsc2UgcmV0dXJuIFByb21pc2UucmVqZWN0KHJlc3BvbnNlKTtcbiAgICB9KS50aGVuKGFzeW5jIHRhYmxlZGVmID0+IHtcbiAgICAgIGlmICh0aGlzLndhaXRkaXYpIHRoaXMud2FpdGRpdi5pbm5lckhUTUwgPSAoKHRoaXMud2FpdGRpdi5kYXRhc2V0LmxvYWRlZCkgPyBET01QdXJpZnkuc2FuaXRpemUodGhpcy53YWl0ZGl2LmRhdGFzZXQubG9hZGVkKSA6IGRlZmF1bHRfbWVzc2FnZXMuZGF0YWxvYWRlZCk7XG4gICAgICBpZiAocGFnZXN0YXJ0ID09PSAwKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdzZWNvbmRzIHRvIGZldGNoJywgKERhdGUubm93KCkgLSB0aGlzLmR0KSAvIDEwMDApO1xuICAgICAgICB0aGlzLmR0ID0gRGF0ZS5ub3coKTtcbiAgICAgICAgYXdhaXQgdGhpcy50YWJsZUFjdGl2YXRlKGNvbnRhaW5lciwgdGFibGVkZWYpO1xuICAgICAgfSBlbHNlIGlmICh0YWJsZWRlZi5sZW5ndGgpIHRoaXMuZG9tSW5zZXJ0Um93cyh0YWJsZWRlZik7XG4gICAgICBlbHNlIHBhZ2VzaXplID0gMDtcbiAgICAgIGlmIChwYWdlc2l6ZSA+IDApIHRoaXMuZmV0Y2hEYXRhKGNvbnRhaW5lciwgZnJvbXVybCwgcGFnZXN0YXJ0ICsgcGFnZXNpemUpO1xuICAgIH0pLmNhdGNoKChlcnIpID0+IHsgLyogcHJpbnQgZXJyb3IgZnJvbSByZXNwb25zZSAqL1xuICAgICAgdGhpcy53YWl0RGVzYWN0aXZhdGUoZXJyLnN0YXR1cyArIGAgYCArIGVyci5zdGF0dXNUZXh0LCAnZXJyb3InKTtcbiAgICB9KVxuICB9XG4gIGFzeW5jIGRhdGFUb1RhYmxlKHRhYmxlZGVmKSB7XG5cbiAgICBpZiAoIXRhYmxlZGVmLmRhdGEpIHJldHVybjtcbiAgICBpZiAodGFibGVkZWYuY29sdW1ucykge1xuICAgICAgYXdhaXQgdGhpcy5jb252ZXJ0Q29sdW1ucyh0YWJsZWRlZik7XG4gICAgICBsZXQgdHI7XG4gICAgICBsZXQgdGhlYWQgPSB0aGlzLmRvbS50SGVhZDtcbiAgICAgIGlmICghdGhlYWQpIHtcbiAgICAgICAgLy8gY3JlYXRlIHRhYmxlIGhlYWRpbmdzXG4gICAgICAgIHRoZWFkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGhlYWQnKTtcbiAgICAgICAgdHIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpO1xuICAgICAgICB0aGlzLmRvbS5hcHBlbmRDaGlsZCh0aGVhZCk7XG4gICAgICB9IGVsc2UgaWYgKCF0aGVhZC5xdWVyeVNlbGVjdG9yKCd0cicpKSB7XG4gICAgICAgIHRyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTtcblxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdHIgPSB0aGVhZC5xdWVyeVNlbGVjdG9yKCd0cicpO1xuICAgICAgICB0ci5pbm5lckhUTUwgPSBgYDtcbiAgICAgIH1cbiAgICAgIGxldCB0Ym9keSA9ICh0aGlzLmRvbS50Qm9kaWVzLmxlbmd0aCkgPyB0aGlzLmRvbS50Qm9kaWVzWzBdIDogbnVsbDtcbiAgICAgIGlmICghdGJvZHkpIHtcbiAgICAgICAgdGJvZHkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0Ym9keScpO1xuICAgICAgICB0aGlzLmRvbS5hcHBlbmRDaGlsZCh0Ym9keSk7XG4gICAgICB9XG4gICAgICBjb25zdCBpc2pzb24gPSAoIXRhYmxlZGVmLmhhc093blByb3BlcnR5KCdkYXRhJykgfHwgKHRhYmxlZGVmLmhhc093blByb3BlcnR5KCd0eXBlJykgJiYgdGFibGVkZWYudHlwZSA9PT0gXCJqc29uXCIpKTtcblxuICAgICAgdGhpcy5ncmlkLmNvbHVtbnMuZm9yRWFjaCgoY29sdW1uLCBpbmRleCkgPT4ge1xuXG4gICAgICAgIGlmICghY29sdW1uLmhpZGRlbikge1xuICAgICAgICAgIGNvbnN0IHRoID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGgnKTtcbiAgICAgICAgICB0aC5pbm5lckhUTUwgPSBET01QdXJpZnkuc2FuaXRpemUoY29sdW1uLmxhYmVsKTtcbiAgICAgICAgICBpZiAoY29sdW1uLnNvcnQpIHRoLmRhdGFzZXQuc29ydCA9IGNvbHVtbi5zb3J0O1xuICAgICAgICAgIGlmIChjb2x1bW4uZm9ybWF0KSB0aC5kYXRhc2V0LnR5cGUgPSBjb2x1bW4udHlwZTtcbiAgICAgICAgICBpZiAoY29sdW1uLm5hbWUpIHRoLmRhdGFzZXQubmFtZSA9IGNvbHVtbi5uYW1lO1xuICAgICAgICAgIC8vIFRPRE8gLSBmaW5kIGEgcGxhY2UgdG8gZGVmaW5lIGNvbCBpbXBvcnQgcHJvcHNcbiAgICAgICAgICAvLyBzZXQgaGVhZGluZ3MgZGF0YXNldCB2YWx1ZXMgZm9yIGltcG9ydCBtb2R1bGVcbiAgICAgICAgICBpZiAodGhpcy5wYXJhbXMuaW1wb3J0KVsnc2VsZWN0Y2VsbHMnLCAnd2hhdCcsICdhdXRvY29tcGxldGUnLCAncGFydHMnLCAndmFsdWUnXS5mb3JFYWNoKHByb3AgPT4ge1xuICAgICAgICAgICAgaWYgKGNvbHVtbi5oYXNPd25Qcm9wZXJ0eShwcm9wKSkgdGguZGF0YXNldFtwcm9wXSA9IGNvbHVtbltwcm9wXTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICB0aC5kYXRhc2V0LnNvcnRhYmxlID0gKGNvbHVtbi5zb3J0YWJsZSkgPyB0cnVlIDogZmFsc2U7XG4gICAgICAgICAgdHIuYXBwZW5kQ2hpbGQodGgpO1xuICAgICAgICAgIHRoaXMuZ3JpZC5hY3RpdmUucHVzaChpbmRleCk7XG4gICAgICAgIH0gZWxzZSB0aGlzLmdyaWQuaGlkZGVuLnB1c2goaW5kZXgpO1xuXG4gICAgICB9KTtcblxuXG4gICAgICB0aGVhZC5hcHBlbmRDaGlsZCh0cik7XG4gICAgICBjb25zdCBkYXRhbGFzdHVzZWQgPSAodGhpcy5wYXJhbXMubGFzdHVzZWQgJiYgdGhpcy5wYXJhbXMubGFzdHVzZWQubGVuZ3RoID4gMCkgPyBbXSA6IG51bGw7XG4gICAgICAvLyNUT0RPIGxhc3R1c2VkIHJlb3JkZXJcbiAgICAgIGlmIChpc2pzb24pIHtcbiAgICAgICAgdGhpcy5ncmlkLmRhdGEgPSBbXTtcbiAgICAgICAgdGFibGVkZWYuZGF0YS5mb3JFYWNoKChkYXRhLCBpKSA9PiB7XG4gICAgICAgICAgY29uc3Qgcm93ID0gW107XG4gICAgICAgICAgbGV0IGogPSAwO1xuICAgICAgICAgIE9iamVjdC5lbnRyaWVzKHRhYmxlZGVmLmNvbHVtbnMpLmZvckVhY2goKFtrZXksIGNvbHVtbl0sIGkpID0+IHtcbiAgICAgICAgICAgIGlmICghY29sdW1uLmhhc093blByb3BlcnR5KCdlbXB0eWRhdGEnKSkge1xuICAgICAgICAgICAgICBpZiAoZGF0YS5oYXNPd25Qcm9wZXJ0eShrZXkpKSByb3dbal0gPSBkYXRhW2tleV07XG4gICAgICAgICAgICAgIGVsc2UgaWYgKGNvbHVtbi5maWVsZCAmJiBkYXRhLmhhc093blByb3BlcnR5KGNvbHVtbi5maWVsZCkpIHJvd1tqXSA9IGRhdGFbY29sdW1uLmZpZWxkXTtcbiAgICAgICAgICAgICAgZWxzZSByb3dbal0gPSBudWxsO1xuICAgICAgICAgICAgICBqKys7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgdGhpcy5ncmlkLmRhdGEucHVzaChyb3cpO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB0aGlzLmdyaWQuZGF0YSA9IHRhYmxlZGVmLmRhdGE7XG5cbiAgICAgIGNvbnN0IHRmb290ID0gdGhpcy5kb20udEZvb3Q7XG4gICAgICBpZiAodGhpcy5ncmlkLmFjdGl2ZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgdGJvZHkuaW5uZXJIVE1MID0gYDx0cj48dGQ+JHt0aGlzLmxhYmVscy5ub1Jvd3N9PC90ZDwvdHI+YDtcbiAgICAgICAgaWYgKHRmb290KSB0Zm9vdC5yZW1vdmUoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfSBlbHNlIGlmICh0Zm9vdCAmJiB0Zm9vdC5xdWVyeVNlbGVjdG9yKCd0cicpKSB7XG4gICAgICAgIGNvbnN0IHRmID0gdGZvb3QucXVlcnlTZWxlY3RvcigndHInKS5jaGlsZE5vZGVzO1xuICAgICAgICB0aGlzLmdyaWQuaGlkZGVuLmZvckVhY2goaSA9PiB7XG4gICAgICAgICAgdGZbaV0ucmVtb3ZlKCk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcblxuICAgICAgdGhpcy5yZW5kZXJUYm9keSh0Ym9keSk7XG4gICAgfVxuICB9XG5cbiAgdGFibGVUb0RhdGEoKSB7XG4gICAgaWYgKCF0aGlzLmRvbS5xdWVyeVNlbGVjdG9yKCd0aGVhZCcpKSByZXR1cm47XG4gICAgY29uc3QgZGF0YWxhc3R1c2VkID0gKHRoaXMucGFyYW1zLmxhc3R1c2VkICYmIHRoaXMucGFyYW1zLmxhc3R1c2VkLmxlbmd0aCA+IDApID8gW10gOiBudWxsO1xuICAgIHRoaXMuZG9tLmNsYXNzTGlzdC5hZGQodGFibGVjc3MuaGlkZSk7XG4gICAgY29uc3QgY2VsbF90b19vYmogPSAoY2VsbCkgPT4ge1xuICAgICAgY29uc3Qgb2JqID0ge1xuICAgICAgICBkYXRhOiBjZWxsLmlubmVyVGV4dCxcbiAgICAgIH1cbiAgICAgIGlmIChjZWxsLmlubmVyVGV4dCAhPT0gY2VsbC5pbm5lckhUTUwpIG9iai5odG1sID0gY2VsbC5pbm5lckhUTUw7XG4gICAgICByZXR1cm4gb2JqO1xuICAgIH1cbiAgICBjb25zdCB0aHMgPSAodGhpcy5kb20ucXVlcnlTZWxlY3RvckFsbCgndGhlYWQgdHIgdGgnKS5sZW5ndGgpID8gdGhpcy5kb20ucXVlcnlTZWxlY3RvckFsbCgndGhlYWQgdHIgdGgnKSA6IHRoaXMuZG9tLnF1ZXJ5U2VsZWN0b3JBbGwoJ3RoZWFkIHRyIHRkJyk7XG4gICAgY29uc3QgdHJzID0gdGhpcy5kb20ucXVlcnlTZWxlY3RvckFsbCgndGJvZHkgdHInKTtcbiAgICBsZXQgYWN0aXZlID0gMCxcbiAgICAgIGhpZGRlbiA9IDA7XG5cbiAgICBmdW5jdGlvbiBmaW5kX2xhYmVsKHRoKSB7XG4gICAgICBpZiAodGguY2hpbGROb2Rlcy5sZW5ndGgpIHJldHVybiBmaW5kX2xhYmVsKHRoLmNoaWxkTm9kZXNbMF0pO1xuICAgICAgZWxzZSByZXR1cm4gdGguaW5uZXJUZXh0O1xuICAgIH1cbiAgICB0aHMuZm9yRWFjaCgodGgsIGluZGV4KSA9PiB7XG4gICAgICBjb25zdCBjb2wgPSBPYmplY3QuYXNzaWduKHt9LCB0aC5kYXRhc2V0KTtcbiAgICAgIGlmIChjb2wubWFzaykgdGguY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7XG4gICAgICBpZiAoY29sLmhpZGRlbiAmJiBzdHJpbmdfdG9fYm9vbGVhbihjb2wuaGlkZGVuKSkge1xuICAgICAgICBjb2wuaGlkZGVuID0gdHJ1ZTtcbiAgICAgICAgdGgucmVtb3ZlKCk7XG4gICAgICB9XG4gICAgICBjb2wubGFiZWwgPSBmaW5kX2xhYmVsKHRoKTtcbiAgICAgIGlmIChjb2wudHlwZSkge1xuICAgICAgICBjb2wuZm9ybWF0ID0gY29sLnR5cGU7XG4gICAgICAgIGRlbGV0ZSBjb2wudHlwZTtcbiAgICAgIH1cbiAgICAgIGNvbC5pbmRleCA9IGluZGV4O1xuICAgICAgaWYgKGNvbC5oaWRkZW4pIHRoaXMuZ3JpZC5oaWRkZW4ucHVzaChpbmRleCk7XG4gICAgICBlbHNlIHRoaXMuZ3JpZC5hY3RpdmUucHVzaChpbmRleCk7XG4gICAgICB0aGlzLmdyaWQuY29sdW1ucy5wdXNoKGNvbCk7XG4gICAgfSk7XG4gICAgY29uc3QgY2VsbGlkID0gdGhpcy5nZXRDZWxsSWQodGhpcy5jZWxsaWRuYW1lKTtcbiAgICB0cnMuZm9yRWFjaCgodHIsIGkpID0+IHtcbiAgICAgIGlmIChjZWxsaWQgPCAwKSB0ci5kYXRhc2V0W3RoaXMuY2VsbGlkbmFtZV0gPSBpO1xuICAgICAgZWxzZSBpZiAoaSA9PT0gY2VsbGlkKSB0ci5kYXRhc2V0W3RoaXMuY2VsbGlkbmFtZV0gPSB0aGlzLmdldENlbGxEYXRhKGksIHRoaXMuY2VsbGlkbmFtZSwgY2VsbGlkKTtcbiAgICAgIGNvbnN0IGRhdGEgPSBbXTtcbiAgICAgIHRyLnF1ZXJ5U2VsZWN0b3JBbGwoJ3RoLHRkJykuZm9yRWFjaCgodGQsIGluZGV4KSA9PiB7XG4gICAgICAgIGlmICh0aGlzLmdyaWQuY29sdW1uc1tpbmRleF0uaGFzT3duUHJvcGVydHkoJ21hc2snKSkgdGQuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7XG4gICAgICAgIGlmICh0aGlzLmdyaWQuaGlkZGVuLmluZGV4T2YoaW5kZXgpID49IDApIHRkLnJlbW92ZSgpO1xuICAgICAgICBkYXRhLnB1c2godGQuaW5uZXJUZXh0KTtcbiAgICAgIH0pO1xuICAgICAgdGhpcy5ncmlkLmRhdGEucHVzaChkYXRhKVxuICAgIH0pO1xuXG4gICAgdGhpcy5kb20ucXVlcnlTZWxlY3RvckFsbCgndGZvb3QgdHIgdGgnKS5mb3JFYWNoKCh0ZCwgaW5kZXgpID0+IHtcbiAgICAgIGlmICh0aGlzLmdyaWQuY29sdW1uc1tpbmRleF0uaGFzT3duUHJvcGVydHkoJ21hc2snKSkgdGQuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7XG4gICAgICBpZiAodGhpcy5ncmlkLmhpZGRlbi5pbmRleE9mKGluZGV4KSA+PSAwKSB0ZC5yZW1vdmUoKTtcbiAgICB9KTtcbiAgICB0aGlzLmRvbS5jbGFzc0xpc3QucmVtb3ZlKHRhYmxlY3NzLmhpZGUpO1xuICAgIHJldHVybjtcbiAgfVxuICByZW5kZXJUYm9keSh0Ym9keSkge1xuICAgIGNvbnN0IGwgPSB0aGlzLmdyaWQuZGF0YS5sZW5ndGg7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsOyBpKyspIHtcbiAgICAgIGNvbnN0IHRyID0gdGhpcy5jcmVhdGVUYWJsZVJvdyh0aGlzLmdyaWQuZGF0YVtpXSwgaSk7XG4gICAgICB0Ym9keS5hcHBlbmQodHIpO1xuICAgIH07XG5cblxuXG4gIH1cbiAgYXN5bmMgdGFibGVBY3RpdmF0ZShjb250YWluZXIsIHRhYmxlZGVmID0gbnVsbCkge1xuICAgIHRoaXMub24odGhpcy5ldmVudG5hbWVzLmluaXQsICgpID0+IHtcbiAgICAgIC8vIGhpZGUgYW5kIG1vdmUgd2FpdGRpdiBpbiB0aGUgd3JhcHBlciBmb3IgaW5uZXIgZWxlbWVudHMgZGlzcGxheVxuICAgICAgdGhpcy5kb20uY2xhc3NMaXN0LnJlbW92ZSh0YWJsZWNzcy5oaWRlKTtcbiAgICAgIHRoaXMud2FpdERlc2FjdGl2YXRlKCk7XG4gICAgICBpZiAodGhpcy5hZnRlckxvYWQpIHRoaXMuYWZ0ZXJMb2FkKCk7XG4gICAgICAvLyBtb3ZlIGltcG9ydCB6b25lcyBhbmQvb3Igc2VhcmNoIHpvbmUgLSByZW9yZyB0aGUgcGFnZSBkaXNwbGF5XG4gICAgICAvL2NvbnRhaW5lci5zdHlsZS50b3AgPSBjb250YWluZXIub2Zmc2V0VG9wICsgJ3B4JztcbiAgICAgIC8vIGZldGNoIG9uY2UgdGhlIHNhbWUgdGFibGVcbiAgICAgIGNvbnRhaW5lci5kYXRhc2V0LnRhYmxlID0gdGhpcy5wYXJhbXMudGFibGUgPSB0cnVlO1xuXG4gICAgfSk7XG4gICAgdGhpcy5vbih0aGlzLmV2ZW50bmFtZXMubG9hZCwgKCkgPT4ge1xuICAgICAgdGhpcy5pbml0U2VhcmNoKCk7XG4gICAgICB0aGlzLmluaXRTb3J0KCk7XG4gICAgICB0aGlzLmluaXRQbHVnaW5zKGNvbnRhaW5lcik7XG4gICAgICBjb25zb2xlLmxvZygncGx1Z2luIGxvYWRlZCcsIChEYXRlLm5vdygpIC0gdGhpcy5kdCkgLyAxMDAwKTtcbiAgICB9KTtcbiAgICAvLyBkaXNtaXNzIHRhYmxlIHdoZW4gZGlzbWlzcyBtb2RhbFxuICAgIHRoaXMub24odGhpcy5ldmVudG5hbWVzLmRpc21pc3MsIChlKSA9PiB7XG4gICAgICB0aGlzLmRlc3Ryb3koKTtcbiAgICB9KTtcbiAgICBpZiAodGFibGVkZWYpIHRhYmxlZGVmID0gYXdhaXQgdGhpcy5kYXRhVG9UYWJsZSh0YWJsZWRlZik7XG4gICAgZWxzZSBhd2FpdCB0aGlzLnRhYmxlVG9EYXRhKCk7XG4gICAgaWYgKHRoaXMuZ3JpZC5kYXRhLmxlbmd0aCkgdGhpcy5lbWl0KHRoaXMuZXZlbnRuYW1lcy5sb2FkKTtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHRoaXMuZW1pdCh0aGlzLmV2ZW50bmFtZXMuaW5pdCk7XG4gICAgICB0aGlzLmluaXRpYWxpemVkID0gdHJ1ZTtcbiAgICB9LCAxMClcbiAgICBpbnN0YW5jZVt0aGlzLmluc3RhbmNlaWRdID0gdGhpcztcblxuICB9XG5cbiAgdGFibGVBcHBlbmRSb3dzKHJvd3MpIHtcbiAgICBjb25zb2xlLmxvZygncm93cycpO1xuICB9XG4gIGRlc3Ryb3koKSB7XG4gICAgaWYgKHRoaXMuZGF0YUltcG9ydCkgdGhpcy5kYXRhSW1wb3J0ID0gbnVsbDtcbiAgICB0aGlzLmRvbSA9IG51bGw7XG4gICAgZGVsZXRlIGluc3RhbmNlW3RoaXMuaW5zdGFuY2VpZF07XG4gIH1cbiAgcmVmcmVzaChlKSB7XG4gICAgaWYgKHRoaXMuZGF0YUltcG9ydCAmJiB0aGlzLmRhdGFJbXBvcnQuc2VsZWN0b3JzKSB0aGlzLmRhdGFJbXBvcnQuc2VsZWN0b3JzLmZvckVhY2goc2VsZWN0b3IgPT4ge1xuICAgICAgaWYgKHRoaXMuZGlzYWJsZWQpIHRoaXMuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICB9KTtcbiAgfVxuICBsYWJlbEZvcm1hdHRlcihjb2x1bW4pIHtcbiAgICBsZXQgYWxpZ24gPSBgYDtcbiAgICBpZiAoWydudW1iZXInLCAncHJvZ3Jlc3MnLCAnZGVjaW1hbCddLmZpbmQoZm9ybWF0ID0+IGZvcm1hdCA9PT0gY29sdW1uLmZvcm1hdCkpIGFsaWduID0gY3NzLnJpZ2h0O1xuICAgIGlmIChjb2x1bW4uc3ViZmllbGQpIHJldHVybiBgJHtjb2x1bW4ubGFiZWx9IDxzcGFuIGNsYXNzPVwic3VibGFiZWxcIj4ke2NvbHVtbi5zdWJsYWJlbH08L3NwYW4+YDtcbiAgICBlbHNlIGlmIChjb2x1bW4ubGFiZWwpIHJldHVybiBgPHNwYW4gY2xhc3M9XCIke2FsaWdufVwiPiR7Y29sdW1uLmxhYmVsfTwvc3Bhbj5gO1xuICAgIGVsc2UgcmV0dXJuIGBgO1xuICB9XG4gIGdldENlbGxJZChuYW1lLCBzdGF0ZSA9IG51bGwpIHtcbiAgICBsZXQgY29scyA9IHRoaXMuZ3JpZC5jb2x1bW5zLmZpbHRlcihjb2x1bW4gPT4gKGNvbHVtbi5uYW1lID09PSBuYW1lKSk7XG4gICAgcmV0dXJuIChjb2xzLmxlbmd0aCkgPyBjb2xzWzBdLmluZGV4IDogLTE7XG4gIH1cblxuICBnZXRDZWxsRGF0YShyb3dJbmRleCwgbmFtZSwgY2VsbEluZGV4ID0gbnVsbCkge1xuICAgIGNlbGxJbmRleCA9IChjZWxsSW5kZXggPT09IG51bGwpID8gdGhpcy5nZXRDZWxsSWQobmFtZSkgOiBjZWxsSW5kZXg7XG4gICAgaWYgKGNlbGxJbmRleCA8IDApIHJldHVybiBudWxsO1xuICAgIHJldHVybiAodGhpcy5ncmlkLmRhdGEubGVuZ3RoKSA/ICgodGhpcy5ncmlkLmRhdGFbcm93SW5kZXhdKSA/IHRoaXMuZ3JpZC5kYXRhW3Jvd0luZGV4XVtjZWxsSW5kZXhdIDogbnVsbCkgOiBudWxsO1xuICB9XG5cbiAgcm93QXR0cmlidXRlcyh0ciwgaW5kZXgpIHtcbiAgICBjb25zdCBpZCA9IHRoaXMuZ2V0Q2VsbERhdGEoaW5kZXgsIHRoaXMuY2VsbGlkbmFtZSk7XG4gICAgdHIuZGF0YXNldFt0aGlzLmNlbGxpZG5hbWVdID0gaWQ7XG4gICAgaWYgKHRoaXMuc2V0Um93QXR0cmlidXRlcykgdHIgPSB0aGlzLnNldFJvd0F0dHJpYnV0ZXModGhpcywgdHIsIGlkKTtcbiAgICByZXR1cm4gdHI7XG4gIH1cblxuICBjcmVhdGVUYWJsZVJvdyhyb3csIGluZGV4LCBpc2hlYWRlciA9IGZhbHNlKSB7XG4gICAgY29uc3QgdHIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpO1xuICAgIGxldCB0ZDtcbiAgICB0aGlzLmdyaWQuY29sdW1ucy5mb3JFYWNoKGNvbHVtbiA9PiB7XG4gICAgICBpZiAoY29sdW1uLmhhc093blByb3BlcnR5KCdoaWRkZW4nKSAmJiBjb2x1bW4uaGlkZGVuID09PSB0cnVlKSByZXR1cm47XG4gICAgICBjb25zdCBjZWxsID0gcm93W2NvbHVtbi5pbmRleF07XG4gICAgICBpZiAoY29sdW1uLmhhc093blByb3BlcnR5KFwicmVuZGVyXCIpKSB7XG4gICAgICAgIHRkID0gY29sdW1uLnJlbmRlcihjZWxsLCBpbmRleCwgY29sdW1uLmluZGV4KTtcbiAgICAgICAgdGQubm9kZW5hbWUgPSAoaXNoZWFkZXIpID8gJ1RIJyA6ICdURCc7XG4gICAgICAgIHRkID0gdGhpcy5vYmpUb0VsZW1lbnQodGQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGQgPSAoaXNoZWFkZXIpID8gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGgnKSA6IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG4gICAgICAgIHRkLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGNlbGwpKTtcbiAgICAgIH1cbiAgICAgIHRyLmFwcGVuZENoaWxkKHRkKTtcbiAgICB9KVxuICAgIHJldHVybiB0aGlzLnJvd0F0dHJpYnV0ZXModHIsIGluZGV4KTtcbiAgfVxuXG4gIG9ialRvRWxlbWVudChvYmopIHtcbiAgICBpZiAob2JqLm5vZGVuYW1lID09PSBcIiN0ZXh0XCIpIHJldHVybiBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShvYmouZGF0YSk7XG4gICAgY29uc3QgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KG9iai5ub2RlbmFtZSk7XG4gICAgaWYgKG9iai5oYXNPd25Qcm9wZXJ0eShcImh0bWxcIikpIGVsLmlubmVySFRNTCA9IG9iai5odG1sO1xuICAgIGVsc2UgZWwudGV4dENvbnRlbnQgPSBvYmouZGF0YTtcbiAgICBpZiAob2JqLmhhc093blByb3BlcnR5KFwiYXR0cmlidXRlc1wiKSkge1xuICAgICAgZm9yIChjb25zdCBhdHRyIGluIG9iai5hdHRyaWJ1dGVzKSB7XG4gICAgICAgIGVsLnNldEF0dHJpYnV0ZShhdHRyLCBvYmouYXR0cmlidXRlc1thdHRyXSk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChvYmouaGFzT3duUHJvcGVydHkoXCJjaGlsZG5vZGVzXCIpKSB7XG4gICAgICBvYmouY2hpbGRub2Rlcy5mb3JFYWNoKGNoaWxkbm9kZSA9PiB7XG5cbiAgICAgICAgZWwuYXBwZW5kQ2hpbGQodGhpcy5vYmpUb0VsZW1lbnQoY2hpbGRub2RlKSk7XG4gICAgICB9KTtcblxuICAgIH1cbiAgICByZXR1cm4gZWw7XG4gIH1cblxuICBzZXRUZXh0Tm9kZSh2YWx1ZSkge1xuICAgIHJldHVybiB7XG4gICAgICBub2RlbmFtZTogXCIjdGV4dFwiLFxuICAgICAgZGF0YTogdmFsdWVcbiAgICB9O1xuICB9XG4gIGFzeW5jIGdldEZvcm1hdHRlcnMoKSB7XG4gICAgbGV0IGZvcm1hdHRlcnMgPSB7XG4gICAgICBjb250cm9sczogKHZhbHVlLCByb3dJbmRleCwgY2VsbEluZGV4LCB0ZCA9IHt9KSA9PiB7XG4gICAgICAgIGNvbnN0IGNvbHVtbiA9IHRoaXMuZ3JpZC5jb2x1bW5zW2NlbGxJbmRleF07XG4gICAgICAgIGNvbnN0IGlkID0gdGhpcy5nZXRDZWxsRGF0YShyb3dJbmRleCwgY29sdW1uLmZpZWxkKTtcbiAgICAgICAgY29uc3QgYWN0aW9ucyA9IChjb2x1bW4uYWN0aW9ucykgPyBjb2x1bW4uYWN0aW9ucyA6IG51bGw7XG4gICAgICAgIGlmICghYWN0aW9ucykgcmV0dXJuIGBgO1xuICAgICAgICBsZXQgY29udHJvbHMgPSBbXTtcbiAgICAgICAgT2JqZWN0LmVudHJpZXMoYWN0aW9ucykuZm9yRWFjaCgoW2tleSwgYWN0aW9uXSkgPT4ge1xuICAgICAgICAgIGNvbnRyb2xzLnB1c2goe1xuICAgICAgICAgICAgbm9kZW5hbWU6IFwiQVwiLFxuICAgICAgICAgICAgYXR0cmlidXRlczoge1xuICAgICAgICAgICAgICBjbGFzczogYGJ0biBpcy0ke2tleX0gYCxcbiAgICAgICAgICAgICAgaHJlZjogYCR7YWN0aW9uLmxpbmt9JHtpZH1gXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY2hpbGRub2RlczogW3RoaXMuc2V0VGV4dE5vZGUoYWN0aW9uLmxhYmVsKV1cbiAgICAgICAgICB9KTtcblxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKCF0ZC5oYXNPd25Qcm9wZXJ0eSgnYXR0cmlidXRlcycpKSB0ZC5hdHRyaWJ1dGVzID0ge307XG4gICAgICAgIHRkLmF0dHJpYnV0ZXMuY2xhc3MgPSBjc3MuY29tcG9uZW50LnRhYmxlLmNvbnRyb2xzO1xuICAgICAgICB0ZC5jaGlsZG5vZGVzID0gY29udHJvbHM7XG4gICAgICAgIHJldHVybiB0ZDtcbiAgICAgIH0sXG4gICAgICBzZWxlY3Q6ICh2YWx1ZSwgcm93SW5kZXgsIGNlbGxJbmRleCwgdGQgPSB7fSkgPT4ge1xuICAgICAgICBjb25zdCBjb2x1bW4gPSB0aGlzLmdyaWQuY29sdW1uc1tjZWxsSW5kZXhdO1xuICAgICAgICB2YWx1ZSA9IChpc05hTih2YWx1ZSkpID8gdGhpcy5nZXRDZWxsRGF0YShyb3dJbmRleCwgY29sdW1uLmZpZWxkKSA6IHZhbHVlO1xuXG4gICAgICAgIHRkLmNoaWxkbm9kZXMgPSBbe1xuICAgICAgICAgIG5vZGVuYW1lOiBcIklOUFVUXCIsXG4gICAgICAgICAgYXR0cmlidXRlczoge1xuICAgICAgICAgICAgdHlwZTogXCJyYWRpb1wiLFxuICAgICAgICAgICAgbmFtZTogYCR7dGhpcy5pbnN0YW5jZWlkfXNlbGVjdGAsXG4gICAgICAgICAgICB2YWx1ZTogU3RyaW5nKHZhbHVlKVxuICAgICAgICAgIH1cbiAgICAgICAgfV07XG4gICAgICAgIHJldHVybiB0ZDtcbiAgICAgIH0sXG4gICAgICBzZWxlY3RtdWx0aXBsZTogKHZhbHVlLCByb3dJbmRleCwgY2VsbEluZGV4LCB0ZCA9IHt9KSA9PiB7XG4gICAgICAgIGNvbnN0IGNvbHVtbiA9IHRoaXMuZ3JpZC5jb2x1bW5zW2NlbGxJbmRleF07XG4gICAgICAgIHZhbHVlID0gKGlzTmFOKHZhbHVlKSkgPyAoKGNvbHVtbi5oYXNPd25Qcm9wZXJ0eSgnZmllbGQnKSkgPyB0aGlzLmdldENlbGxEYXRhKHJvd0luZGV4LCBjb2x1bW4uZmllbGQpIDogdmFsdWUpIDogdmFsdWU7XG4gICAgICAgIHRkLmNoaWxkbm9kZXMgPSBbe1xuICAgICAgICAgIG5vZGVuYW1lOiBcIklOUFVUXCIsXG4gICAgICAgICAgYXR0cmlidXRlczoge1xuICAgICAgICAgICAgdHlwZTogXCJjaGVja2JveFwiLFxuICAgICAgICAgICAgbmFtZTogYCR7dGhpcy5pbnN0YW5jZWlkfXNlbGVjdFtdYCxcbiAgICAgICAgICAgIHZhbHVlOiBTdHJpbmcodmFsdWUpXG4gICAgICAgICAgfVxuICAgICAgICB9XTtcbiAgICAgICAgcmV0dXJuIHRkO1xuICAgICAgfSxcbiAgICAgIGRlY2ltYWw6ICh2YWx1ZSwgcm93SW5kZXgsIGNlbGxJbmRleCwgdGQgPSB7fSkgPT4ge1xuICAgICAgICBpZiAoaXNOYU4odmFsdWUpKSB2YWx1ZSA9IDA7XG4gICAgICAgIHZhbHVlID0gcGFyc2VGbG9hdCh2YWx1ZSkudG9GaXhlZCgyKTtcbiAgICAgICAgaWYgKHZhbHVlIC0gcGFyc2VJbnQodmFsdWUpID09PSAwKSB2YWx1ZSA9IHBhcnNlSW50KHZhbHVlKTtcbiAgICAgICAgaWYgKCF0ZC5oYXNPd25Qcm9wZXJ0eSgnYXR0cmlidXRlcycpKSB0ZC5hdHRyaWJ1dGVzID0ge307XG4gICAgICAgIHRkLmF0dHJpYnV0ZXMuY2xhc3MgPSBjc3MubnVtYmVyO1xuICAgICAgICB0ZC5jaGlsZG5vZGVzID0gW3RoaXMuc2V0VGV4dE5vZGUodmFsdWUpXTtcbiAgICAgICAgcmV0dXJuIHRkO1xuICAgICAgfSxcbiAgICAgIG51bWJlcjogKHZhbHVlLCByb3dJbmRleCwgY2VsbEluZGV4LCB0ZCA9IHt9KSA9PiB7XG4gICAgICAgIGlmIChpc05hTih2YWx1ZSkpIHZhbHVlID0gMDtcbiAgICAgICAgaWYgKCF0ZC5oYXNPd25Qcm9wZXJ0eSgnYXR0cmlidXRlcycpKSB0ZC5hdHRyaWJ1dGVzID0ge307XG4gICAgICAgIHRkLmF0dHJpYnV0ZXMuY2xhc3MgPSBjc3MubnVtYmVyO1xuICAgICAgICB0ZC5jaGlsZG5vZGVzID0gW3RoaXMuc2V0VGV4dE5vZGUodmFsdWUpXTtcbiAgICAgICAgcmV0dXJuIHRkO1xuICAgICAgfSxcbiAgICAgIGNoZWNrOiAodmFsdWUsIHJvd0luZGV4LCBjZWxsSW5kZXgsIHRkID0ge30pID0+IHtcbiAgICAgICAgaWYgKGlzTmFOKHZhbHVlKSkgdmFsdWUgPSBgYDtcbiAgICAgICAgc3dpdGNoICh2YWx1ZSkge1xuICAgICAgICAgIGNhc2UgdHJ1ZTpcbiAgICAgICAgICBjYXNlICdZJzpcbiAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICB2YWx1ZSA9IFwiXCI7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgdmFsdWUgPSBcIm5vLVwiO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaWNvbiA9IHtcbiAgICAgICAgICBub2RlbmFtZTogXCJJXCIsXG4gICAgICAgICAgYXR0cmlidXRlczoge1xuICAgICAgICAgICAgY2xhc3M6IGBpY29uLXNtICBpY29uLSR7dmFsdWV9Y2hlY2sgYFxuICAgICAgICAgIH0sXG4gICAgICAgICAgY2hpbGRub2RlczogW11cbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb2x1bW4gPSB0aGlzLmdyaWQuY29sdW1uc1tjZWxsSW5kZXhdO1xuICAgICAgICBjb25zdCBpZCA9IHRoaXMuZ2V0Q2VsbERhdGEocm93SW5kZXgsIHRoaXMuY2VsbGlkbmFtZSk7XG4gICAgICAgIGlmIChjb2x1bW4uaGFzT3duUHJvcGVydHkoXCJ0b2dnbGVcIikpIHRkLmNoaWxkbm9kZXMgPSBbe1xuICAgICAgICAgIG5vZGVuYW1lOiBcIkFcIixcbiAgICAgICAgICBhdHRyaWJ1dGVzOiB7XG4gICAgICAgICAgICBcImRhdGEtcmVxdWVzdFwiOiBcInRvZ2dsZVwiLFxuICAgICAgICAgICAgXCJkYXRhLWFjdGlvblwiOiBgJHtjb2x1bW4udG9nZ2xlLmxpbmt9LyR7aWR9YCxcbiAgICAgICAgICAgIFwiaHJlZlwiOiBcImphdmFzY3JpcHQ6dm9pZCgpXCJcblxuICAgICAgICAgIH0sXG4gICAgICAgICAgY2hpbGRub2RlczogW2ljb25dXG5cbiAgICAgICAgfV1cbiAgICAgICAgZWxzZSB0ZC5jaGlsZG5vZGVzID0gW2ljb25dO1xuICAgICAgICByZXR1cm4gdGQ7XG4gICAgICB9LFxuICAgICAgdGV4dDogKHZhbHVlLCByb3dJbmRleCwgY2VsbEluZGV4LCB0ZCA9IHt9KSA9PiB7XG4gICAgICAgIGlmICh2YWx1ZSA9PT0gbnVsbCkgdGQuY2hpbGRub2RlcyA9IFtdO1xuICAgICAgICBlbHNlIHtcbiAgICAgICAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2VBbGwoJ1xcclxcbicsICcsICcpO1xuICAgICAgICAgIGlmICh2YWx1ZSAhPT0gYGApIHRkLmNoaWxkbm9kZXMgPSBbe1xuICAgICAgICAgICAgbm9kZW5hbWU6IFwiRElWXCIsXG4gICAgICAgICAgICBhdHRyaWJ1dGVzOiB7XG4gICAgICAgICAgICAgIGNsYXNzOiBjc3MuY29tcG9uZW50LnRhYmxlLnRpcFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNoaWxkbm9kZXM6IFt0aGlzLnNldFRleHROb2RlKHZhbHVlKV1cbiAgICAgICAgICB9XTtcbiAgICAgICAgICBlbHNlIHRkLmNoaWxkbm9kZXMgPSBbXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGQ7XG4gICAgICB9LFxuICAgICAgZGVmYXVsdDogKHZhbHVlLCByb3dJbmRleCwgY2VsbEluZGV4LCB0ZCA9IHt9KSA9PiB7XG4gICAgICAgIGlmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gYGApIHRkLmNoaWxkbm9kZXMgPSBbXTtcbiAgICAgICAgZWxzZSB0ZC5jaGlsZG5vZGVzID0gW3RoaXMuc2V0VGV4dE5vZGUodmFsdWUpXTtcbiAgICAgICAgcmV0dXJuIHRkO1xuICAgICAgfVxuXG4gICAgfVxuICAgIGxldCB0YWJsZWN1c3RvbSA9IG51bGw7XG5cbiAgICBzd2l0Y2ggKHRoaXMucGFyYW1zLmZyb20pIHtcbiAgICAgIGNhc2UgJ2NvbGxlY3Rpb25saXN0JzpcbiAgICAgICAgdGFibGVjdXN0b20gPSBhd2FpdCBpbXBvcnQoJy4uL21vZHVsZXMvdGFibGUtY29sbGVjdGlvbi5qcycpO1xuICAgICAgICB0aGlzLmNlbGxpZG5hbWUgPSBtb2RlbHMuaWQ7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAncHJqbGlzdCc6XG4gICAgICAgIHRhYmxlY3VzdG9tID0gYXdhaXQgaW1wb3J0KCcuLi9tb2R1bGVzL3RhYmxlLXByb2plY3QuanMnKTtcbiAgICAgICAgdGhpcy5jZWxsaWRuYW1lID0gbW9kZWxzLnByb2ppZDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdwcmpzYW1wbGVzdGF0cyc6XG4gICAgICAgIHRhYmxlY3VzdG9tID0gYXdhaXQgaW1wb3J0KCcuLi9tb2R1bGVzL3RhYmxlLXNhbXBsZS5qcycpO1xuICAgICAgICB0aGlzLmNlbGxpZG5hbWUgPSBtb2RlbHMuc2FtcGxlaWQ7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcInByanByZWRpY3RcIjpcbiAgICAgICAgdGFibGVjdXN0b20gPSBhd2FpdCBpbXBvcnQoJy4uL21vZHVsZXMvdGFibGUtcHJlZGljdGlvbi5qcycpO1xuICAgICAgICB0aGlzLmNlbGxpZG5hbWUgPSBtb2RlbHMucHJvamlkO1xuXG4gICAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIHJldHVybiAodGFibGVjdXN0b20pID8geyAuLi5mb3JtYXR0ZXJzLFxuICAgICAgLi4udGFibGVjdXN0b20uZGVmYXVsdCh0aGlzKVxuICAgIH0gOiBmb3JtYXR0ZXJzO1xuXG5cbiAgfVxuICBhc3luYyBjb252ZXJ0Q29sdW1ucyh0YWJsZWRlZikge1xuICAgIGNvbnN0IGNvbHVtbnMgPSAodGFibGVkZWYuY29sdW1ucykgPyB0YWJsZWRlZi5jb2x1bW5zIDogKCh0aGlzLnBhcmFtcy5jb2x1bW5zKSA/IEpTT04ucGFyc2UodGhpcy5wYXJhbXMuY29sdW1ucykgOiBudWxsKTtcbiAgICBpZiAoIWNvbHVtbnMpIHJldHVybjtcbiAgICBjb25zdCBmb3JtYXR0ZXJzID0gYXdhaXQgdGhpcy5nZXRGb3JtYXR0ZXJzKCk7XG4gICAgLy9cbiAgICBjb25zdCBmaWVsZHMgPSBbXTtcbiAgICBPYmplY3QuZW50cmllcyh0YWJsZWRlZi5jb2x1bW5zKS5mb3JFYWNoKChba2V5LCBjb2x1bW5dKSA9PiB7XG4gICAgICBpZiAoIWNvbHVtbi5oYXNPd25Qcm9wZXJ0eSgnZW1wdHlkYXRhJykpIGZpZWxkcy5wdXNoKGtleSk7XG4gICAgfSk7XG4gICAgY29uc3QgbWFwX2NvbHVtbiA9IChrZXksIGNvbHVtbiwgaW5kZXgpID0+IHtcbiAgICAgIGlmICghY29sdW1uKSByZXR1cm4ge1xuICAgICAgICBpbmRleDogaW5kZXgsXG4gICAgICAgIG5hbWU6IGtleSxcbiAgICAgICAgaGlkZGVuOiB0cnVlXG4gICAgICB9O1xuICAgICAgbGV0IGNvbCA9IHtcbiAgICAgICAgaW5kZXg6IGluZGV4LFxuICAgICAgICBuYW1lOiBrZXksXG4gICAgICAgIGxhYmVsOiB0aGlzLmxhYmVsRm9ybWF0dGVyKGNvbHVtbiksXG4gICAgICAgIHNvcnRhYmxlOiB0cnVlLFxuXG4gICAgICB9O1xuICAgICAgY29sLmluZGV4ID0gKGNvbHVtbi5oYXNPd25Qcm9wZXJ0eSgnZW1wdHlkYXRhJykpID8gZmllbGRzLmluZGV4T2YoY29sdW1uLmVtcHR5ZGF0YSkgOiBmaWVsZHMuaW5kZXhPZihrZXkpO1xuICAgICAgaWYgKGNvbHVtbi5ub3Rzb3J0YWJsZSkgY29sLnNvcnRhYmxlID0gZmFsc2U7XG4gICAgICBlbHNlIGlmIChjb2x1bW4uc29ydGFibGUpIGNvbC5zb3J0ID0gY29sLnNvcnRhYmxlO1xuICAgICAgY29sLnNlYXJjaGFibGUgPSAoY29sLm5vdHNlYXJjaGFibGUpID8gZmFsc2UgOiB0cnVlO1xuICAgICAgaWYgKGNvbHVtbi5oaWRkZW4pIGNvbC5oaWRkZW4gPSBzdHJpbmdfdG9fYm9vbGVhbihjb2x1bW4uaGlkZGVuKTtcbiAgICAgIGlmIChbJ251bWJlcicsICdkZWNpbWFsJ10uZmluZChmb3JtYXQgPT4gZm9ybWF0ID09PSBjb2x1bW4uZm9ybWF0KSkgY29sLnR5cGUgPSAnbnVtYmVyJztcbiAgICAgIGxldCByZW5kZXIgPSBudWxsO1xuICAgICAgc3dpdGNoIChrZXkpIHtcbiAgICAgICAgY2FzZSAnc2VsZWN0JzpcbiAgICAgICAgICBjb25zdCBzZWxlY3QgPSAoY29sdW1uLnNlbGVjdCAmJiBjb2x1bW4uc2VsZWN0ID09IFwiY29udHJvbHNcIikgPyBcImNvbnRyb2xzXCIgOiAoKGNvbHVtbi5zZWxlY3RjZWxscykgPyBcImltcG9ydHNcIiA6IGNvbHVtbi5zZWxlY3QpO1xuICAgICAgICAgIGlmIChzZWxlY3QpIHtcbiAgICAgICAgICAgIGNvbCA9IHsgLi4uY29sdW1uLFxuICAgICAgICAgICAgICAuLi5jb2xcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29sLnNvcnRhYmxlID0gY29sLnNlYXJjaGFibGUgPSBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBpZiAoIWNvbHVtbi5oYXNPd25Qcm9wZXJ0eSgnaGlkZGVuJykpIHtcbiAgICAgICAgY29uc3Qgc2VsZWN0ID0gKGNvbHVtbi5zZWxlY3QgJiYgY29sdW1uLnNlbGVjdCA9PSBtb2RlbHMuY29udHJvbHMpID8gbW9kZWxzLmNvbnRyb2xzIDogKChjb2x1bW4uc2VsZWN0Y2VsbHMpID8gbW9kZWxzLmltcG9ydHMgOiBjb2x1bW4uc2VsZWN0KVxuICAgICAgICBjb25zdCBmb3JtYXQgPSAoY29sdW1uLmZvcm1hdCkgPyBjb2x1bW4uZm9ybWF0IDogKChjb2x1bW4uc3ViZmllbGQpID8gY29sdW1uLnN1YmZpZWxkIDogKChzZWxlY3QpID8gc2VsZWN0IDogXCJkZWZhdWx0XCIpKTtcbiAgICAgICAgaWYgKGZvcm1hdHRlcnMgJiYgZm9ybWF0dGVyc1tmb3JtYXRdKSBjb2wucmVuZGVyID0gZm9ybWF0dGVyc1tmb3JtYXRdO1xuXG4gICAgICB9XG4gICAgICByZXR1cm4gY29sO1xuICAgIH1cblxuICAgIHRoaXMuZ3JpZC5jb2x1bW5zID0gT2JqZWN0LmVudHJpZXMoY29sdW1ucykubWFwKChba2V5LCBjb2x1bW5dLCBpbmRleCkgPT4gbWFwX2NvbHVtbihrZXksIGNvbHVtbiwgaW5kZXgpKTtcbiAgfVxuICBpbml0RXZlbnRzKCkge1xuICAgIHRoaXMub24odGhpcy5ldmVudG5hbWVzLnVwZGF0ZSwgKCkgPT4ge1xuICAgICAgaWYgKHRoaXMuZG9tLmNsYXNzTGlzdC5jb250YWlucyh0YWJsZWNzcy5oaWRlKSkgdGhpcy5kb20uY2xhc3NMaXN0LnJlbW92ZSh0YWJsZWNzcy5oaWRlKTtcblxuICAgIH0pO1xuICB9XG4gIGluaXRQbHVnaW5zKGNvbnRhaW5lcikge1xuICAgIGlmICghdGhpcy5ncmlkLmRhdGEubGVuZ3RoKSByZXR1cm47XG4gICAgaWYgKHRoaXMucGFyYW1zLmltcG9ydCAmJiB0aGlzLmluaXRJbXBvcnQpIHRoaXMuaW5pdEltcG9ydCh0aGlzKTtcbiAgICBpZiAodGhpcy5wYXJhbXMuZXhwYW5kKSB0aGlzLm1ha2VFeHBhbmRhYmxlKGNvbnRhaW5lcik7XG4gICAgaWYgKHRoaXMucGFyYW1zLmV4cG9ydCkgdGhpcy5tYWtlRXhwb3J0YWJsZShjb250YWluZXIpO1xuICAgIGlmICh0aGlzLnBhcmFtcy5kZXRhaWxzIHx8IHRoaXMuZG9tLnF1ZXJ5U2VsZWN0b3IodGFibGVzZWxlY3RvcnMuZGV0YWlscykpIHRoaXMuaW5pdERldGFpbHMoKTtcbiAgICBlbHNlIHRoaXMuaW5pdEV2ZW50cygpO1xuICAgIGlmICh0aGlzLnBhcmFtcy5vbnNlbGVjdCkgdGhpcy5pbml0U2VsZWN0KGNvbnRhaW5lcik7XG4gICAgaWYgKHRoaXMuZG9tLnF1ZXJ5U2VsZWN0b3IodGFibGVzZWxlY3RvcnMudGlwKSkgdGhpcy5pbml0VGlwcygpO1xuICAgIGlmICh0aGlzLmRvbS5xdWVyeVNlbGVjdG9yQWxsKCd0aGVhZCBbZGF0YS1hbHRzb3J0XScpLmxlbmd0aCkgdGhpcy5pbml0QWx0ZXJuYXRlU29ydCh0aGlzLmRvbS5xdWVyeVNlbGVjdG9yQWxsKCd0aGVhZCBbZGF0YS1hbHRzb3J0XScpKTtcbiAgICBpZiAodGhpcy5wYXJhbXMuZmlsdGVycykge1xuICAgICAgY29uc3QgdG9wID0gdGhpcy53cmFwcGVyLnF1ZXJ5U2VsZWN0b3IodGFibGVzZWxlY3RvcnMudG9wKTtcbiAgICAgIGlmICh0b3AgJiYgdG9wLmNoaWxkcmVuLmxlbmd0aCkge1xuICAgICAgICBjb25zdCBmaWx0ZXJzID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih0YWJsZXNlbGVjdG9ycy5maWx0ZXJzKTtcbiAgICAgICAgLy8gaW5zZXJ0ICBmaWx0ZXJzIG5vZGUgIGluIGRhdGF0YWJsZSB0b3BcbiAgICAgICAgaWYgKGZpbHRlcnMpIHRvcC5wcmVwZW5kKGZpbHRlcnMpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBpbml0U29ydCgpIHtcblxuICAgIGNvbnN0IHRocyA9IHRoaXMuZG9tLnF1ZXJ5U2VsZWN0b3JBbGwoJ3RoZWFkIHRoJyk7XG4gICAgbGV0IGluZGV4ID0gMDtcbiAgICB0aGlzLmdyaWQuY29sdW1ucy5mb3JFYWNoKChjb2x1bW4sIGkpID0+IHtcbiAgICAgIGlmIChjb2x1bW4uaGFzT3duUHJvcGVydHkoJ2hpZGRlbicpKSByZXR1cm47XG4gICAgICBpZiAoY29sdW1uLnNvcnRhYmxlKSB7XG4gICAgICAgIGNvbnN0IHRoID0gdGhzW2luZGV4XTtcbiAgICAgICAgY29uc3QgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcbiAgICAgICAgYS5jbGFzc0xpc3QuYWRkKHRhYmxlc2VsZWN0b3JzLnNvcnRlci5zdWJzdHIoMSkpO1xuICAgICAgICBhLmFwcGVuZENoaWxkKHRoLmNoaWxkTm9kZXNbMF0pO1xuICAgICAgICB0aC5hcHBlbmRDaGlsZChhKTtcbiAgICAgICAgdGguY2hpbGROb2Rlcy5mb3JFYWNoKGNoaWxkID0+IHtcbiAgICAgICAgICB0aC5hcHBlbmRDaGlsZChjaGlsZCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGEuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgaWYgKHRoaXMuc29ydGluZyA9PT0gdHJ1ZSB8fCB0aGlzLnNlYXJjaGluZyA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLnNvcnRDb2x1bW4odGgsIGNvbHVtbi5pbmRleCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgaW5kZXgrKztcbiAgICB9KTtcbiAgICB0aGlzLnNvcnRpbmcgPSBmYWxzZTtcbiAgICAvLyByZW1vdmUgZGV0YWlscyB3aGVuIHNvcnRpbmdcbiAgICB0aGlzLm9uKHRoaXMuZXZlbnRuYW1lcy5zb3J0aW5nLCAoZGlyZWN0aW9uLCBpbmRleCkgPT4ge1xuXG4gICAgICBpZiAodGhpcy5wbHVnaW5zLmhhc093blByb3BlcnR5KCdqc0RldGFpbCcpKSB0aGlzLnBsdWdpbnNbJ2pzRGV0YWlsJ10uYWN0aXZlRGV0YWlsKGZhbHNlKTtcbiAgICAgIHRoaXMuZG9tLnF1ZXJ5U2VsZWN0b3JBbGwoJy50YWJsZS1zb3J0ZXInKS5mb3JFYWNoKChhLCBpKSA9PiB7XG4gICAgICAgIGEuY2xhc3NMaXN0LmFkZCgoKGkgPT09IGluZGV4KSA/IGNzcy53YWl0IDogY3NzLmRpc2FibGVkKSk7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuc29ydGluZyA9IHRydWU7XG4gICAgfSk7XG4gICAgLy8gcmVtb3ZlIGRldGFpbHMgd2hlbiBzb3J0aW5nXG4gICAgdGhpcy5vbih0aGlzLmV2ZW50bmFtZXMuc29ydGVkLCAoZGlyZWN0aW9uLCBpbmRleCkgPT4ge1xuICAgICAgdGhpcy5kb20ucXVlcnlTZWxlY3RvckFsbCgnLnRhYmxlLXNvcnRlcicpLmZvckVhY2goKGEsIGkpID0+IHtcbiAgICAgICAgYS5jbGFzc0xpc3QucmVtb3ZlKCgoaSA9PT0gaW5kZXgpID8gY3NzLndhaXQgOiBjc3MuZGlzYWJsZWQpKVxuICAgICAgfSk7XG4gICAgICB0aGlzLnNvcnRpbmcgPSBmYWxzZTtcbiAgICB9KTtcbiAgfVxuICBzb3J0Q29sdW1uKHRoLCBpbmRleCwgZGlyID0gbnVsbCkge1xuICAgIGRpciA9IChkaXIgPT09IG51bGwpID8gKCh0aC5jbGFzc0xpc3QuY29udGFpbnModGFibGVjc3MuYXNjZW5kaW5nKSkgPyBmYWxzZSA6ICh0aC5jbGFzc0xpc3QuY29udGFpbnModGFibGVjc3MuZGVzY2VuZGluZykpID8gdHJ1ZSA6ICgodGguZGF0YXNldC5zb3J0KSA/IGZhbHNlIDogdHJ1ZSkpIDogZGlyO1xuICAgIHRoLmNsYXNzTGlzdC50b2dnbGUodGFibGVjc3MuYXNjZW5kaW5nKTtcbiAgICB0aC5jbGFzc0xpc3QudG9nZ2xlKHRhYmxlY3NzLmRlc2NlbmRpbmcpO1xuICAgIHRoaXMuZW1pdCh0aGlzLmV2ZW50bmFtZXMuc29ydGluZywgZGlyLCB0aC5jZWxsSW5kZXgpO1xuICAgIGxldCByb3dzID0gdGhpcy5ncmlkLmRhdGEubWFwKChyb3csIGkpID0+IHtcbiAgICAgIGNvbnN0IGNlbGwgPSBpc19vYmplY3Qocm93W2luZGV4XSkgPyBKU09OLnN0cmluZ2lmeShyb3dbaW5kZXhdKSA6ICgoQXJyYXkuaXNBcnJheShyb3dbaW5kZXhdKSkgPyByb3dbaW5kZXhdWzBdIDogcm93W2luZGV4XSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB2YWx1ZTogdHlwZW9mIGNlbGwgPT09IFwic3RyaW5nXCIgPyBjZWxsLnRvTG93ZXJDYXNlKCkgOiAoKGNlbGwgPT09IG51bGwpID8gMCA6IGNlbGwpLFxuICAgICAgICByb3c6IGlcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGNvbnN0IGNvbXBhcmVfY29sZGF0YSA9IGZ1bmN0aW9uKGEsIGIpIHtcbiAgICAgIGNvbnN0IHggPSAoZGlyID8gYS52YWx1ZSA6IGIudmFsdWUpO1xuICAgICAgY29uc3QgeSA9IChkaXIgPyBiLnZhbHVlIDogYS52YWx1ZSk7XG4gICAgICByZXR1cm4geC5sb2NhbGVDb21wYXJlKHksIHVuZGVmaW5lZCwge1xuICAgICAgICBudW1lcmljOiB0cnVlLFxuICAgICAgICBzZW5zaXRpdml0eTogJ2Jhc2UnXG4gICAgICB9KTtcblxuICAgIH07XG5cbiAgICBpZiAoZGlyID09PSBmYWxzZSkge1xuICAgICAgdGguY2xhc3NMaXN0LnJlbW92ZSh0YWJsZWNzcy5hc2NlbmRpbmcpO1xuICAgICAgdGguY2xhc3NMaXN0LmFkZCh0YWJsZWNzcy5kZXNjZW5kaW5nKTtcbiAgICAgIHRoLnNldEF0dHJpYnV0ZShcImFyaWEtc29ydFwiLCBcImRlc2NlbmRpbmdcIik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoLmNsYXNzTGlzdC5yZW1vdmUodGFibGVjc3MuZGVzY2VuZGluZyk7XG4gICAgICB0aC5jbGFzc0xpc3QuYWRkKHRhYmxlY3NzLmFzY2VuZGluZyk7XG4gICAgICB0aC5zZXRBdHRyaWJ1dGUoXCJhcmlhLXNvcnRcIiwgXCJhc2NlbmRpbmdcIik7XG4gICAgfVxuXG4gICAgLyogQ2xlYXIgYXNjL2Rlc2MgY2xhc3MgbmFtZXMgZnJvbSB0aGUgbGFzdCBzb3J0ZWQgY29sdW1uJ3MgdGggaWYgaXQgaXNuJ3QgdGhlIHNhbWUgYXMgdGhlIG9uZSB0aGF0IHdhcyBqdXN0IGNsaWNrZWQgKi9cbiAgICBpZiAodGhpcy5kb20uZGF0YXNldC5sYXN0dGggIT09IHVuZGVmaW5lZCAmJiB0aC5jZWxsSW5kZXggIT0gdGhpcy5kb20uZGF0YXNldC5sYXN0dGgpIHtcbiAgICAgIGNvbnN0IGhlYWRpbmdzID0gdGhpcy5kb20ucXVlcnlTZWxlY3RvckFsbChcInRoZWFkIHRoXCIpO1xuICAgICAgaGVhZGluZ3NbdGhpcy5kb20uZGF0YXNldC5sYXN0dGhdLmNsYXNzTGlzdC5yZW1vdmUodGFibGVjc3MuZGVzY2VuZGluZyk7XG4gICAgICBoZWFkaW5nc1t0aGlzLmRvbS5kYXRhc2V0Lmxhc3R0aF0uY2xhc3NMaXN0LnJlbW92ZSh0YWJsZWNzcy5hc2NlbmRpbmcpO1xuICAgICAgaGVhZGluZ3NbdGhpcy5kb20uZGF0YXNldC5sYXN0dGhdLnJlbW92ZUF0dHJpYnV0ZShcImFyaWEtc29ydFwiKTtcblxuICAgIH1cbiAgICB0aGlzLmRvbS5kYXRhc2V0Lmxhc3R0aCA9IHRoLmNlbGxJbmRleDtcbiAgICBjb25zdCBjb2xsYXRvciA9IG5ldyBJbnRsLkNvbGxhdG9yKHVuZGVmaW5lZCwge1xuICAgICAgbnVtZXJpYzogdHJ1ZSxcbiAgICAgIHNlbnNpdGl2aXR5OiAnYmFzZSdcbiAgICB9KVxuICAgIHJvd3Muc29ydCgoYSwgYikgPT4ge1xuICAgICAgcmV0dXJuIGNvbGxhdG9yLmNvbXBhcmUoKGRpciA/IGEudmFsdWUgOiBiLnZhbHVlKSwgKGRpciA/IGIudmFsdWUgOiBhLnZhbHVlKSlcbiAgICB9KTtcbiAgICAvKnJvd3Muc29ydCgoYSwgYikgPT4ge1xuICAgICAgcmV0dXJuIGNvbXBhcmVfY29sZGF0YShhLCBiKTtcbiAgICB9KTsqL1xuICAgIGNvbnN0IHRib2R5ID0gdGhpcy5kb20ucXVlcnlTZWxlY3RvcigndGJvZHknKTtcbiAgICBjb25zdCBjbG9uZSA9IHRib2R5LmNsb25lTm9kZSgpO1xuICAgIGNvbnN0IHRycyA9IHRib2R5LnF1ZXJ5U2VsZWN0b3JBbGwoJ3RyJyk7XG4gICAgdGJvZHkuaW5uZXJIVE1MID0gYGA7XG4gICAgY29uc3Qgc29ydGVkID0gW107XG4gICAgcm93cy5mb3JFYWNoKChyLCBpKSA9PiB7XG4gICAgICBjbG9uZS5hcHBlbmRDaGlsZCh0cnNbci5yb3ddKTtcbiAgICAgIHNvcnRlZC5wdXNoKHRoaXMuZ3JpZC5kYXRhW3Iucm93XSk7XG5cbiAgICB9KTtcbiAgICB0aGlzLmdyaWQuZGF0YSA9IHNvcnRlZDtcbiAgICB0aGlzLmRvbS5yZXBsYWNlQ2hpbGQoY2xvbmUsIHRib2R5KTtcblxuICAgIHRoaXMuZW1pdCh0aGlzLmV2ZW50bmFtZXMuc29ydGVkLCBkaXIsIHRoLmNlbGxJbmRleCk7XG5cblxuICB9XG5cbiAgdGFibGVTZWFyY2goaW5wdXQsIGNhc2VzZW5zaXRpdmUgPSBmYWxzZSkge1xuICAgIGZ1bmN0aW9uIHNlYXJjaF9zdHJpbmcoc3RyLCBjYXNlc2Vuc2l0aXZlKSB7XG4gICAgICBzdHIgPSAoY2FzZXNlbnNpdGl2ZSkgPyBzdHIgOiBzdHIudG9Mb3dlckNhc2UoKTtcbiAgICAgIHJldHVybiBzdHI7IC8vIHN0ci5yZXBsYWNlKC9bLVtcXF17fSgpKis/LixcXFxcXiR8I10vZywgJ1xcXFwkJicpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNlYXJjaF9xdWVyaWVzKHN0ciwgY2FzZXNlbnNpdGl2ZSkge1xuICAgICAgc3RyID0gc2VhcmNoX3N0cmluZyhzdHIsIGNhc2VzZW5zaXRpdmUpO1xuICAgICAgbGV0IHN0cnMgPSBbXTtcbiAgICAgIGxldCBwaHJhc2U7XG4gICAgICB3aGlsZSAoKHBocmFzZSA9IHN0ci5tYXRjaCgvXCIoW15cIl0rKVwiLykpICE9PSBudWxsKSB7XG5cbiAgICAgICAgc3Rycy5wdXNoKHBocmFzZVsxXSk7XG4gICAgICAgIHN0ciA9IHN0ci5zdWJzdHJpbmcoMCwgcGhyYXNlLmluZGV4KSArIHN0ci5zdWJzdHJpbmcocGhyYXNlLmluZGV4ICsgcGhyYXNlWzBdLmxlbmd0aCk7XG4gICAgICB9XG4gICAgICAvLyBHZXQgcmVtYWluaW5nIHNwYWNlLXNlcGFyYXRlZCB3b3JkcyAoaWYgYW55KVxuICAgICAgc3RyID0gc3RyLnRyaW0oKTtcbiAgICAgIGlmIChzdHIubGVuZ3RoKSBzdHJzID0gc3Rycy5jb25jYXQoc3RyLnNwbGl0KC9cXHMrLykpO1xuICAgICAgcmV0dXJuIHN0cnM7XG4gICAgfVxuXG4gICAgbGV0IHF1ZXJpZXMgPSBzZWFyY2hfcXVlcmllcyhpbnB1dC52YWx1ZSk7XG4gICAgbGV0IGRhdGFzID0gdGhpcy5ncmlkLmRhdGEsXG4gICAgICBpbmRleGVzID0gW107XG4gICAgY29uc3QgdHJzID0gdGhpcy5kb20ucXVlcnlTZWxlY3RvckFsbCgndGJvZHkgdHInKTtcbiAgICBjb25zdCBjZWxsaWQgPSB0aGlzLmdldENlbGxJZCh0aGlzLmNlbGxpZG5hbWUpO1xuICAgIHF1ZXJpZXMuZm9yRWFjaChxcnkgPT4ge1xuICAgICAgaW5kZXhlcyA9IFtdO1xuICAgICAgZGF0YXMgPSBkYXRhcy5maWx0ZXIoKGRhdGEsIGopID0+IHtcbiAgICAgICAgY29uc3QgZm91bmQgPSBkYXRhLmZpbHRlcihjZWxsID0+IHtcbiAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjZWxsKSB7XG4gICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICBjZWxsID0gKGNlbGwpID8gY2VsbCA6IGBgO1xuICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGNlbGwgPSBKU09OLnN0cmluZ2lmeShjZWxsKTtcbiAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3NlYXJjaCcsIGVycik7XG4gICAgICAgICAgICAgICAgY2VsbCA9IGBgO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnYXJyYXknOlxuICAgICAgICAgICAgICBjZWxsID0gY2VsbC5qb2luKCcgJyk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgY2VsbCA9IFN0cmluZyhjZWxsKTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuICgoY2FzZXNlbnNpdGl2ZSkgPyBjZWxsLmluZGV4T2YocXJ5KSA+IC0xIDogY2VsbC50b0xvd2VyQ2FzZSgpLmluZGV4T2YocXJ5KSkgPiAtMTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKGZvdW5kLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBpZiAoY2VsbGlkIDwgMCkgaW5kZXhlcy5wdXNoKFN0cmluZyhqKSk7XG4gICAgICAgICAgZWxzZSBpbmRleGVzLnB1c2goU3RyaW5nKGRhdGFbY2VsbGlkXSkpO1xuICAgICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHRycy5mb3JFYWNoKCh0ciwgaW5kZXgpID0+IHtcbiAgICAgIGNvbnN0IHZhbCA9ICh0ci5kYXRhc2V0W3RoaXMuY2VsbGlkbmFtZV0gIT09IG51bGwpID8gdHIuZGF0YXNldFt0aGlzLmNlbGxpZG5hbWVdIDogdHIuY2VsbHNbY2VsbGlkXS50ZXh0Q29udGVudDtcbiAgICAgIGlmICgocXVlcmllcy5sZW5ndGggPiAwICYmIGluZGV4ZXMubGVuZ3RoID09PSAwKSB8fCBpbmRleGVzLmluZGV4T2YodmFsKSA8IDApIHRyLmhpZGRlbiA9IHRydWU7XG4gICAgICBlbHNlIHRyLmhpZGRlbiA9IGZhbHNlO1xuICAgIH0pO1xuXG4gIH1cblxuICBpbml0U2VhcmNoKCkge1xuICAgIGlmICh0aGlzLmdyaWQuZGF0YS5sZW5ndGggPCAxMCkgcmV0dXJuIHRoaXMudG9nZ2xlQWRkT25zKCk7XG4gICAgZWxzZSB0aGlzLnRvZ2dsZUFkZE9ucyhbdGFibGVzZWxlY3RvcnMuc2VhcmNoICsgJyBpbnB1dCddLCB0cnVlKTtcbiAgICB0aGlzLnNlYXJjaGluZyA9IGZhbHNlO1xuICAgIC8vIHNlYXJjaCBpdGVtc1xuICAgIGNvbnN0IHNlYXJjaGlucHV0ID0gdGhpcy53cmFwcGVyLnF1ZXJ5U2VsZWN0b3IodGFibGVzZWxlY3RvcnMuc2VhcmNoICsgJyBpbnB1dCcpO1xuICAgIGlmICghc2VhcmNoaW5wdXQpIHJldHVybjtcbiAgICBsZXQgc2VhcmNoc3RyaW5nID0gYGA7XG4gICAgY29uc3Qgc2VhcmNoX3Rlcm1zID0gZGVib3VuY2UoKGVsKSA9PiB7XG4gICAgICBzZWFyY2hzdHJpbmcgPSBlbC52YWx1ZTtcbiAgICAgIHRoaXMudGFibGVTZWFyY2goZWwpO1xuICAgIH0sIDUwMCk7XG4gICAgc2VhcmNoaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImtleXVwXCIsIChlKSA9PiB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBzZWFyY2hfdGVybXMoZS5jdXJyZW50VGFyZ2V0KTtcbiAgICB9KVxuICAgIHNlYXJjaGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuXG4gICAgICBpZiAoc2VhcmNoc3RyaW5nICE9PSBlLmN1cnJlbnRUYXJnZXQudmFsdWUpIHNlYXJjaF90ZXJtcyhlLmN1cnJlbnRUYXJnZXQpO1xuXG4gICAgfSlcbiAgICBsZXQgdGltZXNlYXJjaCA9IGZhbHNlO1xuICAgIHRoaXMub24odGhpcy5ldmVudG5hbWVzLnNlYXJjaCwgKHF1ZXJ5LCBtYXRjaGVkKSA9PiB7XG4gICAgICBpZiAodGhpcy5wbHVnaW5zLmhhc093blByb3BlcnR5KCdqc0RldGFpbCcpKSB0aGlzLnBsdWdpbnNbJ2pzRGV0YWlsJ10uYWN0aXZlRGV0YWlsKGZhbHNlKTtcbiAgICAgIHRoaXMuc2VhcmNoaW5nID0gdHJ1ZTtcbiAgICB9KTtcbiAgICB0aGlzLm9uKHRoaXMuZXZlbnRuYW1lcy5zZWFyY2hlbmQsIChxdWVyeSwgbWF0Y2hlZCkgPT4ge1xuXG4gICAgICB0aGlzLnNlYXJjaGluZyA9IGZhbHNlO1xuICAgIH0pO1xuICAgIHRoaXMub24odGhpcy5ldmVudG5hbWVzLnVwZGF0ZSwgKCkgPT4ge1xuICAgICAgaWYgKHRpbWVzZWFyY2ggPT09IGZhbHNlKSB7XG4gICAgICAgIHRpbWVzZWFyY2ggPSB0cnVlO1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICByZWZyZXNoX2RldGFpbHMoKTtcbiAgICAgICAgICBkZWxldGUgdGhpcy5kb20uZGF0YXNldC5pc3NlYXJjaGluZztcbiAgICAgICAgICB0aW1lc2VhcmNoID0gZmFsc2U7XG4gICAgICAgIH0sIDMwMCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbiAgaW5pdFNlbGVjdChjb250YWluZXIpIHtcbiAgICBjb25zdCBpbnB1dHMgPSB0aGlzLmRvbS5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dFtuYW1lXj1cIicgKyB0aGlzLmluc3RhbmNlaWQgKyAnXCJdJyk7XG4gICAgaWYgKGlucHV0cy5sZW5ndGggPT09IDApIHJldHVybjtcbiAgICBjb25zdCBpbnB1dG5hbWUgPSBpbnB1dHNbMF0ubmFtZTtcbiAgICBsZXQgc2VsZWN0YWN0aW9uID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy4nICsgdGFibGVjc3Muc2VsZWN0YWN0aW9uKTtcbiAgICBpZiAoIXNlbGVjdGFjdGlvbikgcmV0dXJuO1xuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kKHNlbGVjdGFjdGlvbik7XG4gICAgc2VsZWN0YWN0aW9uLnF1ZXJ5U2VsZWN0b3IoJ2EnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICBsZXQgdmFscyA9IFtdO1xuICAgICAgaW5wdXRzLmZvckVhY2goaW5wdXQgPT4ge1xuICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCkgdmFscy5wdXNoKGlucHV0LnZhbHVlKTtcbiAgICAgIH0pO1xuICAgICAgaWYgKHNlbGVjdGFjdGlvbi5kYXRhc2V0LmlucHV0KSB7XG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHNlbGVjdGFjdGlvbi5kYXRhc2V0LmlucHV0KS52YWx1ZSA9IHZhbHMuam9pbignLCcpO1xuICAgICAgICBpZiAoc2VsZWN0YWN0aW9uLmRhdGFzZXQuZm9ybSkgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoc2VsZWN0YWN0aW9uLmRhdGFzZXQuZm9ybSkuc3VibWl0KCk7XG4gICAgICB9IGVsc2UgZS5jdXJyZW50VGFyZ2V0LmhyZWYgPSB0aGlzLnBhcmFtcy5vbnNlbGVjdCArIGVuY29kZVVSSSh2YWxzLmpvaW4oJywnKSk7XG5cbiAgICB9KTtcbiAgICBjb25zdCBjbG9zZSA9IHNlbGVjdGFjdGlvbi5xdWVyeVNlbGVjdG9yKCdbZGF0YS1kaXNtaXNzXScpO1xuICAgIGlmIChjbG9zZSkgY2xvc2UuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcbiAgICAgIHBvcHVwX3NlbGVjdGVkKG51bGwsIG51bGwpO1xuICAgIH0pO1xuXG4gICAgY29uc3QgcG9wdXBfc2VsZWN0ZWQgPSAodG9wID0gbnVsbCwgbGVmdCA9IG51bGwsIGZvcmNlY2xvc2UgPSBmYWxzZSkgPT4ge1xuICAgICAgaWYgKHNlbGVjdGFjdGlvbi5kYXRhc2V0LmNsb3NlKSB7XG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kKHNlbGVjdGFjdGlvbik7XG4gICAgICAgIGNsb3NlLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpO1xuICAgICAgICBzZWxlY3RhY3Rpb24uY2xhc3NMaXN0LmFkZCh0YWJsZWNzcy5hYnNpbnB1dCk7XG4gICAgICB9XG4gICAgICBpZiAodG9wICE9PSBudWxsICYmIGxlZnQgIT09IG51bGwpIHtcbiAgICAgICAgc2VsZWN0YWN0aW9uLmNsYXNzTGlzdC5yZW1vdmUoY3NzLmhpZGUpO1xuICAgICAgICBzZWxlY3RhY3Rpb24uc3R5bGUudG9wID0gdG9wICsgJ3B4JztcbiAgICAgICAgc2VsZWN0YWN0aW9uLnN0eWxlLmxlZnQgPSBsZWZ0ICsgJ3B4JztcblxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGZvcmNlY2xvc2UgPT09IHRydWUpIHtcbiAgICAgICAgICBzZWxlY3RhY3Rpb24uY2xhc3NMaXN0LmFkZChjc3MuaGlkZSk7XG4gICAgICAgICAgZGVsZXRlIHNlbGVjdGFjdGlvbi5kYXRhc2V0LmNsb3NlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHNlbGVjdGFjdGlvbi5kYXRhc2V0LmNsb3NlID0gdHJ1ZTtcbiAgICAgICAgICBjbG9zZS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTtcbiAgICAgICAgICBjb25zdCB0b3B0YWJsZSA9IHRoaXMud3JhcHBlci5xdWVyeVNlbGVjdG9yKHRhYmxlc2VsZWN0b3JzLnRvcCkgPyB0aGlzLndyYXBwZXIucXVlcnlTZWxlY3Rvcih0YWJsZXNlbGVjdG9ycy50b3ApIDogdGhpcy53cmFwcGVyO1xuICAgICAgICAgIHRvcHRhYmxlLnByZXBlbmQoc2VsZWN0YWN0aW9uKTtcbiAgICAgICAgICBzZWxlY3RhY3Rpb24uY2xhc3NMaXN0LnJlbW92ZSh0YWJsZWNzcy5hYnNpbnB1dCk7XG5cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBpbnB1dHMuZm9yRWFjaChpbnB1dCA9PiB7XG4gICAgICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoZSkgPT4ge1xuICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCkgcG9wdXBfc2VsZWN0ZWQoaW5wdXQub2Zmc2V0VG9wLCBpbnB1dC5vZmZzZXRMZWZ0KTtcbiAgICAgICAgZWxzZSBpZiAodGhpcy5kb20ucXVlcnlTZWxlY3RvckFsbCgnaW5wdXRbbmFtZV49XCInICsgdGhpcy5pbnN0YW5jZWlkICsgJ1wiXTpjaGVja2VkJykubGVuZ3RoID09PSAwKSBwb3B1cF9zZWxlY3RlZChudWxsLCBudWxsLCB0cnVlKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIGlmICh0aGlzLmRvbS5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dFtuYW1lXj1cIicgKyB0aGlzLmluc3RhbmNlaWQgKyAnXCJdOmNoZWNrZWQnKS5sZW5ndGggPiAwKSB7XG4gICAgICBzZWxlY3RhY3Rpb24uY2xhc3NMaXN0LnJlbW92ZShjc3MuaGlkZSk7XG4gICAgICBwb3B1cF9zZWxlY3RlZChudWxsLCBudWxsKTtcbiAgICB9XG4gIH1cbiAgYXN5bmMgaW5pdERldGFpbHMoKSB7IC8vIFRPRE8gOiBnZW5lcmljXG4gICAgLy8gYWJvdXQgLSBvbmUgZGl2IHRvIGRpc3BsYXkgY2VsbCBkZXRhaWxzIG1ha2UgaXQgYXBwZWFyIGFzIHRhYmxlIHJvdyBleHBhbmRpbmdcbiAgICBjb25zdCB3cmFwcGVyID0gdGhpcy53cmFwcGVyO1xuXG4gICAgY29uc3QgYWJvdXQgPSB3cmFwcGVyLnF1ZXJ5U2VsZWN0b3IoJyMnICsgdGFibGVjc3MudGlwaW5saW5lKSA/IHdyYXBwZXIucXVlcnlTZWxlY3RvcignIycgKyB0YWJsZWNzcy50aXBpbmxpbmUpIDogdGFibGVjc3MudGlwaW5saW5lO1xuICAgIGlmICghZHluYW1pY3MuSnNEZXRhaWwpIHtcbiAgICAgIGNvbnN0IHtcbiAgICAgICAgSnNEZXRhaWxcbiAgICAgIH0gPSBhd2FpdFxuICAgICAgaW1wb3J0KCcuLi9tb2R1bGVzL2pzLWRldGFpbC5qcycpO1xuICAgICAgZHluYW1pY3MuSnNEZXRhaWwgPSBKc0RldGFpbDtcbiAgICB9XG4gICAgY29uc3QganNEZXRhaWwgPSBuZXcgZHluYW1pY3MuSnNEZXRhaWwoYWJvdXQsIHdyYXBwZXIsIHtcbiAgICAgIHdhaXRkaXY6IHRoaXMud2FpdGRpdlxuICAgIH0pOyAvLyBzcGVjaWZpYyB0byBhYm91dCBkZXRhaWxzIGluIHRhYmxlXG4gICAgLy8gaGlkZSAvIHNob3cgZGlzYWJsZSBkZXRhaWxzIHpvbmVcbiAgICBjb25zdCBjYWxsYmFja2Nsb3NlID0gKGVsLCBjYWxsYmFjayA9IG51bGwpID0+IHtcbiAgICAgIGpzRGV0YWlsLmFjdGl2ZURldGFpbChmYWxzZSk7XG4gICAgICBpZiAoY2FsbGJhY2spIGNhbGxiYWNrKCk7XG4gICAgfVxuXG4gICAgY29uc3QgY2FsbGJhY2tvcGVuID0gKGVsLCBjYWxsYmFjayA9IG51bGwpID0+IHtcbiAgICAgIGpzRGV0YWlsLmFjdGl2ZURldGFpbCh0cnVlKTtcbiAgICAgIGlmIChqc0RldGFpbC5jdXJyZW50ICYmIGpzRGV0YWlsLmN1cnJlbnQgPT09IGVsKSB7XG4gICAgICAgIGpzRGV0YWlsLmV4cGFuZERldGFpbChlbCk7XG4gICAgICAgIGlmIChjYWxsYmFjaykgY2FsbGJhY2soKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChqc0RldGFpbC5jdXJyZW50KSBqc0RldGFpbC5jdXJyZW50LnF1ZXJ5U2VsZWN0b3IoJ3N1bW1hcnknKS5jbGljaygpO1xuICAgICAgICBjb25zdCB1cmwgPSB0aGlzLnBhcmFtcy5kZXRhaWxzdXJsICsgZWwuZGF0YXNldC5pZCArICc/JyArXG4gICAgICAgICAgbmV3IFVSTFNlYXJjaFBhcmFtcyh7XG4gICAgICAgICAgICBwYXJ0aWFsOiB0cnVlXG4gICAgICAgICAgfSk7XG4gICAgICAgIGpzRGV0YWlsLmFjdGl2ZURldGFpbCh0cnVlKTtcbiAgICAgICAgLy8gYXBwZW5kIHRvIGNlbGwgZGV0YWlscyBhbmQgZGlzcGxheVxuXG4gICAgICAgIGZldGNoKHVybCwgZmV0Y2hTZXR0aW5ncygpKS50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLnRleHQoKSkudGhlbihodG1sID0+IHtcbiAgICAgICAgICBqc0RldGFpbC5leHBhbmREZXRhaWwoZWwsIGh0bWwpO1xuICAgICAgICAgIGlmIChjYWxsYmFjaykgY2FsbGJhY2soKTtcbiAgICAgICAgfSkuY2F0Y2goZXJyID0+IHtcbiAgICAgICAgICBjb25zb2xlLmxvZygncmVxdWVzdCcsIGVycik7XG4gICAgICAgIH0pXG4gICAgICB9XG5cbiAgICB9XG4gICAgaWYgKCFkeW5hbWljcy5Kc0FjY29yZGlvbikge1xuICAgICAgY29uc3Qge1xuICAgICAgICBKc0FjY29yZGlvblxuICAgICAgfSA9IGF3YWl0IGltcG9ydCgnLi4vbW9kdWxlcy9qcy1hY2NvcmRpb24uanMnKTtcbiAgICAgIGR5bmFtaWNzLkpzQWNjb3JkaW9uID0gSnNBY2NvcmRpb247XG4gICAgfVxuXG4gICAgY29uc3QgcmVmcmVzaF9kZXRhaWxzID0gKCkgPT4ge1xuICAgICAgaWYgKHRoaXMuZG9tLmNsYXNzTGlzdC5jb250YWlucyh0YWJsZWNzcy5oaWRlKSkgdGhpcy5kb20uY2xhc3NMaXN0LnJlbW92ZSh0YWJsZWNzcy5oaWRlKTtcbiAgICAgIGNvbnN0IGRldGFpbHMgPSB0aGlzLmRvbS5xdWVyeVNlbGVjdG9yQWxsKHRhYmxlc2VsZWN0b3JzLmRldGFpbHMpO1xuICAgICAgaWYgKCFkZXRhaWxzKSByZXR1cm47XG4gICAgICBkZXRhaWxzLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgIGlmICghaXRlbS5kYXRhc2V0LmlkKSByZXR1cm47XG5cbiAgICAgICAgaXRlbSA9IG5ldyBkeW5hbWljcy5Kc0FjY29yZGlvbihpdGVtLCBjYWxsYmFja29wZW4sIGNhbGxiYWNrY2xvc2UsIGpzRGV0YWlsLmRldGFpbCk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgdGhpcy5wbHVnaW5zWydqc0RldGFpbCddID0ganNEZXRhaWw7XG4gICAgcmVmcmVzaF9kZXRhaWxzKCk7XG4gIH1cblxuICBpbml0QWx0ZXJuYXRlU29ydChjb2xzKSB7XG5cbiAgICBsZXQgdGRjb2xzID0gW107XG4gICAgY29scy5mb3JFYWNoKGNvbCA9PiB7XG4gICAgICBjb25zdCB0ZGNvbCA9IGNvbC5jbG9zZXN0KCd0aCcpO1xuICAgICAgT2JqZWN0LmVudHJpZXMoY29sLmRhdGFzZXQpLmZvckVhY2goKFtrLCB2XSkgPT4ge1xuICAgICAgICB0ZGNvbC5kYXRhc2V0W2tdID0gdjtcbiAgICAgICAgY29sLmNsYXNzTGlzdC5hZGQoJ2lubGluZS1ibG9jaycpXG4gICAgICB9KTtcbiAgICAgIHRkY29scy5wdXNoKHRkY29sKTtcbiAgICB9KTtcbiAgICBjb2xzID0gdGRjb2xzO1xuICAgIC8vIGVuZCBmaXhcblxuICAgIGxldCBjb2x0b3NvcnQ7XG4gICAgY29uc3Qgc29ydGFsdGVybmF0ZSA9IChjb2wpID0+IHtcbiAgICAgIGxldCB0b2RpcjtcbiAgICAgIC8vIGtlZXAgdGhlIHNhbWUgZGlyIGlmIHNvcnQgb24gY29sIGNoYW5nZXNcbiAgICAgIGlmIChwYXJzZUludChjb2wuZGF0YXNldC5zb3J0YWN0aXZlKSA9PT0gcGFyc2VJbnQoY29sdG9zb3J0KSkge1xuICAgICAgICB0b2RpciA9IChjb2wuY2xhc3NMaXN0LmNvbnRhaW5zKHRhYmxlY3NzLmFzY2VuZGluZykpID8gJ2Rlc2MnIDogKChjb2wuY2xhc3NMaXN0LmNvbnRhaW5zKHRhYmxlY3NzLmRlc2NlbmRpbmcpKSA/ICdhc2MnIDogJ2FzYycpO1xuICAgICAgfSBlbHNlIHRvZGlyID0gKGNvbC5jbGFzc0xpc3QuY29udGFpbnModGFibGVjc3MuYXNjZW5kaW5nKSkgPyAnYXNjJyA6IChjb2wuY2xhc3NMaXN0LmNvbnRhaW5zKHRhYmxlY3NzLmRlc2NlbmRpbmcpKSA/ICdkZXNjJyA6ICdhc2MnO1xuICAgICAgLy8gIHRoaXMuZ3JpZC5jb2x1bW5zLnNvcnQoY29sdG9zb3J0LCB0b2Rpcik7XG5cbiAgICAgIHRoaXMuc29ydENvbHVtbihjb2wsIGNvbHRvc29ydCwgdG9kaXIpO1xuXG4gICAgfVxuICAgIGNvbHMuZm9yRWFjaChjb2wgPT4ge1xuICAgICAgY29uc3QgYWx0c29ydCA9IChjb2wuZGF0YXNldC5hbHRzb3J0KSA/IGNvbC5kYXRhc2V0LmFsdHNvcnQuc3BsaXQoJywnKSA6IG51bGw7XG4gICAgICBpZiAoIWFsdHNvcnQpIHJldHVybjtcbiAgICAgIGNvbnN0IGNzc3NvcnRlciA9IGNvbC5xdWVyeVNlbGVjdG9yKHRhYmxlc2VsZWN0b3JzLnNvcnRlcik7XG4gICAgICBpZiAoY3Nzc29ydGVyKSBjc3Nzb3J0ZXIuY2xhc3NMaXN0LmFkZCh0YWJsZWNzcy5kaXNhYmxlZCk7XG4gICAgICBjb25zdCBjb250cm9sID0gY29sLnF1ZXJ5U2VsZWN0b3IodGFibGVzZWxlY3RvcnMuc29ydG9uKTtcbiAgICAgIC8vIHByZXZlbnRzIGltYnJpY2F0ZWQgbGlua3NcbiAgICAgIGNvbC5hcHBlbmQoY29udHJvbCk7XG4gICAgICBjb25zdCB0cmlnZ2VycyA9IGNvbC5xdWVyeVNlbGVjdG9yQWxsKCdbcm9sZT1cImJ1dHRvblwiXScpO1xuXG4gICAgICBjb2wuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHNvcnRhbHRlcm5hdGUoY29sKTtcbiAgICAgIH0sIGZhbHNlKTtcbiAgICAgIGNvbnN0IGNoYW5nZWNvbHRvc29ydCA9IChjbCwgaW5kZXgpID0+IHtcbiAgICAgICAgaWYgKGluZGV4ID09PSAwKSBjb2x0b3NvcnQgPSB0aGlzLmdyaWQuY29sdW1ucy5maW5kSW5kZXgoY29sdW1uID0+IChjb2x1bW4uaW5kZXggPT09IGNsLmNlbGxJbmRleCkpO1xuICAgICAgICBlbHNlIGNvbHRvc29ydCA9IHRoaXMuZ3JpZC5jb2x1bW5zLmZpbmRJbmRleChjb2x1bW4gPT4gKGNvbHVtbi5uYW1lID09PSBhbHRzb3J0W2luZGV4IC0gMV0pKTtcbiAgICAgIH1cbiAgICAgIGNvbC5kYXRhc2V0LnNvcnRhY3RpdmUgPSBjb2wuY2VsbEluZGV4O1xuICAgICAgdHJpZ2dlcnMuZm9yRWFjaCgodHJpZ2dlciwgaW5kZXgpID0+IHtcbiAgICAgICAgdHJpZ2dlci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIGNvbnN0IGFjdGl2ZSA9IGUuY3VycmVudFRhcmdldC5wYXJlbnRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy4nICsgY3NzLmFjdGl2ZSk7XG4gICAgICAgICAgaWYgKGFjdGl2ZSkgYWN0aXZlLmNsYXNzTGlzdC5yZW1vdmUoY3NzLmFjdGl2ZSk7XG4gICAgICAgICAgZS5jdXJyZW50VGFyZ2V0LmNsYXNzTGlzdC5hZGQoY3NzLmFjdGl2ZSk7XG4gICAgICAgICAgY2hhbmdlY29sdG9zb3J0KGNvbCwgaW5kZXgpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgICAgaWYgKGNvbC5kYXRhc2V0LnRpcCkge1xuXG4gICAgICAgIE9iamVjdC52YWx1ZXModGhpcy5kb20ucm93cykuZm9yRWFjaCgocm93LCBpbmRleCkgPT4ge1xuICAgICAgICAgIGlmIChpbmRleCA9PT0gMCkgcmV0dXJuO1xuICAgICAgICAgIGNvbnN0IGNvbHRpcCA9IHRoaXMuZ3JpZC5jb2x1bW5zLmZpbmRJbmRleChjb2x1bW4gPT4gKGNvbHVtbi5uYW1lID09PSBhbHRzb3J0W3BhcnNlSW50KGNvbC5kYXRhc2V0LnRpcCkgLSAxXSkpO1xuXG4gICAgICAgICAgaWYgKHJvdy5jZWxscy5sZW5ndGggPT09IDAgfHwgY29sdGlwID09PSBjb2wuY2VsbEluZGV4KSByZXR1cm47XG4gICAgICAgICAgcm93LmNlbGxzW2NvbC5jZWxsSW5kZXhdLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZW50ZXInLCAoZSkgPT4ge1xuXG4gICAgICAgICAgICBjb25zdCB0aXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgIHRpcC5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgdGFibGVjc3MudGlwb3Zlcik7XG4gICAgICAgICAgICB0aXAuaW5uZXJIVE1MID0gcm93LmNlbGxzW2NvbHRpcF0uaW5uZXJIVE1MO1xuICAgICAgICAgICAgZS5jdXJyZW50VGFyZ2V0LmFwcGVuZCh0aXApO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJvdy5jZWxsc1tjb2wuY2VsbEluZGV4XS5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW91dCcsIChlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB0aXAgPSBlLmN1cnJlbnRUYXJnZXQucXVlcnlTZWxlY3Rvcih0YWJsZXNlbGVjdG9ycy50aXBvdmVyKTtcbiAgICAgICAgICAgIGlmICh0aXApIHRpcC5yZW1vdmUoKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgfVxuXG5cbiAgY2xvc2VTaG93ZnVsbCgpIHtcbiAgICBjb25zdCBzaG93ZnVsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy4nICsgY3NzLmNvbXBvbmVudC50YWJsZS50aXAgKyAnLicgKyB0YWJsZWNzcy5zaG93ZnVsbCk7XG4gICAgaWYgKHNob3dmdWxsKSBzaG93ZnVsbC5jbGljaygpO1xuICB9XG4gIG1ha2VFeHBhbmRhYmxlKGNvbnRhaW5lcikge1xuICAgIGlmIChjb250YWluZXIucXVlcnlTZWxlY3RvcigndGFibGUnKS5vZmZzZXRIZWlnaHQgPCBjb250YWluZXIub2Zmc2V0SGVpZ2h0KSByZXR1cm47XG4gICAgY29uc3QgYnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgYnRuLmNsYXNzTGlzdC5hZGQoJ2J1dHRvbi1leHBhbmQnKTtcbiAgICBidG4uY2xhc3NMaXN0LmFkZCgnYm9yZGVyLXQnKTtcbiAgICBidG4udGl0bGUgPSB0aGlzLnBhcmFtcy5leHBhbmQ7XG4gICAgYnRuLmlubmVySFRNTCA9IGA8c3BhbiBjbGFzcz1cInNtYWxsLWNhcHMgYmxvY2sgbXgtYXV0byBwLTBcIj4ke3RoaXMucGFyYW1zLmV4cGFuZH08L3NwYW4+PGkgY2xhc3M9XCJjbGVhci1ib3RoIHAtMCBteC1hdXRvIGljb24gaWNvbi1jaGV2cm9uLWRvd24gaG92ZXI6ZmlsbC1zZWNvbmRibHVlLTUwMFwiPjwvaT48c3BhbiBjbGFzcz1cInNtYWxsLWNhcHMgYmxvY2sgbXgtYXV0byBwLTAgaGlkZGVuXCI+JHtcbiAgICAgICAgICAgICAgICAgIHRoaXMucGFyYW1zLnNocmlua308L3NwYW4+YDtcbiAgICBjb250YWluZXIucGFyZW50RWxlbWVudC5pbnNlcnRCZWZvcmUoYnRuLCBjb250YWluZXIubmV4dEVsZW1lbnRTaWJsaW5nKTtcbiAgICBjb250YWluZXIuY2xhc3NMaXN0LmFkZCgnb3ZlcmZsb3cteS1oaWRkZW4nKTtcbiAgICBjb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgnbWF4LXRhYnN0YXQtaCcpO1xuICAgIGNvbnRhaW5lci5wYXJlbnRFbGVtZW50LnN0eWxlLmhlaWdodCA9ICdhdXRvJztcbiAgICBjb25zdCBoID0gcGFyc2VJbnQodGhpcy53cmFwcGVyLnF1ZXJ5U2VsZWN0b3IoJ3Rib2R5IHRyJykub2Zmc2V0SGVpZ2h0KSAqICgodGhpcy5wYXJhbXMubWF4cm93cykgPyB0aGlzLnBhcmFtcy5tYXhyb3dzIDogMjApO1xuICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdtYXgtaC1bJyArIGggKyAncHhdJyk7XG4gICAgY29udGFpbmVyLnN0eWxlLmhlaWdodCA9IGggKyAncHgnO1xuICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICB0aGlzLmNsb3NlU2hvd2Z1bGwoKTtcbiAgICAgIGJ0bi5jbGFzc0xpc3QudG9nZ2xlKCdib3JkZXItdCcpO1xuICAgICAgYnRuLmNsYXNzTGlzdC50b2dnbGUoJ2JvcmRlci1iJyk7XG4gICAgICBjb25zdCBpY28gPSBidG4ucXVlcnlTZWxlY3RvcignaScpO1xuICAgICAgaWNvLmNsYXNzTGlzdC50b2dnbGUoJ2ljb24tY2hldnJvbi1kb3duJyk7XG4gICAgICBpY28uY2xhc3NMaXN0LnRvZ2dsZSgnaWNvbi1jaGV2cm9uLXVwJyk7XG4gICAgICBjb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgnb3ZlcmZsb3cteS1oaWRkZW4nKTtcbiAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdtYXgtaC1bJyArIGggKyAncHhdJyk7XG4gICAgICBidG4ucXVlcnlTZWxlY3RvckFsbCgnc3BhbicpLmZvckVhY2goc3BhbiA9PiB7XG4gICAgICAgIHNwYW4uY2xhc3NMaXN0LnRvZ2dsZSgnaGlkZGVuJyk7XG4gICAgICB9KTtcbiAgICAgIGlmIChjb250YWluZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdvdmVyZmxvdy15LWhpZGRlbicpKSBjb250YWluZXIuc3R5bGUuaGVpZ2h0ID0gaCArICdweCc7XG4gICAgICBlbHNlIGNvbnRhaW5lci5zdHlsZS5oZWlnaHQgPSAnYXV0byc7XG4gICAgfSk7XG4gIH1cbiAgbWFrZUV4cG9ydGFibGUoY29udGFpbmVyKSB7XG4gICAgY29uc3QgYnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgYnRuLmNsYXNzTGlzdC5hZGQodGFibGVzZWxlY3RvcnMuZXhwb3J0LnNsaWNlKDEpKTtcbiAgICBidG4uY2xhc3NMaXN0LmFkZCgnaXMtcGljaycpO1xuICAgIGJ0bi5pbm5lckhUTUwgPSBgPGkgY2xhc3M9XCJpY29uIGljb24tYXJyb3ctZG93bi1vbi1zcXVhcmVcIj48L2k+PHNwYW4+JHsoKHRoaXMucGFyYW1zLmV4cG9ydGxhYmVsKSA/IHRoaXMucGFyYW1zLmV4cG9ydGxhYmVsIDogJ2V4cG9ydCBzdGF0aXN0aWNzICcpfTwvc3Bhbj5gO1xuICAgIHRoaXMud3JhcHBlci5wcmVwZW5kKGJ0bik7XG4gICAgY29uc3QgY29sdW1ucyA9IHRoaXMuZ3JpZC5jb2x1bW5zO1xuICAgIGxldCBleGNsdWRlX2NvbHVtbnMgPSBbXTtcbiAgICB0aGlzLmdyaWQuY29sdW1ucy5mb3JFYWNoKChjb2x1bW4sIGluZGV4KSA9PiB7XG4gICAgICBpZiAoY29sdW1uLm5hbWUgPT09ICdzZWxlY3QnKSBleGNsdWRlX2NvbHVtbnMucHVzaChjb2x1bW4uaW5kZXgpO1xuICAgIH0pO1xuICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jIChlKSA9PiB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBpZiAoIXRoaXMuZHluYW1pY3MpIHRoaXMuZHluYW1pY3MgPSB7fTtcbiAgICAgIGlmICghdGhpcy5keW5hbWljcy5leHBvcnRDU1YpIHtcbiAgICAgICAgY29uc3Qge1xuICAgICAgICAgIGV4cG9ydENTViAvLyBvciBleHBvcnRKU09OLCBleHBvcnRTUUxcbiAgICAgICAgfSA9IGF3YWl0XG4gICAgICAgIGltcG9ydChcIi4uL21vZHVsZXMvanMtZXhwb3J0LWNzdi5qc1wiKTtcblxuICAgICAgICB0aGlzLmR5bmFtaWNzLmV4cG9ydENTViA9IGV4cG9ydENTVjtcbiAgICAgIH1cbiAgICAgIGxldCBzdHIgPSB0aGlzLmR5bmFtaWNzLmV4cG9ydENTVih0aGlzLCB7XG4gICAgICAgIGRvd25sb2FkOiBmYWxzZSxcbiAgICAgICAgbGluZWRlbGltaXRlcjogXCJcXG5cIixcbiAgICAgICAgY29sdW1uZGVsaW1pdGVyOiBcIlxcdFwiLFxuICAgICAgICBza2lwY29sdW1uczogZXhjbHVkZV9jb2x1bW5zXG4gICAgICB9KTtcbiAgICAgIHN0ciA9IGVuY29kZVVSSShgZGF0YTp0ZXh0L3RzdjtjaGFyc2V0PXV0Zi04LCR7c3RyfWApO1xuXG4gICAgICBkb3dubG9hZF91cmwoc3RyLCAoKGNvbnRhaW5lci5pZCkgPyBjb250YWluZXIuaWQgOiAnc3RhdHNfcHJvaicpICsgJy50c3YnKTtcblxuICAgIH0pO1xuICB9XG4gIGluaXRUaXBzKCkge1xuICAgIC8vIHNob3cgYmlnIGNlbGwgY29udGVudFxuICAgIGxldCBjdXJyZW50ID0gbnVsbDtcbiAgICB0aGlzLmRvbS5xdWVyeVNlbGVjdG9yQWxsKHRhYmxlc2VsZWN0b3JzLnRpcCkuZm9yRWFjaCh0aXAgPT4ge1xuICAgICAgdGlwLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZW50ZXInLCAoZSkgPT4ge1xuICAgICAgICBpZiAodGlwLmNsYXNzTGlzdC5jb250YWlucyh0YWJsZWNzcy5zaG93ZnVsbCkgfHwgKHRpcC5zY3JvbGxIZWlnaHQgPiB0aXAub2Zmc2V0SGVpZ2h0KSkge1xuICAgICAgICAgIHRpcC5zdHlsZS5jdXJzb3IgPSAncG9pbnRlcic7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgdGlwLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgY29uc3Qgc3R5bGVwYXJlbnQgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSh0aXAucGFyZW50RWxlbWVudCk7XG4gICAgICAgIGNvbnN0IHN0eWxlID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUodGlwLnBhcmVudEVsZW1lbnQpO1xuICAgICAgICBpZiAodGlwLmNsYXNzTGlzdC5jb250YWlucyh0YWJsZWNzcy5zaG93ZnVsbCkpIHtcbiAgICAgICAgICB0aXAuY2xhc3NMaXN0LnJlbW92ZSh0YWJsZWNzcy5zaG93ZnVsbCk7XG4gICAgICAgICAgdGlwLnBhcmVudEVsZW1lbnQuc3R5bGUubWluSGVpZ2h0ID0gJ25vbmUnO1xuICAgICAgICAgIHRpcC5wYXJlbnRFbGVtZW50LnN0eWxlLmhlaWdodCA9ICdhdXRvJztcbiAgICAgICAgICB0aXAuc3R5bGUubWF4V2lkdGggPSB0aXAuc3R5bGUubWluV2lkdGggPSAnbm9uZSc7XG4gICAgICAgICAgaWYgKHRpcC5kYXRhc2V0LnApIHtcbiAgICAgICAgICAgIHRpcC5zdHlsZS5wYWRkaW5nTGVmdCA9IHRpcC5kYXRhc2V0LnAubDtcbiAgICAgICAgICAgIHRpcC5zdHlsZS5wYWRkaW5nUmlnaHQgPSB0aXAuZGF0YXNldC5wLnI7XG4gICAgICAgICAgICB0aXAuc3R5bGUucGFkZGluZ1RvcCA9IHRpcC5kYXRhc2V0LnAudDtcbiAgICAgICAgICAgIHRpcC5zdHlsZS5wYWRkaW5nTGVmdCA9IHRpcC5kYXRhc2V0LnAuYjtcbiAgICAgICAgICB9XG4gICAgICAgICAgY3VycmVudCA9IG51bGw7XG4gICAgICAgIH0gZWxzZSBpZiAodGlwLnNjcm9sbEhlaWdodCA+IHRpcC5vZmZzZXRIZWlnaHQpIHtcbiAgICAgICAgICBpZiAoY3VycmVudCkgY3VycmVudC5jbGFzc0xpc3QucmVtb3ZlKHRhYmxlY3NzLnNob3dmdWxsKTtcblxuICAgICAgICAgIGNvbnN0IGggPSBwYXJzZUludCh0aXAuY2xpZW50SGVpZ2h0KTtcbiAgICAgICAgICB0aXAucGFyZW50RWxlbWVudC5zdHlsZS5taW5IZWlnaHQgPSB0aXAucGFyZW50RWxlbWVudC5zdHlsZS5oZWlnaHQgPSAoKChoIDwgcGFyc2VJbnQoc3R5bGVwYXJlbnQubWF4SGVpZ2h0KSkgPyBoIDogcGFyc2VJbnQoc3R5bGVwYXJlbnQubWF4SGVpZ2h0KSkgLSAyICogcGFyc2VJbnQoc3R5bGVwYXJlbnQucGFkZGluZykpICsgJ3B4JztcblxuICAgICAgICAgIGlmICghdGlwLmRhdGFzZXQucCkgdGlwLmRhdGFzZXQucCA9IHtcbiAgICAgICAgICAgIGw6IHN0eWxlLnBhZGRpbmdMZWZ0LFxuICAgICAgICAgICAgcjogc3R5bGUucGFkZGluZ1JpZ2h0LFxuICAgICAgICAgICAgdDogc3R5bGUucGFkZGluZ1RvcCxcbiAgICAgICAgICAgIGI6IHN0eWxlLnBhZGRpbmdCb3R0b21cbiAgICAgICAgICB9O1xuICAgICAgICAgIHRpcC5zdHlsZS5tYXhXaWR0aCA9IHRpcC5zdHlsZS5taW5XaWR0aCA9IHRpcC5jbGllbnRXaWR0aCArICdweCc7XG4gICAgICAgICAgdGlwLmNsYXNzTGlzdC5hZGQodGFibGVjc3Muc2hvd2Z1bGwpO1xuICAgICAgICAgIHRpcC5zdHlsZS50b3AgPSAocGFyc2VJbnQodGlwLm9mZnNldFRvcCkgLSBwYXJzZUludChzdHlsZXBhcmVudC5wYWRkaW5nKSkgKyAncHgnO1xuXG4gICAgICAgICAgY3VycmVudCA9IHRpcDtcbiAgICAgICAgfVxuXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuICB0b2dnbGVBZGRPbnMobGlzdCA9IG51bGwsIG9uID0gZmFsc2UpIHtcbiAgICBsaXN0ID0gKGxpc3QpID8gbGlzdCA6IFt0YWJsZXNlbGVjdG9ycy5zZWFyY2ggKyAnIGlucHV0JywgdGFibGVzZWxlY3RvcnMuZXhwb3J0XTtcbiAgICBjb25zdCBhZGRvbnMgPSBbXTtcbiAgICBsZXQgYWRkb247XG4gICAgbGlzdC5mb3JFYWNoKGFkZG9uID0+IHtcbiAgICAgIGFkZG9uID0gdGhpcy53cmFwcGVyLnF1ZXJ5U2VsZWN0b3IoYWRkb24pO1xuICAgICAgaWYgKGFkZG9uKSB7XG4gICAgICAgIGlmIChvbikgYWRkb24uY2xhc3NMaXN0LnJlbW92ZShjc3MuaGlkZSlcbiAgICAgICAgZWxzZSBhZGRvbi5jbGFzc0xpc3QuYWRkKGNzcy5oaWRlKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG59Il0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/modules/table-component.js\n")},"?4f7e":()=>{}}]);