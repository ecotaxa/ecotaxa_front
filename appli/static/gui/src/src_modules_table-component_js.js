/*! For license information please see src_modules_table-component_js.js.LICENSE.txt */
(self.webpackChunk=self.webpackChunk||[]).push([["src_modules_table-component_js"],{"./src/modules/table-component.js":(module,__webpack_exports__,__webpack_require__)=>{"use strict";eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   TableComponent: () => (/* binding */ TableComponent)\n/* harmony export */ });\n/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! dompurify */ \"./node_modules/dompurify/dist/purify.es.mjs\");\n/* harmony import */ var deep_equal__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! deep-equal */ \"./node_modules/deep-equal/index.js\");\n/* harmony import */ var deep_equal__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(deep_equal__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _modules_utils_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../modules/utils.js */ \"./src/modules/utils.js\");\n/* harmony import */ var _modules_module_event_emitter_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../modules/module-event-emitter.js */ \"./src/modules/module-event-emitter.js\");\n/* harmony import */ var _modules_text_highlight_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../modules/text-highlight.js */ \"./src/modules/text-highlight.js\");\n/* harmony import */ var debounce__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! debounce */ \"./node_modules/debounce/index.js\");\n/* harmony import */ var debounce__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(debounce__WEBPACK_IMPORTED_MODULE_6__);\n/* harmony import */ var _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../modules/modules-config.js */ \"./src/modules/modules-config.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_modules_module_event_emitter_js__WEBPACK_IMPORTED_MODULE_3__]);\n_modules_module_event_emitter_js__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n\n\n\nlet instance = [];\n// valid fetch urlparts\nconst fetchfroms = {\n  collectionlist: '/gui/collectionlist/',\n  prjlist: '/gui/prjlist/',\n  prjsamplestats: '/gui/prjsamplestats',\n  userslist: '/gui/admin/userslist/',\n  guestslist:'/gui/guestslist/',\n  organizationslist:'/gui/organizationslist/',\n  prjpredict: '/gui/prjsforprediction/'\n};\n// specifc css\nconst tablecss = {\n  showfull: 'showfull',\n  tipinline: \"tip-inline\",\n  searchresults: \"search-results\",\n  selectaction: \"selectaction\",\n  absinput: 'absinput',\n  disabled: 'table-disabled',\n  ascending: 'table-ascending',\n  descending: 'table-descending',\n  tipover: 'tipover absolute z-10 text-stone-50 rounded-sm bg-stone-600 px-2 py-0.5 -mt-5 ml-12 ',\n  hide: 'hide',\n  nowrap: 'truncate',\n  buttonexpand: 'button-expand',\n  bordert: 'border-t',\n  borderb: 'border-b',\n  maxtabstath: 'max-tabstat-h',\n  overflowyhidden: 'overflow-y-hidden',\n  icochevrondown: 'icon-chevron-down',\n  iconchevronup: 'icon-chevron-up',\n  pointer: 'cursor-pointer',\n  hidden: 'hidden',\n};\nconst tableselectors = {\n  table: '.table-table',\n  wrapper: '.table-wrapper',\n  top: '.table-top',\n  input: '.table-input',\n  search: '.table-search',\n  export: '.button-export',\n  filters: '.table-filters',\n  sorter: '.table-sorter',\n  details: 'details[data-what=\"about\"]',\n  tip: '.' + _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.component.table.tip,\n  tipover: '.tipover',\n  wait: 'wait-please',\n  sorton: '.sorton',\n};\nObject.freeze(tablecss);\nObject.freeze(tableselectors);\nconst NOTFOUND = '#NOTFOUND#';\nclass TableComponent {\n  uuid = null;\n  grid = {\n    columns: [],\n    active: [],\n    hidden: [],\n    data: []\n  };\n  domdef = {\n    columns: [],\n    data: [],\n  };\n  wrapper = null;\n  dom = null;\n  params = null;\n  _events = {};\n  eventnames = {\n    init: \"table.init\",\n    update: \"table.update\",\n    refresh: \"table.refresh\",\n    resize: \"table.resize\",\n    search: \"table.search\",\n    searchend: \"table.searchend\",\n    sorting: \"table.sorting\",\n    sorted: \"table.sorted\",\n    load: \"table.loaded\",\n    dismiss: 'table.dismiss'\n  }\n  labels = {\n    placeholder: \"Search...\",\n    perPage: \"{select} entries per page\",\n    noRows: \"No entries found\",\n    info: \"Showing {start} to {end} of {rows} entries\",\n    noResults: \"No result match your search query\"\n  };\n  cellidname = \"id\";\n  searching = false;\n  sorting = false;\n  initialized = false;\n  plugins = {};\n  constructor(container, options = {}) {\n    if (!container) return;\n    container = container instanceof HTMLElement ? container : document.querySelector(container);\n    if (!container) return;\n    //can select multiples tables in one page  or load data in the same table\n    this.uuid = (container.dataset.uuid) ? container.dataset.uuid : (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_2__.generate_uuid)();\n    if (!instance[this.uuid] || !deep_equal__WEBPACK_IMPORTED_MODULE_1___default()(container.dataset, instance[this.uuid].params)) {\n      this.init(container);\n    } else this.refresh();\n    return instance[this.uuid];\n\n  }\n  init(container) {\n    this.params = container.dataset;\n    let table = container.querySelector('table');\n    if (!table) {\n      table = document.createElement('table');\n      container.appendChild(table);\n    }\n    table.id = 'table-' + container.id;\n    table.classList.add(tableselectors.table.substr(1))\n    this.dom = table;\n    let top = {\n      nodename: \"DIV\",\n      attributes: {\n        class: tableselectors.top.substr(1)\n      }\n    };\n\n    let wrapper = this.objToElement({\n      nodename: 'DIV',\n      attributes: {\n        class: tableselectors.wrapper.substr(1)\n      },\n      childnodes: [top]\n    });\n    container.appendChild(wrapper);\n    wrapper.appendChild(table);\n    this.wrapper = wrapper;\n    this.labels = (this.params.labels) ? this.params.labels : this.labels;\n    // cellid\n    this.cellidname = (this.params.hasOwnProperty(\"cellid\")) ? this.params.cellid : this.cellidname;\n    // only valid from values - fetchfroms\n    this.params.from = (this.params.from) ? dompurify__WEBPACK_IMPORTED_MODULE_0__[\"default\"].sanitize(this.params.from) : null;\n    const from = (this.params.from) ? ((Object.keys(fetchfroms).indexOf(this.params.from) >= 0) ? fetchfroms[this.params.from] : null) : null;\n    this.dom.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.hide);\n    if (from) {\n      if (this.params.defer) this.deferLoad(container, from);\n      else this.fetchData(container, from);\n    } else this.tableActivate(container);\n\n    this.dt = Date.now();\n  }\n\n  waitActivate(container) {\n    let waitdiv = container.querySelector('#' + tableselectors.wait);\n    if (!waitdiv) {\n      waitdiv = document.createElement('div');\n      waitdiv.id = tableselectors.wait;\n      container.append(waitdiv);\n    }\n    this.waitdiv = waitdiv;\n  }\n\n  waitDeactivate(message = null, type = 'info') {\n    if (!this.waitdiv) return;\n    if (message) {\n      this.waitdiv.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.hide);\n      if (type === null) this.waitdiv.innerHTML = `${message}`;\n      this.waitdiv.innerHTML = `<div class=\"alert is-${type}\">${message}</div>`;\n    } else this.waitdiv.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.hide);\n  }\n\n  deferLoad(container, from) {\n    const btn = container.querySelector(this.params.defer);\n    if (!btn) return;\n\n    btn.addEventListener('click', (e) => {\n      this.fetchData(container, from);\n      btn.remove();\n    });\n  }\n\n  fetchData(container, fromurl, pagestart = 0) {\n    this.waitActivate(container);\n    const pagesize = (this.params.pagesize) ? this.params.pagesize : 0;\n    let from = fromurl;\n    if (this.params.fromid) from += '/' + this.params.fromid;\n    let query = (this.params.import) ? {\n      typeimport: dompurify__WEBPACK_IMPORTED_MODULE_0__[\"default\"].sanitize(this.params.import),\n      gz: true,\n    } : {};\n    if (pagesize) {\n      query.window_start = pagestart;\n      query.window_size = pagesize;\n    }\n    if (this.params.listall) query.listall = this.params.listall;\n    const queryparams = new URLSearchParams(window.location.search);\n    const querykeys = this.cellidname + 's';\n    if (querykeys.length) {\n      for (const entry of queryparams.entries()) {\n        if (querykeys.indexOf(entry[0]) >= 0) query[entry[0]] = entry[1];\n      }\n    }\n    if (Object.keys(query).length) from += '?' + new URLSearchParams(query);\n    this.dt = Date.now();\n    fetch(from, (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_2__.fetchSettings)()).then(response => {\n      if (response.ok) return response.json();\n      else return Promise.reject(response);\n    }).then(async tabledef => {\n      if (this.waitdiv) this.waitdiv.innerHTML = ((this.waitdiv.dataset.loaded) ? dompurify__WEBPACK_IMPORTED_MODULE_0__[\"default\"].sanitize(this.waitdiv.dataset.loaded) : _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.default_messages.dataloaded);\n      if (pagestart > 0) {\n        if (tabledef.data.length) {\n          this.domInsertRows(tabledef);\n        } else pagesize = 0;\n      }\n      if (pagesize === 0) {\n        let now = Date.now();\n        console.log('seconds to fetch ', (Date.now() - this.dt) / 1000);\n        this.dt = now;\n        if (tabledef.data.length || pagestart > 0) await this.tableActivate(container, tabledef);\n        else this.waitDeactivate('no result', 'default');\n        now = Date.now();\n        console.log('plugins loaded', (Date.now() - this.dt) / 1000);\n        this.dt = now;\n      } else this.fetchData(container, fromurl, pagestart + pagesize);\n\n    }).catch((err) => { /* print error from response */\n      console.log('error', err);\n      this.waitDeactivate(err.status + ` ` + err.statusText, 'error');\n    });\n  }\n\n  async dataToTable(tabledef) {\n    if (!tabledef.data) return;\n    if (tabledef.columns) {\n      await this.convertColumns(tabledef);\n      let tr;\n      let thead = this.dom.tHead;\n      if (!thead) {\n        // create table headings\n        thead = document.createElement('thead');\n        tr = document.createElement('tr');\n        this.dom.appendChild(thead);\n      } else if (!thead.querySelector('tr')) {\n        tr = document.createElement('tr');\n\n      } else {\n        tr = thead.querySelector('tr');\n        tr.innerHTML = ``;\n      }\n      let tbody = (this.dom.tBodies.length) ? this.dom.tBodies[0] : null;\n      if (!tbody) {\n        tbody = document.createElement('tbody');\n        this.dom.appendChild(tbody);\n      }\n      const isjson = (!tabledef.hasOwnProperty('data') || (tabledef.hasOwnProperty('type') && tabledef.type === \"json\"));\n      this.grid.columns.forEach((column, index) => {\n\n        if (!column.hidden) {\n          const th = document.createElement('th');\n          th.innerHTML = dompurify__WEBPACK_IMPORTED_MODULE_0__[\"default\"].sanitize(column.label);\n          if (column.sort) th.dataset.sort = column.sort;\n          if (column.format) th.dataset.type = column.type;\n          if (column.name) th.dataset.name = column.name;\n          // TODO - find a place to define col import props\n          // set headings dataset values for import module\n          if (this.params.import)['selectcells', 'what', 'autocomplete', 'parts', 'value'].forEach(prop => {\n            if (column.hasOwnProperty(prop))  th.dataset[prop] = column[prop];\n          });\n          th.dataset.sortable = (column.sortable) ? true : false;\n          tr.appendChild(th);\n          this.grid.active.push(index);\n        } else this.grid.hidden.push(index);\n\n      });\n\n\n      thead.appendChild(tr);\n      const datalastused = (this.params.lastused && this.params.lastused.length > 0) ? [] : null;\n      //#TODO lastused reorder\n      if (isjson) {\n        this.grid.data = [];\n        tabledef.data.forEach((data, i) => {\n          const row = [];\n          let j = 0;\n          Object.entries(tabledef.columns).forEach(([key, column], i) => {\n            if (!column.hasOwnProperty('emptydata')) {\n              if (data.hasOwnProperty(key)) row[j] = data[key];\n              else if (column.field && data.hasOwnProperty(column.field)) row[j] = data[column.field];\n              else row[j] = null;\n              j++;\n            }\n          });\n          this.grid.data.push(row);\n        });\n      } else this.grid.data = tabledef.data;\n\n      const tfoot = this.dom.tFoot;\n      if (this.grid.active.length === 0) {\n        tbody.innerHTML = `<tr><td>${this.labels.noRows}</td</tr>`;\n        if (tfoot) tfoot.remove();\n        return;\n      } else if (tfoot && tfoot.querySelector('tr')) {\n        const tf = tfoot.querySelector('tr').childNodes;\n        this.grid.hidden.forEach(i => {\n          tf[i].remove();\n        });\n      };\n\n      this.renderTbody(tbody);\n    }\n  }\n\n  tableToData() {\n    if (!this.dom.querySelector('thead')) {this.dom.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.hide);return;}\n    const datalastused = (this.params.lastused && this.params.lastused.length > 0) ? [] : null;\n    this.dom.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.hide);\n    const cell_to_obj = (cell) => {\n      const celltext = cell.innerText;\n      const obj = {\n        data: celltext,\n      }\n      const cellhtml = cell.innerHTML;\n      if (celltext !== cellhtml) obj.html = cellhtml;\n      return obj;\n    }\n    const ths = (this.dom.querySelectorAll('thead tr th').length) ? this.dom.querySelectorAll('thead tr th') : this.dom.querySelectorAll('thead tr td');\n    const trs = this.dom.querySelectorAll('tbody tr');\n    let active = 0,\n      hidden = 0;\n\n    function find_label(th) {\n      if (th.childNodes.length) return find_label(th.childNodes[0]);\n      else return th.innerText;\n    }\n    ths.forEach((th, index) => {\n      const col = Object.assign({}, th.dataset);\n      if (col.mask) th.classList.add(tablecss.hidden);\n      if (col.hidden && (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_2__.string_to_boolean)(col.hidden)) {\n        col.hidden = true;\n        th.remove();\n      }\n      col.label = find_label(th);\n      if (col.type) {\n        col.format = col.type;\n        delete col.type;\n      }\n      col.index = index;\n      if (col.hidden) this.grid.hidden.push(index);\n      else this.grid.active.push(index);\n      this.grid.columns.push(col);\n    });\n    const cellid = this.getCellId(this.cellidname);\n    trs.forEach((tr, i) => {\n      if (cellid < 0) tr.dataset[this.cellidname] = i;\n      else if (i === cellid) tr.dataset[this.cellidname] = this.getCellData(i, this.cellidname, cellid);\n      const data = [];\n      tr.querySelectorAll('th,td').forEach((td, index) => {\n        if (this.grid.columns[index].hasOwnProperty('mask')) td.classList.add(tablecss.hidden);\n        if (this.grid.hidden.indexOf(index) >= 0) td.remove();\n        data.push(td.innerText);\n      });\n      this.grid.data.push(data)\n    });\n\n    this.dom.querySelectorAll('tfoot tr th').forEach((td, index) => {\n      if (this.grid.columns[index].hasOwnProperty('mask')) td.classList.add(tablecss.hidden);\n      if (this.grid.hidden.indexOf(index) >= 0) td.remove();\n    });\n    this.dom.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.hide);\n    return;\n  }\n  renderTbody(tbody) {\n    const l = this.grid.data.length;\n    for (let i = 0; i < l; i++) {\n      const tr = this.createTableRow(this.grid.data[i], i);\n      tbody.append(tr);\n    };\n\n\n\n  }\n  async tableActivate(container, tabledef = null) {\n    _modules_module_event_emitter_js__WEBPACK_IMPORTED_MODULE_3__.ModuleEventEmitter.once(this.eventnames.load, () => {\n      this.initPlugins(container);\n      this.initSearch();\n      this.initSort();\n      this.waitDeactivate();\n      // hide and move waitdiv in the wrapper for inner elements display\n      this.dom.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.hide);\n      if (this.afterLoad) this.afterLoad();\n      // move import zones and/or search zone - reorg the page display\n      // fetch once the same table\n      container.dataset.table = this.params.table = true;\n      this.initialized = true;\n    }, this.uuid);\n    // dismiss table when dismiss modal\n    _modules_module_event_emitter_js__WEBPACK_IMPORTED_MODULE_3__.ModuleEventEmitter.once(this.eventnames.dismiss, (e) => {\n      this.destroy();\n    }, this.uuid);\n    if (tabledef) tabledef = await this.dataToTable(tabledef);\n    else await this.tableToData();\n    if (this.grid.data.length) _modules_module_event_emitter_js__WEBPACK_IMPORTED_MODULE_3__.ModuleEventEmitter.emit(this.eventnames.load, {}, this.uuid);\n    instance[this.uuid] = true;\n  }\n\n  tableAppendRows(rows) {\n    console.log('rows');\n  }\n  destroy() {\n    if (this.dataImport) this.dataImport = null;\n    this.dom = null;\n    delete instance[this.uuid];\n  }\n\n  refresh(e) {\n    if (this.dataImport) this.dataImport.resetSelectors();\n  }\n  labelFormatter(column) {\n    let align = ``;\n    if (['number', 'progress', 'decimal'].find(format => format === column.format)) align = _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.right;\n    if (column.subfield) return `${column.label} <span class=\"sublabel\">${column.sublabel}</span>`;\n    else if (column.label) return `<span class=\"${align}\">${column.label}</span>`;\n    else return ``;\n  }\n  getCellId(name) {\n    let cols = this.grid.columns.filter(column => (column.name === name));\n    return (cols.length) ? cols[0].index : -1;\n  }\n\n  getCellData(rowIndex, name, cellIndex = null) {\n    cellIndex = (cellIndex === null) ? this.getCellId(name) : cellIndex;\n    if (cellIndex < 0) return null;\n    return (this.grid.data.length) ? ((this.grid.data[rowIndex]) ? this.grid.data[rowIndex][cellIndex] : null) : null;\n  }\n\n  rowAttributes(tr, index) {\n    const id = this.getCellData(index, this.cellidname);\n    tr.dataset[this.cellidname] = id;\n    if (this.setRowAttributes) tr = this.setRowAttributes(this, tr, id);\n    return tr;\n  }\n\n  createTableRow(row, index, isheader = false) {\n    const tr = document.createElement('tr');\n    let td;\n    this.grid.columns.forEach(column => {\n      if (column.hasOwnProperty('hidden') && column.hidden === true) return;\n      const cell = row[column.index];\n      if (column.hasOwnProperty(\"render\")) {\n        td = column.render(cell, index, column.index);\n        td.nodename = (isheader) ? 'TH' : 'TD';\n        td = this.objToElement(td);\n      } else {\n        td = (isheader) ? document.createElement('th') : document.createElement('td');\n        td.appendChild(document.createTextNode(cell));\n      }\n      tr.appendChild(td);\n    })\n    return this.rowAttributes(tr, index);\n  }\n\n  objToElement(obj) {\n    if (obj.nodename === \"#text\") return document.createTextNode(obj.data);\n    const el = document.createElement(obj.nodename);\n    if (obj.hasOwnProperty(\"html\")) el.innerHTML = obj.html;\n    else el.textContent = obj.data;\n    if (obj.hasOwnProperty(\"attributes\")) {\n      for (const attr in obj.attributes) {\n        el.setAttribute(attr, obj.attributes[attr]);\n      }\n    }\n    if (obj.hasOwnProperty(\"childnodes\")) {\n      obj.childnodes.forEach(childnode => {\n\n        el.appendChild(this.objToElement(childnode));\n      });\n\n    }\n    return el;\n  }\n\n  setTextNode(value) {\n    return {\n      nodename: \"#text\",\n      data: value\n    };\n  }\n  async getFormatters() {\n    let formatters = {\n      controls: (value, rowIndex, cellIndex, td = {}) => {\n        const column = this.grid.columns[cellIndex];\n        const id = this.getCellData(rowIndex, column.field);\n        const actions = (column.actions) ? column.actions : null;\n        if (!actions) return ``;\n        let controls = [];\n        Object.entries(actions).forEach(([key, action]) => {\n          controls.push({\n            nodename: \"A\",\n            attributes: {\n              class: `btn is-${key} `,\n              href: `${action.link}${id}`\n            },\n            childnodes: [this.setTextNode(action.label)]\n          });\n\n        });\n        if (!td.hasOwnProperty('attributes')) td.attributes = {};\n        td.attributes.class = _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.component.table.controls;\n        td.childnodes = controls;\n        return td;\n      },\n      select: (value, rowIndex, cellIndex, td = {}) => {\n        const column = this.grid.columns[cellIndex];\n        value = (isNaN(value)) ? this.getCellData(rowIndex, column.field) : value;\n\n        td.childnodes = [{\n          nodename: \"INPUT\",\n          attributes: {\n            type: \"radio\",\n            name: `${this.uuid}select`,\n            value: String(value)\n          }\n        }];\n        return td;\n      },\n      selectmultiple: (value, rowIndex, cellIndex, td = {}) => {\n        const column = this.grid.columns[cellIndex];\n        value = (isNaN(value)) ? ((column.hasOwnProperty('field')) ? this.getCellData(rowIndex, column.field) : value) : value;\n        td.childnodes = [{\n          nodename: \"INPUT\",\n          attributes: {\n            type: \"checkbox\",\n            name: `${this.uuid}select[]`,\n            value: String(value)\n          }\n        }];\n        return td;\n      },\n      decimal: (value, rowIndex, cellIndex, td = {}) => {\n        if (isNaN(value)) value = 0;\n        value = parseFloat(value).toFixed(2);\n        if (value - parseInt(value) === 0) value = parseInt(value);\n        if (!td.hasOwnProperty('attributes')) td.attributes = {};\n        td.attributes.class = _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.number;\n        td.childnodes = [this.setTextNode(value)];\n        return td;\n      },\n      number: (value, rowIndex, cellIndex, td = {}) => {\n        if (isNaN(value)) value = 0;\n        if (!td.hasOwnProperty('attributes')) td.attributes = {};\n        td.attributes.class = _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.number;\n        td.childnodes = [this.setTextNode(value)];\n        return td;\n      },\n      check: (value, rowIndex, cellIndex, td = {}) => {\n        if (isNaN(value)) value = ``;\n        switch (value) {\n          case true:\n          case 'Y':\n          case 1:\n            value = \"\";\n            break;\n          default:\n            value = \"no-\";\n            break;\n        }\n        const icon = {\n          nodename: \"I\",\n          attributes: {\n            class: `icon-sm  icon-${value}check `\n          },\n          childnodes: []\n        }\n        const column = this.grid.columns[cellIndex];\n        const id = this.getCellData(rowIndex, this.cellidname);\n        if (column.hasOwnProperty(\"toggle\")) td.childnodes = [{\n          nodename: \"A\",\n          attributes: {\n            \"data-request\": \"toggle\",\n            \"data-action\": `${column.toggle.link}/${id}`,\n            \"href\": \"javascript:void()\"\n\n          },\n          childnodes: [icon]\n\n        }]\n        else td.childnodes = [icon];\n        return td;\n      },\n      text: (value, rowIndex, cellIndex, td = {}) => {\n        if (value === null) td.childnodes = [];\n        else {\n          value = value.replaceAll('\\r\\n', ', ');\n          if (value !== ``) td.childnodes = [{\n            nodename: \"DIV\",\n            attributes: {\n              class: _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.component.table.tip\n            },\n            childnodes: [this.setTextNode(value)]\n          }];\n          else td.childnodes = [];\n        }\n        return td;\n      },\n      default: (value, rowIndex, cellIndex, td = {}) => {\n        if (value === null || value === ``) td.childnodes = [];\n        else td.childnodes = [this.setTextNode(value)];\n        return td;\n      }\n\n    }\n    let tablecustom = null;\n\n    switch (this.params.from) {\n      case 'collectionlist':\n        tablecustom = await __webpack_require__.e(/*! import() */ \"src_modules_table-collection_js\").then(__webpack_require__.bind(__webpack_require__, /*! ../modules/table-collection.js */ \"./src/modules/table-collection.js\"));\n        this.cellidname = _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.models.id;\n        break;\n      case 'prjlist':\n        tablecustom = await __webpack_require__.e(/*! import() */ \"src_modules_table-project_js\").then(__webpack_require__.bind(__webpack_require__, /*! ../modules/table-project.js */ \"./src/modules/table-project.js\"));\n        this.cellidname = _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.models.projid;\n        break;\n      case 'prjsamplestats':\n        tablecustom = await __webpack_require__.e(/*! import() */ \"src_modules_table-sample_js\").then(__webpack_require__.bind(__webpack_require__, /*! ../modules/table-sample.js */ \"./src/modules/table-sample.js\"));\n        this.cellidname = _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.models.sampleid;\n        break;\n      case \"prjpredict\":\n        tablecustom = await __webpack_require__.e(/*! import() */ \"src_modules_table-prediction_js\").then(__webpack_require__.bind(__webpack_require__, /*! ../modules/table-prediction.js */ \"./src/modules/table-prediction.js\"));\n        this.cellidname = _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.models.projid;\n\n        break;\n    }\n\n    return (tablecustom) ? { ...formatters,\n      ...tablecustom.default(this)\n    } : formatters;\n\n\n  }\n  async convertColumns(tabledef) {\n    const columns = (tabledef.columns) ? tabledef.columns : ((this.params.columns) ? JSON.parse(this.params.columns) : null);\n    if (!columns) return;\n    const formatters = await this.getFormatters();\n    //\n    const fields = [];\n    Object.entries(tabledef.columns).forEach(([key, column]) => {\n      if (!column.hasOwnProperty('emptydata')) fields.push(key);\n    });\n    const map_column = (key, column, index) => {\n      if (!column) return {\n        index: index,\n        name: key,\n        hidden: true\n      };\n      let col = {\n        index: index,\n        name: key,\n        label: this.labelFormatter(column),\n        sortable: true,\n      };\n      col.index = (column.hasOwnProperty('emptydata')) ? fields.indexOf(column.emptydata) : fields.indexOf(key);\n      if (column.notsortable) col.sortable = false;\n      else if (column.sortable) col.sort = col.sortable;\n      col.searchable = (col.notsearchable) ? false : true;\n      if (column.hidden) col.hidden = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_2__.string_to_boolean)(column.hidden);\n      if (['number', 'decimal'].find(format => format === column.format)) col.type = 'number';\n      let render = null;\n      switch (key) {\n        case 'select':\n          const select = (column.select && column.select == \"controls\") ? \"controls\" : ((column.selectcells) ? \"imports\" : column.select);\n          if (select) {\n            col = { ...column,\n              ...col\n            }\n\n            col.sortable = col.searchable = false;\n          }\n          break;\n      }\n      if (!column.hasOwnProperty('hidden')) {\n        const select = (column.select && column.select == _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.models.controls) ? _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.models.controls : ((column.selectcells) ? _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.models.imports : column.select)\n        const format = (column.format) ? column.format : ((column.subfield) ? column.subfield : ((select) ? select : \"default\"));\n        if (formatters && formatters[format]) col.render = formatters[format];\n\n      }\n      return col;\n    }\n\n    this.grid.columns = Object.entries(columns).map(([key, column], index) => map_column(key, column, index));\n  }\n  initEvents() {\n\n    _modules_module_event_emitter_js__WEBPACK_IMPORTED_MODULE_3__.ModuleEventEmitter.on(this.eventnames.update, () => {\n      this.dom.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.hide);\n    }, this.uuid);\n  }\n  initPlugins(container) {\n    if (!this.grid.data.length) return;\n    if (this.params.import && this.initImport) this.initImport(this);\n    if (this.params.expand) this.makeExpandable(container);\n    if (this.params.export) this.makeExportable(container);\n    if (this.params.details || this.dom.querySelector(tableselectors.details)) {\n      this.initDetails();\n    } else this.initEvents();\n    if (this.params.onselect) this.initSelect(container);\n    if (this.dom.querySelectorAll('thead [data-altsort]').length) this.initAlternateSort(this.dom.querySelectorAll('thead [data-altsort]'));\n    if (this.params.filters) {\n      const top = this.wrapper.querySelector(tableselectors.top);\n      if (top && top.children.length) {\n        const filters = document.querySelector(tableselectors.filters);\n        // insert  filters node  in datatable top\n        if (filters) top.prepend(filters);\n      }\n    }\n    if (this.dom.querySelector(tableselectors.tip)) {\n      this.initTips();\n    }\n\n  }\n  initSort() {\n\n    const ths = this.dom.querySelectorAll('thead th');\n    let index = 0;\n    this.grid.columns.forEach((column, i) => {\n      if (column.hasOwnProperty('hidden')) return;\n      if (column.sortable) {\n        const th = ths[index];\n        const a = document.createElement('a');\n        a.classList.add(tableselectors.sorter.substr(1));\n        a.appendChild(th.childNodes[0]);\n        th.appendChild(a);\n        th.childNodes.forEach(child => {\n          th.appendChild(child);\n        });\n\n        a.addEventListener('click', (e) => {\n          e.stopImmediatePropagation();\n          if (this.sorting === true || this.searching === true) {\n            e.preventDefault();\n            return false;\n          }\n          this.sortColumn(th, column.index);\n        });\n      }\n      index++;\n    });\n    this.sorting = false;\n    // remove details when sorting\n    _modules_module_event_emitter_js__WEBPACK_IMPORTED_MODULE_3__.ModuleEventEmitter.on(this.eventnames.sorting, (req) => {\n      // req {dir:direction, index:index}\n      if (this.plugins.jsDetail) this.plugins.jsDetail.activeDetail(false);\n      this.dom.querySelectorAll('.table-sorter').forEach((a, i) => {\n        a.classList.add(((i === req.index) ? _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.wait : _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.disabled));\n      });\n      this.sorting = true;\n    }, this.uuid);\n    // remove details when sorting\n    _modules_module_event_emitter_js__WEBPACK_IMPORTED_MODULE_3__.ModuleEventEmitter.on(this.eventnames.sorted, (req) => {\n      // req {dir:direction, index:index}\n      this.dom.querySelectorAll('.table-sorter').forEach((a, i) => {\n        a.classList.remove(((i === req.index) ? _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.wait : _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.disabled))\n      });\n      this.sorting = false;\n    }, this.uuid);\n  }\n  sortColumn(th, index, dir = null) {\n    dir = (dir === null) ? ((th.classList.contains(tablecss.ascending)) ? false : (th.classList.contains(tablecss.descending)) ? true : ((th.dataset.sort) ? false : true)) : dir;\n    th.classList.toggle(tablecss.ascending);\n    th.classList.toggle(tablecss.descending);\n    _modules_module_event_emitter_js__WEBPACK_IMPORTED_MODULE_3__.ModuleEventEmitter.emit(this.eventnames.sorting, {\n      dir: dir,\n      index: th.cellIndex\n    }, this.uuid);\n    let rows = this.grid.data.map((row, i) => {\n      const cell = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_2__.is_object)(row[index]) ? JSON.stringify(row[index]) : ((Array.isArray(row[index])) ? row[index][0] : row[index]);\n      return {\n        value: typeof cell === \"string\" ? cell.toLowerCase() : ((cell === null) ? 0 : cell),\n        row: i\n      }\n    });\n\n    const compare_coldata = function(a, b) {\n      const x = (dir ? a.value : b.value);\n      const y = (dir ? b.value : a.value);\n      return x.localeCompare(y, undefined, {\n        numeric: true,\n        sensitivity: 'base'\n      });\n\n    };\n\n    if (dir === false) {\n      th.classList.remove(tablecss.ascending);\n      th.classList.add(tablecss.descending);\n      th.setAttribute(\"aria-sort\", \"descending\");\n    } else {\n      th.classList.remove(tablecss.descending);\n      th.classList.add(tablecss.ascending);\n      th.setAttribute(\"aria-sort\", \"ascending\");\n    }\n\n    /* Clear asc/desc class names from the last sorted column's th if it isn't the same as the one that was just clicked */\n    if (this.dom.dataset.lastth !== undefined && th.cellIndex != this.dom.dataset.lastth) {\n      const headings = this.dom.querySelectorAll(\"thead th\");\n      headings[this.dom.dataset.lastth].classList.remove(tablecss.descending);\n      headings[this.dom.dataset.lastth].classList.remove(tablecss.ascending);\n      headings[this.dom.dataset.lastth].removeAttribute(\"aria-sort\");\n\n    }\n    this.dom.dataset.lastth = th.cellIndex;\n    const collator = new Intl.Collator(undefined, {\n      numeric: true,\n      sensitivity: 'base'\n    })\n    rows.sort((a, b) => {\n      return collator.compare((dir ? a.value : b.value), (dir ? b.value : a.value))\n    });\n    /*rows.sort((a, b) => {\n      return compare_coldata(a, b);\n    });*/\n    const tbody = this.dom.querySelector('tbody');\n    const clone = tbody.cloneNode();\n    const trs = tbody.querySelectorAll('tr');\n    tbody.innerHTML = ``;\n    const sorted = [];\n    rows.forEach((r, i) => {\n      clone.appendChild(trs[r.row]);\n      sorted.push(this.grid.data[r.row]);\n\n    });\n    this.dom.replaceChild(clone, tbody);\n    _modules_module_event_emitter_js__WEBPACK_IMPORTED_MODULE_3__.ModuleEventEmitter.emit(this.eventnames.sorted, {\n      dir: dir,\n      index: th.cellIndex\n    }, this.uuid);\n\n\n  }\n\n  displaySelected(queries, indexes, cellid, toggle = null) {\n    const trs = this.dom.querySelectorAll('tbody tr');\n    if (toggle === null) toggle = function(tr, value, idx) {\n     tr.hidden = value;\n    }\n    const reset = (queries.length === 0 && indexes.length === 0);\n    trs.forEach((tr, index) => {\n      if (reset) toggle(tr, false);\n      else {\n        const val = (queries.length > 0 && indexes.length === 0) ? NOTFOUND : (tr.dataset[this.cellidname] !== null) ? tr.dataset[this.cellidname] : tr.cells[cellid].textContent;\n        const idx = indexes.indexOf(val);\n        if (idx < 0) toggle(tr, true, idx);\n        else toggle(tr, false, idx);\n      }\n    });\n  };\n\n  initSearch() {\n    const top = this.wrapper.querySelector(tableselectors.top);\n    if (!this.params.searchable || top === null) return;\n    if (this.grid.data.length < 10) return this.toggleAddOns();\n    else this.toggleAddOns([tableselectors.search + ' input'], false);\n    this.searching = false;\n    const cellid = this.getCellId(this.cellidname);\n    // search items\n    let searchbox = top.querySelector(tableselectors.search);\n    if (searchbox === null) {\n      searchbox = this.objToElement({\n        nodename: 'DIV',\n        attributes: {\n          class: tableselectors.search.substr(1)\n        },\n        childnodes: [{\n          nodename: 'input',\n          attributes: {\n            type: 'search',\n            name: 'table-search',\n            placeholder: this.labels.placeholder,\n            class: `${tableselectors.input.substr(1)} ${_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.input}`\n          }\n        }]\n      });\n      top.appendChild(searchbox);\n    }\n    const searchinput = searchbox.querySelector('input');\n    if (!searchinput) return;\n    let searchstring = ``;\n    const table_search = debounce__WEBPACK_IMPORTED_MODULE_6___default()((searchstring, casesensitive = false) => {\n      function search_string(str, casesensitive) {\n        str = (casesensitive) ? str : str.toLowerCase();\n        return str;\n      }\n\n      function search_queries(str, casesensitive) {\n        str = search_string(str, casesensitive);\n        let strs = [];\n        let phrase;\n        while ((phrase = str.match(/\"([^\"]+)\"/)) !== null) {\n\n          strs.push(phrase[1]);\n          str = str.substring(0, phrase.index) + str.substring(phrase.index + phrase[0].length);\n        }\n        // Get remaining space-separated words (if any)\n        str = str.trim();\n        if (str.length) strs = strs.concat(str.split(/\\s+/));\n        return strs;\n      }\n      const queries = search_queries(searchstring);\n      _modules_module_event_emitter_js__WEBPACK_IMPORTED_MODULE_3__.ModuleEventEmitter.emit(this.eventnames.search, {\n        searchstring: searchstring,\n        queries: queries\n      }, this.uuid);\n      let datas = this.grid.data,\n        indexes = [];\n      queries.forEach(qry => {\n        indexes = [];\n        datas = datas.filter((data, j) => {\n          const found = data.filter(cell => {\n            switch (typeof cell) {\n              case 'object':\n                cell = (cell) ? cell : ``;\n                try {\n                  cell = JSON.stringify(cell);\n                } catch (err) {\n                  console.log('search', err);\n                  cell = ``;\n                }\n                break;\n              case 'array':\n                cell = cell.join(' ');\n                break;\n              default:\n                cell = String(cell);\n                break;\n            }\n            return ((casesensitive) ? cell.indexOf(qry) > -1 : cell.toLowerCase().indexOf(qry)) > -1;\n          });\n\n          if (found.length > 0) {\n            if (cellid < 0) indexes.push(String(j));\n            else indexes.push(String(data[cellid]));\n            return data;\n          }\n        });\n      });\n      _modules_module_event_emitter_js__WEBPACK_IMPORTED_MODULE_3__.ModuleEventEmitter.emit(this.eventnames.searchend, {\n        queries: queries,\n        indexes: indexes,\n        cellid: cellid\n      }, this.uuid);\n    }, 300);\n    const display_search = (queries, indexes, cellid) => {\n      this.displaySelected(queries, indexes, cellid);\n    };\n    const clear_search = debounce__WEBPACK_IMPORTED_MODULE_6___default()(() => {\n      this.searching = true;\n      const trs = this.dom.querySelectorAll('tbody tr[hidden=\"\"]');\n      trs.forEach((tr, index) => {\n        tr.hidden = false;\n      });\n      this.searching = false;\n      searchinput.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.wait);\n    }, 500);\n\n    const search_input = (value) => {\n      if (value !== searchstring) {\n        searchinput.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.wait);\n        searchstring = value;\n        if (value === '') {\n          clear_search();\n        } else if (value.length > 2) {\n          table_search(value);\n        }\n\n      }\n    }\n    searchinput.addEventListener(\"input\", (e) => {\n      search_input(e.target.value);\n    });\n    searchinput.addEventListener(\"click\", (e) => {\n      search_input(e.target.value);\n    });\n    _modules_module_event_emitter_js__WEBPACK_IMPORTED_MODULE_3__.ModuleEventEmitter.on(this.eventnames.search, (req) => {\n      //  request {searchstring:searchstring, queries:queries}\n      if (this.searching === false) {\n        if (this.plugins.jsDetail) this.plugins.jsDetail.activeDetail(false);\n      }\n      this.searching = true;\n    }, this.uuid);\n    _modules_module_event_emitter_js__WEBPACK_IMPORTED_MODULE_3__.ModuleEventEmitter.on(this.eventnames.searchend, (req) => {\n      // req {queries:queries,indexes: indexes, cellid:cellid}\n      display_search(req.queries, req.indexes, req.cellid);\n      searchinput.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.wait);\n      this.searching = false;\n    }, this.uuid);\n    _modules_module_event_emitter_js__WEBPACK_IMPORTED_MODULE_3__.ModuleEventEmitter.on(this.eventnames.update, () => {\n      if (this.searching === false) {\n        setTimeout(() => {\n          refresh_details();\n        }, 300);\n      }\n    }, this.uuid);\n    this.toggleAddOns([tableselectors.search + ' input'], true);\n  }\n  initSelect(container) {\n    const inputs = this.dom.querySelectorAll('input[name^=\"' + this.uuid + '\"]');\n    if (inputs.length === 0) return;\n    const inputname = inputs[0].name;\n    let selectaction = container.querySelector('.' + tablecss.selectaction);\n    if (!selectaction) return;\n    document.body.append(selectaction);\n    selectaction.querySelector('a').addEventListener('click', (e) => {\n      let vals = [];\n      inputs.forEach(input => {\n        if (input.checked) vals.push(input.value);\n      });\n      if (selectaction.dataset.input) {\n        document.getElementById(selectaction.dataset.input).value = vals.join(',');\n        if (selectaction.dataset.form) document.getElementById(selectaction.dataset.form).submit();\n      } else e.currentTarget.href = this.params.onselect + encodeURI(vals.join(','));\n\n    });\n    const close = selectaction.querySelector('[data-dismiss]');\n    if (close) close.addEventListener('click', (e) => {\n      e.preventDefault();\n      e.stopImmediatePropagation();\n      popup_selected(null, null);\n    });\n\n    const popup_selected = (top = null, left = null, forceclose = false) => {\n      if (selectaction.dataset.close) {\n        document.body.append(selectaction);\n        close.classList.remove(tablecss.hidden);\n        selectaction.classList.add(tablecss.absinput);\n      }\n      if (top !== null && left !== null) {\n        selectaction.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.hide);\n        selectaction.style.top = top + 'px';\n        selectaction.style.left = left + 'px';\n\n      } else {\n        if (forceclose === true) {\n          selectaction.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.hide);\n          delete selectaction.dataset.close;\n        } else {\n          selectaction.dataset.close = true;\n          close.classList.add(tablecss.hidden);\n          const toptable = this.wrapper.querySelector(tableselectors.top) ? this.wrapper.querySelector(tableselectors.top) : this.wrapper;\n          toptable.prepend(selectaction);\n          selectaction.classList.remove(tablecss.absinput);\n\n        }\n      }\n    }\n    inputs.forEach(input => {\n      input.addEventListener('change', (e) => {\n        if (input.checked) popup_selected(input.offsetTop, input.offsetLeft);\n        else if (this.dom.querySelectorAll('input[name^=\"' + this.uuid + '\"]:checked').length === 0) popup_selected(null, null, true);\n      });\n    });\n    if (this.dom.querySelectorAll('input[name^=\"' + this.uuid + '\"]:checked').length > 0) {\n      selectaction.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.hide);\n      popup_selected(null, null);\n    }\n  }\n  async initDetails() { // TODO : generic\n    // about - one div to display cell details make it appear as table row expanding\n    const wrapper = this.wrapper;\n    const about = wrapper.querySelector('#' + tablecss.tipinline) ? wrapper.querySelector('#' + tablecss.tipinline) : tablecss.tipinline;\n    if (!this.plugins.JsDetail) {\n      const {\n        JsDetail\n      } = await\n      __webpack_require__.e(/*! import() */ \"src_modules_js-detail_js\").then(__webpack_require__.bind(__webpack_require__, /*! ../modules/js-detail.js */ \"./src/modules/js-detail.js\"));\n      this.plugins.JsDetail = JsDetail;\n    }\n\n    if (!this.plugins.JsAccordion) {\n      const {\n        JsAccordion\n      } = await __webpack_require__.e(/*! import() */ \"src_modules_js-accordion_js\").then(__webpack_require__.bind(__webpack_require__, /*! ../modules/js-accordion.js */ \"./src/modules/js-accordion.js\"));\n      this.plugins.JsAccordion = JsAccordion;\n    }\n    const jsDetail = this.plugins.JsDetail({\n      waitdiv: this.waitdiv\n    });\n\n    const detail = jsDetail.applyTo(about, wrapper); // specific to about details in table\n    // hide / show disable details zone\n    const callbackclose = (el, callback = null) => {\n      const current = jsDetail.activeDetail(false);\n      if (callback) callback();\n    }\n\n    const callbackopen = (el, callback = null) => {\n      let current = jsDetail.activeDetail(true);\n      if (current && current === el) {\n        current = jsDetail.expandDetail(el);\n        if (callback) callback();\n      } else {\n        if (current) current.querySelector('summary').click();\n        const url = this.params.detailsurl + el.dataset.id + '?' +\n          new URLSearchParams({\n            partial: true\n          });\n        current = jsDetail.activeDetail(true);\n        // append to cell details and display\n        fetch(url, (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_2__.fetchSettings)()).then(response => response.text()).then(html => {\n          current = jsDetail.expandDetail(el, html);\n          if (callback) callback();\n        }).catch(err => {\n          console.log('request', err);\n        })\n      }\n\n    }\n\n    const refresh_details = () => {\n      const details = this.dom.querySelectorAll(tableselectors.details);\n      if (!details) return;\n      /*details.forEach(item => {\n        if (!item.dataset.id) return;\n        item =new this.plugins.JsAccordion(item, callbackopen, callbackclose, detail);\n      });*/\n      this.plugins.JsAccordion.applyTo(details, callbackopen, callbackclose, detail);\n    }\n    refresh_details();\n  }\n\n  initAlternateSort(cols) {\n\n    let tdcols = [];\n    cols.forEach(col => {\n      const tdcol = col.closest('th');\n      Object.entries(col.dataset).forEach(([k, v]) => {\n        tdcol.dataset[k] = v;\n        col.classList.add('inline-block')\n      });\n      tdcols.push(tdcol);\n    });\n    cols = tdcols;\n    // end fix\n\n    let coltosort;\n    const sortalternate = (col) => {\n      let todir;\n      // keep the same dir if sort on col changes\n      const asc = col.classList.contains(tablecss.ascending);\n      const desc = col.classList.contains(tablecss.descending);\n      if (parseInt(col.dataset.sortactive) === parseInt(coltosort)) {\n        todir = (asc) ? 'desc' : ((desc) ? 'asc' : 'asc');\n      } else todir = (asc) ? 'asc' : (desc) ? 'desc' : 'asc';\n      this.sortColumn(col, coltosort, todir);\n    }\n    cols.forEach(col => {\n      const altsort = (col.dataset.altsort) ? col.dataset.altsort.split(',') : null;\n      if (!altsort) return;\n      const csssorter = col.querySelector(tableselectors.sorter);\n      if (csssorter) csssorter.classList.add(tablecss.disabled);\n      const control = col.querySelector(tableselectors.sorton);\n      // prevents imbricated links\n      col.append(control);\n      const triggers = col.querySelectorAll('[role=\"button\"]');\n\n      col.addEventListener('click', (e) => {\n        e.preventDefault();\n        sortalternate(col);\n      }, false);\n      const changecoltosort = (cl, index) => {\n        if (index === 0) coltosort = this.grid.columns.findIndex(column => (column.index === cl.cellIndex));\n        else coltosort = this.grid.columns.findIndex(column => (column.name === altsort[index - 1]));\n      }\n      col.dataset.sortactive = col.cellIndex;\n      triggers.forEach((trigger, index) => {\n        trigger.addEventListener('click', (e) => {\n          e.preventDefault();\n          const active = e.currentTarget.parentElement.querySelector('.' + _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.active);\n          if (active) active.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.active);\n          e.currentTarget.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.active);\n          changecoltosort(col, index);\n        });\n      });\n      if (col.dataset.tip) {\n\n        Object.values(this.dom.rows).forEach((row, index) => {\n          if (index === 0) return;\n          const coltip = this.grid.columns.findIndex(column => (column.name === altsort[parseInt(col.dataset.tip) - 1]));\n\n          if (row.cells.length === 0 || coltip === col.cellIndex) return;\n          row.cells[col.cellIndex].addEventListener('mouseenter', (e) => {\n\n            const tip = document.createElement('div');\n            tip.setAttribute('class', tablecss.tipover);\n            tip.innerHTML = row.cells[coltip].innerHTML;\n            e.currentTarget.append(tip);\n          });\n          row.cells[col.cellIndex].addEventListener('mouseout', (e) => {\n            const tip = e.currentTarget.querySelector(tableselectors.tipover);\n            if (tip) tip.remove();\n          });\n        });\n      }\n    });\n  }\n\n  makeExpandable(container) {\n    if (container.querySelector('table').offsetHeight < container.offsetHeight) return;\n    const btn = document.createElement('div');\n    btn.classList.add(tablecss.buttonexpand);\n    btn.classList.add(tablecss.bordert);\n    btn.title = this.params.expand;\n    btn.innerHTML = `<span class=\"small-caps block mx-auto p-0\">${this.params.expand}</span><i class=\"clear-both p-0 mx-auto icon icon-chevron-down hover:fill-secondblue-500\"></i><span class=\"small-caps block mx-auto p-0 hidden\">${\n                  this.params.shrink}</span>`;\n    container.parentElement.insertBefore(btn, container.nextElementSibling);\n    container.classList.add(tablecss.overflowyhidden);\n    container.classList.remove(tablecss.maxtabstath);\n    container.parentElement.style.height = 'auto';\n    const h = parseInt(this.wrapper.querySelector('tbody tr').offsetHeight) * ((this.params.maxrows) ? this.params.maxrows : 20);\n    container.classList.add('max-h-[' + h + 'px]');\n    container.style.height = h + 'px';\n    btn.addEventListener('click', (e) => {\n      const ishidden = container.classList.contains(tablecss.overflowyhidden);\n      const make_expand = debounce__WEBPACK_IMPORTED_MODULE_6___default()(() => {\n        btn.classList.toggle(tablecss.bordert);\n        btn.classList.toggle(tablecss.borderb);\n        const ico = btn.querySelector('i');\n        ico.classList.toggle(tablecss.icochevrondown);\n        ico.classList.toggle(tablecss.iconchevronup);\n        container.classList.toggle(tablecss.overflowyhidden);\n        container.classList.toggle('max-h-[' + h + 'px]');\n        btn.querySelectorAll('span').forEach(span => {\n          span.classList.toggle(tablecss.hidden);\n        });\n        if (ishidden) container.style.height = h + 'px';\n        else container.style.height = 'auto';\n      }, 100);\n      make_expand();\n    });\n  }\n  makeExportable(container) {\n    const btn = document.createElement('div');\n    btn.classList.add(tableselectors.export.slice(1));\n    btn.classList.add('is-pick');\n    btn.innerHTML = `<i class=\"icon icon-arrow-down-on-square\"></i><span>${((this.params.exportlabel) ? this.params.exportlabel : 'export statistics ')}</span>`;\n    this.wrapper.prepend(btn);\n    const columns = this.grid.columns;\n    let exclude_columns = [];\n    this.grid.columns.forEach((column, index) => {\n      if (column.name === 'select') exclude_columns.push(column.index);\n    });\n    btn.addEventListener('click', async (e) => {\n      e.preventDefault();\n      if (!this.plugins.exportCSV) {\n        const {\n          exportCSV // or exportJSON, exportSQL\n        } = await\n        __webpack_require__.e(/*! import() */ \"src_modules_export-csv_js\").then(__webpack_require__.bind(__webpack_require__, /*! ../modules/export-csv.js */ \"./src/modules/export-csv.js\"));\n\n        this.plugins.exportCSV = exportCSV;\n      }\n      let str = this.plugins.exportCSV(this, {\n        download: false,\n        linedelimiter: \"\\n\",\n        columndelimiter: \"\\t\",\n        skipcolumns: exclude_columns\n      });\n      str = encodeURI(`data:text/tsv;charset=utf-8,${str}`);\n\n      (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_2__.download_url)(str, ((container.id) ? container.id : 'stats_proj') + '.tsv');\n\n    });\n  }\n  initTips() {\n    // show big cell content\n    let current = null;\n    this.dom.querySelectorAll(tableselectors.tip).forEach(tip => {\n      tip.addEventListener('click', (e) => {\n        e.preventDefault();\n        e.stopImmediatePropagation();\n        const parent = e.target.parentElement;\n        if (current !== null) current.classList.remove(tablecss.showfull);\n        if (current !== parent) {\n          parent.classList.add(tablecss.showfull);\n          current = parent;\n        } else current = null;\n\n      });\n    });\n  }\n  toggleAddOns(list = null, on = false) {\n    list = (list) ? list : [tableselectors.search + ' input', tableselectors.export];\n    const addons = [];\n    let addon;\n    list.forEach(addon => {\n      addon = this.wrapper.querySelector(addon);\n      if (addon) {\n        if (on) addon.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.hide);\n        else addon.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.hide);\n      }\n    });\n  }\n\n}\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLHFDQUFxQyxnQkFBZ0IsSUFBSTs7QUFFekQsTUFBTSwrREFBWTs7QUFFbEIsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTs7QUFFVixPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1Q0FBdUMsMkRBQUc7QUFDMUMsaUNBQWlDLDJEQUFHO0FBQ3BDO0FBQ0EsS0FBSztBQUNMOztBQUVBLEMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvbW9kdWxlcy90YWJsZS1jb21wb25lbnQuanM/NWVlMSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgRE9NUHVyaWZ5IGZyb20gJ2RvbXB1cmlmeSc7XG5pbXBvcnQgZXF1YWwgZnJvbSAnZGVlcC1lcXVhbCc7XG5pbXBvcnQge1xuICBmZXRjaFNldHRpbmdzLFxuICBkb3dubG9hZF91cmwsXG4gIHN0cmluZ190b19ib29sZWFuLFxuICBzb3J0X2l0ZW1zLFxuICBpc19vYmplY3QsXG4gIGh0bWxfc3Bpbm5lcixcbiAgZ2VuZXJhdGVfdXVpZFxufSBmcm9tICcuLi9tb2R1bGVzL3V0aWxzLmpzJztcbmltcG9ydCB7XG4gIE1vZHVsZUV2ZW50RW1pdHRlclxufSBmcm9tICcuLi9tb2R1bGVzL21vZHVsZS1ldmVudC1lbWl0dGVyLmpzJztcbmltcG9ydCB7XG4gIFRleHRIaWdobGlnaHRcbn0gZnJvbSAnLi4vbW9kdWxlcy90ZXh0LWhpZ2hsaWdodC5qcyc7XG5pbXBvcnQgZGVib3VuY2UgZnJvbSAnZGVib3VuY2UnO1xuaW1wb3J0IHtcbiAgY3NzLFxuICBtb2RlbHMsXG4gIGRlZmF1bHRfbWVzc2FnZXMsXG4gIHR5cGVpbXBvcnQsXG59IGZyb20gJy4uL21vZHVsZXMvbW9kdWxlcy1jb25maWcuanMnO1xubGV0IGluc3RhbmNlID0gW107XG4vLyB2YWxpZCBmZXRjaCB1cmxwYXJ0c1xuY29uc3QgZmV0Y2hmcm9tcyA9IHtcbiAgY29sbGVjdGlvbmxpc3Q6ICcvZ3VpL2NvbGxlY3Rpb25saXN0LycsXG4gIHByamxpc3Q6ICcvZ3VpL3Byamxpc3QvJyxcbiAgcHJqc2FtcGxlc3RhdHM6ICcvZ3VpL3ByanNhbXBsZXN0YXRzJyxcbiAgdXNlcnNsaXN0OiAnL2d1aS9hZG1pbi91c2Vyc2xpc3QvJyxcbiAgZ3Vlc3RzbGlzdDonL2d1aS9ndWVzdHNsaXN0LycsXG4gIG9yZ2FuaXphdGlvbnNsaXN0OicvZ3VpL29yZ2FuaXphdGlvbnNsaXN0LycsXG4gIHByanByZWRpY3Q6ICcvZ3VpL3ByanNmb3JwcmVkaWN0aW9uLydcbn07XG4vLyBzcGVjaWZjIGNzc1xuY29uc3QgdGFibGVjc3MgPSB7XG4gIHNob3dmdWxsOiAnc2hvd2Z1bGwnLFxuICB0aXBpbmxpbmU6IFwidGlwLWlubGluZVwiLFxuICBzZWFyY2hyZXN1bHRzOiBcInNlYXJjaC1yZXN1bHRzXCIsXG4gIHNlbGVjdGFjdGlvbjogXCJzZWxlY3RhY3Rpb25cIixcbiAgYWJzaW5wdXQ6ICdhYnNpbnB1dCcsXG4gIGRpc2FibGVkOiAndGFibGUtZGlzYWJsZWQnLFxuICBhc2NlbmRpbmc6ICd0YWJsZS1hc2NlbmRpbmcnLFxuICBkZXNjZW5kaW5nOiAndGFibGUtZGVzY2VuZGluZycsXG4gIHRpcG92ZXI6ICd0aXBvdmVyIGFic29sdXRlIHotMTAgdGV4dC1zdG9uZS01MCByb3VuZGVkLXNtIGJnLXN0b25lLTYwMCBweC0yIHB5LTAuNSAtbXQtNSBtbC0xMiAnLFxuICBoaWRlOiAnaGlkZScsXG4gIG5vd3JhcDogJ3RydW5jYXRlJyxcbiAgYnV0dG9uZXhwYW5kOiAnYnV0dG9uLWV4cGFuZCcsXG4gIGJvcmRlcnQ6ICdib3JkZXItdCcsXG4gIGJvcmRlcmI6ICdib3JkZXItYicsXG4gIG1heHRhYnN0YXRoOiAnbWF4LXRhYnN0YXQtaCcsXG4gIG92ZXJmbG93eWhpZGRlbjogJ292ZXJmbG93LXktaGlkZGVuJyxcbiAgaWNvY2hldnJvbmRvd246ICdpY29uLWNoZXZyb24tZG93bicsXG4gIGljb25jaGV2cm9udXA6ICdpY29uLWNoZXZyb24tdXAnLFxuICBwb2ludGVyOiAnY3Vyc29yLXBvaW50ZXInLFxuICBoaWRkZW46ICdoaWRkZW4nLFxufTtcbmNvbnN0IHRhYmxlc2VsZWN0b3JzID0ge1xuICB0YWJsZTogJy50YWJsZS10YWJsZScsXG4gIHdyYXBwZXI6ICcudGFibGUtd3JhcHBlcicsXG4gIHRvcDogJy50YWJsZS10b3AnLFxuICBpbnB1dDogJy50YWJsZS1pbnB1dCcsXG4gIHNlYXJjaDogJy50YWJsZS1zZWFyY2gnLFxuICBleHBvcnQ6ICcuYnV0dG9uLWV4cG9ydCcsXG4gIGZpbHRlcnM6ICcudGFibGUtZmlsdGVycycsXG4gIHNvcnRlcjogJy50YWJsZS1zb3J0ZXInLFxuICBkZXRhaWxzOiAnZGV0YWlsc1tkYXRhLXdoYXQ9XCJhYm91dFwiXScsXG4gIHRpcDogJy4nICsgY3NzLmNvbXBvbmVudC50YWJsZS50aXAsXG4gIHRpcG92ZXI6ICcudGlwb3ZlcicsXG4gIHdhaXQ6ICd3YWl0LXBsZWFzZScsXG4gIHNvcnRvbjogJy5zb3J0b24nLFxufTtcbk9iamVjdC5mcmVlemUodGFibGVjc3MpO1xuT2JqZWN0LmZyZWV6ZSh0YWJsZXNlbGVjdG9ycyk7XG5jb25zdCBOT1RGT1VORCA9ICcjTk9URk9VTkQjJztcbmV4cG9ydCBjbGFzcyBUYWJsZUNvbXBvbmVudCB7XG4gIHV1aWQgPSBudWxsO1xuICBncmlkID0ge1xuICAgIGNvbHVtbnM6IFtdLFxuICAgIGFjdGl2ZTogW10sXG4gICAgaGlkZGVuOiBbXSxcbiAgICBkYXRhOiBbXVxuICB9O1xuICBkb21kZWYgPSB7XG4gICAgY29sdW1uczogW10sXG4gICAgZGF0YTogW10sXG4gIH07XG4gIHdyYXBwZXIgPSBudWxsO1xuICBkb20gPSBudWxsO1xuICBwYXJhbXMgPSBudWxsO1xuICBfZXZlbnRzID0ge307XG4gIGV2ZW50bmFtZXMgPSB7XG4gICAgaW5pdDogXCJ0YWJsZS5pbml0XCIsXG4gICAgdXBkYXRlOiBcInRhYmxlLnVwZGF0ZVwiLFxuICAgIHJlZnJlc2g6IFwidGFibGUucmVmcmVzaFwiLFxuICAgIHJlc2l6ZTogXCJ0YWJsZS5yZXNpemVcIixcbiAgICBzZWFyY2g6IFwidGFibGUuc2VhcmNoXCIsXG4gICAgc2VhcmNoZW5kOiBcInRhYmxlLnNlYXJjaGVuZFwiLFxuICAgIHNvcnRpbmc6IFwidGFibGUuc29ydGluZ1wiLFxuICAgIHNvcnRlZDogXCJ0YWJsZS5zb3J0ZWRcIixcbiAgICBsb2FkOiBcInRhYmxlLmxvYWRlZFwiLFxuICAgIGRpc21pc3M6ICd0YWJsZS5kaXNtaXNzJ1xuICB9XG4gIGxhYmVscyA9IHtcbiAgICBwbGFjZWhvbGRlcjogXCJTZWFyY2guLi5cIixcbiAgICBwZXJQYWdlOiBcIntzZWxlY3R9IGVudHJpZXMgcGVyIHBhZ2VcIixcbiAgICBub1Jvd3M6IFwiTm8gZW50cmllcyBmb3VuZFwiLFxuICAgIGluZm86IFwiU2hvd2luZyB7c3RhcnR9IHRvIHtlbmR9IG9mIHtyb3dzfSBlbnRyaWVzXCIsXG4gICAgbm9SZXN1bHRzOiBcIk5vIHJlc3VsdCBtYXRjaCB5b3VyIHNlYXJjaCBxdWVyeVwiXG4gIH07XG4gIGNlbGxpZG5hbWUgPSBcImlkXCI7XG4gIHNlYXJjaGluZyA9IGZhbHNlO1xuICBzb3J0aW5nID0gZmFsc2U7XG4gIGluaXRpYWxpemVkID0gZmFsc2U7XG4gIHBsdWdpbnMgPSB7fTtcbiAgY29uc3RydWN0b3IoY29udGFpbmVyLCBvcHRpb25zID0ge30pIHtcbiAgICBpZiAoIWNvbnRhaW5lcikgcmV0dXJuO1xuICAgIGNvbnRhaW5lciA9IGNvbnRhaW5lciBpbnN0YW5jZW9mIEhUTUxFbGVtZW50ID8gY29udGFpbmVyIDogZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihjb250YWluZXIpO1xuICAgIGlmICghY29udGFpbmVyKSByZXR1cm47XG4gICAgLy9jYW4gc2VsZWN0IG11bHRpcGxlcyB0YWJsZXMgaW4gb25lIHBhZ2UgIG9yIGxvYWQgZGF0YSBpbiB0aGUgc2FtZSB0YWJsZVxuICAgIHRoaXMudXVpZCA9IChjb250YWluZXIuZGF0YXNldC51dWlkKSA/IGNvbnRhaW5lci5kYXRhc2V0LnV1aWQgOiBnZW5lcmF0ZV91dWlkKCk7XG4gICAgaWYgKCFpbnN0YW5jZVt0aGlzLnV1aWRdIHx8ICFlcXVhbChjb250YWluZXIuZGF0YXNldCwgaW5zdGFuY2VbdGhpcy51dWlkXS5wYXJhbXMpKSB7XG4gICAgICB0aGlzLmluaXQoY29udGFpbmVyKTtcbiAgICB9IGVsc2UgdGhpcy5yZWZyZXNoKCk7XG4gICAgcmV0dXJuIGluc3RhbmNlW3RoaXMudXVpZF07XG5cbiAgfVxuICBpbml0KGNvbnRhaW5lcikge1xuICAgIHRoaXMucGFyYW1zID0gY29udGFpbmVyLmRhdGFzZXQ7XG4gICAgbGV0IHRhYmxlID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJ3RhYmxlJyk7XG4gICAgaWYgKCF0YWJsZSkge1xuICAgICAgdGFibGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0YWJsZScpO1xuICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHRhYmxlKTtcbiAgICB9XG4gICAgdGFibGUuaWQgPSAndGFibGUtJyArIGNvbnRhaW5lci5pZDtcbiAgICB0YWJsZS5jbGFzc0xpc3QuYWRkKHRhYmxlc2VsZWN0b3JzLnRhYmxlLnN1YnN0cigxKSlcbiAgICB0aGlzLmRvbSA9IHRhYmxlO1xuICAgIGxldCB0b3AgPSB7XG4gICAgICBub2RlbmFtZTogXCJESVZcIixcbiAgICAgIGF0dHJpYnV0ZXM6IHtcbiAgICAgICAgY2xhc3M6IHRhYmxlc2VsZWN0b3JzLnRvcC5zdWJzdHIoMSlcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgbGV0IHdyYXBwZXIgPSB0aGlzLm9ialRvRWxlbWVudCh7XG4gICAgICBub2RlbmFtZTogJ0RJVicsXG4gICAgICBhdHRyaWJ1dGVzOiB7XG4gICAgICAgIGNsYXNzOiB0YWJsZXNlbGVjdG9ycy53cmFwcGVyLnN1YnN0cigxKVxuICAgICAgfSxcbiAgICAgIGNoaWxkbm9kZXM6IFt0b3BdXG4gICAgfSk7XG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHdyYXBwZXIpO1xuICAgIHdyYXBwZXIuYXBwZW5kQ2hpbGQodGFibGUpO1xuICAgIHRoaXMud3JhcHBlciA9IHdyYXBwZXI7XG4gICAgdGhpcy5sYWJlbHMgPSAodGhpcy5wYXJhbXMubGFiZWxzKSA/IHRoaXMucGFyYW1zLmxhYmVscyA6IHRoaXMubGFiZWxzO1xuICAgIC8vIGNlbGxpZFxuICAgIHRoaXMuY2VsbGlkbmFtZSA9ICh0aGlzLnBhcmFtcy5oYXNPd25Qcm9wZXJ0eShcImNlbGxpZFwiKSkgPyB0aGlzLnBhcmFtcy5jZWxsaWQgOiB0aGlzLmNlbGxpZG5hbWU7XG4gICAgLy8gb25seSB2YWxpZCBmcm9tIHZhbHVlcyAtIGZldGNoZnJvbXNcbiAgICB0aGlzLnBhcmFtcy5mcm9tID0gKHRoaXMucGFyYW1zLmZyb20pID8gRE9NUHVyaWZ5LnNhbml0aXplKHRoaXMucGFyYW1zLmZyb20pIDogbnVsbDtcbiAgICBjb25zdCBmcm9tID0gKHRoaXMucGFyYW1zLmZyb20pID8gKChPYmplY3Qua2V5cyhmZXRjaGZyb21zKS5pbmRleE9mKHRoaXMucGFyYW1zLmZyb20pID49IDApID8gZmV0Y2hmcm9tc1t0aGlzLnBhcmFtcy5mcm9tXSA6IG51bGwpIDogbnVsbDtcbiAgICB0aGlzLmRvbS5jbGFzc0xpc3QuYWRkKGNzcy5oaWRlKTtcbiAgICBpZiAoZnJvbSkge1xuICAgICAgaWYgKHRoaXMucGFyYW1zLmRlZmVyKSB0aGlzLmRlZmVyTG9hZChjb250YWluZXIsIGZyb20pO1xuICAgICAgZWxzZSB0aGlzLmZldGNoRGF0YShjb250YWluZXIsIGZyb20pO1xuICAgIH0gZWxzZSB0aGlzLnRhYmxlQWN0aXZhdGUoY29udGFpbmVyKTtcblxuICAgIHRoaXMuZHQgPSBEYXRlLm5vdygpO1xuICB9XG5cbiAgd2FpdEFjdGl2YXRlKGNvbnRhaW5lcikge1xuICAgIGxldCB3YWl0ZGl2ID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJyMnICsgdGFibGVzZWxlY3RvcnMud2FpdCk7XG4gICAgaWYgKCF3YWl0ZGl2KSB7XG4gICAgICB3YWl0ZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICB3YWl0ZGl2LmlkID0gdGFibGVzZWxlY3RvcnMud2FpdDtcbiAgICAgIGNvbnRhaW5lci5hcHBlbmQod2FpdGRpdik7XG4gICAgfVxuICAgIHRoaXMud2FpdGRpdiA9IHdhaXRkaXY7XG4gIH1cblxuICB3YWl0RGVhY3RpdmF0ZShtZXNzYWdlID0gbnVsbCwgdHlwZSA9ICdpbmZvJykge1xuICAgIGlmICghdGhpcy53YWl0ZGl2KSByZXR1cm47XG4gICAgaWYgKG1lc3NhZ2UpIHtcbiAgICAgIHRoaXMud2FpdGRpdi5jbGFzc0xpc3QucmVtb3ZlKGNzcy5oaWRlKTtcbiAgICAgIGlmICh0eXBlID09PSBudWxsKSB0aGlzLndhaXRkaXYuaW5uZXJIVE1MID0gYCR7bWVzc2FnZX1gO1xuICAgICAgdGhpcy53YWl0ZGl2LmlubmVySFRNTCA9IGA8ZGl2IGNsYXNzPVwiYWxlcnQgaXMtJHt0eXBlfVwiPiR7bWVzc2FnZX08L2Rpdj5gO1xuICAgIH0gZWxzZSB0aGlzLndhaXRkaXYuY2xhc3NMaXN0LmFkZChjc3MuaGlkZSk7XG4gIH1cblxuICBkZWZlckxvYWQoY29udGFpbmVyLCBmcm9tKSB7XG4gICAgY29uc3QgYnRuID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IodGhpcy5wYXJhbXMuZGVmZXIpO1xuICAgIGlmICghYnRuKSByZXR1cm47XG5cbiAgICBidG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgdGhpcy5mZXRjaERhdGEoY29udGFpbmVyLCBmcm9tKTtcbiAgICAgIGJ0bi5yZW1vdmUoKTtcbiAgICB9KTtcbiAgfVxuXG4gIGZldGNoRGF0YShjb250YWluZXIsIGZyb211cmwsIHBhZ2VzdGFydCA9IDApIHtcbiAgICB0aGlzLndhaXRBY3RpdmF0ZShjb250YWluZXIpO1xuICAgIGNvbnN0IHBhZ2VzaXplID0gKHRoaXMucGFyYW1zLnBhZ2VzaXplKSA/IHRoaXMucGFyYW1zLnBhZ2VzaXplIDogMDtcbiAgICBsZXQgZnJvbSA9IGZyb211cmw7XG4gICAgaWYgKHRoaXMucGFyYW1zLmZyb21pZCkgZnJvbSArPSAnLycgKyB0aGlzLnBhcmFtcy5mcm9taWQ7XG4gICAgbGV0IHF1ZXJ5ID0gKHRoaXMucGFyYW1zLmltcG9ydCkgPyB7XG4gICAgICB0eXBlaW1wb3J0OiBET01QdXJpZnkuc2FuaXRpemUodGhpcy5wYXJhbXMuaW1wb3J0KSxcbiAgICAgIGd6OiB0cnVlLFxuICAgIH0gOiB7fTtcbiAgICBpZiAocGFnZXNpemUpIHtcbiAgICAgIHF1ZXJ5LndpbmRvd19zdGFydCA9IHBhZ2VzdGFydDtcbiAgICAgIHF1ZXJ5LndpbmRvd19zaXplID0gcGFnZXNpemU7XG4gICAgfVxuICAgIGlmICh0aGlzLnBhcmFtcy5saXN0YWxsKSBxdWVyeS5saXN0YWxsID0gdGhpcy5wYXJhbXMubGlzdGFsbDtcbiAgICBjb25zdCBxdWVyeXBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMod2luZG93LmxvY2F0aW9uLnNlYXJjaCk7XG4gICAgY29uc3QgcXVlcnlrZXlzID0gdGhpcy5jZWxsaWRuYW1lICsgJ3MnO1xuICAgIGlmIChxdWVyeWtleXMubGVuZ3RoKSB7XG4gICAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIHF1ZXJ5cGFyYW1zLmVudHJpZXMoKSkge1xuICAgICAgICBpZiAocXVlcnlrZXlzLmluZGV4T2YoZW50cnlbMF0pID49IDApIHF1ZXJ5W2VudHJ5WzBdXSA9IGVudHJ5WzFdO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoT2JqZWN0LmtleXMocXVlcnkpLmxlbmd0aCkgZnJvbSArPSAnPycgKyBuZXcgVVJMU2VhcmNoUGFyYW1zKHF1ZXJ5KTtcbiAgICB0aGlzLmR0ID0gRGF0ZS5ub3coKTtcbiAgICBmZXRjaChmcm9tLCBmZXRjaFNldHRpbmdzKCkpLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgaWYgKHJlc3BvbnNlLm9rKSByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xuICAgICAgZWxzZSByZXR1cm4gUHJvbWlzZS5yZWplY3QocmVzcG9uc2UpO1xuICAgIH0pLnRoZW4oYXN5bmMgdGFibGVkZWYgPT4ge1xuICAgICAgaWYgKHRoaXMud2FpdGRpdikgdGhpcy53YWl0ZGl2LmlubmVySFRNTCA9ICgodGhpcy53YWl0ZGl2LmRhdGFzZXQubG9hZGVkKSA/IERPTVB1cmlmeS5zYW5pdGl6ZSh0aGlzLndhaXRkaXYuZGF0YXNldC5sb2FkZWQpIDogZGVmYXVsdF9tZXNzYWdlcy5kYXRhbG9hZGVkKTtcbiAgICAgIGlmIChwYWdlc3RhcnQgPiAwKSB7XG4gICAgICAgIGlmICh0YWJsZWRlZi5kYXRhLmxlbmd0aCkge1xuICAgICAgICAgIHRoaXMuZG9tSW5zZXJ0Um93cyh0YWJsZWRlZik7XG4gICAgICAgIH0gZWxzZSBwYWdlc2l6ZSA9IDA7XG4gICAgICB9XG4gICAgICBpZiAocGFnZXNpemUgPT09IDApIHtcbiAgICAgICAgbGV0IG5vdyA9IERhdGUubm93KCk7XG4gICAgICAgIGNvbnNvbGUubG9nKCdzZWNvbmRzIHRvIGZldGNoICcsIChEYXRlLm5vdygpIC0gdGhpcy5kdCkgLyAxMDAwKTtcbiAgICAgICAgdGhpcy5kdCA9IG5vdztcbiAgICAgICAgaWYgKHRhYmxlZGVmLmRhdGEubGVuZ3RoIHx8IHBhZ2VzdGFydCA+IDApIGF3YWl0IHRoaXMudGFibGVBY3RpdmF0ZShjb250YWluZXIsIHRhYmxlZGVmKTtcbiAgICAgICAgZWxzZSB0aGlzLndhaXREZWFjdGl2YXRlKCdubyByZXN1bHQnLCAnZGVmYXVsdCcpO1xuICAgICAgICBub3cgPSBEYXRlLm5vdygpO1xuICAgICAgICBjb25zb2xlLmxvZygncGx1Z2lucyBsb2FkZWQnLCAoRGF0ZS5ub3coKSAtIHRoaXMuZHQpIC8gMTAwMCk7XG4gICAgICAgIHRoaXMuZHQgPSBub3c7XG4gICAgICB9IGVsc2UgdGhpcy5mZXRjaERhdGEoY29udGFpbmVyLCBmcm9tdXJsLCBwYWdlc3RhcnQgKyBwYWdlc2l6ZSk7XG5cbiAgICB9KS5jYXRjaCgoZXJyKSA9PiB7IC8qIHByaW50IGVycm9yIGZyb20gcmVzcG9uc2UgKi9cbiAgICAgIGNvbnNvbGUubG9nKCdlcnJvcicsIGVycik7XG4gICAgICB0aGlzLndhaXREZWFjdGl2YXRlKGVyci5zdGF0dXMgKyBgIGAgKyBlcnIuc3RhdHVzVGV4dCwgJ2Vycm9yJyk7XG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBkYXRhVG9UYWJsZSh0YWJsZWRlZikge1xuICAgIGlmICghdGFibGVkZWYuZGF0YSkgcmV0dXJuO1xuICAgIGlmICh0YWJsZWRlZi5jb2x1bW5zKSB7XG4gICAgICBhd2FpdCB0aGlzLmNvbnZlcnRDb2x1bW5zKHRhYmxlZGVmKTtcbiAgICAgIGxldCB0cjtcbiAgICAgIGxldCB0aGVhZCA9IHRoaXMuZG9tLnRIZWFkO1xuICAgICAgaWYgKCF0aGVhZCkge1xuICAgICAgICAvLyBjcmVhdGUgdGFibGUgaGVhZGluZ3NcbiAgICAgICAgdGhlYWQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0aGVhZCcpO1xuICAgICAgICB0ciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7XG4gICAgICAgIHRoaXMuZG9tLmFwcGVuZENoaWxkKHRoZWFkKTtcbiAgICAgIH0gZWxzZSBpZiAoIXRoZWFkLnF1ZXJ5U2VsZWN0b3IoJ3RyJykpIHtcbiAgICAgICAgdHIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpO1xuXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0ciA9IHRoZWFkLnF1ZXJ5U2VsZWN0b3IoJ3RyJyk7XG4gICAgICAgIHRyLmlubmVySFRNTCA9IGBgO1xuICAgICAgfVxuICAgICAgbGV0IHRib2R5ID0gKHRoaXMuZG9tLnRCb2RpZXMubGVuZ3RoKSA/IHRoaXMuZG9tLnRCb2RpZXNbMF0gOiBudWxsO1xuICAgICAgaWYgKCF0Ym9keSkge1xuICAgICAgICB0Ym9keSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3Rib2R5Jyk7XG4gICAgICAgIHRoaXMuZG9tLmFwcGVuZENoaWxkKHRib2R5KTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGlzanNvbiA9ICghdGFibGVkZWYuaGFzT3duUHJvcGVydHkoJ2RhdGEnKSB8fCAodGFibGVkZWYuaGFzT3duUHJvcGVydHkoJ3R5cGUnKSAmJiB0YWJsZWRlZi50eXBlID09PSBcImpzb25cIikpO1xuICAgICAgdGhpcy5ncmlkLmNvbHVtbnMuZm9yRWFjaCgoY29sdW1uLCBpbmRleCkgPT4ge1xuXG4gICAgICAgIGlmICghY29sdW1uLmhpZGRlbikge1xuICAgICAgICAgIGNvbnN0IHRoID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGgnKTtcbiAgICAgICAgICB0aC5pbm5lckhUTUwgPSBET01QdXJpZnkuc2FuaXRpemUoY29sdW1uLmxhYmVsKTtcbiAgICAgICAgICBpZiAoY29sdW1uLnNvcnQpIHRoLmRhdGFzZXQuc29ydCA9IGNvbHVtbi5zb3J0O1xuICAgICAgICAgIGlmIChjb2x1bW4uZm9ybWF0KSB0aC5kYXRhc2V0LnR5cGUgPSBjb2x1bW4udHlwZTtcbiAgICAgICAgICBpZiAoY29sdW1uLm5hbWUpIHRoLmRhdGFzZXQubmFtZSA9IGNvbHVtbi5uYW1lO1xuICAgICAgICAgIC8vIFRPRE8gLSBmaW5kIGEgcGxhY2UgdG8gZGVmaW5lIGNvbCBpbXBvcnQgcHJvcHNcbiAgICAgICAgICAvLyBzZXQgaGVhZGluZ3MgZGF0YXNldCB2YWx1ZXMgZm9yIGltcG9ydCBtb2R1bGVcbiAgICAgICAgICBpZiAodGhpcy5wYXJhbXMuaW1wb3J0KVsnc2VsZWN0Y2VsbHMnLCAnd2hhdCcsICdhdXRvY29tcGxldGUnLCAncGFydHMnLCAndmFsdWUnXS5mb3JFYWNoKHByb3AgPT4ge1xuICAgICAgICAgICAgaWYgKGNvbHVtbi5oYXNPd25Qcm9wZXJ0eShwcm9wKSkgIHRoLmRhdGFzZXRbcHJvcF0gPSBjb2x1bW5bcHJvcF07XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgdGguZGF0YXNldC5zb3J0YWJsZSA9IChjb2x1bW4uc29ydGFibGUpID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICAgIHRyLmFwcGVuZENoaWxkKHRoKTtcbiAgICAgICAgICB0aGlzLmdyaWQuYWN0aXZlLnB1c2goaW5kZXgpO1xuICAgICAgICB9IGVsc2UgdGhpcy5ncmlkLmhpZGRlbi5wdXNoKGluZGV4KTtcblxuICAgICAgfSk7XG5cblxuICAgICAgdGhlYWQuYXBwZW5kQ2hpbGQodHIpO1xuICAgICAgY29uc3QgZGF0YWxhc3R1c2VkID0gKHRoaXMucGFyYW1zLmxhc3R1c2VkICYmIHRoaXMucGFyYW1zLmxhc3R1c2VkLmxlbmd0aCA+IDApID8gW10gOiBudWxsO1xuICAgICAgLy8jVE9ETyBsYXN0dXNlZCByZW9yZGVyXG4gICAgICBpZiAoaXNqc29uKSB7XG4gICAgICAgIHRoaXMuZ3JpZC5kYXRhID0gW107XG4gICAgICAgIHRhYmxlZGVmLmRhdGEuZm9yRWFjaCgoZGF0YSwgaSkgPT4ge1xuICAgICAgICAgIGNvbnN0IHJvdyA9IFtdO1xuICAgICAgICAgIGxldCBqID0gMDtcbiAgICAgICAgICBPYmplY3QuZW50cmllcyh0YWJsZWRlZi5jb2x1bW5zKS5mb3JFYWNoKChba2V5LCBjb2x1bW5dLCBpKSA9PiB7XG4gICAgICAgICAgICBpZiAoIWNvbHVtbi5oYXNPd25Qcm9wZXJ0eSgnZW1wdHlkYXRhJykpIHtcbiAgICAgICAgICAgICAgaWYgKGRhdGEuaGFzT3duUHJvcGVydHkoa2V5KSkgcm93W2pdID0gZGF0YVtrZXldO1xuICAgICAgICAgICAgICBlbHNlIGlmIChjb2x1bW4uZmllbGQgJiYgZGF0YS5oYXNPd25Qcm9wZXJ0eShjb2x1bW4uZmllbGQpKSByb3dbal0gPSBkYXRhW2NvbHVtbi5maWVsZF07XG4gICAgICAgICAgICAgIGVsc2Ugcm93W2pdID0gbnVsbDtcbiAgICAgICAgICAgICAgaisrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHRoaXMuZ3JpZC5kYXRhLnB1c2gocm93KTtcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2UgdGhpcy5ncmlkLmRhdGEgPSB0YWJsZWRlZi5kYXRhO1xuXG4gICAgICBjb25zdCB0Zm9vdCA9IHRoaXMuZG9tLnRGb290O1xuICAgICAgaWYgKHRoaXMuZ3JpZC5hY3RpdmUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHRib2R5LmlubmVySFRNTCA9IGA8dHI+PHRkPiR7dGhpcy5sYWJlbHMubm9Sb3dzfTwvdGQ8L3RyPmA7XG4gICAgICAgIGlmICh0Zm9vdCkgdGZvb3QucmVtb3ZlKCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH0gZWxzZSBpZiAodGZvb3QgJiYgdGZvb3QucXVlcnlTZWxlY3RvcigndHInKSkge1xuICAgICAgICBjb25zdCB0ZiA9IHRmb290LnF1ZXJ5U2VsZWN0b3IoJ3RyJykuY2hpbGROb2RlcztcbiAgICAgICAgdGhpcy5ncmlkLmhpZGRlbi5mb3JFYWNoKGkgPT4ge1xuICAgICAgICAgIHRmW2ldLnJlbW92ZSgpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG5cbiAgICAgIHRoaXMucmVuZGVyVGJvZHkodGJvZHkpO1xuICAgIH1cbiAgfVxuXG4gIHRhYmxlVG9EYXRhKCkge1xuICAgIGlmICghdGhpcy5kb20ucXVlcnlTZWxlY3RvcigndGhlYWQnKSkge3RoaXMuZG9tLmNsYXNzTGlzdC5yZW1vdmUoY3NzLmhpZGUpO3JldHVybjt9XG4gICAgY29uc3QgZGF0YWxhc3R1c2VkID0gKHRoaXMucGFyYW1zLmxhc3R1c2VkICYmIHRoaXMucGFyYW1zLmxhc3R1c2VkLmxlbmd0aCA+IDApID8gW10gOiBudWxsO1xuICAgIHRoaXMuZG9tLmNsYXNzTGlzdC5hZGQoY3NzLmhpZGUpO1xuICAgIGNvbnN0IGNlbGxfdG9fb2JqID0gKGNlbGwpID0+IHtcbiAgICAgIGNvbnN0IGNlbGx0ZXh0ID0gY2VsbC5pbm5lclRleHQ7XG4gICAgICBjb25zdCBvYmogPSB7XG4gICAgICAgIGRhdGE6IGNlbGx0ZXh0LFxuICAgICAgfVxuICAgICAgY29uc3QgY2VsbGh0bWwgPSBjZWxsLmlubmVySFRNTDtcbiAgICAgIGlmIChjZWxsdGV4dCAhPT0gY2VsbGh0bWwpIG9iai5odG1sID0gY2VsbGh0bWw7XG4gICAgICByZXR1cm4gb2JqO1xuICAgIH1cbiAgICBjb25zdCB0aHMgPSAodGhpcy5kb20ucXVlcnlTZWxlY3RvckFsbCgndGhlYWQgdHIgdGgnKS5sZW5ndGgpID8gdGhpcy5kb20ucXVlcnlTZWxlY3RvckFsbCgndGhlYWQgdHIgdGgnKSA6IHRoaXMuZG9tLnF1ZXJ5U2VsZWN0b3JBbGwoJ3RoZWFkIHRyIHRkJyk7XG4gICAgY29uc3QgdHJzID0gdGhpcy5kb20ucXVlcnlTZWxlY3RvckFsbCgndGJvZHkgdHInKTtcbiAgICBsZXQgYWN0aXZlID0gMCxcbiAgICAgIGhpZGRlbiA9IDA7XG5cbiAgICBmdW5jdGlvbiBmaW5kX2xhYmVsKHRoKSB7XG4gICAgICBpZiAodGguY2hpbGROb2Rlcy5sZW5ndGgpIHJldHVybiBmaW5kX2xhYmVsKHRoLmNoaWxkTm9kZXNbMF0pO1xuICAgICAgZWxzZSByZXR1cm4gdGguaW5uZXJUZXh0O1xuICAgIH1cbiAgICB0aHMuZm9yRWFjaCgodGgsIGluZGV4KSA9PiB7XG4gICAgICBjb25zdCBjb2wgPSBPYmplY3QuYXNzaWduKHt9LCB0aC5kYXRhc2V0KTtcbiAgICAgIGlmIChjb2wubWFzaykgdGguY2xhc3NMaXN0LmFkZCh0YWJsZWNzcy5oaWRkZW4pO1xuICAgICAgaWYgKGNvbC5oaWRkZW4gJiYgc3RyaW5nX3RvX2Jvb2xlYW4oY29sLmhpZGRlbikpIHtcbiAgICAgICAgY29sLmhpZGRlbiA9IHRydWU7XG4gICAgICAgIHRoLnJlbW92ZSgpO1xuICAgICAgfVxuICAgICAgY29sLmxhYmVsID0gZmluZF9sYWJlbCh0aCk7XG4gICAgICBpZiAoY29sLnR5cGUpIHtcbiAgICAgICAgY29sLmZvcm1hdCA9IGNvbC50eXBlO1xuICAgICAgICBkZWxldGUgY29sLnR5cGU7XG4gICAgICB9XG4gICAgICBjb2wuaW5kZXggPSBpbmRleDtcbiAgICAgIGlmIChjb2wuaGlkZGVuKSB0aGlzLmdyaWQuaGlkZGVuLnB1c2goaW5kZXgpO1xuICAgICAgZWxzZSB0aGlzLmdyaWQuYWN0aXZlLnB1c2goaW5kZXgpO1xuICAgICAgdGhpcy5ncmlkLmNvbHVtbnMucHVzaChjb2wpO1xuICAgIH0pO1xuICAgIGNvbnN0IGNlbGxpZCA9IHRoaXMuZ2V0Q2VsbElkKHRoaXMuY2VsbGlkbmFtZSk7XG4gICAgdHJzLmZvckVhY2goKHRyLCBpKSA9PiB7XG4gICAgICBpZiAoY2VsbGlkIDwgMCkgdHIuZGF0YXNldFt0aGlzLmNlbGxpZG5hbWVdID0gaTtcbiAgICAgIGVsc2UgaWYgKGkgPT09IGNlbGxpZCkgdHIuZGF0YXNldFt0aGlzLmNlbGxpZG5hbWVdID0gdGhpcy5nZXRDZWxsRGF0YShpLCB0aGlzLmNlbGxpZG5hbWUsIGNlbGxpZCk7XG4gICAgICBjb25zdCBkYXRhID0gW107XG4gICAgICB0ci5xdWVyeVNlbGVjdG9yQWxsKCd0aCx0ZCcpLmZvckVhY2goKHRkLCBpbmRleCkgPT4ge1xuICAgICAgICBpZiAodGhpcy5ncmlkLmNvbHVtbnNbaW5kZXhdLmhhc093blByb3BlcnR5KCdtYXNrJykpIHRkLmNsYXNzTGlzdC5hZGQodGFibGVjc3MuaGlkZGVuKTtcbiAgICAgICAgaWYgKHRoaXMuZ3JpZC5oaWRkZW4uaW5kZXhPZihpbmRleCkgPj0gMCkgdGQucmVtb3ZlKCk7XG4gICAgICAgIGRhdGEucHVzaCh0ZC5pbm5lclRleHQpO1xuICAgICAgfSk7XG4gICAgICB0aGlzLmdyaWQuZGF0YS5wdXNoKGRhdGEpXG4gICAgfSk7XG5cbiAgICB0aGlzLmRvbS5xdWVyeVNlbGVjdG9yQWxsKCd0Zm9vdCB0ciB0aCcpLmZvckVhY2goKHRkLCBpbmRleCkgPT4ge1xuICAgICAgaWYgKHRoaXMuZ3JpZC5jb2x1bW5zW2luZGV4XS5oYXNPd25Qcm9wZXJ0eSgnbWFzaycpKSB0ZC5jbGFzc0xpc3QuYWRkKHRhYmxlY3NzLmhpZGRlbik7XG4gICAgICBpZiAodGhpcy5ncmlkLmhpZGRlbi5pbmRleE9mKGluZGV4KSA+PSAwKSB0ZC5yZW1vdmUoKTtcbiAgICB9KTtcbiAgICB0aGlzLmRvbS5jbGFzc0xpc3QucmVtb3ZlKGNzcy5oaWRlKTtcbiAgICByZXR1cm47XG4gIH1cbiAgcmVuZGVyVGJvZHkodGJvZHkpIHtcbiAgICBjb25zdCBsID0gdGhpcy5ncmlkLmRhdGEubGVuZ3RoO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbDsgaSsrKSB7XG4gICAgICBjb25zdCB0ciA9IHRoaXMuY3JlYXRlVGFibGVSb3codGhpcy5ncmlkLmRhdGFbaV0sIGkpO1xuICAgICAgdGJvZHkuYXBwZW5kKHRyKTtcbiAgICB9O1xuXG5cblxuICB9XG4gIGFzeW5jIHRhYmxlQWN0aXZhdGUoY29udGFpbmVyLCB0YWJsZWRlZiA9IG51bGwpIHtcbiAgICBNb2R1bGVFdmVudEVtaXR0ZXIub25jZSh0aGlzLmV2ZW50bmFtZXMubG9hZCwgKCkgPT4ge1xuICAgICAgdGhpcy5pbml0UGx1Z2lucyhjb250YWluZXIpO1xuICAgICAgdGhpcy5pbml0U2VhcmNoKCk7XG4gICAgICB0aGlzLmluaXRTb3J0KCk7XG4gICAgICB0aGlzLndhaXREZWFjdGl2YXRlKCk7XG4gICAgICAvLyBoaWRlIGFuZCBtb3ZlIHdhaXRkaXYgaW4gdGhlIHdyYXBwZXIgZm9yIGlubmVyIGVsZW1lbnRzIGRpc3BsYXlcbiAgICAgIHRoaXMuZG9tLmNsYXNzTGlzdC5yZW1vdmUoY3NzLmhpZGUpO1xuICAgICAgaWYgKHRoaXMuYWZ0ZXJMb2FkKSB0aGlzLmFmdGVyTG9hZCgpO1xuICAgICAgLy8gbW92ZSBpbXBvcnQgem9uZXMgYW5kL29yIHNlYXJjaCB6b25lIC0gcmVvcmcgdGhlIHBhZ2UgZGlzcGxheVxuICAgICAgLy8gZmV0Y2ggb25jZSB0aGUgc2FtZSB0YWJsZVxuICAgICAgY29udGFpbmVyLmRhdGFzZXQudGFibGUgPSB0aGlzLnBhcmFtcy50YWJsZSA9IHRydWU7XG4gICAgICB0aGlzLmluaXRpYWxpemVkID0gdHJ1ZTtcbiAgICB9LCB0aGlzLnV1aWQpO1xuICAgIC8vIGRpc21pc3MgdGFibGUgd2hlbiBkaXNtaXNzIG1vZGFsXG4gICAgTW9kdWxlRXZlbnRFbWl0dGVyLm9uY2UodGhpcy5ldmVudG5hbWVzLmRpc21pc3MsIChlKSA9PiB7XG4gICAgICB0aGlzLmRlc3Ryb3koKTtcbiAgICB9LCB0aGlzLnV1aWQpO1xuICAgIGlmICh0YWJsZWRlZikgdGFibGVkZWYgPSBhd2FpdCB0aGlzLmRhdGFUb1RhYmxlKHRhYmxlZGVmKTtcbiAgICBlbHNlIGF3YWl0IHRoaXMudGFibGVUb0RhdGEoKTtcbiAgICBpZiAodGhpcy5ncmlkLmRhdGEubGVuZ3RoKSBNb2R1bGVFdmVudEVtaXR0ZXIuZW1pdCh0aGlzLmV2ZW50bmFtZXMubG9hZCwge30sIHRoaXMudXVpZCk7XG4gICAgaW5zdGFuY2VbdGhpcy51dWlkXSA9IHRydWU7XG4gIH1cblxuICB0YWJsZUFwcGVuZFJvd3Mocm93cykge1xuICAgIGNvbnNvbGUubG9nKCdyb3dzJyk7XG4gIH1cbiAgZGVzdHJveSgpIHtcbiAgICBpZiAodGhpcy5kYXRhSW1wb3J0KSB0aGlzLmRhdGFJbXBvcnQgPSBudWxsO1xuICAgIHRoaXMuZG9tID0gbnVsbDtcbiAgICBkZWxldGUgaW5zdGFuY2VbdGhpcy51dWlkXTtcbiAgfVxuXG4gIHJlZnJlc2goZSkge1xuICAgIGlmICh0aGlzLmRhdGFJbXBvcnQpIHRoaXMuZGF0YUltcG9ydC5yZXNldFNlbGVjdG9ycygpO1xuICB9XG4gIGxhYmVsRm9ybWF0dGVyKGNvbHVtbikge1xuICAgIGxldCBhbGlnbiA9IGBgO1xuICAgIGlmIChbJ251bWJlcicsICdwcm9ncmVzcycsICdkZWNpbWFsJ10uZmluZChmb3JtYXQgPT4gZm9ybWF0ID09PSBjb2x1bW4uZm9ybWF0KSkgYWxpZ24gPSBjc3MucmlnaHQ7XG4gICAgaWYgKGNvbHVtbi5zdWJmaWVsZCkgcmV0dXJuIGAke2NvbHVtbi5sYWJlbH0gPHNwYW4gY2xhc3M9XCJzdWJsYWJlbFwiPiR7Y29sdW1uLnN1YmxhYmVsfTwvc3Bhbj5gO1xuICAgIGVsc2UgaWYgKGNvbHVtbi5sYWJlbCkgcmV0dXJuIGA8c3BhbiBjbGFzcz1cIiR7YWxpZ259XCI+JHtjb2x1bW4ubGFiZWx9PC9zcGFuPmA7XG4gICAgZWxzZSByZXR1cm4gYGA7XG4gIH1cbiAgZ2V0Q2VsbElkKG5hbWUpIHtcbiAgICBsZXQgY29scyA9IHRoaXMuZ3JpZC5jb2x1bW5zLmZpbHRlcihjb2x1bW4gPT4gKGNvbHVtbi5uYW1lID09PSBuYW1lKSk7XG4gICAgcmV0dXJuIChjb2xzLmxlbmd0aCkgPyBjb2xzWzBdLmluZGV4IDogLTE7XG4gIH1cblxuICBnZXRDZWxsRGF0YShyb3dJbmRleCwgbmFtZSwgY2VsbEluZGV4ID0gbnVsbCkge1xuICAgIGNlbGxJbmRleCA9IChjZWxsSW5kZXggPT09IG51bGwpID8gdGhpcy5nZXRDZWxsSWQobmFtZSkgOiBjZWxsSW5kZXg7XG4gICAgaWYgKGNlbGxJbmRleCA8IDApIHJldHVybiBudWxsO1xuICAgIHJldHVybiAodGhpcy5ncmlkLmRhdGEubGVuZ3RoKSA/ICgodGhpcy5ncmlkLmRhdGFbcm93SW5kZXhdKSA/IHRoaXMuZ3JpZC5kYXRhW3Jvd0luZGV4XVtjZWxsSW5kZXhdIDogbnVsbCkgOiBudWxsO1xuICB9XG5cbiAgcm93QXR0cmlidXRlcyh0ciwgaW5kZXgpIHtcbiAgICBjb25zdCBpZCA9IHRoaXMuZ2V0Q2VsbERhdGEoaW5kZXgsIHRoaXMuY2VsbGlkbmFtZSk7XG4gICAgdHIuZGF0YXNldFt0aGlzLmNlbGxpZG5hbWVdID0gaWQ7XG4gICAgaWYgKHRoaXMuc2V0Um93QXR0cmlidXRlcykgdHIgPSB0aGlzLnNldFJvd0F0dHJpYnV0ZXModGhpcywgdHIsIGlkKTtcbiAgICByZXR1cm4gdHI7XG4gIH1cblxuICBjcmVhdGVUYWJsZVJvdyhyb3csIGluZGV4LCBpc2hlYWRlciA9IGZhbHNlKSB7XG4gICAgY29uc3QgdHIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpO1xuICAgIGxldCB0ZDtcbiAgICB0aGlzLmdyaWQuY29sdW1ucy5mb3JFYWNoKGNvbHVtbiA9PiB7XG4gICAgICBpZiAoY29sdW1uLmhhc093blByb3BlcnR5KCdoaWRkZW4nKSAmJiBjb2x1bW4uaGlkZGVuID09PSB0cnVlKSByZXR1cm47XG4gICAgICBjb25zdCBjZWxsID0gcm93W2NvbHVtbi5pbmRleF07XG4gICAgICBpZiAoY29sdW1uLmhhc093blByb3BlcnR5KFwicmVuZGVyXCIpKSB7XG4gICAgICAgIHRkID0gY29sdW1uLnJlbmRlcihjZWxsLCBpbmRleCwgY29sdW1uLmluZGV4KTtcbiAgICAgICAgdGQubm9kZW5hbWUgPSAoaXNoZWFkZXIpID8gJ1RIJyA6ICdURCc7XG4gICAgICAgIHRkID0gdGhpcy5vYmpUb0VsZW1lbnQodGQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGQgPSAoaXNoZWFkZXIpID8gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGgnKSA6IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG4gICAgICAgIHRkLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGNlbGwpKTtcbiAgICAgIH1cbiAgICAgIHRyLmFwcGVuZENoaWxkKHRkKTtcbiAgICB9KVxuICAgIHJldHVybiB0aGlzLnJvd0F0dHJpYnV0ZXModHIsIGluZGV4KTtcbiAgfVxuXG4gIG9ialRvRWxlbWVudChvYmopIHtcbiAgICBpZiAob2JqLm5vZGVuYW1lID09PSBcIiN0ZXh0XCIpIHJldHVybiBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShvYmouZGF0YSk7XG4gICAgY29uc3QgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KG9iai5ub2RlbmFtZSk7XG4gICAgaWYgKG9iai5oYXNPd25Qcm9wZXJ0eShcImh0bWxcIikpIGVsLmlubmVySFRNTCA9IG9iai5odG1sO1xuICAgIGVsc2UgZWwudGV4dENvbnRlbnQgPSBvYmouZGF0YTtcbiAgICBpZiAob2JqLmhhc093blByb3BlcnR5KFwiYXR0cmlidXRlc1wiKSkge1xuICAgICAgZm9yIChjb25zdCBhdHRyIGluIG9iai5hdHRyaWJ1dGVzKSB7XG4gICAgICAgIGVsLnNldEF0dHJpYnV0ZShhdHRyLCBvYmouYXR0cmlidXRlc1thdHRyXSk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChvYmouaGFzT3duUHJvcGVydHkoXCJjaGlsZG5vZGVzXCIpKSB7XG4gICAgICBvYmouY2hpbGRub2Rlcy5mb3JFYWNoKGNoaWxkbm9kZSA9PiB7XG5cbiAgICAgICAgZWwuYXBwZW5kQ2hpbGQodGhpcy5vYmpUb0VsZW1lbnQoY2hpbGRub2RlKSk7XG4gICAgICB9KTtcblxuICAgIH1cbiAgICByZXR1cm4gZWw7XG4gIH1cblxuICBzZXRUZXh0Tm9kZSh2YWx1ZSkge1xuICAgIHJldHVybiB7XG4gICAgICBub2RlbmFtZTogXCIjdGV4dFwiLFxuICAgICAgZGF0YTogdmFsdWVcbiAgICB9O1xuICB9XG4gIGFzeW5jIGdldEZvcm1hdHRlcnMoKSB7XG4gICAgbGV0IGZvcm1hdHRlcnMgPSB7XG4gICAgICBjb250cm9sczogKHZhbHVlLCByb3dJbmRleCwgY2VsbEluZGV4LCB0ZCA9IHt9KSA9PiB7XG4gICAgICAgIGNvbnN0IGNvbHVtbiA9IHRoaXMuZ3JpZC5jb2x1bW5zW2NlbGxJbmRleF07XG4gICAgICAgIGNvbnN0IGlkID0gdGhpcy5nZXRDZWxsRGF0YShyb3dJbmRleCwgY29sdW1uLmZpZWxkKTtcbiAgICAgICAgY29uc3QgYWN0aW9ucyA9IChjb2x1bW4uYWN0aW9ucykgPyBjb2x1bW4uYWN0aW9ucyA6IG51bGw7XG4gICAgICAgIGlmICghYWN0aW9ucykgcmV0dXJuIGBgO1xuICAgICAgICBsZXQgY29udHJvbHMgPSBbXTtcbiAgICAgICAgT2JqZWN0LmVudHJpZXMoYWN0aW9ucykuZm9yRWFjaCgoW2tleSwgYWN0aW9uXSkgPT4ge1xuICAgICAgICAgIGNvbnRyb2xzLnB1c2goe1xuICAgICAgICAgICAgbm9kZW5hbWU6IFwiQVwiLFxuICAgICAgICAgICAgYXR0cmlidXRlczoge1xuICAgICAgICAgICAgICBjbGFzczogYGJ0biBpcy0ke2tleX0gYCxcbiAgICAgICAgICAgICAgaHJlZjogYCR7YWN0aW9uLmxpbmt9JHtpZH1gXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY2hpbGRub2RlczogW3RoaXMuc2V0VGV4dE5vZGUoYWN0aW9uLmxhYmVsKV1cbiAgICAgICAgICB9KTtcblxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKCF0ZC5oYXNPd25Qcm9wZXJ0eSgnYXR0cmlidXRlcycpKSB0ZC5hdHRyaWJ1dGVzID0ge307XG4gICAgICAgIHRkLmF0dHJpYnV0ZXMuY2xhc3MgPSBjc3MuY29tcG9uZW50LnRhYmxlLmNvbnRyb2xzO1xuICAgICAgICB0ZC5jaGlsZG5vZGVzID0gY29udHJvbHM7XG4gICAgICAgIHJldHVybiB0ZDtcbiAgICAgIH0sXG4gICAgICBzZWxlY3Q6ICh2YWx1ZSwgcm93SW5kZXgsIGNlbGxJbmRleCwgdGQgPSB7fSkgPT4ge1xuICAgICAgICBjb25zdCBjb2x1bW4gPSB0aGlzLmdyaWQuY29sdW1uc1tjZWxsSW5kZXhdO1xuICAgICAgICB2YWx1ZSA9IChpc05hTih2YWx1ZSkpID8gdGhpcy5nZXRDZWxsRGF0YShyb3dJbmRleCwgY29sdW1uLmZpZWxkKSA6IHZhbHVlO1xuXG4gICAgICAgIHRkLmNoaWxkbm9kZXMgPSBbe1xuICAgICAgICAgIG5vZGVuYW1lOiBcIklOUFVUXCIsXG4gICAgICAgICAgYXR0cmlidXRlczoge1xuICAgICAgICAgICAgdHlwZTogXCJyYWRpb1wiLFxuICAgICAgICAgICAgbmFtZTogYCR7dGhpcy51dWlkfXNlbGVjdGAsXG4gICAgICAgICAgICB2YWx1ZTogU3RyaW5nKHZhbHVlKVxuICAgICAgICAgIH1cbiAgICAgICAgfV07XG4gICAgICAgIHJldHVybiB0ZDtcbiAgICAgIH0sXG4gICAgICBzZWxlY3RtdWx0aXBsZTogKHZhbHVlLCByb3dJbmRleCwgY2VsbEluZGV4LCB0ZCA9IHt9KSA9PiB7XG4gICAgICAgIGNvbnN0IGNvbHVtbiA9IHRoaXMuZ3JpZC5jb2x1bW5zW2NlbGxJbmRleF07XG4gICAgICAgIHZhbHVlID0gKGlzTmFOKHZhbHVlKSkgPyAoKGNvbHVtbi5oYXNPd25Qcm9wZXJ0eSgnZmllbGQnKSkgPyB0aGlzLmdldENlbGxEYXRhKHJvd0luZGV4LCBjb2x1bW4uZmllbGQpIDogdmFsdWUpIDogdmFsdWU7XG4gICAgICAgIHRkLmNoaWxkbm9kZXMgPSBbe1xuICAgICAgICAgIG5vZGVuYW1lOiBcIklOUFVUXCIsXG4gICAgICAgICAgYXR0cmlidXRlczoge1xuICAgICAgICAgICAgdHlwZTogXCJjaGVja2JveFwiLFxuICAgICAgICAgICAgbmFtZTogYCR7dGhpcy51dWlkfXNlbGVjdFtdYCxcbiAgICAgICAgICAgIHZhbHVlOiBTdHJpbmcodmFsdWUpXG4gICAgICAgICAgfVxuICAgICAgICB9XTtcbiAgICAgICAgcmV0dXJuIHRkO1xuICAgICAgfSxcbiAgICAgIGRlY2ltYWw6ICh2YWx1ZSwgcm93SW5kZXgsIGNlbGxJbmRleCwgdGQgPSB7fSkgPT4ge1xuICAgICAgICBpZiAoaXNOYU4odmFsdWUpKSB2YWx1ZSA9IDA7XG4gICAgICAgIHZhbHVlID0gcGFyc2VGbG9hdCh2YWx1ZSkudG9GaXhlZCgyKTtcbiAgICAgICAgaWYgKHZhbHVlIC0gcGFyc2VJbnQodmFsdWUpID09PSAwKSB2YWx1ZSA9IHBhcnNlSW50KHZhbHVlKTtcbiAgICAgICAgaWYgKCF0ZC5oYXNPd25Qcm9wZXJ0eSgnYXR0cmlidXRlcycpKSB0ZC5hdHRyaWJ1dGVzID0ge307XG4gICAgICAgIHRkLmF0dHJpYnV0ZXMuY2xhc3MgPSBjc3MubnVtYmVyO1xuICAgICAgICB0ZC5jaGlsZG5vZGVzID0gW3RoaXMuc2V0VGV4dE5vZGUodmFsdWUpXTtcbiAgICAgICAgcmV0dXJuIHRkO1xuICAgICAgfSxcbiAgICAgIG51bWJlcjogKHZhbHVlLCByb3dJbmRleCwgY2VsbEluZGV4LCB0ZCA9IHt9KSA9PiB7XG4gICAgICAgIGlmIChpc05hTih2YWx1ZSkpIHZhbHVlID0gMDtcbiAgICAgICAgaWYgKCF0ZC5oYXNPd25Qcm9wZXJ0eSgnYXR0cmlidXRlcycpKSB0ZC5hdHRyaWJ1dGVzID0ge307XG4gICAgICAgIHRkLmF0dHJpYnV0ZXMuY2xhc3MgPSBjc3MubnVtYmVyO1xuICAgICAgICB0ZC5jaGlsZG5vZGVzID0gW3RoaXMuc2V0VGV4dE5vZGUodmFsdWUpXTtcbiAgICAgICAgcmV0dXJuIHRkO1xuICAgICAgfSxcbiAgICAgIGNoZWNrOiAodmFsdWUsIHJvd0luZGV4LCBjZWxsSW5kZXgsIHRkID0ge30pID0+IHtcbiAgICAgICAgaWYgKGlzTmFOKHZhbHVlKSkgdmFsdWUgPSBgYDtcbiAgICAgICAgc3dpdGNoICh2YWx1ZSkge1xuICAgICAgICAgIGNhc2UgdHJ1ZTpcbiAgICAgICAgICBjYXNlICdZJzpcbiAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICB2YWx1ZSA9IFwiXCI7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgdmFsdWUgPSBcIm5vLVwiO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaWNvbiA9IHtcbiAgICAgICAgICBub2RlbmFtZTogXCJJXCIsXG4gICAgICAgICAgYXR0cmlidXRlczoge1xuICAgICAgICAgICAgY2xhc3M6IGBpY29uLXNtICBpY29uLSR7dmFsdWV9Y2hlY2sgYFxuICAgICAgICAgIH0sXG4gICAgICAgICAgY2hpbGRub2RlczogW11cbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb2x1bW4gPSB0aGlzLmdyaWQuY29sdW1uc1tjZWxsSW5kZXhdO1xuICAgICAgICBjb25zdCBpZCA9IHRoaXMuZ2V0Q2VsbERhdGEocm93SW5kZXgsIHRoaXMuY2VsbGlkbmFtZSk7XG4gICAgICAgIGlmIChjb2x1bW4uaGFzT3duUHJvcGVydHkoXCJ0b2dnbGVcIikpIHRkLmNoaWxkbm9kZXMgPSBbe1xuICAgICAgICAgIG5vZGVuYW1lOiBcIkFcIixcbiAgICAgICAgICBhdHRyaWJ1dGVzOiB7XG4gICAgICAgICAgICBcImRhdGEtcmVxdWVzdFwiOiBcInRvZ2dsZVwiLFxuICAgICAgICAgICAgXCJkYXRhLWFjdGlvblwiOiBgJHtjb2x1bW4udG9nZ2xlLmxpbmt9LyR7aWR9YCxcbiAgICAgICAgICAgIFwiaHJlZlwiOiBcImphdmFzY3JpcHQ6dm9pZCgpXCJcblxuICAgICAgICAgIH0sXG4gICAgICAgICAgY2hpbGRub2RlczogW2ljb25dXG5cbiAgICAgICAgfV1cbiAgICAgICAgZWxzZSB0ZC5jaGlsZG5vZGVzID0gW2ljb25dO1xuICAgICAgICByZXR1cm4gdGQ7XG4gICAgICB9LFxuICAgICAgdGV4dDogKHZhbHVlLCByb3dJbmRleCwgY2VsbEluZGV4LCB0ZCA9IHt9KSA9PiB7XG4gICAgICAgIGlmICh2YWx1ZSA9PT0gbnVsbCkgdGQuY2hpbGRub2RlcyA9IFtdO1xuICAgICAgICBlbHNlIHtcbiAgICAgICAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2VBbGwoJ1xcclxcbicsICcsICcpO1xuICAgICAgICAgIGlmICh2YWx1ZSAhPT0gYGApIHRkLmNoaWxkbm9kZXMgPSBbe1xuICAgICAgICAgICAgbm9kZW5hbWU6IFwiRElWXCIsXG4gICAgICAgICAgICBhdHRyaWJ1dGVzOiB7XG4gICAgICAgICAgICAgIGNsYXNzOiBjc3MuY29tcG9uZW50LnRhYmxlLnRpcFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNoaWxkbm9kZXM6IFt0aGlzLnNldFRleHROb2RlKHZhbHVlKV1cbiAgICAgICAgICB9XTtcbiAgICAgICAgICBlbHNlIHRkLmNoaWxkbm9kZXMgPSBbXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGQ7XG4gICAgICB9LFxuICAgICAgZGVmYXVsdDogKHZhbHVlLCByb3dJbmRleCwgY2VsbEluZGV4LCB0ZCA9IHt9KSA9PiB7XG4gICAgICAgIGlmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gYGApIHRkLmNoaWxkbm9kZXMgPSBbXTtcbiAgICAgICAgZWxzZSB0ZC5jaGlsZG5vZGVzID0gW3RoaXMuc2V0VGV4dE5vZGUodmFsdWUpXTtcbiAgICAgICAgcmV0dXJuIHRkO1xuICAgICAgfVxuXG4gICAgfVxuICAgIGxldCB0YWJsZWN1c3RvbSA9IG51bGw7XG5cbiAgICBzd2l0Y2ggKHRoaXMucGFyYW1zLmZyb20pIHtcbiAgICAgIGNhc2UgJ2NvbGxlY3Rpb25saXN0JzpcbiAgICAgICAgdGFibGVjdXN0b20gPSBhd2FpdCBpbXBvcnQoJy4uL21vZHVsZXMvdGFibGUtY29sbGVjdGlvbi5qcycpO1xuICAgICAgICB0aGlzLmNlbGxpZG5hbWUgPSBtb2RlbHMuaWQ7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAncHJqbGlzdCc6XG4gICAgICAgIHRhYmxlY3VzdG9tID0gYXdhaXQgaW1wb3J0KCcuLi9tb2R1bGVzL3RhYmxlLXByb2plY3QuanMnKTtcbiAgICAgICAgdGhpcy5jZWxsaWRuYW1lID0gbW9kZWxzLnByb2ppZDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdwcmpzYW1wbGVzdGF0cyc6XG4gICAgICAgIHRhYmxlY3VzdG9tID0gYXdhaXQgaW1wb3J0KCcuLi9tb2R1bGVzL3RhYmxlLXNhbXBsZS5qcycpO1xuICAgICAgICB0aGlzLmNlbGxpZG5hbWUgPSBtb2RlbHMuc2FtcGxlaWQ7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcInByanByZWRpY3RcIjpcbiAgICAgICAgdGFibGVjdXN0b20gPSBhd2FpdCBpbXBvcnQoJy4uL21vZHVsZXMvdGFibGUtcHJlZGljdGlvbi5qcycpO1xuICAgICAgICB0aGlzLmNlbGxpZG5hbWUgPSBtb2RlbHMucHJvamlkO1xuXG4gICAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIHJldHVybiAodGFibGVjdXN0b20pID8geyAuLi5mb3JtYXR0ZXJzLFxuICAgICAgLi4udGFibGVjdXN0b20uZGVmYXVsdCh0aGlzKVxuICAgIH0gOiBmb3JtYXR0ZXJzO1xuXG5cbiAgfVxuICBhc3luYyBjb252ZXJ0Q29sdW1ucyh0YWJsZWRlZikge1xuICAgIGNvbnN0IGNvbHVtbnMgPSAodGFibGVkZWYuY29sdW1ucykgPyB0YWJsZWRlZi5jb2x1bW5zIDogKCh0aGlzLnBhcmFtcy5jb2x1bW5zKSA/IEpTT04ucGFyc2UodGhpcy5wYXJhbXMuY29sdW1ucykgOiBudWxsKTtcbiAgICBpZiAoIWNvbHVtbnMpIHJldHVybjtcbiAgICBjb25zdCBmb3JtYXR0ZXJzID0gYXdhaXQgdGhpcy5nZXRGb3JtYXR0ZXJzKCk7XG4gICAgLy9cbiAgICBjb25zdCBmaWVsZHMgPSBbXTtcbiAgICBPYmplY3QuZW50cmllcyh0YWJsZWRlZi5jb2x1bW5zKS5mb3JFYWNoKChba2V5LCBjb2x1bW5dKSA9PiB7XG4gICAgICBpZiAoIWNvbHVtbi5oYXNPd25Qcm9wZXJ0eSgnZW1wdHlkYXRhJykpIGZpZWxkcy5wdXNoKGtleSk7XG4gICAgfSk7XG4gICAgY29uc3QgbWFwX2NvbHVtbiA9IChrZXksIGNvbHVtbiwgaW5kZXgpID0+IHtcbiAgICAgIGlmICghY29sdW1uKSByZXR1cm4ge1xuICAgICAgICBpbmRleDogaW5kZXgsXG4gICAgICAgIG5hbWU6IGtleSxcbiAgICAgICAgaGlkZGVuOiB0cnVlXG4gICAgICB9O1xuICAgICAgbGV0IGNvbCA9IHtcbiAgICAgICAgaW5kZXg6IGluZGV4LFxuICAgICAgICBuYW1lOiBrZXksXG4gICAgICAgIGxhYmVsOiB0aGlzLmxhYmVsRm9ybWF0dGVyKGNvbHVtbiksXG4gICAgICAgIHNvcnRhYmxlOiB0cnVlLFxuICAgICAgfTtcbiAgICAgIGNvbC5pbmRleCA9IChjb2x1bW4uaGFzT3duUHJvcGVydHkoJ2VtcHR5ZGF0YScpKSA/IGZpZWxkcy5pbmRleE9mKGNvbHVtbi5lbXB0eWRhdGEpIDogZmllbGRzLmluZGV4T2Yoa2V5KTtcbiAgICAgIGlmIChjb2x1bW4ubm90c29ydGFibGUpIGNvbC5zb3J0YWJsZSA9IGZhbHNlO1xuICAgICAgZWxzZSBpZiAoY29sdW1uLnNvcnRhYmxlKSBjb2wuc29ydCA9IGNvbC5zb3J0YWJsZTtcbiAgICAgIGNvbC5zZWFyY2hhYmxlID0gKGNvbC5ub3RzZWFyY2hhYmxlKSA/IGZhbHNlIDogdHJ1ZTtcbiAgICAgIGlmIChjb2x1bW4uaGlkZGVuKSBjb2wuaGlkZGVuID0gc3RyaW5nX3RvX2Jvb2xlYW4oY29sdW1uLmhpZGRlbik7XG4gICAgICBpZiAoWydudW1iZXInLCAnZGVjaW1hbCddLmZpbmQoZm9ybWF0ID0+IGZvcm1hdCA9PT0gY29sdW1uLmZvcm1hdCkpIGNvbC50eXBlID0gJ251bWJlcic7XG4gICAgICBsZXQgcmVuZGVyID0gbnVsbDtcbiAgICAgIHN3aXRjaCAoa2V5KSB7XG4gICAgICAgIGNhc2UgJ3NlbGVjdCc6XG4gICAgICAgICAgY29uc3Qgc2VsZWN0ID0gKGNvbHVtbi5zZWxlY3QgJiYgY29sdW1uLnNlbGVjdCA9PSBcImNvbnRyb2xzXCIpID8gXCJjb250cm9sc1wiIDogKChjb2x1bW4uc2VsZWN0Y2VsbHMpID8gXCJpbXBvcnRzXCIgOiBjb2x1bW4uc2VsZWN0KTtcbiAgICAgICAgICBpZiAoc2VsZWN0KSB7XG4gICAgICAgICAgICBjb2wgPSB7IC4uLmNvbHVtbixcbiAgICAgICAgICAgICAgLi4uY29sXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbC5zb3J0YWJsZSA9IGNvbC5zZWFyY2hhYmxlID0gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgaWYgKCFjb2x1bW4uaGFzT3duUHJvcGVydHkoJ2hpZGRlbicpKSB7XG4gICAgICAgIGNvbnN0IHNlbGVjdCA9IChjb2x1bW4uc2VsZWN0ICYmIGNvbHVtbi5zZWxlY3QgPT0gbW9kZWxzLmNvbnRyb2xzKSA/IG1vZGVscy5jb250cm9scyA6ICgoY29sdW1uLnNlbGVjdGNlbGxzKSA/IG1vZGVscy5pbXBvcnRzIDogY29sdW1uLnNlbGVjdClcbiAgICAgICAgY29uc3QgZm9ybWF0ID0gKGNvbHVtbi5mb3JtYXQpID8gY29sdW1uLmZvcm1hdCA6ICgoY29sdW1uLnN1YmZpZWxkKSA/IGNvbHVtbi5zdWJmaWVsZCA6ICgoc2VsZWN0KSA/IHNlbGVjdCA6IFwiZGVmYXVsdFwiKSk7XG4gICAgICAgIGlmIChmb3JtYXR0ZXJzICYmIGZvcm1hdHRlcnNbZm9ybWF0XSkgY29sLnJlbmRlciA9IGZvcm1hdHRlcnNbZm9ybWF0XTtcblxuICAgICAgfVxuICAgICAgcmV0dXJuIGNvbDtcbiAgICB9XG5cbiAgICB0aGlzLmdyaWQuY29sdW1ucyA9IE9iamVjdC5lbnRyaWVzKGNvbHVtbnMpLm1hcCgoW2tleSwgY29sdW1uXSwgaW5kZXgpID0+IG1hcF9jb2x1bW4oa2V5LCBjb2x1bW4sIGluZGV4KSk7XG4gIH1cbiAgaW5pdEV2ZW50cygpIHtcblxuICAgIE1vZHVsZUV2ZW50RW1pdHRlci5vbih0aGlzLmV2ZW50bmFtZXMudXBkYXRlLCAoKSA9PiB7XG4gICAgICB0aGlzLmRvbS5jbGFzc0xpc3QucmVtb3ZlKGNzcy5oaWRlKTtcbiAgICB9LCB0aGlzLnV1aWQpO1xuICB9XG4gIGluaXRQbHVnaW5zKGNvbnRhaW5lcikge1xuICAgIGlmICghdGhpcy5ncmlkLmRhdGEubGVuZ3RoKSByZXR1cm47XG4gICAgaWYgKHRoaXMucGFyYW1zLmltcG9ydCAmJiB0aGlzLmluaXRJbXBvcnQpIHRoaXMuaW5pdEltcG9ydCh0aGlzKTtcbiAgICBpZiAodGhpcy5wYXJhbXMuZXhwYW5kKSB0aGlzLm1ha2VFeHBhbmRhYmxlKGNvbnRhaW5lcik7XG4gICAgaWYgKHRoaXMucGFyYW1zLmV4cG9ydCkgdGhpcy5tYWtlRXhwb3J0YWJsZShjb250YWluZXIpO1xuICAgIGlmICh0aGlzLnBhcmFtcy5kZXRhaWxzIHx8IHRoaXMuZG9tLnF1ZXJ5U2VsZWN0b3IodGFibGVzZWxlY3RvcnMuZGV0YWlscykpIHtcbiAgICAgIHRoaXMuaW5pdERldGFpbHMoKTtcbiAgICB9IGVsc2UgdGhpcy5pbml0RXZlbnRzKCk7XG4gICAgaWYgKHRoaXMucGFyYW1zLm9uc2VsZWN0KSB0aGlzLmluaXRTZWxlY3QoY29udGFpbmVyKTtcbiAgICBpZiAodGhpcy5kb20ucXVlcnlTZWxlY3RvckFsbCgndGhlYWQgW2RhdGEtYWx0c29ydF0nKS5sZW5ndGgpIHRoaXMuaW5pdEFsdGVybmF0ZVNvcnQodGhpcy5kb20ucXVlcnlTZWxlY3RvckFsbCgndGhlYWQgW2RhdGEtYWx0c29ydF0nKSk7XG4gICAgaWYgKHRoaXMucGFyYW1zLmZpbHRlcnMpIHtcbiAgICAgIGNvbnN0IHRvcCA9IHRoaXMud3JhcHBlci5xdWVyeVNlbGVjdG9yKHRhYmxlc2VsZWN0b3JzLnRvcCk7XG4gICAgICBpZiAodG9wICYmIHRvcC5jaGlsZHJlbi5sZW5ndGgpIHtcbiAgICAgICAgY29uc3QgZmlsdGVycyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGFibGVzZWxlY3RvcnMuZmlsdGVycyk7XG4gICAgICAgIC8vIGluc2VydCAgZmlsdGVycyBub2RlICBpbiBkYXRhdGFibGUgdG9wXG4gICAgICAgIGlmIChmaWx0ZXJzKSB0b3AucHJlcGVuZChmaWx0ZXJzKTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHRoaXMuZG9tLnF1ZXJ5U2VsZWN0b3IodGFibGVzZWxlY3RvcnMudGlwKSkge1xuICAgICAgdGhpcy5pbml0VGlwcygpO1xuICAgIH1cblxuICB9XG4gIGluaXRTb3J0KCkge1xuXG4gICAgY29uc3QgdGhzID0gdGhpcy5kb20ucXVlcnlTZWxlY3RvckFsbCgndGhlYWQgdGgnKTtcbiAgICBsZXQgaW5kZXggPSAwO1xuICAgIHRoaXMuZ3JpZC5jb2x1bW5zLmZvckVhY2goKGNvbHVtbiwgaSkgPT4ge1xuICAgICAgaWYgKGNvbHVtbi5oYXNPd25Qcm9wZXJ0eSgnaGlkZGVuJykpIHJldHVybjtcbiAgICAgIGlmIChjb2x1bW4uc29ydGFibGUpIHtcbiAgICAgICAgY29uc3QgdGggPSB0aHNbaW5kZXhdO1xuICAgICAgICBjb25zdCBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xuICAgICAgICBhLmNsYXNzTGlzdC5hZGQodGFibGVzZWxlY3RvcnMuc29ydGVyLnN1YnN0cigxKSk7XG4gICAgICAgIGEuYXBwZW5kQ2hpbGQodGguY2hpbGROb2Rlc1swXSk7XG4gICAgICAgIHRoLmFwcGVuZENoaWxkKGEpO1xuICAgICAgICB0aC5jaGlsZE5vZGVzLmZvckVhY2goY2hpbGQgPT4ge1xuICAgICAgICAgIHRoLmFwcGVuZENoaWxkKGNoaWxkKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgYS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgICAgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICBpZiAodGhpcy5zb3J0aW5nID09PSB0cnVlIHx8IHRoaXMuc2VhcmNoaW5nID09PSB0cnVlKSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMuc29ydENvbHVtbih0aCwgY29sdW1uLmluZGV4KTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBpbmRleCsrO1xuICAgIH0pO1xuICAgIHRoaXMuc29ydGluZyA9IGZhbHNlO1xuICAgIC8vIHJlbW92ZSBkZXRhaWxzIHdoZW4gc29ydGluZ1xuICAgIE1vZHVsZUV2ZW50RW1pdHRlci5vbih0aGlzLmV2ZW50bmFtZXMuc29ydGluZywgKHJlcSkgPT4ge1xuICAgICAgLy8gcmVxIHtkaXI6ZGlyZWN0aW9uLCBpbmRleDppbmRleH1cbiAgICAgIGlmICh0aGlzLnBsdWdpbnMuanNEZXRhaWwpIHRoaXMucGx1Z2lucy5qc0RldGFpbC5hY3RpdmVEZXRhaWwoZmFsc2UpO1xuICAgICAgdGhpcy5kb20ucXVlcnlTZWxlY3RvckFsbCgnLnRhYmxlLXNvcnRlcicpLmZvckVhY2goKGEsIGkpID0+IHtcbiAgICAgICAgYS5jbGFzc0xpc3QuYWRkKCgoaSA9PT0gcmVxLmluZGV4KSA/IGNzcy53YWl0IDogY3NzLmRpc2FibGVkKSk7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuc29ydGluZyA9IHRydWU7XG4gICAgfSwgdGhpcy51dWlkKTtcbiAgICAvLyByZW1vdmUgZGV0YWlscyB3aGVuIHNvcnRpbmdcbiAgICBNb2R1bGVFdmVudEVtaXR0ZXIub24odGhpcy5ldmVudG5hbWVzLnNvcnRlZCwgKHJlcSkgPT4ge1xuICAgICAgLy8gcmVxIHtkaXI6ZGlyZWN0aW9uLCBpbmRleDppbmRleH1cbiAgICAgIHRoaXMuZG9tLnF1ZXJ5U2VsZWN0b3JBbGwoJy50YWJsZS1zb3J0ZXInKS5mb3JFYWNoKChhLCBpKSA9PiB7XG4gICAgICAgIGEuY2xhc3NMaXN0LnJlbW92ZSgoKGkgPT09IHJlcS5pbmRleCkgPyBjc3Mud2FpdCA6IGNzcy5kaXNhYmxlZCkpXG4gICAgICB9KTtcbiAgICAgIHRoaXMuc29ydGluZyA9IGZhbHNlO1xuICAgIH0sIHRoaXMudXVpZCk7XG4gIH1cbiAgc29ydENvbHVtbih0aCwgaW5kZXgsIGRpciA9IG51bGwpIHtcbiAgICBkaXIgPSAoZGlyID09PSBudWxsKSA/ICgodGguY2xhc3NMaXN0LmNvbnRhaW5zKHRhYmxlY3NzLmFzY2VuZGluZykpID8gZmFsc2UgOiAodGguY2xhc3NMaXN0LmNvbnRhaW5zKHRhYmxlY3NzLmRlc2NlbmRpbmcpKSA/IHRydWUgOiAoKHRoLmRhdGFzZXQuc29ydCkgPyBmYWxzZSA6IHRydWUpKSA6IGRpcjtcbiAgICB0aC5jbGFzc0xpc3QudG9nZ2xlKHRhYmxlY3NzLmFzY2VuZGluZyk7XG4gICAgdGguY2xhc3NMaXN0LnRvZ2dsZSh0YWJsZWNzcy5kZXNjZW5kaW5nKTtcbiAgICBNb2R1bGVFdmVudEVtaXR0ZXIuZW1pdCh0aGlzLmV2ZW50bmFtZXMuc29ydGluZywge1xuICAgICAgZGlyOiBkaXIsXG4gICAgICBpbmRleDogdGguY2VsbEluZGV4XG4gICAgfSwgdGhpcy51dWlkKTtcbiAgICBsZXQgcm93cyA9IHRoaXMuZ3JpZC5kYXRhLm1hcCgocm93LCBpKSA9PiB7XG4gICAgICBjb25zdCBjZWxsID0gaXNfb2JqZWN0KHJvd1tpbmRleF0pID8gSlNPTi5zdHJpbmdpZnkocm93W2luZGV4XSkgOiAoKEFycmF5LmlzQXJyYXkocm93W2luZGV4XSkpID8gcm93W2luZGV4XVswXSA6IHJvd1tpbmRleF0pO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdmFsdWU6IHR5cGVvZiBjZWxsID09PSBcInN0cmluZ1wiID8gY2VsbC50b0xvd2VyQ2FzZSgpIDogKChjZWxsID09PSBudWxsKSA/IDAgOiBjZWxsKSxcbiAgICAgICAgcm93OiBpXG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBjb25zdCBjb21wYXJlX2NvbGRhdGEgPSBmdW5jdGlvbihhLCBiKSB7XG4gICAgICBjb25zdCB4ID0gKGRpciA/IGEudmFsdWUgOiBiLnZhbHVlKTtcbiAgICAgIGNvbnN0IHkgPSAoZGlyID8gYi52YWx1ZSA6IGEudmFsdWUpO1xuICAgICAgcmV0dXJuIHgubG9jYWxlQ29tcGFyZSh5LCB1bmRlZmluZWQsIHtcbiAgICAgICAgbnVtZXJpYzogdHJ1ZSxcbiAgICAgICAgc2Vuc2l0aXZpdHk6ICdiYXNlJ1xuICAgICAgfSk7XG5cbiAgICB9O1xuXG4gICAgaWYgKGRpciA9PT0gZmFsc2UpIHtcbiAgICAgIHRoLmNsYXNzTGlzdC5yZW1vdmUodGFibGVjc3MuYXNjZW5kaW5nKTtcbiAgICAgIHRoLmNsYXNzTGlzdC5hZGQodGFibGVjc3MuZGVzY2VuZGluZyk7XG4gICAgICB0aC5zZXRBdHRyaWJ1dGUoXCJhcmlhLXNvcnRcIiwgXCJkZXNjZW5kaW5nXCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aC5jbGFzc0xpc3QucmVtb3ZlKHRhYmxlY3NzLmRlc2NlbmRpbmcpO1xuICAgICAgdGguY2xhc3NMaXN0LmFkZCh0YWJsZWNzcy5hc2NlbmRpbmcpO1xuICAgICAgdGguc2V0QXR0cmlidXRlKFwiYXJpYS1zb3J0XCIsIFwiYXNjZW5kaW5nXCIpO1xuICAgIH1cblxuICAgIC8qIENsZWFyIGFzYy9kZXNjIGNsYXNzIG5hbWVzIGZyb20gdGhlIGxhc3Qgc29ydGVkIGNvbHVtbidzIHRoIGlmIGl0IGlzbid0IHRoZSBzYW1lIGFzIHRoZSBvbmUgdGhhdCB3YXMganVzdCBjbGlja2VkICovXG4gICAgaWYgKHRoaXMuZG9tLmRhdGFzZXQubGFzdHRoICE9PSB1bmRlZmluZWQgJiYgdGguY2VsbEluZGV4ICE9IHRoaXMuZG9tLmRhdGFzZXQubGFzdHRoKSB7XG4gICAgICBjb25zdCBoZWFkaW5ncyA9IHRoaXMuZG9tLnF1ZXJ5U2VsZWN0b3JBbGwoXCJ0aGVhZCB0aFwiKTtcbiAgICAgIGhlYWRpbmdzW3RoaXMuZG9tLmRhdGFzZXQubGFzdHRoXS5jbGFzc0xpc3QucmVtb3ZlKHRhYmxlY3NzLmRlc2NlbmRpbmcpO1xuICAgICAgaGVhZGluZ3NbdGhpcy5kb20uZGF0YXNldC5sYXN0dGhdLmNsYXNzTGlzdC5yZW1vdmUodGFibGVjc3MuYXNjZW5kaW5nKTtcbiAgICAgIGhlYWRpbmdzW3RoaXMuZG9tLmRhdGFzZXQubGFzdHRoXS5yZW1vdmVBdHRyaWJ1dGUoXCJhcmlhLXNvcnRcIik7XG5cbiAgICB9XG4gICAgdGhpcy5kb20uZGF0YXNldC5sYXN0dGggPSB0aC5jZWxsSW5kZXg7XG4gICAgY29uc3QgY29sbGF0b3IgPSBuZXcgSW50bC5Db2xsYXRvcih1bmRlZmluZWQsIHtcbiAgICAgIG51bWVyaWM6IHRydWUsXG4gICAgICBzZW5zaXRpdml0eTogJ2Jhc2UnXG4gICAgfSlcbiAgICByb3dzLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgIHJldHVybiBjb2xsYXRvci5jb21wYXJlKChkaXIgPyBhLnZhbHVlIDogYi52YWx1ZSksIChkaXIgPyBiLnZhbHVlIDogYS52YWx1ZSkpXG4gICAgfSk7XG4gICAgLypyb3dzLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgIHJldHVybiBjb21wYXJlX2NvbGRhdGEoYSwgYik7XG4gICAgfSk7Ki9cbiAgICBjb25zdCB0Ym9keSA9IHRoaXMuZG9tLnF1ZXJ5U2VsZWN0b3IoJ3Rib2R5Jyk7XG4gICAgY29uc3QgY2xvbmUgPSB0Ym9keS5jbG9uZU5vZGUoKTtcbiAgICBjb25zdCB0cnMgPSB0Ym9keS5xdWVyeVNlbGVjdG9yQWxsKCd0cicpO1xuICAgIHRib2R5LmlubmVySFRNTCA9IGBgO1xuICAgIGNvbnN0IHNvcnRlZCA9IFtdO1xuICAgIHJvd3MuZm9yRWFjaCgociwgaSkgPT4ge1xuICAgICAgY2xvbmUuYXBwZW5kQ2hpbGQodHJzW3Iucm93XSk7XG4gICAgICBzb3J0ZWQucHVzaCh0aGlzLmdyaWQuZGF0YVtyLnJvd10pO1xuXG4gICAgfSk7XG4gICAgdGhpcy5kb20ucmVwbGFjZUNoaWxkKGNsb25lLCB0Ym9keSk7XG4gICAgTW9kdWxlRXZlbnRFbWl0dGVyLmVtaXQodGhpcy5ldmVudG5hbWVzLnNvcnRlZCwge1xuICAgICAgZGlyOiBkaXIsXG4gICAgICBpbmRleDogdGguY2VsbEluZGV4XG4gICAgfSwgdGhpcy51dWlkKTtcblxuXG4gIH1cblxuICBkaXNwbGF5U2VsZWN0ZWQocXVlcmllcywgaW5kZXhlcywgY2VsbGlkLCB0b2dnbGUgPSBudWxsKSB7XG4gICAgY29uc3QgdHJzID0gdGhpcy5kb20ucXVlcnlTZWxlY3RvckFsbCgndGJvZHkgdHInKTtcbiAgICBpZiAodG9nZ2xlID09PSBudWxsKSB0b2dnbGUgPSBmdW5jdGlvbih0ciwgdmFsdWUsIGlkeCkge1xuICAgICB0ci5oaWRkZW4gPSB2YWx1ZTtcbiAgICB9XG4gICAgY29uc3QgcmVzZXQgPSAocXVlcmllcy5sZW5ndGggPT09IDAgJiYgaW5kZXhlcy5sZW5ndGggPT09IDApO1xuICAgIHRycy5mb3JFYWNoKCh0ciwgaW5kZXgpID0+IHtcbiAgICAgIGlmIChyZXNldCkgdG9nZ2xlKHRyLCBmYWxzZSk7XG4gICAgICBlbHNlIHtcbiAgICAgICAgY29uc3QgdmFsID0gKHF1ZXJpZXMubGVuZ3RoID4gMCAmJiBpbmRleGVzLmxlbmd0aCA9PT0gMCkgPyBOT1RGT1VORCA6ICh0ci5kYXRhc2V0W3RoaXMuY2VsbGlkbmFtZV0gIT09IG51bGwpID8gdHIuZGF0YXNldFt0aGlzLmNlbGxpZG5hbWVdIDogdHIuY2VsbHNbY2VsbGlkXS50ZXh0Q29udGVudDtcbiAgICAgICAgY29uc3QgaWR4ID0gaW5kZXhlcy5pbmRleE9mKHZhbCk7XG4gICAgICAgIGlmIChpZHggPCAwKSB0b2dnbGUodHIsIHRydWUsIGlkeCk7XG4gICAgICAgIGVsc2UgdG9nZ2xlKHRyLCBmYWxzZSwgaWR4KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcblxuICBpbml0U2VhcmNoKCkge1xuICAgIGNvbnN0IHRvcCA9IHRoaXMud3JhcHBlci5xdWVyeVNlbGVjdG9yKHRhYmxlc2VsZWN0b3JzLnRvcCk7XG4gICAgaWYgKCF0aGlzLnBhcmFtcy5zZWFyY2hhYmxlIHx8IHRvcCA9PT0gbnVsbCkgcmV0dXJuO1xuICAgIGlmICh0aGlzLmdyaWQuZGF0YS5sZW5ndGggPCAxMCkgcmV0dXJuIHRoaXMudG9nZ2xlQWRkT25zKCk7XG4gICAgZWxzZSB0aGlzLnRvZ2dsZUFkZE9ucyhbdGFibGVzZWxlY3RvcnMuc2VhcmNoICsgJyBpbnB1dCddLCBmYWxzZSk7XG4gICAgdGhpcy5zZWFyY2hpbmcgPSBmYWxzZTtcbiAgICBjb25zdCBjZWxsaWQgPSB0aGlzLmdldENlbGxJZCh0aGlzLmNlbGxpZG5hbWUpO1xuICAgIC8vIHNlYXJjaCBpdGVtc1xuICAgIGxldCBzZWFyY2hib3ggPSB0b3AucXVlcnlTZWxlY3Rvcih0YWJsZXNlbGVjdG9ycy5zZWFyY2gpO1xuICAgIGlmIChzZWFyY2hib3ggPT09IG51bGwpIHtcbiAgICAgIHNlYXJjaGJveCA9IHRoaXMub2JqVG9FbGVtZW50KHtcbiAgICAgICAgbm9kZW5hbWU6ICdESVYnLFxuICAgICAgICBhdHRyaWJ1dGVzOiB7XG4gICAgICAgICAgY2xhc3M6IHRhYmxlc2VsZWN0b3JzLnNlYXJjaC5zdWJzdHIoMSlcbiAgICAgICAgfSxcbiAgICAgICAgY2hpbGRub2RlczogW3tcbiAgICAgICAgICBub2RlbmFtZTogJ2lucHV0JyxcbiAgICAgICAgICBhdHRyaWJ1dGVzOiB7XG4gICAgICAgICAgICB0eXBlOiAnc2VhcmNoJyxcbiAgICAgICAgICAgIG5hbWU6ICd0YWJsZS1zZWFyY2gnLFxuICAgICAgICAgICAgcGxhY2Vob2xkZXI6IHRoaXMubGFiZWxzLnBsYWNlaG9sZGVyLFxuICAgICAgICAgICAgY2xhc3M6IGAke3RhYmxlc2VsZWN0b3JzLmlucHV0LnN1YnN0cigxKX0gJHtjc3MuaW5wdXR9YFxuICAgICAgICAgIH1cbiAgICAgICAgfV1cbiAgICAgIH0pO1xuICAgICAgdG9wLmFwcGVuZENoaWxkKHNlYXJjaGJveCk7XG4gICAgfVxuICAgIGNvbnN0IHNlYXJjaGlucHV0ID0gc2VhcmNoYm94LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0Jyk7XG4gICAgaWYgKCFzZWFyY2hpbnB1dCkgcmV0dXJuO1xuICAgIGxldCBzZWFyY2hzdHJpbmcgPSBgYDtcbiAgICBjb25zdCB0YWJsZV9zZWFyY2ggPSBkZWJvdW5jZSgoc2VhcmNoc3RyaW5nLCBjYXNlc2Vuc2l0aXZlID0gZmFsc2UpID0+IHtcbiAgICAgIGZ1bmN0aW9uIHNlYXJjaF9zdHJpbmcoc3RyLCBjYXNlc2Vuc2l0aXZlKSB7XG4gICAgICAgIHN0ciA9IChjYXNlc2Vuc2l0aXZlKSA/IHN0ciA6IHN0ci50b0xvd2VyQ2FzZSgpO1xuICAgICAgICByZXR1cm4gc3RyO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBzZWFyY2hfcXVlcmllcyhzdHIsIGNhc2VzZW5zaXRpdmUpIHtcbiAgICAgICAgc3RyID0gc2VhcmNoX3N0cmluZyhzdHIsIGNhc2VzZW5zaXRpdmUpO1xuICAgICAgICBsZXQgc3RycyA9IFtdO1xuICAgICAgICBsZXQgcGhyYXNlO1xuICAgICAgICB3aGlsZSAoKHBocmFzZSA9IHN0ci5tYXRjaCgvXCIoW15cIl0rKVwiLykpICE9PSBudWxsKSB7XG5cbiAgICAgICAgICBzdHJzLnB1c2gocGhyYXNlWzFdKTtcbiAgICAgICAgICBzdHIgPSBzdHIuc3Vic3RyaW5nKDAsIHBocmFzZS5pbmRleCkgKyBzdHIuc3Vic3RyaW5nKHBocmFzZS5pbmRleCArIHBocmFzZVswXS5sZW5ndGgpO1xuICAgICAgICB9XG4gICAgICAgIC8vIEdldCByZW1haW5pbmcgc3BhY2Utc2VwYXJhdGVkIHdvcmRzIChpZiBhbnkpXG4gICAgICAgIHN0ciA9IHN0ci50cmltKCk7XG4gICAgICAgIGlmIChzdHIubGVuZ3RoKSBzdHJzID0gc3Rycy5jb25jYXQoc3RyLnNwbGl0KC9cXHMrLykpO1xuICAgICAgICByZXR1cm4gc3RycztcbiAgICAgIH1cbiAgICAgIGNvbnN0IHF1ZXJpZXMgPSBzZWFyY2hfcXVlcmllcyhzZWFyY2hzdHJpbmcpO1xuICAgICAgTW9kdWxlRXZlbnRFbWl0dGVyLmVtaXQodGhpcy5ldmVudG5hbWVzLnNlYXJjaCwge1xuICAgICAgICBzZWFyY2hzdHJpbmc6IHNlYXJjaHN0cmluZyxcbiAgICAgICAgcXVlcmllczogcXVlcmllc1xuICAgICAgfSwgdGhpcy51dWlkKTtcbiAgICAgIGxldCBkYXRhcyA9IHRoaXMuZ3JpZC5kYXRhLFxuICAgICAgICBpbmRleGVzID0gW107XG4gICAgICBxdWVyaWVzLmZvckVhY2gocXJ5ID0+IHtcbiAgICAgICAgaW5kZXhlcyA9IFtdO1xuICAgICAgICBkYXRhcyA9IGRhdGFzLmZpbHRlcigoZGF0YSwgaikgPT4ge1xuICAgICAgICAgIGNvbnN0IGZvdW5kID0gZGF0YS5maWx0ZXIoY2VsbCA9PiB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjZWxsKSB7XG4gICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgY2VsbCA9IChjZWxsKSA/IGNlbGwgOiBgYDtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgY2VsbCA9IEpTT04uc3RyaW5naWZ5KGNlbGwpO1xuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3NlYXJjaCcsIGVycik7XG4gICAgICAgICAgICAgICAgICBjZWxsID0gYGA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICBjYXNlICdhcnJheSc6XG4gICAgICAgICAgICAgICAgY2VsbCA9IGNlbGwuam9pbignICcpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGNlbGwgPSBTdHJpbmcoY2VsbCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gKChjYXNlc2Vuc2l0aXZlKSA/IGNlbGwuaW5kZXhPZihxcnkpID4gLTEgOiBjZWxsLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihxcnkpKSA+IC0xO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgaWYgKGZvdW5kLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGlmIChjZWxsaWQgPCAwKSBpbmRleGVzLnB1c2goU3RyaW5nKGopKTtcbiAgICAgICAgICAgIGVsc2UgaW5kZXhlcy5wdXNoKFN0cmluZyhkYXRhW2NlbGxpZF0pKTtcbiAgICAgICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIE1vZHVsZUV2ZW50RW1pdHRlci5lbWl0KHRoaXMuZXZlbnRuYW1lcy5zZWFyY2hlbmQsIHtcbiAgICAgICAgcXVlcmllczogcXVlcmllcyxcbiAgICAgICAgaW5kZXhlczogaW5kZXhlcyxcbiAgICAgICAgY2VsbGlkOiBjZWxsaWRcbiAgICAgIH0sIHRoaXMudXVpZCk7XG4gICAgfSwgMzAwKTtcbiAgICBjb25zdCBkaXNwbGF5X3NlYXJjaCA9IChxdWVyaWVzLCBpbmRleGVzLCBjZWxsaWQpID0+IHtcbiAgICAgIHRoaXMuZGlzcGxheVNlbGVjdGVkKHF1ZXJpZXMsIGluZGV4ZXMsIGNlbGxpZCk7XG4gICAgfTtcbiAgICBjb25zdCBjbGVhcl9zZWFyY2ggPSBkZWJvdW5jZSgoKSA9PiB7XG4gICAgICB0aGlzLnNlYXJjaGluZyA9IHRydWU7XG4gICAgICBjb25zdCB0cnMgPSB0aGlzLmRvbS5xdWVyeVNlbGVjdG9yQWxsKCd0Ym9keSB0cltoaWRkZW49XCJcIl0nKTtcbiAgICAgIHRycy5mb3JFYWNoKCh0ciwgaW5kZXgpID0+IHtcbiAgICAgICAgdHIuaGlkZGVuID0gZmFsc2U7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuc2VhcmNoaW5nID0gZmFsc2U7XG4gICAgICBzZWFyY2hpbnB1dC5jbGFzc0xpc3QucmVtb3ZlKGNzcy53YWl0KTtcbiAgICB9LCA1MDApO1xuXG4gICAgY29uc3Qgc2VhcmNoX2lucHV0ID0gKHZhbHVlKSA9PiB7XG4gICAgICBpZiAodmFsdWUgIT09IHNlYXJjaHN0cmluZykge1xuICAgICAgICBzZWFyY2hpbnB1dC5jbGFzc0xpc3QuYWRkKGNzcy53YWl0KTtcbiAgICAgICAgc2VhcmNoc3RyaW5nID0gdmFsdWU7XG4gICAgICAgIGlmICh2YWx1ZSA9PT0gJycpIHtcbiAgICAgICAgICBjbGVhcl9zZWFyY2goKTtcbiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZS5sZW5ndGggPiAyKSB7XG4gICAgICAgICAgdGFibGVfc2VhcmNoKHZhbHVlKTtcbiAgICAgICAgfVxuXG4gICAgICB9XG4gICAgfVxuICAgIHNlYXJjaGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoZSkgPT4ge1xuICAgICAgc2VhcmNoX2lucHV0KGUudGFyZ2V0LnZhbHVlKTtcbiAgICB9KTtcbiAgICBzZWFyY2hpbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICAgIHNlYXJjaF9pbnB1dChlLnRhcmdldC52YWx1ZSk7XG4gICAgfSk7XG4gICAgTW9kdWxlRXZlbnRFbWl0dGVyLm9uKHRoaXMuZXZlbnRuYW1lcy5zZWFyY2gsIChyZXEpID0+IHtcbiAgICAgIC8vICByZXF1ZXN0IHtzZWFyY2hzdHJpbmc6c2VhcmNoc3RyaW5nLCBxdWVyaWVzOnF1ZXJpZXN9XG4gICAgICBpZiAodGhpcy5zZWFyY2hpbmcgPT09IGZhbHNlKSB7XG4gICAgICAgIGlmICh0aGlzLnBsdWdpbnMuanNEZXRhaWwpIHRoaXMucGx1Z2lucy5qc0RldGFpbC5hY3RpdmVEZXRhaWwoZmFsc2UpO1xuICAgICAgfVxuICAgICAgdGhpcy5zZWFyY2hpbmcgPSB0cnVlO1xuICAgIH0sIHRoaXMudXVpZCk7XG4gICAgTW9kdWxlRXZlbnRFbWl0dGVyLm9uKHRoaXMuZXZlbnRuYW1lcy5zZWFyY2hlbmQsIChyZXEpID0+IHtcbiAgICAgIC8vIHJlcSB7cXVlcmllczpxdWVyaWVzLGluZGV4ZXM6IGluZGV4ZXMsIGNlbGxpZDpjZWxsaWR9XG4gICAgICBkaXNwbGF5X3NlYXJjaChyZXEucXVlcmllcywgcmVxLmluZGV4ZXMsIHJlcS5jZWxsaWQpO1xuICAgICAgc2VhcmNoaW5wdXQuY2xhc3NMaXN0LnJlbW92ZShjc3Mud2FpdCk7XG4gICAgICB0aGlzLnNlYXJjaGluZyA9IGZhbHNlO1xuICAgIH0sIHRoaXMudXVpZCk7XG4gICAgTW9kdWxlRXZlbnRFbWl0dGVyLm9uKHRoaXMuZXZlbnRuYW1lcy51cGRhdGUsICgpID0+IHtcbiAgICAgIGlmICh0aGlzLnNlYXJjaGluZyA9PT0gZmFsc2UpIHtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgcmVmcmVzaF9kZXRhaWxzKCk7XG4gICAgICAgIH0sIDMwMCk7XG4gICAgICB9XG4gICAgfSwgdGhpcy51dWlkKTtcbiAgICB0aGlzLnRvZ2dsZUFkZE9ucyhbdGFibGVzZWxlY3RvcnMuc2VhcmNoICsgJyBpbnB1dCddLCB0cnVlKTtcbiAgfVxuICBpbml0U2VsZWN0KGNvbnRhaW5lcikge1xuICAgIGNvbnN0IGlucHV0cyA9IHRoaXMuZG9tLnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0W25hbWVePVwiJyArIHRoaXMudXVpZCArICdcIl0nKTtcbiAgICBpZiAoaW5wdXRzLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xuICAgIGNvbnN0IGlucHV0bmFtZSA9IGlucHV0c1swXS5uYW1lO1xuICAgIGxldCBzZWxlY3RhY3Rpb24gPSBjb250YWluZXIucXVlcnlTZWxlY3RvcignLicgKyB0YWJsZWNzcy5zZWxlY3RhY3Rpb24pO1xuICAgIGlmICghc2VsZWN0YWN0aW9uKSByZXR1cm47XG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmQoc2VsZWN0YWN0aW9uKTtcbiAgICBzZWxlY3RhY3Rpb24ucXVlcnlTZWxlY3RvcignYScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgIGxldCB2YWxzID0gW107XG4gICAgICBpbnB1dHMuZm9yRWFjaChpbnB1dCA9PiB7XG4gICAgICAgIGlmIChpbnB1dC5jaGVja2VkKSB2YWxzLnB1c2goaW5wdXQudmFsdWUpO1xuICAgICAgfSk7XG4gICAgICBpZiAoc2VsZWN0YWN0aW9uLmRhdGFzZXQuaW5wdXQpIHtcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoc2VsZWN0YWN0aW9uLmRhdGFzZXQuaW5wdXQpLnZhbHVlID0gdmFscy5qb2luKCcsJyk7XG4gICAgICAgIGlmIChzZWxlY3RhY3Rpb24uZGF0YXNldC5mb3JtKSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChzZWxlY3RhY3Rpb24uZGF0YXNldC5mb3JtKS5zdWJtaXQoKTtcbiAgICAgIH0gZWxzZSBlLmN1cnJlbnRUYXJnZXQuaHJlZiA9IHRoaXMucGFyYW1zLm9uc2VsZWN0ICsgZW5jb2RlVVJJKHZhbHMuam9pbignLCcpKTtcblxuICAgIH0pO1xuICAgIGNvbnN0IGNsb3NlID0gc2VsZWN0YWN0aW9uLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLWRpc21pc3NdJyk7XG4gICAgaWYgKGNsb3NlKSBjbG9zZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuICAgICAgcG9wdXBfc2VsZWN0ZWQobnVsbCwgbnVsbCk7XG4gICAgfSk7XG5cbiAgICBjb25zdCBwb3B1cF9zZWxlY3RlZCA9ICh0b3AgPSBudWxsLCBsZWZ0ID0gbnVsbCwgZm9yY2VjbG9zZSA9IGZhbHNlKSA9PiB7XG4gICAgICBpZiAoc2VsZWN0YWN0aW9uLmRhdGFzZXQuY2xvc2UpIHtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmQoc2VsZWN0YWN0aW9uKTtcbiAgICAgICAgY2xvc2UuY2xhc3NMaXN0LnJlbW92ZSh0YWJsZWNzcy5oaWRkZW4pO1xuICAgICAgICBzZWxlY3RhY3Rpb24uY2xhc3NMaXN0LmFkZCh0YWJsZWNzcy5hYnNpbnB1dCk7XG4gICAgICB9XG4gICAgICBpZiAodG9wICE9PSBudWxsICYmIGxlZnQgIT09IG51bGwpIHtcbiAgICAgICAgc2VsZWN0YWN0aW9uLmNsYXNzTGlzdC5yZW1vdmUoY3NzLmhpZGUpO1xuICAgICAgICBzZWxlY3RhY3Rpb24uc3R5bGUudG9wID0gdG9wICsgJ3B4JztcbiAgICAgICAgc2VsZWN0YWN0aW9uLnN0eWxlLmxlZnQgPSBsZWZ0ICsgJ3B4JztcblxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGZvcmNlY2xvc2UgPT09IHRydWUpIHtcbiAgICAgICAgICBzZWxlY3RhY3Rpb24uY2xhc3NMaXN0LmFkZChjc3MuaGlkZSk7XG4gICAgICAgICAgZGVsZXRlIHNlbGVjdGFjdGlvbi5kYXRhc2V0LmNsb3NlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHNlbGVjdGFjdGlvbi5kYXRhc2V0LmNsb3NlID0gdHJ1ZTtcbiAgICAgICAgICBjbG9zZS5jbGFzc0xpc3QuYWRkKHRhYmxlY3NzLmhpZGRlbik7XG4gICAgICAgICAgY29uc3QgdG9wdGFibGUgPSB0aGlzLndyYXBwZXIucXVlcnlTZWxlY3Rvcih0YWJsZXNlbGVjdG9ycy50b3ApID8gdGhpcy53cmFwcGVyLnF1ZXJ5U2VsZWN0b3IodGFibGVzZWxlY3RvcnMudG9wKSA6IHRoaXMud3JhcHBlcjtcbiAgICAgICAgICB0b3B0YWJsZS5wcmVwZW5kKHNlbGVjdGFjdGlvbik7XG4gICAgICAgICAgc2VsZWN0YWN0aW9uLmNsYXNzTGlzdC5yZW1vdmUodGFibGVjc3MuYWJzaW5wdXQpO1xuXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgaW5wdXRzLmZvckVhY2goaW5wdXQgPT4ge1xuICAgICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKGUpID0+IHtcbiAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQpIHBvcHVwX3NlbGVjdGVkKGlucHV0Lm9mZnNldFRvcCwgaW5wdXQub2Zmc2V0TGVmdCk7XG4gICAgICAgIGVsc2UgaWYgKHRoaXMuZG9tLnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0W25hbWVePVwiJyArIHRoaXMudXVpZCArICdcIl06Y2hlY2tlZCcpLmxlbmd0aCA9PT0gMCkgcG9wdXBfc2VsZWN0ZWQobnVsbCwgbnVsbCwgdHJ1ZSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgICBpZiAodGhpcy5kb20ucXVlcnlTZWxlY3RvckFsbCgnaW5wdXRbbmFtZV49XCInICsgdGhpcy51dWlkICsgJ1wiXTpjaGVja2VkJykubGVuZ3RoID4gMCkge1xuICAgICAgc2VsZWN0YWN0aW9uLmNsYXNzTGlzdC5yZW1vdmUoY3NzLmhpZGUpO1xuICAgICAgcG9wdXBfc2VsZWN0ZWQobnVsbCwgbnVsbCk7XG4gICAgfVxuICB9XG4gIGFzeW5jIGluaXREZXRhaWxzKCkgeyAvLyBUT0RPIDogZ2VuZXJpY1xuICAgIC8vIGFib3V0IC0gb25lIGRpdiB0byBkaXNwbGF5IGNlbGwgZGV0YWlscyBtYWtlIGl0IGFwcGVhciBhcyB0YWJsZSByb3cgZXhwYW5kaW5nXG4gICAgY29uc3Qgd3JhcHBlciA9IHRoaXMud3JhcHBlcjtcbiAgICBjb25zdCBhYm91dCA9IHdyYXBwZXIucXVlcnlTZWxlY3RvcignIycgKyB0YWJsZWNzcy50aXBpbmxpbmUpID8gd3JhcHBlci5xdWVyeVNlbGVjdG9yKCcjJyArIHRhYmxlY3NzLnRpcGlubGluZSkgOiB0YWJsZWNzcy50aXBpbmxpbmU7XG4gICAgaWYgKCF0aGlzLnBsdWdpbnMuSnNEZXRhaWwpIHtcbiAgICAgIGNvbnN0IHtcbiAgICAgICAgSnNEZXRhaWxcbiAgICAgIH0gPSBhd2FpdFxuICAgICAgaW1wb3J0KCcuLi9tb2R1bGVzL2pzLWRldGFpbC5qcycpO1xuICAgICAgdGhpcy5wbHVnaW5zLkpzRGV0YWlsID0gSnNEZXRhaWw7XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLnBsdWdpbnMuSnNBY2NvcmRpb24pIHtcbiAgICAgIGNvbnN0IHtcbiAgICAgICAgSnNBY2NvcmRpb25cbiAgICAgIH0gPSBhd2FpdCBpbXBvcnQoJy4uL21vZHVsZXMvanMtYWNjb3JkaW9uLmpzJyk7XG4gICAgICB0aGlzLnBsdWdpbnMuSnNBY2NvcmRpb24gPSBKc0FjY29yZGlvbjtcbiAgICB9XG4gICAgY29uc3QganNEZXRhaWwgPSB0aGlzLnBsdWdpbnMuSnNEZXRhaWwoe1xuICAgICAgd2FpdGRpdjogdGhpcy53YWl0ZGl2XG4gICAgfSk7XG5cbiAgICBjb25zdCBkZXRhaWwgPSBqc0RldGFpbC5hcHBseVRvKGFib3V0LCB3cmFwcGVyKTsgLy8gc3BlY2lmaWMgdG8gYWJvdXQgZGV0YWlscyBpbiB0YWJsZVxuICAgIC8vIGhpZGUgLyBzaG93IGRpc2FibGUgZGV0YWlscyB6b25lXG4gICAgY29uc3QgY2FsbGJhY2tjbG9zZSA9IChlbCwgY2FsbGJhY2sgPSBudWxsKSA9PiB7XG4gICAgICBjb25zdCBjdXJyZW50ID0ganNEZXRhaWwuYWN0aXZlRGV0YWlsKGZhbHNlKTtcbiAgICAgIGlmIChjYWxsYmFjaykgY2FsbGJhY2soKTtcbiAgICB9XG5cbiAgICBjb25zdCBjYWxsYmFja29wZW4gPSAoZWwsIGNhbGxiYWNrID0gbnVsbCkgPT4ge1xuICAgICAgbGV0IGN1cnJlbnQgPSBqc0RldGFpbC5hY3RpdmVEZXRhaWwodHJ1ZSk7XG4gICAgICBpZiAoY3VycmVudCAmJiBjdXJyZW50ID09PSBlbCkge1xuICAgICAgICBjdXJyZW50ID0ganNEZXRhaWwuZXhwYW5kRGV0YWlsKGVsKTtcbiAgICAgICAgaWYgKGNhbGxiYWNrKSBjYWxsYmFjaygpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGN1cnJlbnQpIGN1cnJlbnQucXVlcnlTZWxlY3Rvcignc3VtbWFyeScpLmNsaWNrKCk7XG4gICAgICAgIGNvbnN0IHVybCA9IHRoaXMucGFyYW1zLmRldGFpbHN1cmwgKyBlbC5kYXRhc2V0LmlkICsgJz8nICtcbiAgICAgICAgICBuZXcgVVJMU2VhcmNoUGFyYW1zKHtcbiAgICAgICAgICAgIHBhcnRpYWw6IHRydWVcbiAgICAgICAgICB9KTtcbiAgICAgICAgY3VycmVudCA9IGpzRGV0YWlsLmFjdGl2ZURldGFpbCh0cnVlKTtcbiAgICAgICAgLy8gYXBwZW5kIHRvIGNlbGwgZGV0YWlscyBhbmQgZGlzcGxheVxuICAgICAgICBmZXRjaCh1cmwsIGZldGNoU2V0dGluZ3MoKSkudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS50ZXh0KCkpLnRoZW4oaHRtbCA9PiB7XG4gICAgICAgICAgY3VycmVudCA9IGpzRGV0YWlsLmV4cGFuZERldGFpbChlbCwgaHRtbCk7XG4gICAgICAgICAgaWYgKGNhbGxiYWNrKSBjYWxsYmFjaygpO1xuICAgICAgICB9KS5jYXRjaChlcnIgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdyZXF1ZXN0JywgZXJyKTtcbiAgICAgICAgfSlcbiAgICAgIH1cblxuICAgIH1cblxuICAgIGNvbnN0IHJlZnJlc2hfZGV0YWlscyA9ICgpID0+IHtcbiAgICAgIGNvbnN0IGRldGFpbHMgPSB0aGlzLmRvbS5xdWVyeVNlbGVjdG9yQWxsKHRhYmxlc2VsZWN0b3JzLmRldGFpbHMpO1xuICAgICAgaWYgKCFkZXRhaWxzKSByZXR1cm47XG4gICAgICAvKmRldGFpbHMuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgICAgaWYgKCFpdGVtLmRhdGFzZXQuaWQpIHJldHVybjtcbiAgICAgICAgaXRlbSA9bmV3IHRoaXMucGx1Z2lucy5Kc0FjY29yZGlvbihpdGVtLCBjYWxsYmFja29wZW4sIGNhbGxiYWNrY2xvc2UsIGRldGFpbCk7XG4gICAgICB9KTsqL1xuICAgICAgdGhpcy5wbHVnaW5zLkpzQWNjb3JkaW9uLmFwcGx5VG8oZGV0YWlscywgY2FsbGJhY2tvcGVuLCBjYWxsYmFja2Nsb3NlLCBkZXRhaWwpO1xuICAgIH1cbiAgICByZWZyZXNoX2RldGFpbHMoKTtcbiAgfVxuXG4gIGluaXRBbHRlcm5hdGVTb3J0KGNvbHMpIHtcblxuICAgIGxldCB0ZGNvbHMgPSBbXTtcbiAgICBjb2xzLmZvckVhY2goY29sID0+IHtcbiAgICAgIGNvbnN0IHRkY29sID0gY29sLmNsb3Nlc3QoJ3RoJyk7XG4gICAgICBPYmplY3QuZW50cmllcyhjb2wuZGF0YXNldCkuZm9yRWFjaCgoW2ssIHZdKSA9PiB7XG4gICAgICAgIHRkY29sLmRhdGFzZXRba10gPSB2O1xuICAgICAgICBjb2wuY2xhc3NMaXN0LmFkZCgnaW5saW5lLWJsb2NrJylcbiAgICAgIH0pO1xuICAgICAgdGRjb2xzLnB1c2godGRjb2wpO1xuICAgIH0pO1xuICAgIGNvbHMgPSB0ZGNvbHM7XG4gICAgLy8gZW5kIGZpeFxuXG4gICAgbGV0IGNvbHRvc29ydDtcbiAgICBjb25zdCBzb3J0YWx0ZXJuYXRlID0gKGNvbCkgPT4ge1xuICAgICAgbGV0IHRvZGlyO1xuICAgICAgLy8ga2VlcCB0aGUgc2FtZSBkaXIgaWYgc29ydCBvbiBjb2wgY2hhbmdlc1xuICAgICAgY29uc3QgYXNjID0gY29sLmNsYXNzTGlzdC5jb250YWlucyh0YWJsZWNzcy5hc2NlbmRpbmcpO1xuICAgICAgY29uc3QgZGVzYyA9IGNvbC5jbGFzc0xpc3QuY29udGFpbnModGFibGVjc3MuZGVzY2VuZGluZyk7XG4gICAgICBpZiAocGFyc2VJbnQoY29sLmRhdGFzZXQuc29ydGFjdGl2ZSkgPT09IHBhcnNlSW50KGNvbHRvc29ydCkpIHtcbiAgICAgICAgdG9kaXIgPSAoYXNjKSA/ICdkZXNjJyA6ICgoZGVzYykgPyAnYXNjJyA6ICdhc2MnKTtcbiAgICAgIH0gZWxzZSB0b2RpciA9IChhc2MpID8gJ2FzYycgOiAoZGVzYykgPyAnZGVzYycgOiAnYXNjJztcbiAgICAgIHRoaXMuc29ydENvbHVtbihjb2wsIGNvbHRvc29ydCwgdG9kaXIpO1xuICAgIH1cbiAgICBjb2xzLmZvckVhY2goY29sID0+IHtcbiAgICAgIGNvbnN0IGFsdHNvcnQgPSAoY29sLmRhdGFzZXQuYWx0c29ydCkgPyBjb2wuZGF0YXNldC5hbHRzb3J0LnNwbGl0KCcsJykgOiBudWxsO1xuICAgICAgaWYgKCFhbHRzb3J0KSByZXR1cm47XG4gICAgICBjb25zdCBjc3Nzb3J0ZXIgPSBjb2wucXVlcnlTZWxlY3Rvcih0YWJsZXNlbGVjdG9ycy5zb3J0ZXIpO1xuICAgICAgaWYgKGNzc3NvcnRlcikgY3Nzc29ydGVyLmNsYXNzTGlzdC5hZGQodGFibGVjc3MuZGlzYWJsZWQpO1xuICAgICAgY29uc3QgY29udHJvbCA9IGNvbC5xdWVyeVNlbGVjdG9yKHRhYmxlc2VsZWN0b3JzLnNvcnRvbik7XG4gICAgICAvLyBwcmV2ZW50cyBpbWJyaWNhdGVkIGxpbmtzXG4gICAgICBjb2wuYXBwZW5kKGNvbnRyb2wpO1xuICAgICAgY29uc3QgdHJpZ2dlcnMgPSBjb2wucXVlcnlTZWxlY3RvckFsbCgnW3JvbGU9XCJidXR0b25cIl0nKTtcblxuICAgICAgY29sLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBzb3J0YWx0ZXJuYXRlKGNvbCk7XG4gICAgICB9LCBmYWxzZSk7XG4gICAgICBjb25zdCBjaGFuZ2Vjb2x0b3NvcnQgPSAoY2wsIGluZGV4KSA9PiB7XG4gICAgICAgIGlmIChpbmRleCA9PT0gMCkgY29sdG9zb3J0ID0gdGhpcy5ncmlkLmNvbHVtbnMuZmluZEluZGV4KGNvbHVtbiA9PiAoY29sdW1uLmluZGV4ID09PSBjbC5jZWxsSW5kZXgpKTtcbiAgICAgICAgZWxzZSBjb2x0b3NvcnQgPSB0aGlzLmdyaWQuY29sdW1ucy5maW5kSW5kZXgoY29sdW1uID0+IChjb2x1bW4ubmFtZSA9PT0gYWx0c29ydFtpbmRleCAtIDFdKSk7XG4gICAgICB9XG4gICAgICBjb2wuZGF0YXNldC5zb3J0YWN0aXZlID0gY29sLmNlbGxJbmRleDtcbiAgICAgIHRyaWdnZXJzLmZvckVhY2goKHRyaWdnZXIsIGluZGV4KSA9PiB7XG4gICAgICAgIHRyaWdnZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICBjb25zdCBhY3RpdmUgPSBlLmN1cnJlbnRUYXJnZXQucGFyZW50RWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuJyArIGNzcy5hY3RpdmUpO1xuICAgICAgICAgIGlmIChhY3RpdmUpIGFjdGl2ZS5jbGFzc0xpc3QucmVtb3ZlKGNzcy5hY3RpdmUpO1xuICAgICAgICAgIGUuY3VycmVudFRhcmdldC5jbGFzc0xpc3QuYWRkKGNzcy5hY3RpdmUpO1xuICAgICAgICAgIGNoYW5nZWNvbHRvc29ydChjb2wsIGluZGV4KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIGlmIChjb2wuZGF0YXNldC50aXApIHtcblxuICAgICAgICBPYmplY3QudmFsdWVzKHRoaXMuZG9tLnJvd3MpLmZvckVhY2goKHJvdywgaW5kZXgpID0+IHtcbiAgICAgICAgICBpZiAoaW5kZXggPT09IDApIHJldHVybjtcbiAgICAgICAgICBjb25zdCBjb2x0aXAgPSB0aGlzLmdyaWQuY29sdW1ucy5maW5kSW5kZXgoY29sdW1uID0+IChjb2x1bW4ubmFtZSA9PT0gYWx0c29ydFtwYXJzZUludChjb2wuZGF0YXNldC50aXApIC0gMV0pKTtcblxuICAgICAgICAgIGlmIChyb3cuY2VsbHMubGVuZ3RoID09PSAwIHx8IGNvbHRpcCA9PT0gY29sLmNlbGxJbmRleCkgcmV0dXJuO1xuICAgICAgICAgIHJvdy5jZWxsc1tjb2wuY2VsbEluZGV4XS5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWVudGVyJywgKGUpID0+IHtcblxuICAgICAgICAgICAgY29uc3QgdGlwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICB0aXAuc2V0QXR0cmlidXRlKCdjbGFzcycsIHRhYmxlY3NzLnRpcG92ZXIpO1xuICAgICAgICAgICAgdGlwLmlubmVySFRNTCA9IHJvdy5jZWxsc1tjb2x0aXBdLmlubmVySFRNTDtcbiAgICAgICAgICAgIGUuY3VycmVudFRhcmdldC5hcHBlbmQodGlwKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByb3cuY2VsbHNbY29sLmNlbGxJbmRleF0uYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdXQnLCAoZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgdGlwID0gZS5jdXJyZW50VGFyZ2V0LnF1ZXJ5U2VsZWN0b3IodGFibGVzZWxlY3RvcnMudGlwb3Zlcik7XG4gICAgICAgICAgICBpZiAodGlwKSB0aXAucmVtb3ZlKCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgbWFrZUV4cGFuZGFibGUoY29udGFpbmVyKSB7XG4gICAgaWYgKGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCd0YWJsZScpLm9mZnNldEhlaWdodCA8IGNvbnRhaW5lci5vZmZzZXRIZWlnaHQpIHJldHVybjtcbiAgICBjb25zdCBidG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBidG4uY2xhc3NMaXN0LmFkZCh0YWJsZWNzcy5idXR0b25leHBhbmQpO1xuICAgIGJ0bi5jbGFzc0xpc3QuYWRkKHRhYmxlY3NzLmJvcmRlcnQpO1xuICAgIGJ0bi50aXRsZSA9IHRoaXMucGFyYW1zLmV4cGFuZDtcbiAgICBidG4uaW5uZXJIVE1MID0gYDxzcGFuIGNsYXNzPVwic21hbGwtY2FwcyBibG9jayBteC1hdXRvIHAtMFwiPiR7dGhpcy5wYXJhbXMuZXhwYW5kfTwvc3Bhbj48aSBjbGFzcz1cImNsZWFyLWJvdGggcC0wIG14LWF1dG8gaWNvbiBpY29uLWNoZXZyb24tZG93biBob3ZlcjpmaWxsLXNlY29uZGJsdWUtNTAwXCI+PC9pPjxzcGFuIGNsYXNzPVwic21hbGwtY2FwcyBibG9jayBteC1hdXRvIHAtMCBoaWRkZW5cIj4ke1xuICAgICAgICAgICAgICAgICAgdGhpcy5wYXJhbXMuc2hyaW5rfTwvc3Bhbj5gO1xuICAgIGNvbnRhaW5lci5wYXJlbnRFbGVtZW50Lmluc2VydEJlZm9yZShidG4sIGNvbnRhaW5lci5uZXh0RWxlbWVudFNpYmxpbmcpO1xuICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKHRhYmxlY3NzLm92ZXJmbG93eWhpZGRlbik7XG4gICAgY29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUodGFibGVjc3MubWF4dGFic3RhdGgpO1xuICAgIGNvbnRhaW5lci5wYXJlbnRFbGVtZW50LnN0eWxlLmhlaWdodCA9ICdhdXRvJztcbiAgICBjb25zdCBoID0gcGFyc2VJbnQodGhpcy53cmFwcGVyLnF1ZXJ5U2VsZWN0b3IoJ3Rib2R5IHRyJykub2Zmc2V0SGVpZ2h0KSAqICgodGhpcy5wYXJhbXMubWF4cm93cykgPyB0aGlzLnBhcmFtcy5tYXhyb3dzIDogMjApO1xuICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdtYXgtaC1bJyArIGggKyAncHhdJyk7XG4gICAgY29udGFpbmVyLnN0eWxlLmhlaWdodCA9IGggKyAncHgnO1xuICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICBjb25zdCBpc2hpZGRlbiA9IGNvbnRhaW5lci5jbGFzc0xpc3QuY29udGFpbnModGFibGVjc3Mub3ZlcmZsb3d5aGlkZGVuKTtcbiAgICAgIGNvbnN0IG1ha2VfZXhwYW5kID0gZGVib3VuY2UoKCkgPT4ge1xuICAgICAgICBidG4uY2xhc3NMaXN0LnRvZ2dsZSh0YWJsZWNzcy5ib3JkZXJ0KTtcbiAgICAgICAgYnRuLmNsYXNzTGlzdC50b2dnbGUodGFibGVjc3MuYm9yZGVyYik7XG4gICAgICAgIGNvbnN0IGljbyA9IGJ0bi5xdWVyeVNlbGVjdG9yKCdpJyk7XG4gICAgICAgIGljby5jbGFzc0xpc3QudG9nZ2xlKHRhYmxlY3NzLmljb2NoZXZyb25kb3duKTtcbiAgICAgICAgaWNvLmNsYXNzTGlzdC50b2dnbGUodGFibGVjc3MuaWNvbmNoZXZyb251cCk7XG4gICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKHRhYmxlY3NzLm92ZXJmbG93eWhpZGRlbik7XG4gICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdtYXgtaC1bJyArIGggKyAncHhdJyk7XG4gICAgICAgIGJ0bi5xdWVyeVNlbGVjdG9yQWxsKCdzcGFuJykuZm9yRWFjaChzcGFuID0+IHtcbiAgICAgICAgICBzcGFuLmNsYXNzTGlzdC50b2dnbGUodGFibGVjc3MuaGlkZGVuKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChpc2hpZGRlbikgY29udGFpbmVyLnN0eWxlLmhlaWdodCA9IGggKyAncHgnO1xuICAgICAgICBlbHNlIGNvbnRhaW5lci5zdHlsZS5oZWlnaHQgPSAnYXV0byc7XG4gICAgICB9LCAxMDApO1xuICAgICAgbWFrZV9leHBhbmQoKTtcbiAgICB9KTtcbiAgfVxuICBtYWtlRXhwb3J0YWJsZShjb250YWluZXIpIHtcbiAgICBjb25zdCBidG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBidG4uY2xhc3NMaXN0LmFkZCh0YWJsZXNlbGVjdG9ycy5leHBvcnQuc2xpY2UoMSkpO1xuICAgIGJ0bi5jbGFzc0xpc3QuYWRkKCdpcy1waWNrJyk7XG4gICAgYnRuLmlubmVySFRNTCA9IGA8aSBjbGFzcz1cImljb24gaWNvbi1hcnJvdy1kb3duLW9uLXNxdWFyZVwiPjwvaT48c3Bhbj4keygodGhpcy5wYXJhbXMuZXhwb3J0bGFiZWwpID8gdGhpcy5wYXJhbXMuZXhwb3J0bGFiZWwgOiAnZXhwb3J0IHN0YXRpc3RpY3MgJyl9PC9zcGFuPmA7XG4gICAgdGhpcy53cmFwcGVyLnByZXBlbmQoYnRuKTtcbiAgICBjb25zdCBjb2x1bW5zID0gdGhpcy5ncmlkLmNvbHVtbnM7XG4gICAgbGV0IGV4Y2x1ZGVfY29sdW1ucyA9IFtdO1xuICAgIHRoaXMuZ3JpZC5jb2x1bW5zLmZvckVhY2goKGNvbHVtbiwgaW5kZXgpID0+IHtcbiAgICAgIGlmIChjb2x1bW4ubmFtZSA9PT0gJ3NlbGVjdCcpIGV4Y2x1ZGVfY29sdW1ucy5wdXNoKGNvbHVtbi5pbmRleCk7XG4gICAgfSk7XG4gICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKGUpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGlmICghdGhpcy5wbHVnaW5zLmV4cG9ydENTVikge1xuICAgICAgICBjb25zdCB7XG4gICAgICAgICAgZXhwb3J0Q1NWIC8vIG9yIGV4cG9ydEpTT04sIGV4cG9ydFNRTFxuICAgICAgICB9ID0gYXdhaXRcbiAgICAgICAgaW1wb3J0KFwiLi4vbW9kdWxlcy9leHBvcnQtY3N2LmpzXCIpO1xuXG4gICAgICAgIHRoaXMucGx1Z2lucy5leHBvcnRDU1YgPSBleHBvcnRDU1Y7XG4gICAgICB9XG4gICAgICBsZXQgc3RyID0gdGhpcy5wbHVnaW5zLmV4cG9ydENTVih0aGlzLCB7XG4gICAgICAgIGRvd25sb2FkOiBmYWxzZSxcbiAgICAgICAgbGluZWRlbGltaXRlcjogXCJcXG5cIixcbiAgICAgICAgY29sdW1uZGVsaW1pdGVyOiBcIlxcdFwiLFxuICAgICAgICBza2lwY29sdW1uczogZXhjbHVkZV9jb2x1bW5zXG4gICAgICB9KTtcbiAgICAgIHN0ciA9IGVuY29kZVVSSShgZGF0YTp0ZXh0L3RzdjtjaGFyc2V0PXV0Zi04LCR7c3RyfWApO1xuXG4gICAgICBkb3dubG9hZF91cmwoc3RyLCAoKGNvbnRhaW5lci5pZCkgPyBjb250YWluZXIuaWQgOiAnc3RhdHNfcHJvaicpICsgJy50c3YnKTtcblxuICAgIH0pO1xuICB9XG4gIGluaXRUaXBzKCkge1xuICAgIC8vIHNob3cgYmlnIGNlbGwgY29udGVudFxuICAgIGxldCBjdXJyZW50ID0gbnVsbDtcbiAgICB0aGlzLmRvbS5xdWVyeVNlbGVjdG9yQWxsKHRhYmxlc2VsZWN0b3JzLnRpcCkuZm9yRWFjaCh0aXAgPT4ge1xuICAgICAgdGlwLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuICAgICAgICBjb25zdCBwYXJlbnQgPSBlLnRhcmdldC5wYXJlbnRFbGVtZW50O1xuICAgICAgICBpZiAoY3VycmVudCAhPT0gbnVsbCkgY3VycmVudC5jbGFzc0xpc3QucmVtb3ZlKHRhYmxlY3NzLnNob3dmdWxsKTtcbiAgICAgICAgaWYgKGN1cnJlbnQgIT09IHBhcmVudCkge1xuICAgICAgICAgIHBhcmVudC5jbGFzc0xpc3QuYWRkKHRhYmxlY3NzLnNob3dmdWxsKTtcbiAgICAgICAgICBjdXJyZW50ID0gcGFyZW50O1xuICAgICAgICB9IGVsc2UgY3VycmVudCA9IG51bGw7XG5cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG4gIHRvZ2dsZUFkZE9ucyhsaXN0ID0gbnVsbCwgb24gPSBmYWxzZSkge1xuICAgIGxpc3QgPSAobGlzdCkgPyBsaXN0IDogW3RhYmxlc2VsZWN0b3JzLnNlYXJjaCArICcgaW5wdXQnLCB0YWJsZXNlbGVjdG9ycy5leHBvcnRdO1xuICAgIGNvbnN0IGFkZG9ucyA9IFtdO1xuICAgIGxldCBhZGRvbjtcbiAgICBsaXN0LmZvckVhY2goYWRkb24gPT4ge1xuICAgICAgYWRkb24gPSB0aGlzLndyYXBwZXIucXVlcnlTZWxlY3RvcihhZGRvbik7XG4gICAgICBpZiAoYWRkb24pIHtcbiAgICAgICAgaWYgKG9uKSBhZGRvbi5jbGFzc0xpc3QucmVtb3ZlKGNzcy5oaWRlKTtcbiAgICAgICAgZWxzZSBhZGRvbi5jbGFzc0xpc3QuYWRkKGNzcy5oaWRlKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG59Il0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/modules/table-component.js\n")},"./src/modules/text-highlight.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   TextHighlight: () => (/* binding */ TextHighlight)\n/* harmony export */ });\nfunction textHighlight() {\n  const highlight = (CSS.highlights) ? new Highlight() : null;\n\n  function applyTo(item, start, end) {\n    if (highlight) {\n      const textnode = item.textNode;\n      const range = new Range();\n      range.setStart(textnode, start);\n      range.setEnd(textnode, end);\n      highlight.add(range);\n    }\n  }\n  return {\n    applyTo\n  }\n}\nconst TextHighlight = textHighlight();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvbW9kdWxlcy90ZXh0LWhpZ2hsaWdodC5qcyIsIm1hcHBpbmdzIjoiOzs7O0FBQUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vc3JjL21vZHVsZXMvdGV4dC1oaWdobGlnaHQuanM/OGZhOCJdLCJzb3VyY2VzQ29udGVudCI6WyJmdW5jdGlvbiB0ZXh0SGlnaGxpZ2h0KCkge1xuICBjb25zdCBoaWdobGlnaHQgPSAoQ1NTLmhpZ2hsaWdodHMpID8gbmV3IEhpZ2hsaWdodCgpIDogbnVsbDtcblxuICBmdW5jdGlvbiBhcHBseVRvKGl0ZW0sIHN0YXJ0LCBlbmQpIHtcbiAgICBpZiAoaGlnaGxpZ2h0KSB7XG4gICAgICBjb25zdCB0ZXh0bm9kZSA9IGl0ZW0udGV4dE5vZGU7XG4gICAgICBjb25zdCByYW5nZSA9IG5ldyBSYW5nZSgpO1xuICAgICAgcmFuZ2Uuc2V0U3RhcnQodGV4dG5vZGUsIHN0YXJ0KTtcbiAgICAgIHJhbmdlLnNldEVuZCh0ZXh0bm9kZSwgZW5kKTtcbiAgICAgIGhpZ2hsaWdodC5hZGQocmFuZ2UpO1xuICAgIH1cbiAgfVxuICByZXR1cm4ge1xuICAgIGFwcGx5VG9cbiAgfVxufVxuY29uc3QgVGV4dEhpZ2hsaWdodCA9IHRleHRIaWdobGlnaHQoKTtcbmV4cG9ydCB7XG4gIFRleHRIaWdobGlnaHRcbn07Il0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/modules/text-highlight.js\n")},"?4f7e":()=>{}}]);