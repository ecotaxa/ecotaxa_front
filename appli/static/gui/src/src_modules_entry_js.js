/*! For license information please see src_modules_entry_js.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["src_modules_entry_js"],{"./src/modules/entry.js":(module,__webpack_exports__,__webpack_require__)=>{eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Entry: () => (/* binding */ Entry),\n/* harmony export */   EntryControls: () => (/* binding */ EntryControls),\n/* harmony export */   entryOptions: () => (/* binding */ entryOptions),\n/* harmony export */   entryTypes: () => (/* binding */ entryTypes)\n/* harmony export */ });\n/* harmony import */ var _modules_utils_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../modules/utils.js */ \"./src/modules/utils.js\");\n/* harmony import */ var _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../modules/modules-config.js */ \"./src/modules/modules-config.js\");\n/* harmony import */ var _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../modules/alert-box.js */ \"./src/modules/alert-box.js\");\n/* harmony import */ var _modules_module_event_emitter_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../modules/module-event-emitter.js */ \"./src/modules/module-event-emitter.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_modules_alert_box_js__WEBPACK_IMPORTED_MODULE_2__, _modules_module_event_emitter_js__WEBPACK_IMPORTED_MODULE_3__]);\n([_modules_alert_box_js__WEBPACK_IMPORTED_MODULE_2__, _modules_module_event_emitter_js__WEBPACK_IMPORTED_MODULE_3__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\nconst entryTypes = Object.freeze({\n  node: \"N\",\n  branch: \"B\",\n  root: \"R\",\n  discard: \"D\",\n  discarded: \"X\"\n});\nconst entryOptions = {\n  selector: '[data-name]',\n  tags: {\n    tag: 'ul',\n    subtag: 'li',\n    label: 'span'\n  },\n  selectors: {\n    entries: '.entries'\n  },\n  draggables: [],\n  prefix: `entry`,\n  css: {\n    on: 'on',\n    entryN: 'entryN',\n    entryB: 'entryB',\n    entryR: 'entryR',\n    entryD: 'entryD',\n    editable: 'editable',\n    dragging: 'dragging',\n    dragover: 'dragover',\n    dragitem: 'dragitem',\n    selected: 'selected',\n  },\n  event: {\n    name: 'eventEntry'\n  }\n};\n\nclass Entry {\n  eventnames = {\n    attach: 'attach',\n    control: 'control'\n  };\n  name;\n  type;\n  label;\n  entries = [];\n  event = {\n    listener: window,\n    name: entryOptions.event.name,\n    init: {\n      bubbles: false,\n      cancelable: true\n    },\n  };\n\n\n  constructor(entry, options = {}) {\n    this.name = entry.name;\n    this.type = entry.type;\n    this.id = entry.id;\n    this.parent = entry.parent;\n    this.options = { ...entryOptions,\n      ...options\n    };\n    this.uuid = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.generate_uuid)();\n\n    this.eventnames = { ...this.eventnames,\n      ...this.options.eventnames\n    };\n    this.label = (options.label) ? options.label : null;\n    this.event = {\n      name: entryOptions.event.name,\n      listener: (options.listener) ? options.listener : this.uuid\n    };\n    this.init(entry);\n    return this;\n  }\n  init(entry) {\n    const dataset = {\n      name: this.name,\n      type: this.type\n    }\n    if (this.label !== null) dataset.label = this.label;\n    const el = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)(this.options.tags.subtag, {\n      draggable: this.isDraggable(),\n      dataset: dataset,\n    });\n    const cl = `${this.options.prefix}${this.type}`;\n    this.label = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)(this.options.tags.label, {\n      class: cl,\n      text: (entry.label) ? entry.label : entry.name\n    }, el);\n    this.container = el;\n    this.initEvents();\n  }\n  initEvents() {}\n  getParent() {\n    return this.parent;\n  }\n  getLabelElement() {\n    return this.label;\n  }\n  getParentElement() {\n    return this.container.parentElement.closest(this.options.selector);\n  }\n\n  getEntries() {\n    return this.entries;\n  }\n  getEntriesElement(create = false) {\n    let entries = this.container.querySelector(this.options.selectors.entries);\n    if (create && entries === null) {\n      return (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)(this.options.tags.tag, {\n        class: this.options.selectors.entries.substr(1)\n      }, this.container);\n    }\n    return entries;\n  }\n\n  appendEntry(entry) {\n    if (entry.parent && entry.parent.entries) {\n      const n = entry.parent.entries.indexOf(entry);\n      delete entry.parent.entries[n];\n    }\n    entry.parent = this;\n    this.entries.push(entry);\n    const parent = this.getEntriesElement(true);\n    parent.append(entry.container);\n    return entry;\n  }\n  /* when extended */\n  newEntry(entry) {\n    return new Entry(entry, this.options);\n  }\n  /** extra attr , styles , types  */\n  setAttributes(entry) {\n    return entry;\n  }\n  extraStyles(entry) {}\n  setDiscard() {}\n  /*end extra attr , styles , types  */\n  createEntry(entry) {\n    this.options.css.icons = [];\n    entry = this.setAttributes(entry);\n    this.extraStyles(entry);\n    const new_entry = this.newEntry(entry, this.options);\n    this.appendEntry(new_entry);\n    new_entry.addListeners();\n    new_entry.setDiscard();\n    return new_entry;\n  }\n  findEntry(name) {\n    const entries = this.getEntries();\n    for (const entry of entries) {\n      if (entry.name === name) return entry;\n    }\n    return null;\n  }\n  //\n  createListEntries(listentries) {\n    const direntry = this.getEntriesElement(true);\n    listentries.forEach(entries => {\n      entries.forEach((entry) => {\n        const new_entry = this.createEntry(entry);\n      });\n    });\n  }\n  removeEntries() {\n    this.entries = [];\n    const el = this.getEntriesElement();\n    if (el) el.remove();\n  }\n  isActive() {\n    return this.active;\n  }\n\n  toggleActive() {\n    this.active = !(this.active);\n    this.container.classList.toggle(this.options.css.on);\n  }\n  setSelected(selected = true) {\n    const cl = this.options.css.selected;\n    if (selected === true) this.container.classList.add(cl);\n    else this.container.classList.remove(cl);\n    this.setOn(selected);\n  }\n  setOn(on = true) {\n    this.active = on;\n    if (on === true) this.container.classList.add(this.options.css.on);\n    else this.container.classList.remove(this.options.css.on);\n  }\n  setOff() {\n    this.setSelected(false);\n  }\n  getListeners() {\n    let listeners = [];\n    const self = this;\n    let func = (e) => {\n      e.stopImmediatePropagation();\n      this.branchListener(() => {\n        this.emitEvent(this.eventnames.attach);\n      });\n    };\n    if ([entryTypes.root, entryTypes.discard].indexOf(this.type) < 0) {\n      if (this.type === entryTypes.node) {\n        func = (e) => {\n          e.stopImmediatePropagation();\n          this.toggleActive();\n          this.emitEvent();\n        }\n      }\n    }\n    listeners.unshift({\n      name: 'click',\n      target: 'label',\n      func: func\n    });\n    return listeners;\n  }\n\n  isBranch(checkroot = true) {\n    const branchtypes = [entryTypes.branch];\n    if (checkroot && branchtypes.indexOf(entryTypes.root) < 0) branchtypes.push(entryTypes.root);\n    return (branchtypes.indexOf(this.type) >= 0)\n  }\n  isDiscarded() {\n    return ([entryTypes.discard, entryTypes.discarded].indexOf(this.type) >= 0)\n  }\n  emitEvent(action = null, ev = null) {\n    const self = this;\n    const detail = {\n      entry: self,\n    }\n    if (action) detail.action = action;\n    if (ev) detail.event = ev;\n    else ev = this.eventnames.control;\n    _modules_module_event_emitter_js__WEBPACK_IMPORTED_MODULE_3__.ModuleEventEmitter.emit(this.event.name, detail, this.event.listener);\n  }\n  moveHandlers() {\n    return [{\n      name: 'dragstart',\n      func: (e) => {\n        this.handleDragStart(e);\n      }\n    }, {\n      name: 'dragend',\n      func: (e) => {\n        this.handleDragEnd(e);\n      }\n    }];\n  }\n  dropHandlers() {\n    return [{\n      name: 'dragover',\n      func: (e) => {\n        this.handleDragOver(e);\n      }\n    }, {\n      name: 'drop',\n      func: (e) => {\n        this.handleDrop(e);\n      }\n    }];\n  }\n  branchListener(callback = null) {\n    this.toggleActive();\n    if (this.isActive()) this.branchActivate(callback).then(() => {\n      this.emitEvent();\n    });\n  }\n  addListeners() {\n    const listeners = this.getListeners();\n    for (const listener of listeners) {\n      const el = (listener.target === 'label') ? this.getLabelElement() : this.container;\n      el.addEventListener(listener.name, listener.func);\n    }\n  }\n  removeListeners(listeners) {\n    for (const listener in listeners) {\n      const el = (listener.target === 'label') ? this.getLabelElement() : this.container;\n      el.removeEventListener(listener.label, listener.func);\n    }\n  }\n  destroy() {\n    this.container.remove();\n  }\n\n  handleDragStart(e) {\n    e.stopImmediatePropagation();\n    this.container.classList.add(this.options.css.dragging);\n    e.dataTransfer.effectAllowed = 'move';\n    this.emitEvent('dragstart', e);\n  }\n  handleDragOver(e) {\n    e.stopPropagation();\n    e.preventDefault();\n    this.emitEvent('dragover', e);\n    return;\n  }\n  handleDragEnd(e) {\n    e.stopPropagation();\n    e.preventDefault();\n    this.container.classList.remove(this.options.css.dragging);\n    this.emitEvent('dragend', e);\n  }\n  resetDragOver() {\n    document.querySelectorAll('.' + this.options.css.dragover).forEach(el => {\n      el.classList.remove(this.options.css.dragover);\n    });\n  }\n  handleDrop(e) {\n    /***/\n    e.stopImmediatePropagation();\n    this.emitEvent('drop', e);\n  }\n  setWait() {\n    this.loaded = this.container.dataset.loaded = false;\n    this.container.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.wait);\n  }\n  setLoaded() {\n    this.container.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.wait);\n    this.loaded = this.container.dataset.loaded = true;\n  }\n  findEntry(name, type) {\n    const entries = this.getEntries();\n    for (const entry of entries) {\n      if (entry.name === name && entry.type === type) return entry;\n    }\n    return null;\n  }\n\n  async branchActivate(callback = null) {\n    if (!this.loaded) this.list().then(() => {\n      if (callback) callback(this);\n    });\n    else if (callback) callback(this);\n  }\n  getCurrentPath() {\n    const current_path = (entry, branchs = []) => {\n      if (entry.name) {\n        branchs.push(entry.name);\n        entry = entry.getParent();\n        if (entry !== null) return current_path(entry, branchs);\n      }\n      return branchs;\n    }\n    let branchs = current_path(this);\n    if (branchs.length > 1) branchs = branchs.reverse();\n    return branchs;\n  }\n  async jsonEntries(response) {\n    const json = await response.json();\n    return json;\n  }\n  isDraggable() {\n    return (this.options.draggables && this.options.draggables.indexOf(this.type) >= 0);\n  }\n  async list() {\n    if (this.type === entryTypes.node) return;\n\n    const url = (this.getUrl) ? this.getUrl() : null;\n    if (url === null) return;\n    const tag = this.options.tags.tag;\n    const subtag = this.options.tags.subtag;\n    this.setWait();\n    this.removeEntries();\n    const fetchoptions = {\n      headers: new Headers({\n        'content-type': 'application/json'\n      })\n    };\n    const response = await fetch(url, (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.fetchSettings)(fetchoptions));\n    if (response.ok) {\n      const entries = await this.jsonEntries(response);\n\n      if (entries.length) {\n        let nodes = [],\n          branches = [];\n        while (entries.length > 0) {\n          const entry = entries.shift();\n          if (entry.children === false) {\n            nodes.push(entry);\n          } else {\n            branches.push(entry);\n          }\n        };\n        nodes.sort((a, b) => (a.name < b.name));\n        branches.sort((a, b) => (a.name < b.name));\n        this.createListEntries([branches, nodes]);\n      }\n      this.setLoaded();\n    } else {\n      _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_2__.AlertBox.addMessage({\n        parent: this.container,\n        type: \"error\",\n        content: response.error + ' ' + response.text\n      })\n    }\n\n  }\n  moveTo(dest) {\n    const branches = dest.getCurrentPath();\n    const type = (dest.type === entryTypes.discard) ? entryTypes.discarded : dest.type;\n    branches.pop();\n    branches.forEach((branch, index) => {\n      let subdest = dest.findEntry(branch, type);\n      if (subdest === null) {\n        subdest = dest.createEntry({\n          type: type,\n          name: branch\n        });\n      }\n      dest = subdest;\n    });\n    if (dest.findEntry(this.name, this.type) === null) {\n      this.from = this.parent;\n      dest.appendEntry(this);\n    }\n  }\n  unMove() {\n    if (this.from) {\n      this.moveTo(this.from);\n      this.from = null;\n    }\n  }\n}\nfunction EntryControls(container = document, options = {}) {\n  const eventnames = {\n    control: 'control',\n    error: 'error',\n  }\n  const controloptions = {\n    selectors: {\n      typentries: '[data-typentries]',\n      hascontrols: '.has-controls',\n    },\n    controls: {\n      list: {\n        action: 'list',\n        typentries: ['B', 'T']\n      },\n    },\n    css: {\n      entrycontrols: 'entrycontrols',\n      entries: '.entries',\n    }\n  };\n  let box, activentry = null;\n  options = Object.assign(controloptions, options);\n  init();\n\n  function init() {\n    createControls();\n    initEvents();\n  }\n\n  function addControl(control, position = null, action = null) {\n    const ctrl = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)('span', {});\n    const l = box.children.length;\n    if (position === null || l < position + 1) box.append(ctrl);\n    else if (position === 0 || l === 0) box.prepend(ctrl);\n    else box.inserBefore(crtl, box.children[position]);\n    if (control.typentries) ctrl.dataset.typentries = control.typentries;\n    if (control.icon) {\n      const icon = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)('i', {\n        class: ['icon', control.icon]\n      }, ctrl);\n      ctrl.dataset.title = control.text;\n    } else ctrl.textContent = control.text;\n    //add listener\n    const evt = (control.trigger) ? control.trigger : 'click';\n    const func = (e) => {\n      if (activentry === null) return;\n      const detail = {\n        callback: () => {\n          console.log('done', control.action);\n        }\n      }\n\n      if (!activentry[control.action] && action !== null) {\n        action(activentry);\n      } else if (activentry[control.action]) activentry[control.action](detail);\n      if (control.callback) control.callback(e);\n    };\n    ctrl.addEventListener(evt, func);\n    //\n    control.ctrl = ctrl;\n  }\n\n  function createControls() {\n    box = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)('div', {\n      class: [options.css.entrycontrols, _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide]\n    });\n    Object.values(options.controls).filter(control => (control.icon || control.text)).forEach(control => {\n      addControl(control);\n    });\n  }\n\n  function initEvents() {}\n\n  function detachControls() {\n    if (activentry === null) return;\n    activentry.container.classList.remove(options.selectors.hascontrols.substr(1));\n    box.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n    box.disabled = true;\n    container.append(box);\n    activentry = null;\n  }\n\n  function attachControls(entry) {\n    detachControls();\n    activentry = entry;\n    activentry.container.prepend(box);\n    activentry.container.classList.add(options.selectors.hascontrols.substr(1));\n    activateControls();\n    box.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n    delete box.disabled;\n  }\n\n  function showControls(show = true) {\n    if (show === true) box.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n    else box.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n    box.disabled = !show;\n  }\n\n  function activateControl(control, isdiscarded = false) {\n    const ctrl = control.ctrl;\n    const typentries = (ctrl.dataset.typentries) ? ctrl.dataset.typentries.split(',') : [];\n    const type = (isdiscarded) ? entryTypes.discarded : activentry.container.dataset.type;\n    if (typentries.indexOf(type) >= 0) {\n      ctrl.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n    } else ctrl.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n  }\n\n  function activateControls() {\n    if (activentry === null) return;\n    // add btns\n    const isdiscarded = activentry.isDiscarded();\n    Object.values(options.controls).filter(control => (control.icon || control.text)).forEach(control => {\n      activateControl(control, isdiscarded);\n    });\n    //\n  }\n  return {\n    options,\n    addControl,\n    attachControls,\n    detachControls,\n    showControls,\n    activateControls,\n    activateControl\n  }\n}\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvbW9kdWxlcy9lbnRyeS5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQU8yQjtBQUdXO0FBR0w7QUFHVztBQUNyQztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ007QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7O0FBRU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMOzs7QUFHQSxpQ0FBaUM7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBLGdCQUFnQixnRUFBYTs7QUFFN0Isd0JBQXdCO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZSw2REFBVTtBQUN6QjtBQUNBO0FBQ0EsS0FBSztBQUNMLGtCQUFrQixvQkFBb0IsRUFBRSxVQUFVO0FBQ2xELGlCQUFpQiw2REFBVTtBQUMzQjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsNkRBQVU7QUFDdkI7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUksZ0ZBQWtCO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQywyREFBRztBQUNwQztBQUNBO0FBQ0Esb0NBQW9DLDJEQUFHO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBLHNDQUFzQyxnRUFBYTtBQUNuRDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ04sTUFBTSwyREFBUTtBQUNkO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ08seURBQXlEO0FBQ2hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxpQkFBaUIsNkRBQVUsV0FBVztBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUIsNkRBQVU7QUFDN0I7QUFDQSxPQUFPO0FBQ1A7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsVUFBVSw2REFBVTtBQUNwQix5Q0FBeUMsMkRBQUc7QUFDNUMsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCLDJEQUFHO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QiwyREFBRztBQUM1QjtBQUNBOztBQUVBO0FBQ0EsNENBQTRDLDJEQUFHO0FBQy9DLDJCQUEyQiwyREFBRztBQUM5QjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsMkRBQUc7QUFDL0IsTUFBTSx3QkFBd0IsMkRBQUc7QUFDakM7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vc3JjL21vZHVsZXMvZW50cnkuanM/MmRiOSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBjcmVhdGVfYm94LFxuICBkaXJzZXBhcmF0b3IsXG4gIHVybHNlcGFyYXRvcixcbiAgZmV0Y2hTZXR0aW5ncyxcbiAgZ2VuZXJhdGVfdXVpZFxufVxuZnJvbSAnLi4vbW9kdWxlcy91dGlscy5qcyc7XG5pbXBvcnQge1xuICBjc3Ncbn0gZnJvbSAnLi4vbW9kdWxlcy9tb2R1bGVzLWNvbmZpZy5qcyc7XG5pbXBvcnQge1xuICBBbGVydEJveFxufSBmcm9tICcuLi9tb2R1bGVzL2FsZXJ0LWJveC5qcyc7XG5pbXBvcnQge1xuICBNb2R1bGVFdmVudEVtaXR0ZXJcbn0gZnJvbSAnLi4vbW9kdWxlcy9tb2R1bGUtZXZlbnQtZW1pdHRlci5qcyc7XG5leHBvcnQgY29uc3QgZW50cnlUeXBlcyA9IE9iamVjdC5mcmVlemUoe1xuICBub2RlOiBcIk5cIixcbiAgYnJhbmNoOiBcIkJcIixcbiAgcm9vdDogXCJSXCIsXG4gIGRpc2NhcmQ6IFwiRFwiLFxuICBkaXNjYXJkZWQ6IFwiWFwiXG59KTtcbmV4cG9ydCBjb25zdCBlbnRyeU9wdGlvbnMgPSB7XG4gIHNlbGVjdG9yOiAnW2RhdGEtbmFtZV0nLFxuICB0YWdzOiB7XG4gICAgdGFnOiAndWwnLFxuICAgIHN1YnRhZzogJ2xpJyxcbiAgICBsYWJlbDogJ3NwYW4nXG4gIH0sXG4gIHNlbGVjdG9yczoge1xuICAgIGVudHJpZXM6ICcuZW50cmllcydcbiAgfSxcbiAgZHJhZ2dhYmxlczogW10sXG4gIHByZWZpeDogYGVudHJ5YCxcbiAgY3NzOiB7XG4gICAgb246ICdvbicsXG4gICAgZW50cnlOOiAnZW50cnlOJyxcbiAgICBlbnRyeUI6ICdlbnRyeUInLFxuICAgIGVudHJ5UjogJ2VudHJ5UicsXG4gICAgZW50cnlEOiAnZW50cnlEJyxcbiAgICBlZGl0YWJsZTogJ2VkaXRhYmxlJyxcbiAgICBkcmFnZ2luZzogJ2RyYWdnaW5nJyxcbiAgICBkcmFnb3ZlcjogJ2RyYWdvdmVyJyxcbiAgICBkcmFnaXRlbTogJ2RyYWdpdGVtJyxcbiAgICBzZWxlY3RlZDogJ3NlbGVjdGVkJyxcbiAgfSxcbiAgZXZlbnQ6IHtcbiAgICBuYW1lOiAnZXZlbnRFbnRyeSdcbiAgfVxufTtcblxuZXhwb3J0IGNsYXNzIEVudHJ5IHtcbiAgZXZlbnRuYW1lcyA9IHtcbiAgICBhdHRhY2g6ICdhdHRhY2gnLFxuICAgIGNvbnRyb2w6ICdjb250cm9sJ1xuICB9O1xuICBuYW1lO1xuICB0eXBlO1xuICBsYWJlbDtcbiAgZW50cmllcyA9IFtdO1xuICBldmVudCA9IHtcbiAgICBsaXN0ZW5lcjogd2luZG93LFxuICAgIG5hbWU6IGVudHJ5T3B0aW9ucy5ldmVudC5uYW1lLFxuICAgIGluaXQ6IHtcbiAgICAgIGJ1YmJsZXM6IGZhbHNlLFxuICAgICAgY2FuY2VsYWJsZTogdHJ1ZVxuICAgIH0sXG4gIH07XG5cblxuICBjb25zdHJ1Y3RvcihlbnRyeSwgb3B0aW9ucyA9IHt9KSB7XG4gICAgdGhpcy5uYW1lID0gZW50cnkubmFtZTtcbiAgICB0aGlzLnR5cGUgPSBlbnRyeS50eXBlO1xuICAgIHRoaXMuaWQgPSBlbnRyeS5pZDtcbiAgICB0aGlzLnBhcmVudCA9IGVudHJ5LnBhcmVudDtcbiAgICB0aGlzLm9wdGlvbnMgPSB7IC4uLmVudHJ5T3B0aW9ucyxcbiAgICAgIC4uLm9wdGlvbnNcbiAgICB9O1xuICAgIHRoaXMudXVpZCA9IGdlbmVyYXRlX3V1aWQoKTtcblxuICAgIHRoaXMuZXZlbnRuYW1lcyA9IHsgLi4udGhpcy5ldmVudG5hbWVzLFxuICAgICAgLi4udGhpcy5vcHRpb25zLmV2ZW50bmFtZXNcbiAgICB9O1xuICAgIHRoaXMubGFiZWwgPSAob3B0aW9ucy5sYWJlbCkgPyBvcHRpb25zLmxhYmVsIDogbnVsbDtcbiAgICB0aGlzLmV2ZW50ID0ge1xuICAgICAgbmFtZTogZW50cnlPcHRpb25zLmV2ZW50Lm5hbWUsXG4gICAgICBsaXN0ZW5lcjogKG9wdGlvbnMubGlzdGVuZXIpID8gb3B0aW9ucy5saXN0ZW5lciA6IHRoaXMudXVpZFxuICAgIH07XG4gICAgdGhpcy5pbml0KGVudHJ5KTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICBpbml0KGVudHJ5KSB7XG4gICAgY29uc3QgZGF0YXNldCA9IHtcbiAgICAgIG5hbWU6IHRoaXMubmFtZSxcbiAgICAgIHR5cGU6IHRoaXMudHlwZVxuICAgIH1cbiAgICBpZiAodGhpcy5sYWJlbCAhPT0gbnVsbCkgZGF0YXNldC5sYWJlbCA9IHRoaXMubGFiZWw7XG4gICAgY29uc3QgZWwgPSBjcmVhdGVfYm94KHRoaXMub3B0aW9ucy50YWdzLnN1YnRhZywge1xuICAgICAgZHJhZ2dhYmxlOiB0aGlzLmlzRHJhZ2dhYmxlKCksXG4gICAgICBkYXRhc2V0OiBkYXRhc2V0LFxuICAgIH0pO1xuICAgIGNvbnN0IGNsID0gYCR7dGhpcy5vcHRpb25zLnByZWZpeH0ke3RoaXMudHlwZX1gO1xuICAgIHRoaXMubGFiZWwgPSBjcmVhdGVfYm94KHRoaXMub3B0aW9ucy50YWdzLmxhYmVsLCB7XG4gICAgICBjbGFzczogY2wsXG4gICAgICB0ZXh0OiAoZW50cnkubGFiZWwpID8gZW50cnkubGFiZWwgOiBlbnRyeS5uYW1lXG4gICAgfSwgZWwpO1xuICAgIHRoaXMuY29udGFpbmVyID0gZWw7XG4gICAgdGhpcy5pbml0RXZlbnRzKCk7XG4gIH1cbiAgaW5pdEV2ZW50cygpIHt9XG4gIGdldFBhcmVudCgpIHtcbiAgICByZXR1cm4gdGhpcy5wYXJlbnQ7XG4gIH1cbiAgZ2V0TGFiZWxFbGVtZW50KCkge1xuICAgIHJldHVybiB0aGlzLmxhYmVsO1xuICB9XG4gIGdldFBhcmVudEVsZW1lbnQoKSB7XG4gICAgcmV0dXJuIHRoaXMuY29udGFpbmVyLnBhcmVudEVsZW1lbnQuY2xvc2VzdCh0aGlzLm9wdGlvbnMuc2VsZWN0b3IpO1xuICB9XG5cbiAgZ2V0RW50cmllcygpIHtcbiAgICByZXR1cm4gdGhpcy5lbnRyaWVzO1xuICB9XG4gIGdldEVudHJpZXNFbGVtZW50KGNyZWF0ZSA9IGZhbHNlKSB7XG4gICAgbGV0IGVudHJpZXMgPSB0aGlzLmNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKHRoaXMub3B0aW9ucy5zZWxlY3RvcnMuZW50cmllcyk7XG4gICAgaWYgKGNyZWF0ZSAmJiBlbnRyaWVzID09PSBudWxsKSB7XG4gICAgICByZXR1cm4gY3JlYXRlX2JveCh0aGlzLm9wdGlvbnMudGFncy50YWcsIHtcbiAgICAgICAgY2xhc3M6IHRoaXMub3B0aW9ucy5zZWxlY3RvcnMuZW50cmllcy5zdWJzdHIoMSlcbiAgICAgIH0sIHRoaXMuY29udGFpbmVyKTtcbiAgICB9XG4gICAgcmV0dXJuIGVudHJpZXM7XG4gIH1cblxuICBhcHBlbmRFbnRyeShlbnRyeSkge1xuICAgIGlmIChlbnRyeS5wYXJlbnQgJiYgZW50cnkucGFyZW50LmVudHJpZXMpIHtcbiAgICAgIGNvbnN0IG4gPSBlbnRyeS5wYXJlbnQuZW50cmllcy5pbmRleE9mKGVudHJ5KTtcbiAgICAgIGRlbGV0ZSBlbnRyeS5wYXJlbnQuZW50cmllc1tuXTtcbiAgICB9XG4gICAgZW50cnkucGFyZW50ID0gdGhpcztcbiAgICB0aGlzLmVudHJpZXMucHVzaChlbnRyeSk7XG4gICAgY29uc3QgcGFyZW50ID0gdGhpcy5nZXRFbnRyaWVzRWxlbWVudCh0cnVlKTtcbiAgICBwYXJlbnQuYXBwZW5kKGVudHJ5LmNvbnRhaW5lcik7XG4gICAgcmV0dXJuIGVudHJ5O1xuICB9XG4gIC8qIHdoZW4gZXh0ZW5kZWQgKi9cbiAgbmV3RW50cnkoZW50cnkpIHtcbiAgICByZXR1cm4gbmV3IEVudHJ5KGVudHJ5LCB0aGlzLm9wdGlvbnMpO1xuICB9XG4gIC8qKiBleHRyYSBhdHRyICwgc3R5bGVzICwgdHlwZXMgICovXG4gIHNldEF0dHJpYnV0ZXMoZW50cnkpIHtcbiAgICByZXR1cm4gZW50cnk7XG4gIH1cbiAgZXh0cmFTdHlsZXMoZW50cnkpIHt9XG4gIHNldERpc2NhcmQoKSB7fVxuICAvKmVuZCBleHRyYSBhdHRyICwgc3R5bGVzICwgdHlwZXMgICovXG4gIGNyZWF0ZUVudHJ5KGVudHJ5KSB7XG4gICAgdGhpcy5vcHRpb25zLmNzcy5pY29ucyA9IFtdO1xuICAgIGVudHJ5ID0gdGhpcy5zZXRBdHRyaWJ1dGVzKGVudHJ5KTtcbiAgICB0aGlzLmV4dHJhU3R5bGVzKGVudHJ5KTtcbiAgICBjb25zdCBuZXdfZW50cnkgPSB0aGlzLm5ld0VudHJ5KGVudHJ5LCB0aGlzLm9wdGlvbnMpO1xuICAgIHRoaXMuYXBwZW5kRW50cnkobmV3X2VudHJ5KTtcbiAgICBuZXdfZW50cnkuYWRkTGlzdGVuZXJzKCk7XG4gICAgbmV3X2VudHJ5LnNldERpc2NhcmQoKTtcbiAgICByZXR1cm4gbmV3X2VudHJ5O1xuICB9XG4gIGZpbmRFbnRyeShuYW1lKSB7XG4gICAgY29uc3QgZW50cmllcyA9IHRoaXMuZ2V0RW50cmllcygpO1xuICAgIGZvciAoY29uc3QgZW50cnkgb2YgZW50cmllcykge1xuICAgICAgaWYgKGVudHJ5Lm5hbWUgPT09IG5hbWUpIHJldHVybiBlbnRyeTtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgLy9cbiAgY3JlYXRlTGlzdEVudHJpZXMobGlzdGVudHJpZXMpIHtcbiAgICBjb25zdCBkaXJlbnRyeSA9IHRoaXMuZ2V0RW50cmllc0VsZW1lbnQodHJ1ZSk7XG4gICAgbGlzdGVudHJpZXMuZm9yRWFjaChlbnRyaWVzID0+IHtcbiAgICAgIGVudHJpZXMuZm9yRWFjaCgoZW50cnkpID0+IHtcbiAgICAgICAgY29uc3QgbmV3X2VudHJ5ID0gdGhpcy5jcmVhdGVFbnRyeShlbnRyeSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuICByZW1vdmVFbnRyaWVzKCkge1xuICAgIHRoaXMuZW50cmllcyA9IFtdO1xuICAgIGNvbnN0IGVsID0gdGhpcy5nZXRFbnRyaWVzRWxlbWVudCgpO1xuICAgIGlmIChlbCkgZWwucmVtb3ZlKCk7XG4gIH1cbiAgaXNBY3RpdmUoKSB7XG4gICAgcmV0dXJuIHRoaXMuYWN0aXZlO1xuICB9XG5cbiAgdG9nZ2xlQWN0aXZlKCkge1xuICAgIHRoaXMuYWN0aXZlID0gISh0aGlzLmFjdGl2ZSk7XG4gICAgdGhpcy5jb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSh0aGlzLm9wdGlvbnMuY3NzLm9uKTtcbiAgfVxuICBzZXRTZWxlY3RlZChzZWxlY3RlZCA9IHRydWUpIHtcbiAgICBjb25zdCBjbCA9IHRoaXMub3B0aW9ucy5jc3Muc2VsZWN0ZWQ7XG4gICAgaWYgKHNlbGVjdGVkID09PSB0cnVlKSB0aGlzLmNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKGNsKTtcbiAgICBlbHNlIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoY2wpO1xuICAgIHRoaXMuc2V0T24oc2VsZWN0ZWQpO1xuICB9XG4gIHNldE9uKG9uID0gdHJ1ZSkge1xuICAgIHRoaXMuYWN0aXZlID0gb247XG4gICAgaWYgKG9uID09PSB0cnVlKSB0aGlzLmNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKHRoaXMub3B0aW9ucy5jc3Mub24pO1xuICAgIGVsc2UgdGhpcy5jb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLm9wdGlvbnMuY3NzLm9uKTtcbiAgfVxuICBzZXRPZmYoKSB7XG4gICAgdGhpcy5zZXRTZWxlY3RlZChmYWxzZSk7XG4gIH1cbiAgZ2V0TGlzdGVuZXJzKCkge1xuICAgIGxldCBsaXN0ZW5lcnMgPSBbXTtcbiAgICBjb25zdCBzZWxmID0gdGhpcztcbiAgICBsZXQgZnVuYyA9IChlKSA9PiB7XG4gICAgICBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuICAgICAgdGhpcy5icmFuY2hMaXN0ZW5lcigoKSA9PiB7XG4gICAgICAgIHRoaXMuZW1pdEV2ZW50KHRoaXMuZXZlbnRuYW1lcy5hdHRhY2gpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICBpZiAoW2VudHJ5VHlwZXMucm9vdCwgZW50cnlUeXBlcy5kaXNjYXJkXS5pbmRleE9mKHRoaXMudHlwZSkgPCAwKSB7XG4gICAgICBpZiAodGhpcy50eXBlID09PSBlbnRyeVR5cGVzLm5vZGUpIHtcbiAgICAgICAgZnVuYyA9IChlKSA9PiB7XG4gICAgICAgICAgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICB0aGlzLnRvZ2dsZUFjdGl2ZSgpO1xuICAgICAgICAgIHRoaXMuZW1pdEV2ZW50KCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgbGlzdGVuZXJzLnVuc2hpZnQoe1xuICAgICAgbmFtZTogJ2NsaWNrJyxcbiAgICAgIHRhcmdldDogJ2xhYmVsJyxcbiAgICAgIGZ1bmM6IGZ1bmNcbiAgICB9KTtcbiAgICByZXR1cm4gbGlzdGVuZXJzO1xuICB9XG5cbiAgaXNCcmFuY2goY2hlY2tyb290ID0gdHJ1ZSkge1xuICAgIGNvbnN0IGJyYW5jaHR5cGVzID0gW2VudHJ5VHlwZXMuYnJhbmNoXTtcbiAgICBpZiAoY2hlY2tyb290ICYmIGJyYW5jaHR5cGVzLmluZGV4T2YoZW50cnlUeXBlcy5yb290KSA8IDApIGJyYW5jaHR5cGVzLnB1c2goZW50cnlUeXBlcy5yb290KTtcbiAgICByZXR1cm4gKGJyYW5jaHR5cGVzLmluZGV4T2YodGhpcy50eXBlKSA+PSAwKVxuICB9XG4gIGlzRGlzY2FyZGVkKCkge1xuICAgIHJldHVybiAoW2VudHJ5VHlwZXMuZGlzY2FyZCwgZW50cnlUeXBlcy5kaXNjYXJkZWRdLmluZGV4T2YodGhpcy50eXBlKSA+PSAwKVxuICB9XG4gIGVtaXRFdmVudChhY3Rpb24gPSBudWxsLCBldiA9IG51bGwpIHtcbiAgICBjb25zdCBzZWxmID0gdGhpcztcbiAgICBjb25zdCBkZXRhaWwgPSB7XG4gICAgICBlbnRyeTogc2VsZixcbiAgICB9XG4gICAgaWYgKGFjdGlvbikgZGV0YWlsLmFjdGlvbiA9IGFjdGlvbjtcbiAgICBpZiAoZXYpIGRldGFpbC5ldmVudCA9IGV2O1xuICAgIGVsc2UgZXYgPSB0aGlzLmV2ZW50bmFtZXMuY29udHJvbDtcbiAgICBNb2R1bGVFdmVudEVtaXR0ZXIuZW1pdCh0aGlzLmV2ZW50Lm5hbWUsIGRldGFpbCwgdGhpcy5ldmVudC5saXN0ZW5lcik7XG4gIH1cbiAgbW92ZUhhbmRsZXJzKCkge1xuICAgIHJldHVybiBbe1xuICAgICAgbmFtZTogJ2RyYWdzdGFydCcsXG4gICAgICBmdW5jOiAoZSkgPT4ge1xuICAgICAgICB0aGlzLmhhbmRsZURyYWdTdGFydChlKTtcbiAgICAgIH1cbiAgICB9LCB7XG4gICAgICBuYW1lOiAnZHJhZ2VuZCcsXG4gICAgICBmdW5jOiAoZSkgPT4ge1xuICAgICAgICB0aGlzLmhhbmRsZURyYWdFbmQoZSk7XG4gICAgICB9XG4gICAgfV07XG4gIH1cbiAgZHJvcEhhbmRsZXJzKCkge1xuICAgIHJldHVybiBbe1xuICAgICAgbmFtZTogJ2RyYWdvdmVyJyxcbiAgICAgIGZ1bmM6IChlKSA9PiB7XG4gICAgICAgIHRoaXMuaGFuZGxlRHJhZ092ZXIoZSk7XG4gICAgICB9XG4gICAgfSwge1xuICAgICAgbmFtZTogJ2Ryb3AnLFxuICAgICAgZnVuYzogKGUpID0+IHtcbiAgICAgICAgdGhpcy5oYW5kbGVEcm9wKGUpO1xuICAgICAgfVxuICAgIH1dO1xuICB9XG4gIGJyYW5jaExpc3RlbmVyKGNhbGxiYWNrID0gbnVsbCkge1xuICAgIHRoaXMudG9nZ2xlQWN0aXZlKCk7XG4gICAgaWYgKHRoaXMuaXNBY3RpdmUoKSkgdGhpcy5icmFuY2hBY3RpdmF0ZShjYWxsYmFjaykudGhlbigoKSA9PiB7XG4gICAgICB0aGlzLmVtaXRFdmVudCgpO1xuICAgIH0pO1xuICB9XG4gIGFkZExpc3RlbmVycygpIHtcbiAgICBjb25zdCBsaXN0ZW5lcnMgPSB0aGlzLmdldExpc3RlbmVycygpO1xuICAgIGZvciAoY29uc3QgbGlzdGVuZXIgb2YgbGlzdGVuZXJzKSB7XG4gICAgICBjb25zdCBlbCA9IChsaXN0ZW5lci50YXJnZXQgPT09ICdsYWJlbCcpID8gdGhpcy5nZXRMYWJlbEVsZW1lbnQoKSA6IHRoaXMuY29udGFpbmVyO1xuICAgICAgZWwuYWRkRXZlbnRMaXN0ZW5lcihsaXN0ZW5lci5uYW1lLCBsaXN0ZW5lci5mdW5jKTtcbiAgICB9XG4gIH1cbiAgcmVtb3ZlTGlzdGVuZXJzKGxpc3RlbmVycykge1xuICAgIGZvciAoY29uc3QgbGlzdGVuZXIgaW4gbGlzdGVuZXJzKSB7XG4gICAgICBjb25zdCBlbCA9IChsaXN0ZW5lci50YXJnZXQgPT09ICdsYWJlbCcpID8gdGhpcy5nZXRMYWJlbEVsZW1lbnQoKSA6IHRoaXMuY29udGFpbmVyO1xuICAgICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcihsaXN0ZW5lci5sYWJlbCwgbGlzdGVuZXIuZnVuYyk7XG4gICAgfVxuICB9XG4gIGRlc3Ryb3koKSB7XG4gICAgdGhpcy5jb250YWluZXIucmVtb3ZlKCk7XG4gIH1cblxuICBoYW5kbGVEcmFnU3RhcnQoZSkge1xuICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG4gICAgdGhpcy5jb250YWluZXIuY2xhc3NMaXN0LmFkZCh0aGlzLm9wdGlvbnMuY3NzLmRyYWdnaW5nKTtcbiAgICBlLmRhdGFUcmFuc2Zlci5lZmZlY3RBbGxvd2VkID0gJ21vdmUnO1xuICAgIHRoaXMuZW1pdEV2ZW50KCdkcmFnc3RhcnQnLCBlKTtcbiAgfVxuICBoYW5kbGVEcmFnT3ZlcihlKSB7XG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgdGhpcy5lbWl0RXZlbnQoJ2RyYWdvdmVyJywgZSk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGhhbmRsZURyYWdFbmQoZSkge1xuICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5vcHRpb25zLmNzcy5kcmFnZ2luZyk7XG4gICAgdGhpcy5lbWl0RXZlbnQoJ2RyYWdlbmQnLCBlKTtcbiAgfVxuICByZXNldERyYWdPdmVyKCkge1xuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy4nICsgdGhpcy5vcHRpb25zLmNzcy5kcmFnb3ZlcikuZm9yRWFjaChlbCA9PiB7XG4gICAgICBlbC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMub3B0aW9ucy5jc3MuZHJhZ292ZXIpO1xuICAgIH0pO1xuICB9XG4gIGhhbmRsZURyb3AoZSkge1xuICAgIC8qKiovXG4gICAgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcbiAgICB0aGlzLmVtaXRFdmVudCgnZHJvcCcsIGUpO1xuICB9XG4gIHNldFdhaXQoKSB7XG4gICAgdGhpcy5sb2FkZWQgPSB0aGlzLmNvbnRhaW5lci5kYXRhc2V0LmxvYWRlZCA9IGZhbHNlO1xuICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoY3NzLndhaXQpO1xuICB9XG4gIHNldExvYWRlZCgpIHtcbiAgICB0aGlzLmNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKGNzcy53YWl0KTtcbiAgICB0aGlzLmxvYWRlZCA9IHRoaXMuY29udGFpbmVyLmRhdGFzZXQubG9hZGVkID0gdHJ1ZTtcbiAgfVxuICBmaW5kRW50cnkobmFtZSwgdHlwZSkge1xuICAgIGNvbnN0IGVudHJpZXMgPSB0aGlzLmdldEVudHJpZXMoKTtcbiAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIGVudHJpZXMpIHtcbiAgICAgIGlmIChlbnRyeS5uYW1lID09PSBuYW1lICYmIGVudHJ5LnR5cGUgPT09IHR5cGUpIHJldHVybiBlbnRyeTtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBhc3luYyBicmFuY2hBY3RpdmF0ZShjYWxsYmFjayA9IG51bGwpIHtcbiAgICBpZiAoIXRoaXMubG9hZGVkKSB0aGlzLmxpc3QoKS50aGVuKCgpID0+IHtcbiAgICAgIGlmIChjYWxsYmFjaykgY2FsbGJhY2sodGhpcyk7XG4gICAgfSk7XG4gICAgZWxzZSBpZiAoY2FsbGJhY2spIGNhbGxiYWNrKHRoaXMpO1xuICB9XG4gIGdldEN1cnJlbnRQYXRoKCkge1xuICAgIGNvbnN0IGN1cnJlbnRfcGF0aCA9IChlbnRyeSwgYnJhbmNocyA9IFtdKSA9PiB7XG4gICAgICBpZiAoZW50cnkubmFtZSkge1xuICAgICAgICBicmFuY2hzLnB1c2goZW50cnkubmFtZSk7XG4gICAgICAgIGVudHJ5ID0gZW50cnkuZ2V0UGFyZW50KCk7XG4gICAgICAgIGlmIChlbnRyeSAhPT0gbnVsbCkgcmV0dXJuIGN1cnJlbnRfcGF0aChlbnRyeSwgYnJhbmNocyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gYnJhbmNocztcbiAgICB9XG4gICAgbGV0IGJyYW5jaHMgPSBjdXJyZW50X3BhdGgodGhpcyk7XG4gICAgaWYgKGJyYW5jaHMubGVuZ3RoID4gMSkgYnJhbmNocyA9IGJyYW5jaHMucmV2ZXJzZSgpO1xuICAgIHJldHVybiBicmFuY2hzO1xuICB9XG4gIGFzeW5jIGpzb25FbnRyaWVzKHJlc3BvbnNlKSB7XG4gICAgY29uc3QganNvbiA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICByZXR1cm4ganNvbjtcbiAgfVxuICBpc0RyYWdnYWJsZSgpIHtcbiAgICByZXR1cm4gKHRoaXMub3B0aW9ucy5kcmFnZ2FibGVzICYmIHRoaXMub3B0aW9ucy5kcmFnZ2FibGVzLmluZGV4T2YodGhpcy50eXBlKSA+PSAwKTtcbiAgfVxuICBhc3luYyBsaXN0KCkge1xuICAgIGlmICh0aGlzLnR5cGUgPT09IGVudHJ5VHlwZXMubm9kZSkgcmV0dXJuO1xuXG4gICAgY29uc3QgdXJsID0gKHRoaXMuZ2V0VXJsKSA/IHRoaXMuZ2V0VXJsKCkgOiBudWxsO1xuICAgIGlmICh1cmwgPT09IG51bGwpIHJldHVybjtcbiAgICBjb25zdCB0YWcgPSB0aGlzLm9wdGlvbnMudGFncy50YWc7XG4gICAgY29uc3Qgc3VidGFnID0gdGhpcy5vcHRpb25zLnRhZ3Muc3VidGFnO1xuICAgIHRoaXMuc2V0V2FpdCgpO1xuICAgIHRoaXMucmVtb3ZlRW50cmllcygpO1xuICAgIGNvbnN0IGZldGNob3B0aW9ucyA9IHtcbiAgICAgIGhlYWRlcnM6IG5ldyBIZWFkZXJzKHtcbiAgICAgICAgJ2NvbnRlbnQtdHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xuICAgICAgfSlcbiAgICB9O1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godXJsLCBmZXRjaFNldHRpbmdzKGZldGNob3B0aW9ucykpO1xuICAgIGlmIChyZXNwb25zZS5vaykge1xuICAgICAgY29uc3QgZW50cmllcyA9IGF3YWl0IHRoaXMuanNvbkVudHJpZXMocmVzcG9uc2UpO1xuXG4gICAgICBpZiAoZW50cmllcy5sZW5ndGgpIHtcbiAgICAgICAgbGV0IG5vZGVzID0gW10sXG4gICAgICAgICAgYnJhbmNoZXMgPSBbXTtcbiAgICAgICAgd2hpbGUgKGVudHJpZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGNvbnN0IGVudHJ5ID0gZW50cmllcy5zaGlmdCgpO1xuICAgICAgICAgIGlmIChlbnRyeS5jaGlsZHJlbiA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIG5vZGVzLnB1c2goZW50cnkpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBicmFuY2hlcy5wdXNoKGVudHJ5KTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIG5vZGVzLnNvcnQoKGEsIGIpID0+IChhLm5hbWUgPCBiLm5hbWUpKTtcbiAgICAgICAgYnJhbmNoZXMuc29ydCgoYSwgYikgPT4gKGEubmFtZSA8IGIubmFtZSkpO1xuICAgICAgICB0aGlzLmNyZWF0ZUxpc3RFbnRyaWVzKFticmFuY2hlcywgbm9kZXNdKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuc2V0TG9hZGVkKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIEFsZXJ0Qm94LmFkZE1lc3NhZ2Uoe1xuICAgICAgICBwYXJlbnQ6IHRoaXMuY29udGFpbmVyLFxuICAgICAgICB0eXBlOiBcImVycm9yXCIsXG4gICAgICAgIGNvbnRlbnQ6IHJlc3BvbnNlLmVycm9yICsgJyAnICsgcmVzcG9uc2UudGV4dFxuICAgICAgfSlcbiAgICB9XG5cbiAgfVxuICBtb3ZlVG8oZGVzdCkge1xuICAgIGNvbnN0IGJyYW5jaGVzID0gZGVzdC5nZXRDdXJyZW50UGF0aCgpO1xuICAgIGNvbnN0IHR5cGUgPSAoZGVzdC50eXBlID09PSBlbnRyeVR5cGVzLmRpc2NhcmQpID8gZW50cnlUeXBlcy5kaXNjYXJkZWQgOiBkZXN0LnR5cGU7XG4gICAgYnJhbmNoZXMucG9wKCk7XG4gICAgYnJhbmNoZXMuZm9yRWFjaCgoYnJhbmNoLCBpbmRleCkgPT4ge1xuICAgICAgbGV0IHN1YmRlc3QgPSBkZXN0LmZpbmRFbnRyeShicmFuY2gsIHR5cGUpO1xuICAgICAgaWYgKHN1YmRlc3QgPT09IG51bGwpIHtcbiAgICAgICAgc3ViZGVzdCA9IGRlc3QuY3JlYXRlRW50cnkoe1xuICAgICAgICAgIHR5cGU6IHR5cGUsXG4gICAgICAgICAgbmFtZTogYnJhbmNoXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgZGVzdCA9IHN1YmRlc3Q7XG4gICAgfSk7XG4gICAgaWYgKGRlc3QuZmluZEVudHJ5KHRoaXMubmFtZSwgdGhpcy50eXBlKSA9PT0gbnVsbCkge1xuICAgICAgdGhpcy5mcm9tID0gdGhpcy5wYXJlbnQ7XG4gICAgICBkZXN0LmFwcGVuZEVudHJ5KHRoaXMpO1xuICAgIH1cbiAgfVxuICB1bk1vdmUoKSB7XG4gICAgaWYgKHRoaXMuZnJvbSkge1xuICAgICAgdGhpcy5tb3ZlVG8odGhpcy5mcm9tKTtcbiAgICAgIHRoaXMuZnJvbSA9IG51bGw7XG4gICAgfVxuICB9XG59XG5leHBvcnQgZnVuY3Rpb24gRW50cnlDb250cm9scyhjb250YWluZXIgPSBkb2N1bWVudCwgb3B0aW9ucyA9IHt9KSB7XG4gIGNvbnN0IGV2ZW50bmFtZXMgPSB7XG4gICAgY29udHJvbDogJ2NvbnRyb2wnLFxuICAgIGVycm9yOiAnZXJyb3InLFxuICB9XG4gIGNvbnN0IGNvbnRyb2xvcHRpb25zID0ge1xuICAgIHNlbGVjdG9yczoge1xuICAgICAgdHlwZW50cmllczogJ1tkYXRhLXR5cGVudHJpZXNdJyxcbiAgICAgIGhhc2NvbnRyb2xzOiAnLmhhcy1jb250cm9scycsXG4gICAgfSxcbiAgICBjb250cm9sczoge1xuICAgICAgbGlzdDoge1xuICAgICAgICBhY3Rpb246ICdsaXN0JyxcbiAgICAgICAgdHlwZW50cmllczogWydCJywgJ1QnXVxuICAgICAgfSxcbiAgICB9LFxuICAgIGNzczoge1xuICAgICAgZW50cnljb250cm9sczogJ2VudHJ5Y29udHJvbHMnLFxuICAgICAgZW50cmllczogJy5lbnRyaWVzJyxcbiAgICB9XG4gIH07XG4gIGxldCBib3gsIGFjdGl2ZW50cnkgPSBudWxsO1xuICBvcHRpb25zID0gT2JqZWN0LmFzc2lnbihjb250cm9sb3B0aW9ucywgb3B0aW9ucyk7XG4gIGluaXQoKTtcblxuICBmdW5jdGlvbiBpbml0KCkge1xuICAgIGNyZWF0ZUNvbnRyb2xzKCk7XG4gICAgaW5pdEV2ZW50cygpO1xuICB9XG5cbiAgZnVuY3Rpb24gYWRkQ29udHJvbChjb250cm9sLCBwb3NpdGlvbiA9IG51bGwsIGFjdGlvbiA9IG51bGwpIHtcbiAgICBjb25zdCBjdHJsID0gY3JlYXRlX2JveCgnc3BhbicsIHt9KTtcbiAgICBjb25zdCBsID0gYm94LmNoaWxkcmVuLmxlbmd0aDtcbiAgICBpZiAocG9zaXRpb24gPT09IG51bGwgfHwgbCA8IHBvc2l0aW9uICsgMSkgYm94LmFwcGVuZChjdHJsKTtcbiAgICBlbHNlIGlmIChwb3NpdGlvbiA9PT0gMCB8fCBsID09PSAwKSBib3gucHJlcGVuZChjdHJsKTtcbiAgICBlbHNlIGJveC5pbnNlckJlZm9yZShjcnRsLCBib3guY2hpbGRyZW5bcG9zaXRpb25dKTtcbiAgICBpZiAoY29udHJvbC50eXBlbnRyaWVzKSBjdHJsLmRhdGFzZXQudHlwZW50cmllcyA9IGNvbnRyb2wudHlwZW50cmllcztcbiAgICBpZiAoY29udHJvbC5pY29uKSB7XG4gICAgICBjb25zdCBpY29uID0gY3JlYXRlX2JveCgnaScsIHtcbiAgICAgICAgY2xhc3M6IFsnaWNvbicsIGNvbnRyb2wuaWNvbl1cbiAgICAgIH0sIGN0cmwpO1xuICAgICAgY3RybC5kYXRhc2V0LnRpdGxlID0gY29udHJvbC50ZXh0O1xuICAgIH0gZWxzZSBjdHJsLnRleHRDb250ZW50ID0gY29udHJvbC50ZXh0O1xuICAgIC8vYWRkIGxpc3RlbmVyXG4gICAgY29uc3QgZXZ0ID0gKGNvbnRyb2wudHJpZ2dlcikgPyBjb250cm9sLnRyaWdnZXIgOiAnY2xpY2snO1xuICAgIGNvbnN0IGZ1bmMgPSAoZSkgPT4ge1xuICAgICAgaWYgKGFjdGl2ZW50cnkgPT09IG51bGwpIHJldHVybjtcbiAgICAgIGNvbnN0IGRldGFpbCA9IHtcbiAgICAgICAgY2FsbGJhY2s6ICgpID0+IHtcbiAgICAgICAgICBjb25zb2xlLmxvZygnZG9uZScsIGNvbnRyb2wuYWN0aW9uKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoIWFjdGl2ZW50cnlbY29udHJvbC5hY3Rpb25dICYmIGFjdGlvbiAhPT0gbnVsbCkge1xuICAgICAgICBhY3Rpb24oYWN0aXZlbnRyeSk7XG4gICAgICB9IGVsc2UgaWYgKGFjdGl2ZW50cnlbY29udHJvbC5hY3Rpb25dKSBhY3RpdmVudHJ5W2NvbnRyb2wuYWN0aW9uXShkZXRhaWwpO1xuICAgICAgaWYgKGNvbnRyb2wuY2FsbGJhY2spIGNvbnRyb2wuY2FsbGJhY2soZSk7XG4gICAgfTtcbiAgICBjdHJsLmFkZEV2ZW50TGlzdGVuZXIoZXZ0LCBmdW5jKTtcbiAgICAvL1xuICAgIGNvbnRyb2wuY3RybCA9IGN0cmw7XG4gIH1cblxuICBmdW5jdGlvbiBjcmVhdGVDb250cm9scygpIHtcbiAgICBib3ggPSBjcmVhdGVfYm94KCdkaXYnLCB7XG4gICAgICBjbGFzczogW29wdGlvbnMuY3NzLmVudHJ5Y29udHJvbHMsIGNzcy5oaWRlXVxuICAgIH0pO1xuICAgIE9iamVjdC52YWx1ZXMob3B0aW9ucy5jb250cm9scykuZmlsdGVyKGNvbnRyb2wgPT4gKGNvbnRyb2wuaWNvbiB8fCBjb250cm9sLnRleHQpKS5mb3JFYWNoKGNvbnRyb2wgPT4ge1xuICAgICAgYWRkQ29udHJvbChjb250cm9sKTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGluaXRFdmVudHMoKSB7fVxuXG4gIGZ1bmN0aW9uIGRldGFjaENvbnRyb2xzKCkge1xuICAgIGlmIChhY3RpdmVudHJ5ID09PSBudWxsKSByZXR1cm47XG4gICAgYWN0aXZlbnRyeS5jb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZShvcHRpb25zLnNlbGVjdG9ycy5oYXNjb250cm9scy5zdWJzdHIoMSkpO1xuICAgIGJveC5jbGFzc0xpc3QuYWRkKGNzcy5oaWRlKTtcbiAgICBib3guZGlzYWJsZWQgPSB0cnVlO1xuICAgIGNvbnRhaW5lci5hcHBlbmQoYm94KTtcbiAgICBhY3RpdmVudHJ5ID0gbnVsbDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGF0dGFjaENvbnRyb2xzKGVudHJ5KSB7XG4gICAgZGV0YWNoQ29udHJvbHMoKTtcbiAgICBhY3RpdmVudHJ5ID0gZW50cnk7XG4gICAgYWN0aXZlbnRyeS5jb250YWluZXIucHJlcGVuZChib3gpO1xuICAgIGFjdGl2ZW50cnkuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQob3B0aW9ucy5zZWxlY3RvcnMuaGFzY29udHJvbHMuc3Vic3RyKDEpKTtcbiAgICBhY3RpdmF0ZUNvbnRyb2xzKCk7XG4gICAgYm94LmNsYXNzTGlzdC5yZW1vdmUoY3NzLmhpZGUpO1xuICAgIGRlbGV0ZSBib3guZGlzYWJsZWQ7XG4gIH1cblxuICBmdW5jdGlvbiBzaG93Q29udHJvbHMoc2hvdyA9IHRydWUpIHtcbiAgICBpZiAoc2hvdyA9PT0gdHJ1ZSkgYm94LmNsYXNzTGlzdC5yZW1vdmUoY3NzLmhpZGUpO1xuICAgIGVsc2UgYm94LmNsYXNzTGlzdC5hZGQoY3NzLmhpZGUpO1xuICAgIGJveC5kaXNhYmxlZCA9ICFzaG93O1xuICB9XG5cbiAgZnVuY3Rpb24gYWN0aXZhdGVDb250cm9sKGNvbnRyb2wsIGlzZGlzY2FyZGVkID0gZmFsc2UpIHtcbiAgICBjb25zdCBjdHJsID0gY29udHJvbC5jdHJsO1xuICAgIGNvbnN0IHR5cGVudHJpZXMgPSAoY3RybC5kYXRhc2V0LnR5cGVudHJpZXMpID8gY3RybC5kYXRhc2V0LnR5cGVudHJpZXMuc3BsaXQoJywnKSA6IFtdO1xuICAgIGNvbnN0IHR5cGUgPSAoaXNkaXNjYXJkZWQpID8gZW50cnlUeXBlcy5kaXNjYXJkZWQgOiBhY3RpdmVudHJ5LmNvbnRhaW5lci5kYXRhc2V0LnR5cGU7XG4gICAgaWYgKHR5cGVudHJpZXMuaW5kZXhPZih0eXBlKSA+PSAwKSB7XG4gICAgICBjdHJsLmNsYXNzTGlzdC5yZW1vdmUoY3NzLmhpZGUpO1xuICAgIH0gZWxzZSBjdHJsLmNsYXNzTGlzdC5hZGQoY3NzLmhpZGUpO1xuICB9XG5cbiAgZnVuY3Rpb24gYWN0aXZhdGVDb250cm9scygpIHtcbiAgICBpZiAoYWN0aXZlbnRyeSA9PT0gbnVsbCkgcmV0dXJuO1xuICAgIC8vIGFkZCBidG5zXG4gICAgY29uc3QgaXNkaXNjYXJkZWQgPSBhY3RpdmVudHJ5LmlzRGlzY2FyZGVkKCk7XG4gICAgT2JqZWN0LnZhbHVlcyhvcHRpb25zLmNvbnRyb2xzKS5maWx0ZXIoY29udHJvbCA9PiAoY29udHJvbC5pY29uIHx8IGNvbnRyb2wudGV4dCkpLmZvckVhY2goY29udHJvbCA9PiB7XG4gICAgICBhY3RpdmF0ZUNvbnRyb2woY29udHJvbCwgaXNkaXNjYXJkZWQpO1xuICAgIH0pO1xuICAgIC8vXG4gIH1cbiAgcmV0dXJuIHtcbiAgICBvcHRpb25zLFxuICAgIGFkZENvbnRyb2wsXG4gICAgYXR0YWNoQ29udHJvbHMsXG4gICAgZGV0YWNoQ29udHJvbHMsXG4gICAgc2hvd0NvbnRyb2xzLFxuICAgIGFjdGl2YXRlQ29udHJvbHMsXG4gICAgYWN0aXZhdGVDb250cm9sXG4gIH1cbn0iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/modules/entry.js\n")},"./src/modules/module-event-emitter.js":(module,__webpack_exports__,__webpack_require__)=>{eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ModuleEventEmitter: () => (/* binding */ ModuleEventEmitter)\n/* harmony export */ });\n/* harmony import */ var _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../modules/alert-box.js */ \"./src/modules/alert-box.js\");\n/* harmony import */ var _modules_utils_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../modules/utils.js */ \"./src/modules/utils.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_modules_alert_box_js__WEBPACK_IMPORTED_MODULE_0__]);\n_modules_alert_box_js__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\nfunction CustomEventEmitter(event, detail) {\n  /**\n   * Add custom event listener\n   * @param  {Object} event {name:{String}, listener:{Object}}\n   * @param  {Object} detail\n   * @return {Void}\n   */\n  const custom = new CustomEvent(event.name, {\n    detail: detail,\n  })\n  event.listener.dispatchEvent(custom);\n}\n\n\nfunction ObjectEventEmitter(event, callback, listener = window) {\n  /**\n   * Add custom event listener\n   * @param  {String} event\n   * @param  {Function} callback\n   * @param  {Object} listener\n   * @return {Object} listener\n   */\n  listener.on = function(event, callback) {\n    this._events = this._events || {}\n    this._events[event] = this._events[event] || []\n    this._events[event].push(callback)\n  }\n  listener.once = function(event, callback) {\n    callback.once = true;\n    self.on(event, callback);\n  }\n  listener.off = function(event, callback) {\n    this._events = this._events || {}\n    if (event in this._events === false) return;\n    this._events[event].splice(this._events[event].indexOf(callback), 1)\n  }\n  listener.emit = function(event, ...args) {\n    if (event in this._events === false) return;\n    else {\n      for (const action of this._events[event]) {\n        action(...args);\n        if (action.once) break;\n      }\n    }\n  }\n  return listener;\n}\n\nfunction createModuleEventEmitter(event, callback) {\n  /**\n   * Add event bus global or with listener\n   * @param  {String} event\n   * @param  {Function} callback\n   * @return {Void}\n   */\n  const _events = [];\n  const all = 'ALL_EVENTS';\n\n  function on(event, callback, listener = all) {\n    _events[listener] = _events[listener] || [];\n    _events[listener][event] = _events[listener][event] || [];\n    _events[listener][event].push(callback);\n  }\n\n  function once(event, callback, listener = all) {\n    callback.once = true;\n    on(event, callback, listener);\n  }\n\n  function off(event, callback, listener = all) {\n    if (event in _events[listener] === false) return;\n    _events[listener][event].splice(_events[listener][event].indexOf(callback), 1);\n  }\n\n  function emit(event, e = {}, listener = all) {\n    _events[listener] = _events[listener] || [];\n    if (event in _events[listener] === false) return;\n    else {\n      for (const action of _events[listener][event]) {\n        action(e);\n        if (action.once) break;\n      }\n    }\n  }\n\n  return {\n    on,\n    once,\n    off,\n    emit\n  }\n}\n\nconst ModuleEventEmitter = await createModuleEventEmitter();\n// each function or class which communicates need and event object and optional emitEvent function\n\n// global capture errors\nconst eventnames = {\n  error: 'error'\n}\nModuleEventEmitter.on(eventnames.error, (e) => {\n  _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_0__.AlertBox.renderAlert({\n    type: _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_0__.AlertBox.alertconfig.types.error,\n    content: e,\n    inverse: true,\n    dismissible: true\n  });\n});\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } }, 1);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvbW9kdWxlcy9tb2R1bGUtZXZlbnQtZW1pdHRlci5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFFaUM7QUFHSjs7QUFFN0I7QUFDQTtBQUNBO0FBQ0EsY0FBYyxRQUFRLE9BQU8sTUFBTSxPQUFPLFlBQVk7QUFDdEQsY0FBYyxRQUFRO0FBQ3RCLGNBQWM7QUFDZDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0EsY0FBYyxRQUFRO0FBQ3RCLGNBQWMsVUFBVTtBQUN4QixjQUFjLFFBQVE7QUFDdEIsY0FBYyxRQUFRO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsY0FBYyxRQUFRO0FBQ3RCLGNBQWMsVUFBVTtBQUN4QixjQUFjO0FBQ2Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsNkJBQTZCO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFLDJEQUFRO0FBQ1YsVUFBVSwyREFBUTtBQUNsQjtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsQ0FBQyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9tb2R1bGVzL21vZHVsZS1ldmVudC1lbWl0dGVyLmpzP2NhNGQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQWxlcnRCb3hcbn0gZnJvbSAnLi4vbW9kdWxlcy9hbGVydC1ib3guanMnO1xuaW1wb3J0IHtcbiAgZ2VuZXJhdGVfdXVpZFxufSBmcm9tICcuLi9tb2R1bGVzL3V0aWxzLmpzJztcblxuZnVuY3Rpb24gQ3VzdG9tRXZlbnRFbWl0dGVyKGV2ZW50LCBkZXRhaWwpIHtcbiAgLyoqXG4gICAqIEFkZCBjdXN0b20gZXZlbnQgbGlzdGVuZXJcbiAgICogQHBhcmFtICB7T2JqZWN0fSBldmVudCB7bmFtZTp7U3RyaW5nfSwgbGlzdGVuZXI6e09iamVjdH19XG4gICAqIEBwYXJhbSAge09iamVjdH0gZGV0YWlsXG4gICAqIEByZXR1cm4ge1ZvaWR9XG4gICAqL1xuICBjb25zdCBjdXN0b20gPSBuZXcgQ3VzdG9tRXZlbnQoZXZlbnQubmFtZSwge1xuICAgIGRldGFpbDogZGV0YWlsLFxuICB9KVxuICBldmVudC5saXN0ZW5lci5kaXNwYXRjaEV2ZW50KGN1c3RvbSk7XG59XG5cblxuZnVuY3Rpb24gT2JqZWN0RXZlbnRFbWl0dGVyKGV2ZW50LCBjYWxsYmFjaywgbGlzdGVuZXIgPSB3aW5kb3cpIHtcbiAgLyoqXG4gICAqIEFkZCBjdXN0b20gZXZlbnQgbGlzdGVuZXJcbiAgICogQHBhcmFtICB7U3RyaW5nfSBldmVudFxuICAgKiBAcGFyYW0gIHtGdW5jdGlvbn0gY2FsbGJhY2tcbiAgICogQHBhcmFtICB7T2JqZWN0fSBsaXN0ZW5lclxuICAgKiBAcmV0dXJuIHtPYmplY3R9IGxpc3RlbmVyXG4gICAqL1xuICBsaXN0ZW5lci5vbiA9IGZ1bmN0aW9uKGV2ZW50LCBjYWxsYmFjaykge1xuICAgIHRoaXMuX2V2ZW50cyA9IHRoaXMuX2V2ZW50cyB8fCB7fVxuICAgIHRoaXMuX2V2ZW50c1tldmVudF0gPSB0aGlzLl9ldmVudHNbZXZlbnRdIHx8IFtdXG4gICAgdGhpcy5fZXZlbnRzW2V2ZW50XS5wdXNoKGNhbGxiYWNrKVxuICB9XG4gIGxpc3RlbmVyLm9uY2UgPSBmdW5jdGlvbihldmVudCwgY2FsbGJhY2spIHtcbiAgICBjYWxsYmFjay5vbmNlID0gdHJ1ZTtcbiAgICBzZWxmLm9uKGV2ZW50LCBjYWxsYmFjayk7XG4gIH1cbiAgbGlzdGVuZXIub2ZmID0gZnVuY3Rpb24oZXZlbnQsIGNhbGxiYWNrKSB7XG4gICAgdGhpcy5fZXZlbnRzID0gdGhpcy5fZXZlbnRzIHx8IHt9XG4gICAgaWYgKGV2ZW50IGluIHRoaXMuX2V2ZW50cyA9PT0gZmFsc2UpIHJldHVybjtcbiAgICB0aGlzLl9ldmVudHNbZXZlbnRdLnNwbGljZSh0aGlzLl9ldmVudHNbZXZlbnRdLmluZGV4T2YoY2FsbGJhY2spLCAxKVxuICB9XG4gIGxpc3RlbmVyLmVtaXQgPSBmdW5jdGlvbihldmVudCwgLi4uYXJncykge1xuICAgIGlmIChldmVudCBpbiB0aGlzLl9ldmVudHMgPT09IGZhbHNlKSByZXR1cm47XG4gICAgZWxzZSB7XG4gICAgICBmb3IgKGNvbnN0IGFjdGlvbiBvZiB0aGlzLl9ldmVudHNbZXZlbnRdKSB7XG4gICAgICAgIGFjdGlvbiguLi5hcmdzKTtcbiAgICAgICAgaWYgKGFjdGlvbi5vbmNlKSBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIGxpc3RlbmVyO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVNb2R1bGVFdmVudEVtaXR0ZXIoZXZlbnQsIGNhbGxiYWNrKSB7XG4gIC8qKlxuICAgKiBBZGQgZXZlbnQgYnVzIGdsb2JhbCBvciB3aXRoIGxpc3RlbmVyXG4gICAqIEBwYXJhbSAge1N0cmluZ30gZXZlbnRcbiAgICogQHBhcmFtICB7RnVuY3Rpb259IGNhbGxiYWNrXG4gICAqIEByZXR1cm4ge1ZvaWR9XG4gICAqL1xuICBjb25zdCBfZXZlbnRzID0gW107XG4gIGNvbnN0IGFsbCA9ICdBTExfRVZFTlRTJztcblxuICBmdW5jdGlvbiBvbihldmVudCwgY2FsbGJhY2ssIGxpc3RlbmVyID0gYWxsKSB7XG4gICAgX2V2ZW50c1tsaXN0ZW5lcl0gPSBfZXZlbnRzW2xpc3RlbmVyXSB8fCBbXTtcbiAgICBfZXZlbnRzW2xpc3RlbmVyXVtldmVudF0gPSBfZXZlbnRzW2xpc3RlbmVyXVtldmVudF0gfHwgW107XG4gICAgX2V2ZW50c1tsaXN0ZW5lcl1bZXZlbnRdLnB1c2goY2FsbGJhY2spO1xuICB9XG5cbiAgZnVuY3Rpb24gb25jZShldmVudCwgY2FsbGJhY2ssIGxpc3RlbmVyID0gYWxsKSB7XG4gICAgY2FsbGJhY2sub25jZSA9IHRydWU7XG4gICAgb24oZXZlbnQsIGNhbGxiYWNrLCBsaXN0ZW5lcik7XG4gIH1cblxuICBmdW5jdGlvbiBvZmYoZXZlbnQsIGNhbGxiYWNrLCBsaXN0ZW5lciA9IGFsbCkge1xuICAgIGlmIChldmVudCBpbiBfZXZlbnRzW2xpc3RlbmVyXSA9PT0gZmFsc2UpIHJldHVybjtcbiAgICBfZXZlbnRzW2xpc3RlbmVyXVtldmVudF0uc3BsaWNlKF9ldmVudHNbbGlzdGVuZXJdW2V2ZW50XS5pbmRleE9mKGNhbGxiYWNrKSwgMSk7XG4gIH1cblxuICBmdW5jdGlvbiBlbWl0KGV2ZW50LCBlID0ge30sIGxpc3RlbmVyID0gYWxsKSB7XG4gICAgX2V2ZW50c1tsaXN0ZW5lcl0gPSBfZXZlbnRzW2xpc3RlbmVyXSB8fCBbXTtcbiAgICBpZiAoZXZlbnQgaW4gX2V2ZW50c1tsaXN0ZW5lcl0gPT09IGZhbHNlKSByZXR1cm47XG4gICAgZWxzZSB7XG4gICAgICBmb3IgKGNvbnN0IGFjdGlvbiBvZiBfZXZlbnRzW2xpc3RlbmVyXVtldmVudF0pIHtcbiAgICAgICAgYWN0aW9uKGUpO1xuICAgICAgICBpZiAoYWN0aW9uLm9uY2UpIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiB7XG4gICAgb24sXG4gICAgb25jZSxcbiAgICBvZmYsXG4gICAgZW1pdFxuICB9XG59XG5cbmNvbnN0IE1vZHVsZUV2ZW50RW1pdHRlciA9IGF3YWl0IGNyZWF0ZU1vZHVsZUV2ZW50RW1pdHRlcigpO1xuLy8gZWFjaCBmdW5jdGlvbiBvciBjbGFzcyB3aGljaCBjb21tdW5pY2F0ZXMgbmVlZCBhbmQgZXZlbnQgb2JqZWN0IGFuZCBvcHRpb25hbCBlbWl0RXZlbnQgZnVuY3Rpb25cblxuLy8gZ2xvYmFsIGNhcHR1cmUgZXJyb3JzXG5jb25zdCBldmVudG5hbWVzID0ge1xuICBlcnJvcjogJ2Vycm9yJ1xufVxuTW9kdWxlRXZlbnRFbWl0dGVyLm9uKGV2ZW50bmFtZXMuZXJyb3IsIChlKSA9PiB7XG4gIEFsZXJ0Qm94LnJlbmRlckFsZXJ0KHtcbiAgICB0eXBlOiBBbGVydEJveC5hbGVydGNvbmZpZy50eXBlcy5lcnJvcixcbiAgICBjb250ZW50OiBlLFxuICAgIGludmVyc2U6IHRydWUsXG4gICAgZGlzbWlzc2libGU6IHRydWVcbiAgfSk7XG59KTtcbmV4cG9ydCB7XG4gIE1vZHVsZUV2ZW50RW1pdHRlclxufSJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/modules/module-event-emitter.js\n")}}]);