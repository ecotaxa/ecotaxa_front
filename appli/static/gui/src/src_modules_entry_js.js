/*! For license information please see src_modules_entry_js.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["src_modules_entry_js"],{"./src/modules/entry.js":(module,__webpack_exports__,__webpack_require__)=>{eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Entry: () => (/* binding */ Entry),\n/* harmony export */   EntryControls: () => (/* binding */ EntryControls),\n/* harmony export */   entryOptions: () => (/* binding */ entryOptions),\n/* harmony export */   entryTypes: () => (/* binding */ entryTypes)\n/* harmony export */ });\n/* harmony import */ var _modules_utils_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../modules/utils.js */ \"./src/modules/utils.js\");\n/* harmony import */ var _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../modules/modules-config.js */ \"./src/modules/modules-config.js\");\n/* harmony import */ var _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../modules/alert-box.js */ \"./src/modules/alert-box.js\");\n/* harmony import */ var _modules_module_event_emitter_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../modules/module-event-emitter.js */ \"./src/modules/module-event-emitter.js\");\n/* harmony import */ var _modules_tooltip_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../modules/tooltip.js */ \"./src/modules/tooltip.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_modules_alert_box_js__WEBPACK_IMPORTED_MODULE_2__, _modules_module_event_emitter_js__WEBPACK_IMPORTED_MODULE_3__]);\n([_modules_alert_box_js__WEBPACK_IMPORTED_MODULE_2__, _modules_module_event_emitter_js__WEBPACK_IMPORTED_MODULE_3__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\nconst toolTip=(0,_modules_tooltip_js__WEBPACK_IMPORTED_MODULE_4__.ToolTip)();\nconst entryTypes = Object.freeze({\n  node: \"N\",\n  branch: \"B\",\n  root: \"R\",\n  discard: \"D\",\n  discarded: \"X\"\n});\nconst entryOptions = {\n  selector: '[data-name]',\n  tags: {\n    tag: 'ul',\n    subtag: 'li',\n    label: 'span'\n  },\n  selectors: {\n    entries: '.entries'\n  },\n  draggables: [],\n  prefix: `entry`,\n  css: {\n    on: 'on',\n    entryN: 'entryN',\n    entryB: 'entryB',\n    entryR: 'entryR',\n    entryD: 'entryD',\n    editable: 'editable',\n    dragging: 'dragging',\n    dragover: 'dragover',\n    dragitem: 'dragitem',\n    selected: 'selected',\n  },\n  event: {\n    name: 'eventEntry'\n  }\n};\n\nclass Entry {\n  eventnames = {\n    attach: 'attach',\n    control: 'control'\n  };\n  name;\n  type;\n  label;\n  entries = [];\n  event = {\n    listener: window,\n    name: entryOptions.event.name,\n    init: {\n      bubbles: false,\n      cancelable: true\n    },\n  };\n\n\n  constructor(entry, options = {}) {\n    this.name = entry.name;\n    this.type = entry.type;\n    this.id = entry.id;\n    this.parent = entry.parent;\n    this.options = { ...entryOptions,\n      ...options\n    };\n    this.uuid = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.generate_uuid)();\n\n    this.eventnames = { ...this.eventnames,\n      ...this.options.eventnames\n    };\n    this.label = (options.label) ? options.label : null;\n    this.event = {\n      name: entryOptions.event.name,\n      listener: (options.listener) ? options.listener : this.uuid\n    };\n    this.init(entry);\n    return this;\n  }\n  init(entry) {\n    const dataset = {\n      name: this.name,\n      type: this.type\n    }\n    if (this.label !== null) dataset.label = this.label;\n    const el = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)(this.options.tags.subtag, {\n      draggable: this.isDraggable(),\n      dataset: dataset,\n    });\n    const cl = `${this.options.prefix}${this.type}`;\n    if([entryTypes.branch,entryTypes.root,entryTypes.discard].indexOf(this.type)>=0 ) this.icon= (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)('span',{class:'ico-'+cl},el);\n    this.label = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)(this.options.tags.label, {\n      class: cl,\n      text: (entry.label) ? entry.label : entry.name\n    }, el);\n    this.container = el;\n    this.loaded = this.container.dataset.loaded = false;\n    this.initEvents();\n  }\n  initEvents() {this.addListeners();}\n  getParent() {\n    return this.parent;\n  }\n  getLabelElement() {\n    return this.label;\n  }\n  getParentElement() {\n    return this.container.parentElement.closest(this.options.selector);\n  }\n\n  getEntries() {\n    return this.entries;\n  }\n  getEntriesElement(create = false) {\n    let entries = this.container.querySelector(this.options.selectors.entries);\n    if (create && entries === null) {\n      return (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)(this.options.tags.tag, {\n        class: this.options.selectors.entries.substr(1)\n      }, this.container);\n    }\n    return entries;\n  }\n\n  appendEntry(entry) {\n    if (entry.parent && entry.parent.entries) {\n      const n = entry.parent.entries.indexOf(entry);\n      delete entry.parent.entries[n];\n    }\n    entry.parent = this;\n    this.entries.push(entry);\n    const parent = this.getEntriesElement(true);\n    parent.append(entry.container);\n    return entry;\n  }\n  /* when extended */\n  newEntry(entry) {\n    return new Entry(entry, this.options);\n  }\n  /** extra attr , styles , types  */\n  setAttributes(entry) {\n    return entry;\n  }\n  extraStyles(entry) {}\n  setDiscard() {}\n  /*end extra attr , styles , types  */\n  createEntry(entry) {\n    this.options.css.icons = [];\n    entry = this.setAttributes(entry);\n    this.extraStyles(entry);\n    const new_entry = this.newEntry(entry, this.options);\n    this.appendEntry(new_entry);\n    new_entry.addListeners();\n    new_entry.setDiscard();\n    return new_entry;\n  }\n  findEntry(name) {\n    const entries = this.getEntries();\n    for (const entry of entries) {\n      if (entry.name === name) return entry;\n    }\n    return null;\n  }\n  //\n  createListEntries(listentries) {\n    const direntry = this.getEntriesElement(true);\n    listentries.forEach(entries => {\n      entries.forEach((entry) => {\n        const new_entry = this.createEntry(entry);\n      });\n    });\n  }\n  removeEntries() {\n    this.entries = [];\n    const el = this.getEntriesElement();\n    if (el) el.remove();\n  }\n  isActive() {\n    return this.active;\n  }\n\n  toggleActive() {\n    this.setOn(!this.active);\n    }\n\n  toggleOpen() {\n    this.setOpen(!this.open);\n  }\n\n  setSelected(selected = true) {\n    const cl = this.options.css.selected;\n    if (selected === true) this.container.classList.add(cl);\n    else this.container.classList.remove(cl);\n    this.setOn(selected);\n  }\n  setOn(on = true) {\n    this.active = on;\n  }\n\n  setOpen(on = true) {\n  const set_open= () => {\n    this.open = on;\n    if (on === true) this.container.classList.add(this.options.css.on);\n    else this.container.classList.remove(this.options.css.on);}\n    if (!this.loaded && on)  this.list().then(() => {\n        set_open();\n    }); else set_open();\n\n  }\n\n  setOff() {\n    this.setSelected(false);\n  }\n  getListeners() {\n    let listeners = [];\n    const self = this;\n    let func;\n      if (this.type === entryTypes.node  ) {\n        func = (e) => {\n          e.stopImmediatePropagation();\n          this.toggleActive();\n          this.emitEvent();\n        }\n      } else {\n      func = (e) => {\n      e.stopImmediatePropagation();\n      this.branchListener(() => {\n        this.emitEvent(this.eventnames.attach);\n      });\n    };}\n    listeners.unshift({\n      name: 'click',\n      target: 'label',\n      func: func\n    });\n    if ([entryTypes.root, entryTypes.branch, entryTypes.discard].indexOf(this.type)>=0) {\n          // display list only on  icon click\n    func = (e) => {\n          e.stopImmediatePropagation();\n          this.toggleOpen();\n     }\n    listeners.unshift({\n      name: 'click',\n      target: 'icon',\n      func: func\n    });\n    toolTip.applyTo(this.icon,'click to display children of this entry');}\n    toolTip.applyTo(this.label,'click to activate tools on this entry', () => {return (this.active!==true);});\n    return listeners;\n  }\n\n  isBranch(checkroot = true) {\n    const branchtypes = [entryTypes.branch];\n    if (checkroot && branchtypes.indexOf(entryTypes.root) < 0) branchtypes.push(entryTypes.root);\n    return (branchtypes.indexOf(this.type) >= 0)\n  }\n  isDiscarded() {\n    return ([entryTypes.discarded].indexOf(this.type) >= 0)\n  }\n  emitEvent(action = null, ev = null) {\n    const self = this;\n    const detail = {\n      entry: self,\n    }\n    if (action) detail.action = action;\n    if (ev) detail.event = ev;\n    else ev = this.eventnames.control;\n    _modules_module_event_emitter_js__WEBPACK_IMPORTED_MODULE_3__.ModuleEventEmitter.emit(this.event.name, detail, this.event.listener);\n  }\n  moveHandlers() {\n    return [{\n      name: 'dragstart',\n      func: (e) => {\n        this.handleDragStart(e);\n      }\n    }, {\n      name: 'dragend',\n      func: (e) => {\n        this.handleDragEnd(e);\n      }\n    }];\n  }\n  dropHandlers() {\n    return [{\n      name: 'dragover',\n      func: (e) => {\n        this.handleDragOver(e);\n      }\n    }, {\n      name: 'drop',\n      func: (e) => {\n        this.handleDrop(e);\n      }\n    }];\n  }\n  branchListener(callback = null) {\n    this.toggleActive();\n    if (this.isActive()) this.branchActivate(callback).then(() => {\n      this.emitEvent();\n    });\n  }\n  addListeners() {\n    const listeners = this.getListeners();\n    for (const listener of listeners) {\n      const el = (listener.target === 'label') ? this.getLabelElement() : ((listener.target=='icon')? this.icon : this.container);\n      el.addEventListener(listener.name, listener.func);\n    }\n  }\n  removeListeners(listeners) {\n    for (const listener in listeners) {\n      const el = (listener.target === 'label') ? this.getLabelElement() : this.container;\n      el.removeEventListener(listener.label, listener.func);\n    }\n  }\n  destroy() {\n    this.container.remove();\n  }\n\n  handleDragStart(e) {\n    e.stopImmediatePropagation();\n    this.container.classList.add(this.options.css.dragging);\n    e.dataTransfer.effectAllowed = 'move';\n    this.emitEvent('dragstart', e);\n  }\n  handleDragOver(e) {\n    e.stopPropagation();\n    e.preventDefault();\n    this.emitEvent('dragover', e);\n    return;\n  }\n  handleDragEnd(e) {\n    e.stopPropagation();\n    e.preventDefault();\n    this.container.classList.remove(this.options.css.dragging);\n    this.emitEvent('dragend', e);\n  }\n  resetDragOver() {\n    document.querySelectorAll('.' + this.options.css.dragover).forEach(el => {\n      el.classList.remove(this.options.css.dragover);\n    });\n  }\n  handleDrop(e) {\n    /***/\n    e.stopImmediatePropagation();\n    this.emitEvent('drop', e);\n  }\n  setWait() {\n\n    this.loaded = this.container.dataset.loaded = false;\n    this.container.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.wait);\n  }\n  setLoaded() {\n    this.container.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.wait);\n    this.loaded = this.container.dataset.loaded = true;\n  }\n  findEntry(name, type) {\n    const entries = this.getEntries();\n    for (const entry of entries) {\n      if (entry.name === name && entry.type === type) return entry;\n    }\n    return null;\n  }\n\n  async branchActivate(callback = null) {\n   /* if (!this.loaded) this.list().then(() => {\n      if (callback) callback(this);\n    });\n    else */if (callback) callback(this);\n  }\n  getCurrentPath() {\n    const current_path = (entry, branchs = []) => {\n      if (entry.name) {\n        branchs.push(entry.name);\n        entry = entry.getParent();\n        if (entry !== null) return current_path(entry, branchs);\n      }\n      return branchs;\n    }\n    let branchs = current_path(this);\n    if (branchs.length > 1) branchs = branchs.reverse();\n    return branchs;\n  }\n  async jsonEntries(response) {\n    const json = await response.json();\n    return json;\n  }\n  isDraggable() {\n    return (this.options.draggables && this.options.draggables.indexOf(this.type) >= 0);\n  }\n  async list() {\n    if (this.type === entryTypes.node) return;\n    const url = (this.getUrl) ? this.getUrl() : null;\n    if (url === null) return;\n    const tag = this.options.tags.tag;\n    const subtag = this.options.tags.subtag;\n    this.setWait();\n    this.removeEntries();\n    const fetchoptions = {\n      headers: new Headers({\n        'content-type': 'application/json'\n      })\n    };\n    const response = await fetch(url, (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.fetchSettings)(fetchoptions));\n    if (response.ok) {\n      const entries = await this.jsonEntries(response);\n\n      if (entries.length) {\n        let nodes = [],\n          branches = [];\n        while (entries.length > 0) {\n          const entry = entries.shift();\n          if (entry.children === false) {\n            nodes.push(entry);\n          } else {\n            branches.push(entry);\n          }\n        };\n        nodes.sort((a, b) => (a.name < b.name));\n        branches.sort((a, b) => (a.name < b.name));\n        this.createListEntries([branches, nodes]);\n      }\n      this.setLoaded();\n    } else {\n      _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_2__.AlertBox.addMessage({\n        parent: this.container,\n        type: \"error\",\n        content: response.error + ' ' + response.text\n      })\n    }\n\n  }\n  moveTo(dest) {\n    const branches = dest.getCurrentPath();\n    const type = (dest.type === entryTypes.discard) ? entryTypes.discarded : dest.type;\n    branches.pop();\n    branches.forEach((branch, index) => {\n      let subdest = dest.findEntry(branch, type);\n      if (subdest === null) {\n        subdest = dest.createEntry({\n          type: type,\n          name: branch\n        });\n      }\n      dest = subdest;\n    });\n    if (dest.findEntry(this.name, this.type) === null) {\n      this.from = this.parent;\n      dest.appendEntry(this);\n    }\n  }\n  unMove() {\n    if (this.from) {\n      this.moveTo(this.from);\n      this.from = null;\n    }\n  }\n}\nfunction EntryControls(container = document, options = {}) {\n  const eventnames = {\n    control: 'control',\n    error: 'error',\n  }\n  const controloptions = {\n    selectors: {\n      typentries: '[data-typentries]',\n      hascontrols: '.has-controls',\n    },\n    controls: {\n      list: {\n        action: 'list',\n        typentries: ['B', 'T']\n      },\n    },\n    css: {\n      entrycontrols: 'entrycontrols',\n      entries: '.entries',\n    }\n  };\n  let box, activentry = null;\n  options = Object.assign(controloptions, options);\n  init();\n\n  function init() {\n    createControls();\n    initEvents();\n  }\n\n  function addControl(control, position = null, action = null) {\n\n    const ctrl = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)('span', (control.class)?{class:control.class}:{});\n    const l = box.children.length;\n    if (position === null || l < position + 1) box.append(ctrl);\n    else if (position === 0 || l === 0) box.prepend(ctrl);\n    else box.inserBefore(crtl, box.children[position]);\n    if (control.typentries) ctrl.dataset.typentries = control.typentries;\n    if (control.icon) {\n      const icon = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)('i', {\n        class: ['icon', control.icon]\n      }, ctrl);\n      toolTip.applyTo(ctrl, control.text);\n    } else ctrl.textContent = control.text;\n    //add listener\n    const evt = (control.trigger) ? control.trigger : 'click';\n    const func = (e) => {\n      if (activentry === null) return;\n      const detail = {\n        callback: () => {\n          console.log('done', control.action);\n        }\n      }\n\n      if (!activentry[control.action] && action !== null) {\n        action(activentry);\n      } else if (activentry[control.action]) activentry[control.action](detail);\n      if (control.callback)  control.callback(e);\n    };\n    ctrl.addEventListener(evt, func);\n    //\n    control.ctrl = ctrl;\n   }\n\n  function createControls() {\n    box = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)('div', {\n      class: [options.css.entrycontrols, _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide]\n    });\n    Object.values(options.controls).filter(control => (control.icon || control.text)).forEach(control => {\n      addControl(control);\n    });\n  }\n\n  function initEvents() {}\n\n  function detachControls() {\n    if (activentry === null) return;\n    activentry.container.classList.remove(options.selectors.hascontrols.substr(1));\n    box.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n    box.disabled = true;\n    container.append(box);\n    activentry = null;\n  }\n\n  function attachControls(entry) {\n\n    detachControls();\n    activentry = entry;\n    activentry.container.prepend(box);\n    activentry.container.classList.add(options.selectors.hascontrols.substr(1));\n    activateControls();\n    box.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n    delete box.disabled;\n  }\n\n  function showControls(show = true) {\n    if (show === true) box.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n    else box.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n    box.disabled = !show;\n  }\n\n  function activateControl(control, isdiscarded = false) {\n    const ctrl = control.ctrl;\n    if (control.exclude && activentry !==null && control.exclude.indexOf(activentry.name)>=0) {ctrl.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);return;}\n    const typentries = (ctrl.dataset.typentries) ? ctrl.dataset.typentries.split(',') : [];\n    const type = (isdiscarded) ? entryTypes.discarded : (activentry)?activentry.container.dataset.type:null;\n    if (typentries.indexOf(type) >= 0) {\n      ctrl.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n    } else ctrl.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n  }\n\n  function activateControls() {\n    if (activentry === null) return;\n    // add btns\n    const isdiscarded = activentry.isDiscarded();\n     Object.values(options.controls).filter(control => (control.icon || control.text)).forEach(control => {\n     activateControl(control, isdiscarded);\n    });\n    //\n  }\n  return {\n    options,\n    addControl,\n    attachControls,\n    detachControls,\n    showControls,\n    activateControls,\n    activateControl\n  }\n}\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvbW9kdWxlcy9lbnRyeS5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFNNkI7QUFHUztBQUdMO0FBR1c7QUFDRTtBQUM5QyxjQUFjLDREQUFPO0FBQ2Q7QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNNO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBOztBQUVPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7O0FBR0EsaUNBQWlDO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQSxnQkFBZ0IsZ0VBQWE7O0FBRTdCLHdCQUF3QjtBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsNkRBQVU7QUFDekI7QUFDQTtBQUNBLEtBQUs7QUFDTCxrQkFBa0Isb0JBQW9CLEVBQUUsVUFBVTtBQUNsRCxpR0FBaUcsNkRBQVUsU0FBUyxnQkFBZ0I7QUFDcEksaUJBQWlCLDZEQUFVO0FBQzNCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0I7QUFDaEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsNkRBQVU7QUFDdkI7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSyxHQUFHOztBQUVSOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSwrRUFBK0UsNkJBQTZCO0FBQzVHO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJLGdGQUFrQjtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsaUNBQWlDLDJEQUFHO0FBQ3BDO0FBQ0E7QUFDQSxvQ0FBb0MsMkRBQUc7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQSxzQ0FBc0MsZ0VBQWE7QUFDbkQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVk7QUFDWjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOLE1BQU0sMkRBQVE7QUFDZDtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPLHlEQUF5RDtBQUNoRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBLGlCQUFpQiw2REFBVSwwQkFBMEIsb0JBQW9CLEdBQUc7QUFDNUU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CLDZEQUFVO0FBQzdCO0FBQ0EsT0FBTztBQUNQO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLFVBQVUsNkRBQVU7QUFDcEIseUNBQXlDLDJEQUFHO0FBQzVDLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQiwyREFBRztBQUN6QjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCLDJEQUFHO0FBQzVCO0FBQ0E7O0FBRUE7QUFDQSw0Q0FBNEMsMkRBQUc7QUFDL0MsMkJBQTJCLDJEQUFHO0FBQzlCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLCtGQUErRixtQkFBbUIsMkRBQUcsT0FBTztBQUM1SDtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsMkRBQUc7QUFDL0IsTUFBTSx3QkFBd0IsMkRBQUc7QUFDakM7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vc3JjL21vZHVsZXMvZW50cnkuanM/MmRiOSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBjcmVhdGVfYm94LFxuICBkaXJzZXBhcmF0b3IsXG4gIHVybHNlcGFyYXRvcixcbiAgZmV0Y2hTZXR0aW5ncyxcbiAgZ2VuZXJhdGVfdXVpZFxufSBmcm9tICcuLi9tb2R1bGVzL3V0aWxzLmpzJztcbmltcG9ydCB7XG4gIGNzc1xufSBmcm9tICcuLi9tb2R1bGVzL21vZHVsZXMtY29uZmlnLmpzJztcbmltcG9ydCB7XG4gIEFsZXJ0Qm94XG59IGZyb20gJy4uL21vZHVsZXMvYWxlcnQtYm94LmpzJztcbmltcG9ydCB7XG4gIE1vZHVsZUV2ZW50RW1pdHRlclxufSBmcm9tICcuLi9tb2R1bGVzL21vZHVsZS1ldmVudC1lbWl0dGVyLmpzJztcbmltcG9ydCB7VG9vbFRpcH0gZnJvbSAnLi4vbW9kdWxlcy90b29sdGlwLmpzJztcbmNvbnN0IHRvb2xUaXA9VG9vbFRpcCgpO1xuZXhwb3J0IGNvbnN0IGVudHJ5VHlwZXMgPSBPYmplY3QuZnJlZXplKHtcbiAgbm9kZTogXCJOXCIsXG4gIGJyYW5jaDogXCJCXCIsXG4gIHJvb3Q6IFwiUlwiLFxuICBkaXNjYXJkOiBcIkRcIixcbiAgZGlzY2FyZGVkOiBcIlhcIlxufSk7XG5leHBvcnQgY29uc3QgZW50cnlPcHRpb25zID0ge1xuICBzZWxlY3RvcjogJ1tkYXRhLW5hbWVdJyxcbiAgdGFnczoge1xuICAgIHRhZzogJ3VsJyxcbiAgICBzdWJ0YWc6ICdsaScsXG4gICAgbGFiZWw6ICdzcGFuJ1xuICB9LFxuICBzZWxlY3RvcnM6IHtcbiAgICBlbnRyaWVzOiAnLmVudHJpZXMnXG4gIH0sXG4gIGRyYWdnYWJsZXM6IFtdLFxuICBwcmVmaXg6IGBlbnRyeWAsXG4gIGNzczoge1xuICAgIG9uOiAnb24nLFxuICAgIGVudHJ5TjogJ2VudHJ5TicsXG4gICAgZW50cnlCOiAnZW50cnlCJyxcbiAgICBlbnRyeVI6ICdlbnRyeVInLFxuICAgIGVudHJ5RDogJ2VudHJ5RCcsXG4gICAgZWRpdGFibGU6ICdlZGl0YWJsZScsXG4gICAgZHJhZ2dpbmc6ICdkcmFnZ2luZycsXG4gICAgZHJhZ292ZXI6ICdkcmFnb3ZlcicsXG4gICAgZHJhZ2l0ZW06ICdkcmFnaXRlbScsXG4gICAgc2VsZWN0ZWQ6ICdzZWxlY3RlZCcsXG4gIH0sXG4gIGV2ZW50OiB7XG4gICAgbmFtZTogJ2V2ZW50RW50cnknXG4gIH1cbn07XG5cbmV4cG9ydCBjbGFzcyBFbnRyeSB7XG4gIGV2ZW50bmFtZXMgPSB7XG4gICAgYXR0YWNoOiAnYXR0YWNoJyxcbiAgICBjb250cm9sOiAnY29udHJvbCdcbiAgfTtcbiAgbmFtZTtcbiAgdHlwZTtcbiAgbGFiZWw7XG4gIGVudHJpZXMgPSBbXTtcbiAgZXZlbnQgPSB7XG4gICAgbGlzdGVuZXI6IHdpbmRvdyxcbiAgICBuYW1lOiBlbnRyeU9wdGlvbnMuZXZlbnQubmFtZSxcbiAgICBpbml0OiB7XG4gICAgICBidWJibGVzOiBmYWxzZSxcbiAgICAgIGNhbmNlbGFibGU6IHRydWVcbiAgICB9LFxuICB9O1xuXG5cbiAgY29uc3RydWN0b3IoZW50cnksIG9wdGlvbnMgPSB7fSkge1xuICAgIHRoaXMubmFtZSA9IGVudHJ5Lm5hbWU7XG4gICAgdGhpcy50eXBlID0gZW50cnkudHlwZTtcbiAgICB0aGlzLmlkID0gZW50cnkuaWQ7XG4gICAgdGhpcy5wYXJlbnQgPSBlbnRyeS5wYXJlbnQ7XG4gICAgdGhpcy5vcHRpb25zID0geyAuLi5lbnRyeU9wdGlvbnMsXG4gICAgICAuLi5vcHRpb25zXG4gICAgfTtcbiAgICB0aGlzLnV1aWQgPSBnZW5lcmF0ZV91dWlkKCk7XG5cbiAgICB0aGlzLmV2ZW50bmFtZXMgPSB7IC4uLnRoaXMuZXZlbnRuYW1lcyxcbiAgICAgIC4uLnRoaXMub3B0aW9ucy5ldmVudG5hbWVzXG4gICAgfTtcbiAgICB0aGlzLmxhYmVsID0gKG9wdGlvbnMubGFiZWwpID8gb3B0aW9ucy5sYWJlbCA6IG51bGw7XG4gICAgdGhpcy5ldmVudCA9IHtcbiAgICAgIG5hbWU6IGVudHJ5T3B0aW9ucy5ldmVudC5uYW1lLFxuICAgICAgbGlzdGVuZXI6IChvcHRpb25zLmxpc3RlbmVyKSA/IG9wdGlvbnMubGlzdGVuZXIgOiB0aGlzLnV1aWRcbiAgICB9O1xuICAgIHRoaXMuaW5pdChlbnRyeSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbiAgaW5pdChlbnRyeSkge1xuICAgIGNvbnN0IGRhdGFzZXQgPSB7XG4gICAgICBuYW1lOiB0aGlzLm5hbWUsXG4gICAgICB0eXBlOiB0aGlzLnR5cGVcbiAgICB9XG4gICAgaWYgKHRoaXMubGFiZWwgIT09IG51bGwpIGRhdGFzZXQubGFiZWwgPSB0aGlzLmxhYmVsO1xuICAgIGNvbnN0IGVsID0gY3JlYXRlX2JveCh0aGlzLm9wdGlvbnMudGFncy5zdWJ0YWcsIHtcbiAgICAgIGRyYWdnYWJsZTogdGhpcy5pc0RyYWdnYWJsZSgpLFxuICAgICAgZGF0YXNldDogZGF0YXNldCxcbiAgICB9KTtcbiAgICBjb25zdCBjbCA9IGAke3RoaXMub3B0aW9ucy5wcmVmaXh9JHt0aGlzLnR5cGV9YDtcbiAgICBpZihbZW50cnlUeXBlcy5icmFuY2gsZW50cnlUeXBlcy5yb290LGVudHJ5VHlwZXMuZGlzY2FyZF0uaW5kZXhPZih0aGlzLnR5cGUpPj0wICkgdGhpcy5pY29uPSBjcmVhdGVfYm94KCdzcGFuJyx7Y2xhc3M6J2ljby0nK2NsfSxlbCk7XG4gICAgdGhpcy5sYWJlbCA9IGNyZWF0ZV9ib3godGhpcy5vcHRpb25zLnRhZ3MubGFiZWwsIHtcbiAgICAgIGNsYXNzOiBjbCxcbiAgICAgIHRleHQ6IChlbnRyeS5sYWJlbCkgPyBlbnRyeS5sYWJlbCA6IGVudHJ5Lm5hbWVcbiAgICB9LCBlbCk7XG4gICAgdGhpcy5jb250YWluZXIgPSBlbDtcbiAgICB0aGlzLmxvYWRlZCA9IHRoaXMuY29udGFpbmVyLmRhdGFzZXQubG9hZGVkID0gZmFsc2U7XG4gICAgdGhpcy5pbml0RXZlbnRzKCk7XG4gIH1cbiAgaW5pdEV2ZW50cygpIHt0aGlzLmFkZExpc3RlbmVycygpO31cbiAgZ2V0UGFyZW50KCkge1xuICAgIHJldHVybiB0aGlzLnBhcmVudDtcbiAgfVxuICBnZXRMYWJlbEVsZW1lbnQoKSB7XG4gICAgcmV0dXJuIHRoaXMubGFiZWw7XG4gIH1cbiAgZ2V0UGFyZW50RWxlbWVudCgpIHtcbiAgICByZXR1cm4gdGhpcy5jb250YWluZXIucGFyZW50RWxlbWVudC5jbG9zZXN0KHRoaXMub3B0aW9ucy5zZWxlY3Rvcik7XG4gIH1cblxuICBnZXRFbnRyaWVzKCkge1xuICAgIHJldHVybiB0aGlzLmVudHJpZXM7XG4gIH1cbiAgZ2V0RW50cmllc0VsZW1lbnQoY3JlYXRlID0gZmFsc2UpIHtcbiAgICBsZXQgZW50cmllcyA9IHRoaXMuY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IodGhpcy5vcHRpb25zLnNlbGVjdG9ycy5lbnRyaWVzKTtcbiAgICBpZiAoY3JlYXRlICYmIGVudHJpZXMgPT09IG51bGwpIHtcbiAgICAgIHJldHVybiBjcmVhdGVfYm94KHRoaXMub3B0aW9ucy50YWdzLnRhZywge1xuICAgICAgICBjbGFzczogdGhpcy5vcHRpb25zLnNlbGVjdG9ycy5lbnRyaWVzLnN1YnN0cigxKVxuICAgICAgfSwgdGhpcy5jb250YWluZXIpO1xuICAgIH1cbiAgICByZXR1cm4gZW50cmllcztcbiAgfVxuXG4gIGFwcGVuZEVudHJ5KGVudHJ5KSB7XG4gICAgaWYgKGVudHJ5LnBhcmVudCAmJiBlbnRyeS5wYXJlbnQuZW50cmllcykge1xuICAgICAgY29uc3QgbiA9IGVudHJ5LnBhcmVudC5lbnRyaWVzLmluZGV4T2YoZW50cnkpO1xuICAgICAgZGVsZXRlIGVudHJ5LnBhcmVudC5lbnRyaWVzW25dO1xuICAgIH1cbiAgICBlbnRyeS5wYXJlbnQgPSB0aGlzO1xuICAgIHRoaXMuZW50cmllcy5wdXNoKGVudHJ5KTtcbiAgICBjb25zdCBwYXJlbnQgPSB0aGlzLmdldEVudHJpZXNFbGVtZW50KHRydWUpO1xuICAgIHBhcmVudC5hcHBlbmQoZW50cnkuY29udGFpbmVyKTtcbiAgICByZXR1cm4gZW50cnk7XG4gIH1cbiAgLyogd2hlbiBleHRlbmRlZCAqL1xuICBuZXdFbnRyeShlbnRyeSkge1xuICAgIHJldHVybiBuZXcgRW50cnkoZW50cnksIHRoaXMub3B0aW9ucyk7XG4gIH1cbiAgLyoqIGV4dHJhIGF0dHIgLCBzdHlsZXMgLCB0eXBlcyAgKi9cbiAgc2V0QXR0cmlidXRlcyhlbnRyeSkge1xuICAgIHJldHVybiBlbnRyeTtcbiAgfVxuICBleHRyYVN0eWxlcyhlbnRyeSkge31cbiAgc2V0RGlzY2FyZCgpIHt9XG4gIC8qZW5kIGV4dHJhIGF0dHIgLCBzdHlsZXMgLCB0eXBlcyAgKi9cbiAgY3JlYXRlRW50cnkoZW50cnkpIHtcbiAgICB0aGlzLm9wdGlvbnMuY3NzLmljb25zID0gW107XG4gICAgZW50cnkgPSB0aGlzLnNldEF0dHJpYnV0ZXMoZW50cnkpO1xuICAgIHRoaXMuZXh0cmFTdHlsZXMoZW50cnkpO1xuICAgIGNvbnN0IG5ld19lbnRyeSA9IHRoaXMubmV3RW50cnkoZW50cnksIHRoaXMub3B0aW9ucyk7XG4gICAgdGhpcy5hcHBlbmRFbnRyeShuZXdfZW50cnkpO1xuICAgIG5ld19lbnRyeS5hZGRMaXN0ZW5lcnMoKTtcbiAgICBuZXdfZW50cnkuc2V0RGlzY2FyZCgpO1xuICAgIHJldHVybiBuZXdfZW50cnk7XG4gIH1cbiAgZmluZEVudHJ5KG5hbWUpIHtcbiAgICBjb25zdCBlbnRyaWVzID0gdGhpcy5nZXRFbnRyaWVzKCk7XG4gICAgZm9yIChjb25zdCBlbnRyeSBvZiBlbnRyaWVzKSB7XG4gICAgICBpZiAoZW50cnkubmFtZSA9PT0gbmFtZSkgcmV0dXJuIGVudHJ5O1xuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICAvL1xuICBjcmVhdGVMaXN0RW50cmllcyhsaXN0ZW50cmllcykge1xuICAgIGNvbnN0IGRpcmVudHJ5ID0gdGhpcy5nZXRFbnRyaWVzRWxlbWVudCh0cnVlKTtcbiAgICBsaXN0ZW50cmllcy5mb3JFYWNoKGVudHJpZXMgPT4ge1xuICAgICAgZW50cmllcy5mb3JFYWNoKChlbnRyeSkgPT4ge1xuICAgICAgICBjb25zdCBuZXdfZW50cnkgPSB0aGlzLmNyZWF0ZUVudHJ5KGVudHJ5KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG4gIHJlbW92ZUVudHJpZXMoKSB7XG4gICAgdGhpcy5lbnRyaWVzID0gW107XG4gICAgY29uc3QgZWwgPSB0aGlzLmdldEVudHJpZXNFbGVtZW50KCk7XG4gICAgaWYgKGVsKSBlbC5yZW1vdmUoKTtcbiAgfVxuICBpc0FjdGl2ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5hY3RpdmU7XG4gIH1cblxuICB0b2dnbGVBY3RpdmUoKSB7XG4gICAgdGhpcy5zZXRPbighdGhpcy5hY3RpdmUpO1xuICAgIH1cblxuICB0b2dnbGVPcGVuKCkge1xuICAgIHRoaXMuc2V0T3BlbighdGhpcy5vcGVuKTtcbiAgfVxuXG4gIHNldFNlbGVjdGVkKHNlbGVjdGVkID0gdHJ1ZSkge1xuICAgIGNvbnN0IGNsID0gdGhpcy5vcHRpb25zLmNzcy5zZWxlY3RlZDtcbiAgICBpZiAoc2VsZWN0ZWQgPT09IHRydWUpIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoY2wpO1xuICAgIGVsc2UgdGhpcy5jb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZShjbCk7XG4gICAgdGhpcy5zZXRPbihzZWxlY3RlZCk7XG4gIH1cbiAgc2V0T24ob24gPSB0cnVlKSB7XG4gICAgdGhpcy5hY3RpdmUgPSBvbjtcbiAgfVxuXG4gIHNldE9wZW4ob24gPSB0cnVlKSB7XG4gIGNvbnN0IHNldF9vcGVuPSAoKSA9PiB7XG4gICAgdGhpcy5vcGVuID0gb247XG4gICAgaWYgKG9uID09PSB0cnVlKSB0aGlzLmNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKHRoaXMub3B0aW9ucy5jc3Mub24pO1xuICAgIGVsc2UgdGhpcy5jb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLm9wdGlvbnMuY3NzLm9uKTt9XG4gICAgaWYgKCF0aGlzLmxvYWRlZCAmJiBvbikgIHRoaXMubGlzdCgpLnRoZW4oKCkgPT4ge1xuICAgICAgICBzZXRfb3BlbigpO1xuICAgIH0pOyBlbHNlIHNldF9vcGVuKCk7XG5cbiAgfVxuXG4gIHNldE9mZigpIHtcbiAgICB0aGlzLnNldFNlbGVjdGVkKGZhbHNlKTtcbiAgfVxuICBnZXRMaXN0ZW5lcnMoKSB7XG4gICAgbGV0IGxpc3RlbmVycyA9IFtdO1xuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuICAgIGxldCBmdW5jO1xuICAgICAgaWYgKHRoaXMudHlwZSA9PT0gZW50cnlUeXBlcy5ub2RlICApIHtcbiAgICAgICAgZnVuYyA9IChlKSA9PiB7XG4gICAgICAgICAgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICB0aGlzLnRvZ2dsZUFjdGl2ZSgpO1xuICAgICAgICAgIHRoaXMuZW1pdEV2ZW50KCk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICBmdW5jID0gKGUpID0+IHtcbiAgICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG4gICAgICB0aGlzLmJyYW5jaExpc3RlbmVyKCgpID0+IHtcbiAgICAgICAgdGhpcy5lbWl0RXZlbnQodGhpcy5ldmVudG5hbWVzLmF0dGFjaCk7XG4gICAgICB9KTtcbiAgICB9O31cbiAgICBsaXN0ZW5lcnMudW5zaGlmdCh7XG4gICAgICBuYW1lOiAnY2xpY2snLFxuICAgICAgdGFyZ2V0OiAnbGFiZWwnLFxuICAgICAgZnVuYzogZnVuY1xuICAgIH0pO1xuICAgIGlmIChbZW50cnlUeXBlcy5yb290LCBlbnRyeVR5cGVzLmJyYW5jaCwgZW50cnlUeXBlcy5kaXNjYXJkXS5pbmRleE9mKHRoaXMudHlwZSk+PTApIHtcbiAgICAgICAgICAvLyBkaXNwbGF5IGxpc3Qgb25seSBvbiAgaWNvbiBjbGlja1xuICAgIGZ1bmMgPSAoZSkgPT4ge1xuICAgICAgICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgdGhpcy50b2dnbGVPcGVuKCk7XG4gICAgIH1cbiAgICBsaXN0ZW5lcnMudW5zaGlmdCh7XG4gICAgICBuYW1lOiAnY2xpY2snLFxuICAgICAgdGFyZ2V0OiAnaWNvbicsXG4gICAgICBmdW5jOiBmdW5jXG4gICAgfSk7XG4gICAgdG9vbFRpcC5hcHBseVRvKHRoaXMuaWNvbiwnY2xpY2sgdG8gZGlzcGxheSBjaGlsZHJlbiBvZiB0aGlzIGVudHJ5Jyk7fVxuICAgIHRvb2xUaXAuYXBwbHlUbyh0aGlzLmxhYmVsLCdjbGljayB0byBhY3RpdmF0ZSB0b29scyBvbiB0aGlzIGVudHJ5JywgKCkgPT4ge3JldHVybiAodGhpcy5hY3RpdmUhPT10cnVlKTt9KTtcbiAgICByZXR1cm4gbGlzdGVuZXJzO1xuICB9XG5cbiAgaXNCcmFuY2goY2hlY2tyb290ID0gdHJ1ZSkge1xuICAgIGNvbnN0IGJyYW5jaHR5cGVzID0gW2VudHJ5VHlwZXMuYnJhbmNoXTtcbiAgICBpZiAoY2hlY2tyb290ICYmIGJyYW5jaHR5cGVzLmluZGV4T2YoZW50cnlUeXBlcy5yb290KSA8IDApIGJyYW5jaHR5cGVzLnB1c2goZW50cnlUeXBlcy5yb290KTtcbiAgICByZXR1cm4gKGJyYW5jaHR5cGVzLmluZGV4T2YodGhpcy50eXBlKSA+PSAwKVxuICB9XG4gIGlzRGlzY2FyZGVkKCkge1xuICAgIHJldHVybiAoW2VudHJ5VHlwZXMuZGlzY2FyZGVkXS5pbmRleE9mKHRoaXMudHlwZSkgPj0gMClcbiAgfVxuICBlbWl0RXZlbnQoYWN0aW9uID0gbnVsbCwgZXYgPSBudWxsKSB7XG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgY29uc3QgZGV0YWlsID0ge1xuICAgICAgZW50cnk6IHNlbGYsXG4gICAgfVxuICAgIGlmIChhY3Rpb24pIGRldGFpbC5hY3Rpb24gPSBhY3Rpb247XG4gICAgaWYgKGV2KSBkZXRhaWwuZXZlbnQgPSBldjtcbiAgICBlbHNlIGV2ID0gdGhpcy5ldmVudG5hbWVzLmNvbnRyb2w7XG4gICAgTW9kdWxlRXZlbnRFbWl0dGVyLmVtaXQodGhpcy5ldmVudC5uYW1lLCBkZXRhaWwsIHRoaXMuZXZlbnQubGlzdGVuZXIpO1xuICB9XG4gIG1vdmVIYW5kbGVycygpIHtcbiAgICByZXR1cm4gW3tcbiAgICAgIG5hbWU6ICdkcmFnc3RhcnQnLFxuICAgICAgZnVuYzogKGUpID0+IHtcbiAgICAgICAgdGhpcy5oYW5kbGVEcmFnU3RhcnQoZSk7XG4gICAgICB9XG4gICAgfSwge1xuICAgICAgbmFtZTogJ2RyYWdlbmQnLFxuICAgICAgZnVuYzogKGUpID0+IHtcbiAgICAgICAgdGhpcy5oYW5kbGVEcmFnRW5kKGUpO1xuICAgICAgfVxuICAgIH1dO1xuICB9XG4gIGRyb3BIYW5kbGVycygpIHtcbiAgICByZXR1cm4gW3tcbiAgICAgIG5hbWU6ICdkcmFnb3ZlcicsXG4gICAgICBmdW5jOiAoZSkgPT4ge1xuICAgICAgICB0aGlzLmhhbmRsZURyYWdPdmVyKGUpO1xuICAgICAgfVxuICAgIH0sIHtcbiAgICAgIG5hbWU6ICdkcm9wJyxcbiAgICAgIGZ1bmM6IChlKSA9PiB7XG4gICAgICAgIHRoaXMuaGFuZGxlRHJvcChlKTtcbiAgICAgIH1cbiAgICB9XTtcbiAgfVxuICBicmFuY2hMaXN0ZW5lcihjYWxsYmFjayA9IG51bGwpIHtcbiAgICB0aGlzLnRvZ2dsZUFjdGl2ZSgpO1xuICAgIGlmICh0aGlzLmlzQWN0aXZlKCkpIHRoaXMuYnJhbmNoQWN0aXZhdGUoY2FsbGJhY2spLnRoZW4oKCkgPT4ge1xuICAgICAgdGhpcy5lbWl0RXZlbnQoKTtcbiAgICB9KTtcbiAgfVxuICBhZGRMaXN0ZW5lcnMoKSB7XG4gICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5nZXRMaXN0ZW5lcnMoKTtcbiAgICBmb3IgKGNvbnN0IGxpc3RlbmVyIG9mIGxpc3RlbmVycykge1xuICAgICAgY29uc3QgZWwgPSAobGlzdGVuZXIudGFyZ2V0ID09PSAnbGFiZWwnKSA/IHRoaXMuZ2V0TGFiZWxFbGVtZW50KCkgOiAoKGxpc3RlbmVyLnRhcmdldD09J2ljb24nKT8gdGhpcy5pY29uIDogdGhpcy5jb250YWluZXIpO1xuICAgICAgZWwuYWRkRXZlbnRMaXN0ZW5lcihsaXN0ZW5lci5uYW1lLCBsaXN0ZW5lci5mdW5jKTtcbiAgICB9XG4gIH1cbiAgcmVtb3ZlTGlzdGVuZXJzKGxpc3RlbmVycykge1xuICAgIGZvciAoY29uc3QgbGlzdGVuZXIgaW4gbGlzdGVuZXJzKSB7XG4gICAgICBjb25zdCBlbCA9IChsaXN0ZW5lci50YXJnZXQgPT09ICdsYWJlbCcpID8gdGhpcy5nZXRMYWJlbEVsZW1lbnQoKSA6IHRoaXMuY29udGFpbmVyO1xuICAgICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcihsaXN0ZW5lci5sYWJlbCwgbGlzdGVuZXIuZnVuYyk7XG4gICAgfVxuICB9XG4gIGRlc3Ryb3koKSB7XG4gICAgdGhpcy5jb250YWluZXIucmVtb3ZlKCk7XG4gIH1cblxuICBoYW5kbGVEcmFnU3RhcnQoZSkge1xuICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG4gICAgdGhpcy5jb250YWluZXIuY2xhc3NMaXN0LmFkZCh0aGlzLm9wdGlvbnMuY3NzLmRyYWdnaW5nKTtcbiAgICBlLmRhdGFUcmFuc2Zlci5lZmZlY3RBbGxvd2VkID0gJ21vdmUnO1xuICAgIHRoaXMuZW1pdEV2ZW50KCdkcmFnc3RhcnQnLCBlKTtcbiAgfVxuICBoYW5kbGVEcmFnT3ZlcihlKSB7XG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgdGhpcy5lbWl0RXZlbnQoJ2RyYWdvdmVyJywgZSk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGhhbmRsZURyYWdFbmQoZSkge1xuICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5vcHRpb25zLmNzcy5kcmFnZ2luZyk7XG4gICAgdGhpcy5lbWl0RXZlbnQoJ2RyYWdlbmQnLCBlKTtcbiAgfVxuICByZXNldERyYWdPdmVyKCkge1xuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy4nICsgdGhpcy5vcHRpb25zLmNzcy5kcmFnb3ZlcikuZm9yRWFjaChlbCA9PiB7XG4gICAgICBlbC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMub3B0aW9ucy5jc3MuZHJhZ292ZXIpO1xuICAgIH0pO1xuICB9XG4gIGhhbmRsZURyb3AoZSkge1xuICAgIC8qKiovXG4gICAgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcbiAgICB0aGlzLmVtaXRFdmVudCgnZHJvcCcsIGUpO1xuICB9XG4gIHNldFdhaXQoKSB7XG5cbiAgICB0aGlzLmxvYWRlZCA9IHRoaXMuY29udGFpbmVyLmRhdGFzZXQubG9hZGVkID0gZmFsc2U7XG4gICAgdGhpcy5jb250YWluZXIuY2xhc3NMaXN0LmFkZChjc3Mud2FpdCk7XG4gIH1cbiAgc2V0TG9hZGVkKCkge1xuICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoY3NzLndhaXQpO1xuICAgIHRoaXMubG9hZGVkID0gdGhpcy5jb250YWluZXIuZGF0YXNldC5sb2FkZWQgPSB0cnVlO1xuICB9XG4gIGZpbmRFbnRyeShuYW1lLCB0eXBlKSB7XG4gICAgY29uc3QgZW50cmllcyA9IHRoaXMuZ2V0RW50cmllcygpO1xuICAgIGZvciAoY29uc3QgZW50cnkgb2YgZW50cmllcykge1xuICAgICAgaWYgKGVudHJ5Lm5hbWUgPT09IG5hbWUgJiYgZW50cnkudHlwZSA9PT0gdHlwZSkgcmV0dXJuIGVudHJ5O1xuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGFzeW5jIGJyYW5jaEFjdGl2YXRlKGNhbGxiYWNrID0gbnVsbCkge1xuICAgLyogaWYgKCF0aGlzLmxvYWRlZCkgdGhpcy5saXN0KCkudGhlbigoKSA9PiB7XG4gICAgICBpZiAoY2FsbGJhY2spIGNhbGxiYWNrKHRoaXMpO1xuICAgIH0pO1xuICAgIGVsc2UgKi9pZiAoY2FsbGJhY2spIGNhbGxiYWNrKHRoaXMpO1xuICB9XG4gIGdldEN1cnJlbnRQYXRoKCkge1xuICAgIGNvbnN0IGN1cnJlbnRfcGF0aCA9IChlbnRyeSwgYnJhbmNocyA9IFtdKSA9PiB7XG4gICAgICBpZiAoZW50cnkubmFtZSkge1xuICAgICAgICBicmFuY2hzLnB1c2goZW50cnkubmFtZSk7XG4gICAgICAgIGVudHJ5ID0gZW50cnkuZ2V0UGFyZW50KCk7XG4gICAgICAgIGlmIChlbnRyeSAhPT0gbnVsbCkgcmV0dXJuIGN1cnJlbnRfcGF0aChlbnRyeSwgYnJhbmNocyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gYnJhbmNocztcbiAgICB9XG4gICAgbGV0IGJyYW5jaHMgPSBjdXJyZW50X3BhdGgodGhpcyk7XG4gICAgaWYgKGJyYW5jaHMubGVuZ3RoID4gMSkgYnJhbmNocyA9IGJyYW5jaHMucmV2ZXJzZSgpO1xuICAgIHJldHVybiBicmFuY2hzO1xuICB9XG4gIGFzeW5jIGpzb25FbnRyaWVzKHJlc3BvbnNlKSB7XG4gICAgY29uc3QganNvbiA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICByZXR1cm4ganNvbjtcbiAgfVxuICBpc0RyYWdnYWJsZSgpIHtcbiAgICByZXR1cm4gKHRoaXMub3B0aW9ucy5kcmFnZ2FibGVzICYmIHRoaXMub3B0aW9ucy5kcmFnZ2FibGVzLmluZGV4T2YodGhpcy50eXBlKSA+PSAwKTtcbiAgfVxuICBhc3luYyBsaXN0KCkge1xuICAgIGlmICh0aGlzLnR5cGUgPT09IGVudHJ5VHlwZXMubm9kZSkgcmV0dXJuO1xuICAgIGNvbnN0IHVybCA9ICh0aGlzLmdldFVybCkgPyB0aGlzLmdldFVybCgpIDogbnVsbDtcbiAgICBpZiAodXJsID09PSBudWxsKSByZXR1cm47XG4gICAgY29uc3QgdGFnID0gdGhpcy5vcHRpb25zLnRhZ3MudGFnO1xuICAgIGNvbnN0IHN1YnRhZyA9IHRoaXMub3B0aW9ucy50YWdzLnN1YnRhZztcbiAgICB0aGlzLnNldFdhaXQoKTtcbiAgICB0aGlzLnJlbW92ZUVudHJpZXMoKTtcbiAgICBjb25zdCBmZXRjaG9wdGlvbnMgPSB7XG4gICAgICBoZWFkZXJzOiBuZXcgSGVhZGVycyh7XG4gICAgICAgICdjb250ZW50LXR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcbiAgICAgIH0pXG4gICAgfTtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCwgZmV0Y2hTZXR0aW5ncyhmZXRjaG9wdGlvbnMpKTtcbiAgICBpZiAocmVzcG9uc2Uub2spIHtcbiAgICAgIGNvbnN0IGVudHJpZXMgPSBhd2FpdCB0aGlzLmpzb25FbnRyaWVzKHJlc3BvbnNlKTtcblxuICAgICAgaWYgKGVudHJpZXMubGVuZ3RoKSB7XG4gICAgICAgIGxldCBub2RlcyA9IFtdLFxuICAgICAgICAgIGJyYW5jaGVzID0gW107XG4gICAgICAgIHdoaWxlIChlbnRyaWVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBjb25zdCBlbnRyeSA9IGVudHJpZXMuc2hpZnQoKTtcbiAgICAgICAgICBpZiAoZW50cnkuY2hpbGRyZW4gPT09IGZhbHNlKSB7XG4gICAgICAgICAgICBub2Rlcy5wdXNoKGVudHJ5KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYnJhbmNoZXMucHVzaChlbnRyeSk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBub2Rlcy5zb3J0KChhLCBiKSA9PiAoYS5uYW1lIDwgYi5uYW1lKSk7XG4gICAgICAgIGJyYW5jaGVzLnNvcnQoKGEsIGIpID0+IChhLm5hbWUgPCBiLm5hbWUpKTtcbiAgICAgICAgdGhpcy5jcmVhdGVMaXN0RW50cmllcyhbYnJhbmNoZXMsIG5vZGVzXSk7XG4gICAgICB9XG4gICAgICB0aGlzLnNldExvYWRlZCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBBbGVydEJveC5hZGRNZXNzYWdlKHtcbiAgICAgICAgcGFyZW50OiB0aGlzLmNvbnRhaW5lcixcbiAgICAgICAgdHlwZTogXCJlcnJvclwiLFxuICAgICAgICBjb250ZW50OiByZXNwb25zZS5lcnJvciArICcgJyArIHJlc3BvbnNlLnRleHRcbiAgICAgIH0pXG4gICAgfVxuXG4gIH1cbiAgbW92ZVRvKGRlc3QpIHtcbiAgICBjb25zdCBicmFuY2hlcyA9IGRlc3QuZ2V0Q3VycmVudFBhdGgoKTtcbiAgICBjb25zdCB0eXBlID0gKGRlc3QudHlwZSA9PT0gZW50cnlUeXBlcy5kaXNjYXJkKSA/IGVudHJ5VHlwZXMuZGlzY2FyZGVkIDogZGVzdC50eXBlO1xuICAgIGJyYW5jaGVzLnBvcCgpO1xuICAgIGJyYW5jaGVzLmZvckVhY2goKGJyYW5jaCwgaW5kZXgpID0+IHtcbiAgICAgIGxldCBzdWJkZXN0ID0gZGVzdC5maW5kRW50cnkoYnJhbmNoLCB0eXBlKTtcbiAgICAgIGlmIChzdWJkZXN0ID09PSBudWxsKSB7XG4gICAgICAgIHN1YmRlc3QgPSBkZXN0LmNyZWF0ZUVudHJ5KHtcbiAgICAgICAgICB0eXBlOiB0eXBlLFxuICAgICAgICAgIG5hbWU6IGJyYW5jaFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGRlc3QgPSBzdWJkZXN0O1xuICAgIH0pO1xuICAgIGlmIChkZXN0LmZpbmRFbnRyeSh0aGlzLm5hbWUsIHRoaXMudHlwZSkgPT09IG51bGwpIHtcbiAgICAgIHRoaXMuZnJvbSA9IHRoaXMucGFyZW50O1xuICAgICAgZGVzdC5hcHBlbmRFbnRyeSh0aGlzKTtcbiAgICB9XG4gIH1cbiAgdW5Nb3ZlKCkge1xuICAgIGlmICh0aGlzLmZyb20pIHtcbiAgICAgIHRoaXMubW92ZVRvKHRoaXMuZnJvbSk7XG4gICAgICB0aGlzLmZyb20gPSBudWxsO1xuICAgIH1cbiAgfVxufVxuZXhwb3J0IGZ1bmN0aW9uIEVudHJ5Q29udHJvbHMoY29udGFpbmVyID0gZG9jdW1lbnQsIG9wdGlvbnMgPSB7fSkge1xuICBjb25zdCBldmVudG5hbWVzID0ge1xuICAgIGNvbnRyb2w6ICdjb250cm9sJyxcbiAgICBlcnJvcjogJ2Vycm9yJyxcbiAgfVxuICBjb25zdCBjb250cm9sb3B0aW9ucyA9IHtcbiAgICBzZWxlY3RvcnM6IHtcbiAgICAgIHR5cGVudHJpZXM6ICdbZGF0YS10eXBlbnRyaWVzXScsXG4gICAgICBoYXNjb250cm9sczogJy5oYXMtY29udHJvbHMnLFxuICAgIH0sXG4gICAgY29udHJvbHM6IHtcbiAgICAgIGxpc3Q6IHtcbiAgICAgICAgYWN0aW9uOiAnbGlzdCcsXG4gICAgICAgIHR5cGVudHJpZXM6IFsnQicsICdUJ11cbiAgICAgIH0sXG4gICAgfSxcbiAgICBjc3M6IHtcbiAgICAgIGVudHJ5Y29udHJvbHM6ICdlbnRyeWNvbnRyb2xzJyxcbiAgICAgIGVudHJpZXM6ICcuZW50cmllcycsXG4gICAgfVxuICB9O1xuICBsZXQgYm94LCBhY3RpdmVudHJ5ID0gbnVsbDtcbiAgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oY29udHJvbG9wdGlvbnMsIG9wdGlvbnMpO1xuICBpbml0KCk7XG5cbiAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICBjcmVhdGVDb250cm9scygpO1xuICAgIGluaXRFdmVudHMoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGFkZENvbnRyb2woY29udHJvbCwgcG9zaXRpb24gPSBudWxsLCBhY3Rpb24gPSBudWxsKSB7XG5cbiAgICBjb25zdCBjdHJsID0gY3JlYXRlX2JveCgnc3BhbicsIChjb250cm9sLmNsYXNzKT97Y2xhc3M6Y29udHJvbC5jbGFzc306e30pO1xuICAgIGNvbnN0IGwgPSBib3guY2hpbGRyZW4ubGVuZ3RoO1xuICAgIGlmIChwb3NpdGlvbiA9PT0gbnVsbCB8fCBsIDwgcG9zaXRpb24gKyAxKSBib3guYXBwZW5kKGN0cmwpO1xuICAgIGVsc2UgaWYgKHBvc2l0aW9uID09PSAwIHx8IGwgPT09IDApIGJveC5wcmVwZW5kKGN0cmwpO1xuICAgIGVsc2UgYm94Lmluc2VyQmVmb3JlKGNydGwsIGJveC5jaGlsZHJlbltwb3NpdGlvbl0pO1xuICAgIGlmIChjb250cm9sLnR5cGVudHJpZXMpIGN0cmwuZGF0YXNldC50eXBlbnRyaWVzID0gY29udHJvbC50eXBlbnRyaWVzO1xuICAgIGlmIChjb250cm9sLmljb24pIHtcbiAgICAgIGNvbnN0IGljb24gPSBjcmVhdGVfYm94KCdpJywge1xuICAgICAgICBjbGFzczogWydpY29uJywgY29udHJvbC5pY29uXVxuICAgICAgfSwgY3RybCk7XG4gICAgICB0b29sVGlwLmFwcGx5VG8oY3RybCwgY29udHJvbC50ZXh0KTtcbiAgICB9IGVsc2UgY3RybC50ZXh0Q29udGVudCA9IGNvbnRyb2wudGV4dDtcbiAgICAvL2FkZCBsaXN0ZW5lclxuICAgIGNvbnN0IGV2dCA9IChjb250cm9sLnRyaWdnZXIpID8gY29udHJvbC50cmlnZ2VyIDogJ2NsaWNrJztcbiAgICBjb25zdCBmdW5jID0gKGUpID0+IHtcbiAgICAgIGlmIChhY3RpdmVudHJ5ID09PSBudWxsKSByZXR1cm47XG4gICAgICBjb25zdCBkZXRhaWwgPSB7XG4gICAgICAgIGNhbGxiYWNrOiAoKSA9PiB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ2RvbmUnLCBjb250cm9sLmFjdGlvbik7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKCFhY3RpdmVudHJ5W2NvbnRyb2wuYWN0aW9uXSAmJiBhY3Rpb24gIT09IG51bGwpIHtcbiAgICAgICAgYWN0aW9uKGFjdGl2ZW50cnkpO1xuICAgICAgfSBlbHNlIGlmIChhY3RpdmVudHJ5W2NvbnRyb2wuYWN0aW9uXSkgYWN0aXZlbnRyeVtjb250cm9sLmFjdGlvbl0oZGV0YWlsKTtcbiAgICAgIGlmIChjb250cm9sLmNhbGxiYWNrKSAgY29udHJvbC5jYWxsYmFjayhlKTtcbiAgICB9O1xuICAgIGN0cmwuYWRkRXZlbnRMaXN0ZW5lcihldnQsIGZ1bmMpO1xuICAgIC8vXG4gICAgY29udHJvbC5jdHJsID0gY3RybDtcbiAgIH1cblxuICBmdW5jdGlvbiBjcmVhdGVDb250cm9scygpIHtcbiAgICBib3ggPSBjcmVhdGVfYm94KCdkaXYnLCB7XG4gICAgICBjbGFzczogW29wdGlvbnMuY3NzLmVudHJ5Y29udHJvbHMsIGNzcy5oaWRlXVxuICAgIH0pO1xuICAgIE9iamVjdC52YWx1ZXMob3B0aW9ucy5jb250cm9scykuZmlsdGVyKGNvbnRyb2wgPT4gKGNvbnRyb2wuaWNvbiB8fCBjb250cm9sLnRleHQpKS5mb3JFYWNoKGNvbnRyb2wgPT4ge1xuICAgICAgYWRkQ29udHJvbChjb250cm9sKTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGluaXRFdmVudHMoKSB7fVxuXG4gIGZ1bmN0aW9uIGRldGFjaENvbnRyb2xzKCkge1xuICAgIGlmIChhY3RpdmVudHJ5ID09PSBudWxsKSByZXR1cm47XG4gICAgYWN0aXZlbnRyeS5jb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZShvcHRpb25zLnNlbGVjdG9ycy5oYXNjb250cm9scy5zdWJzdHIoMSkpO1xuICAgIGJveC5jbGFzc0xpc3QuYWRkKGNzcy5oaWRlKTtcbiAgICBib3guZGlzYWJsZWQgPSB0cnVlO1xuICAgIGNvbnRhaW5lci5hcHBlbmQoYm94KTtcbiAgICBhY3RpdmVudHJ5ID0gbnVsbDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGF0dGFjaENvbnRyb2xzKGVudHJ5KSB7XG5cbiAgICBkZXRhY2hDb250cm9scygpO1xuICAgIGFjdGl2ZW50cnkgPSBlbnRyeTtcbiAgICBhY3RpdmVudHJ5LmNvbnRhaW5lci5wcmVwZW5kKGJveCk7XG4gICAgYWN0aXZlbnRyeS5jb250YWluZXIuY2xhc3NMaXN0LmFkZChvcHRpb25zLnNlbGVjdG9ycy5oYXNjb250cm9scy5zdWJzdHIoMSkpO1xuICAgIGFjdGl2YXRlQ29udHJvbHMoKTtcbiAgICBib3guY2xhc3NMaXN0LnJlbW92ZShjc3MuaGlkZSk7XG4gICAgZGVsZXRlIGJveC5kaXNhYmxlZDtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNob3dDb250cm9scyhzaG93ID0gdHJ1ZSkge1xuICAgIGlmIChzaG93ID09PSB0cnVlKSBib3guY2xhc3NMaXN0LnJlbW92ZShjc3MuaGlkZSk7XG4gICAgZWxzZSBib3guY2xhc3NMaXN0LmFkZChjc3MuaGlkZSk7XG4gICAgYm94LmRpc2FibGVkID0gIXNob3c7XG4gIH1cblxuICBmdW5jdGlvbiBhY3RpdmF0ZUNvbnRyb2woY29udHJvbCwgaXNkaXNjYXJkZWQgPSBmYWxzZSkge1xuICAgIGNvbnN0IGN0cmwgPSBjb250cm9sLmN0cmw7XG4gICAgaWYgKGNvbnRyb2wuZXhjbHVkZSAmJiBhY3RpdmVudHJ5ICE9PW51bGwgJiYgY29udHJvbC5leGNsdWRlLmluZGV4T2YoYWN0aXZlbnRyeS5uYW1lKT49MCkge2N0cmwuY2xhc3NMaXN0LmFkZChjc3MuaGlkZSk7cmV0dXJuO31cbiAgICBjb25zdCB0eXBlbnRyaWVzID0gKGN0cmwuZGF0YXNldC50eXBlbnRyaWVzKSA/IGN0cmwuZGF0YXNldC50eXBlbnRyaWVzLnNwbGl0KCcsJykgOiBbXTtcbiAgICBjb25zdCB0eXBlID0gKGlzZGlzY2FyZGVkKSA/IGVudHJ5VHlwZXMuZGlzY2FyZGVkIDogKGFjdGl2ZW50cnkpP2FjdGl2ZW50cnkuY29udGFpbmVyLmRhdGFzZXQudHlwZTpudWxsO1xuICAgIGlmICh0eXBlbnRyaWVzLmluZGV4T2YodHlwZSkgPj0gMCkge1xuICAgICAgY3RybC5jbGFzc0xpc3QucmVtb3ZlKGNzcy5oaWRlKTtcbiAgICB9IGVsc2UgY3RybC5jbGFzc0xpc3QuYWRkKGNzcy5oaWRlKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGFjdGl2YXRlQ29udHJvbHMoKSB7XG4gICAgaWYgKGFjdGl2ZW50cnkgPT09IG51bGwpIHJldHVybjtcbiAgICAvLyBhZGQgYnRuc1xuICAgIGNvbnN0IGlzZGlzY2FyZGVkID0gYWN0aXZlbnRyeS5pc0Rpc2NhcmRlZCgpO1xuICAgICBPYmplY3QudmFsdWVzKG9wdGlvbnMuY29udHJvbHMpLmZpbHRlcihjb250cm9sID0+IChjb250cm9sLmljb24gfHwgY29udHJvbC50ZXh0KSkuZm9yRWFjaChjb250cm9sID0+IHtcbiAgICAgYWN0aXZhdGVDb250cm9sKGNvbnRyb2wsIGlzZGlzY2FyZGVkKTtcbiAgICB9KTtcbiAgICAvL1xuICB9XG4gIHJldHVybiB7XG4gICAgb3B0aW9ucyxcbiAgICBhZGRDb250cm9sLFxuICAgIGF0dGFjaENvbnRyb2xzLFxuICAgIGRldGFjaENvbnRyb2xzLFxuICAgIHNob3dDb250cm9scyxcbiAgICBhY3RpdmF0ZUNvbnRyb2xzLFxuICAgIGFjdGl2YXRlQ29udHJvbFxuICB9XG59Il0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/modules/entry.js\n")},"./src/modules/tooltip.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ToolTip: () => (/* binding */ ToolTip)\n/* harmony export */ });\n/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! dompurify */ \"./node_modules/dompurify/dist/purify.es.mjs\");\n/* harmony import */ var _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../modules/modules-config.js */ \"./src/modules/modules-config.js\");\n/* harmony import */ var _modules_utils_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../modules/utils.js */ \"./src/modules/utils.js\");\n\n\n\n\nfunction ToolTip() {\nconst uuid=(0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_2__.generate_uuid)();\n    const tip = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_2__.create_box)('div', {\n            id: uuid,\n            text: \"\",\n            class: _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.tooltip\n          },document.body);\n  function computePosition( item, tip, options={placement:'bottom-start',offset:{x:2,y:2}}) {\n    const rect = item.getBoundingClientRect();\n    const placement=options.placement.split('-');\n    let y=parseInt(rect.top);\n    switch(placement[0]) {\n        case 'bottom':\n            y+=parseInt(rect.height);\n        break;\n        case 'center':\n            y+=Math.round(parseInt(rect.height)/2);\n        break;\n    }\n    let x=parseInt(rect.left);\n    switch(placement[1]) {\n        case 'center':\n        x+=Math.round(parseInt(rect.width)/2);\n        break;\n        case 'end':\n        x+=parseInt(rect.width);\n        break;\n    }\n    Object.assign(tip.style, {\n    left: `${x}px`,\n    top: `${y}px`,\n    });\n  }\n  function applyTo(item,text,check=null) {\n          item.addEventListener('mouseenter', () => {\n          if(check!==null && !check()) return;\n          computePosition(item, tip, {\n            placement: 'top-center',\n          });\n          setTimeout(function() {tip.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n          tip.textContent=text;},100);\n        });\n        item.addEventListener('mouseout', () => {\n            if(check!==null && !check()) return;\n          setTimeout(function() { tip.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n          tip.textContent=\"\";},600);\n        });\n  }\n  return {applyTo};\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvbW9kdWxlcy90b29sdGlwLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBa0M7QUFHSTtBQUlUOztBQUV0QjtBQUNQLFdBQVcsZ0VBQWE7QUFDeEIsZ0JBQWdCLDZEQUFVO0FBQzFCO0FBQ0E7QUFDQSxtQkFBbUIsMkRBQUc7QUFDdEIsV0FBVztBQUNYLGdEQUFnRCxpQ0FBaUMsU0FBUztBQUMxRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhLEVBQUU7QUFDZixZQUFZLEVBQUU7QUFDZCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYLGlDQUFpQyxxQkFBcUIsMkRBQUc7QUFDekQsZ0NBQWdDO0FBQ2hDLFNBQVM7QUFDVDtBQUNBO0FBQ0Esa0NBQWtDLGtCQUFrQiwyREFBRztBQUN2RCw4QkFBOEI7QUFDOUIsU0FBUztBQUNUO0FBQ0EsVUFBVTtBQUNWIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vc3JjL21vZHVsZXMvdG9vbHRpcC5qcz8xMTgyIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBET01QdXJpZnkgZnJvbSAnZG9tcHVyaWZ5JztcbmltcG9ydCB7XG4gIGNzc1xufSBmcm9tICcuLi9tb2R1bGVzL21vZHVsZXMtY29uZmlnLmpzJztcbmltcG9ydCB7XG4gIGNyZWF0ZV9ib3gsXG4gIGdlbmVyYXRlX3V1aWQsXG59IGZyb20gJy4uL21vZHVsZXMvdXRpbHMuanMnO1xuXG5leHBvcnQgZnVuY3Rpb24gVG9vbFRpcCgpIHtcbmNvbnN0IHV1aWQ9Z2VuZXJhdGVfdXVpZCgpO1xuICAgIGNvbnN0IHRpcCA9IGNyZWF0ZV9ib3goJ2RpdicsIHtcbiAgICAgICAgICAgIGlkOiB1dWlkLFxuICAgICAgICAgICAgdGV4dDogXCJcIixcbiAgICAgICAgICAgIGNsYXNzOiBjc3MudG9vbHRpcFxuICAgICAgICAgIH0sZG9jdW1lbnQuYm9keSk7XG4gIGZ1bmN0aW9uIGNvbXB1dGVQb3NpdGlvbiggaXRlbSwgdGlwLCBvcHRpb25zPXtwbGFjZW1lbnQ6J2JvdHRvbS1zdGFydCcsb2Zmc2V0Ont4OjIseToyfX0pIHtcbiAgICBjb25zdCByZWN0ID0gaXRlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICBjb25zdCBwbGFjZW1lbnQ9b3B0aW9ucy5wbGFjZW1lbnQuc3BsaXQoJy0nKTtcbiAgICBsZXQgeT1wYXJzZUludChyZWN0LnRvcCk7XG4gICAgc3dpdGNoKHBsYWNlbWVudFswXSkge1xuICAgICAgICBjYXNlICdib3R0b20nOlxuICAgICAgICAgICAgeSs9cGFyc2VJbnQocmVjdC5oZWlnaHQpO1xuICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnY2VudGVyJzpcbiAgICAgICAgICAgIHkrPU1hdGgucm91bmQocGFyc2VJbnQocmVjdC5oZWlnaHQpLzIpO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gICAgbGV0IHg9cGFyc2VJbnQocmVjdC5sZWZ0KTtcbiAgICBzd2l0Y2gocGxhY2VtZW50WzFdKSB7XG4gICAgICAgIGNhc2UgJ2NlbnRlcic6XG4gICAgICAgIHgrPU1hdGgucm91bmQocGFyc2VJbnQocmVjdC53aWR0aCkvMik7XG4gICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdlbmQnOlxuICAgICAgICB4Kz1wYXJzZUludChyZWN0LndpZHRoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICAgIE9iamVjdC5hc3NpZ24odGlwLnN0eWxlLCB7XG4gICAgbGVmdDogYCR7eH1weGAsXG4gICAgdG9wOiBgJHt5fXB4YCxcbiAgICB9KTtcbiAgfVxuICBmdW5jdGlvbiBhcHBseVRvKGl0ZW0sdGV4dCxjaGVjaz1udWxsKSB7XG4gICAgICAgICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWVudGVyJywgKCkgPT4ge1xuICAgICAgICAgIGlmKGNoZWNrIT09bnVsbCAmJiAhY2hlY2soKSkgcmV0dXJuO1xuICAgICAgICAgIGNvbXB1dGVQb3NpdGlvbihpdGVtLCB0aXAsIHtcbiAgICAgICAgICAgIHBsYWNlbWVudDogJ3RvcC1jZW50ZXInLFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7dGlwLmNsYXNzTGlzdC5yZW1vdmUoY3NzLmhpZGUpO1xuICAgICAgICAgIHRpcC50ZXh0Q29udGVudD10ZXh0O30sMTAwKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdXQnLCAoKSA9PiB7XG4gICAgICAgICAgICBpZihjaGVjayE9PW51bGwgJiYgIWNoZWNrKCkpIHJldHVybjtcbiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgeyB0aXAuY2xhc3NMaXN0LmFkZChjc3MuaGlkZSk7XG4gICAgICAgICAgdGlwLnRleHRDb250ZW50PVwiXCI7fSw2MDApO1xuICAgICAgICB9KTtcbiAgfVxuICByZXR1cm4ge2FwcGx5VG99O1xufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/modules/tooltip.js\n")}}]);