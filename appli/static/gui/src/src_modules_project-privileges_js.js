"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["src_modules_project-privileges_js"],{"./src/modules/project-privileges.js"(module,__webpack_exports__,__webpack_require__){eval("{__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ProjectPrivileges: () => (/* binding */ ProjectPrivileges)\n/* harmony export */ });\n/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! dompurify */ \"./node_modules/dompurify/dist/purify.es.mjs\");\n/* harmony import */ var _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../modules/alert-box.js */ \"./src/modules/alert-box.js\");\n/* harmony import */ var _modules_form_submit_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../modules/form-submit.js */ \"./src/modules/form-submit.js\");\n/* harmony import */ var _modules_js_tom_select_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../modules/js-tom-select.js */ \"./src/modules/js-tom-select.js\");\n/* harmony import */ var _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../modules/modules-config.js */ \"./src/modules/modules-config.js\");\n/* harmony import */ var _modules_utils_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../modules/utils.js */ \"./src/modules/utils.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__, _modules_form_submit_js__WEBPACK_IMPORTED_MODULE_2__, _modules_js_tom_select_js__WEBPACK_IMPORTED_MODULE_3__]);\n([_modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__, _modules_form_submit_js__WEBPACK_IMPORTED_MODULE_2__, _modules_js_tom_select_js__WEBPACK_IMPORTED_MODULE_3__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n// privileges of a project\n// line with member name , priviliege , is contact , and delete functionality\n\n\n\n\n\n\nconst dynamics = {};\n//add local selector\n_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.domselectors.memberline = '[data-block=\"member\"]';\nclass ProjectPrivileges {\n  //TODO: rewrite to not depend on DOM select\n  options;\n  // current user id;\n  keymessages = {\n    oneatleast: 'oneatleast',\n    nomanager: 'nomanager',\n    nocontact: 'nocontact',\n    uhasnopriv: 'uhasnopriv',\n    importpriverror: 'importpriverror',\n    emptyname: 'emptyname'\n  };\n  current_uid;\n  fieldset;\n  fieldset_alert_zone;\n  linemodel;\n  currentlist = {};\n  // unique users\n  constructor(item, options = {}) {\n    if (item === null || (item instanceof HTMLElement === false)) return;\n    if (!item.jsprivileges) {\n      const defaultOptions = {\n        separ: '.new-privilege',\n        addbtn: '[data-add=\"block\"]',\n        target: 'member',\n        ident: 'member',\n        privilege: 'privilege',\n        delet: 'delet',\n        contact: 'contact',\n        contactfieldname: 'contact_user_id',\n        domselectors: {\n          tabcontent: '.tab-content'\n        }\n      };\n      this.options = Object.assign({}, defaultOptions, options);\n      // attach messages for fields and alerts system\n      this.fieldset = item;\n      if (!this.fieldset) return _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.error();\n      this.fieldset_alert_zone = item.querySelector(this.options.domselectors.tabcontent) ? item.querySelector(this.options.domselectors.tabcontent) : item;\n      this.options.separ = this.options.separ instanceof HTMLElement ? this.options.separ : (document.querySelector(this.options.separ) ? document.querySelector(this.options.separ) : null);\n      this.options.addbtn = this.options.addbtn instanceof HTMLElement ? this.options.addbtn : document.querySelector(this.options.addbtn);\n      if (this.options.addbtn) this.addListener();\n      const lines = this.fieldset.querySelectorAll('[data-block=\"' + this.options.target + '\"]');\n      if (lines.length === 0) return _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.error();\n      this.linemodel = lines[0];\n\n      this.linecontainer = lines[0].parentElement;\n      if (this.linecontainer === null) return _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.error();\n      this.current_uid = this.fieldset.dataset.u;\n      lines.forEach((line, i) => {\n        line.dataset.n = i;\n        this.activateEvents(line);\n      });\n      // add messaging functionalities\n      const form = this.fieldset.closest('form');\n      if (form) {\n        if (form.formsubmit) {\n          form.formsubmit.addHandler('validate', () => {\n             if (this.fieldset.dataset.hasOwnProperty(\"readonly\")) return true;\n             return this.validateFields();\n          });\n          form.formsubmit.addHandler('submit', () => {\n           if (this.fieldset.hasOwnProperty('readonly')) return true;\n            return this.formatPrivileges();\n          });\n        } else form.addEventListener('submit', async (e) => {\n          const resp = this.validateFields();\n          if (resp === false) e.preventDefault();\n          else return this.formatPrivileges();\n        });\n      };\n      this.orderRows();\n      item.jsprivileges = this;\n    }\n    return item.jsprivileges;\n  }\n\n  newLine(ret = false, check = 0, replace = false) {\n    const lines = this.linecontainer.querySelectorAll(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.domselectors.memberline);\n    let newline;\n    if (lines.length && check > 0) newline = this.getLinePrivilege(check);\n    if (newline) {\n      if (replace === true) return newline;\n      else return null;\n    }\n    const clone = this.linemodel.cloneNode(true);\n    if (clone.dataset.hasOwnProperty(\"model\")) delete clone.dataset.model;\n    newline = this.clearLine(clone, 0, -1);\n    newline.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.hide);\n    if (newline) {\n      const nn = (this.fieldset.dataset.n) ? parseInt(this.fieldset.dataset.n) + 1 : lines.length;\n      this.linecontainer.append(newline);\n      newline = this.clearLine(newline, -1, nn, (this.options.separ ? this.options.separ : null));\n      newline.dataset.n = nn;\n      this.fieldset.dataset.n = nn;\n      this.activateEvents(newline, (check === 0));\n      if (ret === true) return newline;\n    }\n    return null;\n  }\n\n  addListener() {\n    this.options.target = (this.options.addbtn.dataset.target) ? this.options.addbtn.dataset.target : this.options.target;\n    this.options.addbtn.addEventListener('click', async (e) => {\n      e.preventDefault();\n      this.newLine();\n    })\n  }\n  indexElement(el, n, nn) {\n    // order is important\n    const keys = ['id', 'name', 'for', 'aria-controls'];\n    keys.forEach((key) => {\n      let val = el.getAttribute(key);\n      if (val !== null) {\n        if (key === 'name') val = val.replace('[' + n + ']', '[' + (nn) + ']');\n        else val = val.replace('_' + n, '_' + (nn));\n        el.setAttribute(key, val);\n      }\n    });\n    return el;\n  }\n  indexLine(line, n, nn = null) {\n    nn = (nn === null) ? n + 1 : nn;\n    const elems = line.querySelectorAll('[data-elem]');\n    elems.forEach((elem) => {\n      // change loop index - necessary for tailwindcss peerchecked to work otherwise not if name ends with []\n      // clean and reset events\n      const els = elem.querySelectorAll('input, select, label, div');\n      els.forEach((el) => {\n        if (n !== null) el = this.indexElement(el, n, nn);\n      });\n    });\n    line.dataset.n = parseInt(nn);\n    this.fieldset.dataset.n = (this.fieldset.dataset.n && this.fieldset.dataset.n >= nn) ? this.fieldset.dataset.n : nn;\n    return line;\n  }\n  clearLine(line, n = null, nn = null, separ = null) {\n    /*clean line element */\n    line.dataset.mod = '';\n    line.disabled = false;\n    const elems = line.querySelectorAll('[data-elem]');\n    elems.forEach((elem) => {\n      // change loop index - necessary for tailwindcss peerchecked to work otherwise not if name ends with []\n      // clean and reset events\n      const els = elem.querySelectorAll('input, select, label, div');\n      els.forEach((el) => {\n        if (!el.dataset.hasOwnProperty('readnly')) el.disabled = false;\n        if (n !== null) { // change names and id when adding a new row - not if clear only\n          nn = (nn === null) ? n + 1 : nn;\n          el = this.indexElement(el, n, nn);\n        }\n        switch (el.tagName.toLowerCase()) {\n          case 'input':\n            el.checked = false;\n            // disable contact as privilege is empty\n            if (el.name == this.options.contactfieldname) {\n              el.value = \"0\";\n              el.disabled = true;\n            }\n            break;\n          case 'select':\n            // remove options except the first one with select\n            Array.from(el.options).forEach(option => {\n              if (parseInt(option.value) > 0) option.remove();\n            });\n            // todo shoulkd have been removed\n            el.selectedIndex = 0;\n            if (!el.tomselect) {\n              ['tom-select', 'tomselected', 'ts-hidden-accessible'].forEach(cl => {\n                el.classList.remove(cl);\n              });\n            } else el.tomselect.destroy();\n            break;\n          case 'div':\n            if (n !== null && el.dataset.component) el.remove();\n            break;\n        }\n\n      })\n\n    })\n    /* add functionnalities */\n    if (separ) {\n      line.classList.add('new');\n      separ.after(line);\n    }\n\n    return line;\n  }\n\n  setLine(line, mb = {\n    key: '',\n    value: ''\n  }, priv, ct) {\n\n    priv = _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.defined_privileges[priv] ? _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.defined_privileges[priv] : _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.defined_privileges.viewers;\n    if (!priv) return;\n    const {\n      member,\n      privs,\n      contact,\n      delet\n    } = this.getInputs(line, priv);\n\n    if (!member || !privs || !contact || !delet) return;\n    // sanitize\n    mb.key = dompurify__WEBPACK_IMPORTED_MODULE_0__[\"default\"].sanitize(mb.key);\n    mb.value = dompurify__WEBPACK_IMPORTED_MODULE_0__[\"default\"].sanitize(mb.value);\n\n    let option = member.querySelector('option[value=\"' + mb.key + '\"]');\n    if (option === null) {\n      option = document.createElement('option');\n      option.value = mb.key;\n      option.text = mb.value;\n      member.append(option);\n    }\n    option.selected = true;\n    if (!member.tomselect) {\n      _modules_js_tom_select_js__WEBPACK_IMPORTED_MODULE_3__.JsTomSelect.applyTo(member);\n    }\n    privs.checked = true;\n    contact.value = mb.key;\n    if (priv === _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.rights.manage) {\n      contact.disabled = false;\n      if (ct === true && !contact.checked) contact.checked = true;\n    } else {\n      contact.disabled = true;\n      contact.checked = false;\n    }\n\n  }\n  getInputs(line, priv = false) {\n    const member = line.querySelector(\"[name*='[\" + this.options.ident + \"]']\");\n    let privs;\n    if (priv) {\n      privs = line.querySelector('input[name*=\"[' + this.options.privilege + ']\"][value=\"' + priv + '\"]');\n    } else privs = line.querySelectorAll('input[name*=\"[' + this.options.privilege + ']\"]');\n    const contact = line.querySelector('input[name=\"' + this.options.contactfieldname + '\"]');\n    const delet = line.querySelector(\"input[name*='[\" + this.options.delet + \"]']\");\n    return {\n      member: member,\n      privs: privs,\n      contact: contact,\n      delet: delet\n    };\n  }\n  async importPrivileges(privileges, replace = false, contact = null, importedtag = null, dismiss = null) {\n    if (replace === true) this.clearAll();\n    try {\n      Object.entries(privileges).forEach(([priv, members]) => {\n        members.forEach((member) => {\n          const lastline = this.newLine(true, member.id);\n          if (lastline) {\n            this.setLine(lastline, {\n              key: member.id,\n              value: member.name,\n            }, priv, (contact !== null && (contact.id === member.id)));\n            if (importedtag) importedtag(lastline);\n          }\n          replace = false;\n        });\n      });\n      if (dismiss) dismiss();\n      _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.dismissAlert(this.keymessages.importpriverror);\n\n      this.orderRows();\n      return true;\n    } catch (err) {\n      _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.addAlert({\n        type: _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.alertconfig.types.error,\n        content: this.keymessages.importpriverror,\n        dismissible: true,\n        inverse: true\n      });\n      console.log('err', err);\n      return false;\n    }\n  }\n  activateEvents(line, ts = false) {\n    if (!line) return;\n    const {\n      member,\n      privs,\n      contact,\n      delet\n    } = this.getInputs(line);\n    if (!member || !privs || !contact || !delet) {\n      return;\n    }\n\n    const siblings = s => [...s.parentElement.children].filter(c => c.nodeType == 1 && c != s && c.classList.contains('row') && c.dataset.block !== null && c.dataset.block === this.options.target);\n    // activate tom select if needed\n    // enable/disable contact when privilege changes\n    if (!member.currentlist) member.currentlist = this.currentlist;\n    if (member.value && !this.currentlist[member.value]) this.currentlist[member.value] = true;\n    if (ts === true && !member.tomselect) {\n      _modules_js_tom_select_js__WEBPACK_IMPORTED_MODULE_3__.JsTomSelect.applyTo(member);\n    }\n    const lineSettings = (pr, ct, dl, synchro = false) => {\n      if (pr && pr.checked) {\n        pr.checked = true;\n        if (_modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.hasMessage(line)) _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.removeMessage({\n          type: _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.alertconfig.types.danger,\n          parent: line,\n          content: this.keymessages.uhasnopriv\n        });\n      }\n      if (pr && pr.value === _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.rights.manage) {\n        // manager - can't delete line - can choose as contact\n        dl.disabled = true;\n        ct.disabled = false;\n        _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.dismissAlert(this.keymessages.nomanager);\n        if (ct.checked) {\n          _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.dismissAlert(this.keymessages.nocontact);\n          ct.dispatchEvent(new Event('valid'));\n        }\n      } else {\n        // not manager - can delet line - cannot chose as contact\n        ct.checked = false;\n        dl.disabled = false;\n        ct.disabled = true;\n      }\n\n      if (synchro === true) {\n        synchroSiblings(line);\n      }\n      // dismiss alerts\n      if (!dl.ckecked) {\n        _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.dismissAlert(this.keymessages.nobody);\n        if (_modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.hasMessage(line)) _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.removeMessage({\n          type: _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.alertconfig.types.danger,\n          parent: line,\n          content: this.keymessages.oneatleast\n        });\n      }\n    }\n    const synchroSiblings = (line) => {\n      const lns = siblings(line);\n      lns.forEach((ln) => {\n        const dl = ln.querySelector(\"input[name*='[\" + this.options.delet + \"]']\");\n        const ct = ln.querySelector('input[name=\"' + this.options.contactfieldname + '\"]');\n        const pr = ln.querySelector('input[name*=\"[' + this.options.privilege + ']\"]:checked');\n        lineSettings(pr, ct, dl, false);\n\n      })\n    }\n\n    member.addEventListener('change', (e) => {\n      contact.value = member.value;\n      if (parseInt(member.value) > 0 && _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.hasMessage(member)) _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.removeMessage({\n        type: _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.alertconfig.types.danger,\n        parent: member,\n        content: this.keymessages.emptyname\n      });\n    })\n    privs.forEach((priv) => {\n      if (priv.dataset.hasOwnProperty(\"readonly\")) (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_5__.input_read_only)(priv);\n      priv.addEventListener('change', (e) => {\n        if (priv.checked) lineSettings(priv, contact, delet, false);\n      });\n\n      if (priv.checked) lineSettings(priv, contact, delet, false);\n    })\n    if (contact.dataset.hasOwnProperty(\"readonly\")) (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_5__.input_read_only)(contact);\n    contact.addEventListener('change', (e) => {\n      if (contact.checked) {\n        delet.disabled = true;\n      } else delet.disabled = false;\n      const priv = line.querySelector('input[name*=\"[' + this.options.privilege + ']\"]:checked');\n      lineSettings(priv, contact, delet, true);\n      // enable otherwise\n    })\n    // delet ok for all when new line\n    //\n\n    delet.addEventListener('click', (e) => {\n      // at least one priv line\n      const deletlabel = delet.closest('label');\n      const lines = this.fieldset.querySelectorAll('[data-block=\"' + this.options.target + '\"]:not([data-mod=\"remove\"])');\n      if (lines.length <= 1 && e.target.checked) {\n        e.preventDefault();\n        line.removeAttribute('data-mod');\n        member.disabled = false;\n        e.target.disabled = true;\n        _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.addMessage({\n          type: _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.alertconfig.types.danger,\n          parent: line,\n          content: this.keymessages.oneatleast,\n          duration: 3000\n        });\n        return;\n      } else if (e.target.checked) {\n        if (_modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.hasMessage(member)) _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.removeMessage({\n          type: _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.alertconfig.types.danger,\n          parent: member\n        });\n        if (line.classList.contains('new')) {\n          line.remove();\n        } else {\n          if (deletlabel && deletlabel.dataset.restore) deletlabel.dataset.title = deletlabel.dataset.restore;\n          line.setAttribute('data-mod', 'remove');\n          privs.forEach(priv => {\n            priv.dataset.checked = priv.checked;\n            priv.checked = false;\n            priv.disabled = true;\n          })\n          contact.checked = false;\n          contact.disabled = true;\n          member.disabled = true;\n        }\n      } else {\n        if (deletlabel && deletlabel.dataset.remove) deletlabel.dataset.title = deletlabel.dataset.remove;\n        line.removeAttribute('data-mod');\n        privs.forEach(priv => {\n          priv.disabled = false;\n          if (priv.dataset.checked === \"true\") priv.checked = true;\n          else priv.checked = false;\n        });\n\n        member.disabled = false;\n      }\n    });\n    // delet mouseover - explain why it is disabled when manage is checked\n    delet.addEventListener('mouseover', (e) => {\n      if (e.target.disabled) {\n        let pr = line.querySelector('input[name*=\"[' + this.options.privilege + ']\"]:checked');\n        if (!pr) return;\n        pr = pr.value.toLowerCase()\n        e.target.dataset.title = (e.target.dataset[pr]) ? e.target.dataset[pr] : e.target.dataset.title\n      }\n    })\n    // disable delet if user is the only manager\n    if (this.current_uid === member.value) delet.disabled = true;\n  }\n\n  validateFields(add = false) { // check managers and contact_user_id on submit\n    const check_contact = () => {\n      // check if one manager at least\n      const managers = this.fieldset.querySelectorAll('[name*=\"[' + this.options.privilege + ']\"][value=\"' + _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.rights.manage + '\"]:checked');\n      if (managers.length === 0) {\n        _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.addAlert({\n          type: _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.alertconfig.types.danger,\n          content: this.keymessages.nomanager,\n          dismissible: true,\n          inverse: true\n        });\n        this.tabError(true);\n        return false;\n      } else {\n        _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.dismissAlert(this.keymessages.nomanager);\n        this.tabError(false);\n      }\n      // check contact\n\n      const contact = this.fieldset.querySelector('[name=\"' + this.options.contactfieldname + '\"]:checked');\n      if (contact === null) {\n        _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.addAlert({\n          type: _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.alertconfig.types.danger,\n          content: this.keymessages.nocontact,\n          dismissible: true,\n          inverse: true\n        });\n        this.tabError(true);\n        return false;\n      }\n      _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.dismissAlert(this.keymessages.nocontact);\n      this.tabError(false);\n      return true;\n    }\n    const has_member = (member) => {\n        return (member.value && parseInt(member.value)>0);\n    }\n    const has_priv = (line) => {\n      const priv = line.querySelector('[name*=\"[' + this.options.privilege + ']\"]:checked');\n      if (priv && priv.value) return true;\n      return false;\n    }\n    const lines = this.fieldset.querySelectorAll('[data-block=\"' + this.options.target + '\"]');\n    let n = lines.length;\n    let verif = true;\n    for (const line of lines) {\n      const member = line.querySelector('[name*=\"[' + this.options.ident + ']\"]');\n      if (line.dataset.hasOwnProperty(\"model\") || line.dataset.mod && line.dataset.mod === 'remove') {\n        if (n > 1) {\n          line.remove();\n          n--;\n        } else return false;\n      } else {\n      if (!has_member(member)) {\n        _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.addMessage({\n          type: _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.alertconfig.types.danger,\n          parent: member,\n          content: this.keymessages.emptyname\n        });\n        member.focus();\n        const resp = false; // no confimbox just wait for user action\n        // callback if confirmbox response is chosen if 'confirm'\n        if (resp === true) {\n          if (n > 1) {\n            line.remove();\n            n--;\n          } else return false;\n        } else return false;\n      }\n\n      if (!has_priv(line)) {\n        _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.addMessage({\n          type: _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.alertconfig.types.danger,\n          parent: line,\n          content: this.keymessages.uhasnopriv\n        });\n        verif = false;\n      }  else if (_modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.hasMessage(line)) {\n        _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.removeMessage({\n          type: _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.alertconfig.types.danger,\n          parent: line,\n          content: this.keymessages.uhasnopriv\n        });\n      }\n      }\n    }\n    if (n === 0) {\n      _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.addAlert({\n        type: _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.alertconfig.types.danger,\n        content: this.keymessages.nobody,\n        dismissible: true,\n        inverse: true\n      });\n      return false;\n    } else _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.dismissAlert(this.keymessages.nobody);\n    const hascontact = this.fieldset.dataset.hasOwnProperty(\"readonly\") || check_contact();\n    return (hascontact && verif);\n  }\n\n  formatPrivileges() {\n    const lines = this.fieldset.querySelectorAll('[data-block=\"' + this.options.target + '\"]');\n    const format_privilege = (line) => {\n      const els = line.querySelectorAll('[name*=\"members[\"');\n      els.forEach((el) => {\n        let name = el.name;\n        name = name.split('[');\n        name.pop();\n        el.name = name.join('[');\n        if (el.name.indexOf('[' + this.options.privilege + ']') > 0) {\n          el.type = 'checkbox';\n          el.classList.add('hidden');\n        }\n\n      });\n    }\n    lines.forEach(line => {\n      format_privilege(line);\n    });\n    return true;\n  }\n\n\n  getLinePrivilege(id) {\n    let privilege = null;\n    const lines = this.fieldset.querySelectorAll('[data-block=\"' + this.options.target + '\"]')\n    for (const line of lines) {\n      if (parseInt(line.querySelector('[name*=\"[' + this.options.ident + ']\"]').value) === parseInt(id)) {\n        privilege = line;\n        break;\n      }\n    }\n\n    return privilege;\n  }\n  clearAll() {\n    let lines = this.fieldset.querySelectorAll('[data-block=\"' + this.options.target + '\"]');\n    lines.forEach((line, index) => {\n      line.remove();\n    });\n\n  }\n  orderRows() {\n    const lines = Array.from(this.fieldset.querySelectorAll('[data-block=\"' + this.options.target + '\"]'));\n    if (lines.length > 2) {\n      try {\n        const rightssorted = Object.values(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.rights);\n        lines.sort((linea, lineb) => {\n          const a = this.getInputs(linea);\n          const b = this.getInputs(lineb);\n          const nameb = new String(b.member.options[b.member.selectedIndex].text).toLowerCase().split(' ')\n          const namea = new String(a.member.options[a.member.selectedIndex].text).toLowerCase().split(' ');\n          const priva = Array.from(a.privs).filter(priv => (priv.checked));\n          const privb = Array.from(b.privs).filter(priv => (priv.checked));\n          const compa = (+!a.contact.checked) + ` ` + rightssorted.indexOf(((priva.length) ? priva[0].value : null)) + ` ` + ((namea.length > 1) ? namea.pop() + ` ` + namea[0] : namea[0]);\n          const compb = (+!b.contact.checked) + ` ` + rightssorted.indexOf(((privb.length) ? privb[0].value : null)) + ` ` + ((nameb.length > 1) ? nameb.pop() + ` ` + nameb[0] : nameb[0]);\n          if (compb > compa) return -1;\n          else if (compa > compb) return 1;\n          else return 0;\n        })\n        const clone = this.linecontainer;\n        lines.forEach((line, i) => {\n          clone.appendChild(line);\n        });\n      } catch (err) {\n        console.log('err not sorted', err);\n      }\n    }\n  }\n\n  tabError(on) {\n    const tab = (this.fieldset.classList.contains(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.domselectors.component.tabs.tab.substr(1))) ? this.fieldset : ((this.fieldset.parentElement.classList.contains(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.domselectors.component.tabs.tab.substr(1))) ? this.fieldset.parentElement : null);\n    if (tab === null) return;\n    if (on === true) tab.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.error);\n    else tab.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.error);\n  }\n}\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvbW9kdWxlcy9wcm9qZWN0LXByaXZpbGVnZXMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDa0M7QUFHRDtBQUdFO0FBR0U7QUFNQztBQUdUO0FBQzdCO0FBQ0E7QUFDQSxvRUFBWTtBQUNMO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQztBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUM7QUFDckM7QUFDQTtBQUNBLGlDQUFpQywyREFBUTtBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBQXFDLDJEQUFRO0FBQzdDOztBQUVBO0FBQ0EsOENBQThDLDJEQUFRO0FBQ3REO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWCxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLHNEQUFzRCxvRUFBWTtBQUNsRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkIsMkRBQUc7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlO0FBQ2YsY0FBYztBQUNkO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBTzs7QUFFUCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUgsV0FBVywwRUFBa0IsU0FBUywwRUFBa0IsU0FBUywwRUFBa0I7QUFDbkY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTs7QUFFTjtBQUNBO0FBQ0EsYUFBYSxpREFBUztBQUN0QixlQUFlLGlEQUFTOztBQUV4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNLGtFQUFXO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQiw4REFBTTtBQUN2QjtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULE9BQU87QUFDUDtBQUNBLE1BQU0sMkRBQVE7O0FBRWQ7QUFDQTtBQUNBLE1BQU07QUFDTixNQUFNLDJEQUFRO0FBQ2QsY0FBYywyREFBUTtBQUN0QjtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTSxrRUFBVztBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksMkRBQVEsbUJBQW1CLDJEQUFRO0FBQy9DLGdCQUFnQiwyREFBUTtBQUN4QjtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsNkJBQTZCLDhEQUFNO0FBQ25DO0FBQ0E7QUFDQTtBQUNBLFFBQVEsMkRBQVE7QUFDaEI7QUFDQSxVQUFVLDJEQUFRO0FBQ2xCO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUSwyREFBUTtBQUNoQixZQUFZLDJEQUFRLG1CQUFtQiwyREFBUTtBQUMvQyxnQkFBZ0IsMkRBQVE7QUFDeEI7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBTztBQUNQOztBQUVBO0FBQ0E7QUFDQSx3Q0FBd0MsMkRBQVEscUJBQXFCLDJEQUFRO0FBQzdFLGNBQWMsMkRBQVE7QUFDdEI7QUFDQTtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQSxtREFBbUQsa0VBQWU7QUFDbEU7QUFDQTtBQUNBLE9BQU87O0FBRVA7QUFDQSxLQUFLO0FBQ0wsb0RBQW9ELGtFQUFlO0FBQ25FO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRLDJEQUFRO0FBQ2hCLGdCQUFnQiwyREFBUTtBQUN4QjtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxRQUFRO0FBQ1IsWUFBWSwyREFBUSxxQkFBcUIsMkRBQVE7QUFDakQsZ0JBQWdCLDJEQUFRO0FBQ3hCO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQSxnQ0FBZ0M7QUFDaEM7QUFDQTtBQUNBLDZHQUE2Ryw4REFBTTtBQUNuSDtBQUNBLFFBQVEsMkRBQVE7QUFDaEIsZ0JBQWdCLDJEQUFRO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsUUFBUTtBQUNSLFFBQVEsMkRBQVE7QUFDaEI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxRQUFRLDJEQUFRO0FBQ2hCLGdCQUFnQiwyREFBUTtBQUN4QjtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsTUFBTSwyREFBUTtBQUNkO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1YsUUFBUTtBQUNSO0FBQ0EsUUFBUSwyREFBUTtBQUNoQixnQkFBZ0IsMkRBQVE7QUFDeEI7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLDRCQUE0QjtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWTtBQUNaLFVBQVU7QUFDVjs7QUFFQTtBQUNBLFFBQVEsMkRBQVE7QUFDaEIsZ0JBQWdCLDJEQUFRO0FBQ3hCO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxTQUFTLFNBQVMsMkRBQVE7QUFDMUIsUUFBUSwyREFBUTtBQUNoQixnQkFBZ0IsMkRBQVE7QUFDeEI7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU0sMkRBQVE7QUFDZCxjQUFjLDJEQUFRO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBLE1BQU0sS0FBSywyREFBUTtBQUNuQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkNBQTJDLDhEQUFNO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0Esa0RBQWtELG9FQUFZLG1HQUFtRyxvRUFBWTtBQUM3SztBQUNBLHVDQUF1QywyREFBRztBQUMxQyw4QkFBOEIsMkRBQUc7QUFDakM7QUFDQSxDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vc3JjL21vZHVsZXMvcHJvamVjdC1wcml2aWxlZ2VzLmpzP2RkMjMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gcHJpdmlsZWdlcyBvZiBhIHByb2plY3Rcbi8vIGxpbmUgd2l0aCBtZW1iZXIgbmFtZSAsIHByaXZpbGllZ2UgLCBpcyBjb250YWN0ICwgYW5kIGRlbGV0ZSBmdW5jdGlvbmFsaXR5XG5pbXBvcnQgRE9NUHVyaWZ5IGZyb20gJ2RvbXB1cmlmeSc7XG5pbXBvcnQge1xuICBBbGVydEJveFxufSBmcm9tICcuLi9tb2R1bGVzL2FsZXJ0LWJveC5qcyc7XG5pbXBvcnQge1xuICBGb3JtU3VibWl0LFxufSBmcm9tIFwiLi4vbW9kdWxlcy9mb3JtLXN1Ym1pdC5qc1wiO1xuaW1wb3J0IHtcbiAgSnNUb21TZWxlY3Rcbn0gZnJvbSBcIi4uL21vZHVsZXMvanMtdG9tLXNlbGVjdC5qc1wiO1xuaW1wb3J0IHtcbiAgcmlnaHRzLFxuICBkZWZpbmVkX3ByaXZpbGVnZXMsXG4gIGRvbXNlbGVjdG9ycyxcbiAgY3NzXG59IGZyb20gJy4uL21vZHVsZXMvbW9kdWxlcy1jb25maWcuanMnO1xuaW1wb3J0IHtcbiAgaW5wdXRfcmVhZF9vbmx5XG59IGZyb20gXCIuLi9tb2R1bGVzL3V0aWxzLmpzXCI7XG5jb25zdCBkeW5hbWljcyA9IHt9O1xuLy9hZGQgbG9jYWwgc2VsZWN0b3JcbmRvbXNlbGVjdG9ycy5tZW1iZXJsaW5lID0gJ1tkYXRhLWJsb2NrPVwibWVtYmVyXCJdJztcbmV4cG9ydCBjbGFzcyBQcm9qZWN0UHJpdmlsZWdlcyB7XG4gIC8vVE9ETzogcmV3cml0ZSB0byBub3QgZGVwZW5kIG9uIERPTSBzZWxlY3RcbiAgb3B0aW9ucztcbiAgLy8gY3VycmVudCB1c2VyIGlkO1xuICBrZXltZXNzYWdlcyA9IHtcbiAgICBvbmVhdGxlYXN0OiAnb25lYXRsZWFzdCcsXG4gICAgbm9tYW5hZ2VyOiAnbm9tYW5hZ2VyJyxcbiAgICBub2NvbnRhY3Q6ICdub2NvbnRhY3QnLFxuICAgIHVoYXNub3ByaXY6ICd1aGFzbm9wcml2JyxcbiAgICBpbXBvcnRwcml2ZXJyb3I6ICdpbXBvcnRwcml2ZXJyb3InLFxuICAgIGVtcHR5bmFtZTogJ2VtcHR5bmFtZSdcbiAgfTtcbiAgY3VycmVudF91aWQ7XG4gIGZpZWxkc2V0O1xuICBmaWVsZHNldF9hbGVydF96b25lO1xuICBsaW5lbW9kZWw7XG4gIGN1cnJlbnRsaXN0ID0ge307XG4gIC8vIHVuaXF1ZSB1c2Vyc1xuICBjb25zdHJ1Y3RvcihpdGVtLCBvcHRpb25zID0ge30pIHtcbiAgICBpZiAoaXRlbSA9PT0gbnVsbCB8fCAoaXRlbSBpbnN0YW5jZW9mIEhUTUxFbGVtZW50ID09PSBmYWxzZSkpIHJldHVybjtcbiAgICBpZiAoIWl0ZW0uanNwcml2aWxlZ2VzKSB7XG4gICAgICBjb25zdCBkZWZhdWx0T3B0aW9ucyA9IHtcbiAgICAgICAgc2VwYXI6ICcubmV3LXByaXZpbGVnZScsXG4gICAgICAgIGFkZGJ0bjogJ1tkYXRhLWFkZD1cImJsb2NrXCJdJyxcbiAgICAgICAgdGFyZ2V0OiAnbWVtYmVyJyxcbiAgICAgICAgaWRlbnQ6ICdtZW1iZXInLFxuICAgICAgICBwcml2aWxlZ2U6ICdwcml2aWxlZ2UnLFxuICAgICAgICBkZWxldDogJ2RlbGV0JyxcbiAgICAgICAgY29udGFjdDogJ2NvbnRhY3QnLFxuICAgICAgICBjb250YWN0ZmllbGRuYW1lOiAnY29udGFjdF91c2VyX2lkJyxcbiAgICAgICAgZG9tc2VsZWN0b3JzOiB7XG4gICAgICAgICAgdGFiY29udGVudDogJy50YWItY29udGVudCdcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHRoaXMub3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe30sIGRlZmF1bHRPcHRpb25zLCBvcHRpb25zKTtcbiAgICAgIC8vIGF0dGFjaCBtZXNzYWdlcyBmb3IgZmllbGRzIGFuZCBhbGVydHMgc3lzdGVtXG4gICAgICB0aGlzLmZpZWxkc2V0ID0gaXRlbTtcbiAgICAgIGlmICghdGhpcy5maWVsZHNldCkgcmV0dXJuIEFsZXJ0Qm94LmVycm9yKCk7XG4gICAgICB0aGlzLmZpZWxkc2V0X2FsZXJ0X3pvbmUgPSBpdGVtLnF1ZXJ5U2VsZWN0b3IodGhpcy5vcHRpb25zLmRvbXNlbGVjdG9ycy50YWJjb250ZW50KSA/IGl0ZW0ucXVlcnlTZWxlY3Rvcih0aGlzLm9wdGlvbnMuZG9tc2VsZWN0b3JzLnRhYmNvbnRlbnQpIDogaXRlbTtcbiAgICAgIHRoaXMub3B0aW9ucy5zZXBhciA9IHRoaXMub3B0aW9ucy5zZXBhciBpbnN0YW5jZW9mIEhUTUxFbGVtZW50ID8gdGhpcy5vcHRpb25zLnNlcGFyIDogKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5vcHRpb25zLnNlcGFyKSA/IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5vcHRpb25zLnNlcGFyKSA6IG51bGwpO1xuICAgICAgdGhpcy5vcHRpb25zLmFkZGJ0biA9IHRoaXMub3B0aW9ucy5hZGRidG4gaW5zdGFuY2VvZiBIVE1MRWxlbWVudCA/IHRoaXMub3B0aW9ucy5hZGRidG4gOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHRoaXMub3B0aW9ucy5hZGRidG4pO1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy5hZGRidG4pIHRoaXMuYWRkTGlzdGVuZXIoKTtcbiAgICAgIGNvbnN0IGxpbmVzID0gdGhpcy5maWVsZHNldC5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1ibG9jaz1cIicgKyB0aGlzLm9wdGlvbnMudGFyZ2V0ICsgJ1wiXScpO1xuICAgICAgaWYgKGxpbmVzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIEFsZXJ0Qm94LmVycm9yKCk7XG4gICAgICB0aGlzLmxpbmVtb2RlbCA9IGxpbmVzWzBdO1xuXG4gICAgICB0aGlzLmxpbmVjb250YWluZXIgPSBsaW5lc1swXS5wYXJlbnRFbGVtZW50O1xuICAgICAgaWYgKHRoaXMubGluZWNvbnRhaW5lciA9PT0gbnVsbCkgcmV0dXJuIEFsZXJ0Qm94LmVycm9yKCk7XG4gICAgICB0aGlzLmN1cnJlbnRfdWlkID0gdGhpcy5maWVsZHNldC5kYXRhc2V0LnU7XG4gICAgICBsaW5lcy5mb3JFYWNoKChsaW5lLCBpKSA9PiB7XG4gICAgICAgIGxpbmUuZGF0YXNldC5uID0gaTtcbiAgICAgICAgdGhpcy5hY3RpdmF0ZUV2ZW50cyhsaW5lKTtcbiAgICAgIH0pO1xuICAgICAgLy8gYWRkIG1lc3NhZ2luZyBmdW5jdGlvbmFsaXRpZXNcbiAgICAgIGNvbnN0IGZvcm0gPSB0aGlzLmZpZWxkc2V0LmNsb3Nlc3QoJ2Zvcm0nKTtcbiAgICAgIGlmIChmb3JtKSB7XG4gICAgICAgIGlmIChmb3JtLmZvcm1zdWJtaXQpIHtcbiAgICAgICAgICBmb3JtLmZvcm1zdWJtaXQuYWRkSGFuZGxlcigndmFsaWRhdGUnLCAoKSA9PiB7XG4gICAgICAgICAgICAgaWYgKHRoaXMuZmllbGRzZXQuZGF0YXNldC5oYXNPd25Qcm9wZXJ0eShcInJlYWRvbmx5XCIpKSByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICByZXR1cm4gdGhpcy52YWxpZGF0ZUZpZWxkcygpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGZvcm0uZm9ybXN1Ym1pdC5hZGRIYW5kbGVyKCdzdWJtaXQnLCAoKSA9PiB7XG4gICAgICAgICAgIGlmICh0aGlzLmZpZWxkc2V0Lmhhc093blByb3BlcnR5KCdyZWFkb25seScpKSByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmZvcm1hdFByaXZpbGVnZXMoKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIGZvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgYXN5bmMgKGUpID0+IHtcbiAgICAgICAgICBjb25zdCByZXNwID0gdGhpcy52YWxpZGF0ZUZpZWxkcygpO1xuICAgICAgICAgIGlmIChyZXNwID09PSBmYWxzZSkgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIGVsc2UgcmV0dXJuIHRoaXMuZm9ybWF0UHJpdmlsZWdlcygpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB0aGlzLm9yZGVyUm93cygpO1xuICAgICAgaXRlbS5qc3ByaXZpbGVnZXMgPSB0aGlzO1xuICAgIH1cbiAgICByZXR1cm4gaXRlbS5qc3ByaXZpbGVnZXM7XG4gIH1cblxuICBuZXdMaW5lKHJldCA9IGZhbHNlLCBjaGVjayA9IDAsIHJlcGxhY2UgPSBmYWxzZSkge1xuICAgIGNvbnN0IGxpbmVzID0gdGhpcy5saW5lY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoZG9tc2VsZWN0b3JzLm1lbWJlcmxpbmUpO1xuICAgIGxldCBuZXdsaW5lO1xuICAgIGlmIChsaW5lcy5sZW5ndGggJiYgY2hlY2sgPiAwKSBuZXdsaW5lID0gdGhpcy5nZXRMaW5lUHJpdmlsZWdlKGNoZWNrKTtcbiAgICBpZiAobmV3bGluZSkge1xuICAgICAgaWYgKHJlcGxhY2UgPT09IHRydWUpIHJldHVybiBuZXdsaW5lO1xuICAgICAgZWxzZSByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgY2xvbmUgPSB0aGlzLmxpbmVtb2RlbC5jbG9uZU5vZGUodHJ1ZSk7XG4gICAgaWYgKGNsb25lLmRhdGFzZXQuaGFzT3duUHJvcGVydHkoXCJtb2RlbFwiKSkgZGVsZXRlIGNsb25lLmRhdGFzZXQubW9kZWw7XG4gICAgbmV3bGluZSA9IHRoaXMuY2xlYXJMaW5lKGNsb25lLCAwLCAtMSk7XG4gICAgbmV3bGluZS5jbGFzc0xpc3QucmVtb3ZlKGNzcy5oaWRlKTtcbiAgICBpZiAobmV3bGluZSkge1xuICAgICAgY29uc3Qgbm4gPSAodGhpcy5maWVsZHNldC5kYXRhc2V0Lm4pID8gcGFyc2VJbnQodGhpcy5maWVsZHNldC5kYXRhc2V0Lm4pICsgMSA6IGxpbmVzLmxlbmd0aDtcbiAgICAgIHRoaXMubGluZWNvbnRhaW5lci5hcHBlbmQobmV3bGluZSk7XG4gICAgICBuZXdsaW5lID0gdGhpcy5jbGVhckxpbmUobmV3bGluZSwgLTEsIG5uLCAodGhpcy5vcHRpb25zLnNlcGFyID8gdGhpcy5vcHRpb25zLnNlcGFyIDogbnVsbCkpO1xuICAgICAgbmV3bGluZS5kYXRhc2V0Lm4gPSBubjtcbiAgICAgIHRoaXMuZmllbGRzZXQuZGF0YXNldC5uID0gbm47XG4gICAgICB0aGlzLmFjdGl2YXRlRXZlbnRzKG5ld2xpbmUsIChjaGVjayA9PT0gMCkpO1xuICAgICAgaWYgKHJldCA9PT0gdHJ1ZSkgcmV0dXJuIG5ld2xpbmU7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgYWRkTGlzdGVuZXIoKSB7XG4gICAgdGhpcy5vcHRpb25zLnRhcmdldCA9ICh0aGlzLm9wdGlvbnMuYWRkYnRuLmRhdGFzZXQudGFyZ2V0KSA/IHRoaXMub3B0aW9ucy5hZGRidG4uZGF0YXNldC50YXJnZXQgOiB0aGlzLm9wdGlvbnMudGFyZ2V0O1xuICAgIHRoaXMub3B0aW9ucy5hZGRidG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoZSkgPT4ge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgdGhpcy5uZXdMaW5lKCk7XG4gICAgfSlcbiAgfVxuICBpbmRleEVsZW1lbnQoZWwsIG4sIG5uKSB7XG4gICAgLy8gb3JkZXIgaXMgaW1wb3J0YW50XG4gICAgY29uc3Qga2V5cyA9IFsnaWQnLCAnbmFtZScsICdmb3InLCAnYXJpYS1jb250cm9scyddO1xuICAgIGtleXMuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgICBsZXQgdmFsID0gZWwuZ2V0QXR0cmlidXRlKGtleSk7XG4gICAgICBpZiAodmFsICE9PSBudWxsKSB7XG4gICAgICAgIGlmIChrZXkgPT09ICduYW1lJykgdmFsID0gdmFsLnJlcGxhY2UoJ1snICsgbiArICddJywgJ1snICsgKG5uKSArICddJyk7XG4gICAgICAgIGVsc2UgdmFsID0gdmFsLnJlcGxhY2UoJ18nICsgbiwgJ18nICsgKG5uKSk7XG4gICAgICAgIGVsLnNldEF0dHJpYnV0ZShrZXksIHZhbCk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIGVsO1xuICB9XG4gIGluZGV4TGluZShsaW5lLCBuLCBubiA9IG51bGwpIHtcbiAgICBubiA9IChubiA9PT0gbnVsbCkgPyBuICsgMSA6IG5uO1xuICAgIGNvbnN0IGVsZW1zID0gbGluZS5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1lbGVtXScpO1xuICAgIGVsZW1zLmZvckVhY2goKGVsZW0pID0+IHtcbiAgICAgIC8vIGNoYW5nZSBsb29wIGluZGV4IC0gbmVjZXNzYXJ5IGZvciB0YWlsd2luZGNzcyBwZWVyY2hlY2tlZCB0byB3b3JrIG90aGVyd2lzZSBub3QgaWYgbmFtZSBlbmRzIHdpdGggW11cbiAgICAgIC8vIGNsZWFuIGFuZCByZXNldCBldmVudHNcbiAgICAgIGNvbnN0IGVscyA9IGVsZW0ucXVlcnlTZWxlY3RvckFsbCgnaW5wdXQsIHNlbGVjdCwgbGFiZWwsIGRpdicpO1xuICAgICAgZWxzLmZvckVhY2goKGVsKSA9PiB7XG4gICAgICAgIGlmIChuICE9PSBudWxsKSBlbCA9IHRoaXMuaW5kZXhFbGVtZW50KGVsLCBuLCBubik7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgICBsaW5lLmRhdGFzZXQubiA9IHBhcnNlSW50KG5uKTtcbiAgICB0aGlzLmZpZWxkc2V0LmRhdGFzZXQubiA9ICh0aGlzLmZpZWxkc2V0LmRhdGFzZXQubiAmJiB0aGlzLmZpZWxkc2V0LmRhdGFzZXQubiA+PSBubikgPyB0aGlzLmZpZWxkc2V0LmRhdGFzZXQubiA6IG5uO1xuICAgIHJldHVybiBsaW5lO1xuICB9XG4gIGNsZWFyTGluZShsaW5lLCBuID0gbnVsbCwgbm4gPSBudWxsLCBzZXBhciA9IG51bGwpIHtcbiAgICAvKmNsZWFuIGxpbmUgZWxlbWVudCAqL1xuICAgIGxpbmUuZGF0YXNldC5tb2QgPSAnJztcbiAgICBsaW5lLmRpc2FibGVkID0gZmFsc2U7XG4gICAgY29uc3QgZWxlbXMgPSBsaW5lLnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLWVsZW1dJyk7XG4gICAgZWxlbXMuZm9yRWFjaCgoZWxlbSkgPT4ge1xuICAgICAgLy8gY2hhbmdlIGxvb3AgaW5kZXggLSBuZWNlc3NhcnkgZm9yIHRhaWx3aW5kY3NzIHBlZXJjaGVja2VkIHRvIHdvcmsgb3RoZXJ3aXNlIG5vdCBpZiBuYW1lIGVuZHMgd2l0aCBbXVxuICAgICAgLy8gY2xlYW4gYW5kIHJlc2V0IGV2ZW50c1xuICAgICAgY29uc3QgZWxzID0gZWxlbS5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dCwgc2VsZWN0LCBsYWJlbCwgZGl2Jyk7XG4gICAgICBlbHMuZm9yRWFjaCgoZWwpID0+IHtcbiAgICAgICAgaWYgKCFlbC5kYXRhc2V0Lmhhc093blByb3BlcnR5KCdyZWFkbmx5JykpIGVsLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgIGlmIChuICE9PSBudWxsKSB7IC8vIGNoYW5nZSBuYW1lcyBhbmQgaWQgd2hlbiBhZGRpbmcgYSBuZXcgcm93IC0gbm90IGlmIGNsZWFyIG9ubHlcbiAgICAgICAgICBubiA9IChubiA9PT0gbnVsbCkgPyBuICsgMSA6IG5uO1xuICAgICAgICAgIGVsID0gdGhpcy5pbmRleEVsZW1lbnQoZWwsIG4sIG5uKTtcbiAgICAgICAgfVxuICAgICAgICBzd2l0Y2ggKGVsLnRhZ05hbWUudG9Mb3dlckNhc2UoKSkge1xuICAgICAgICAgIGNhc2UgJ2lucHV0JzpcbiAgICAgICAgICAgIGVsLmNoZWNrZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIC8vIGRpc2FibGUgY29udGFjdCBhcyBwcml2aWxlZ2UgaXMgZW1wdHlcbiAgICAgICAgICAgIGlmIChlbC5uYW1lID09IHRoaXMub3B0aW9ucy5jb250YWN0ZmllbGRuYW1lKSB7XG4gICAgICAgICAgICAgIGVsLnZhbHVlID0gXCIwXCI7XG4gICAgICAgICAgICAgIGVsLmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgJ3NlbGVjdCc6XG4gICAgICAgICAgICAvLyByZW1vdmUgb3B0aW9ucyBleGNlcHQgdGhlIGZpcnN0IG9uZSB3aXRoIHNlbGVjdFxuICAgICAgICAgICAgQXJyYXkuZnJvbShlbC5vcHRpb25zKS5mb3JFYWNoKG9wdGlvbiA9PiB7XG4gICAgICAgICAgICAgIGlmIChwYXJzZUludChvcHRpb24udmFsdWUpID4gMCkgb3B0aW9uLnJlbW92ZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvLyB0b2RvIHNob3Vsa2QgaGF2ZSBiZWVuIHJlbW92ZWRcbiAgICAgICAgICAgIGVsLnNlbGVjdGVkSW5kZXggPSAwO1xuICAgICAgICAgICAgaWYgKCFlbC50b21zZWxlY3QpIHtcbiAgICAgICAgICAgICAgWyd0b20tc2VsZWN0JywgJ3RvbXNlbGVjdGVkJywgJ3RzLWhpZGRlbi1hY2Nlc3NpYmxlJ10uZm9yRWFjaChjbCA9PiB7XG4gICAgICAgICAgICAgICAgZWwuY2xhc3NMaXN0LnJlbW92ZShjbCk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIGVsLnRvbXNlbGVjdC5kZXN0cm95KCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlICdkaXYnOlxuICAgICAgICAgICAgaWYgKG4gIT09IG51bGwgJiYgZWwuZGF0YXNldC5jb21wb25lbnQpIGVsLnJlbW92ZSgpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgfSlcblxuICAgIH0pXG4gICAgLyogYWRkIGZ1bmN0aW9ubmFsaXRpZXMgKi9cbiAgICBpZiAoc2VwYXIpIHtcbiAgICAgIGxpbmUuY2xhc3NMaXN0LmFkZCgnbmV3Jyk7XG4gICAgICBzZXBhci5hZnRlcihsaW5lKTtcbiAgICB9XG5cbiAgICByZXR1cm4gbGluZTtcbiAgfVxuXG4gIHNldExpbmUobGluZSwgbWIgPSB7XG4gICAga2V5OiAnJyxcbiAgICB2YWx1ZTogJydcbiAgfSwgcHJpdiwgY3QpIHtcblxuICAgIHByaXYgPSBkZWZpbmVkX3ByaXZpbGVnZXNbcHJpdl0gPyBkZWZpbmVkX3ByaXZpbGVnZXNbcHJpdl0gOiBkZWZpbmVkX3ByaXZpbGVnZXMudmlld2VycztcbiAgICBpZiAoIXByaXYpIHJldHVybjtcbiAgICBjb25zdCB7XG4gICAgICBtZW1iZXIsXG4gICAgICBwcml2cyxcbiAgICAgIGNvbnRhY3QsXG4gICAgICBkZWxldFxuICAgIH0gPSB0aGlzLmdldElucHV0cyhsaW5lLCBwcml2KTtcblxuICAgIGlmICghbWVtYmVyIHx8ICFwcml2cyB8fCAhY29udGFjdCB8fCAhZGVsZXQpIHJldHVybjtcbiAgICAvLyBzYW5pdGl6ZVxuICAgIG1iLmtleSA9IERPTVB1cmlmeS5zYW5pdGl6ZShtYi5rZXkpO1xuICAgIG1iLnZhbHVlID0gRE9NUHVyaWZ5LnNhbml0aXplKG1iLnZhbHVlKTtcblxuICAgIGxldCBvcHRpb24gPSBtZW1iZXIucXVlcnlTZWxlY3Rvcignb3B0aW9uW3ZhbHVlPVwiJyArIG1iLmtleSArICdcIl0nKTtcbiAgICBpZiAob3B0aW9uID09PSBudWxsKSB7XG4gICAgICBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcbiAgICAgIG9wdGlvbi52YWx1ZSA9IG1iLmtleTtcbiAgICAgIG9wdGlvbi50ZXh0ID0gbWIudmFsdWU7XG4gICAgICBtZW1iZXIuYXBwZW5kKG9wdGlvbik7XG4gICAgfVxuICAgIG9wdGlvbi5zZWxlY3RlZCA9IHRydWU7XG4gICAgaWYgKCFtZW1iZXIudG9tc2VsZWN0KSB7XG4gICAgICBKc1RvbVNlbGVjdC5hcHBseVRvKG1lbWJlcik7XG4gICAgfVxuICAgIHByaXZzLmNoZWNrZWQgPSB0cnVlO1xuICAgIGNvbnRhY3QudmFsdWUgPSBtYi5rZXk7XG4gICAgaWYgKHByaXYgPT09IHJpZ2h0cy5tYW5hZ2UpIHtcbiAgICAgIGNvbnRhY3QuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgIGlmIChjdCA9PT0gdHJ1ZSAmJiAhY29udGFjdC5jaGVja2VkKSBjb250YWN0LmNoZWNrZWQgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb250YWN0LmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgIGNvbnRhY3QuY2hlY2tlZCA9IGZhbHNlO1xuICAgIH1cblxuICB9XG4gIGdldElucHV0cyhsaW5lLCBwcml2ID0gZmFsc2UpIHtcbiAgICBjb25zdCBtZW1iZXIgPSBsaW5lLnF1ZXJ5U2VsZWN0b3IoXCJbbmFtZSo9J1tcIiArIHRoaXMub3B0aW9ucy5pZGVudCArIFwiXSddXCIpO1xuICAgIGxldCBwcml2cztcbiAgICBpZiAocHJpdikge1xuICAgICAgcHJpdnMgPSBsaW5lLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWUqPVwiWycgKyB0aGlzLm9wdGlvbnMucHJpdmlsZWdlICsgJ11cIl1bdmFsdWU9XCInICsgcHJpdiArICdcIl0nKTtcbiAgICB9IGVsc2UgcHJpdnMgPSBsaW5lLnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0W25hbWUqPVwiWycgKyB0aGlzLm9wdGlvbnMucHJpdmlsZWdlICsgJ11cIl0nKTtcbiAgICBjb25zdCBjb250YWN0ID0gbGluZS5xdWVyeVNlbGVjdG9yKCdpbnB1dFtuYW1lPVwiJyArIHRoaXMub3B0aW9ucy5jb250YWN0ZmllbGRuYW1lICsgJ1wiXScpO1xuICAgIGNvbnN0IGRlbGV0ID0gbGluZS5xdWVyeVNlbGVjdG9yKFwiaW5wdXRbbmFtZSo9J1tcIiArIHRoaXMub3B0aW9ucy5kZWxldCArIFwiXSddXCIpO1xuICAgIHJldHVybiB7XG4gICAgICBtZW1iZXI6IG1lbWJlcixcbiAgICAgIHByaXZzOiBwcml2cyxcbiAgICAgIGNvbnRhY3Q6IGNvbnRhY3QsXG4gICAgICBkZWxldDogZGVsZXRcbiAgICB9O1xuICB9XG4gIGFzeW5jIGltcG9ydFByaXZpbGVnZXMocHJpdmlsZWdlcywgcmVwbGFjZSA9IGZhbHNlLCBjb250YWN0ID0gbnVsbCwgaW1wb3J0ZWR0YWcgPSBudWxsLCBkaXNtaXNzID0gbnVsbCkge1xuICAgIGlmIChyZXBsYWNlID09PSB0cnVlKSB0aGlzLmNsZWFyQWxsKCk7XG4gICAgdHJ5IHtcbiAgICAgIE9iamVjdC5lbnRyaWVzKHByaXZpbGVnZXMpLmZvckVhY2goKFtwcml2LCBtZW1iZXJzXSkgPT4ge1xuICAgICAgICBtZW1iZXJzLmZvckVhY2goKG1lbWJlcikgPT4ge1xuICAgICAgICAgIGNvbnN0IGxhc3RsaW5lID0gdGhpcy5uZXdMaW5lKHRydWUsIG1lbWJlci5pZCk7XG4gICAgICAgICAgaWYgKGxhc3RsaW5lKSB7XG4gICAgICAgICAgICB0aGlzLnNldExpbmUobGFzdGxpbmUsIHtcbiAgICAgICAgICAgICAga2V5OiBtZW1iZXIuaWQsXG4gICAgICAgICAgICAgIHZhbHVlOiBtZW1iZXIubmFtZSxcbiAgICAgICAgICAgIH0sIHByaXYsIChjb250YWN0ICE9PSBudWxsICYmIChjb250YWN0LmlkID09PSBtZW1iZXIuaWQpKSk7XG4gICAgICAgICAgICBpZiAoaW1wb3J0ZWR0YWcpIGltcG9ydGVkdGFnKGxhc3RsaW5lKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmVwbGFjZSA9IGZhbHNlO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgICAgaWYgKGRpc21pc3MpIGRpc21pc3MoKTtcbiAgICAgIEFsZXJ0Qm94LmRpc21pc3NBbGVydCh0aGlzLmtleW1lc3NhZ2VzLmltcG9ydHByaXZlcnJvcik7XG5cbiAgICAgIHRoaXMub3JkZXJSb3dzKCk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIEFsZXJ0Qm94LmFkZEFsZXJ0KHtcbiAgICAgICAgdHlwZTogQWxlcnRCb3guYWxlcnRjb25maWcudHlwZXMuZXJyb3IsXG4gICAgICAgIGNvbnRlbnQ6IHRoaXMua2V5bWVzc2FnZXMuaW1wb3J0cHJpdmVycm9yLFxuICAgICAgICBkaXNtaXNzaWJsZTogdHJ1ZSxcbiAgICAgICAgaW52ZXJzZTogdHJ1ZVxuICAgICAgfSk7XG4gICAgICBjb25zb2xlLmxvZygnZXJyJywgZXJyKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cbiAgYWN0aXZhdGVFdmVudHMobGluZSwgdHMgPSBmYWxzZSkge1xuICAgIGlmICghbGluZSkgcmV0dXJuO1xuICAgIGNvbnN0IHtcbiAgICAgIG1lbWJlcixcbiAgICAgIHByaXZzLFxuICAgICAgY29udGFjdCxcbiAgICAgIGRlbGV0XG4gICAgfSA9IHRoaXMuZ2V0SW5wdXRzKGxpbmUpO1xuICAgIGlmICghbWVtYmVyIHx8ICFwcml2cyB8fCAhY29udGFjdCB8fCAhZGVsZXQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBzaWJsaW5ncyA9IHMgPT4gWy4uLnMucGFyZW50RWxlbWVudC5jaGlsZHJlbl0uZmlsdGVyKGMgPT4gYy5ub2RlVHlwZSA9PSAxICYmIGMgIT0gcyAmJiBjLmNsYXNzTGlzdC5jb250YWlucygncm93JykgJiYgYy5kYXRhc2V0LmJsb2NrICE9PSBudWxsICYmIGMuZGF0YXNldC5ibG9jayA9PT0gdGhpcy5vcHRpb25zLnRhcmdldCk7XG4gICAgLy8gYWN0aXZhdGUgdG9tIHNlbGVjdCBpZiBuZWVkZWRcbiAgICAvLyBlbmFibGUvZGlzYWJsZSBjb250YWN0IHdoZW4gcHJpdmlsZWdlIGNoYW5nZXNcbiAgICBpZiAoIW1lbWJlci5jdXJyZW50bGlzdCkgbWVtYmVyLmN1cnJlbnRsaXN0ID0gdGhpcy5jdXJyZW50bGlzdDtcbiAgICBpZiAobWVtYmVyLnZhbHVlICYmICF0aGlzLmN1cnJlbnRsaXN0W21lbWJlci52YWx1ZV0pIHRoaXMuY3VycmVudGxpc3RbbWVtYmVyLnZhbHVlXSA9IHRydWU7XG4gICAgaWYgKHRzID09PSB0cnVlICYmICFtZW1iZXIudG9tc2VsZWN0KSB7XG4gICAgICBKc1RvbVNlbGVjdC5hcHBseVRvKG1lbWJlcik7XG4gICAgfVxuICAgIGNvbnN0IGxpbmVTZXR0aW5ncyA9IChwciwgY3QsIGRsLCBzeW5jaHJvID0gZmFsc2UpID0+IHtcbiAgICAgIGlmIChwciAmJiBwci5jaGVja2VkKSB7XG4gICAgICAgIHByLmNoZWNrZWQgPSB0cnVlO1xuICAgICAgICBpZiAoQWxlcnRCb3guaGFzTWVzc2FnZShsaW5lKSkgQWxlcnRCb3gucmVtb3ZlTWVzc2FnZSh7XG4gICAgICAgICAgdHlwZTogQWxlcnRCb3guYWxlcnRjb25maWcudHlwZXMuZGFuZ2VyLFxuICAgICAgICAgIHBhcmVudDogbGluZSxcbiAgICAgICAgICBjb250ZW50OiB0aGlzLmtleW1lc3NhZ2VzLnVoYXNub3ByaXZcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBpZiAocHIgJiYgcHIudmFsdWUgPT09IHJpZ2h0cy5tYW5hZ2UpIHtcbiAgICAgICAgLy8gbWFuYWdlciAtIGNhbid0IGRlbGV0ZSBsaW5lIC0gY2FuIGNob29zZSBhcyBjb250YWN0XG4gICAgICAgIGRsLmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgY3QuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgQWxlcnRCb3guZGlzbWlzc0FsZXJ0KHRoaXMua2V5bWVzc2FnZXMubm9tYW5hZ2VyKTtcbiAgICAgICAgaWYgKGN0LmNoZWNrZWQpIHtcbiAgICAgICAgICBBbGVydEJveC5kaXNtaXNzQWxlcnQodGhpcy5rZXltZXNzYWdlcy5ub2NvbnRhY3QpO1xuICAgICAgICAgIGN0LmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCd2YWxpZCcpKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gbm90IG1hbmFnZXIgLSBjYW4gZGVsZXQgbGluZSAtIGNhbm5vdCBjaG9zZSBhcyBjb250YWN0XG4gICAgICAgIGN0LmNoZWNrZWQgPSBmYWxzZTtcbiAgICAgICAgZGwuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgY3QuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgfVxuXG4gICAgICBpZiAoc3luY2hybyA9PT0gdHJ1ZSkge1xuICAgICAgICBzeW5jaHJvU2libGluZ3MobGluZSk7XG4gICAgICB9XG4gICAgICAvLyBkaXNtaXNzIGFsZXJ0c1xuICAgICAgaWYgKCFkbC5ja2Vja2VkKSB7XG4gICAgICAgIEFsZXJ0Qm94LmRpc21pc3NBbGVydCh0aGlzLmtleW1lc3NhZ2VzLm5vYm9keSk7XG4gICAgICAgIGlmIChBbGVydEJveC5oYXNNZXNzYWdlKGxpbmUpKSBBbGVydEJveC5yZW1vdmVNZXNzYWdlKHtcbiAgICAgICAgICB0eXBlOiBBbGVydEJveC5hbGVydGNvbmZpZy50eXBlcy5kYW5nZXIsXG4gICAgICAgICAgcGFyZW50OiBsaW5lLFxuICAgICAgICAgIGNvbnRlbnQ6IHRoaXMua2V5bWVzc2FnZXMub25lYXRsZWFzdFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgY29uc3Qgc3luY2hyb1NpYmxpbmdzID0gKGxpbmUpID0+IHtcbiAgICAgIGNvbnN0IGxucyA9IHNpYmxpbmdzKGxpbmUpO1xuICAgICAgbG5zLmZvckVhY2goKGxuKSA9PiB7XG4gICAgICAgIGNvbnN0IGRsID0gbG4ucXVlcnlTZWxlY3RvcihcImlucHV0W25hbWUqPSdbXCIgKyB0aGlzLm9wdGlvbnMuZGVsZXQgKyBcIl0nXVwiKTtcbiAgICAgICAgY29uc3QgY3QgPSBsbi5xdWVyeVNlbGVjdG9yKCdpbnB1dFtuYW1lPVwiJyArIHRoaXMub3B0aW9ucy5jb250YWN0ZmllbGRuYW1lICsgJ1wiXScpO1xuICAgICAgICBjb25zdCBwciA9IGxuLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWUqPVwiWycgKyB0aGlzLm9wdGlvbnMucHJpdmlsZWdlICsgJ11cIl06Y2hlY2tlZCcpO1xuICAgICAgICBsaW5lU2V0dGluZ3MocHIsIGN0LCBkbCwgZmFsc2UpO1xuXG4gICAgICB9KVxuICAgIH1cblxuICAgIG1lbWJlci5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoZSkgPT4ge1xuICAgICAgY29udGFjdC52YWx1ZSA9IG1lbWJlci52YWx1ZTtcbiAgICAgIGlmIChwYXJzZUludChtZW1iZXIudmFsdWUpID4gMCAmJiBBbGVydEJveC5oYXNNZXNzYWdlKG1lbWJlcikpIEFsZXJ0Qm94LnJlbW92ZU1lc3NhZ2Uoe1xuICAgICAgICB0eXBlOiBBbGVydEJveC5hbGVydGNvbmZpZy50eXBlcy5kYW5nZXIsXG4gICAgICAgIHBhcmVudDogbWVtYmVyLFxuICAgICAgICBjb250ZW50OiB0aGlzLmtleW1lc3NhZ2VzLmVtcHR5bmFtZVxuICAgICAgfSk7XG4gICAgfSlcbiAgICBwcml2cy5mb3JFYWNoKChwcml2KSA9PiB7XG4gICAgICBpZiAocHJpdi5kYXRhc2V0Lmhhc093blByb3BlcnR5KFwicmVhZG9ubHlcIikpIGlucHV0X3JlYWRfb25seShwcml2KTtcbiAgICAgIHByaXYuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKGUpID0+IHtcbiAgICAgICAgaWYgKHByaXYuY2hlY2tlZCkgbGluZVNldHRpbmdzKHByaXYsIGNvbnRhY3QsIGRlbGV0LCBmYWxzZSk7XG4gICAgICB9KTtcblxuICAgICAgaWYgKHByaXYuY2hlY2tlZCkgbGluZVNldHRpbmdzKHByaXYsIGNvbnRhY3QsIGRlbGV0LCBmYWxzZSk7XG4gICAgfSlcbiAgICBpZiAoY29udGFjdC5kYXRhc2V0Lmhhc093blByb3BlcnR5KFwicmVhZG9ubHlcIikpIGlucHV0X3JlYWRfb25seShjb250YWN0KTtcbiAgICBjb250YWN0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIChlKSA9PiB7XG4gICAgICBpZiAoY29udGFjdC5jaGVja2VkKSB7XG4gICAgICAgIGRlbGV0LmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgIH0gZWxzZSBkZWxldC5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgY29uc3QgcHJpdiA9IGxpbmUucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZSo9XCJbJyArIHRoaXMub3B0aW9ucy5wcml2aWxlZ2UgKyAnXVwiXTpjaGVja2VkJyk7XG4gICAgICBsaW5lU2V0dGluZ3MocHJpdiwgY29udGFjdCwgZGVsZXQsIHRydWUpO1xuICAgICAgLy8gZW5hYmxlIG90aGVyd2lzZVxuICAgIH0pXG4gICAgLy8gZGVsZXQgb2sgZm9yIGFsbCB3aGVuIG5ldyBsaW5lXG4gICAgLy9cblxuICAgIGRlbGV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgIC8vIGF0IGxlYXN0IG9uZSBwcml2IGxpbmVcbiAgICAgIGNvbnN0IGRlbGV0bGFiZWwgPSBkZWxldC5jbG9zZXN0KCdsYWJlbCcpO1xuICAgICAgY29uc3QgbGluZXMgPSB0aGlzLmZpZWxkc2V0LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLWJsb2NrPVwiJyArIHRoaXMub3B0aW9ucy50YXJnZXQgKyAnXCJdOm5vdChbZGF0YS1tb2Q9XCJyZW1vdmVcIl0pJyk7XG4gICAgICBpZiAobGluZXMubGVuZ3RoIDw9IDEgJiYgZS50YXJnZXQuY2hlY2tlZCkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGxpbmUucmVtb3ZlQXR0cmlidXRlKCdkYXRhLW1vZCcpO1xuICAgICAgICBtZW1iZXIuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgZS50YXJnZXQuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICBBbGVydEJveC5hZGRNZXNzYWdlKHtcbiAgICAgICAgICB0eXBlOiBBbGVydEJveC5hbGVydGNvbmZpZy50eXBlcy5kYW5nZXIsXG4gICAgICAgICAgcGFyZW50OiBsaW5lLFxuICAgICAgICAgIGNvbnRlbnQ6IHRoaXMua2V5bWVzc2FnZXMub25lYXRsZWFzdCxcbiAgICAgICAgICBkdXJhdGlvbjogMzAwMFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfSBlbHNlIGlmIChlLnRhcmdldC5jaGVja2VkKSB7XG4gICAgICAgIGlmIChBbGVydEJveC5oYXNNZXNzYWdlKG1lbWJlcikpIEFsZXJ0Qm94LnJlbW92ZU1lc3NhZ2Uoe1xuICAgICAgICAgIHR5cGU6IEFsZXJ0Qm94LmFsZXJ0Y29uZmlnLnR5cGVzLmRhbmdlcixcbiAgICAgICAgICBwYXJlbnQ6IG1lbWJlclxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKGxpbmUuY2xhc3NMaXN0LmNvbnRhaW5zKCduZXcnKSkge1xuICAgICAgICAgIGxpbmUucmVtb3ZlKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKGRlbGV0bGFiZWwgJiYgZGVsZXRsYWJlbC5kYXRhc2V0LnJlc3RvcmUpIGRlbGV0bGFiZWwuZGF0YXNldC50aXRsZSA9IGRlbGV0bGFiZWwuZGF0YXNldC5yZXN0b3JlO1xuICAgICAgICAgIGxpbmUuc2V0QXR0cmlidXRlKCdkYXRhLW1vZCcsICdyZW1vdmUnKTtcbiAgICAgICAgICBwcml2cy5mb3JFYWNoKHByaXYgPT4ge1xuICAgICAgICAgICAgcHJpdi5kYXRhc2V0LmNoZWNrZWQgPSBwcml2LmNoZWNrZWQ7XG4gICAgICAgICAgICBwcml2LmNoZWNrZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIHByaXYuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgY29udGFjdC5jaGVja2VkID0gZmFsc2U7XG4gICAgICAgICAgY29udGFjdC5kaXNhYmxlZCA9IHRydWU7XG4gICAgICAgICAgbWVtYmVyLmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGRlbGV0bGFiZWwgJiYgZGVsZXRsYWJlbC5kYXRhc2V0LnJlbW92ZSkgZGVsZXRsYWJlbC5kYXRhc2V0LnRpdGxlID0gZGVsZXRsYWJlbC5kYXRhc2V0LnJlbW92ZTtcbiAgICAgICAgbGluZS5yZW1vdmVBdHRyaWJ1dGUoJ2RhdGEtbW9kJyk7XG4gICAgICAgIHByaXZzLmZvckVhY2gocHJpdiA9PiB7XG4gICAgICAgICAgcHJpdi5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgICAgIGlmIChwcml2LmRhdGFzZXQuY2hlY2tlZCA9PT0gXCJ0cnVlXCIpIHByaXYuY2hlY2tlZCA9IHRydWU7XG4gICAgICAgICAgZWxzZSBwcml2LmNoZWNrZWQgPSBmYWxzZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgbWVtYmVyLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICB9XG4gICAgfSk7XG4gICAgLy8gZGVsZXQgbW91c2VvdmVyIC0gZXhwbGFpbiB3aHkgaXQgaXMgZGlzYWJsZWQgd2hlbiBtYW5hZ2UgaXMgY2hlY2tlZFxuICAgIGRlbGV0LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlb3ZlcicsIChlKSA9PiB7XG4gICAgICBpZiAoZS50YXJnZXQuZGlzYWJsZWQpIHtcbiAgICAgICAgbGV0IHByID0gbGluZS5xdWVyeVNlbGVjdG9yKCdpbnB1dFtuYW1lKj1cIlsnICsgdGhpcy5vcHRpb25zLnByaXZpbGVnZSArICddXCJdOmNoZWNrZWQnKTtcbiAgICAgICAgaWYgKCFwcikgcmV0dXJuO1xuICAgICAgICBwciA9IHByLnZhbHVlLnRvTG93ZXJDYXNlKClcbiAgICAgICAgZS50YXJnZXQuZGF0YXNldC50aXRsZSA9IChlLnRhcmdldC5kYXRhc2V0W3ByXSkgPyBlLnRhcmdldC5kYXRhc2V0W3ByXSA6IGUudGFyZ2V0LmRhdGFzZXQudGl0bGVcbiAgICAgIH1cbiAgICB9KVxuICAgIC8vIGRpc2FibGUgZGVsZXQgaWYgdXNlciBpcyB0aGUgb25seSBtYW5hZ2VyXG4gICAgaWYgKHRoaXMuY3VycmVudF91aWQgPT09IG1lbWJlci52YWx1ZSkgZGVsZXQuZGlzYWJsZWQgPSB0cnVlO1xuICB9XG5cbiAgdmFsaWRhdGVGaWVsZHMoYWRkID0gZmFsc2UpIHsgLy8gY2hlY2sgbWFuYWdlcnMgYW5kIGNvbnRhY3RfdXNlcl9pZCBvbiBzdWJtaXRcbiAgICBjb25zdCBjaGVja19jb250YWN0ID0gKCkgPT4ge1xuICAgICAgLy8gY2hlY2sgaWYgb25lIG1hbmFnZXIgYXQgbGVhc3RcbiAgICAgIGNvbnN0IG1hbmFnZXJzID0gdGhpcy5maWVsZHNldC5xdWVyeVNlbGVjdG9yQWxsKCdbbmFtZSo9XCJbJyArIHRoaXMub3B0aW9ucy5wcml2aWxlZ2UgKyAnXVwiXVt2YWx1ZT1cIicgKyByaWdodHMubWFuYWdlICsgJ1wiXTpjaGVja2VkJyk7XG4gICAgICBpZiAobWFuYWdlcnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIEFsZXJ0Qm94LmFkZEFsZXJ0KHtcbiAgICAgICAgICB0eXBlOiBBbGVydEJveC5hbGVydGNvbmZpZy50eXBlcy5kYW5nZXIsXG4gICAgICAgICAgY29udGVudDogdGhpcy5rZXltZXNzYWdlcy5ub21hbmFnZXIsXG4gICAgICAgICAgZGlzbWlzc2libGU6IHRydWUsXG4gICAgICAgICAgaW52ZXJzZTogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy50YWJFcnJvcih0cnVlKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgQWxlcnRCb3guZGlzbWlzc0FsZXJ0KHRoaXMua2V5bWVzc2FnZXMubm9tYW5hZ2VyKTtcbiAgICAgICAgdGhpcy50YWJFcnJvcihmYWxzZSk7XG4gICAgICB9XG4gICAgICAvLyBjaGVjayBjb250YWN0XG5cbiAgICAgIGNvbnN0IGNvbnRhY3QgPSB0aGlzLmZpZWxkc2V0LnF1ZXJ5U2VsZWN0b3IoJ1tuYW1lPVwiJyArIHRoaXMub3B0aW9ucy5jb250YWN0ZmllbGRuYW1lICsgJ1wiXTpjaGVja2VkJyk7XG4gICAgICBpZiAoY29udGFjdCA9PT0gbnVsbCkge1xuICAgICAgICBBbGVydEJveC5hZGRBbGVydCh7XG4gICAgICAgICAgdHlwZTogQWxlcnRCb3guYWxlcnRjb25maWcudHlwZXMuZGFuZ2VyLFxuICAgICAgICAgIGNvbnRlbnQ6IHRoaXMua2V5bWVzc2FnZXMubm9jb250YWN0LFxuICAgICAgICAgIGRpc21pc3NpYmxlOiB0cnVlLFxuICAgICAgICAgIGludmVyc2U6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMudGFiRXJyb3IodHJ1ZSk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIEFsZXJ0Qm94LmRpc21pc3NBbGVydCh0aGlzLmtleW1lc3NhZ2VzLm5vY29udGFjdCk7XG4gICAgICB0aGlzLnRhYkVycm9yKGZhbHNlKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBjb25zdCBoYXNfbWVtYmVyID0gKG1lbWJlcikgPT4ge1xuICAgICAgICByZXR1cm4gKG1lbWJlci52YWx1ZSAmJiBwYXJzZUludChtZW1iZXIudmFsdWUpPjApO1xuICAgIH1cbiAgICBjb25zdCBoYXNfcHJpdiA9IChsaW5lKSA9PiB7XG4gICAgICBjb25zdCBwcml2ID0gbGluZS5xdWVyeVNlbGVjdG9yKCdbbmFtZSo9XCJbJyArIHRoaXMub3B0aW9ucy5wcml2aWxlZ2UgKyAnXVwiXTpjaGVja2VkJyk7XG4gICAgICBpZiAocHJpdiAmJiBwcml2LnZhbHVlKSByZXR1cm4gdHJ1ZTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uc3QgbGluZXMgPSB0aGlzLmZpZWxkc2V0LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLWJsb2NrPVwiJyArIHRoaXMub3B0aW9ucy50YXJnZXQgKyAnXCJdJyk7XG4gICAgbGV0IG4gPSBsaW5lcy5sZW5ndGg7XG4gICAgbGV0IHZlcmlmID0gdHJ1ZTtcbiAgICBmb3IgKGNvbnN0IGxpbmUgb2YgbGluZXMpIHtcbiAgICAgIGNvbnN0IG1lbWJlciA9IGxpbmUucXVlcnlTZWxlY3RvcignW25hbWUqPVwiWycgKyB0aGlzLm9wdGlvbnMuaWRlbnQgKyAnXVwiXScpO1xuICAgICAgaWYgKGxpbmUuZGF0YXNldC5oYXNPd25Qcm9wZXJ0eShcIm1vZGVsXCIpIHx8IGxpbmUuZGF0YXNldC5tb2QgJiYgbGluZS5kYXRhc2V0Lm1vZCA9PT0gJ3JlbW92ZScpIHtcbiAgICAgICAgaWYgKG4gPiAxKSB7XG4gICAgICAgICAgbGluZS5yZW1vdmUoKTtcbiAgICAgICAgICBuLS07XG4gICAgICAgIH0gZWxzZSByZXR1cm4gZmFsc2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgaWYgKCFoYXNfbWVtYmVyKG1lbWJlcikpIHtcbiAgICAgICAgQWxlcnRCb3guYWRkTWVzc2FnZSh7XG4gICAgICAgICAgdHlwZTogQWxlcnRCb3guYWxlcnRjb25maWcudHlwZXMuZGFuZ2VyLFxuICAgICAgICAgIHBhcmVudDogbWVtYmVyLFxuICAgICAgICAgIGNvbnRlbnQ6IHRoaXMua2V5bWVzc2FnZXMuZW1wdHluYW1lXG4gICAgICAgIH0pO1xuICAgICAgICBtZW1iZXIuZm9jdXMoKTtcbiAgICAgICAgY29uc3QgcmVzcCA9IGZhbHNlOyAvLyBubyBjb25maW1ib3gganVzdCB3YWl0IGZvciB1c2VyIGFjdGlvblxuICAgICAgICAvLyBjYWxsYmFjayBpZiBjb25maXJtYm94IHJlc3BvbnNlIGlzIGNob3NlbiBpZiAnY29uZmlybSdcbiAgICAgICAgaWYgKHJlc3AgPT09IHRydWUpIHtcbiAgICAgICAgICBpZiAobiA+IDEpIHtcbiAgICAgICAgICAgIGxpbmUucmVtb3ZlKCk7XG4gICAgICAgICAgICBuLS07XG4gICAgICAgICAgfSBlbHNlIHJldHVybiBmYWxzZTtcbiAgICAgICAgfSBlbHNlIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgaWYgKCFoYXNfcHJpdihsaW5lKSkge1xuICAgICAgICBBbGVydEJveC5hZGRNZXNzYWdlKHtcbiAgICAgICAgICB0eXBlOiBBbGVydEJveC5hbGVydGNvbmZpZy50eXBlcy5kYW5nZXIsXG4gICAgICAgICAgcGFyZW50OiBsaW5lLFxuICAgICAgICAgIGNvbnRlbnQ6IHRoaXMua2V5bWVzc2FnZXMudWhhc25vcHJpdlxuICAgICAgICB9KTtcbiAgICAgICAgdmVyaWYgPSBmYWxzZTtcbiAgICAgIH0gIGVsc2UgaWYgKEFsZXJ0Qm94Lmhhc01lc3NhZ2UobGluZSkpIHtcbiAgICAgICAgQWxlcnRCb3gucmVtb3ZlTWVzc2FnZSh7XG4gICAgICAgICAgdHlwZTogQWxlcnRCb3guYWxlcnRjb25maWcudHlwZXMuZGFuZ2VyLFxuICAgICAgICAgIHBhcmVudDogbGluZSxcbiAgICAgICAgICBjb250ZW50OiB0aGlzLmtleW1lc3NhZ2VzLnVoYXNub3ByaXZcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChuID09PSAwKSB7XG4gICAgICBBbGVydEJveC5hZGRBbGVydCh7XG4gICAgICAgIHR5cGU6IEFsZXJ0Qm94LmFsZXJ0Y29uZmlnLnR5cGVzLmRhbmdlcixcbiAgICAgICAgY29udGVudDogdGhpcy5rZXltZXNzYWdlcy5ub2JvZHksXG4gICAgICAgIGRpc21pc3NpYmxlOiB0cnVlLFxuICAgICAgICBpbnZlcnNlOiB0cnVlXG4gICAgICB9KTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9IGVsc2UgQWxlcnRCb3guZGlzbWlzc0FsZXJ0KHRoaXMua2V5bWVzc2FnZXMubm9ib2R5KTtcbiAgICBjb25zdCBoYXNjb250YWN0ID0gdGhpcy5maWVsZHNldC5kYXRhc2V0Lmhhc093blByb3BlcnR5KFwicmVhZG9ubHlcIikgfHwgY2hlY2tfY29udGFjdCgpO1xuICAgIHJldHVybiAoaGFzY29udGFjdCAmJiB2ZXJpZik7XG4gIH1cblxuICBmb3JtYXRQcml2aWxlZ2VzKCkge1xuICAgIGNvbnN0IGxpbmVzID0gdGhpcy5maWVsZHNldC5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1ibG9jaz1cIicgKyB0aGlzLm9wdGlvbnMudGFyZ2V0ICsgJ1wiXScpO1xuICAgIGNvbnN0IGZvcm1hdF9wcml2aWxlZ2UgPSAobGluZSkgPT4ge1xuICAgICAgY29uc3QgZWxzID0gbGluZS5xdWVyeVNlbGVjdG9yQWxsKCdbbmFtZSo9XCJtZW1iZXJzW1wiJyk7XG4gICAgICBlbHMuZm9yRWFjaCgoZWwpID0+IHtcbiAgICAgICAgbGV0IG5hbWUgPSBlbC5uYW1lO1xuICAgICAgICBuYW1lID0gbmFtZS5zcGxpdCgnWycpO1xuICAgICAgICBuYW1lLnBvcCgpO1xuICAgICAgICBlbC5uYW1lID0gbmFtZS5qb2luKCdbJyk7XG4gICAgICAgIGlmIChlbC5uYW1lLmluZGV4T2YoJ1snICsgdGhpcy5vcHRpb25zLnByaXZpbGVnZSArICddJykgPiAwKSB7XG4gICAgICAgICAgZWwudHlwZSA9ICdjaGVja2JveCc7XG4gICAgICAgICAgZWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7XG4gICAgICAgIH1cblxuICAgICAgfSk7XG4gICAgfVxuICAgIGxpbmVzLmZvckVhY2gobGluZSA9PiB7XG4gICAgICBmb3JtYXRfcHJpdmlsZWdlKGxpbmUpO1xuICAgIH0pO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cblxuICBnZXRMaW5lUHJpdmlsZWdlKGlkKSB7XG4gICAgbGV0IHByaXZpbGVnZSA9IG51bGw7XG4gICAgY29uc3QgbGluZXMgPSB0aGlzLmZpZWxkc2V0LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLWJsb2NrPVwiJyArIHRoaXMub3B0aW9ucy50YXJnZXQgKyAnXCJdJylcbiAgICBmb3IgKGNvbnN0IGxpbmUgb2YgbGluZXMpIHtcbiAgICAgIGlmIChwYXJzZUludChsaW5lLnF1ZXJ5U2VsZWN0b3IoJ1tuYW1lKj1cIlsnICsgdGhpcy5vcHRpb25zLmlkZW50ICsgJ11cIl0nKS52YWx1ZSkgPT09IHBhcnNlSW50KGlkKSkge1xuICAgICAgICBwcml2aWxlZ2UgPSBsaW5lO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gcHJpdmlsZWdlO1xuICB9XG4gIGNsZWFyQWxsKCkge1xuICAgIGxldCBsaW5lcyA9IHRoaXMuZmllbGRzZXQucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtYmxvY2s9XCInICsgdGhpcy5vcHRpb25zLnRhcmdldCArICdcIl0nKTtcbiAgICBsaW5lcy5mb3JFYWNoKChsaW5lLCBpbmRleCkgPT4ge1xuICAgICAgbGluZS5yZW1vdmUoKTtcbiAgICB9KTtcblxuICB9XG4gIG9yZGVyUm93cygpIHtcbiAgICBjb25zdCBsaW5lcyA9IEFycmF5LmZyb20odGhpcy5maWVsZHNldC5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1ibG9jaz1cIicgKyB0aGlzLm9wdGlvbnMudGFyZ2V0ICsgJ1wiXScpKTtcbiAgICBpZiAobGluZXMubGVuZ3RoID4gMikge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcmlnaHRzc29ydGVkID0gT2JqZWN0LnZhbHVlcyhyaWdodHMpO1xuICAgICAgICBsaW5lcy5zb3J0KChsaW5lYSwgbGluZWIpID0+IHtcbiAgICAgICAgICBjb25zdCBhID0gdGhpcy5nZXRJbnB1dHMobGluZWEpO1xuICAgICAgICAgIGNvbnN0IGIgPSB0aGlzLmdldElucHV0cyhsaW5lYik7XG4gICAgICAgICAgY29uc3QgbmFtZWIgPSBuZXcgU3RyaW5nKGIubWVtYmVyLm9wdGlvbnNbYi5tZW1iZXIuc2VsZWN0ZWRJbmRleF0udGV4dCkudG9Mb3dlckNhc2UoKS5zcGxpdCgnICcpXG4gICAgICAgICAgY29uc3QgbmFtZWEgPSBuZXcgU3RyaW5nKGEubWVtYmVyLm9wdGlvbnNbYS5tZW1iZXIuc2VsZWN0ZWRJbmRleF0udGV4dCkudG9Mb3dlckNhc2UoKS5zcGxpdCgnICcpO1xuICAgICAgICAgIGNvbnN0IHByaXZhID0gQXJyYXkuZnJvbShhLnByaXZzKS5maWx0ZXIocHJpdiA9PiAocHJpdi5jaGVja2VkKSk7XG4gICAgICAgICAgY29uc3QgcHJpdmIgPSBBcnJheS5mcm9tKGIucHJpdnMpLmZpbHRlcihwcml2ID0+IChwcml2LmNoZWNrZWQpKTtcbiAgICAgICAgICBjb25zdCBjb21wYSA9ICgrIWEuY29udGFjdC5jaGVja2VkKSArIGAgYCArIHJpZ2h0c3NvcnRlZC5pbmRleE9mKCgocHJpdmEubGVuZ3RoKSA/IHByaXZhWzBdLnZhbHVlIDogbnVsbCkpICsgYCBgICsgKChuYW1lYS5sZW5ndGggPiAxKSA/IG5hbWVhLnBvcCgpICsgYCBgICsgbmFtZWFbMF0gOiBuYW1lYVswXSk7XG4gICAgICAgICAgY29uc3QgY29tcGIgPSAoKyFiLmNvbnRhY3QuY2hlY2tlZCkgKyBgIGAgKyByaWdodHNzb3J0ZWQuaW5kZXhPZigoKHByaXZiLmxlbmd0aCkgPyBwcml2YlswXS52YWx1ZSA6IG51bGwpKSArIGAgYCArICgobmFtZWIubGVuZ3RoID4gMSkgPyBuYW1lYi5wb3AoKSArIGAgYCArIG5hbWViWzBdIDogbmFtZWJbMF0pO1xuICAgICAgICAgIGlmIChjb21wYiA+IGNvbXBhKSByZXR1cm4gLTE7XG4gICAgICAgICAgZWxzZSBpZiAoY29tcGEgPiBjb21wYikgcmV0dXJuIDE7XG4gICAgICAgICAgZWxzZSByZXR1cm4gMDtcbiAgICAgICAgfSlcbiAgICAgICAgY29uc3QgY2xvbmUgPSB0aGlzLmxpbmVjb250YWluZXI7XG4gICAgICAgIGxpbmVzLmZvckVhY2goKGxpbmUsIGkpID0+IHtcbiAgICAgICAgICBjbG9uZS5hcHBlbmRDaGlsZChsaW5lKTtcbiAgICAgICAgfSk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2VyciBub3Qgc29ydGVkJywgZXJyKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICB0YWJFcnJvcihvbikge1xuICAgIGNvbnN0IHRhYiA9ICh0aGlzLmZpZWxkc2V0LmNsYXNzTGlzdC5jb250YWlucyhkb21zZWxlY3RvcnMuY29tcG9uZW50LnRhYnMudGFiLnN1YnN0cigxKSkpID8gdGhpcy5maWVsZHNldCA6ICgodGhpcy5maWVsZHNldC5wYXJlbnRFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucyhkb21zZWxlY3RvcnMuY29tcG9uZW50LnRhYnMudGFiLnN1YnN0cigxKSkpID8gdGhpcy5maWVsZHNldC5wYXJlbnRFbGVtZW50IDogbnVsbCk7XG4gICAgaWYgKHRhYiA9PT0gbnVsbCkgcmV0dXJuO1xuICAgIGlmIChvbiA9PT0gdHJ1ZSkgdGFiLmNsYXNzTGlzdC5hZGQoY3NzLmVycm9yKTtcbiAgICBlbHNlIHRhYi5jbGFzc0xpc3QucmVtb3ZlKGNzcy5lcnJvcik7XG4gIH1cbn0iXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/modules/project-privileges.js\n\n}")}}]);