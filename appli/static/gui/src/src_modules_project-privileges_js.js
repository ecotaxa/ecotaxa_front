/*! For license information please see src_modules_project-privileges_js.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["src_modules_project-privileges_js"],{"./src/modules/form-submit.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   FormSubmit: () => (/* binding */ FormSubmit)\n/* harmony export */ });\n/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! dompurify */ \"./node_modules/dompurify/dist/purify.js\");\n/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(dompurify__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../modules/modules-config.js */ \"./src/modules/modules-config.js\");\n/* harmony import */ var _modules_utils_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../modules/utils.js */ \"./src/modules/utils.js\");\n\n\nconst formcss = {\n  invalid: 'input-invalid',\n  inputvalidate: 'input-valid',\n}\n;\n\n_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.domselectors[\"captcha\"] = '.js-captcha';\n\nclass FormSubmit {\n  handlers = [];\n  form = null;\n  listener = null;\n  constructor(form, options = {}) {\n    if (!form) return;\n    if (!form.formsubmit) {\n      this.form = form instanceof HTMLElement ? form : document.querySelector(form);\n      const defaultOptions = {\n        fetch: null,\n      };\n      options = Object.assign(options, this.form.dataset);\n      this.options = Object.assign(defaultOptions, options);\n      if (!this.form) return;\n      this.tabs = this.form.querySelectorAll(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.domselectors.component.tabs.tab);\n      this.validateFields(true);\n      this.init();\n\n      form.formsubmit = this;\n    }\n    return form.formsubmit;\n  }\n  init() {\n    // init the form ( options like beforeunload etc...)\n    this.form.addEventListener('keypress', (e) => {\n      // prevent enter submit\n      if (e.key === 'Enter' && e.target instanceof HTMLInputElement) e.preventDefault();\n    });\n\n    this.form.addEventListener('submit', async (e) => {\n      e.preventDefault();\n      const res = await this.submitForm();\n      return res;\n    });\n    this.specialFields();\n  }\n  specialFields() {\n    // check if there is a password confirm input\n    // add show text for password fields\n\n    this.form.querySelectorAll('input[data-match]').forEach(input => {\n      //\n      const match = input.dataset.match;\n      if (!match) return;\n      const target = document.getElementById(match);\n      if (!target) return;\n      const invalid = (input.dataset.matchinvalid) ? input.dataset.matchinvalid : \"no match\";\n      const check_match = (item, itemtarget) => {\n        const label = (input.previousElementSibling && input.previousElementSibling.tagName.toLowerCase() == 'label') ? input.previousElementSibling : null;\n        const labeltarget = (target.previousElementSibling && target.previousElementSibling.tagName.toLowerCase() == 'label') ? target.previousElementSibling : null;\n        const {\n          patternMismatch = false\n        } = item.validity;\n        const customvalidity = (patternMismatch) ? this.get_message(item, 'invalid') : ``;\n        if (item.checkValidity() === true) {\n          item.dataset.invalid = '';\n          item.setCustomValidity('');\n          if (item == input && label !== null) label.classList.remove(formcss.invalid);\n          else if (labeltarget !== null) labeltarget.classList.remove(formcss.invalid);\n          item.classList.remove(formcss.inputvalidate);\n          if (item.value !== itemtarget.value) {\n            input.setCustomValidity(invalid);\n            if (label) {\n              label.dataset.invalid = (label.dataset.invalid) ? label.dataset.invalid : invalid;\n              label.classList.add(formcss.invalid);\n            }\n            input.classList.add(formcss.inputvalidate);\n          } else {\n            input.setCustomValidity(\"\");\n            if (label) label.classList.remove(formcss.invalid);\n            input.classList.remove(formcss.inputvalidate);\n          }\n        } else {\n          item.setCustomValidity(customvalidity);\n          item.dataset.invalid = customvalidity;\n          if (label) label.classList.add(formcss.invalid);\n          item.classList.add(formcss.inputvalidate);\n        }\n        item.focus();\n      };\n      [input, target].forEach(item => {\n        item.addEventListener('keyup', (e) => {\n          const itemtarget = (item === input) ? target : input;\n          check_match(item, itemtarget);\n        });\n      });\n\n    });\n  }\n  get_message(field, type = 'invalid') {\n    if (field.checkValidity() == false) {\n      const {\n        valueMissing = true\n      } = field.validity;\n      if (valueMissing) return `* ` + ((field.dataset.required) ? field.dataset.required : ((this.form.dataset.required) ? this.form.dataset.required : 'required'));\n      else return (field.dataset[type]) ? field.dataset[type] : 'input invalid';\n    } else return '';\n  }\n\n  validateField(field, init = false) {\n\n\n\n    if (['textarea', 'input'].indexOf(field.tagName.toLowerCase()) >= 0) {\n\n    }\n\n    if (['select', 'input[type=\"checkbox\"]'].indexOf(field.tagName.toLowerCase()) >= 0) {\n      field.querySelectorAll('option:checked').forEach(option => {\n        option.value = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_2__.decode_HTMLEntities)(dompurify__WEBPACK_IMPORTED_MODULE_0___default().sanitize(option.value));\n      });\n\n    } else field.value = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_2__.decode_HTMLEntities)(dompurify__WEBPACK_IMPORTED_MODULE_0___default().sanitize(field.value));\n\n    const rep = field.checkValidity();\n    const label = this.getFieldLabel(field);\n    if (label) {\n      if (rep) {\n        label.classList.remove(formcss.invalid);\n      } else if (!rep) {\n        label.dataset.invalid = this.get_message(field);\n        label.classList.add(formcss.invalid);\n        window.scrollTo({\n          top: parseInt(label.offsetTop),\n          left: parseInt(label.offsetLeft),\n          behavior: 'smooth'\n        });\n      }\n    }\n    return rep;\n  }\n  getFieldLabel(field) {\n    return (field.closest('.form-box')) ? ((field.closest('.form-box').querySelector('.label')) ? field.closest('.form-box').querySelector('.label') : field.closest('.form-box').querySelector('label')) : null;\n  }\n  validateFields(init = false) {\n    //todo: complete validation foreach field type\n    let resp = true;\n    // .required input for tom-select component\n\n    [...this.form.elements].forEach(field => {\n      if (field.name) {\n        if (init === true) {\n          if (!field.dataset.listen) {\n            if (field.hasAttribute('required') && field.required) {\n              const label = this.getFieldLabel(field);\n              if (label) label.classList.add('required');\n            }\n\n            ['change', 'blur'].forEach(evt => {\n              field.addEventListener(evt, (e) => {\n                this.validateField(e.currentTarget, init);\n              });\n            });\n            field.dataset.listen = true;\n          }\n        } else resp = (resp && this.validateField(field, init));\n\n      }\n    });\n    // add/remove error class on tabs tab-control elements\n\n    this.tabs.forEach(tab => {\n      if (tab.querySelector(':invalid') || tab.querySelector(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.domselectors.component.alert.danger)) tab.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.error);\n      else tab.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.error);\n    });\n    return resp;\n  }\n\n  addHandler(handler) {\n    this.handlers.push(handler);\n  }\n  fieldEnable(enable = true) {\n    this.form.querySelectorAll('input[data-sub=\"enable\"]').forEach(input => {\n      if (enable === true) {\n        input.disabled = false;\n      } else input.disabled = true;\n    });\n  }\n\n  async submitHandler() {\n    if (!this.validateFields()) return false;\n\n    if (this.handlers.length === 0) return true;\n    let resp = true;\n    // series\n    /*  for (const handler of this.handlers) {\n          const rep = await handler()\n          resp = (resp && rep)\n      }*/\n    // concurrent\n    await Promise.all(this.handlers.map(async handler => {\n      const rep = await handler();\n      resp = (resp && rep);\n    }));\n    if (resp === true) this.handlers = [];\n    return resp;\n  }\n  // no redirection when using data-fetch\n  formFetch(format = null) {\n    const formdata = new FormData(this.form);\n    formdata[\"fetch\"] = true;\n    fetch(this.form.action, (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_2__.fetchSettings)({\n        method: 'POST',\n        body: formdata,\n      }))\n      .then(response => {\n        switch (format) {\n          case \"text\":\n          case \"html\":\n            return response.text();\n            break;\n          default:\n            return response.json();\n        }\n      })\n      .then(response => {\n        this.displayResponse(response);\n      })\n      .catch(err => {\n        this.displayResponse(err, true)\n      }).finally(response => {\n        this.form.disabled = true;\n      });\n    return false;\n  }\n\n  async submitForm() {\n    this.fieldEnable();\n    if (this.validateFields(false)) {\n      const isbot = (this.form.querySelector(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.domselectors.captcha)) ? (this.form.dataset.isbot ? (this.form.dataset.isbot === true) : true) : false;\n      if (isbot === true) return false;\n      const yessubmit = await this.submitHandler();\n      if (yessubmit) {\n        if (this.options.fetch) this.formFetch(this.options.fetch);\n        else this.form.submit();\n        this.form.disabled = true;\n        return true;\n      } else return false;\n    } else return false;\n  }\n\n  displayResponse(response, error = false) {\n    const el = document.createElement('div');\n    el.insertAdjacentHTML('afterbegin', response);\n    if (error !== false) el.classList.add('is-error');\n    this.form.parentElement.insertBefore(el, this.form);\n    this.form.remove();\n  }\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvbW9kdWxlcy9mb3JtLXN1Ym1pdC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFrQztBQUNBO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FHc0M7QUFJVDtBQUM3QixvRUFBWTs7QUFFTDtBQUNQO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQztBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2Q0FBNkMsb0VBQVk7QUFDekQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxPQUFPOztBQUVQLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQSxNQUFNO0FBQ047O0FBRUE7Ozs7QUFJQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsdUJBQXVCLHNFQUFtQixDQUFDLHlEQUFrQjtBQUM3RCxPQUFPOztBQUVQLE1BQU0sbUJBQW1CLHNFQUFtQixDQUFDLHlEQUFrQjs7QUFFL0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZixhQUFhO0FBQ2I7QUFDQTtBQUNBLFVBQVU7O0FBRVY7QUFDQSxLQUFLO0FBQ0w7O0FBRUE7QUFDQSw2REFBNkQsb0VBQVksNENBQTRDLDJEQUFHO0FBQ3hILGdDQUFnQywyREFBRztBQUNuQyxLQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUixLQUFLO0FBQ0w7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsZ0VBQWE7QUFDekM7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0EsT0FBTztBQUNQO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsNkNBQTZDLG9FQUFZO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSLE1BQU07QUFDTjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vc3JjL21vZHVsZXMvZm9ybS1zdWJtaXQuanM/YzZiNyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdmFsaWRhdG9yIGZyb20gJ3ZhbGlkYXRvcic7XG5pbXBvcnQgRE9NUHVyaWZ5IGZyb20gJ2RvbXB1cmlmeSc7XG5jb25zdCBmb3JtY3NzID0ge1xuICBpbnZhbGlkOiAnaW5wdXQtaW52YWxpZCcsXG4gIGlucHV0dmFsaWRhdGU6ICdpbnB1dC12YWxpZCcsXG59XG5pbXBvcnQge1xuICBkb21zZWxlY3RvcnMsXG4gIGNzc1xufSBmcm9tICcuLi9tb2R1bGVzL21vZHVsZXMtY29uZmlnLmpzJztcbmltcG9ydCB7XG4gIGZldGNoU2V0dGluZ3MsXG4gIGRlY29kZV9IVE1MRW50aXRpZXNcbn0gZnJvbSAnLi4vbW9kdWxlcy91dGlscy5qcyc7XG5kb21zZWxlY3RvcnNbXCJjYXB0Y2hhXCJdID0gJy5qcy1jYXB0Y2hhJztcblxuZXhwb3J0IGNsYXNzIEZvcm1TdWJtaXQge1xuICBoYW5kbGVycyA9IFtdO1xuICBmb3JtID0gbnVsbDtcbiAgbGlzdGVuZXIgPSBudWxsO1xuICBjb25zdHJ1Y3Rvcihmb3JtLCBvcHRpb25zID0ge30pIHtcbiAgICBpZiAoIWZvcm0pIHJldHVybjtcbiAgICBpZiAoIWZvcm0uZm9ybXN1Ym1pdCkge1xuICAgICAgdGhpcy5mb3JtID0gZm9ybSBpbnN0YW5jZW9mIEhUTUxFbGVtZW50ID8gZm9ybSA6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZm9ybSk7XG4gICAgICBjb25zdCBkZWZhdWx0T3B0aW9ucyA9IHtcbiAgICAgICAgZmV0Y2g6IG51bGwsXG4gICAgICB9O1xuICAgICAgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24ob3B0aW9ucywgdGhpcy5mb3JtLmRhdGFzZXQpO1xuICAgICAgdGhpcy5vcHRpb25zID0gT2JqZWN0LmFzc2lnbihkZWZhdWx0T3B0aW9ucywgb3B0aW9ucyk7XG4gICAgICBpZiAoIXRoaXMuZm9ybSkgcmV0dXJuO1xuICAgICAgdGhpcy50YWJzID0gdGhpcy5mb3JtLnF1ZXJ5U2VsZWN0b3JBbGwoZG9tc2VsZWN0b3JzLmNvbXBvbmVudC50YWJzLnRhYik7XG4gICAgICB0aGlzLnZhbGlkYXRlRmllbGRzKHRydWUpO1xuICAgICAgdGhpcy5pbml0KCk7XG5cbiAgICAgIGZvcm0uZm9ybXN1Ym1pdCA9IHRoaXM7XG4gICAgfVxuICAgIHJldHVybiBmb3JtLmZvcm1zdWJtaXQ7XG4gIH1cbiAgaW5pdCgpIHtcbiAgICAvLyBpbml0IHRoZSBmb3JtICggb3B0aW9ucyBsaWtlIGJlZm9yZXVubG9hZCBldGMuLi4pXG4gICAgdGhpcy5mb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXByZXNzJywgKGUpID0+IHtcbiAgICAgIC8vIHByZXZlbnQgZW50ZXIgc3VibWl0XG4gICAgICBpZiAoZS5rZXkgPT09ICdFbnRlcicgJiYgZS50YXJnZXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgfSk7XG5cbiAgICB0aGlzLmZvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgYXN5bmMgKGUpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuc3VibWl0Rm9ybSgpO1xuICAgICAgcmV0dXJuIHJlcztcbiAgICB9KTtcbiAgICB0aGlzLnNwZWNpYWxGaWVsZHMoKTtcbiAgfVxuICBzcGVjaWFsRmllbGRzKCkge1xuICAgIC8vIGNoZWNrIGlmIHRoZXJlIGlzIGEgcGFzc3dvcmQgY29uZmlybSBpbnB1dFxuICAgIC8vIGFkZCBzaG93IHRleHQgZm9yIHBhc3N3b3JkIGZpZWxkc1xuXG4gICAgdGhpcy5mb3JtLnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0W2RhdGEtbWF0Y2hdJykuZm9yRWFjaChpbnB1dCA9PiB7XG4gICAgICAvL1xuICAgICAgY29uc3QgbWF0Y2ggPSBpbnB1dC5kYXRhc2V0Lm1hdGNoO1xuICAgICAgaWYgKCFtYXRjaCkgcmV0dXJuO1xuICAgICAgY29uc3QgdGFyZ2V0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobWF0Y2gpO1xuICAgICAgaWYgKCF0YXJnZXQpIHJldHVybjtcbiAgICAgIGNvbnN0IGludmFsaWQgPSAoaW5wdXQuZGF0YXNldC5tYXRjaGludmFsaWQpID8gaW5wdXQuZGF0YXNldC5tYXRjaGludmFsaWQgOiBcIm5vIG1hdGNoXCI7XG4gICAgICBjb25zdCBjaGVja19tYXRjaCA9IChpdGVtLCBpdGVtdGFyZ2V0KSA9PiB7XG4gICAgICAgIGNvbnN0IGxhYmVsID0gKGlucHV0LnByZXZpb3VzRWxlbWVudFNpYmxpbmcgJiYgaW5wdXQucHJldmlvdXNFbGVtZW50U2libGluZy50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT0gJ2xhYmVsJykgPyBpbnB1dC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nIDogbnVsbDtcbiAgICAgICAgY29uc3QgbGFiZWx0YXJnZXQgPSAodGFyZ2V0LnByZXZpb3VzRWxlbWVudFNpYmxpbmcgJiYgdGFyZ2V0LnByZXZpb3VzRWxlbWVudFNpYmxpbmcudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09ICdsYWJlbCcpID8gdGFyZ2V0LnByZXZpb3VzRWxlbWVudFNpYmxpbmcgOiBudWxsO1xuICAgICAgICBjb25zdCB7XG4gICAgICAgICAgcGF0dGVybk1pc21hdGNoID0gZmFsc2VcbiAgICAgICAgfSA9IGl0ZW0udmFsaWRpdHk7XG4gICAgICAgIGNvbnN0IGN1c3RvbXZhbGlkaXR5ID0gKHBhdHRlcm5NaXNtYXRjaCkgPyB0aGlzLmdldF9tZXNzYWdlKGl0ZW0sICdpbnZhbGlkJykgOiBgYDtcbiAgICAgICAgaWYgKGl0ZW0uY2hlY2tWYWxpZGl0eSgpID09PSB0cnVlKSB7XG4gICAgICAgICAgaXRlbS5kYXRhc2V0LmludmFsaWQgPSAnJztcbiAgICAgICAgICBpdGVtLnNldEN1c3RvbVZhbGlkaXR5KCcnKTtcbiAgICAgICAgICBpZiAoaXRlbSA9PSBpbnB1dCAmJiBsYWJlbCAhPT0gbnVsbCkgbGFiZWwuY2xhc3NMaXN0LnJlbW92ZShmb3JtY3NzLmludmFsaWQpO1xuICAgICAgICAgIGVsc2UgaWYgKGxhYmVsdGFyZ2V0ICE9PSBudWxsKSBsYWJlbHRhcmdldC5jbGFzc0xpc3QucmVtb3ZlKGZvcm1jc3MuaW52YWxpZCk7XG4gICAgICAgICAgaXRlbS5jbGFzc0xpc3QucmVtb3ZlKGZvcm1jc3MuaW5wdXR2YWxpZGF0ZSk7XG4gICAgICAgICAgaWYgKGl0ZW0udmFsdWUgIT09IGl0ZW10YXJnZXQudmFsdWUpIHtcbiAgICAgICAgICAgIGlucHV0LnNldEN1c3RvbVZhbGlkaXR5KGludmFsaWQpO1xuICAgICAgICAgICAgaWYgKGxhYmVsKSB7XG4gICAgICAgICAgICAgIGxhYmVsLmRhdGFzZXQuaW52YWxpZCA9IChsYWJlbC5kYXRhc2V0LmludmFsaWQpID8gbGFiZWwuZGF0YXNldC5pbnZhbGlkIDogaW52YWxpZDtcbiAgICAgICAgICAgICAgbGFiZWwuY2xhc3NMaXN0LmFkZChmb3JtY3NzLmludmFsaWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaW5wdXQuY2xhc3NMaXN0LmFkZChmb3JtY3NzLmlucHV0dmFsaWRhdGUpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpbnB1dC5zZXRDdXN0b21WYWxpZGl0eShcIlwiKTtcbiAgICAgICAgICAgIGlmIChsYWJlbCkgbGFiZWwuY2xhc3NMaXN0LnJlbW92ZShmb3JtY3NzLmludmFsaWQpO1xuICAgICAgICAgICAgaW5wdXQuY2xhc3NMaXN0LnJlbW92ZShmb3JtY3NzLmlucHV0dmFsaWRhdGUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpdGVtLnNldEN1c3RvbVZhbGlkaXR5KGN1c3RvbXZhbGlkaXR5KTtcbiAgICAgICAgICBpdGVtLmRhdGFzZXQuaW52YWxpZCA9IGN1c3RvbXZhbGlkaXR5O1xuICAgICAgICAgIGlmIChsYWJlbCkgbGFiZWwuY2xhc3NMaXN0LmFkZChmb3JtY3NzLmludmFsaWQpO1xuICAgICAgICAgIGl0ZW0uY2xhc3NMaXN0LmFkZChmb3JtY3NzLmlucHV0dmFsaWRhdGUpO1xuICAgICAgICB9XG4gICAgICAgIGl0ZW0uZm9jdXMoKTtcbiAgICAgIH07XG4gICAgICBbaW5wdXQsIHRhcmdldF0uZm9yRWFjaChpdGVtID0+IHtcbiAgICAgICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIChlKSA9PiB7XG4gICAgICAgICAgY29uc3QgaXRlbXRhcmdldCA9IChpdGVtID09PSBpbnB1dCkgPyB0YXJnZXQgOiBpbnB1dDtcbiAgICAgICAgICBjaGVja19tYXRjaChpdGVtLCBpdGVtdGFyZ2V0KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgIH0pO1xuICB9XG4gIGdldF9tZXNzYWdlKGZpZWxkLCB0eXBlID0gJ2ludmFsaWQnKSB7XG4gICAgaWYgKGZpZWxkLmNoZWNrVmFsaWRpdHkoKSA9PSBmYWxzZSkge1xuICAgICAgY29uc3Qge1xuICAgICAgICB2YWx1ZU1pc3NpbmcgPSB0cnVlXG4gICAgICB9ID0gZmllbGQudmFsaWRpdHk7XG4gICAgICBpZiAodmFsdWVNaXNzaW5nKSByZXR1cm4gYCogYCArICgoZmllbGQuZGF0YXNldC5yZXF1aXJlZCkgPyBmaWVsZC5kYXRhc2V0LnJlcXVpcmVkIDogKCh0aGlzLmZvcm0uZGF0YXNldC5yZXF1aXJlZCkgPyB0aGlzLmZvcm0uZGF0YXNldC5yZXF1aXJlZCA6ICdyZXF1aXJlZCcpKTtcbiAgICAgIGVsc2UgcmV0dXJuIChmaWVsZC5kYXRhc2V0W3R5cGVdKSA/IGZpZWxkLmRhdGFzZXRbdHlwZV0gOiAnaW5wdXQgaW52YWxpZCc7XG4gICAgfSBlbHNlIHJldHVybiAnJztcbiAgfVxuXG4gIHZhbGlkYXRlRmllbGQoZmllbGQsIGluaXQgPSBmYWxzZSkge1xuXG5cblxuICAgIGlmIChbJ3RleHRhcmVhJywgJ2lucHV0J10uaW5kZXhPZihmaWVsZC50YWdOYW1lLnRvTG93ZXJDYXNlKCkpID49IDApIHtcblxuICAgIH1cblxuICAgIGlmIChbJ3NlbGVjdCcsICdpbnB1dFt0eXBlPVwiY2hlY2tib3hcIl0nXS5pbmRleE9mKGZpZWxkLnRhZ05hbWUudG9Mb3dlckNhc2UoKSkgPj0gMCkge1xuICAgICAgZmllbGQucXVlcnlTZWxlY3RvckFsbCgnb3B0aW9uOmNoZWNrZWQnKS5mb3JFYWNoKG9wdGlvbiA9PiB7XG4gICAgICAgIG9wdGlvbi52YWx1ZSA9IGRlY29kZV9IVE1MRW50aXRpZXMoRE9NUHVyaWZ5LnNhbml0aXplKG9wdGlvbi52YWx1ZSkpO1xuICAgICAgfSk7XG5cbiAgICB9IGVsc2UgZmllbGQudmFsdWUgPSBkZWNvZGVfSFRNTEVudGl0aWVzKERPTVB1cmlmeS5zYW5pdGl6ZShmaWVsZC52YWx1ZSkpO1xuXG4gICAgY29uc3QgcmVwID0gZmllbGQuY2hlY2tWYWxpZGl0eSgpO1xuICAgIGNvbnN0IGxhYmVsID0gdGhpcy5nZXRGaWVsZExhYmVsKGZpZWxkKTtcbiAgICBpZiAobGFiZWwpIHtcbiAgICAgIGlmIChyZXApIHtcbiAgICAgICAgbGFiZWwuY2xhc3NMaXN0LnJlbW92ZShmb3JtY3NzLmludmFsaWQpO1xuICAgICAgfSBlbHNlIGlmICghcmVwKSB7XG4gICAgICAgIGxhYmVsLmRhdGFzZXQuaW52YWxpZCA9IHRoaXMuZ2V0X21lc3NhZ2UoZmllbGQpO1xuICAgICAgICBsYWJlbC5jbGFzc0xpc3QuYWRkKGZvcm1jc3MuaW52YWxpZCk7XG4gICAgICAgIHdpbmRvdy5zY3JvbGxUbyh7XG4gICAgICAgICAgdG9wOiBwYXJzZUludChsYWJlbC5vZmZzZXRUb3ApLFxuICAgICAgICAgIGxlZnQ6IHBhcnNlSW50KGxhYmVsLm9mZnNldExlZnQpLFxuICAgICAgICAgIGJlaGF2aW9yOiAnc21vb3RoJ1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlcDtcbiAgfVxuICBnZXRGaWVsZExhYmVsKGZpZWxkKSB7XG4gICAgcmV0dXJuIChmaWVsZC5jbG9zZXN0KCcuZm9ybS1ib3gnKSkgPyAoKGZpZWxkLmNsb3Nlc3QoJy5mb3JtLWJveCcpLnF1ZXJ5U2VsZWN0b3IoJy5sYWJlbCcpKSA/IGZpZWxkLmNsb3Nlc3QoJy5mb3JtLWJveCcpLnF1ZXJ5U2VsZWN0b3IoJy5sYWJlbCcpIDogZmllbGQuY2xvc2VzdCgnLmZvcm0tYm94JykucXVlcnlTZWxlY3RvcignbGFiZWwnKSkgOiBudWxsO1xuICB9XG4gIHZhbGlkYXRlRmllbGRzKGluaXQgPSBmYWxzZSkge1xuICAgIC8vdG9kbzogY29tcGxldGUgdmFsaWRhdGlvbiBmb3JlYWNoIGZpZWxkIHR5cGVcbiAgICBsZXQgcmVzcCA9IHRydWU7XG4gICAgLy8gLnJlcXVpcmVkIGlucHV0IGZvciB0b20tc2VsZWN0IGNvbXBvbmVudFxuXG4gICAgWy4uLnRoaXMuZm9ybS5lbGVtZW50c10uZm9yRWFjaChmaWVsZCA9PiB7XG4gICAgICBpZiAoZmllbGQubmFtZSkge1xuICAgICAgICBpZiAoaW5pdCA9PT0gdHJ1ZSkge1xuICAgICAgICAgIGlmICghZmllbGQuZGF0YXNldC5saXN0ZW4pIHtcbiAgICAgICAgICAgIGlmIChmaWVsZC5oYXNBdHRyaWJ1dGUoJ3JlcXVpcmVkJykgJiYgZmllbGQucmVxdWlyZWQpIHtcbiAgICAgICAgICAgICAgY29uc3QgbGFiZWwgPSB0aGlzLmdldEZpZWxkTGFiZWwoZmllbGQpO1xuICAgICAgICAgICAgICBpZiAobGFiZWwpIGxhYmVsLmNsYXNzTGlzdC5hZGQoJ3JlcXVpcmVkJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIFsnY2hhbmdlJywgJ2JsdXInXS5mb3JFYWNoKGV2dCA9PiB7XG4gICAgICAgICAgICAgIGZpZWxkLmFkZEV2ZW50TGlzdGVuZXIoZXZ0LCAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMudmFsaWRhdGVGaWVsZChlLmN1cnJlbnRUYXJnZXQsIGluaXQpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZmllbGQuZGF0YXNldC5saXN0ZW4gPSB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHJlc3AgPSAocmVzcCAmJiB0aGlzLnZhbGlkYXRlRmllbGQoZmllbGQsIGluaXQpKTtcblxuICAgICAgfVxuICAgIH0pO1xuICAgIC8vIGFkZC9yZW1vdmUgZXJyb3IgY2xhc3Mgb24gdGFicyB0YWItY29udHJvbCBlbGVtZW50c1xuXG4gICAgdGhpcy50YWJzLmZvckVhY2godGFiID0+IHtcbiAgICAgIGlmICh0YWIucXVlcnlTZWxlY3RvcignOmludmFsaWQnKSB8fCB0YWIucXVlcnlTZWxlY3Rvcihkb21zZWxlY3RvcnMuY29tcG9uZW50LmFsZXJ0LmRhbmdlcikpIHRhYi5jbGFzc0xpc3QuYWRkKGNzcy5lcnJvcik7XG4gICAgICBlbHNlIHRhYi5jbGFzc0xpc3QucmVtb3ZlKGNzcy5lcnJvcik7XG4gICAgfSk7XG4gICAgcmV0dXJuIHJlc3A7XG4gIH1cblxuICBhZGRIYW5kbGVyKGhhbmRsZXIpIHtcbiAgICB0aGlzLmhhbmRsZXJzLnB1c2goaGFuZGxlcik7XG4gIH1cbiAgZmllbGRFbmFibGUoZW5hYmxlID0gdHJ1ZSkge1xuICAgIHRoaXMuZm9ybS5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dFtkYXRhLXN1Yj1cImVuYWJsZVwiXScpLmZvckVhY2goaW5wdXQgPT4ge1xuICAgICAgaWYgKGVuYWJsZSA9PT0gdHJ1ZSkge1xuICAgICAgICBpbnB1dC5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgfSBlbHNlIGlucHV0LmRpc2FibGVkID0gdHJ1ZTtcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIHN1Ym1pdEhhbmRsZXIoKSB7XG4gICAgaWYgKCF0aGlzLnZhbGlkYXRlRmllbGRzKCkpIHJldHVybiBmYWxzZTtcblxuICAgIGlmICh0aGlzLmhhbmRsZXJzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIHRydWU7XG4gICAgbGV0IHJlc3AgPSB0cnVlO1xuICAgIC8vIHNlcmllc1xuICAgIC8qICBmb3IgKGNvbnN0IGhhbmRsZXIgb2YgdGhpcy5oYW5kbGVycykge1xuICAgICAgICAgIGNvbnN0IHJlcCA9IGF3YWl0IGhhbmRsZXIoKVxuICAgICAgICAgIHJlc3AgPSAocmVzcCAmJiByZXApXG4gICAgICB9Ki9cbiAgICAvLyBjb25jdXJyZW50XG4gICAgYXdhaXQgUHJvbWlzZS5hbGwodGhpcy5oYW5kbGVycy5tYXAoYXN5bmMgaGFuZGxlciA9PiB7XG4gICAgICBjb25zdCByZXAgPSBhd2FpdCBoYW5kbGVyKCk7XG4gICAgICByZXNwID0gKHJlc3AgJiYgcmVwKTtcbiAgICB9KSk7XG4gICAgaWYgKHJlc3AgPT09IHRydWUpIHRoaXMuaGFuZGxlcnMgPSBbXTtcbiAgICByZXR1cm4gcmVzcDtcbiAgfVxuICAvLyBubyByZWRpcmVjdGlvbiB3aGVuIHVzaW5nIGRhdGEtZmV0Y2hcbiAgZm9ybUZldGNoKGZvcm1hdCA9IG51bGwpIHtcbiAgICBjb25zdCBmb3JtZGF0YSA9IG5ldyBGb3JtRGF0YSh0aGlzLmZvcm0pO1xuICAgIGZvcm1kYXRhW1wiZmV0Y2hcIl0gPSB0cnVlO1xuICAgIGZldGNoKHRoaXMuZm9ybS5hY3Rpb24sIGZldGNoU2V0dGluZ3Moe1xuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgYm9keTogZm9ybWRhdGEsXG4gICAgICB9KSlcbiAgICAgIC50aGVuKHJlc3BvbnNlID0+IHtcbiAgICAgICAgc3dpdGNoIChmb3JtYXQpIHtcbiAgICAgICAgICBjYXNlIFwidGV4dFwiOlxuICAgICAgICAgIGNhc2UgXCJodG1sXCI6XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UudGV4dCgpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICAudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICAgIHRoaXMuZGlzcGxheVJlc3BvbnNlKHJlc3BvbnNlKTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goZXJyID0+IHtcbiAgICAgICAgdGhpcy5kaXNwbGF5UmVzcG9uc2UoZXJyLCB0cnVlKVxuICAgICAgfSkuZmluYWxseShyZXNwb25zZSA9PiB7XG4gICAgICAgIHRoaXMuZm9ybS5kaXNhYmxlZCA9IHRydWU7XG4gICAgICB9KTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBhc3luYyBzdWJtaXRGb3JtKCkge1xuICAgIHRoaXMuZmllbGRFbmFibGUoKTtcbiAgICBpZiAodGhpcy52YWxpZGF0ZUZpZWxkcyhmYWxzZSkpIHtcbiAgICAgIGNvbnN0IGlzYm90ID0gKHRoaXMuZm9ybS5xdWVyeVNlbGVjdG9yKGRvbXNlbGVjdG9ycy5jYXB0Y2hhKSkgPyAodGhpcy5mb3JtLmRhdGFzZXQuaXNib3QgPyAodGhpcy5mb3JtLmRhdGFzZXQuaXNib3QgPT09IHRydWUpIDogdHJ1ZSkgOiBmYWxzZTtcbiAgICAgIGlmIChpc2JvdCA9PT0gdHJ1ZSkgcmV0dXJuIGZhbHNlO1xuICAgICAgY29uc3QgeWVzc3VibWl0ID0gYXdhaXQgdGhpcy5zdWJtaXRIYW5kbGVyKCk7XG4gICAgICBpZiAoeWVzc3VibWl0KSB7XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZmV0Y2gpIHRoaXMuZm9ybUZldGNoKHRoaXMub3B0aW9ucy5mZXRjaCk7XG4gICAgICAgIGVsc2UgdGhpcy5mb3JtLnN1Ym1pdCgpO1xuICAgICAgICB0aGlzLmZvcm0uZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0gZWxzZSByZXR1cm4gZmFsc2U7XG4gICAgfSBlbHNlIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGRpc3BsYXlSZXNwb25zZShyZXNwb25zZSwgZXJyb3IgPSBmYWxzZSkge1xuICAgIGNvbnN0IGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgZWwuaW5zZXJ0QWRqYWNlbnRIVE1MKCdhZnRlcmJlZ2luJywgcmVzcG9uc2UpO1xuICAgIGlmIChlcnJvciAhPT0gZmFsc2UpIGVsLmNsYXNzTGlzdC5hZGQoJ2lzLWVycm9yJyk7XG4gICAgdGhpcy5mb3JtLnBhcmVudEVsZW1lbnQuaW5zZXJ0QmVmb3JlKGVsLCB0aGlzLmZvcm0pO1xuICAgIHRoaXMuZm9ybS5yZW1vdmUoKTtcbiAgfVxufSJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/modules/form-submit.js\n")},"./src/modules/project-privileges.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ProjectPrivileges: () => (/* binding */ ProjectPrivileges)\n/* harmony export */ });\n/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! dompurify */ \"./node_modules/dompurify/dist/purify.js\");\n/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(dompurify__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _modules_form_submit_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../modules/form-submit.js */ \"./src/modules/form-submit.js\");\n/* harmony import */ var _modules_alert_boxes_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../modules/alert-boxes.js */ \"./src/modules/alert-boxes.js\");\n/* harmony import */ var _modules_js_tom_select_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../modules/js-tom-select.js */ \"./src/modules/js-tom-select.js\");\n/* harmony import */ var _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../modules/modules-config.js */ \"./src/modules/modules-config.js\");\n// privileges of a project\n// line with member name , priviliege , is contact , and delete functionality\n\n\n\n\n\n\nconst codemessages = {\n  oneatleast: 'oneatleast',\n  nomanager: 'nomanager',\n  nocontact: 'nocontact',\n  uhasnopriv: 'uhasnopriv',\n  importpriverror: 'importpriverror',\n  emptyname: 'emptyname'\n}\nlet instance = null;\nclass ProjectPrivileges {\n  //TODO: rewrite to not depend on DOM select\n  options;\n  alertBox;\n  // current user id;\n  current_uid;\n  fieldset;\n  fieldset_alert_zone;\n  // unique users\n  constructor(options = {}) {\n    if (!instance) {\n      const defaultOptions = {\n        groupid: \"#section-privileges\",\n        separ: '.new-privilege',\n        addbtn: '[data-add=\"block\"]',\n        target: 'member',\n        ident: 'member',\n        privilege: 'privilege',\n        delet: 'delet',\n        contact: 'contact',\n        contactfieldname: 'contact_user_id',\n        domselectors: {\n          tabcontent: '.tab-content'\n        }\n      };\n      this.options = Object.assign({}, defaultOptions, options);\n      this.fieldset = document.querySelector(this.options.groupid);\n      if (!this.fieldset) return;\n      this.fieldset_alert_zone = this.fieldset.querySelector(this.options.domselectors.tabcontent) ? this.fieldset.querySelector(this.options.domselectors.tabcontent) : this.fieldset;\n      this.options.separ = this.options.separ instanceof HTMLElement ? this.options.separ : (document.querySelector(this.options.separ) ? document.querySelector(this.options.separ) : null);\n      this.options.addbtn = this.options.addbtn instanceof HTMLElement ? this.options.addbtn : document.querySelector(this.options.addbtn);\n      if (this.options.addbtn) this.addListener();\n      const lines = this.fieldset.querySelectorAll('[data-block=\"' + this.options.target + '\"]');\n      this.current_uid = this.fieldset.dataset.u;\n      this.alertBox = new _modules_alert_boxes_js__WEBPACK_IMPORTED_MODULE_2__.AlertBox();\n      lines.forEach((line) => {\n        this.activateEvents(line);\n      });\n\n      //remove deleted , clean && validate datas , format names before sending the form\n      const form = this.fieldset.closest('form');\n      const formSubmit = new _modules_form_submit_js__WEBPACK_IMPORTED_MODULE_1__.FormSubmit(form);\n      // handler - verify privileges before settings form submit\n      const submit_privileges = async () => {\n        const resp = await this.cleanPrivileges();\n        return resp;\n      }\n      formSubmit.addHandler(submit_privileges);\n      instance = this;\n    }\n    return instance;\n  }\n\n  newLine(ret = false, check = 0) {\n    let line;\n    if (check > 0) {\n      line = this.getLinePrivilege(check);\n      if (line) return line;\n    }\n    const lines = this.fieldset.querySelectorAll('[data-block=\"' + this.options.target + '\"]');\n\n    if (lines.length === 0) return;\n    const n = lines.length - 1;\n    line = lines[n];\n    if (line !== null) {\n      line = this.clearLine(line.cloneNode(true), n, (this.options.separ ? this.options.separ : line));\n\n      this.activateEvents(line);\n\n    }\n    if (ret === true) return line;\n  }\n\n  addListener() {\n    this.options.target = (this.options.addbtn.dataset.target) ? this.options.addbtn.dataset.target : this.options.target;\n    this.options.addbtn.addEventListener('click', async (e) => {\n      e.preventDefault();\n      this.newLine();\n    })\n  }\n\n  clearLine(line, n, separ = null) {\n    /*clean line element */\n\n    let has_autocomplete = null;\n    line.dataset.mod = '';\n    line.disabled = false;\n    const elems = line.querySelectorAll('[data-elem]');\n    elems.forEach((elem) => {\n      // change loop index - necessary for tailwindcss peerchecked to work otherwise not if name ends with []\n      //remove components\n      const rms = elem.querySelectorAll('[data-component]')\n      rms.forEach((rm) => {\n        switch (rm.dataset.component) {\n          case 'tom-select':\n            rm.remove();\n            break;\n        }\n      })\n      // clean and reset events\n      const els = elem.querySelectorAll('input, select, label');\n      els.forEach((el) => {\n\n        el.disabled = false;\n        if (separ) { // change names and id when adding a new row - not if clear only\n          const keys = ['id', 'for', 'aria-controls', 'name'];\n          keys.forEach((key) => {\n            let val = el.getAttribute(key);\n            if (val !== null) {\n              if (key === 'name') val = val.replace('[' + n + ']', '[' + (n + 1) + ']');\n              else val = val.replace('_' + n, '_' + (n + 1));\n              el.setAttribute(key, val);\n            }\n          });\n        }\n        switch (el.tagName.toLowerCase()) {\n          case 'input':\n            //el.indeterminate = true;\n            el.checked = false;\n            // disable contact as privilege is empty\n            if (el.name == this.options.contactfieldname) {\n              el.value = \"0\";\n              el.disabled = true;\n            }\n            break;\n          case 'select':\n            el.selectedIndex = -1;\n            break;\n          case 'label':\n            el.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.peerchecked);\n            break;\n        }\n        if (el.tomselect) {\n          has_autocomplete = el;\n          el.tomselect.clear();\n          el.tomselect.destroy();\n\n        }\n        if (el.classList.contains(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.component.autocomplete.tomselected)) {\n          has_autocomplete = el;\n          el.classList.forEach(cl => {\n            if (cl.indexOf('ts-') == 0) el.classList.remove(cl);\n          })\n          el.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.component.autocomplete.tomselected);\n          if (el.type == \"select-one\") delete el.type;\n\n        }\n\n      })\n\n    })\n    /* add functionnalities */\n    if (separ) {\n      line.classList.add('new');\n      separ.after(line);\n    }\n    /* clear and add tom-select functionalities - only after adding line to the dom*/\n    if (has_autocomplete !== null) {\n      const jsTomSelect = new _modules_js_tom_select_js__WEBPACK_IMPORTED_MODULE_3__.JsTomSelect();\n      jsTomSelect.applyTo(has_autocomplete);\n      has_autocomplete.tomselect.clearOptions();\n      let options = this.fieldset.dataset.options;\n      options = (options) ? options : [];\n      has_autocomplete.tomselect.addOptions(options);\n    };\n\n\n    return line;\n  }\n\n  setLine(line, mb = {\n    key: '',\n    value: ''\n  }, priv, ct) {\n\n    priv = _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.defined_privileges[priv] ? _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.defined_privileges[priv] : _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.defined_privileges.viewers;\n    if (!priv) return;\n    const {\n      member,\n      privs,\n      contact,\n      delet\n    } = this.getInputs(line, priv);\n    if (!member || !privs || !contact || !delet) return;\n\n    // sanitize\n    mb.key = dompurify__WEBPACK_IMPORTED_MODULE_0___default().sanitize(mb.key);\n    mb.value = dompurify__WEBPACK_IMPORTED_MODULE_0___default().sanitize(mb.value);\n    const ts = member.tomselect;\n    if (ts) {\n      ts.clear();\n      const addmb = {}\n      addmb[ts.settings.valueField] = mb.key;\n      addmb[ts.settings.labelField] = addmb[ts.settings.searchField] = mb.value;\n      ts.addOption(addmb);\n      ts.setValue([mb.key]);\n    } else {\n      const selected = member.querySelector('select option[value=\"' + mb.key + '\"]');\n      if (selected) selected.selected = true;\n      else member.insertAdjacentHTML('beforeend', '<option value=\"' + mb.key + '\" selected>' + mb.value + '</option>');\n\n    }\n    privs.checked = true;\n    contact.value = mb.key;\n    if (priv === _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.rights.manage) {\n      contact.disabled = false;\n      if (ct === true) contact.checked = true;\n\n    } else {\n      contact.disabled = true;\n      contact.checked = false;\n    }\n\n  }\n  getInputs(line, priv = false) {\n    const member = line.querySelector(\"[name*='[\" + this.options.ident + \"]']\");\n    let privs;\n    if (priv) {\n      privs = line.querySelector('input[name*=\"[' + this.options.privilege + ']\"][value=\"' + priv + '\"]');\n    } else privs = line.querySelectorAll('input[name*=\"[' + this.options.privilege + ']\"]');\n    const contact = line.querySelector('input[name=\"' + this.options.contactfieldname + '\"]');\n    const delet = line.querySelector(\"input[name*='[\" + this.options.delet + \"]']\");\n\n    return {\n      member: member,\n      privs: privs,\n      contact: contact,\n      delet: delet\n    };\n  }\n  async importPrivileges(privileges, replace = false, contact = null, importedtag = null, dismiss = null) {\n    let lastline = !replace;\n\n    try {\n      Object.entries(privileges).forEach(([priv, members]) => {\n        members.forEach((member) => {\n          if (!lastline) lastline = this.clearAll(true, ((replace === true) ? member.id : null));\n          else lastline = this.newLine(true, member.id);\n          if (lastline) {\n            this.setLine(lastline, {\n              key: member.id,\n              value: member.name,\n            }, priv, (contact !== null && (parseInt(contact.id) === parseInt(member.id))));\n            if (importedtag) importedtag(lastline);\n\n          }\n\n        });\n\n      });\n      if (dismiss) dismiss();\n      this.alertBox.dismissAlert(codemessages.importpriverror);\n      return true;\n    } catch (err) {\n      await this.alertBox.build({\n        dismissible: true,\n        message: codemessages.importpriverror,\n        codeid: true,\n        parent: this.fieldset_alert_zone,\n        type: _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.alertconfig.danger,\n      });\n      console.log('err', err);\n      return false;\n    }\n  }\n  activateEvents(line) {\n    if (!line) return;\n    const {\n      member,\n      privs,\n      contact,\n      delet\n    } = this.getInputs(line);\n    if (!member || !privs || !contact || !delet) {\n      return;\n    }\n    const siblings = s => [...s.parentElement.children].filter(c => c.nodeType == 1 && c != s && c.classList.contains('row') && c.dataset.block !== null && c.dataset.block === this.options.target);\n\n    // enable/disable contact when privilege changes\n    const lineSettings = (pr, ct, dl, synchro = false) => {\n\n      if (pr && pr.value === _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.rights.manage) {\n        // manager - can't delete line - can choose as contact\n        dl.disabled = true;\n        ct.disabled = false;\n        // dismiss related alert\n        this.alertBox.dismissAlert(codemessages.nomanager);\n        if (ct.checked) {\n          this.alertBox.dismissAlert(codemessages.nocontact);\n        }\n      } else {\n        // not manager - can delet line - cannot chose as contact\n        //  if (ct.checked === true) ct.dispatchEvent(new Event('click'));\n        ct.checked = false;\n        dl.disabled = false;\n        ct.disabled = true;\n      }\n\n      if (synchro === true) {\n        synchroSiblings(line);\n      }\n      // dismiss alerts\n      if (!dl.ckecked) {\n        this.alertBox.dismissAlert(codemessages.nobody);\n        this.alertBox.dismissAlert(codemessages.oneatleast);\n      }\n    }\n    const synchroSiblings = (line) => {\n      const lns = siblings(line);\n      lns.forEach((ln) => {\n        const dl = ln.querySelector(\"input[name*='[\" + this.options.delet + \"]']\");\n        const ct = ln.querySelector('input[name=\"' + this.options.contactfieldname + '\"]');\n        const pr = ln.querySelector('input[name*=\"[' + this.options.privilege + ']\"]:checked');\n        lineSettings(pr, ct, dl, false);\n\n      })\n    }\n\n    member.addEventListener('change', (e) => {\n      contact.value = member.value;\n      // dismiss alert\n      if (member.value) {\n        this.alertBox.dismissAlert(codemessages.emptyname);\n        this.alertBox.dismissAlert(codemessages.oneatleast);\n        this.alertBox.dismissAlert(codemessages.nobody);\n      }\n    })\n\n    privs.forEach((priv) => {\n      priv.addEventListener('change', (e) => {\n        if (priv.checked) lineSettings(priv, contact, delet, false);\n      });\n\n      if (priv.checked) lineSettings(priv, contact, delet, false);\n    })\n\n    contact.addEventListener('change', (e) => {\n      if (e.target.checked) delet.disabled = true;\n      else delet.disabled = false;\n      const priv = line.querySelector('input[name*=\"[' + this.options.privilege + ']\"]:checked');\n      lineSettings(priv, contact, delet, true);\n      // enable otherwise\n\n    })\n\n    // delet ok for all when new line\n    //\n    delet.addEventListener('click', (e) => {\n      // at least one priv line\n      const deletlabel = delet.closest('label');\n      const lines = this.fieldset.querySelectorAll('[data-block=\"' + this.options.target + '\"]:not([data-mod=\"remove\"])');\n      if (lines.length <= 1 && e.target.checked) {\n        delet.disabled = true;\n        delet.checked = false;\n        this.alertBox.build({\n          dismissible: true,\n          message: codemessages.oneatleast,\n          codemessage: codemessages.oneatleast,\n          type: _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.alertconfig.warning,\n          parent: (e.currentTarget.id || null)\n        });\n        return;\n      } else if (e.target.checked) {\n        this.alertBox.dismissAlert(codemessages.oneatleast);\n        if (line.classList.contains('new')) {\n          line.remove();\n        } else {\n          if (deletlabel && deletlabel.dataset.restore) deletlabel.setAttribute('title', deletlabel.dataset.restore);\n          line.setAttribute('data-mod', 'remove');\n          privs.forEach(priv => {\n            priv.disabled = true;\n            priv.checked = false;\n          })\n          contact.checked = false;\n          contact.disabled = true;\n          member.disabled = true;\n        }\n      } else {\n        if (deletlabel && deletlabel.dataset.remove) deletlabel.setAttribute('title', deletlabel.dataset.remove);\n        line.removeAttribute('data-mod');\n        privs.forEach(priv => priv.disabled = false);\n        contact.disabled = false;\n        member.disabled = false;\n      }\n    });\n    // delet mouseover - explain why it is disabled when manage is checked\n    delet.addEventListener('mouseover', (e) => {\n      if (e.target.disabled) {\n        let pr = line.querySelector('input[name*=\"[' + this.options.privilege + ']\"]:checked');\n        if (!pr) return;\n        pr = pr.value.toLowerCase()\n        e.target.title = (e.target.dataset[pr]) ? e.target.dataset[pr] : e.target.title\n      }\n    })\n    // disable delet if user is the only manager\n    if (this.current_uid === member.value) delet.disabled = true;\n\n\n  }\n\n  // send clean data on submit\n  async cleanPrivileges() {\n    // check managers and contact_user_id on submit\n\n    const checkContact = async () => {\n      // check if one manager at least\n      const managers = this.fieldset.querySelectorAll('[name*=\"[' + this.options.privilege + ']\"][value=\"' + _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.rights.manage + '\"]:checked');\n      let n = managers.length;\n\n      if (n === 0) {\n        await this.alertBox.build({\n          dismissible: true,\n          message: codemessages.nomanager,\n          codeid: true,\n          type: _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.alertconfig.danger,\n          parent: this.fieldset_alert_zone,\n        });\n        this.tabError(true);\n        return false;\n      } else {\n        this.alertBox.dismissAlert(codemessages.nomanager);\n        this.tabError(false);\n      }\n      // check contact\n      const contact = this.fieldset.querySelector('[name=\"' + this.options.contactfieldname + '\"]:checked');\n\n      if (contact === null) {\n        await this.alertBox.build({\n          dismissible: true,\n          codeid: true,\n          message: codemessages.nocontact,\n          type: _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.alertconfig.danger,\n          parent: this.fieldset_alert_zone\n        });\n        this.tabError(true);\n        return false;\n      }\n      this.alertBox.dismissAlert(codemessages.nocontact);\n      this.tabError(false);\n      return true;\n    }\n    const hasMember = (line) => {\n      const member = line.querySelector('[name*=\"[' + this.options.ident + ']\"]');\n      return (member.value);\n    }\n    const hasPriv = (line) => {\n      const priv = line.querySelector('[name*=\"[' + this.options.privilege + ']\"]:checked');\n      if (priv && priv.value) return true;\n      return false;\n    }\n    const formatPrivilege = (line) => {\n\n      const els = line.querySelectorAll('[name*=\"members[\"');\n      els.forEach((el) => {\n        let name = el.name;\n        name = name.split('[');\n        name.pop();\n        el.name = name.join('[');\n        if (el.name.indexOf('[' + this.options.privilege + ']') > 0) {\n          el.type = 'checkbox';\n          el.classList.add('hidden');\n        }\n\n      })\n    }\n    const hascontact = await checkContact();\n    if (hascontact === true) {\n      const lines = this.fieldset.querySelectorAll('[data-block=\"' + this.options.target + '\"]');\n      let n = lines.length;\n      let verif = true;\n      for (const line of lines) {\n        if (line.dataset.mod && line.dataset.mod === 'remove') {\n          if (n > 1) {\n            line.remove();\n            n--;\n          } else return false;\n        } else if (!hasMember(line)) {\n          const lineno = line.querySelector('[name*=\"[' + this.options.ident + ']\"]');\n          lineno.focus();\n          if (lineno.tomselect) lineno.tomselect.focus();\n          await this.alertBox.build({\n            dismissible: true,\n            insertafter: true,\n            message: codemessages.emptyname,\n            codeid: true,\n            type: _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.alertconfig.warning,\n            parent: line\n          });\n          const resp = false; // no confimbox just wait for user action\n          // callback when confirmbox response is chosen if 'confirm'\n          if (resp === true) {\n            if (n > 1) {\n              line.remove();\n              n--;\n            } else return false;\n\n          } else return false;\n        } else if (!hasPriv(line)) {\n          this.alertBox.dismissAlert(codemessages.emptyname);\n          await this.alertBox.build({\n            dismissible: true,\n            insertafter: true,\n            codeid: true,\n            message: codemessages.uhasnopriv,\n            type: _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.alertconfig.warning,\n            parent: line\n          });\n          verif = false;\n        } else this.alertBox.dismissAlert(codemessages.uhasnopriv);\n      }\n      if (!verif) return verif;\n      for (const line of lines) {\n        formatPrivilege(line);\n      }\n\n      if (n === 0) {\n        await this.alertBox.build({\n          dismissible: true,\n          codeid: true,\n          message: codemessages.nobody,\n          type: _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.alertconfig.warning,\n          parent: this.fieldset_alert_zone\n        });\n        return false;\n      } else this.alertBox.dismissAlert(codemessages.nobody);\n      return true;\n    } else return false;\n  }\n  getLinePrivilege(id) {\n    let privilege = null;\n    const lines = this.fieldset.querySelectorAll('[data-block=\"' + this.options.target + '\"]')\n    for (const line of lines) {\n      if (parseInt(line.querySelector('[name*=\"[' + this.options.ident + ']\"]').value) === parseInt(id)) {\n        privilege = line;\n        break;\n      }\n    }\n\n    return privilege;\n  }\n  clearAll(ret = false, replaceid = null) {\n    let lines = this.fieldset.querySelectorAll('[data-block=\"' + this.options.target + '\"]');\n    let keepindex = -1;\n    lines.forEach((line, index) => {\n      const {\n        member,\n        privs,\n        contact,\n        delet\n      } = this.getInputs(line);\n      if (this.current_uid === member.value || parseInt(replaceid) === parseInt(member.value)) keepindex = index;\n      if (index > 0 || (keepindex > 0 && keepindex !== index)) line.remove();\n    });\n    //\n    const line = this.newLine(true);\n    // if (keepindex > 0) {\n    //  lines[0].remove();\n    //}\n    if (ret === true) return line;\n  }\n\n  tabError(on) {\n    const tab = (this.fieldset.classList.contains(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.domselectors.component.tabs.tab.substr(1))) ? this.fieldset : ((this.fieldset.parentElement.classList.contains(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.domselectors.component.tabs.tab.substr(1))) ? this.fieldset.parentElement : null);\n    if (tab === null) return;\n    if (on === true) tab.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.error);\n    else tab.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.error);\n  }\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVk7QUFDWixVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQixtRUFBVztBQUM3QjtBQUNBLFdBQVc7QUFDWCw4QkFBOEI7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWM7O0FBRWQsWUFBWTtBQUNaLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsbUVBQVc7QUFDN0I7QUFDQSxXQUFXO0FBQ1g7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLG1FQUFXO0FBQzNCO0FBQ0EsU0FBUztBQUNUO0FBQ0EsUUFBUTtBQUNSO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGtEQUFrRCxvRUFBWSxtR0FBbUcsb0VBQVk7QUFDN0s7QUFDQSx1Q0FBdUMsMkRBQUc7QUFDMUMsOEJBQThCLDJEQUFHO0FBQ2pDO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvbW9kdWxlcy9wcm9qZWN0LXByaXZpbGVnZXMuanM/ZGQyMyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBwcml2aWxlZ2VzIG9mIGEgcHJvamVjdFxuLy8gbGluZSB3aXRoIG1lbWJlciBuYW1lICwgcHJpdmlsaWVnZSAsIGlzIGNvbnRhY3QgLCBhbmQgZGVsZXRlIGZ1bmN0aW9uYWxpdHlcbmltcG9ydCBET01QdXJpZnkgZnJvbSAnZG9tcHVyaWZ5JztcbmltcG9ydCB7XG4gIEZvcm1TdWJtaXQsXG59IGZyb20gXCIuLi9tb2R1bGVzL2Zvcm0tc3VibWl0LmpzXCI7XG5pbXBvcnQge1xuICBBbGVydEJveFxufSBmcm9tIFwiLi4vbW9kdWxlcy9hbGVydC1ib3hlcy5qc1wiO1xuaW1wb3J0IHtcbiAgSnNUb21TZWxlY3Rcbn0gZnJvbSBcIi4uL21vZHVsZXMvanMtdG9tLXNlbGVjdC5qc1wiO1xuXG5pbXBvcnQge1xuICByaWdodHMsXG4gIGRlZmluZWRfcHJpdmlsZWdlcyxcbiAgYWxlcnRjb25maWcsXG4gIGRvbXNlbGVjdG9ycyxcbiAgY3NzXG59IGZyb20gJy4uL21vZHVsZXMvbW9kdWxlcy1jb25maWcuanMnO1xuY29uc3QgY29kZW1lc3NhZ2VzID0ge1xuICBvbmVhdGxlYXN0OiAnb25lYXRsZWFzdCcsXG4gIG5vbWFuYWdlcjogJ25vbWFuYWdlcicsXG4gIG5vY29udGFjdDogJ25vY29udGFjdCcsXG4gIHVoYXNub3ByaXY6ICd1aGFzbm9wcml2JyxcbiAgaW1wb3J0cHJpdmVycm9yOiAnaW1wb3J0cHJpdmVycm9yJyxcbiAgZW1wdHluYW1lOiAnZW1wdHluYW1lJ1xufVxubGV0IGluc3RhbmNlID0gbnVsbDtcbmV4cG9ydCBjbGFzcyBQcm9qZWN0UHJpdmlsZWdlcyB7XG4gIC8vVE9ETzogcmV3cml0ZSB0byBub3QgZGVwZW5kIG9uIERPTSBzZWxlY3RcbiAgb3B0aW9ucztcbiAgYWxlcnRCb3g7XG4gIC8vIGN1cnJlbnQgdXNlciBpZDtcbiAgY3VycmVudF91aWQ7XG4gIGZpZWxkc2V0O1xuICBmaWVsZHNldF9hbGVydF96b25lO1xuICAvLyB1bmlxdWUgdXNlcnNcbiAgY29uc3RydWN0b3Iob3B0aW9ucyA9IHt9KSB7XG4gICAgaWYgKCFpbnN0YW5jZSkge1xuICAgICAgY29uc3QgZGVmYXVsdE9wdGlvbnMgPSB7XG4gICAgICAgIGdyb3VwaWQ6IFwiI3NlY3Rpb24tcHJpdmlsZWdlc1wiLFxuICAgICAgICBzZXBhcjogJy5uZXctcHJpdmlsZWdlJyxcbiAgICAgICAgYWRkYnRuOiAnW2RhdGEtYWRkPVwiYmxvY2tcIl0nLFxuICAgICAgICB0YXJnZXQ6ICdtZW1iZXInLFxuICAgICAgICBpZGVudDogJ21lbWJlcicsXG4gICAgICAgIHByaXZpbGVnZTogJ3ByaXZpbGVnZScsXG4gICAgICAgIGRlbGV0OiAnZGVsZXQnLFxuICAgICAgICBjb250YWN0OiAnY29udGFjdCcsXG4gICAgICAgIGNvbnRhY3RmaWVsZG5hbWU6ICdjb250YWN0X3VzZXJfaWQnLFxuICAgICAgICBkb21zZWxlY3RvcnM6IHtcbiAgICAgICAgICB0YWJjb250ZW50OiAnLnRhYi1jb250ZW50J1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgdGhpcy5vcHRpb25zID0gT2JqZWN0LmFzc2lnbih7fSwgZGVmYXVsdE9wdGlvbnMsIG9wdGlvbnMpO1xuICAgICAgdGhpcy5maWVsZHNldCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5vcHRpb25zLmdyb3VwaWQpO1xuICAgICAgaWYgKCF0aGlzLmZpZWxkc2V0KSByZXR1cm47XG4gICAgICB0aGlzLmZpZWxkc2V0X2FsZXJ0X3pvbmUgPSB0aGlzLmZpZWxkc2V0LnF1ZXJ5U2VsZWN0b3IodGhpcy5vcHRpb25zLmRvbXNlbGVjdG9ycy50YWJjb250ZW50KSA/IHRoaXMuZmllbGRzZXQucXVlcnlTZWxlY3Rvcih0aGlzLm9wdGlvbnMuZG9tc2VsZWN0b3JzLnRhYmNvbnRlbnQpIDogdGhpcy5maWVsZHNldDtcbiAgICAgIHRoaXMub3B0aW9ucy5zZXBhciA9IHRoaXMub3B0aW9ucy5zZXBhciBpbnN0YW5jZW9mIEhUTUxFbGVtZW50ID8gdGhpcy5vcHRpb25zLnNlcGFyIDogKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5vcHRpb25zLnNlcGFyKSA/IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5vcHRpb25zLnNlcGFyKSA6IG51bGwpO1xuICAgICAgdGhpcy5vcHRpb25zLmFkZGJ0biA9IHRoaXMub3B0aW9ucy5hZGRidG4gaW5zdGFuY2VvZiBIVE1MRWxlbWVudCA/IHRoaXMub3B0aW9ucy5hZGRidG4gOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHRoaXMub3B0aW9ucy5hZGRidG4pO1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy5hZGRidG4pIHRoaXMuYWRkTGlzdGVuZXIoKTtcbiAgICAgIGNvbnN0IGxpbmVzID0gdGhpcy5maWVsZHNldC5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1ibG9jaz1cIicgKyB0aGlzLm9wdGlvbnMudGFyZ2V0ICsgJ1wiXScpO1xuICAgICAgdGhpcy5jdXJyZW50X3VpZCA9IHRoaXMuZmllbGRzZXQuZGF0YXNldC51O1xuICAgICAgdGhpcy5hbGVydEJveCA9IG5ldyBBbGVydEJveCgpO1xuICAgICAgbGluZXMuZm9yRWFjaCgobGluZSkgPT4ge1xuICAgICAgICB0aGlzLmFjdGl2YXRlRXZlbnRzKGxpbmUpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vcmVtb3ZlIGRlbGV0ZWQgLCBjbGVhbiAmJiB2YWxpZGF0ZSBkYXRhcyAsIGZvcm1hdCBuYW1lcyBiZWZvcmUgc2VuZGluZyB0aGUgZm9ybVxuICAgICAgY29uc3QgZm9ybSA9IHRoaXMuZmllbGRzZXQuY2xvc2VzdCgnZm9ybScpO1xuICAgICAgY29uc3QgZm9ybVN1Ym1pdCA9IG5ldyBGb3JtU3VibWl0KGZvcm0pO1xuICAgICAgLy8gaGFuZGxlciAtIHZlcmlmeSBwcml2aWxlZ2VzIGJlZm9yZSBzZXR0aW5ncyBmb3JtIHN1Ym1pdFxuICAgICAgY29uc3Qgc3VibWl0X3ByaXZpbGVnZXMgPSBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3AgPSBhd2FpdCB0aGlzLmNsZWFuUHJpdmlsZWdlcygpO1xuICAgICAgICByZXR1cm4gcmVzcDtcbiAgICAgIH1cbiAgICAgIGZvcm1TdWJtaXQuYWRkSGFuZGxlcihzdWJtaXRfcHJpdmlsZWdlcyk7XG4gICAgICBpbnN0YW5jZSA9IHRoaXM7XG4gICAgfVxuICAgIHJldHVybiBpbnN0YW5jZTtcbiAgfVxuXG4gIG5ld0xpbmUocmV0ID0gZmFsc2UsIGNoZWNrID0gMCkge1xuICAgIGxldCBsaW5lO1xuICAgIGlmIChjaGVjayA+IDApIHtcbiAgICAgIGxpbmUgPSB0aGlzLmdldExpbmVQcml2aWxlZ2UoY2hlY2spO1xuICAgICAgaWYgKGxpbmUpIHJldHVybiBsaW5lO1xuICAgIH1cbiAgICBjb25zdCBsaW5lcyA9IHRoaXMuZmllbGRzZXQucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtYmxvY2s9XCInICsgdGhpcy5vcHRpb25zLnRhcmdldCArICdcIl0nKTtcblxuICAgIGlmIChsaW5lcy5sZW5ndGggPT09IDApIHJldHVybjtcbiAgICBjb25zdCBuID0gbGluZXMubGVuZ3RoIC0gMTtcbiAgICBsaW5lID0gbGluZXNbbl07XG4gICAgaWYgKGxpbmUgIT09IG51bGwpIHtcbiAgICAgIGxpbmUgPSB0aGlzLmNsZWFyTGluZShsaW5lLmNsb25lTm9kZSh0cnVlKSwgbiwgKHRoaXMub3B0aW9ucy5zZXBhciA/IHRoaXMub3B0aW9ucy5zZXBhciA6IGxpbmUpKTtcblxuICAgICAgdGhpcy5hY3RpdmF0ZUV2ZW50cyhsaW5lKTtcblxuICAgIH1cbiAgICBpZiAocmV0ID09PSB0cnVlKSByZXR1cm4gbGluZTtcbiAgfVxuXG4gIGFkZExpc3RlbmVyKCkge1xuICAgIHRoaXMub3B0aW9ucy50YXJnZXQgPSAodGhpcy5vcHRpb25zLmFkZGJ0bi5kYXRhc2V0LnRhcmdldCkgPyB0aGlzLm9wdGlvbnMuYWRkYnRuLmRhdGFzZXQudGFyZ2V0IDogdGhpcy5vcHRpb25zLnRhcmdldDtcbiAgICB0aGlzLm9wdGlvbnMuYWRkYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKGUpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHRoaXMubmV3TGluZSgpO1xuICAgIH0pXG4gIH1cblxuICBjbGVhckxpbmUobGluZSwgbiwgc2VwYXIgPSBudWxsKSB7XG4gICAgLypjbGVhbiBsaW5lIGVsZW1lbnQgKi9cblxuICAgIGxldCBoYXNfYXV0b2NvbXBsZXRlID0gbnVsbDtcbiAgICBsaW5lLmRhdGFzZXQubW9kID0gJyc7XG4gICAgbGluZS5kaXNhYmxlZCA9IGZhbHNlO1xuICAgIGNvbnN0IGVsZW1zID0gbGluZS5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1lbGVtXScpO1xuICAgIGVsZW1zLmZvckVhY2goKGVsZW0pID0+IHtcbiAgICAgIC8vIGNoYW5nZSBsb29wIGluZGV4IC0gbmVjZXNzYXJ5IGZvciB0YWlsd2luZGNzcyBwZWVyY2hlY2tlZCB0byB3b3JrIG90aGVyd2lzZSBub3QgaWYgbmFtZSBlbmRzIHdpdGggW11cbiAgICAgIC8vcmVtb3ZlIGNvbXBvbmVudHNcbiAgICAgIGNvbnN0IHJtcyA9IGVsZW0ucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtY29tcG9uZW50XScpXG4gICAgICBybXMuZm9yRWFjaCgocm0pID0+IHtcbiAgICAgICAgc3dpdGNoIChybS5kYXRhc2V0LmNvbXBvbmVudCkge1xuICAgICAgICAgIGNhc2UgJ3RvbS1zZWxlY3QnOlxuICAgICAgICAgICAgcm0ucmVtb3ZlKCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICAgIC8vIGNsZWFuIGFuZCByZXNldCBldmVudHNcbiAgICAgIGNvbnN0IGVscyA9IGVsZW0ucXVlcnlTZWxlY3RvckFsbCgnaW5wdXQsIHNlbGVjdCwgbGFiZWwnKTtcbiAgICAgIGVscy5mb3JFYWNoKChlbCkgPT4ge1xuXG4gICAgICAgIGVsLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgIGlmIChzZXBhcikgeyAvLyBjaGFuZ2UgbmFtZXMgYW5kIGlkIHdoZW4gYWRkaW5nIGEgbmV3IHJvdyAtIG5vdCBpZiBjbGVhciBvbmx5XG4gICAgICAgICAgY29uc3Qga2V5cyA9IFsnaWQnLCAnZm9yJywgJ2FyaWEtY29udHJvbHMnLCAnbmFtZSddO1xuICAgICAgICAgIGtleXMuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgICAgICAgICBsZXQgdmFsID0gZWwuZ2V0QXR0cmlidXRlKGtleSk7XG4gICAgICAgICAgICBpZiAodmFsICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgIGlmIChrZXkgPT09ICduYW1lJykgdmFsID0gdmFsLnJlcGxhY2UoJ1snICsgbiArICddJywgJ1snICsgKG4gKyAxKSArICddJyk7XG4gICAgICAgICAgICAgIGVsc2UgdmFsID0gdmFsLnJlcGxhY2UoJ18nICsgbiwgJ18nICsgKG4gKyAxKSk7XG4gICAgICAgICAgICAgIGVsLnNldEF0dHJpYnV0ZShrZXksIHZhbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgc3dpdGNoIChlbC50YWdOYW1lLnRvTG93ZXJDYXNlKCkpIHtcbiAgICAgICAgICBjYXNlICdpbnB1dCc6XG4gICAgICAgICAgICAvL2VsLmluZGV0ZXJtaW5hdGUgPSB0cnVlO1xuICAgICAgICAgICAgZWwuY2hlY2tlZCA9IGZhbHNlO1xuICAgICAgICAgICAgLy8gZGlzYWJsZSBjb250YWN0IGFzIHByaXZpbGVnZSBpcyBlbXB0eVxuICAgICAgICAgICAgaWYgKGVsLm5hbWUgPT0gdGhpcy5vcHRpb25zLmNvbnRhY3RmaWVsZG5hbWUpIHtcbiAgICAgICAgICAgICAgZWwudmFsdWUgPSBcIjBcIjtcbiAgICAgICAgICAgICAgZWwuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSAnc2VsZWN0JzpcbiAgICAgICAgICAgIGVsLnNlbGVjdGVkSW5kZXggPSAtMTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgJ2xhYmVsJzpcbiAgICAgICAgICAgIGVsLmNsYXNzTGlzdC5yZW1vdmUoY3NzLnBlZXJjaGVja2VkKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGlmIChlbC50b21zZWxlY3QpIHtcbiAgICAgICAgICBoYXNfYXV0b2NvbXBsZXRlID0gZWw7XG4gICAgICAgICAgZWwudG9tc2VsZWN0LmNsZWFyKCk7XG4gICAgICAgICAgZWwudG9tc2VsZWN0LmRlc3Ryb3koKTtcblxuICAgICAgICB9XG4gICAgICAgIGlmIChlbC5jbGFzc0xpc3QuY29udGFpbnMoY3NzLmNvbXBvbmVudC5hdXRvY29tcGxldGUudG9tc2VsZWN0ZWQpKSB7XG4gICAgICAgICAgaGFzX2F1dG9jb21wbGV0ZSA9IGVsO1xuICAgICAgICAgIGVsLmNsYXNzTGlzdC5mb3JFYWNoKGNsID0+IHtcbiAgICAgICAgICAgIGlmIChjbC5pbmRleE9mKCd0cy0nKSA9PSAwKSBlbC5jbGFzc0xpc3QucmVtb3ZlKGNsKTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIGVsLmNsYXNzTGlzdC5yZW1vdmUoY3NzLmNvbXBvbmVudC5hdXRvY29tcGxldGUudG9tc2VsZWN0ZWQpO1xuICAgICAgICAgIGlmIChlbC50eXBlID09IFwic2VsZWN0LW9uZVwiKSBkZWxldGUgZWwudHlwZTtcblxuICAgICAgICB9XG5cbiAgICAgIH0pXG5cbiAgICB9KVxuICAgIC8qIGFkZCBmdW5jdGlvbm5hbGl0aWVzICovXG4gICAgaWYgKHNlcGFyKSB7XG4gICAgICBsaW5lLmNsYXNzTGlzdC5hZGQoJ25ldycpO1xuICAgICAgc2VwYXIuYWZ0ZXIobGluZSk7XG4gICAgfVxuICAgIC8qIGNsZWFyIGFuZCBhZGQgdG9tLXNlbGVjdCBmdW5jdGlvbmFsaXRpZXMgLSBvbmx5IGFmdGVyIGFkZGluZyBsaW5lIHRvIHRoZSBkb20qL1xuICAgIGlmIChoYXNfYXV0b2NvbXBsZXRlICE9PSBudWxsKSB7XG4gICAgICBjb25zdCBqc1RvbVNlbGVjdCA9IG5ldyBKc1RvbVNlbGVjdCgpO1xuICAgICAganNUb21TZWxlY3QuYXBwbHlUbyhoYXNfYXV0b2NvbXBsZXRlKTtcbiAgICAgIGhhc19hdXRvY29tcGxldGUudG9tc2VsZWN0LmNsZWFyT3B0aW9ucygpO1xuICAgICAgbGV0IG9wdGlvbnMgPSB0aGlzLmZpZWxkc2V0LmRhdGFzZXQub3B0aW9ucztcbiAgICAgIG9wdGlvbnMgPSAob3B0aW9ucykgPyBvcHRpb25zIDogW107XG4gICAgICBoYXNfYXV0b2NvbXBsZXRlLnRvbXNlbGVjdC5hZGRPcHRpb25zKG9wdGlvbnMpO1xuICAgIH07XG5cblxuICAgIHJldHVybiBsaW5lO1xuICB9XG5cbiAgc2V0TGluZShsaW5lLCBtYiA9IHtcbiAgICBrZXk6ICcnLFxuICAgIHZhbHVlOiAnJ1xuICB9LCBwcml2LCBjdCkge1xuXG4gICAgcHJpdiA9IGRlZmluZWRfcHJpdmlsZWdlc1twcml2XSA/IGRlZmluZWRfcHJpdmlsZWdlc1twcml2XSA6IGRlZmluZWRfcHJpdmlsZWdlcy52aWV3ZXJzO1xuICAgIGlmICghcHJpdikgcmV0dXJuO1xuICAgIGNvbnN0IHtcbiAgICAgIG1lbWJlcixcbiAgICAgIHByaXZzLFxuICAgICAgY29udGFjdCxcbiAgICAgIGRlbGV0XG4gICAgfSA9IHRoaXMuZ2V0SW5wdXRzKGxpbmUsIHByaXYpO1xuICAgIGlmICghbWVtYmVyIHx8ICFwcml2cyB8fCAhY29udGFjdCB8fCAhZGVsZXQpIHJldHVybjtcblxuICAgIC8vIHNhbml0aXplXG4gICAgbWIua2V5ID0gRE9NUHVyaWZ5LnNhbml0aXplKG1iLmtleSk7XG4gICAgbWIudmFsdWUgPSBET01QdXJpZnkuc2FuaXRpemUobWIudmFsdWUpO1xuICAgIGNvbnN0IHRzID0gbWVtYmVyLnRvbXNlbGVjdDtcbiAgICBpZiAodHMpIHtcbiAgICAgIHRzLmNsZWFyKCk7XG4gICAgICBjb25zdCBhZGRtYiA9IHt9XG4gICAgICBhZGRtYlt0cy5zZXR0aW5ncy52YWx1ZUZpZWxkXSA9IG1iLmtleTtcbiAgICAgIGFkZG1iW3RzLnNldHRpbmdzLmxhYmVsRmllbGRdID0gYWRkbWJbdHMuc2V0dGluZ3Muc2VhcmNoRmllbGRdID0gbWIudmFsdWU7XG4gICAgICB0cy5hZGRPcHRpb24oYWRkbWIpO1xuICAgICAgdHMuc2V0VmFsdWUoW21iLmtleV0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBzZWxlY3RlZCA9IG1lbWJlci5xdWVyeVNlbGVjdG9yKCdzZWxlY3Qgb3B0aW9uW3ZhbHVlPVwiJyArIG1iLmtleSArICdcIl0nKTtcbiAgICAgIGlmIChzZWxlY3RlZCkgc2VsZWN0ZWQuc2VsZWN0ZWQgPSB0cnVlO1xuICAgICAgZWxzZSBtZW1iZXIuaW5zZXJ0QWRqYWNlbnRIVE1MKCdiZWZvcmVlbmQnLCAnPG9wdGlvbiB2YWx1ZT1cIicgKyBtYi5rZXkgKyAnXCIgc2VsZWN0ZWQ+JyArIG1iLnZhbHVlICsgJzwvb3B0aW9uPicpO1xuXG4gICAgfVxuICAgIHByaXZzLmNoZWNrZWQgPSB0cnVlO1xuICAgIGNvbnRhY3QudmFsdWUgPSBtYi5rZXk7XG4gICAgaWYgKHByaXYgPT09IHJpZ2h0cy5tYW5hZ2UpIHtcbiAgICAgIGNvbnRhY3QuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgIGlmIChjdCA9PT0gdHJ1ZSkgY29udGFjdC5jaGVja2VkID0gdHJ1ZTtcblxuICAgIH0gZWxzZSB7XG4gICAgICBjb250YWN0LmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgIGNvbnRhY3QuY2hlY2tlZCA9IGZhbHNlO1xuICAgIH1cblxuICB9XG4gIGdldElucHV0cyhsaW5lLCBwcml2ID0gZmFsc2UpIHtcbiAgICBjb25zdCBtZW1iZXIgPSBsaW5lLnF1ZXJ5U2VsZWN0b3IoXCJbbmFtZSo9J1tcIiArIHRoaXMub3B0aW9ucy5pZGVudCArIFwiXSddXCIpO1xuICAgIGxldCBwcml2cztcbiAgICBpZiAocHJpdikge1xuICAgICAgcHJpdnMgPSBsaW5lLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWUqPVwiWycgKyB0aGlzLm9wdGlvbnMucHJpdmlsZWdlICsgJ11cIl1bdmFsdWU9XCInICsgcHJpdiArICdcIl0nKTtcbiAgICB9IGVsc2UgcHJpdnMgPSBsaW5lLnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0W25hbWUqPVwiWycgKyB0aGlzLm9wdGlvbnMucHJpdmlsZWdlICsgJ11cIl0nKTtcbiAgICBjb25zdCBjb250YWN0ID0gbGluZS5xdWVyeVNlbGVjdG9yKCdpbnB1dFtuYW1lPVwiJyArIHRoaXMub3B0aW9ucy5jb250YWN0ZmllbGRuYW1lICsgJ1wiXScpO1xuICAgIGNvbnN0IGRlbGV0ID0gbGluZS5xdWVyeVNlbGVjdG9yKFwiaW5wdXRbbmFtZSo9J1tcIiArIHRoaXMub3B0aW9ucy5kZWxldCArIFwiXSddXCIpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIG1lbWJlcjogbWVtYmVyLFxuICAgICAgcHJpdnM6IHByaXZzLFxuICAgICAgY29udGFjdDogY29udGFjdCxcbiAgICAgIGRlbGV0OiBkZWxldFxuICAgIH07XG4gIH1cbiAgYXN5bmMgaW1wb3J0UHJpdmlsZWdlcyhwcml2aWxlZ2VzLCByZXBsYWNlID0gZmFsc2UsIGNvbnRhY3QgPSBudWxsLCBpbXBvcnRlZHRhZyA9IG51bGwsIGRpc21pc3MgPSBudWxsKSB7XG4gICAgbGV0IGxhc3RsaW5lID0gIXJlcGxhY2U7XG5cbiAgICB0cnkge1xuICAgICAgT2JqZWN0LmVudHJpZXMocHJpdmlsZWdlcykuZm9yRWFjaCgoW3ByaXYsIG1lbWJlcnNdKSA9PiB7XG4gICAgICAgIG1lbWJlcnMuZm9yRWFjaCgobWVtYmVyKSA9PiB7XG4gICAgICAgICAgaWYgKCFsYXN0bGluZSkgbGFzdGxpbmUgPSB0aGlzLmNsZWFyQWxsKHRydWUsICgocmVwbGFjZSA9PT0gdHJ1ZSkgPyBtZW1iZXIuaWQgOiBudWxsKSk7XG4gICAgICAgICAgZWxzZSBsYXN0bGluZSA9IHRoaXMubmV3TGluZSh0cnVlLCBtZW1iZXIuaWQpO1xuICAgICAgICAgIGlmIChsYXN0bGluZSkge1xuICAgICAgICAgICAgdGhpcy5zZXRMaW5lKGxhc3RsaW5lLCB7XG4gICAgICAgICAgICAgIGtleTogbWVtYmVyLmlkLFxuICAgICAgICAgICAgICB2YWx1ZTogbWVtYmVyLm5hbWUsXG4gICAgICAgICAgICB9LCBwcml2LCAoY29udGFjdCAhPT0gbnVsbCAmJiAocGFyc2VJbnQoY29udGFjdC5pZCkgPT09IHBhcnNlSW50KG1lbWJlci5pZCkpKSk7XG4gICAgICAgICAgICBpZiAoaW1wb3J0ZWR0YWcpIGltcG9ydGVkdGFnKGxhc3RsaW5lKTtcblxuICAgICAgICAgIH1cblxuICAgICAgICB9KTtcblxuICAgICAgfSk7XG4gICAgICBpZiAoZGlzbWlzcykgZGlzbWlzcygpO1xuICAgICAgdGhpcy5hbGVydEJveC5kaXNtaXNzQWxlcnQoY29kZW1lc3NhZ2VzLmltcG9ydHByaXZlcnJvcik7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGF3YWl0IHRoaXMuYWxlcnRCb3guYnVpbGQoe1xuICAgICAgICBkaXNtaXNzaWJsZTogdHJ1ZSxcbiAgICAgICAgbWVzc2FnZTogY29kZW1lc3NhZ2VzLmltcG9ydHByaXZlcnJvcixcbiAgICAgICAgY29kZWlkOiB0cnVlLFxuICAgICAgICBwYXJlbnQ6IHRoaXMuZmllbGRzZXRfYWxlcnRfem9uZSxcbiAgICAgICAgdHlwZTogYWxlcnRjb25maWcuZGFuZ2VyLFxuICAgICAgfSk7XG4gICAgICBjb25zb2xlLmxvZygnZXJyJywgZXJyKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cbiAgYWN0aXZhdGVFdmVudHMobGluZSkge1xuICAgIGlmICghbGluZSkgcmV0dXJuO1xuICAgIGNvbnN0IHtcbiAgICAgIG1lbWJlcixcbiAgICAgIHByaXZzLFxuICAgICAgY29udGFjdCxcbiAgICAgIGRlbGV0XG4gICAgfSA9IHRoaXMuZ2V0SW5wdXRzKGxpbmUpO1xuICAgIGlmICghbWVtYmVyIHx8ICFwcml2cyB8fCAhY29udGFjdCB8fCAhZGVsZXQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3Qgc2libGluZ3MgPSBzID0+IFsuLi5zLnBhcmVudEVsZW1lbnQuY2hpbGRyZW5dLmZpbHRlcihjID0+IGMubm9kZVR5cGUgPT0gMSAmJiBjICE9IHMgJiYgYy5jbGFzc0xpc3QuY29udGFpbnMoJ3JvdycpICYmIGMuZGF0YXNldC5ibG9jayAhPT0gbnVsbCAmJiBjLmRhdGFzZXQuYmxvY2sgPT09IHRoaXMub3B0aW9ucy50YXJnZXQpO1xuXG4gICAgLy8gZW5hYmxlL2Rpc2FibGUgY29udGFjdCB3aGVuIHByaXZpbGVnZSBjaGFuZ2VzXG4gICAgY29uc3QgbGluZVNldHRpbmdzID0gKHByLCBjdCwgZGwsIHN5bmNocm8gPSBmYWxzZSkgPT4ge1xuXG4gICAgICBpZiAocHIgJiYgcHIudmFsdWUgPT09IHJpZ2h0cy5tYW5hZ2UpIHtcbiAgICAgICAgLy8gbWFuYWdlciAtIGNhbid0IGRlbGV0ZSBsaW5lIC0gY2FuIGNob29zZSBhcyBjb250YWN0XG4gICAgICAgIGRsLmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgY3QuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgLy8gZGlzbWlzcyByZWxhdGVkIGFsZXJ0XG4gICAgICAgIHRoaXMuYWxlcnRCb3guZGlzbWlzc0FsZXJ0KGNvZGVtZXNzYWdlcy5ub21hbmFnZXIpO1xuICAgICAgICBpZiAoY3QuY2hlY2tlZCkge1xuICAgICAgICAgIHRoaXMuYWxlcnRCb3guZGlzbWlzc0FsZXJ0KGNvZGVtZXNzYWdlcy5ub2NvbnRhY3QpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBub3QgbWFuYWdlciAtIGNhbiBkZWxldCBsaW5lIC0gY2Fubm90IGNob3NlIGFzIGNvbnRhY3RcbiAgICAgICAgLy8gIGlmIChjdC5jaGVja2VkID09PSB0cnVlKSBjdC5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgnY2xpY2snKSk7XG4gICAgICAgIGN0LmNoZWNrZWQgPSBmYWxzZTtcbiAgICAgICAgZGwuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgY3QuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgfVxuXG4gICAgICBpZiAoc3luY2hybyA9PT0gdHJ1ZSkge1xuICAgICAgICBzeW5jaHJvU2libGluZ3MobGluZSk7XG4gICAgICB9XG4gICAgICAvLyBkaXNtaXNzIGFsZXJ0c1xuICAgICAgaWYgKCFkbC5ja2Vja2VkKSB7XG4gICAgICAgIHRoaXMuYWxlcnRCb3guZGlzbWlzc0FsZXJ0KGNvZGVtZXNzYWdlcy5ub2JvZHkpO1xuICAgICAgICB0aGlzLmFsZXJ0Qm94LmRpc21pc3NBbGVydChjb2RlbWVzc2FnZXMub25lYXRsZWFzdCk7XG4gICAgICB9XG4gICAgfVxuICAgIGNvbnN0IHN5bmNocm9TaWJsaW5ncyA9IChsaW5lKSA9PiB7XG4gICAgICBjb25zdCBsbnMgPSBzaWJsaW5ncyhsaW5lKTtcbiAgICAgIGxucy5mb3JFYWNoKChsbikgPT4ge1xuICAgICAgICBjb25zdCBkbCA9IGxuLnF1ZXJ5U2VsZWN0b3IoXCJpbnB1dFtuYW1lKj0nW1wiICsgdGhpcy5vcHRpb25zLmRlbGV0ICsgXCJdJ11cIik7XG4gICAgICAgIGNvbnN0IGN0ID0gbG4ucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZT1cIicgKyB0aGlzLm9wdGlvbnMuY29udGFjdGZpZWxkbmFtZSArICdcIl0nKTtcbiAgICAgICAgY29uc3QgcHIgPSBsbi5xdWVyeVNlbGVjdG9yKCdpbnB1dFtuYW1lKj1cIlsnICsgdGhpcy5vcHRpb25zLnByaXZpbGVnZSArICddXCJdOmNoZWNrZWQnKTtcbiAgICAgICAgbGluZVNldHRpbmdzKHByLCBjdCwgZGwsIGZhbHNlKTtcblxuICAgICAgfSlcbiAgICB9XG5cbiAgICBtZW1iZXIuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKGUpID0+IHtcbiAgICAgIGNvbnRhY3QudmFsdWUgPSBtZW1iZXIudmFsdWU7XG4gICAgICAvLyBkaXNtaXNzIGFsZXJ0XG4gICAgICBpZiAobWVtYmVyLnZhbHVlKSB7XG4gICAgICAgIHRoaXMuYWxlcnRCb3guZGlzbWlzc0FsZXJ0KGNvZGVtZXNzYWdlcy5lbXB0eW5hbWUpO1xuICAgICAgICB0aGlzLmFsZXJ0Qm94LmRpc21pc3NBbGVydChjb2RlbWVzc2FnZXMub25lYXRsZWFzdCk7XG4gICAgICAgIHRoaXMuYWxlcnRCb3guZGlzbWlzc0FsZXJ0KGNvZGVtZXNzYWdlcy5ub2JvZHkpO1xuICAgICAgfVxuICAgIH0pXG5cbiAgICBwcml2cy5mb3JFYWNoKChwcml2KSA9PiB7XG4gICAgICBwcml2LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIChlKSA9PiB7XG4gICAgICAgIGlmIChwcml2LmNoZWNrZWQpIGxpbmVTZXR0aW5ncyhwcml2LCBjb250YWN0LCBkZWxldCwgZmFsc2UpO1xuICAgICAgfSk7XG5cbiAgICAgIGlmIChwcml2LmNoZWNrZWQpIGxpbmVTZXR0aW5ncyhwcml2LCBjb250YWN0LCBkZWxldCwgZmFsc2UpO1xuICAgIH0pXG5cbiAgICBjb250YWN0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIChlKSA9PiB7XG4gICAgICBpZiAoZS50YXJnZXQuY2hlY2tlZCkgZGVsZXQuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgZWxzZSBkZWxldC5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgY29uc3QgcHJpdiA9IGxpbmUucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZSo9XCJbJyArIHRoaXMub3B0aW9ucy5wcml2aWxlZ2UgKyAnXVwiXTpjaGVja2VkJyk7XG4gICAgICBsaW5lU2V0dGluZ3MocHJpdiwgY29udGFjdCwgZGVsZXQsIHRydWUpO1xuICAgICAgLy8gZW5hYmxlIG90aGVyd2lzZVxuXG4gICAgfSlcblxuICAgIC8vIGRlbGV0IG9rIGZvciBhbGwgd2hlbiBuZXcgbGluZVxuICAgIC8vXG4gICAgZGVsZXQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgLy8gYXQgbGVhc3Qgb25lIHByaXYgbGluZVxuICAgICAgY29uc3QgZGVsZXRsYWJlbCA9IGRlbGV0LmNsb3Nlc3QoJ2xhYmVsJyk7XG4gICAgICBjb25zdCBsaW5lcyA9IHRoaXMuZmllbGRzZXQucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtYmxvY2s9XCInICsgdGhpcy5vcHRpb25zLnRhcmdldCArICdcIl06bm90KFtkYXRhLW1vZD1cInJlbW92ZVwiXSknKTtcbiAgICAgIGlmIChsaW5lcy5sZW5ndGggPD0gMSAmJiBlLnRhcmdldC5jaGVja2VkKSB7XG4gICAgICAgIGRlbGV0LmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgZGVsZXQuY2hlY2tlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmFsZXJ0Qm94LmJ1aWxkKHtcbiAgICAgICAgICBkaXNtaXNzaWJsZTogdHJ1ZSxcbiAgICAgICAgICBtZXNzYWdlOiBjb2RlbWVzc2FnZXMub25lYXRsZWFzdCxcbiAgICAgICAgICBjb2RlbWVzc2FnZTogY29kZW1lc3NhZ2VzLm9uZWF0bGVhc3QsXG4gICAgICAgICAgdHlwZTogYWxlcnRjb25maWcud2FybmluZyxcbiAgICAgICAgICBwYXJlbnQ6IChlLmN1cnJlbnRUYXJnZXQuaWQgfHwgbnVsbClcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH0gZWxzZSBpZiAoZS50YXJnZXQuY2hlY2tlZCkge1xuICAgICAgICB0aGlzLmFsZXJ0Qm94LmRpc21pc3NBbGVydChjb2RlbWVzc2FnZXMub25lYXRsZWFzdCk7XG4gICAgICAgIGlmIChsaW5lLmNsYXNzTGlzdC5jb250YWlucygnbmV3JykpIHtcbiAgICAgICAgICBsaW5lLnJlbW92ZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChkZWxldGxhYmVsICYmIGRlbGV0bGFiZWwuZGF0YXNldC5yZXN0b3JlKSBkZWxldGxhYmVsLnNldEF0dHJpYnV0ZSgndGl0bGUnLCBkZWxldGxhYmVsLmRhdGFzZXQucmVzdG9yZSk7XG4gICAgICAgICAgbGluZS5zZXRBdHRyaWJ1dGUoJ2RhdGEtbW9kJywgJ3JlbW92ZScpO1xuICAgICAgICAgIHByaXZzLmZvckVhY2gocHJpdiA9PiB7XG4gICAgICAgICAgICBwcml2LmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIHByaXYuY2hlY2tlZCA9IGZhbHNlO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgY29udGFjdC5jaGVja2VkID0gZmFsc2U7XG4gICAgICAgICAgY29udGFjdC5kaXNhYmxlZCA9IHRydWU7XG4gICAgICAgICAgbWVtYmVyLmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGRlbGV0bGFiZWwgJiYgZGVsZXRsYWJlbC5kYXRhc2V0LnJlbW92ZSkgZGVsZXRsYWJlbC5zZXRBdHRyaWJ1dGUoJ3RpdGxlJywgZGVsZXRsYWJlbC5kYXRhc2V0LnJlbW92ZSk7XG4gICAgICAgIGxpbmUucmVtb3ZlQXR0cmlidXRlKCdkYXRhLW1vZCcpO1xuICAgICAgICBwcml2cy5mb3JFYWNoKHByaXYgPT4gcHJpdi5kaXNhYmxlZCA9IGZhbHNlKTtcbiAgICAgICAgY29udGFjdC5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgICBtZW1iZXIuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICAvLyBkZWxldCBtb3VzZW92ZXIgLSBleHBsYWluIHdoeSBpdCBpcyBkaXNhYmxlZCB3aGVuIG1hbmFnZSBpcyBjaGVja2VkXG4gICAgZGVsZXQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdmVyJywgKGUpID0+IHtcbiAgICAgIGlmIChlLnRhcmdldC5kaXNhYmxlZCkge1xuICAgICAgICBsZXQgcHIgPSBsaW5lLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWUqPVwiWycgKyB0aGlzLm9wdGlvbnMucHJpdmlsZWdlICsgJ11cIl06Y2hlY2tlZCcpO1xuICAgICAgICBpZiAoIXByKSByZXR1cm47XG4gICAgICAgIHByID0gcHIudmFsdWUudG9Mb3dlckNhc2UoKVxuICAgICAgICBlLnRhcmdldC50aXRsZSA9IChlLnRhcmdldC5kYXRhc2V0W3ByXSkgPyBlLnRhcmdldC5kYXRhc2V0W3ByXSA6IGUudGFyZ2V0LnRpdGxlXG4gICAgICB9XG4gICAgfSlcbiAgICAvLyBkaXNhYmxlIGRlbGV0IGlmIHVzZXIgaXMgdGhlIG9ubHkgbWFuYWdlclxuICAgIGlmICh0aGlzLmN1cnJlbnRfdWlkID09PSBtZW1iZXIudmFsdWUpIGRlbGV0LmRpc2FibGVkID0gdHJ1ZTtcblxuXG4gIH1cblxuICAvLyBzZW5kIGNsZWFuIGRhdGEgb24gc3VibWl0XG4gIGFzeW5jIGNsZWFuUHJpdmlsZWdlcygpIHtcbiAgICAvLyBjaGVjayBtYW5hZ2VycyBhbmQgY29udGFjdF91c2VyX2lkIG9uIHN1Ym1pdFxuXG4gICAgY29uc3QgY2hlY2tDb250YWN0ID0gYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gY2hlY2sgaWYgb25lIG1hbmFnZXIgYXQgbGVhc3RcbiAgICAgIGNvbnN0IG1hbmFnZXJzID0gdGhpcy5maWVsZHNldC5xdWVyeVNlbGVjdG9yQWxsKCdbbmFtZSo9XCJbJyArIHRoaXMub3B0aW9ucy5wcml2aWxlZ2UgKyAnXVwiXVt2YWx1ZT1cIicgKyByaWdodHMubWFuYWdlICsgJ1wiXTpjaGVja2VkJyk7XG4gICAgICBsZXQgbiA9IG1hbmFnZXJzLmxlbmd0aDtcblxuICAgICAgaWYgKG4gPT09IDApIHtcbiAgICAgICAgYXdhaXQgdGhpcy5hbGVydEJveC5idWlsZCh7XG4gICAgICAgICAgZGlzbWlzc2libGU6IHRydWUsXG4gICAgICAgICAgbWVzc2FnZTogY29kZW1lc3NhZ2VzLm5vbWFuYWdlcixcbiAgICAgICAgICBjb2RlaWQ6IHRydWUsXG4gICAgICAgICAgdHlwZTogYWxlcnRjb25maWcuZGFuZ2VyLFxuICAgICAgICAgIHBhcmVudDogdGhpcy5maWVsZHNldF9hbGVydF96b25lLFxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy50YWJFcnJvcih0cnVlKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5hbGVydEJveC5kaXNtaXNzQWxlcnQoY29kZW1lc3NhZ2VzLm5vbWFuYWdlcik7XG4gICAgICAgIHRoaXMudGFiRXJyb3IoZmFsc2UpO1xuICAgICAgfVxuICAgICAgLy8gY2hlY2sgY29udGFjdFxuICAgICAgY29uc3QgY29udGFjdCA9IHRoaXMuZmllbGRzZXQucXVlcnlTZWxlY3RvcignW25hbWU9XCInICsgdGhpcy5vcHRpb25zLmNvbnRhY3RmaWVsZG5hbWUgKyAnXCJdOmNoZWNrZWQnKTtcblxuICAgICAgaWYgKGNvbnRhY3QgPT09IG51bGwpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5hbGVydEJveC5idWlsZCh7XG4gICAgICAgICAgZGlzbWlzc2libGU6IHRydWUsXG4gICAgICAgICAgY29kZWlkOiB0cnVlLFxuICAgICAgICAgIG1lc3NhZ2U6IGNvZGVtZXNzYWdlcy5ub2NvbnRhY3QsXG4gICAgICAgICAgdHlwZTogYWxlcnRjb25maWcuZGFuZ2VyLFxuICAgICAgICAgIHBhcmVudDogdGhpcy5maWVsZHNldF9hbGVydF96b25lXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnRhYkVycm9yKHRydWUpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICB0aGlzLmFsZXJ0Qm94LmRpc21pc3NBbGVydChjb2RlbWVzc2FnZXMubm9jb250YWN0KTtcbiAgICAgIHRoaXMudGFiRXJyb3IoZmFsc2UpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGNvbnN0IGhhc01lbWJlciA9IChsaW5lKSA9PiB7XG4gICAgICBjb25zdCBtZW1iZXIgPSBsaW5lLnF1ZXJ5U2VsZWN0b3IoJ1tuYW1lKj1cIlsnICsgdGhpcy5vcHRpb25zLmlkZW50ICsgJ11cIl0nKTtcbiAgICAgIHJldHVybiAobWVtYmVyLnZhbHVlKTtcbiAgICB9XG4gICAgY29uc3QgaGFzUHJpdiA9IChsaW5lKSA9PiB7XG4gICAgICBjb25zdCBwcml2ID0gbGluZS5xdWVyeVNlbGVjdG9yKCdbbmFtZSo9XCJbJyArIHRoaXMub3B0aW9ucy5wcml2aWxlZ2UgKyAnXVwiXTpjaGVja2VkJyk7XG4gICAgICBpZiAocHJpdiAmJiBwcml2LnZhbHVlKSByZXR1cm4gdHJ1ZTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uc3QgZm9ybWF0UHJpdmlsZWdlID0gKGxpbmUpID0+IHtcblxuICAgICAgY29uc3QgZWxzID0gbGluZS5xdWVyeVNlbGVjdG9yQWxsKCdbbmFtZSo9XCJtZW1iZXJzW1wiJyk7XG4gICAgICBlbHMuZm9yRWFjaCgoZWwpID0+IHtcbiAgICAgICAgbGV0IG5hbWUgPSBlbC5uYW1lO1xuICAgICAgICBuYW1lID0gbmFtZS5zcGxpdCgnWycpO1xuICAgICAgICBuYW1lLnBvcCgpO1xuICAgICAgICBlbC5uYW1lID0gbmFtZS5qb2luKCdbJyk7XG4gICAgICAgIGlmIChlbC5uYW1lLmluZGV4T2YoJ1snICsgdGhpcy5vcHRpb25zLnByaXZpbGVnZSArICddJykgPiAwKSB7XG4gICAgICAgICAgZWwudHlwZSA9ICdjaGVja2JveCc7XG4gICAgICAgICAgZWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7XG4gICAgICAgIH1cblxuICAgICAgfSlcbiAgICB9XG4gICAgY29uc3QgaGFzY29udGFjdCA9IGF3YWl0IGNoZWNrQ29udGFjdCgpO1xuICAgIGlmIChoYXNjb250YWN0ID09PSB0cnVlKSB7XG4gICAgICBjb25zdCBsaW5lcyA9IHRoaXMuZmllbGRzZXQucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtYmxvY2s9XCInICsgdGhpcy5vcHRpb25zLnRhcmdldCArICdcIl0nKTtcbiAgICAgIGxldCBuID0gbGluZXMubGVuZ3RoO1xuICAgICAgbGV0IHZlcmlmID0gdHJ1ZTtcbiAgICAgIGZvciAoY29uc3QgbGluZSBvZiBsaW5lcykge1xuICAgICAgICBpZiAobGluZS5kYXRhc2V0Lm1vZCAmJiBsaW5lLmRhdGFzZXQubW9kID09PSAncmVtb3ZlJykge1xuICAgICAgICAgIGlmIChuID4gMSkge1xuICAgICAgICAgICAgbGluZS5yZW1vdmUoKTtcbiAgICAgICAgICAgIG4tLTtcbiAgICAgICAgICB9IGVsc2UgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9IGVsc2UgaWYgKCFoYXNNZW1iZXIobGluZSkpIHtcbiAgICAgICAgICBjb25zdCBsaW5lbm8gPSBsaW5lLnF1ZXJ5U2VsZWN0b3IoJ1tuYW1lKj1cIlsnICsgdGhpcy5vcHRpb25zLmlkZW50ICsgJ11cIl0nKTtcbiAgICAgICAgICBsaW5lbm8uZm9jdXMoKTtcbiAgICAgICAgICBpZiAobGluZW5vLnRvbXNlbGVjdCkgbGluZW5vLnRvbXNlbGVjdC5mb2N1cygpO1xuICAgICAgICAgIGF3YWl0IHRoaXMuYWxlcnRCb3guYnVpbGQoe1xuICAgICAgICAgICAgZGlzbWlzc2libGU6IHRydWUsXG4gICAgICAgICAgICBpbnNlcnRhZnRlcjogdHJ1ZSxcbiAgICAgICAgICAgIG1lc3NhZ2U6IGNvZGVtZXNzYWdlcy5lbXB0eW5hbWUsXG4gICAgICAgICAgICBjb2RlaWQ6IHRydWUsXG4gICAgICAgICAgICB0eXBlOiBhbGVydGNvbmZpZy53YXJuaW5nLFxuICAgICAgICAgICAgcGFyZW50OiBsaW5lXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgY29uc3QgcmVzcCA9IGZhbHNlOyAvLyBubyBjb25maW1ib3gganVzdCB3YWl0IGZvciB1c2VyIGFjdGlvblxuICAgICAgICAgIC8vIGNhbGxiYWNrIHdoZW4gY29uZmlybWJveCByZXNwb25zZSBpcyBjaG9zZW4gaWYgJ2NvbmZpcm0nXG4gICAgICAgICAgaWYgKHJlc3AgPT09IHRydWUpIHtcbiAgICAgICAgICAgIGlmIChuID4gMSkge1xuICAgICAgICAgICAgICBsaW5lLnJlbW92ZSgpO1xuICAgICAgICAgICAgICBuLS07XG4gICAgICAgICAgICB9IGVsc2UgcmV0dXJuIGZhbHNlO1xuXG4gICAgICAgICAgfSBlbHNlIHJldHVybiBmYWxzZTtcbiAgICAgICAgfSBlbHNlIGlmICghaGFzUHJpdihsaW5lKSkge1xuICAgICAgICAgIHRoaXMuYWxlcnRCb3guZGlzbWlzc0FsZXJ0KGNvZGVtZXNzYWdlcy5lbXB0eW5hbWUpO1xuICAgICAgICAgIGF3YWl0IHRoaXMuYWxlcnRCb3guYnVpbGQoe1xuICAgICAgICAgICAgZGlzbWlzc2libGU6IHRydWUsXG4gICAgICAgICAgICBpbnNlcnRhZnRlcjogdHJ1ZSxcbiAgICAgICAgICAgIGNvZGVpZDogdHJ1ZSxcbiAgICAgICAgICAgIG1lc3NhZ2U6IGNvZGVtZXNzYWdlcy51aGFzbm9wcml2LFxuICAgICAgICAgICAgdHlwZTogYWxlcnRjb25maWcud2FybmluZyxcbiAgICAgICAgICAgIHBhcmVudDogbGluZVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHZlcmlmID0gZmFsc2U7XG4gICAgICAgIH0gZWxzZSB0aGlzLmFsZXJ0Qm94LmRpc21pc3NBbGVydChjb2RlbWVzc2FnZXMudWhhc25vcHJpdik7XG4gICAgICB9XG4gICAgICBpZiAoIXZlcmlmKSByZXR1cm4gdmVyaWY7XG4gICAgICBmb3IgKGNvbnN0IGxpbmUgb2YgbGluZXMpIHtcbiAgICAgICAgZm9ybWF0UHJpdmlsZWdlKGxpbmUpO1xuICAgICAgfVxuXG4gICAgICBpZiAobiA9PT0gMCkge1xuICAgICAgICBhd2FpdCB0aGlzLmFsZXJ0Qm94LmJ1aWxkKHtcbiAgICAgICAgICBkaXNtaXNzaWJsZTogdHJ1ZSxcbiAgICAgICAgICBjb2RlaWQ6IHRydWUsXG4gICAgICAgICAgbWVzc2FnZTogY29kZW1lc3NhZ2VzLm5vYm9keSxcbiAgICAgICAgICB0eXBlOiBhbGVydGNvbmZpZy53YXJuaW5nLFxuICAgICAgICAgIHBhcmVudDogdGhpcy5maWVsZHNldF9hbGVydF96b25lXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9IGVsc2UgdGhpcy5hbGVydEJveC5kaXNtaXNzQWxlcnQoY29kZW1lc3NhZ2VzLm5vYm9keSk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGVsc2UgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGdldExpbmVQcml2aWxlZ2UoaWQpIHtcbiAgICBsZXQgcHJpdmlsZWdlID0gbnVsbDtcbiAgICBjb25zdCBsaW5lcyA9IHRoaXMuZmllbGRzZXQucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtYmxvY2s9XCInICsgdGhpcy5vcHRpb25zLnRhcmdldCArICdcIl0nKVxuICAgIGZvciAoY29uc3QgbGluZSBvZiBsaW5lcykge1xuICAgICAgaWYgKHBhcnNlSW50KGxpbmUucXVlcnlTZWxlY3RvcignW25hbWUqPVwiWycgKyB0aGlzLm9wdGlvbnMuaWRlbnQgKyAnXVwiXScpLnZhbHVlKSA9PT0gcGFyc2VJbnQoaWQpKSB7XG4gICAgICAgIHByaXZpbGVnZSA9IGxpbmU7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBwcml2aWxlZ2U7XG4gIH1cbiAgY2xlYXJBbGwocmV0ID0gZmFsc2UsIHJlcGxhY2VpZCA9IG51bGwpIHtcbiAgICBsZXQgbGluZXMgPSB0aGlzLmZpZWxkc2V0LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLWJsb2NrPVwiJyArIHRoaXMub3B0aW9ucy50YXJnZXQgKyAnXCJdJyk7XG4gICAgbGV0IGtlZXBpbmRleCA9IC0xO1xuICAgIGxpbmVzLmZvckVhY2goKGxpbmUsIGluZGV4KSA9PiB7XG4gICAgICBjb25zdCB7XG4gICAgICAgIG1lbWJlcixcbiAgICAgICAgcHJpdnMsXG4gICAgICAgIGNvbnRhY3QsXG4gICAgICAgIGRlbGV0XG4gICAgICB9ID0gdGhpcy5nZXRJbnB1dHMobGluZSk7XG4gICAgICBpZiAodGhpcy5jdXJyZW50X3VpZCA9PT0gbWVtYmVyLnZhbHVlIHx8IHBhcnNlSW50KHJlcGxhY2VpZCkgPT09IHBhcnNlSW50KG1lbWJlci52YWx1ZSkpIGtlZXBpbmRleCA9IGluZGV4O1xuICAgICAgaWYgKGluZGV4ID4gMCB8fCAoa2VlcGluZGV4ID4gMCAmJiBrZWVwaW5kZXggIT09IGluZGV4KSkgbGluZS5yZW1vdmUoKTtcbiAgICB9KTtcbiAgICAvL1xuICAgIGNvbnN0IGxpbmUgPSB0aGlzLm5ld0xpbmUodHJ1ZSk7XG4gICAgLy8gaWYgKGtlZXBpbmRleCA+IDApIHtcbiAgICAvLyAgbGluZXNbMF0ucmVtb3ZlKCk7XG4gICAgLy99XG4gICAgaWYgKHJldCA9PT0gdHJ1ZSkgcmV0dXJuIGxpbmU7XG4gIH1cblxuICB0YWJFcnJvcihvbikge1xuICAgIGNvbnN0IHRhYiA9ICh0aGlzLmZpZWxkc2V0LmNsYXNzTGlzdC5jb250YWlucyhkb21zZWxlY3RvcnMuY29tcG9uZW50LnRhYnMudGFiLnN1YnN0cigxKSkpID8gdGhpcy5maWVsZHNldCA6ICgodGhpcy5maWVsZHNldC5wYXJlbnRFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucyhkb21zZWxlY3RvcnMuY29tcG9uZW50LnRhYnMudGFiLnN1YnN0cigxKSkpID8gdGhpcy5maWVsZHNldC5wYXJlbnRFbGVtZW50IDogbnVsbCk7XG4gICAgaWYgKHRhYiA9PT0gbnVsbCkgcmV0dXJuO1xuICAgIGlmIChvbiA9PT0gdHJ1ZSkgdGFiLmNsYXNzTGlzdC5hZGQoY3NzLmVycm9yKTtcbiAgICBlbHNlIHRhYi5jbGFzc0xpc3QucmVtb3ZlKGNzcy5lcnJvcik7XG4gIH1cbn0iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/modules/project-privileges.js\n")}}]);