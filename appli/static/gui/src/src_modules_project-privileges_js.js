/*! For license information please see src_modules_project-privileges_js.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["src_modules_project-privileges_js"],{"./src/modules/form-submit.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   FormSubmit: () => (/* binding */ FormSubmit)\n/* harmony export */ });\n/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! dompurify */ \"./node_modules/dompurify/dist/purify.js\");\n/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(dompurify__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../modules/modules-config.js */ \"./src/modules/modules-config.js\");\n/* harmony import */ var _modules_utils_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../modules/utils.js */ \"./src/modules/utils.js\");\n\n\nconst formcss = {\n  invalid: 'input-invalid',\n  inputvalidate: 'input-valid',\n}\n;\n\n_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.domselectors[\"captcha\"] = '.js-captcha';\n\nclass FormSubmit {\n  handlers = [];\n  form = null;\n  listener = null;\n  constructor(form, options = {}) {\n    if (!form) return;\n    if (!form.formsubmit) {\n      this.form = form instanceof HTMLElement ? form : document.querySelector(form);\n      const defaultOptions = {\n        fetch: null,\n      };\n      options = Object.assign(options, this.form.dataset);\n      this.options = Object.assign(defaultOptions, options);\n      if (!this.form) return;\n      this.tabs = this.form.querySelectorAll(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.domselectors.component.tabs.tab);\n      this.validateFields(true);\n      this.init();\n\n      form.formsubmit = this;\n    }\n    return form.formsubmit;\n  }\n  init() {\n    // init the form ( options like beforeunload etc...)\n\n    this.form.addEventListener('submit', async (e) => {\n      e.preventDefault();\n      const res = await this.submitForm();\n      return res;\n    });\n    this.specialFields();\n  }\n  specialFields() {\n    // check if there is a password confirm input\n    // add show text for password fields\n\n    this.form.querySelectorAll('input[data-match]').forEach(input => {\n      //\n      const match = input.dataset.match;\n      if (!match) return;\n      const target = document.getElementById(match);\n      if (!target) return;\n      const invalid = (input.dataset.matchinvalid) ? input.dataset.matchinvalid : \"no match\";\n      const check_match = (item, itemtarget) => {\n        const label = (input.previousElementSibling && input.previousElementSibling.tagName.toLowerCase() == 'label') ? input.previousElementSibling : null;\n        const labeltarget = (target.previousElementSibling && target.previousElementSibling.tagName.toLowerCase() == 'label') ? target.previousElementSibling : null;\n        const {\n          patternMismatch = false\n        } = item.validity;\n        const customvalidity = (patternMismatch) ?\n          this.get_message(item, 'invalid') : '';\n        if (item.checkValidity() === true) {\n          item.dataset.invalid = '';\n          item.setCustomValidity(\"\");\n          if (item == input && label !== null) label.classList.remove(formcss.invalid);\n          else if (labeltarget !== null) labeltarget.classList.remove(formcss.invalid);\n          item.classList.remove(formcss.inputvalidate);\n          if (item.value !== itemtarget.value) {\n            input.setCustomValidity(invalid);\n            if (label) {\n              label.dataset.invalid = (label.dataset.invalid) ? label.dataset.invalid : invalid;\n              label.classList.add(formcss.invalid);\n            }\n            input.classList.add(formcss.inputvalidate);\n          } else {\n            input.setCustomValidity(\"\");\n            if (label) label.classList.remove(formcss.invalid);\n            input.classList.remove(formcss.inputvalidate);\n          }\n        } else {\n          item.setCustomValidity(customvalidity);\n          item.dataset.invalid = customvalidity;\n          if (label) label.classList.add(formcss.invalid);\n          item.classList.add(formcss.inputvalidate);\n        }\n        item.focus();\n      };\n      [input, target].forEach(item => {\n        item.addEventListener('keyup', (e) => {\n          const itemtarget = (item === input) ? target : input;\n          check_match(item, itemtarget);\n        });\n      });\n\n    });\n  }\n  get_message(field, type = 'invalid') {\n    if (field.checkValidity() == false) {\n      const {\n        valueMissing = true\n      } = field.validity;\n      if (valueMissing) return (field.dataset.required) ? field.dataset.required : ((this.form.dataset.required) ? this.form.dataset.required : 'required');\n      else return (field.dataset[type]) ? field.dataset[type] : 'input invalid';\n    } else return '';\n  }\n\n  validateField(field, init = false) {\n\n\n\n    if (['textarea', 'input'].indexOf(field.tagName.toLowerCase()) >= 0) {\n\n    }\n\n    if (['select', 'input[type=\"checkbox\"]'].indexOf(field.tagName.toLowerCase()) >= 0) {\n      field.querySelectorAll('option:checked').forEach(option => {\n        option.value = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_2__.decode_HTMLEntities)(dompurify__WEBPACK_IMPORTED_MODULE_0___default().sanitize(option.value));\n      });\n\n    } else field.value = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_2__.decode_HTMLEntities)(dompurify__WEBPACK_IMPORTED_MODULE_0___default().sanitize(field.value));\n\n    const rep = field.checkValidity();\n\n    /*  if (field.classList.contains('select-one')) {\n\n    }*/\n    const label = field.closest('.form-box') ? field.closest('.form-box').querySelector('label') : null;\n\n    if (rep && label) {\n      label.classList.remove(formcss.invalid);\n    } else if (!rep) {\n      if (label) {\n        label.dataset.invalid = this.get_message(field);\n        label.classList.add(formcss.invalid);\n        window.scrollTo({\n          top: parseInt(label.offsetTop),\n          left: parseInt(label.offsetLeft),\n          behavior: 'smooth'\n        });\n      }\n    }\n    return rep;\n  }\n\n  validateFields(init = false) {\n    //todo: complete validation foreach field type\n    let resp = true;\n    // .required input for tom-select component\n\n    [...this.form.elements].forEach(field => {\n      if (field.name) {\n        if (init === true) {\n          if (!field.dataset.listen) {\n            if (field.hasAttribute('required') && field.required) {\n              const label = field.closest('.form-box') ? ((field.closest('.form-box').querySelector('label')) ? field.closest('.form-box').querySelector('label') : field.parentElement.querySelector('label')) : ((field.closest('.form-box').querySelector('.label')) ? field.closest('.form-box').querySelector('.label') : field.parentElement.querySelector('.label'));\n              if (label) label.classList.add('required');\n            }\n\n            ['change', 'blur'].forEach(evt => {\n              field.addEventListener(evt, (e) => {\n                this.validateField(e.currentTarget, init);\n              });\n            });\n            field.dataset.listen = true;\n          }\n        } else resp = (resp && this.validateField(field, init));\n\n      }\n    });\n    // add/remove error class on tabs tab-control elements\n\n    this.tabs.forEach(tab => {\n      if (tab.querySelectorAll(':invalid').length) tab.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.error);\n      else tab.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.error);\n    });\n    return resp;\n  }\n\n  addHandler(handler) {\n    this.handlers.push(handler);\n  }\n  fieldEnable(enable = true) {\n    this.form.querySelectorAll('input[data-sub=\"enable\"]').forEach(input => {\n      if (enable === true) {\n        input.removeAttribute(\"disabled\");\n      } else input.disabled = true;\n    });\n  }\n\n  async submitHandler() {\n    if (!this.validateFields()) return false;\n\n    if (this.handlers.length === 0) return true;\n    let resp = true;\n    // series\n    /*  for (const handler of this.handlers) {\n          const rep = await handler()\n          resp = (resp && rep)\n      }*/\n    // concurrent\n    await Promise.all(this.handlers.map(async handler => {\n      const rep = await handler();\n      resp = (resp && rep);\n    }));\n    if (resp === true) this.handlers = [];\n    return resp;\n  }\n  // no redirection when using data-fetch\n  formFetch(format = null) {\n    const formdata = new FormData(this.form);\n    formdata[\"fetch\"] = true;\n    fetch(this.form.action, (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_2__.fetchSettings)({\n        method: 'POST',\n        body: formdata,\n      }))\n      .then(response => {\n        switch (format) {\n          case \"text\":\n          case \"html\":\n            return response.text();\n            break;\n          default:\n            return response.json();\n        }\n      })\n      .then(response => {\n        this.displayResponse(response);\n      })\n      .catch(err => {\n        this.displayResponse(err, true)\n      }).finally(response => {\n        this.form.disabled = true;\n      });\n    return false;\n  }\n\n  async submitForm() {\n    this.fieldEnable();\n    if (this.validateFields(false)) {\n      const isbot = (this.form.querySelector(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.domselectors.captcha)) ? (this.form.dataset.isbot ? (this.form.dataset.isbot === true) : true) : false;\n      if (isbot === true) return false;\n      const yessubmit = await this.submitHandler();\n      if (yessubmit) {\n        if (this.options.fetch) this.formFetch(this.options.fetch);\n        else this.form.submit();\n        this.form.disabled = true;\n        return true;\n      } else return false;\n    } else return false;\n  }\n\n  displayResponse(response, error = false) {\n    const el = document.createElement('div');\n    el.insertAdjacentHTML('afterbegin', response);\n    if (error !== false) el.classList.add('is-error');\n    this.form.parentElement.insertBefore(el, this.form);\n    this.form.remove();\n  }\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvbW9kdWxlcy9mb3JtLXN1Ym1pdC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFrQztBQUNBO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FHc0M7QUFJVDtBQUM3QixvRUFBWTs7QUFFTDtBQUNQO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQztBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2Q0FBNkMsb0VBQVk7QUFDekQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsT0FBTzs7QUFFUCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0EsTUFBTTtBQUNOOztBQUVBOzs7O0FBSUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLHVCQUF1QixzRUFBbUIsQ0FBQyx5REFBa0I7QUFDN0QsT0FBTzs7QUFFUCxNQUFNLG1CQUFtQixzRUFBbUIsQ0FBQyx5REFBa0I7O0FBRS9EOztBQUVBOztBQUVBLEtBQUs7QUFDTDs7QUFFQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsZUFBZTtBQUNmLGFBQWE7QUFDYjtBQUNBO0FBQ0EsVUFBVTs7QUFFVjtBQUNBLEtBQUs7QUFDTDs7QUFFQTtBQUNBLHFFQUFxRSwyREFBRztBQUN4RSxnQ0FBZ0MsMkRBQUc7QUFDbkMsS0FBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1IsS0FBSztBQUNMOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLGdFQUFhO0FBQ3pDO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBLE9BQU87QUFDUDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLDZDQUE2QyxvRUFBWTtBQUN6RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUixNQUFNO0FBQ047O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9tb2R1bGVzL2Zvcm0tc3VibWl0LmpzP2M2YjciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHZhbGlkYXRvciBmcm9tICd2YWxpZGF0b3InO1xuaW1wb3J0IERPTVB1cmlmeSBmcm9tICdkb21wdXJpZnknO1xuY29uc3QgZm9ybWNzcyA9IHtcbiAgaW52YWxpZDogJ2lucHV0LWludmFsaWQnLFxuICBpbnB1dHZhbGlkYXRlOiAnaW5wdXQtdmFsaWQnLFxufVxuaW1wb3J0IHtcbiAgZG9tc2VsZWN0b3JzLFxuICBjc3Ncbn0gZnJvbSAnLi4vbW9kdWxlcy9tb2R1bGVzLWNvbmZpZy5qcyc7XG5pbXBvcnQge1xuICBmZXRjaFNldHRpbmdzLFxuICBkZWNvZGVfSFRNTEVudGl0aWVzXG59IGZyb20gJy4uL21vZHVsZXMvdXRpbHMuanMnO1xuZG9tc2VsZWN0b3JzW1wiY2FwdGNoYVwiXSA9ICcuanMtY2FwdGNoYSc7XG5cbmV4cG9ydCBjbGFzcyBGb3JtU3VibWl0IHtcbiAgaGFuZGxlcnMgPSBbXTtcbiAgZm9ybSA9IG51bGw7XG4gIGxpc3RlbmVyID0gbnVsbDtcbiAgY29uc3RydWN0b3IoZm9ybSwgb3B0aW9ucyA9IHt9KSB7XG4gICAgaWYgKCFmb3JtKSByZXR1cm47XG4gICAgaWYgKCFmb3JtLmZvcm1zdWJtaXQpIHtcbiAgICAgIHRoaXMuZm9ybSA9IGZvcm0gaW5zdGFuY2VvZiBIVE1MRWxlbWVudCA/IGZvcm0gOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGZvcm0pO1xuICAgICAgY29uc3QgZGVmYXVsdE9wdGlvbnMgPSB7XG4gICAgICAgIGZldGNoOiBudWxsLFxuICAgICAgfTtcbiAgICAgIG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKG9wdGlvbnMsIHRoaXMuZm9ybS5kYXRhc2V0KTtcbiAgICAgIHRoaXMub3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oZGVmYXVsdE9wdGlvbnMsIG9wdGlvbnMpO1xuICAgICAgaWYgKCF0aGlzLmZvcm0pIHJldHVybjtcbiAgICAgIHRoaXMudGFicyA9IHRoaXMuZm9ybS5xdWVyeVNlbGVjdG9yQWxsKGRvbXNlbGVjdG9ycy5jb21wb25lbnQudGFicy50YWIpO1xuICAgICAgdGhpcy52YWxpZGF0ZUZpZWxkcyh0cnVlKTtcbiAgICAgIHRoaXMuaW5pdCgpO1xuXG4gICAgICBmb3JtLmZvcm1zdWJtaXQgPSB0aGlzO1xuICAgIH1cbiAgICByZXR1cm4gZm9ybS5mb3Jtc3VibWl0O1xuICB9XG4gIGluaXQoKSB7XG4gICAgLy8gaW5pdCB0aGUgZm9ybSAoIG9wdGlvbnMgbGlrZSBiZWZvcmV1bmxvYWQgZXRjLi4uKVxuXG4gICAgdGhpcy5mb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIGFzeW5jIChlKSA9PiB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLnN1Ym1pdEZvcm0oKTtcbiAgICAgIHJldHVybiByZXM7XG4gICAgfSk7XG4gICAgdGhpcy5zcGVjaWFsRmllbGRzKCk7XG4gIH1cbiAgc3BlY2lhbEZpZWxkcygpIHtcbiAgICAvLyBjaGVjayBpZiB0aGVyZSBpcyBhIHBhc3N3b3JkIGNvbmZpcm0gaW5wdXRcbiAgICAvLyBhZGQgc2hvdyB0ZXh0IGZvciBwYXNzd29yZCBmaWVsZHNcblxuICAgIHRoaXMuZm9ybS5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dFtkYXRhLW1hdGNoXScpLmZvckVhY2goaW5wdXQgPT4ge1xuICAgICAgLy9cbiAgICAgIGNvbnN0IG1hdGNoID0gaW5wdXQuZGF0YXNldC5tYXRjaDtcbiAgICAgIGlmICghbWF0Y2gpIHJldHVybjtcbiAgICAgIGNvbnN0IHRhcmdldCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1hdGNoKTtcbiAgICAgIGlmICghdGFyZ2V0KSByZXR1cm47XG4gICAgICBjb25zdCBpbnZhbGlkID0gKGlucHV0LmRhdGFzZXQubWF0Y2hpbnZhbGlkKSA/IGlucHV0LmRhdGFzZXQubWF0Y2hpbnZhbGlkIDogXCJubyBtYXRjaFwiO1xuICAgICAgY29uc3QgY2hlY2tfbWF0Y2ggPSAoaXRlbSwgaXRlbXRhcmdldCkgPT4ge1xuICAgICAgICBjb25zdCBsYWJlbCA9IChpbnB1dC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nICYmIGlucHV0LnByZXZpb3VzRWxlbWVudFNpYmxpbmcudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09ICdsYWJlbCcpID8gaW5wdXQucHJldmlvdXNFbGVtZW50U2libGluZyA6IG51bGw7XG4gICAgICAgIGNvbnN0IGxhYmVsdGFyZ2V0ID0gKHRhcmdldC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nICYmIHRhcmdldC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nLnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PSAnbGFiZWwnKSA/IHRhcmdldC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nIDogbnVsbDtcbiAgICAgICAgY29uc3Qge1xuICAgICAgICAgIHBhdHRlcm5NaXNtYXRjaCA9IGZhbHNlXG4gICAgICAgIH0gPSBpdGVtLnZhbGlkaXR5O1xuICAgICAgICBjb25zdCBjdXN0b212YWxpZGl0eSA9IChwYXR0ZXJuTWlzbWF0Y2gpID9cbiAgICAgICAgICB0aGlzLmdldF9tZXNzYWdlKGl0ZW0sICdpbnZhbGlkJykgOiAnJztcbiAgICAgICAgaWYgKGl0ZW0uY2hlY2tWYWxpZGl0eSgpID09PSB0cnVlKSB7XG4gICAgICAgICAgaXRlbS5kYXRhc2V0LmludmFsaWQgPSAnJztcbiAgICAgICAgICBpdGVtLnNldEN1c3RvbVZhbGlkaXR5KFwiXCIpO1xuICAgICAgICAgIGlmIChpdGVtID09IGlucHV0ICYmIGxhYmVsICE9PSBudWxsKSBsYWJlbC5jbGFzc0xpc3QucmVtb3ZlKGZvcm1jc3MuaW52YWxpZCk7XG4gICAgICAgICAgZWxzZSBpZiAobGFiZWx0YXJnZXQgIT09IG51bGwpIGxhYmVsdGFyZ2V0LmNsYXNzTGlzdC5yZW1vdmUoZm9ybWNzcy5pbnZhbGlkKTtcbiAgICAgICAgICBpdGVtLmNsYXNzTGlzdC5yZW1vdmUoZm9ybWNzcy5pbnB1dHZhbGlkYXRlKTtcbiAgICAgICAgICBpZiAoaXRlbS52YWx1ZSAhPT0gaXRlbXRhcmdldC52YWx1ZSkge1xuICAgICAgICAgICAgaW5wdXQuc2V0Q3VzdG9tVmFsaWRpdHkoaW52YWxpZCk7XG4gICAgICAgICAgICBpZiAobGFiZWwpIHtcbiAgICAgICAgICAgICAgbGFiZWwuZGF0YXNldC5pbnZhbGlkID0gKGxhYmVsLmRhdGFzZXQuaW52YWxpZCkgPyBsYWJlbC5kYXRhc2V0LmludmFsaWQgOiBpbnZhbGlkO1xuICAgICAgICAgICAgICBsYWJlbC5jbGFzc0xpc3QuYWRkKGZvcm1jc3MuaW52YWxpZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpbnB1dC5jbGFzc0xpc3QuYWRkKGZvcm1jc3MuaW5wdXR2YWxpZGF0ZSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlucHV0LnNldEN1c3RvbVZhbGlkaXR5KFwiXCIpO1xuICAgICAgICAgICAgaWYgKGxhYmVsKSBsYWJlbC5jbGFzc0xpc3QucmVtb3ZlKGZvcm1jc3MuaW52YWxpZCk7XG4gICAgICAgICAgICBpbnB1dC5jbGFzc0xpc3QucmVtb3ZlKGZvcm1jc3MuaW5wdXR2YWxpZGF0ZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGl0ZW0uc2V0Q3VzdG9tVmFsaWRpdHkoY3VzdG9tdmFsaWRpdHkpO1xuICAgICAgICAgIGl0ZW0uZGF0YXNldC5pbnZhbGlkID0gY3VzdG9tdmFsaWRpdHk7XG4gICAgICAgICAgaWYgKGxhYmVsKSBsYWJlbC5jbGFzc0xpc3QuYWRkKGZvcm1jc3MuaW52YWxpZCk7XG4gICAgICAgICAgaXRlbS5jbGFzc0xpc3QuYWRkKGZvcm1jc3MuaW5wdXR2YWxpZGF0ZSk7XG4gICAgICAgIH1cbiAgICAgICAgaXRlbS5mb2N1cygpO1xuICAgICAgfTtcbiAgICAgIFtpbnB1dCwgdGFyZ2V0XS5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgKGUpID0+IHtcbiAgICAgICAgICBjb25zdCBpdGVtdGFyZ2V0ID0gKGl0ZW0gPT09IGlucHV0KSA/IHRhcmdldCA6IGlucHV0O1xuICAgICAgICAgIGNoZWNrX21hdGNoKGl0ZW0sIGl0ZW10YXJnZXQpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgfSk7XG4gIH1cbiAgZ2V0X21lc3NhZ2UoZmllbGQsIHR5cGUgPSAnaW52YWxpZCcpIHtcbiAgICBpZiAoZmllbGQuY2hlY2tWYWxpZGl0eSgpID09IGZhbHNlKSB7XG4gICAgICBjb25zdCB7XG4gICAgICAgIHZhbHVlTWlzc2luZyA9IHRydWVcbiAgICAgIH0gPSBmaWVsZC52YWxpZGl0eTtcbiAgICAgIGlmICh2YWx1ZU1pc3NpbmcpIHJldHVybiAoZmllbGQuZGF0YXNldC5yZXF1aXJlZCkgPyBmaWVsZC5kYXRhc2V0LnJlcXVpcmVkIDogKCh0aGlzLmZvcm0uZGF0YXNldC5yZXF1aXJlZCkgPyB0aGlzLmZvcm0uZGF0YXNldC5yZXF1aXJlZCA6ICdyZXF1aXJlZCcpO1xuICAgICAgZWxzZSByZXR1cm4gKGZpZWxkLmRhdGFzZXRbdHlwZV0pID8gZmllbGQuZGF0YXNldFt0eXBlXSA6ICdpbnB1dCBpbnZhbGlkJztcbiAgICB9IGVsc2UgcmV0dXJuICcnO1xuICB9XG5cbiAgdmFsaWRhdGVGaWVsZChmaWVsZCwgaW5pdCA9IGZhbHNlKSB7XG5cblxuXG4gICAgaWYgKFsndGV4dGFyZWEnLCAnaW5wdXQnXS5pbmRleE9mKGZpZWxkLnRhZ05hbWUudG9Mb3dlckNhc2UoKSkgPj0gMCkge1xuXG4gICAgfVxuXG4gICAgaWYgKFsnc2VsZWN0JywgJ2lucHV0W3R5cGU9XCJjaGVja2JveFwiXSddLmluZGV4T2YoZmllbGQudGFnTmFtZS50b0xvd2VyQ2FzZSgpKSA+PSAwKSB7XG4gICAgICBmaWVsZC5xdWVyeVNlbGVjdG9yQWxsKCdvcHRpb246Y2hlY2tlZCcpLmZvckVhY2gob3B0aW9uID0+IHtcbiAgICAgICAgb3B0aW9uLnZhbHVlID0gZGVjb2RlX0hUTUxFbnRpdGllcyhET01QdXJpZnkuc2FuaXRpemUob3B0aW9uLnZhbHVlKSk7XG4gICAgICB9KTtcblxuICAgIH0gZWxzZSBmaWVsZC52YWx1ZSA9IGRlY29kZV9IVE1MRW50aXRpZXMoRE9NUHVyaWZ5LnNhbml0aXplKGZpZWxkLnZhbHVlKSk7XG5cbiAgICBjb25zdCByZXAgPSBmaWVsZC5jaGVja1ZhbGlkaXR5KCk7XG5cbiAgICAvKiAgaWYgKGZpZWxkLmNsYXNzTGlzdC5jb250YWlucygnc2VsZWN0LW9uZScpKSB7XG5cbiAgICB9Ki9cbiAgICBjb25zdCBsYWJlbCA9IGZpZWxkLmNsb3Nlc3QoJy5mb3JtLWJveCcpID8gZmllbGQuY2xvc2VzdCgnLmZvcm0tYm94JykucXVlcnlTZWxlY3RvcignbGFiZWwnKSA6IG51bGw7XG5cbiAgICBpZiAocmVwICYmIGxhYmVsKSB7XG4gICAgICBsYWJlbC5jbGFzc0xpc3QucmVtb3ZlKGZvcm1jc3MuaW52YWxpZCk7XG4gICAgfSBlbHNlIGlmICghcmVwKSB7XG4gICAgICBpZiAobGFiZWwpIHtcbiAgICAgICAgbGFiZWwuZGF0YXNldC5pbnZhbGlkID0gdGhpcy5nZXRfbWVzc2FnZShmaWVsZCk7XG4gICAgICAgIGxhYmVsLmNsYXNzTGlzdC5hZGQoZm9ybWNzcy5pbnZhbGlkKTtcbiAgICAgICAgd2luZG93LnNjcm9sbFRvKHtcbiAgICAgICAgICB0b3A6IHBhcnNlSW50KGxhYmVsLm9mZnNldFRvcCksXG4gICAgICAgICAgbGVmdDogcGFyc2VJbnQobGFiZWwub2Zmc2V0TGVmdCksXG4gICAgICAgICAgYmVoYXZpb3I6ICdzbW9vdGgnXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVwO1xuICB9XG5cbiAgdmFsaWRhdGVGaWVsZHMoaW5pdCA9IGZhbHNlKSB7XG4gICAgLy90b2RvOiBjb21wbGV0ZSB2YWxpZGF0aW9uIGZvcmVhY2ggZmllbGQgdHlwZVxuICAgIGxldCByZXNwID0gdHJ1ZTtcbiAgICAvLyAucmVxdWlyZWQgaW5wdXQgZm9yIHRvbS1zZWxlY3QgY29tcG9uZW50XG5cbiAgICBbLi4udGhpcy5mb3JtLmVsZW1lbnRzXS5mb3JFYWNoKGZpZWxkID0+IHtcbiAgICAgIGlmIChmaWVsZC5uYW1lKSB7XG4gICAgICAgIGlmIChpbml0ID09PSB0cnVlKSB7XG4gICAgICAgICAgaWYgKCFmaWVsZC5kYXRhc2V0Lmxpc3Rlbikge1xuICAgICAgICAgICAgaWYgKGZpZWxkLmhhc0F0dHJpYnV0ZSgncmVxdWlyZWQnKSAmJiBmaWVsZC5yZXF1aXJlZCkge1xuICAgICAgICAgICAgICBjb25zdCBsYWJlbCA9IGZpZWxkLmNsb3Nlc3QoJy5mb3JtLWJveCcpID8gKChmaWVsZC5jbG9zZXN0KCcuZm9ybS1ib3gnKS5xdWVyeVNlbGVjdG9yKCdsYWJlbCcpKSA/IGZpZWxkLmNsb3Nlc3QoJy5mb3JtLWJveCcpLnF1ZXJ5U2VsZWN0b3IoJ2xhYmVsJykgOiBmaWVsZC5wYXJlbnRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ2xhYmVsJykpIDogKChmaWVsZC5jbG9zZXN0KCcuZm9ybS1ib3gnKS5xdWVyeVNlbGVjdG9yKCcubGFiZWwnKSkgPyBmaWVsZC5jbG9zZXN0KCcuZm9ybS1ib3gnKS5xdWVyeVNlbGVjdG9yKCcubGFiZWwnKSA6IGZpZWxkLnBhcmVudEVsZW1lbnQucXVlcnlTZWxlY3RvcignLmxhYmVsJykpO1xuICAgICAgICAgICAgICBpZiAobGFiZWwpIGxhYmVsLmNsYXNzTGlzdC5hZGQoJ3JlcXVpcmVkJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIFsnY2hhbmdlJywgJ2JsdXInXS5mb3JFYWNoKGV2dCA9PiB7XG4gICAgICAgICAgICAgIGZpZWxkLmFkZEV2ZW50TGlzdGVuZXIoZXZ0LCAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMudmFsaWRhdGVGaWVsZChlLmN1cnJlbnRUYXJnZXQsIGluaXQpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZmllbGQuZGF0YXNldC5saXN0ZW4gPSB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHJlc3AgPSAocmVzcCAmJiB0aGlzLnZhbGlkYXRlRmllbGQoZmllbGQsIGluaXQpKTtcblxuICAgICAgfVxuICAgIH0pO1xuICAgIC8vIGFkZC9yZW1vdmUgZXJyb3IgY2xhc3Mgb24gdGFicyB0YWItY29udHJvbCBlbGVtZW50c1xuXG4gICAgdGhpcy50YWJzLmZvckVhY2godGFiID0+IHtcbiAgICAgIGlmICh0YWIucXVlcnlTZWxlY3RvckFsbCgnOmludmFsaWQnKS5sZW5ndGgpIHRhYi5jbGFzc0xpc3QuYWRkKGNzcy5lcnJvcik7XG4gICAgICBlbHNlIHRhYi5jbGFzc0xpc3QucmVtb3ZlKGNzcy5lcnJvcik7XG4gICAgfSk7XG4gICAgcmV0dXJuIHJlc3A7XG4gIH1cblxuICBhZGRIYW5kbGVyKGhhbmRsZXIpIHtcbiAgICB0aGlzLmhhbmRsZXJzLnB1c2goaGFuZGxlcik7XG4gIH1cbiAgZmllbGRFbmFibGUoZW5hYmxlID0gdHJ1ZSkge1xuICAgIHRoaXMuZm9ybS5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dFtkYXRhLXN1Yj1cImVuYWJsZVwiXScpLmZvckVhY2goaW5wdXQgPT4ge1xuICAgICAgaWYgKGVuYWJsZSA9PT0gdHJ1ZSkge1xuICAgICAgICBpbnB1dC5yZW1vdmVBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiKTtcbiAgICAgIH0gZWxzZSBpbnB1dC5kaXNhYmxlZCA9IHRydWU7XG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBzdWJtaXRIYW5kbGVyKCkge1xuICAgIGlmICghdGhpcy52YWxpZGF0ZUZpZWxkcygpKSByZXR1cm4gZmFsc2U7XG5cbiAgICBpZiAodGhpcy5oYW5kbGVycy5sZW5ndGggPT09IDApIHJldHVybiB0cnVlO1xuICAgIGxldCByZXNwID0gdHJ1ZTtcbiAgICAvLyBzZXJpZXNcbiAgICAvKiAgZm9yIChjb25zdCBoYW5kbGVyIG9mIHRoaXMuaGFuZGxlcnMpIHtcbiAgICAgICAgICBjb25zdCByZXAgPSBhd2FpdCBoYW5kbGVyKClcbiAgICAgICAgICByZXNwID0gKHJlc3AgJiYgcmVwKVxuICAgICAgfSovXG4gICAgLy8gY29uY3VycmVudFxuICAgIGF3YWl0IFByb21pc2UuYWxsKHRoaXMuaGFuZGxlcnMubWFwKGFzeW5jIGhhbmRsZXIgPT4ge1xuICAgICAgY29uc3QgcmVwID0gYXdhaXQgaGFuZGxlcigpO1xuICAgICAgcmVzcCA9IChyZXNwICYmIHJlcCk7XG4gICAgfSkpO1xuICAgIGlmIChyZXNwID09PSB0cnVlKSB0aGlzLmhhbmRsZXJzID0gW107XG4gICAgcmV0dXJuIHJlc3A7XG4gIH1cbiAgLy8gbm8gcmVkaXJlY3Rpb24gd2hlbiB1c2luZyBkYXRhLWZldGNoXG4gIGZvcm1GZXRjaChmb3JtYXQgPSBudWxsKSB7XG4gICAgY29uc3QgZm9ybWRhdGEgPSBuZXcgRm9ybURhdGEodGhpcy5mb3JtKTtcbiAgICBmb3JtZGF0YVtcImZldGNoXCJdID0gdHJ1ZTtcbiAgICBmZXRjaCh0aGlzLmZvcm0uYWN0aW9uLCBmZXRjaFNldHRpbmdzKHtcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgIGJvZHk6IGZvcm1kYXRhLFxuICAgICAgfSkpXG4gICAgICAudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICAgIHN3aXRjaCAoZm9ybWF0KSB7XG4gICAgICAgICAgY2FzZSBcInRleHRcIjpcbiAgICAgICAgICBjYXNlIFwiaHRtbFwiOlxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnRleHQoKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgICB0aGlzLmRpc3BsYXlSZXNwb25zZShyZXNwb25zZSk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKGVyciA9PiB7XG4gICAgICAgIHRoaXMuZGlzcGxheVJlc3BvbnNlKGVyciwgdHJ1ZSlcbiAgICAgIH0pLmZpbmFsbHkocmVzcG9uc2UgPT4ge1xuICAgICAgICB0aGlzLmZvcm0uZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgfSk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgYXN5bmMgc3VibWl0Rm9ybSgpIHtcbiAgICB0aGlzLmZpZWxkRW5hYmxlKCk7XG4gICAgaWYgKHRoaXMudmFsaWRhdGVGaWVsZHMoZmFsc2UpKSB7XG4gICAgICBjb25zdCBpc2JvdCA9ICh0aGlzLmZvcm0ucXVlcnlTZWxlY3Rvcihkb21zZWxlY3RvcnMuY2FwdGNoYSkpID8gKHRoaXMuZm9ybS5kYXRhc2V0LmlzYm90ID8gKHRoaXMuZm9ybS5kYXRhc2V0LmlzYm90ID09PSB0cnVlKSA6IHRydWUpIDogZmFsc2U7XG4gICAgICBpZiAoaXNib3QgPT09IHRydWUpIHJldHVybiBmYWxzZTtcbiAgICAgIGNvbnN0IHllc3N1Ym1pdCA9IGF3YWl0IHRoaXMuc3VibWl0SGFuZGxlcigpO1xuICAgICAgaWYgKHllc3N1Ym1pdCkge1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmZldGNoKSB0aGlzLmZvcm1GZXRjaCh0aGlzLm9wdGlvbnMuZmV0Y2gpO1xuICAgICAgICBlbHNlIHRoaXMuZm9ybS5zdWJtaXQoKTtcbiAgICAgICAgdGhpcy5mb3JtLmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9IGVsc2UgcmV0dXJuIGZhbHNlO1xuICAgIH0gZWxzZSByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBkaXNwbGF5UmVzcG9uc2UocmVzcG9uc2UsIGVycm9yID0gZmFsc2UpIHtcbiAgICBjb25zdCBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGVsLmluc2VydEFkamFjZW50SFRNTCgnYWZ0ZXJiZWdpbicsIHJlc3BvbnNlKTtcbiAgICBpZiAoZXJyb3IgIT09IGZhbHNlKSBlbC5jbGFzc0xpc3QuYWRkKCdpcy1lcnJvcicpO1xuICAgIHRoaXMuZm9ybS5wYXJlbnRFbGVtZW50Lmluc2VydEJlZm9yZShlbCwgdGhpcy5mb3JtKTtcbiAgICB0aGlzLmZvcm0ucmVtb3ZlKCk7XG4gIH1cbn0iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/modules/form-submit.js\n")},"./src/modules/project-privileges.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ProjectPrivileges: () => (/* binding */ ProjectPrivileges)\n/* harmony export */ });\n/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! dompurify */ \"./node_modules/dompurify/dist/purify.js\");\n/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(dompurify__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _modules_form_submit_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../modules/form-submit.js */ \"./src/modules/form-submit.js\");\n/* harmony import */ var _modules_alert_boxes_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../modules/alert-boxes.js */ \"./src/modules/alert-boxes.js\");\n/* harmony import */ var _modules_js_tom_select_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../modules/js-tom-select.js */ \"./src/modules/js-tom-select.js\");\n/* harmony import */ var _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../modules/modules-config.js */ \"./src/modules/modules-config.js\");\n// privileges of a project\n// line with member name , priviliege , is contact , and delete functionality\n\n\n\n\n\n\nconst codemessages = {\n  oneatleast: 'oneatleast',\n  nomanager: 'nomanager',\n  nocontact: 'nocontact',\n  uhasnopriv: 'uhasnopriv',\n  importpriverror: 'importpriverror',\n  emptyname: 'emptyname'\n}\nlet instance = null;\nclass ProjectPrivileges {\n  //TODO: rewrite to not depend on DOM select\n  options;\n  alertBox;\n  // current user id;\n  current_uid;\n  fieldset;\n  fieldset_alert_zone;\n  // unique users\n  constructor(options = {}) {\n    if (!instance) {\n      const defaultOptions = {\n        groupid: \"#section-privileges\",\n        separ: '.new-privilege',\n        addbtn: '[data-add=\"block\"]',\n        target: 'member',\n        ident: 'member',\n        privilege: 'privilege',\n        delet: 'delet',\n        contact: 'contact',\n        contactfieldname: 'contact_user_id',\n        domselectors: {\n          tabcontent: '.tab-content'\n        }\n      };\n      this.options = Object.assign({}, defaultOptions, options);\n      this.fieldset = document.querySelector(this.options.groupid);\n      if (!this.fieldset) return;\n      this.fieldset_alert_zone = this.fieldset.querySelector(this.options.domselectors.tabcontent) ? this.fieldset.querySelector(this.options.domselectors.tabcontent) : this.fieldset;\n      this.options.separ = this.options.separ instanceof HTMLElement ? this.options.separ : (document.querySelector(this.options.separ) ? document.querySelector(this.options.separ) : null);\n      this.options.addbtn = this.options.addbtn instanceof HTMLElement ? this.options.addbtn : document.querySelector(this.options.addbtn);\n      if (this.options.addbtn) this.addListener();\n      const lines = this.fieldset.querySelectorAll('[data-block=\"' + this.options.target + '\"]');\n      this.current_uid = this.fieldset.dataset.u;\n      this.alertBox = new _modules_alert_boxes_js__WEBPACK_IMPORTED_MODULE_2__.AlertBox();\n      lines.forEach((line) => {\n        this.activateEvents(line);\n      });\n\n      //remove deleted , clean && validate datas , format names before sending the form\n      const form = this.fieldset.closest('form');\n      const formSubmit = new _modules_form_submit_js__WEBPACK_IMPORTED_MODULE_1__.FormSubmit(form);\n      // handler - verify privileges before settings form submit\n      const submit_privileges = async () => {\n        const resp = await this.cleanPrivileges();\n        return resp;\n      }\n      formSubmit.addHandler(submit_privileges);\n      instance = this;\n    }\n    return instance;\n  }\n\n  newLine(ret = false, check = 0) {\n    let line;\n    if (check > 0) {\n      line = this.getLinePrivilege(check);\n      if (line) return line;\n    }\n    const lines = this.fieldset.querySelectorAll('[data-block=\"' + this.options.target + '\"]');\n\n    if (lines.length === 0) return;\n    const n = lines.length - 1;\n    line = lines[n];\n    if (line !== null) {\n      line = this.clearLine(line.cloneNode(true), n, (this.options.separ ? this.options.separ : line));\n\n      this.activateEvents(line);\n\n    }\n    if (ret === true) return line;\n  }\n\n  addListener() {\n    this.options.target = (this.options.addbtn.dataset.target) ? this.options.addbtn.dataset.target : this.options.target;\n    this.options.addbtn.addEventListener('click', async (e) => {\n      e.preventDefault();\n      this.newLine();\n    })\n  }\n\n  clearLine(line, n, separ = null) {\n    /*clean line element */\n\n    let has_autocomplete = null;\n    line.dataset.mod = '';\n    line.disabled = false;\n    const elems = line.querySelectorAll('[data-elem]');\n    elems.forEach((elem) => {\n      // change loop index - necessary for tailwindcss peerchecked to work otherwise not if name ends with []\n      //remove components\n      const rms = elem.querySelectorAll('[data-component]')\n      rms.forEach((rm) => {\n        switch (rm.dataset.component) {\n          case 'tom-select':\n            rm.remove();\n            break;\n        }\n      })\n      // clean and reset events\n      const els = elem.querySelectorAll('input, select, label');\n      els.forEach((el) => {\n\n        el.disabled = false;\n        if (separ) { // change names and id when adding a new row - not if clear only\n          const keys = ['id', 'for', 'aria-controls', 'name'];\n          keys.forEach((key) => {\n            let val = el.getAttribute(key);\n            if (val !== null) {\n              if (key === 'name') val = val.replace('[' + n + ']', '[' + (n + 1) + ']');\n              else val = val.replace('_' + n, '_' + (n + 1));\n              el.setAttribute(key, val);\n            }\n          });\n        }\n        switch (el.tagName.toLowerCase()) {\n          case 'input':\n            //el.indeterminate = true;\n            el.checked = false;\n            // disable contact as privilege is empty\n            if (el.name == this.options.contactfieldname) {\n              el.value = \"0\";\n              el.disabled = true;\n            }\n            break;\n          case 'select':\n            el.selectedIndex = -1;\n            break;\n          case 'label':\n            el.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.peerchecked);\n            break;\n        }\n        if (el.tomselect) {\n          has_autocomplete = el;\n          el.tomselect.clear();\n          el.tomselect.destroy();\n\n        }\n        if (el.classList.contains(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.component.autocomplete.tomselected)) {\n          has_autocomplete = el;\n          el.classList.forEach(cl => {\n            if (cl.indexOf('ts-') == 0) el.classList.remove(cl);\n          })\n          el.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.component.autocomplete.tomselected);\n          if (el.type == \"select-one\") delete el.type;\n\n        }\n\n      })\n\n    })\n    /* add functionnalities */\n    if (separ) {\n      line.classList.add('new');\n      separ.after(line);\n    }\n    /* clear and add tom-select functionalities - only after adding line to the dom*/\n    if (has_autocomplete !== null) {\n      const jsTomSelect = new _modules_js_tom_select_js__WEBPACK_IMPORTED_MODULE_3__.JsTomSelect();\n      jsTomSelect.applyTo(has_autocomplete);\n      has_autocomplete.tomselect.clearOptions();\n      let options = this.fieldset.dataset.options;\n      options = (options) ? options : [];\n      has_autocomplete.tomselect.addOptions(options);\n    };\n\n\n    return line;\n  }\n\n  setLine(line, mb = {\n    key: '',\n    value: ''\n  }, priv, ct) {\n\n    priv = _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.defined_privileges[priv] ? _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.defined_privileges[priv] : _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.defined_privileges.viewers;\n    if (!priv) return;\n    const {\n      member,\n      privs,\n      contact,\n      delet\n    } = this.getInputs(line, priv);\n    if (!member || !privs || !contact || !delet) return;\n\n    // sanitize\n    mb.key = dompurify__WEBPACK_IMPORTED_MODULE_0___default().sanitize(mb.key);\n    mb.value = dompurify__WEBPACK_IMPORTED_MODULE_0___default().sanitize(mb.value);\n    const ts = member.tomselect;\n    if (ts) {\n      ts.clear();\n      const addmb = {}\n      addmb[ts.settings.valueField] = mb.key;\n      addmb[ts.settings.labelField] = addmb[ts.settings.searchField] = mb.value;\n      ts.addOption(addmb);\n      ts.setValue([mb.key]);\n    } else {\n      const selected = member.querySelector('select option[value=\"' + mb.key + '\"]');\n      if (selected) selected.selected = true;\n      else member.insertAdjacentHTML('beforeend', '<option value=\"' + mb.key + '\" selected>' + mb.value + '</option>');\n\n    }\n    privs.checked = true;\n    contact.value = mb.key;\n    if (priv === _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.rights.manage) {\n      contact.disabled = false;\n      if (ct === true) contact.checked = true;\n\n    } else {\n      contact.disabled = true;\n      contact.checked = false;\n    }\n\n  }\n  getInputs(line, priv = false) {\n    const member = line.querySelector(\"[name*='[\" + this.options.ident + \"]']\");\n    let privs;\n    if (priv) {\n      privs = line.querySelector('input[name*=\"[' + this.options.privilege + ']\"][value=\"' + priv + '\"]');\n    } else privs = line.querySelectorAll('input[name*=\"[' + this.options.privilege + ']\"]');\n    const contact = line.querySelector('input[name=\"' + this.options.contactfieldname + '\"]');\n    const delet = line.querySelector(\"input[name*='[\" + this.options.delet + \"]']\");\n\n    return {\n      member: member,\n      privs: privs,\n      contact: contact,\n      delet: delet\n    };\n  }\n  async importPrivileges(privileges, replace = false, contact = null, importedtag = null, dismiss = null) {\n    let lastline = !replace;\n\n    try {\n      Object.entries(privileges).forEach(([priv, members]) => {\n        members.forEach((member) => {\n          if (!lastline) lastline = this.clearAll(true, ((replace === true) ? member.id : null));\n          else lastline = this.newLine(true, member.id);\n          if (lastline) {\n            this.setLine(lastline, {\n              key: member.id,\n              value: member.name,\n            }, priv, (contact !== null && (parseInt(contact.id) === parseInt(member.id))));\n            if (importedtag) importedtag(lastline);\n\n          }\n\n        });\n\n      });\n      if (dismiss) dismiss();\n      this.alertBox.dismissAlert(codemessages.importpriverror);\n      return true;\n    } catch (err) {\n      await this.alertBox.build({\n        dismissible: true,\n        message: codemessages.importpriverror,\n        codeid: true,\n        parent: this.fieldset_alert_zone,\n        type: _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.alertconfig.danger,\n      });\n      console.log('err', err);\n      return false;\n    }\n  }\n  activateEvents(line) {\n    if (!line) return;\n    const {\n      member,\n      privs,\n      contact,\n      delet\n    } = this.getInputs(line);\n    if (!member || !privs || !contact || !delet) {\n      return;\n    }\n    const siblings = s => [...s.parentElement.children].filter(c => c.nodeType == 1 && c != s && c.classList.contains('row') && c.dataset.block !== null && c.dataset.block === this.options.target);\n\n    // enable/disable contact when privilege changes\n    const lineSettings = (pr, ct, dl, synchro = false) => {\n\n      if (pr && pr.value === _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.rights.manage) {\n        // manager - can't delete line - can choose as contact\n        dl.disabled = true;\n        ct.disabled = false;\n        // dismiss related alert\n        this.alertBox.dismissAlert(codemessages.nomanager);\n        if (ct.checked) {\n          this.alertBox.dismissAlert(codemessages.nocontact);\n        }\n      } else {\n        // not manager - can delet line - cannot chose as contact\n        //  if (ct.checked === true) ct.dispatchEvent(new Event('click'));\n        ct.checked = false;\n        dl.disabled = false;\n        ct.disabled = true;\n      }\n\n      if (synchro === true) {\n        synchroSiblings(line);\n      }\n      // dismiss alerts\n      if (!dl.ckecked) {\n        this.alertBox.dismissAlert(codemessages.nobody);\n        this.alertBox.dismissAlert(codemessages.oneatleast);\n      }\n    }\n    const synchroSiblings = (line) => {\n      const lns = siblings(line);\n      lns.forEach((ln) => {\n        const dl = ln.querySelector(\"input[name*='[\" + this.options.delet + \"]']\");\n        const ct = ln.querySelector('input[name=\"' + this.options.contactfieldname + '\"]');\n        const pr = ln.querySelector('input[name*=\"[' + this.options.privilege + ']\"]:checked');\n        lineSettings(pr, ct, dl, false);\n\n      })\n    }\n\n    member.addEventListener('change', (e) => {\n      contact.value = member.value;\n      // dismiss alert\n      if (member.value) {\n        this.alertBox.dismissAlert(codemessages.emptyname);\n        this.alertBox.dismissAlert(codemessages.oneatleast);\n        this.alertBox.dismissAlert(codemessages.nobody);\n      }\n    })\n\n    privs.forEach((priv) => {\n      priv.addEventListener('change', (e) => {\n        if (priv.checked) lineSettings(priv, contact, delet, false);\n      });\n\n      if (priv.checked) lineSettings(priv, contact, delet, false);\n    })\n\n    contact.addEventListener('change', (e) => {\n      if (e.target.checked) delet.disabled = true;\n      else delet.disabled = false;\n      const priv = line.querySelector('input[name*=\"[' + this.options.privilege + ']\"]:checked');\n      lineSettings(priv, contact, delet, true);\n      // enable otherwise\n\n    })\n\n    // delet ok for all when new line\n    //\n    delet.addEventListener('click', (e) => {\n      // at least one priv line\n      const deletlabel = delet.closest('label');\n      const lines = this.fieldset.querySelectorAll('[data-block=\"' + this.options.target + '\"]:not([data-mod=\"remove\"])');\n      if (lines.length <= 1 && e.target.checked) {\n        delet.disabled = true;\n        delet.checked = false;\n        this.alertBox.build({\n          dismissible: true,\n          message: codemessages.oneatleast,\n          codemessage: codemessages.oneatleast,\n          type: _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.alertconfig.warning,\n          parent: (e.currentTarget.id || null)\n        });\n        return;\n      } else if (e.target.checked) {\n        this.alertBox.dismissAlert(codemessages.oneatleast);\n        if (line.classList.contains('new')) {\n          line.remove();\n        } else {\n          if (deletlabel && deletlabel.dataset.restore) deletlabel.setAttribute('title', deletlabel.dataset.restore);\n          line.setAttribute('data-mod', 'remove');\n          privs.forEach(priv => {\n            priv.disabled = true;\n            priv.checked = false;\n          })\n          contact.checked = false;\n          contact.disabled = true;\n          member.disabled = true;\n        }\n      } else {\n        if (deletlabel && deletlabel.dataset.remove) deletlabel.setAttribute('title', deletlabel.dataset.remove);\n        line.removeAttribute('data-mod');\n        privs.forEach(priv => priv.disabled = false);\n        contact.disabled = false;\n        member.disabled = false;\n      }\n    });\n    // delet mouseover - explain why it is disabled when manage is checked\n    delet.addEventListener('mouseover', (e) => {\n      if (e.target.disabled) {\n        let pr = line.querySelector('input[name*=\"[' + this.options.privilege + ']\"]:checked');\n        if (!pr) return;\n        pr = pr.value.toLowerCase()\n        e.target.title = (e.target.dataset[pr]) ? e.target.dataset[pr] : e.target.title\n      }\n    })\n    // disable delet if user is the only manager\n    if (this.current_uid === member.value) delet.disabled = true;\n\n\n  }\n\n  // send clean data on submit\n  async cleanPrivileges() {\n    // check managers and contact_user_id on submit\n\n    const checkContact = async () => {\n      // check if one manager at least\n      const managers = this.fieldset.querySelectorAll('[name*=\"[' + this.options.privilege + ']\"][value=\"' + _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.rights.manage + '\"]:checked');\n      let n = managers.length;\n\n      if (n === 0) {\n        await this.alertBox.build({\n          dismissible: true,\n          message: codemessages.nomanager,\n          codeid: true,\n          type: _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.alertconfig.danger,\n          parent: this.fieldset_alert_zone,\n        });\n        return false;\n      } else this.alertBox.dismissAlert(codemessages.nomanager);\n      // check contact\n      const contact = this.fieldset.querySelector('[name=\"' + this.options.contactfieldname + '\"]:checked');\n\n      if (contact === null) {\n        await this.alertBox.build({\n          dismissible: true,\n          codeid: true,\n          message: codemessages.nocontact,\n          type: _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.alertconfig.danger,\n          parent: this.fieldset_alert_zone\n        });\n        return false;\n      }\n      this.alertBox.dismissAlert(codemessages.nocontact);\n      return true;\n    }\n    const hasMember = (line) => {\n      const member = line.querySelector('[name*=\"[' + this.options.ident + ']\"]');\n      return (member.value);\n    }\n    const hasPriv = (line) => {\n      const priv = line.querySelector('[name*=\"[' + this.options.privilege + ']\"]:checked');\n      if (priv && priv.value) return true;\n      return false;\n    }\n    const formatPrivilege = (line) => {\n\n      const els = line.querySelectorAll('[name*=\"members[\"');\n      els.forEach((el) => {\n        let name = el.name;\n        name = name.split('[');\n        name.pop();\n        el.name = name.join('[');\n        if (el.name.indexOf('[' + this.options.privilege + ']') > 0) {\n          el.type = 'checkbox';\n          el.classList.add('hidden');\n        }\n\n      })\n    }\n    const hascontact = await checkContact();\n    if (hascontact === true) {\n      const lines = this.fieldset.querySelectorAll('[data-block=\"' + this.options.target + '\"]');\n      let n = lines.length;\n      let verif = true;\n      for (const line of lines) {\n        if (line.dataset.mod && line.dataset.mod === 'remove') {\n          if (n > 1) {\n            line.remove();\n            n--;\n          } else return false;\n        } else if (!hasMember(line)) {\n          const lineno = line.querySelector('[name*=\"[' + this.options.ident + ']\"]');\n          lineno.focus();\n          if (lineno.tomselect) lineno.tomselect.focus();\n          await this.alertBox.build({\n            dismissible: true,\n            insertafter: true,\n            message: codemessages.emptyname,\n            codeid: true,\n            type: _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.alertconfig.warning,\n            parent: line\n          });\n          const resp = false; // no confimbox just wait for user action\n          // callback when confirmbox response is chosen if 'confirm'\n          if (resp === true) {\n            if (n > 1) {\n              line.remove();\n              n--;\n            } else return false;\n\n          } else return false;\n        } else if (!hasPriv(line)) {\n          this.alertBox.dismissAlert(codemessages.emptyname);\n          await this.alertBox.build({\n            dismissible: true,\n            insertafter: true,\n            codeid: true,\n            message: codemessages.uhasnopriv,\n            type: _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.alertconfig.warning,\n            parent: line\n          });\n          verif = false;\n        } else this.alertBox.dismissAlert(codemessages.uhasnopriv);\n      }\n      if (!verif) return verif;\n      for (const line of lines) {\n        formatPrivilege(line);\n      }\n\n      if (n === 0) {\n        await this.alertBox.build({\n          dismissible: true,\n          codeid: true,\n          message: codemessages.nobody,\n          type: _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.alertconfig.warning,\n          parent: this.fieldset_alert_zone\n        });\n        return false;\n      } else this.alertBox.dismissAlert(codemessages.nobody);\n      return true;\n    } else return false;\n  }\n  getLinePrivilege(id) {\n    let privilege = null;\n    const lines = this.fieldset.querySelectorAll('[data-block=\"' + this.options.target + '\"]')\n    for (const line of lines) {\n      if (parseInt(line.querySelector('[name*=\"[' + this.options.ident + ']\"]').value) === parseInt(id)) {\n        privilege = line;\n        break;\n      }\n    }\n\n    return privilege;\n  }\n  clearAll(ret = false, replaceid = null) {\n    let lines = this.fieldset.querySelectorAll('[data-block=\"' + this.options.target + '\"]');\n    let keepindex = -1;\n    lines.forEach((line, index) => {\n      const {\n        member,\n        privs,\n        contact,\n        delet\n      } = this.getInputs(line);\n      if (this.current_uid === member.value || parseInt(replaceid) === parseInt(member.value)) keepindex = index;\n      if (index > 0 || (keepindex > 0 && keepindex !== index)) line.remove();\n    });\n    //\n    const line = this.newLine(true);\n    // if (keepindex > 0) {\n    //  lines[0].remove();\n    //}\n    if (ret === true) return line;\n  }\n\n\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0E7QUFDQTs7QUFFQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVk7QUFDWixVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQixtRUFBVztBQUM3QjtBQUNBLFdBQVc7QUFDWCw4QkFBOEI7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWM7O0FBRWQsWUFBWTtBQUNaLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsbUVBQVc7QUFDN0I7QUFDQSxXQUFXO0FBQ1g7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLG1FQUFXO0FBQzNCO0FBQ0EsU0FBUztBQUNUO0FBQ0EsUUFBUTtBQUNSO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvbW9kdWxlcy9wcm9qZWN0LXByaXZpbGVnZXMuanM/ZGQyMyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBwcml2aWxlZ2VzIG9mIGEgcHJvamVjdFxuLy8gbGluZSB3aXRoIG1lbWJlciBuYW1lICwgcHJpdmlsaWVnZSAsIGlzIGNvbnRhY3QgLCBhbmQgZGVsZXRlIGZ1bmN0aW9uYWxpdHlcbmltcG9ydCBET01QdXJpZnkgZnJvbSAnZG9tcHVyaWZ5JztcbmltcG9ydCB7XG4gIEZvcm1TdWJtaXQsXG59IGZyb20gXCIuLi9tb2R1bGVzL2Zvcm0tc3VibWl0LmpzXCI7XG5pbXBvcnQge1xuICBBbGVydEJveFxufSBmcm9tIFwiLi4vbW9kdWxlcy9hbGVydC1ib3hlcy5qc1wiO1xuaW1wb3J0IHtcbiAgSnNUb21TZWxlY3Rcbn0gZnJvbSBcIi4uL21vZHVsZXMvanMtdG9tLXNlbGVjdC5qc1wiO1xuXG5pbXBvcnQge1xuICByaWdodHMsXG4gIGRlZmluZWRfcHJpdmlsZWdlcyxcbiAgYWxlcnRjb25maWcsXG4gIGNzc1xufSBmcm9tICcuLi9tb2R1bGVzL21vZHVsZXMtY29uZmlnLmpzJztcbmNvbnN0IGNvZGVtZXNzYWdlcyA9IHtcbiAgb25lYXRsZWFzdDogJ29uZWF0bGVhc3QnLFxuICBub21hbmFnZXI6ICdub21hbmFnZXInLFxuICBub2NvbnRhY3Q6ICdub2NvbnRhY3QnLFxuICB1aGFzbm9wcml2OiAndWhhc25vcHJpdicsXG4gIGltcG9ydHByaXZlcnJvcjogJ2ltcG9ydHByaXZlcnJvcicsXG4gIGVtcHR5bmFtZTogJ2VtcHR5bmFtZSdcbn1cbmxldCBpbnN0YW5jZSA9IG51bGw7XG5leHBvcnQgY2xhc3MgUHJvamVjdFByaXZpbGVnZXMge1xuICAvL1RPRE86IHJld3JpdGUgdG8gbm90IGRlcGVuZCBvbiBET00gc2VsZWN0XG4gIG9wdGlvbnM7XG4gIGFsZXJ0Qm94O1xuICAvLyBjdXJyZW50IHVzZXIgaWQ7XG4gIGN1cnJlbnRfdWlkO1xuICBmaWVsZHNldDtcbiAgZmllbGRzZXRfYWxlcnRfem9uZTtcbiAgLy8gdW5pcXVlIHVzZXJzXG4gIGNvbnN0cnVjdG9yKG9wdGlvbnMgPSB7fSkge1xuICAgIGlmICghaW5zdGFuY2UpIHtcbiAgICAgIGNvbnN0IGRlZmF1bHRPcHRpb25zID0ge1xuICAgICAgICBncm91cGlkOiBcIiNzZWN0aW9uLXByaXZpbGVnZXNcIixcbiAgICAgICAgc2VwYXI6ICcubmV3LXByaXZpbGVnZScsXG4gICAgICAgIGFkZGJ0bjogJ1tkYXRhLWFkZD1cImJsb2NrXCJdJyxcbiAgICAgICAgdGFyZ2V0OiAnbWVtYmVyJyxcbiAgICAgICAgaWRlbnQ6ICdtZW1iZXInLFxuICAgICAgICBwcml2aWxlZ2U6ICdwcml2aWxlZ2UnLFxuICAgICAgICBkZWxldDogJ2RlbGV0JyxcbiAgICAgICAgY29udGFjdDogJ2NvbnRhY3QnLFxuICAgICAgICBjb250YWN0ZmllbGRuYW1lOiAnY29udGFjdF91c2VyX2lkJyxcbiAgICAgICAgZG9tc2VsZWN0b3JzOiB7XG4gICAgICAgICAgdGFiY29udGVudDogJy50YWItY29udGVudCdcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHRoaXMub3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe30sIGRlZmF1bHRPcHRpb25zLCBvcHRpb25zKTtcbiAgICAgIHRoaXMuZmllbGRzZXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHRoaXMub3B0aW9ucy5ncm91cGlkKTtcbiAgICAgIGlmICghdGhpcy5maWVsZHNldCkgcmV0dXJuO1xuICAgICAgdGhpcy5maWVsZHNldF9hbGVydF96b25lID0gdGhpcy5maWVsZHNldC5xdWVyeVNlbGVjdG9yKHRoaXMub3B0aW9ucy5kb21zZWxlY3RvcnMudGFiY29udGVudCkgPyB0aGlzLmZpZWxkc2V0LnF1ZXJ5U2VsZWN0b3IodGhpcy5vcHRpb25zLmRvbXNlbGVjdG9ycy50YWJjb250ZW50KSA6IHRoaXMuZmllbGRzZXQ7XG4gICAgICB0aGlzLm9wdGlvbnMuc2VwYXIgPSB0aGlzLm9wdGlvbnMuc2VwYXIgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCA/IHRoaXMub3B0aW9ucy5zZXBhciA6IChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHRoaXMub3B0aW9ucy5zZXBhcikgPyBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHRoaXMub3B0aW9ucy5zZXBhcikgOiBudWxsKTtcbiAgICAgIHRoaXMub3B0aW9ucy5hZGRidG4gPSB0aGlzLm9wdGlvbnMuYWRkYnRuIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQgPyB0aGlzLm9wdGlvbnMuYWRkYnRuIDogZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih0aGlzLm9wdGlvbnMuYWRkYnRuKTtcbiAgICAgIGlmICh0aGlzLm9wdGlvbnMuYWRkYnRuKSB0aGlzLmFkZExpc3RlbmVyKCk7XG4gICAgICBjb25zdCBsaW5lcyA9IHRoaXMuZmllbGRzZXQucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtYmxvY2s9XCInICsgdGhpcy5vcHRpb25zLnRhcmdldCArICdcIl0nKTtcbiAgICAgIHRoaXMuY3VycmVudF91aWQgPSB0aGlzLmZpZWxkc2V0LmRhdGFzZXQudTtcbiAgICAgIHRoaXMuYWxlcnRCb3ggPSBuZXcgQWxlcnRCb3goKTtcbiAgICAgIGxpbmVzLmZvckVhY2goKGxpbmUpID0+IHtcbiAgICAgICAgdGhpcy5hY3RpdmF0ZUV2ZW50cyhsaW5lKTtcbiAgICAgIH0pO1xuXG4gICAgICAvL3JlbW92ZSBkZWxldGVkICwgY2xlYW4gJiYgdmFsaWRhdGUgZGF0YXMgLCBmb3JtYXQgbmFtZXMgYmVmb3JlIHNlbmRpbmcgdGhlIGZvcm1cbiAgICAgIGNvbnN0IGZvcm0gPSB0aGlzLmZpZWxkc2V0LmNsb3Nlc3QoJ2Zvcm0nKTtcbiAgICAgIGNvbnN0IGZvcm1TdWJtaXQgPSBuZXcgRm9ybVN1Ym1pdChmb3JtKTtcbiAgICAgIC8vIGhhbmRsZXIgLSB2ZXJpZnkgcHJpdmlsZWdlcyBiZWZvcmUgc2V0dGluZ3MgZm9ybSBzdWJtaXRcbiAgICAgIGNvbnN0IHN1Ym1pdF9wcml2aWxlZ2VzID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCByZXNwID0gYXdhaXQgdGhpcy5jbGVhblByaXZpbGVnZXMoKTtcbiAgICAgICAgcmV0dXJuIHJlc3A7XG4gICAgICB9XG4gICAgICBmb3JtU3VibWl0LmFkZEhhbmRsZXIoc3VibWl0X3ByaXZpbGVnZXMpO1xuICAgICAgaW5zdGFuY2UgPSB0aGlzO1xuICAgIH1cbiAgICByZXR1cm4gaW5zdGFuY2U7XG4gIH1cblxuICBuZXdMaW5lKHJldCA9IGZhbHNlLCBjaGVjayA9IDApIHtcbiAgICBsZXQgbGluZTtcbiAgICBpZiAoY2hlY2sgPiAwKSB7XG4gICAgICBsaW5lID0gdGhpcy5nZXRMaW5lUHJpdmlsZWdlKGNoZWNrKTtcbiAgICAgIGlmIChsaW5lKSByZXR1cm4gbGluZTtcbiAgICB9XG4gICAgY29uc3QgbGluZXMgPSB0aGlzLmZpZWxkc2V0LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLWJsb2NrPVwiJyArIHRoaXMub3B0aW9ucy50YXJnZXQgKyAnXCJdJyk7XG5cbiAgICBpZiAobGluZXMubGVuZ3RoID09PSAwKSByZXR1cm47XG4gICAgY29uc3QgbiA9IGxpbmVzLmxlbmd0aCAtIDE7XG4gICAgbGluZSA9IGxpbmVzW25dO1xuICAgIGlmIChsaW5lICE9PSBudWxsKSB7XG4gICAgICBsaW5lID0gdGhpcy5jbGVhckxpbmUobGluZS5jbG9uZU5vZGUodHJ1ZSksIG4sICh0aGlzLm9wdGlvbnMuc2VwYXIgPyB0aGlzLm9wdGlvbnMuc2VwYXIgOiBsaW5lKSk7XG5cbiAgICAgIHRoaXMuYWN0aXZhdGVFdmVudHMobGluZSk7XG5cbiAgICB9XG4gICAgaWYgKHJldCA9PT0gdHJ1ZSkgcmV0dXJuIGxpbmU7XG4gIH1cblxuICBhZGRMaXN0ZW5lcigpIHtcbiAgICB0aGlzLm9wdGlvbnMudGFyZ2V0ID0gKHRoaXMub3B0aW9ucy5hZGRidG4uZGF0YXNldC50YXJnZXQpID8gdGhpcy5vcHRpb25zLmFkZGJ0bi5kYXRhc2V0LnRhcmdldCA6IHRoaXMub3B0aW9ucy50YXJnZXQ7XG4gICAgdGhpcy5vcHRpb25zLmFkZGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jIChlKSA9PiB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB0aGlzLm5ld0xpbmUoKTtcbiAgICB9KVxuICB9XG5cbiAgY2xlYXJMaW5lKGxpbmUsIG4sIHNlcGFyID0gbnVsbCkge1xuICAgIC8qY2xlYW4gbGluZSBlbGVtZW50ICovXG5cbiAgICBsZXQgaGFzX2F1dG9jb21wbGV0ZSA9IG51bGw7XG4gICAgbGluZS5kYXRhc2V0Lm1vZCA9ICcnO1xuICAgIGxpbmUuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICBjb25zdCBlbGVtcyA9IGxpbmUucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtZWxlbV0nKTtcbiAgICBlbGVtcy5mb3JFYWNoKChlbGVtKSA9PiB7XG4gICAgICAvLyBjaGFuZ2UgbG9vcCBpbmRleCAtIG5lY2Vzc2FyeSBmb3IgdGFpbHdpbmRjc3MgcGVlcmNoZWNrZWQgdG8gd29yayBvdGhlcndpc2Ugbm90IGlmIG5hbWUgZW5kcyB3aXRoIFtdXG4gICAgICAvL3JlbW92ZSBjb21wb25lbnRzXG4gICAgICBjb25zdCBybXMgPSBlbGVtLnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLWNvbXBvbmVudF0nKVxuICAgICAgcm1zLmZvckVhY2goKHJtKSA9PiB7XG4gICAgICAgIHN3aXRjaCAocm0uZGF0YXNldC5jb21wb25lbnQpIHtcbiAgICAgICAgICBjYXNlICd0b20tc2VsZWN0JzpcbiAgICAgICAgICAgIHJtLnJlbW92ZSgpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICAvLyBjbGVhbiBhbmQgcmVzZXQgZXZlbnRzXG4gICAgICBjb25zdCBlbHMgPSBlbGVtLnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0LCBzZWxlY3QsIGxhYmVsJyk7XG4gICAgICBlbHMuZm9yRWFjaCgoZWwpID0+IHtcblxuICAgICAgICBlbC5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgICBpZiAoc2VwYXIpIHsgLy8gY2hhbmdlIG5hbWVzIGFuZCBpZCB3aGVuIGFkZGluZyBhIG5ldyByb3cgLSBub3QgaWYgY2xlYXIgb25seVxuICAgICAgICAgIGNvbnN0IGtleXMgPSBbJ2lkJywgJ2ZvcicsICdhcmlhLWNvbnRyb2xzJywgJ25hbWUnXTtcbiAgICAgICAgICBrZXlzLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgICAgICAgbGV0IHZhbCA9IGVsLmdldEF0dHJpYnV0ZShrZXkpO1xuICAgICAgICAgICAgaWYgKHZhbCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICBpZiAoa2V5ID09PSAnbmFtZScpIHZhbCA9IHZhbC5yZXBsYWNlKCdbJyArIG4gKyAnXScsICdbJyArIChuICsgMSkgKyAnXScpO1xuICAgICAgICAgICAgICBlbHNlIHZhbCA9IHZhbC5yZXBsYWNlKCdfJyArIG4sICdfJyArIChuICsgMSkpO1xuICAgICAgICAgICAgICBlbC5zZXRBdHRyaWJ1dGUoa2V5LCB2YWwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHN3aXRjaCAoZWwudGFnTmFtZS50b0xvd2VyQ2FzZSgpKSB7XG4gICAgICAgICAgY2FzZSAnaW5wdXQnOlxuICAgICAgICAgICAgLy9lbC5pbmRldGVybWluYXRlID0gdHJ1ZTtcbiAgICAgICAgICAgIGVsLmNoZWNrZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIC8vIGRpc2FibGUgY29udGFjdCBhcyBwcml2aWxlZ2UgaXMgZW1wdHlcbiAgICAgICAgICAgIGlmIChlbC5uYW1lID09IHRoaXMub3B0aW9ucy5jb250YWN0ZmllbGRuYW1lKSB7XG4gICAgICAgICAgICAgIGVsLnZhbHVlID0gXCIwXCI7XG4gICAgICAgICAgICAgIGVsLmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgJ3NlbGVjdCc6XG4gICAgICAgICAgICBlbC5zZWxlY3RlZEluZGV4ID0gLTE7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlICdsYWJlbCc6XG4gICAgICAgICAgICBlbC5jbGFzc0xpc3QucmVtb3ZlKGNzcy5wZWVyY2hlY2tlZCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBpZiAoZWwudG9tc2VsZWN0KSB7XG4gICAgICAgICAgaGFzX2F1dG9jb21wbGV0ZSA9IGVsO1xuICAgICAgICAgIGVsLnRvbXNlbGVjdC5jbGVhcigpO1xuICAgICAgICAgIGVsLnRvbXNlbGVjdC5kZXN0cm95KCk7XG5cbiAgICAgICAgfVxuICAgICAgICBpZiAoZWwuY2xhc3NMaXN0LmNvbnRhaW5zKGNzcy5jb21wb25lbnQuYXV0b2NvbXBsZXRlLnRvbXNlbGVjdGVkKSkge1xuICAgICAgICAgIGhhc19hdXRvY29tcGxldGUgPSBlbDtcbiAgICAgICAgICBlbC5jbGFzc0xpc3QuZm9yRWFjaChjbCA9PiB7XG4gICAgICAgICAgICBpZiAoY2wuaW5kZXhPZigndHMtJykgPT0gMCkgZWwuY2xhc3NMaXN0LnJlbW92ZShjbCk7XG4gICAgICAgICAgfSlcbiAgICAgICAgICBlbC5jbGFzc0xpc3QucmVtb3ZlKGNzcy5jb21wb25lbnQuYXV0b2NvbXBsZXRlLnRvbXNlbGVjdGVkKTtcbiAgICAgICAgICBpZiAoZWwudHlwZSA9PSBcInNlbGVjdC1vbmVcIikgZGVsZXRlIGVsLnR5cGU7XG5cbiAgICAgICAgfVxuXG4gICAgICB9KVxuXG4gICAgfSlcbiAgICAvKiBhZGQgZnVuY3Rpb25uYWxpdGllcyAqL1xuICAgIGlmIChzZXBhcikge1xuICAgICAgbGluZS5jbGFzc0xpc3QuYWRkKCduZXcnKTtcbiAgICAgIHNlcGFyLmFmdGVyKGxpbmUpO1xuICAgIH1cbiAgICAvKiBjbGVhciBhbmQgYWRkIHRvbS1zZWxlY3QgZnVuY3Rpb25hbGl0aWVzIC0gb25seSBhZnRlciBhZGRpbmcgbGluZSB0byB0aGUgZG9tKi9cbiAgICBpZiAoaGFzX2F1dG9jb21wbGV0ZSAhPT0gbnVsbCkge1xuICAgICAgY29uc3QganNUb21TZWxlY3QgPSBuZXcgSnNUb21TZWxlY3QoKTtcbiAgICAgIGpzVG9tU2VsZWN0LmFwcGx5VG8oaGFzX2F1dG9jb21wbGV0ZSk7XG4gICAgICBoYXNfYXV0b2NvbXBsZXRlLnRvbXNlbGVjdC5jbGVhck9wdGlvbnMoKTtcbiAgICAgIGxldCBvcHRpb25zID0gdGhpcy5maWVsZHNldC5kYXRhc2V0Lm9wdGlvbnM7XG4gICAgICBvcHRpb25zID0gKG9wdGlvbnMpID8gb3B0aW9ucyA6IFtdO1xuICAgICAgaGFzX2F1dG9jb21wbGV0ZS50b21zZWxlY3QuYWRkT3B0aW9ucyhvcHRpb25zKTtcbiAgICB9O1xuXG5cbiAgICByZXR1cm4gbGluZTtcbiAgfVxuXG4gIHNldExpbmUobGluZSwgbWIgPSB7XG4gICAga2V5OiAnJyxcbiAgICB2YWx1ZTogJydcbiAgfSwgcHJpdiwgY3QpIHtcblxuICAgIHByaXYgPSBkZWZpbmVkX3ByaXZpbGVnZXNbcHJpdl0gPyBkZWZpbmVkX3ByaXZpbGVnZXNbcHJpdl0gOiBkZWZpbmVkX3ByaXZpbGVnZXMudmlld2VycztcbiAgICBpZiAoIXByaXYpIHJldHVybjtcbiAgICBjb25zdCB7XG4gICAgICBtZW1iZXIsXG4gICAgICBwcml2cyxcbiAgICAgIGNvbnRhY3QsXG4gICAgICBkZWxldFxuICAgIH0gPSB0aGlzLmdldElucHV0cyhsaW5lLCBwcml2KTtcbiAgICBpZiAoIW1lbWJlciB8fCAhcHJpdnMgfHwgIWNvbnRhY3QgfHwgIWRlbGV0KSByZXR1cm47XG5cbiAgICAvLyBzYW5pdGl6ZVxuICAgIG1iLmtleSA9IERPTVB1cmlmeS5zYW5pdGl6ZShtYi5rZXkpO1xuICAgIG1iLnZhbHVlID0gRE9NUHVyaWZ5LnNhbml0aXplKG1iLnZhbHVlKTtcbiAgICBjb25zdCB0cyA9IG1lbWJlci50b21zZWxlY3Q7XG4gICAgaWYgKHRzKSB7XG4gICAgICB0cy5jbGVhcigpO1xuICAgICAgY29uc3QgYWRkbWIgPSB7fVxuICAgICAgYWRkbWJbdHMuc2V0dGluZ3MudmFsdWVGaWVsZF0gPSBtYi5rZXk7XG4gICAgICBhZGRtYlt0cy5zZXR0aW5ncy5sYWJlbEZpZWxkXSA9IGFkZG1iW3RzLnNldHRpbmdzLnNlYXJjaEZpZWxkXSA9IG1iLnZhbHVlO1xuICAgICAgdHMuYWRkT3B0aW9uKGFkZG1iKTtcbiAgICAgIHRzLnNldFZhbHVlKFttYi5rZXldKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3Qgc2VsZWN0ZWQgPSBtZW1iZXIucXVlcnlTZWxlY3Rvcignc2VsZWN0IG9wdGlvblt2YWx1ZT1cIicgKyBtYi5rZXkgKyAnXCJdJyk7XG4gICAgICBpZiAoc2VsZWN0ZWQpIHNlbGVjdGVkLnNlbGVjdGVkID0gdHJ1ZTtcbiAgICAgIGVsc2UgbWVtYmVyLmluc2VydEFkamFjZW50SFRNTCgnYmVmb3JlZW5kJywgJzxvcHRpb24gdmFsdWU9XCInICsgbWIua2V5ICsgJ1wiIHNlbGVjdGVkPicgKyBtYi52YWx1ZSArICc8L29wdGlvbj4nKTtcblxuICAgIH1cbiAgICBwcml2cy5jaGVja2VkID0gdHJ1ZTtcbiAgICBjb250YWN0LnZhbHVlID0gbWIua2V5O1xuICAgIGlmIChwcml2ID09PSByaWdodHMubWFuYWdlKSB7XG4gICAgICBjb250YWN0LmRpc2FibGVkID0gZmFsc2U7XG4gICAgICBpZiAoY3QgPT09IHRydWUpIGNvbnRhY3QuY2hlY2tlZCA9IHRydWU7XG5cbiAgICB9IGVsc2Uge1xuICAgICAgY29udGFjdC5kaXNhYmxlZCA9IHRydWU7XG4gICAgICBjb250YWN0LmNoZWNrZWQgPSBmYWxzZTtcbiAgICB9XG5cbiAgfVxuICBnZXRJbnB1dHMobGluZSwgcHJpdiA9IGZhbHNlKSB7XG4gICAgY29uc3QgbWVtYmVyID0gbGluZS5xdWVyeVNlbGVjdG9yKFwiW25hbWUqPSdbXCIgKyB0aGlzLm9wdGlvbnMuaWRlbnQgKyBcIl0nXVwiKTtcbiAgICBsZXQgcHJpdnM7XG4gICAgaWYgKHByaXYpIHtcbiAgICAgIHByaXZzID0gbGluZS5xdWVyeVNlbGVjdG9yKCdpbnB1dFtuYW1lKj1cIlsnICsgdGhpcy5vcHRpb25zLnByaXZpbGVnZSArICddXCJdW3ZhbHVlPVwiJyArIHByaXYgKyAnXCJdJyk7XG4gICAgfSBlbHNlIHByaXZzID0gbGluZS5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dFtuYW1lKj1cIlsnICsgdGhpcy5vcHRpb25zLnByaXZpbGVnZSArICddXCJdJyk7XG4gICAgY29uc3QgY29udGFjdCA9IGxpbmUucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZT1cIicgKyB0aGlzLm9wdGlvbnMuY29udGFjdGZpZWxkbmFtZSArICdcIl0nKTtcbiAgICBjb25zdCBkZWxldCA9IGxpbmUucXVlcnlTZWxlY3RvcihcImlucHV0W25hbWUqPSdbXCIgKyB0aGlzLm9wdGlvbnMuZGVsZXQgKyBcIl0nXVwiKTtcblxuICAgIHJldHVybiB7XG4gICAgICBtZW1iZXI6IG1lbWJlcixcbiAgICAgIHByaXZzOiBwcml2cyxcbiAgICAgIGNvbnRhY3Q6IGNvbnRhY3QsXG4gICAgICBkZWxldDogZGVsZXRcbiAgICB9O1xuICB9XG4gIGFzeW5jIGltcG9ydFByaXZpbGVnZXMocHJpdmlsZWdlcywgcmVwbGFjZSA9IGZhbHNlLCBjb250YWN0ID0gbnVsbCwgaW1wb3J0ZWR0YWcgPSBudWxsLCBkaXNtaXNzID0gbnVsbCkge1xuICAgIGxldCBsYXN0bGluZSA9ICFyZXBsYWNlO1xuXG4gICAgdHJ5IHtcbiAgICAgIE9iamVjdC5lbnRyaWVzKHByaXZpbGVnZXMpLmZvckVhY2goKFtwcml2LCBtZW1iZXJzXSkgPT4ge1xuICAgICAgICBtZW1iZXJzLmZvckVhY2goKG1lbWJlcikgPT4ge1xuICAgICAgICAgIGlmICghbGFzdGxpbmUpIGxhc3RsaW5lID0gdGhpcy5jbGVhckFsbCh0cnVlLCAoKHJlcGxhY2UgPT09IHRydWUpID8gbWVtYmVyLmlkIDogbnVsbCkpO1xuICAgICAgICAgIGVsc2UgbGFzdGxpbmUgPSB0aGlzLm5ld0xpbmUodHJ1ZSwgbWVtYmVyLmlkKTtcbiAgICAgICAgICBpZiAobGFzdGxpbmUpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0TGluZShsYXN0bGluZSwge1xuICAgICAgICAgICAgICBrZXk6IG1lbWJlci5pZCxcbiAgICAgICAgICAgICAgdmFsdWU6IG1lbWJlci5uYW1lLFxuICAgICAgICAgICAgfSwgcHJpdiwgKGNvbnRhY3QgIT09IG51bGwgJiYgKHBhcnNlSW50KGNvbnRhY3QuaWQpID09PSBwYXJzZUludChtZW1iZXIuaWQpKSkpO1xuICAgICAgICAgICAgaWYgKGltcG9ydGVkdGFnKSBpbXBvcnRlZHRhZyhsYXN0bGluZSk7XG5cbiAgICAgICAgICB9XG5cbiAgICAgICAgfSk7XG5cbiAgICAgIH0pO1xuICAgICAgaWYgKGRpc21pc3MpIGRpc21pc3MoKTtcbiAgICAgIHRoaXMuYWxlcnRCb3guZGlzbWlzc0FsZXJ0KGNvZGVtZXNzYWdlcy5pbXBvcnRwcml2ZXJyb3IpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBhd2FpdCB0aGlzLmFsZXJ0Qm94LmJ1aWxkKHtcbiAgICAgICAgZGlzbWlzc2libGU6IHRydWUsXG4gICAgICAgIG1lc3NhZ2U6IGNvZGVtZXNzYWdlcy5pbXBvcnRwcml2ZXJyb3IsXG4gICAgICAgIGNvZGVpZDogdHJ1ZSxcbiAgICAgICAgcGFyZW50OiB0aGlzLmZpZWxkc2V0X2FsZXJ0X3pvbmUsXG4gICAgICAgIHR5cGU6IGFsZXJ0Y29uZmlnLmRhbmdlcixcbiAgICAgIH0pO1xuICAgICAgY29uc29sZS5sb2coJ2VycicsIGVycik7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG4gIGFjdGl2YXRlRXZlbnRzKGxpbmUpIHtcbiAgICBpZiAoIWxpbmUpIHJldHVybjtcbiAgICBjb25zdCB7XG4gICAgICBtZW1iZXIsXG4gICAgICBwcml2cyxcbiAgICAgIGNvbnRhY3QsXG4gICAgICBkZWxldFxuICAgIH0gPSB0aGlzLmdldElucHV0cyhsaW5lKTtcbiAgICBpZiAoIW1lbWJlciB8fCAhcHJpdnMgfHwgIWNvbnRhY3QgfHwgIWRlbGV0KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHNpYmxpbmdzID0gcyA9PiBbLi4ucy5wYXJlbnRFbGVtZW50LmNoaWxkcmVuXS5maWx0ZXIoYyA9PiBjLm5vZGVUeXBlID09IDEgJiYgYyAhPSBzICYmIGMuY2xhc3NMaXN0LmNvbnRhaW5zKCdyb3cnKSAmJiBjLmRhdGFzZXQuYmxvY2sgIT09IG51bGwgJiYgYy5kYXRhc2V0LmJsb2NrID09PSB0aGlzLm9wdGlvbnMudGFyZ2V0KTtcblxuICAgIC8vIGVuYWJsZS9kaXNhYmxlIGNvbnRhY3Qgd2hlbiBwcml2aWxlZ2UgY2hhbmdlc1xuICAgIGNvbnN0IGxpbmVTZXR0aW5ncyA9IChwciwgY3QsIGRsLCBzeW5jaHJvID0gZmFsc2UpID0+IHtcblxuICAgICAgaWYgKHByICYmIHByLnZhbHVlID09PSByaWdodHMubWFuYWdlKSB7XG4gICAgICAgIC8vIG1hbmFnZXIgLSBjYW4ndCBkZWxldGUgbGluZSAtIGNhbiBjaG9vc2UgYXMgY29udGFjdFxuICAgICAgICBkbC5kaXNhYmxlZCA9IHRydWU7XG4gICAgICAgIGN0LmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgIC8vIGRpc21pc3MgcmVsYXRlZCBhbGVydFxuICAgICAgICB0aGlzLmFsZXJ0Qm94LmRpc21pc3NBbGVydChjb2RlbWVzc2FnZXMubm9tYW5hZ2VyKTtcbiAgICAgICAgaWYgKGN0LmNoZWNrZWQpIHtcbiAgICAgICAgICB0aGlzLmFsZXJ0Qm94LmRpc21pc3NBbGVydChjb2RlbWVzc2FnZXMubm9jb250YWN0KTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gbm90IG1hbmFnZXIgLSBjYW4gZGVsZXQgbGluZSAtIGNhbm5vdCBjaG9zZSBhcyBjb250YWN0XG4gICAgICAgIC8vICBpZiAoY3QuY2hlY2tlZCA9PT0gdHJ1ZSkgY3QuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoJ2NsaWNrJykpO1xuICAgICAgICBjdC5jaGVja2VkID0gZmFsc2U7XG4gICAgICAgIGRsLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgIGN0LmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgaWYgKHN5bmNocm8gPT09IHRydWUpIHtcbiAgICAgICAgc3luY2hyb1NpYmxpbmdzKGxpbmUpO1xuICAgICAgfVxuICAgICAgLy8gZGlzbWlzcyBhbGVydHNcbiAgICAgIGlmICghZGwuY2tlY2tlZCkge1xuICAgICAgICB0aGlzLmFsZXJ0Qm94LmRpc21pc3NBbGVydChjb2RlbWVzc2FnZXMubm9ib2R5KTtcbiAgICAgICAgdGhpcy5hbGVydEJveC5kaXNtaXNzQWxlcnQoY29kZW1lc3NhZ2VzLm9uZWF0bGVhc3QpO1xuICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBzeW5jaHJvU2libGluZ3MgPSAobGluZSkgPT4ge1xuICAgICAgY29uc3QgbG5zID0gc2libGluZ3MobGluZSk7XG4gICAgICBsbnMuZm9yRWFjaCgobG4pID0+IHtcbiAgICAgICAgY29uc3QgZGwgPSBsbi5xdWVyeVNlbGVjdG9yKFwiaW5wdXRbbmFtZSo9J1tcIiArIHRoaXMub3B0aW9ucy5kZWxldCArIFwiXSddXCIpO1xuICAgICAgICBjb25zdCBjdCA9IGxuLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWU9XCInICsgdGhpcy5vcHRpb25zLmNvbnRhY3RmaWVsZG5hbWUgKyAnXCJdJyk7XG4gICAgICAgIGNvbnN0IHByID0gbG4ucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZSo9XCJbJyArIHRoaXMub3B0aW9ucy5wcml2aWxlZ2UgKyAnXVwiXTpjaGVja2VkJyk7XG4gICAgICAgIGxpbmVTZXR0aW5ncyhwciwgY3QsIGRsLCBmYWxzZSk7XG5cbiAgICAgIH0pXG4gICAgfVxuXG4gICAgbWVtYmVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIChlKSA9PiB7XG4gICAgICBjb250YWN0LnZhbHVlID0gbWVtYmVyLnZhbHVlO1xuICAgICAgLy8gZGlzbWlzcyBhbGVydFxuICAgICAgaWYgKG1lbWJlci52YWx1ZSkge1xuICAgICAgICB0aGlzLmFsZXJ0Qm94LmRpc21pc3NBbGVydChjb2RlbWVzc2FnZXMuZW1wdHluYW1lKTtcbiAgICAgICAgdGhpcy5hbGVydEJveC5kaXNtaXNzQWxlcnQoY29kZW1lc3NhZ2VzLm9uZWF0bGVhc3QpO1xuICAgICAgICB0aGlzLmFsZXJ0Qm94LmRpc21pc3NBbGVydChjb2RlbWVzc2FnZXMubm9ib2R5KTtcbiAgICAgIH1cbiAgICB9KVxuXG4gICAgcHJpdnMuZm9yRWFjaCgocHJpdikgPT4ge1xuICAgICAgcHJpdi5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoZSkgPT4ge1xuICAgICAgICBpZiAocHJpdi5jaGVja2VkKSBsaW5lU2V0dGluZ3MocHJpdiwgY29udGFjdCwgZGVsZXQsIGZhbHNlKTtcbiAgICAgIH0pO1xuXG4gICAgICBpZiAocHJpdi5jaGVja2VkKSBsaW5lU2V0dGluZ3MocHJpdiwgY29udGFjdCwgZGVsZXQsIGZhbHNlKTtcbiAgICB9KVxuXG4gICAgY29udGFjdC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoZSkgPT4ge1xuICAgICAgaWYgKGUudGFyZ2V0LmNoZWNrZWQpIGRlbGV0LmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgIGVsc2UgZGVsZXQuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgIGNvbnN0IHByaXYgPSBsaW5lLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWUqPVwiWycgKyB0aGlzLm9wdGlvbnMucHJpdmlsZWdlICsgJ11cIl06Y2hlY2tlZCcpO1xuICAgICAgbGluZVNldHRpbmdzKHByaXYsIGNvbnRhY3QsIGRlbGV0LCB0cnVlKTtcbiAgICAgIC8vIGVuYWJsZSBvdGhlcndpc2VcblxuICAgIH0pXG5cbiAgICAvLyBkZWxldCBvayBmb3IgYWxsIHdoZW4gbmV3IGxpbmVcbiAgICAvL1xuICAgIGRlbGV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgIC8vIGF0IGxlYXN0IG9uZSBwcml2IGxpbmVcbiAgICAgIGNvbnN0IGRlbGV0bGFiZWwgPSBkZWxldC5jbG9zZXN0KCdsYWJlbCcpO1xuICAgICAgY29uc3QgbGluZXMgPSB0aGlzLmZpZWxkc2V0LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLWJsb2NrPVwiJyArIHRoaXMub3B0aW9ucy50YXJnZXQgKyAnXCJdOm5vdChbZGF0YS1tb2Q9XCJyZW1vdmVcIl0pJyk7XG4gICAgICBpZiAobGluZXMubGVuZ3RoIDw9IDEgJiYgZS50YXJnZXQuY2hlY2tlZCkge1xuICAgICAgICBkZWxldC5kaXNhYmxlZCA9IHRydWU7XG4gICAgICAgIGRlbGV0LmNoZWNrZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5hbGVydEJveC5idWlsZCh7XG4gICAgICAgICAgZGlzbWlzc2libGU6IHRydWUsXG4gICAgICAgICAgbWVzc2FnZTogY29kZW1lc3NhZ2VzLm9uZWF0bGVhc3QsXG4gICAgICAgICAgY29kZW1lc3NhZ2U6IGNvZGVtZXNzYWdlcy5vbmVhdGxlYXN0LFxuICAgICAgICAgIHR5cGU6IGFsZXJ0Y29uZmlnLndhcm5pbmcsXG4gICAgICAgICAgcGFyZW50OiAoZS5jdXJyZW50VGFyZ2V0LmlkIHx8IG51bGwpXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9IGVsc2UgaWYgKGUudGFyZ2V0LmNoZWNrZWQpIHtcbiAgICAgICAgdGhpcy5hbGVydEJveC5kaXNtaXNzQWxlcnQoY29kZW1lc3NhZ2VzLm9uZWF0bGVhc3QpO1xuICAgICAgICBpZiAobGluZS5jbGFzc0xpc3QuY29udGFpbnMoJ25ldycpKSB7XG4gICAgICAgICAgbGluZS5yZW1vdmUoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAoZGVsZXRsYWJlbCAmJiBkZWxldGxhYmVsLmRhdGFzZXQucmVzdG9yZSkgZGVsZXRsYWJlbC5zZXRBdHRyaWJ1dGUoJ3RpdGxlJywgZGVsZXRsYWJlbC5kYXRhc2V0LnJlc3RvcmUpO1xuICAgICAgICAgIGxpbmUuc2V0QXR0cmlidXRlKCdkYXRhLW1vZCcsICdyZW1vdmUnKTtcbiAgICAgICAgICBwcml2cy5mb3JFYWNoKHByaXYgPT4ge1xuICAgICAgICAgICAgcHJpdi5kaXNhYmxlZCA9IHRydWU7XG4gICAgICAgICAgICBwcml2LmNoZWNrZWQgPSBmYWxzZTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIGNvbnRhY3QuY2hlY2tlZCA9IGZhbHNlO1xuICAgICAgICAgIGNvbnRhY3QuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICAgIG1lbWJlci5kaXNhYmxlZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChkZWxldGxhYmVsICYmIGRlbGV0bGFiZWwuZGF0YXNldC5yZW1vdmUpIGRlbGV0bGFiZWwuc2V0QXR0cmlidXRlKCd0aXRsZScsIGRlbGV0bGFiZWwuZGF0YXNldC5yZW1vdmUpO1xuICAgICAgICBsaW5lLnJlbW92ZUF0dHJpYnV0ZSgnZGF0YS1tb2QnKTtcbiAgICAgICAgcHJpdnMuZm9yRWFjaChwcml2ID0+IHByaXYuZGlzYWJsZWQgPSBmYWxzZSk7XG4gICAgICAgIGNvbnRhY3QuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgbWVtYmVyLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICB9XG4gICAgfSk7XG4gICAgLy8gZGVsZXQgbW91c2VvdmVyIC0gZXhwbGFpbiB3aHkgaXQgaXMgZGlzYWJsZWQgd2hlbiBtYW5hZ2UgaXMgY2hlY2tlZFxuICAgIGRlbGV0LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlb3ZlcicsIChlKSA9PiB7XG4gICAgICBpZiAoZS50YXJnZXQuZGlzYWJsZWQpIHtcbiAgICAgICAgbGV0IHByID0gbGluZS5xdWVyeVNlbGVjdG9yKCdpbnB1dFtuYW1lKj1cIlsnICsgdGhpcy5vcHRpb25zLnByaXZpbGVnZSArICddXCJdOmNoZWNrZWQnKTtcbiAgICAgICAgaWYgKCFwcikgcmV0dXJuO1xuICAgICAgICBwciA9IHByLnZhbHVlLnRvTG93ZXJDYXNlKClcbiAgICAgICAgZS50YXJnZXQudGl0bGUgPSAoZS50YXJnZXQuZGF0YXNldFtwcl0pID8gZS50YXJnZXQuZGF0YXNldFtwcl0gOiBlLnRhcmdldC50aXRsZVxuICAgICAgfVxuICAgIH0pXG4gICAgLy8gZGlzYWJsZSBkZWxldCBpZiB1c2VyIGlzIHRoZSBvbmx5IG1hbmFnZXJcbiAgICBpZiAodGhpcy5jdXJyZW50X3VpZCA9PT0gbWVtYmVyLnZhbHVlKSBkZWxldC5kaXNhYmxlZCA9IHRydWU7XG5cblxuICB9XG5cbiAgLy8gc2VuZCBjbGVhbiBkYXRhIG9uIHN1Ym1pdFxuICBhc3luYyBjbGVhblByaXZpbGVnZXMoKSB7XG4gICAgLy8gY2hlY2sgbWFuYWdlcnMgYW5kIGNvbnRhY3RfdXNlcl9pZCBvbiBzdWJtaXRcblxuICAgIGNvbnN0IGNoZWNrQ29udGFjdCA9IGFzeW5jICgpID0+IHtcbiAgICAgIC8vIGNoZWNrIGlmIG9uZSBtYW5hZ2VyIGF0IGxlYXN0XG4gICAgICBjb25zdCBtYW5hZ2VycyA9IHRoaXMuZmllbGRzZXQucXVlcnlTZWxlY3RvckFsbCgnW25hbWUqPVwiWycgKyB0aGlzLm9wdGlvbnMucHJpdmlsZWdlICsgJ11cIl1bdmFsdWU9XCInICsgcmlnaHRzLm1hbmFnZSArICdcIl06Y2hlY2tlZCcpO1xuICAgICAgbGV0IG4gPSBtYW5hZ2Vycy5sZW5ndGg7XG5cbiAgICAgIGlmIChuID09PSAwKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuYWxlcnRCb3guYnVpbGQoe1xuICAgICAgICAgIGRpc21pc3NpYmxlOiB0cnVlLFxuICAgICAgICAgIG1lc3NhZ2U6IGNvZGVtZXNzYWdlcy5ub21hbmFnZXIsXG4gICAgICAgICAgY29kZWlkOiB0cnVlLFxuICAgICAgICAgIHR5cGU6IGFsZXJ0Y29uZmlnLmRhbmdlcixcbiAgICAgICAgICBwYXJlbnQ6IHRoaXMuZmllbGRzZXRfYWxlcnRfem9uZSxcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH0gZWxzZSB0aGlzLmFsZXJ0Qm94LmRpc21pc3NBbGVydChjb2RlbWVzc2FnZXMubm9tYW5hZ2VyKTtcbiAgICAgIC8vIGNoZWNrIGNvbnRhY3RcbiAgICAgIGNvbnN0IGNvbnRhY3QgPSB0aGlzLmZpZWxkc2V0LnF1ZXJ5U2VsZWN0b3IoJ1tuYW1lPVwiJyArIHRoaXMub3B0aW9ucy5jb250YWN0ZmllbGRuYW1lICsgJ1wiXTpjaGVja2VkJyk7XG5cbiAgICAgIGlmIChjb250YWN0ID09PSBudWxsKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuYWxlcnRCb3guYnVpbGQoe1xuICAgICAgICAgIGRpc21pc3NpYmxlOiB0cnVlLFxuICAgICAgICAgIGNvZGVpZDogdHJ1ZSxcbiAgICAgICAgICBtZXNzYWdlOiBjb2RlbWVzc2FnZXMubm9jb250YWN0LFxuICAgICAgICAgIHR5cGU6IGFsZXJ0Y29uZmlnLmRhbmdlcixcbiAgICAgICAgICBwYXJlbnQ6IHRoaXMuZmllbGRzZXRfYWxlcnRfem9uZVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgdGhpcy5hbGVydEJveC5kaXNtaXNzQWxlcnQoY29kZW1lc3NhZ2VzLm5vY29udGFjdCk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgY29uc3QgaGFzTWVtYmVyID0gKGxpbmUpID0+IHtcbiAgICAgIGNvbnN0IG1lbWJlciA9IGxpbmUucXVlcnlTZWxlY3RvcignW25hbWUqPVwiWycgKyB0aGlzLm9wdGlvbnMuaWRlbnQgKyAnXVwiXScpO1xuICAgICAgcmV0dXJuIChtZW1iZXIudmFsdWUpO1xuICAgIH1cbiAgICBjb25zdCBoYXNQcml2ID0gKGxpbmUpID0+IHtcbiAgICAgIGNvbnN0IHByaXYgPSBsaW5lLnF1ZXJ5U2VsZWN0b3IoJ1tuYW1lKj1cIlsnICsgdGhpcy5vcHRpb25zLnByaXZpbGVnZSArICddXCJdOmNoZWNrZWQnKTtcbiAgICAgIGlmIChwcml2ICYmIHByaXYudmFsdWUpIHJldHVybiB0cnVlO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25zdCBmb3JtYXRQcml2aWxlZ2UgPSAobGluZSkgPT4ge1xuXG4gICAgICBjb25zdCBlbHMgPSBsaW5lLnF1ZXJ5U2VsZWN0b3JBbGwoJ1tuYW1lKj1cIm1lbWJlcnNbXCInKTtcbiAgICAgIGVscy5mb3JFYWNoKChlbCkgPT4ge1xuICAgICAgICBsZXQgbmFtZSA9IGVsLm5hbWU7XG4gICAgICAgIG5hbWUgPSBuYW1lLnNwbGl0KCdbJyk7XG4gICAgICAgIG5hbWUucG9wKCk7XG4gICAgICAgIGVsLm5hbWUgPSBuYW1lLmpvaW4oJ1snKTtcbiAgICAgICAgaWYgKGVsLm5hbWUuaW5kZXhPZignWycgKyB0aGlzLm9wdGlvbnMucHJpdmlsZWdlICsgJ10nKSA+IDApIHtcbiAgICAgICAgICBlbC50eXBlID0gJ2NoZWNrYm94JztcbiAgICAgICAgICBlbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTtcbiAgICAgICAgfVxuXG4gICAgICB9KVxuICAgIH1cbiAgICBjb25zdCBoYXNjb250YWN0ID0gYXdhaXQgY2hlY2tDb250YWN0KCk7XG4gICAgaWYgKGhhc2NvbnRhY3QgPT09IHRydWUpIHtcbiAgICAgIGNvbnN0IGxpbmVzID0gdGhpcy5maWVsZHNldC5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1ibG9jaz1cIicgKyB0aGlzLm9wdGlvbnMudGFyZ2V0ICsgJ1wiXScpO1xuICAgICAgbGV0IG4gPSBsaW5lcy5sZW5ndGg7XG4gICAgICBsZXQgdmVyaWYgPSB0cnVlO1xuICAgICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7XG4gICAgICAgIGlmIChsaW5lLmRhdGFzZXQubW9kICYmIGxpbmUuZGF0YXNldC5tb2QgPT09ICdyZW1vdmUnKSB7XG4gICAgICAgICAgaWYgKG4gPiAxKSB7XG4gICAgICAgICAgICBsaW5lLnJlbW92ZSgpO1xuICAgICAgICAgICAgbi0tO1xuICAgICAgICAgIH0gZWxzZSByZXR1cm4gZmFsc2U7XG4gICAgICAgIH0gZWxzZSBpZiAoIWhhc01lbWJlcihsaW5lKSkge1xuICAgICAgICAgIGNvbnN0IGxpbmVubyA9IGxpbmUucXVlcnlTZWxlY3RvcignW25hbWUqPVwiWycgKyB0aGlzLm9wdGlvbnMuaWRlbnQgKyAnXVwiXScpO1xuICAgICAgICAgIGxpbmVuby5mb2N1cygpO1xuICAgICAgICAgIGlmIChsaW5lbm8udG9tc2VsZWN0KSBsaW5lbm8udG9tc2VsZWN0LmZvY3VzKCk7XG4gICAgICAgICAgYXdhaXQgdGhpcy5hbGVydEJveC5idWlsZCh7XG4gICAgICAgICAgICBkaXNtaXNzaWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGluc2VydGFmdGVyOiB0cnVlLFxuICAgICAgICAgICAgbWVzc2FnZTogY29kZW1lc3NhZ2VzLmVtcHR5bmFtZSxcbiAgICAgICAgICAgIGNvZGVpZDogdHJ1ZSxcbiAgICAgICAgICAgIHR5cGU6IGFsZXJ0Y29uZmlnLndhcm5pbmcsXG4gICAgICAgICAgICBwYXJlbnQ6IGxpbmVcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBjb25zdCByZXNwID0gZmFsc2U7IC8vIG5vIGNvbmZpbWJveCBqdXN0IHdhaXQgZm9yIHVzZXIgYWN0aW9uXG4gICAgICAgICAgLy8gY2FsbGJhY2sgd2hlbiBjb25maXJtYm94IHJlc3BvbnNlIGlzIGNob3NlbiBpZiAnY29uZmlybSdcbiAgICAgICAgICBpZiAocmVzcCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgaWYgKG4gPiAxKSB7XG4gICAgICAgICAgICAgIGxpbmUucmVtb3ZlKCk7XG4gICAgICAgICAgICAgIG4tLTtcbiAgICAgICAgICAgIH0gZWxzZSByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgICB9IGVsc2UgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9IGVsc2UgaWYgKCFoYXNQcml2KGxpbmUpKSB7XG4gICAgICAgICAgdGhpcy5hbGVydEJveC5kaXNtaXNzQWxlcnQoY29kZW1lc3NhZ2VzLmVtcHR5bmFtZSk7XG4gICAgICAgICAgYXdhaXQgdGhpcy5hbGVydEJveC5idWlsZCh7XG4gICAgICAgICAgICBkaXNtaXNzaWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGluc2VydGFmdGVyOiB0cnVlLFxuICAgICAgICAgICAgY29kZWlkOiB0cnVlLFxuICAgICAgICAgICAgbWVzc2FnZTogY29kZW1lc3NhZ2VzLnVoYXNub3ByaXYsXG4gICAgICAgICAgICB0eXBlOiBhbGVydGNvbmZpZy53YXJuaW5nLFxuICAgICAgICAgICAgcGFyZW50OiBsaW5lXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgdmVyaWYgPSBmYWxzZTtcbiAgICAgICAgfSBlbHNlIHRoaXMuYWxlcnRCb3guZGlzbWlzc0FsZXJ0KGNvZGVtZXNzYWdlcy51aGFzbm9wcml2KTtcbiAgICAgIH1cbiAgICAgIGlmICghdmVyaWYpIHJldHVybiB2ZXJpZjtcbiAgICAgIGZvciAoY29uc3QgbGluZSBvZiBsaW5lcykge1xuICAgICAgICBmb3JtYXRQcml2aWxlZ2UobGluZSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChuID09PSAwKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuYWxlcnRCb3guYnVpbGQoe1xuICAgICAgICAgIGRpc21pc3NpYmxlOiB0cnVlLFxuICAgICAgICAgIGNvZGVpZDogdHJ1ZSxcbiAgICAgICAgICBtZXNzYWdlOiBjb2RlbWVzc2FnZXMubm9ib2R5LFxuICAgICAgICAgIHR5cGU6IGFsZXJ0Y29uZmlnLndhcm5pbmcsXG4gICAgICAgICAgcGFyZW50OiB0aGlzLmZpZWxkc2V0X2FsZXJ0X3pvbmVcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH0gZWxzZSB0aGlzLmFsZXJ0Qm94LmRpc21pc3NBbGVydChjb2RlbWVzc2FnZXMubm9ib2R5KTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gZWxzZSByZXR1cm4gZmFsc2U7XG4gIH1cbiAgZ2V0TGluZVByaXZpbGVnZShpZCkge1xuICAgIGxldCBwcml2aWxlZ2UgPSBudWxsO1xuICAgIGNvbnN0IGxpbmVzID0gdGhpcy5maWVsZHNldC5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1ibG9jaz1cIicgKyB0aGlzLm9wdGlvbnMudGFyZ2V0ICsgJ1wiXScpXG4gICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7XG4gICAgICBpZiAocGFyc2VJbnQobGluZS5xdWVyeVNlbGVjdG9yKCdbbmFtZSo9XCJbJyArIHRoaXMub3B0aW9ucy5pZGVudCArICddXCJdJykudmFsdWUpID09PSBwYXJzZUludChpZCkpIHtcbiAgICAgICAgcHJpdmlsZWdlID0gbGluZTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHByaXZpbGVnZTtcbiAgfVxuICBjbGVhckFsbChyZXQgPSBmYWxzZSwgcmVwbGFjZWlkID0gbnVsbCkge1xuICAgIGxldCBsaW5lcyA9IHRoaXMuZmllbGRzZXQucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtYmxvY2s9XCInICsgdGhpcy5vcHRpb25zLnRhcmdldCArICdcIl0nKTtcbiAgICBsZXQga2VlcGluZGV4ID0gLTE7XG4gICAgbGluZXMuZm9yRWFjaCgobGluZSwgaW5kZXgpID0+IHtcbiAgICAgIGNvbnN0IHtcbiAgICAgICAgbWVtYmVyLFxuICAgICAgICBwcml2cyxcbiAgICAgICAgY29udGFjdCxcbiAgICAgICAgZGVsZXRcbiAgICAgIH0gPSB0aGlzLmdldElucHV0cyhsaW5lKTtcbiAgICAgIGlmICh0aGlzLmN1cnJlbnRfdWlkID09PSBtZW1iZXIudmFsdWUgfHwgcGFyc2VJbnQocmVwbGFjZWlkKSA9PT0gcGFyc2VJbnQobWVtYmVyLnZhbHVlKSkga2VlcGluZGV4ID0gaW5kZXg7XG4gICAgICBpZiAoaW5kZXggPiAwIHx8IChrZWVwaW5kZXggPiAwICYmIGtlZXBpbmRleCAhPT0gaW5kZXgpKSBsaW5lLnJlbW92ZSgpO1xuICAgIH0pO1xuICAgIC8vXG4gICAgY29uc3QgbGluZSA9IHRoaXMubmV3TGluZSh0cnVlKTtcbiAgICAvLyBpZiAoa2VlcGluZGV4ID4gMCkge1xuICAgIC8vICBsaW5lc1swXS5yZW1vdmUoKTtcbiAgICAvL31cbiAgICBpZiAocmV0ID09PSB0cnVlKSByZXR1cm4gbGluZTtcbiAgfVxuXG5cbn0iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/modules/project-privileges.js\n")}}]);