/*! For license information please see src_modules_project-privileges_js.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["src_modules_project-privileges_js"],{"./src/modules/project-privileges.js":(module,__webpack_exports__,__webpack_require__)=>{eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ProjectPrivileges: () => (/* binding */ ProjectPrivileges)\n/* harmony export */ });\n/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! dompurify */ \"./node_modules/dompurify/dist/purify.es.mjs\");\n/* harmony import */ var _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../modules/alert-box.js */ \"./src/modules/alert-box.js\");\n/* harmony import */ var _modules_form_submit_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../modules/form-submit.js */ \"./src/modules/form-submit.js\");\n/* harmony import */ var _modules_js_tom_select_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../modules/js-tom-select.js */ \"./src/modules/js-tom-select.js\");\n/* harmony import */ var _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../modules/modules-config.js */ \"./src/modules/modules-config.js\");\n/* harmony import */ var _modules_utils_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../modules/utils.js */ \"./src/modules/utils.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__, _modules_form_submit_js__WEBPACK_IMPORTED_MODULE_2__, _modules_js_tom_select_js__WEBPACK_IMPORTED_MODULE_3__]);\n([_modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__, _modules_form_submit_js__WEBPACK_IMPORTED_MODULE_2__, _modules_js_tom_select_js__WEBPACK_IMPORTED_MODULE_3__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n// privileges of a project\n// line with member name , priviliege , is contact , and delete functionality\n\n\n\n\n\n\nconst dynamics = {};\n//add local selector\n_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.domselectors.memberline = '[data-block=\"member\"]';\nclass ProjectPrivileges {\n  //TODO: rewrite to not depend on DOM select\n  options;\n  // current user id;\n  keymessages = {\n    oneatleast: 'oneatleast',\n    nomanager: 'nomanager',\n    nocontact: 'nocontact',\n    uhasnopriv: 'uhasnopriv',\n    importpriverror: 'importpriverror',\n    emptyname: 'emptyname'\n  };\n  current_uid;\n  fieldset;\n  fieldset_alert_zone;\n  linemodel;\n  currentlist = {};\n  // unique users\n  constructor(item, options = {}) {\n    if (item === null || (item instanceof HTMLElement === false)) return;\n    if (!item.jsprivileges) {\n      const defaultOptions = {\n        separ: '.new-privilege',\n        addbtn: '[data-add=\"block\"]',\n        target: 'member',\n        ident: 'member',\n        privilege: 'privilege',\n        delet: 'delet',\n        contact: 'contact',\n        contactfieldname: 'contact_user_id',\n        domselectors: {\n          tabcontent: '.tab-content'\n        }\n      };\n      this.options = Object.assign({}, defaultOptions, options);\n      // attach messages for fields and alerts system\n      this.fieldset = item;\n      if (!this.fieldset) return _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.error();\n      this.fieldset_alert_zone = item.querySelector(this.options.domselectors.tabcontent) ? item.querySelector(this.options.domselectors.tabcontent) : item;\n      this.options.separ = this.options.separ instanceof HTMLElement ? this.options.separ : (document.querySelector(this.options.separ) ? document.querySelector(this.options.separ) : null);\n      this.options.addbtn = this.options.addbtn instanceof HTMLElement ? this.options.addbtn : document.querySelector(this.options.addbtn);\n      if (this.options.addbtn) this.addListener();\n      const lines = this.fieldset.querySelectorAll('[data-block=\"' + this.options.target + '\"]');\n      if (lines.length === 0) return _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.error();\n      this.linemodel = lines[0];\n\n      this.linecontainer = lines[0].parentElement;\n      if (this.linecontainer === null) return _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.error();\n      this.current_uid = this.fieldset.dataset.u;\n      lines.forEach((line, i) => {\n        line.dataset.n = i;\n        this.activateEvents(line);\n      });\n      // add messaging functionalities\n      const form = this.fieldset.closest('form');\n      if (form) {\n        if (form.formsubmit) {\n          form.formsubmit.addHandler('validate', () => {\n             return this.validateFields();\n          });\n          form.formsubmit.addHandler('submit', () => {\n            return this.formatPrivileges();\n          });\n        } else form.addEventListener('submit', async (e) => {\n          const resp = this.validateFields();\n          if (resp === false) e.preventDefault();\n          else return this.formatPrivileges();\n        });\n      };\n      this.orderRows();\n      item.jsprivileges = this;\n    }\n    return item.jsprivileges;\n  }\n\n  newLine(ret = false, check = 0, replace = false) {\n    const lines = this.linecontainer.querySelectorAll(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.domselectors.memberline);\n    let newline;\n    if (lines.length && check > 0) newline = this.getLinePrivilege(check);\n    if (newline) {\n      if (replace === true) return newline;\n      else return null;\n    }\n    const clone = this.linemodel.cloneNode(true);\n    if (clone.dataset.hasOwnProperty(\"model\")) delete clone.dataset.model;\n    newline = this.clearLine(clone, 0, -1);\n    newline.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.hide);\n    if (newline) {\n      const nn = (this.fieldset.dataset.n) ? parseInt(this.fieldset.dataset.n) + 1 : lines.length;\n      this.linecontainer.append(newline);\n      newline = this.clearLine(newline, -1, nn, (this.options.separ ? this.options.separ : null));\n      newline.dataset.n = nn;\n      this.fieldset.dataset.n = nn;\n      this.activateEvents(newline, (check === 0));\n      if (ret === true) return newline;\n    }\n    return null;\n  }\n\n  addListener() {\n    this.options.target = (this.options.addbtn.dataset.target) ? this.options.addbtn.dataset.target : this.options.target;\n    this.options.addbtn.addEventListener('click', async (e) => {\n      e.preventDefault();\n      this.newLine();\n    })\n  }\n  indexElement(el, n, nn) {\n    // order is important\n    const keys = ['id', 'name', 'for', 'aria-controls'];\n    keys.forEach((key) => {\n      let val = el.getAttribute(key);\n      if (val !== null) {\n        if (key === 'name') val = val.replace('[' + n + ']', '[' + (nn) + ']');\n        else val = val.replace('_' + n, '_' + (nn));\n        el.setAttribute(key, val);\n      }\n    });\n    return el;\n  }\n  indexLine(line, n, nn = null) {\n    nn = (nn === null) ? n + 1 : nn;\n    const elems = line.querySelectorAll('[data-elem]');\n    elems.forEach((elem) => {\n      // change loop index - necessary for tailwindcss peerchecked to work otherwise not if name ends with []\n      // clean and reset events\n      const els = elem.querySelectorAll('input, select, label, div');\n      els.forEach((el) => {\n        if (n !== null) el = this.indexElement(el, n, nn);\n      });\n    });\n    line.dataset.n = parseInt(nn);\n    this.fieldset.dataset.n = (this.fieldset.dataset.n && this.fieldset.dataset.n >= nn) ? this.fieldset.dataset.n : nn;\n    return line;\n  }\n  clearLine(line, n = null, nn = null, separ = null) {\n    /*clean line element */\n    line.dataset.mod = '';\n    line.disabled = false;\n    const elems = line.querySelectorAll('[data-elem]');\n    elems.forEach((elem) => {\n      // change loop index - necessary for tailwindcss peerchecked to work otherwise not if name ends with []\n      // clean and reset events\n      const els = elem.querySelectorAll('input, select, label, div');\n      els.forEach((el) => {\n        if (!el.dataset.hasOwnProperty('readnly')) el.disabled = false;\n        if (n !== null) { // change names and id when adding a new row - not if clear only\n          nn = (nn === null) ? n + 1 : nn;\n          el = this.indexElement(el, n, nn);\n        }\n        switch (el.tagName.toLowerCase()) {\n          case 'input':\n            el.checked = false;\n            // disable contact as privilege is empty\n            if (el.name == this.options.contactfieldname) {\n              el.value = \"0\";\n              el.disabled = true;\n            }\n            break;\n          case 'select':\n            // remove options except the first one with select\n            Array.from(el.options).forEach(option => {\n              if (parseInt(option.value) > 0) option.remove();\n            });\n            // todo shoulkd have been removed\n            el.selectedIndex = 0;\n            if (!el.tomselect) {\n              ['tom-select', 'tomselected', 'ts-hidden-accessible'].forEach(cl => {\n                el.classList.remove(cl);\n              });\n            } else el.tomselect.destroy();\n            break;\n          case 'div':\n            if (n !== null && el.dataset.component) el.remove();\n            break;\n        }\n\n      })\n\n    })\n    /* add functionnalities */\n    if (separ) {\n      line.classList.add('new');\n      separ.after(line);\n    }\n\n    return line;\n  }\n\n  setLine(line, mb = {\n    key: '',\n    value: ''\n  }, priv, ct) {\n\n    priv = _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.defined_privileges[priv] ? _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.defined_privileges[priv] : _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.defined_privileges.viewers;\n    if (!priv) return;\n    const {\n      member,\n      privs,\n      contact,\n      delet\n    } = this.getInputs(line, priv);\n\n    if (!member || !privs || !contact || !delet) return;\n    // sanitize\n    mb.key = dompurify__WEBPACK_IMPORTED_MODULE_0__[\"default\"].sanitize(mb.key);\n    mb.value = dompurify__WEBPACK_IMPORTED_MODULE_0__[\"default\"].sanitize(mb.value);\n\n    let option = member.querySelector('option[value=\"' + mb.key + '\"]');\n    if (option === null) {\n      option = document.createElement('option');\n      option.value = mb.key;\n      option.text = mb.value;\n      member.append(option);\n    }\n    option.selected = true;\n    if (!member.tomselect) {\n      _modules_js_tom_select_js__WEBPACK_IMPORTED_MODULE_3__.JsTomSelect.applyTo(member);\n    }\n    privs.checked = true;\n    contact.value = mb.key;\n    if (priv === _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.rights.manage) {\n      contact.disabled = false;\n      if (ct === true && !contact.checked) contact.checked = true;\n    } else {\n      contact.disabled = true;\n      contact.checked = false;\n    }\n\n  }\n  getInputs(line, priv = false) {\n    const member = line.querySelector(\"[name*='[\" + this.options.ident + \"]']\");\n    let privs;\n    if (priv) {\n      privs = line.querySelector('input[name*=\"[' + this.options.privilege + ']\"][value=\"' + priv + '\"]');\n    } else privs = line.querySelectorAll('input[name*=\"[' + this.options.privilege + ']\"]');\n    const contact = line.querySelector('input[name=\"' + this.options.contactfieldname + '\"]');\n    const delet = line.querySelector(\"input[name*='[\" + this.options.delet + \"]']\");\n    return {\n      member: member,\n      privs: privs,\n      contact: contact,\n      delet: delet\n    };\n  }\n  async importPrivileges(privileges, replace = false, contact = null, importedtag = null, dismiss = null) {\n    if (replace === true) this.clearAll();\n    try {\n      Object.entries(privileges).forEach(([priv, members]) => {\n        members.forEach((member) => {\n          const lastline = this.newLine(true, member.id);\n          if (lastline) {\n            this.setLine(lastline, {\n              key: member.id,\n              value: member.name,\n            }, priv, (contact !== null && (contact.id === member.id)));\n            if (importedtag) importedtag(lastline);\n          }\n          replace = false;\n        });\n      });\n      if (dismiss) dismiss();\n      _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.dismissAlert(this.keymessages.importpriverror);\n\n      this.orderRows();\n      return true;\n    } catch (err) {\n      _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.addAlert({\n        type: _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.alertconfig.types.error,\n        content: this.keymessages.importpriverror,\n        dismissible: true,\n        inverse: true\n      });\n      console.log('err', err);\n      return false;\n    }\n  }\n  activateEvents(line, ts = false) {\n    if (!line) return;\n    const {\n      member,\n      privs,\n      contact,\n      delet\n    } = this.getInputs(line);\n    if (!member || !privs || !contact || !delet) {\n      return;\n    }\n\n    const siblings = s => [...s.parentElement.children].filter(c => c.nodeType == 1 && c != s && c.classList.contains('row') && c.dataset.block !== null && c.dataset.block === this.options.target);\n    // activate tom select if needed\n    // enable/disable contact when privilege changes\n    if (!member.currentlist) member.currentlist = this.currentlist;\n    if (member.value && !this.currentlist[member.value]) this.currentlist[member.value] = true;\n    if (ts === true && !member.tomselect) {\n      _modules_js_tom_select_js__WEBPACK_IMPORTED_MODULE_3__.JsTomSelect.applyTo(member);\n    }\n    const lineSettings = (pr, ct, dl, synchro = false) => {\n      if (pr && pr.checked) {\n        pr.checked = true;\n        if (_modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.hasMessage(line)) _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.removeMessage({\n          type: _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.alertconfig.types.danger,\n          parent: line,\n          content: this.keymessages.uhasnopriv\n        });\n      }\n      if (pr && pr.value === _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.rights.manage) {\n        // manager - can't delete line - can choose as contact\n        dl.disabled = true;\n        ct.disabled = false;\n        _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.dismissAlert(this.keymessages.nomanager);\n        if (ct.checked) {\n          _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.dismissAlert(this.keymessages.nocontact);\n          ct.dispatchEvent(new Event('valid'));\n        }\n      } else {\n        // not manager - can delet line - cannot chose as contact\n        ct.checked = false;\n        dl.disabled = false;\n        ct.disabled = true;\n      }\n\n      if (synchro === true) {\n        synchroSiblings(line);\n      }\n      // dismiss alerts\n      if (!dl.ckecked) {\n        _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.dismissAlert(this.keymessages.nobody);\n        if (_modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.hasMessage(line)) _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.removeMessage({\n          type: _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.alertconfig.types.danger,\n          parent: line,\n          content: this.keymessages.oneatleast\n        });\n      }\n    }\n    const synchroSiblings = (line) => {\n      const lns = siblings(line);\n      lns.forEach((ln) => {\n        const dl = ln.querySelector(\"input[name*='[\" + this.options.delet + \"]']\");\n        const ct = ln.querySelector('input[name=\"' + this.options.contactfieldname + '\"]');\n        const pr = ln.querySelector('input[name*=\"[' + this.options.privilege + ']\"]:checked');\n        lineSettings(pr, ct, dl, false);\n\n      })\n    }\n\n    member.addEventListener('change', (e) => {\n      contact.value = member.value;\n      if (parseInt(member.value) > 0 && _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.hasMessage(member)) _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.removeMessage({\n        type: _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.alertconfig.types.danger,\n        parent: member,\n        content: this.keymessages.emptyname\n      });\n    })\n    privs.forEach((priv) => {\n      if (priv.dataset.hasOwnProperty(\"readonly\")) (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_5__.input_read_only)(priv);\n      priv.addEventListener('change', (e) => {\n        if (priv.checked) lineSettings(priv, contact, delet, false);\n      });\n\n      if (priv.checked) lineSettings(priv, contact, delet, false);\n    })\n    if (contact.dataset.hasOwnProperty(\"readonly\")) (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_5__.input_read_only)(contact);\n    contact.addEventListener('change', (e) => {\n      if (contact.checked) {\n        delet.disabled = true;\n      } else delet.disabled = false;\n      const priv = line.querySelector('input[name*=\"[' + this.options.privilege + ']\"]:checked');\n      lineSettings(priv, contact, delet, true);\n      // enable otherwise\n    })\n    // delet ok for all when new line\n    //\n\n    delet.addEventListener('click', (e) => {\n      // at least one priv line\n      const deletlabel = delet.closest('label');\n      const lines = this.fieldset.querySelectorAll('[data-block=\"' + this.options.target + '\"]:not([data-mod=\"remove\"])');\n      if (lines.length <= 1 && e.target.checked) {\n        e.preventDefault();\n        line.removeAttribute('data-mod');\n        member.disabled = false;\n        e.target.disabled = true;\n        _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.addMessage({\n          type: _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.alertconfig.types.danger,\n          parent: line,\n          content: this.keymessages.oneatleast,\n          duration: 3000\n        });\n        return;\n      } else if (e.target.checked) {\n        if (_modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.hasMessage(member)) _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.removeMessage({\n          type: _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.alertconfig.types.danger,\n          parent: member\n        });\n        if (line.classList.contains('new')) {\n          line.remove();\n        } else {\n          if (deletlabel && deletlabel.dataset.restore) deletlabel.dataset.title = deletlabel.dataset.restore;\n          line.setAttribute('data-mod', 'remove');\n          privs.forEach(priv => {\n            priv.dataset.checked = priv.checked;\n            priv.checked = false;\n            priv.disabled = true;\n          })\n          contact.checked = false;\n          contact.disabled = true;\n          member.disabled = true;\n        }\n      } else {\n        if (deletlabel && deletlabel.dataset.remove) deletlabel.dataset.title = deletlabel.dataset.remove;\n        line.removeAttribute('data-mod');\n        privs.forEach(priv => {\n          priv.disabled = false;\n          if (priv.dataset.checked === \"true\") priv.checked = true;\n          else priv.checked = false;\n        });\n\n        member.disabled = false;\n      }\n    });\n    // delet mouseover - explain why it is disabled when manage is checked\n    delet.addEventListener('mouseover', (e) => {\n      if (e.target.disabled) {\n        let pr = line.querySelector('input[name*=\"[' + this.options.privilege + ']\"]:checked');\n        if (!pr) return;\n        pr = pr.value.toLowerCase()\n        e.target.dataset.title = (e.target.dataset[pr]) ? e.target.dataset[pr] : e.target.dataset.title\n      }\n    })\n    // disable delet if user is the only manager\n    if (this.current_uid === member.value) delet.disabled = true;\n  }\n\n  validateFields(add = false) { // check managers and contact_user_id on submit\n    const check_contact = () => {\n      // check if one manager at least\n      const managers = this.fieldset.querySelectorAll('[name*=\"[' + this.options.privilege + ']\"][value=\"' + _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.rights.manage + '\"]:checked');\n      if (managers.length === 0) {\n        _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.addAlert({\n          type: _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.alertconfig.types.danger,\n          content: this.keymessages.nomanager,\n          dismissible: true,\n          inverse: true\n        });\n        this.tabError(true);\n        return false;\n      } else {\n        _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.dismissAlert(this.keymessages.nomanager);\n        this.tabError(false);\n      }\n      // check contact\n\n      const contact = this.fieldset.querySelector('[name=\"' + this.options.contactfieldname + '\"]:checked');\n      if (contact === null) {\n        _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.addAlert({\n          type: _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.alertconfig.types.danger,\n          content: this.keymessages.nocontact,\n          dismissible: true,\n          inverse: true\n        });\n        this.tabError(true);\n        return false;\n      }\n      _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.dismissAlert(this.keymessages.nocontact);\n      this.tabError(false);\n      return true;\n    }\n    const has_member = (member) => {\n        return (member.value && parseInt(member.value)>0);\n    }\n    const has_priv = (line) => {\n      const priv = line.querySelector('[name*=\"[' + this.options.privilege + ']\"]:checked');\n      if (priv && priv.value) return true;\n      return false;\n    }\n    const lines = this.fieldset.querySelectorAll('[data-block=\"' + this.options.target + '\"]');\n    let n = lines.length;\n    let verif = true;\n    for (const line of lines) {\n      const member = line.querySelector('[name*=\"[' + this.options.ident + ']\"]');\n      if (line.dataset.hasOwnProperty(\"model\") || line.dataset.mod && line.dataset.mod === 'remove') {\n        if (n > 1) {\n          line.remove();\n          n--;\n        } else return false;\n      } else {\n      if (!has_member(member)) {\n        _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.addMessage({\n          type: _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.alertconfig.types.danger,\n          parent: member,\n          content: this.keymessages.emptyname\n        });\n        member.focus();\n        const resp = false; // no confimbox just wait for user action\n        // callback if confirmbox response is chosen if 'confirm'\n        if (resp === true) {\n          if (n > 1) {\n            line.remove();\n            n--;\n          } else return false;\n        } else return false;\n      }\n\n      if (!has_priv(line)) {\n        _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.addMessage({\n          type: _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.alertconfig.types.danger,\n          parent: line,\n          content: this.keymessages.uhasnopriv\n        });\n        verif = false;\n      }  else if (_modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.hasMessage(line)) {\n        _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.removeMessage({\n          type: _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.alertconfig.types.danger,\n          parent: line,\n          content: this.keymessages.uhasnopriv\n        });\n      }\n      }\n    }\n    if (n === 0) {\n      _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.addAlert({\n        type: _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.alertconfig.types.danger,\n        content: this.keymessages.nobody,\n        dismissible: true,\n        inverse: true\n      });\n      return false;\n    } else _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_1__.AlertBox.dismissAlert(this.keymessages.nobody);\n    const hascontact = this.fieldset.dataset.hasOwnProperty(\"readonly\") || check_contact();\n    return (hascontact && verif);\n  }\n\n  formatPrivileges() {\n    const lines = this.fieldset.querySelectorAll('[data-block=\"' + this.options.target + '\"]');\n    const format_privilege = (line) => {\n      const els = line.querySelectorAll('[name*=\"members[\"');\n      els.forEach((el) => {\n        let name = el.name;\n        name = name.split('[');\n        name.pop();\n        el.name = name.join('[');\n        if (el.name.indexOf('[' + this.options.privilege + ']') > 0) {\n          el.type = 'checkbox';\n          el.classList.add('hidden');\n        }\n\n      });\n    }\n    lines.forEach(line => {\n      format_privilege(line);\n    });\n    return true;\n  }\n\n\n  getLinePrivilege(id) {\n    let privilege = null;\n    const lines = this.fieldset.querySelectorAll('[data-block=\"' + this.options.target + '\"]')\n    for (const line of lines) {\n      if (parseInt(line.querySelector('[name*=\"[' + this.options.ident + ']\"]').value) === parseInt(id)) {\n        privilege = line;\n        break;\n      }\n    }\n\n    return privilege;\n  }\n  clearAll() {\n    let lines = this.fieldset.querySelectorAll('[data-block=\"' + this.options.target + '\"]');\n    lines.forEach((line, index) => {\n      line.remove();\n    });\n\n  }\n  orderRows() {\n    const lines = Array.from(this.fieldset.querySelectorAll('[data-block=\"' + this.options.target + '\"]'));\n    if (lines.length > 2) {\n      try {\n        const rightssorted = Object.values(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.rights);\n        lines.sort((linea, lineb) => {\n          const a = this.getInputs(linea);\n          const b = this.getInputs(lineb);\n          const nameb = new String(b.member.options[b.member.selectedIndex].text).toLowerCase().split(' ')\n          const namea = new String(a.member.options[a.member.selectedIndex].text).toLowerCase().split(' ');\n          const priva = Array.from(a.privs).filter(priv => (priv.checked));\n          const privb = Array.from(b.privs).filter(priv => (priv.checked));\n          const compa = (+!a.contact.checked) + ` ` + rightssorted.indexOf(((priva.length) ? priva[0].value : null)) + ` ` + ((namea.length > 1) ? namea.pop() + ` ` + namea[0] : namea[0]);\n          const compb = (+!b.contact.checked) + ` ` + rightssorted.indexOf(((privb.length) ? privb[0].value : null)) + ` ` + ((nameb.length > 1) ? nameb.pop() + ` ` + nameb[0] : nameb[0]);\n          if (compb > compa) return -1;\n          else if (compa > compb) return 1;\n          else return 0;\n        })\n        const clone = this.linecontainer;\n        lines.forEach((line, i) => {\n          clone.appendChild(line);\n        });\n      } catch (err) {\n        console.log('err not sorted', err);\n      }\n    }\n  }\n\n  tabError(on) {\n    const tab = (this.fieldset.classList.contains(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.domselectors.component.tabs.tab.substr(1))) ? this.fieldset : ((this.fieldset.parentElement.classList.contains(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.domselectors.component.tabs.tab.substr(1))) ? this.fieldset.parentElement : null);\n    if (tab === null) return;\n    if (on === true) tab.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.error);\n    else tab.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.error);\n  }\n}\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFDQTtBQUNBO0FBQ0EsTUFBTSwyREFBUTtBQUNkLGNBQWMsMkRBQVE7QUFDdEI7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0EsTUFBTSxLQUFLLDJEQUFRO0FBQ25CO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQ0FBMkMsOERBQU07QUFDakQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxrREFBa0Qsb0VBQVksbUdBQW1HLG9FQUFZO0FBQzdLO0FBQ0EsdUNBQXVDLDJEQUFHO0FBQzFDLDhCQUE4QiwyREFBRztBQUNqQztBQUNBLEMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvbW9kdWxlcy9wcm9qZWN0LXByaXZpbGVnZXMuanM/ZGQyMyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBwcml2aWxlZ2VzIG9mIGEgcHJvamVjdFxuLy8gbGluZSB3aXRoIG1lbWJlciBuYW1lICwgcHJpdmlsaWVnZSAsIGlzIGNvbnRhY3QgLCBhbmQgZGVsZXRlIGZ1bmN0aW9uYWxpdHlcbmltcG9ydCBET01QdXJpZnkgZnJvbSAnZG9tcHVyaWZ5JztcbmltcG9ydCB7XG4gIEFsZXJ0Qm94XG59IGZyb20gJy4uL21vZHVsZXMvYWxlcnQtYm94LmpzJztcbmltcG9ydCB7XG4gIEZvcm1TdWJtaXQsXG59IGZyb20gXCIuLi9tb2R1bGVzL2Zvcm0tc3VibWl0LmpzXCI7XG5pbXBvcnQge1xuICBKc1RvbVNlbGVjdFxufSBmcm9tIFwiLi4vbW9kdWxlcy9qcy10b20tc2VsZWN0LmpzXCI7XG5pbXBvcnQge1xuICByaWdodHMsXG4gIGRlZmluZWRfcHJpdmlsZWdlcyxcbiAgZG9tc2VsZWN0b3JzLFxuICBjc3Ncbn0gZnJvbSAnLi4vbW9kdWxlcy9tb2R1bGVzLWNvbmZpZy5qcyc7XG5pbXBvcnQge1xuICBpbnB1dF9yZWFkX29ubHlcbn0gZnJvbSBcIi4uL21vZHVsZXMvdXRpbHMuanNcIjtcbmNvbnN0IGR5bmFtaWNzID0ge307XG4vL2FkZCBsb2NhbCBzZWxlY3RvclxuZG9tc2VsZWN0b3JzLm1lbWJlcmxpbmUgPSAnW2RhdGEtYmxvY2s9XCJtZW1iZXJcIl0nO1xuZXhwb3J0IGNsYXNzIFByb2plY3RQcml2aWxlZ2VzIHtcbiAgLy9UT0RPOiByZXdyaXRlIHRvIG5vdCBkZXBlbmQgb24gRE9NIHNlbGVjdFxuICBvcHRpb25zO1xuICAvLyBjdXJyZW50IHVzZXIgaWQ7XG4gIGtleW1lc3NhZ2VzID0ge1xuICAgIG9uZWF0bGVhc3Q6ICdvbmVhdGxlYXN0JyxcbiAgICBub21hbmFnZXI6ICdub21hbmFnZXInLFxuICAgIG5vY29udGFjdDogJ25vY29udGFjdCcsXG4gICAgdWhhc25vcHJpdjogJ3VoYXNub3ByaXYnLFxuICAgIGltcG9ydHByaXZlcnJvcjogJ2ltcG9ydHByaXZlcnJvcicsXG4gICAgZW1wdHluYW1lOiAnZW1wdHluYW1lJ1xuICB9O1xuICBjdXJyZW50X3VpZDtcbiAgZmllbGRzZXQ7XG4gIGZpZWxkc2V0X2FsZXJ0X3pvbmU7XG4gIGxpbmVtb2RlbDtcbiAgY3VycmVudGxpc3QgPSB7fTtcbiAgLy8gdW5pcXVlIHVzZXJzXG4gIGNvbnN0cnVjdG9yKGl0ZW0sIG9wdGlvbnMgPSB7fSkge1xuICAgIGlmIChpdGVtID09PSBudWxsIHx8IChpdGVtIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQgPT09IGZhbHNlKSkgcmV0dXJuO1xuICAgIGlmICghaXRlbS5qc3ByaXZpbGVnZXMpIHtcbiAgICAgIGNvbnN0IGRlZmF1bHRPcHRpb25zID0ge1xuICAgICAgICBzZXBhcjogJy5uZXctcHJpdmlsZWdlJyxcbiAgICAgICAgYWRkYnRuOiAnW2RhdGEtYWRkPVwiYmxvY2tcIl0nLFxuICAgICAgICB0YXJnZXQ6ICdtZW1iZXInLFxuICAgICAgICBpZGVudDogJ21lbWJlcicsXG4gICAgICAgIHByaXZpbGVnZTogJ3ByaXZpbGVnZScsXG4gICAgICAgIGRlbGV0OiAnZGVsZXQnLFxuICAgICAgICBjb250YWN0OiAnY29udGFjdCcsXG4gICAgICAgIGNvbnRhY3RmaWVsZG5hbWU6ICdjb250YWN0X3VzZXJfaWQnLFxuICAgICAgICBkb21zZWxlY3RvcnM6IHtcbiAgICAgICAgICB0YWJjb250ZW50OiAnLnRhYi1jb250ZW50J1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgdGhpcy5vcHRpb25zID0gT2JqZWN0LmFzc2lnbih7fSwgZGVmYXVsdE9wdGlvbnMsIG9wdGlvbnMpO1xuICAgICAgLy8gYXR0YWNoIG1lc3NhZ2VzIGZvciBmaWVsZHMgYW5kIGFsZXJ0cyBzeXN0ZW1cbiAgICAgIHRoaXMuZmllbGRzZXQgPSBpdGVtO1xuICAgICAgaWYgKCF0aGlzLmZpZWxkc2V0KSByZXR1cm4gQWxlcnRCb3guZXJyb3IoKTtcbiAgICAgIHRoaXMuZmllbGRzZXRfYWxlcnRfem9uZSA9IGl0ZW0ucXVlcnlTZWxlY3Rvcih0aGlzLm9wdGlvbnMuZG9tc2VsZWN0b3JzLnRhYmNvbnRlbnQpID8gaXRlbS5xdWVyeVNlbGVjdG9yKHRoaXMub3B0aW9ucy5kb21zZWxlY3RvcnMudGFiY29udGVudCkgOiBpdGVtO1xuICAgICAgdGhpcy5vcHRpb25zLnNlcGFyID0gdGhpcy5vcHRpb25zLnNlcGFyIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQgPyB0aGlzLm9wdGlvbnMuc2VwYXIgOiAoZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih0aGlzLm9wdGlvbnMuc2VwYXIpID8gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih0aGlzLm9wdGlvbnMuc2VwYXIpIDogbnVsbCk7XG4gICAgICB0aGlzLm9wdGlvbnMuYWRkYnRuID0gdGhpcy5vcHRpb25zLmFkZGJ0biBpbnN0YW5jZW9mIEhUTUxFbGVtZW50ID8gdGhpcy5vcHRpb25zLmFkZGJ0biA6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5vcHRpb25zLmFkZGJ0bik7XG4gICAgICBpZiAodGhpcy5vcHRpb25zLmFkZGJ0bikgdGhpcy5hZGRMaXN0ZW5lcigpO1xuICAgICAgY29uc3QgbGluZXMgPSB0aGlzLmZpZWxkc2V0LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLWJsb2NrPVwiJyArIHRoaXMub3B0aW9ucy50YXJnZXQgKyAnXCJdJyk7XG4gICAgICBpZiAobGluZXMubGVuZ3RoID09PSAwKSByZXR1cm4gQWxlcnRCb3guZXJyb3IoKTtcbiAgICAgIHRoaXMubGluZW1vZGVsID0gbGluZXNbMF07XG5cbiAgICAgIHRoaXMubGluZWNvbnRhaW5lciA9IGxpbmVzWzBdLnBhcmVudEVsZW1lbnQ7XG4gICAgICBpZiAodGhpcy5saW5lY29udGFpbmVyID09PSBudWxsKSByZXR1cm4gQWxlcnRCb3guZXJyb3IoKTtcbiAgICAgIHRoaXMuY3VycmVudF91aWQgPSB0aGlzLmZpZWxkc2V0LmRhdGFzZXQudTtcbiAgICAgIGxpbmVzLmZvckVhY2goKGxpbmUsIGkpID0+IHtcbiAgICAgICAgbGluZS5kYXRhc2V0Lm4gPSBpO1xuICAgICAgICB0aGlzLmFjdGl2YXRlRXZlbnRzKGxpbmUpO1xuICAgICAgfSk7XG4gICAgICAvLyBhZGQgbWVzc2FnaW5nIGZ1bmN0aW9uYWxpdGllc1xuICAgICAgY29uc3QgZm9ybSA9IHRoaXMuZmllbGRzZXQuY2xvc2VzdCgnZm9ybScpO1xuICAgICAgaWYgKGZvcm0pIHtcbiAgICAgICAgaWYgKGZvcm0uZm9ybXN1Ym1pdCkge1xuICAgICAgICAgIGZvcm0uZm9ybXN1Ym1pdC5hZGRIYW5kbGVyKCd2YWxpZGF0ZScsICgpID0+IHtcbiAgICAgICAgICAgICByZXR1cm4gdGhpcy52YWxpZGF0ZUZpZWxkcygpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGZvcm0uZm9ybXN1Ym1pdC5hZGRIYW5kbGVyKCdzdWJtaXQnLCAoKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5mb3JtYXRQcml2aWxlZ2VzKCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSBmb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIGFzeW5jIChlKSA9PiB7XG4gICAgICAgICAgY29uc3QgcmVzcCA9IHRoaXMudmFsaWRhdGVGaWVsZHMoKTtcbiAgICAgICAgICBpZiAocmVzcCA9PT0gZmFsc2UpIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICBlbHNlIHJldHVybiB0aGlzLmZvcm1hdFByaXZpbGVnZXMoKTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdGhpcy5vcmRlclJvd3MoKTtcbiAgICAgIGl0ZW0uanNwcml2aWxlZ2VzID0gdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIGl0ZW0uanNwcml2aWxlZ2VzO1xuICB9XG5cbiAgbmV3TGluZShyZXQgPSBmYWxzZSwgY2hlY2sgPSAwLCByZXBsYWNlID0gZmFsc2UpIHtcbiAgICBjb25zdCBsaW5lcyA9IHRoaXMubGluZWNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKGRvbXNlbGVjdG9ycy5tZW1iZXJsaW5lKTtcbiAgICBsZXQgbmV3bGluZTtcbiAgICBpZiAobGluZXMubGVuZ3RoICYmIGNoZWNrID4gMCkgbmV3bGluZSA9IHRoaXMuZ2V0TGluZVByaXZpbGVnZShjaGVjayk7XG4gICAgaWYgKG5ld2xpbmUpIHtcbiAgICAgIGlmIChyZXBsYWNlID09PSB0cnVlKSByZXR1cm4gbmV3bGluZTtcbiAgICAgIGVsc2UgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IGNsb25lID0gdGhpcy5saW5lbW9kZWwuY2xvbmVOb2RlKHRydWUpO1xuICAgIGlmIChjbG9uZS5kYXRhc2V0Lmhhc093blByb3BlcnR5KFwibW9kZWxcIikpIGRlbGV0ZSBjbG9uZS5kYXRhc2V0Lm1vZGVsO1xuICAgIG5ld2xpbmUgPSB0aGlzLmNsZWFyTGluZShjbG9uZSwgMCwgLTEpO1xuICAgIG5ld2xpbmUuY2xhc3NMaXN0LnJlbW92ZShjc3MuaGlkZSk7XG4gICAgaWYgKG5ld2xpbmUpIHtcbiAgICAgIGNvbnN0IG5uID0gKHRoaXMuZmllbGRzZXQuZGF0YXNldC5uKSA/IHBhcnNlSW50KHRoaXMuZmllbGRzZXQuZGF0YXNldC5uKSArIDEgOiBsaW5lcy5sZW5ndGg7XG4gICAgICB0aGlzLmxpbmVjb250YWluZXIuYXBwZW5kKG5ld2xpbmUpO1xuICAgICAgbmV3bGluZSA9IHRoaXMuY2xlYXJMaW5lKG5ld2xpbmUsIC0xLCBubiwgKHRoaXMub3B0aW9ucy5zZXBhciA/IHRoaXMub3B0aW9ucy5zZXBhciA6IG51bGwpKTtcbiAgICAgIG5ld2xpbmUuZGF0YXNldC5uID0gbm47XG4gICAgICB0aGlzLmZpZWxkc2V0LmRhdGFzZXQubiA9IG5uO1xuICAgICAgdGhpcy5hY3RpdmF0ZUV2ZW50cyhuZXdsaW5lLCAoY2hlY2sgPT09IDApKTtcbiAgICAgIGlmIChyZXQgPT09IHRydWUpIHJldHVybiBuZXdsaW5lO1xuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGFkZExpc3RlbmVyKCkge1xuICAgIHRoaXMub3B0aW9ucy50YXJnZXQgPSAodGhpcy5vcHRpb25zLmFkZGJ0bi5kYXRhc2V0LnRhcmdldCkgPyB0aGlzLm9wdGlvbnMuYWRkYnRuLmRhdGFzZXQudGFyZ2V0IDogdGhpcy5vcHRpb25zLnRhcmdldDtcbiAgICB0aGlzLm9wdGlvbnMuYWRkYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKGUpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHRoaXMubmV3TGluZSgpO1xuICAgIH0pXG4gIH1cbiAgaW5kZXhFbGVtZW50KGVsLCBuLCBubikge1xuICAgIC8vIG9yZGVyIGlzIGltcG9ydGFudFxuICAgIGNvbnN0IGtleXMgPSBbJ2lkJywgJ25hbWUnLCAnZm9yJywgJ2FyaWEtY29udHJvbHMnXTtcbiAgICBrZXlzLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgbGV0IHZhbCA9IGVsLmdldEF0dHJpYnV0ZShrZXkpO1xuICAgICAgaWYgKHZhbCAhPT0gbnVsbCkge1xuICAgICAgICBpZiAoa2V5ID09PSAnbmFtZScpIHZhbCA9IHZhbC5yZXBsYWNlKCdbJyArIG4gKyAnXScsICdbJyArIChubikgKyAnXScpO1xuICAgICAgICBlbHNlIHZhbCA9IHZhbC5yZXBsYWNlKCdfJyArIG4sICdfJyArIChubikpO1xuICAgICAgICBlbC5zZXRBdHRyaWJ1dGUoa2V5LCB2YWwpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBlbDtcbiAgfVxuICBpbmRleExpbmUobGluZSwgbiwgbm4gPSBudWxsKSB7XG4gICAgbm4gPSAobm4gPT09IG51bGwpID8gbiArIDEgOiBubjtcbiAgICBjb25zdCBlbGVtcyA9IGxpbmUucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtZWxlbV0nKTtcbiAgICBlbGVtcy5mb3JFYWNoKChlbGVtKSA9PiB7XG4gICAgICAvLyBjaGFuZ2UgbG9vcCBpbmRleCAtIG5lY2Vzc2FyeSBmb3IgdGFpbHdpbmRjc3MgcGVlcmNoZWNrZWQgdG8gd29yayBvdGhlcndpc2Ugbm90IGlmIG5hbWUgZW5kcyB3aXRoIFtdXG4gICAgICAvLyBjbGVhbiBhbmQgcmVzZXQgZXZlbnRzXG4gICAgICBjb25zdCBlbHMgPSBlbGVtLnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0LCBzZWxlY3QsIGxhYmVsLCBkaXYnKTtcbiAgICAgIGVscy5mb3JFYWNoKChlbCkgPT4ge1xuICAgICAgICBpZiAobiAhPT0gbnVsbCkgZWwgPSB0aGlzLmluZGV4RWxlbWVudChlbCwgbiwgbm4pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gICAgbGluZS5kYXRhc2V0Lm4gPSBwYXJzZUludChubik7XG4gICAgdGhpcy5maWVsZHNldC5kYXRhc2V0Lm4gPSAodGhpcy5maWVsZHNldC5kYXRhc2V0Lm4gJiYgdGhpcy5maWVsZHNldC5kYXRhc2V0Lm4gPj0gbm4pID8gdGhpcy5maWVsZHNldC5kYXRhc2V0Lm4gOiBubjtcbiAgICByZXR1cm4gbGluZTtcbiAgfVxuICBjbGVhckxpbmUobGluZSwgbiA9IG51bGwsIG5uID0gbnVsbCwgc2VwYXIgPSBudWxsKSB7XG4gICAgLypjbGVhbiBsaW5lIGVsZW1lbnQgKi9cbiAgICBsaW5lLmRhdGFzZXQubW9kID0gJyc7XG4gICAgbGluZS5kaXNhYmxlZCA9IGZhbHNlO1xuICAgIGNvbnN0IGVsZW1zID0gbGluZS5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1lbGVtXScpO1xuICAgIGVsZW1zLmZvckVhY2goKGVsZW0pID0+IHtcbiAgICAgIC8vIGNoYW5nZSBsb29wIGluZGV4IC0gbmVjZXNzYXJ5IGZvciB0YWlsd2luZGNzcyBwZWVyY2hlY2tlZCB0byB3b3JrIG90aGVyd2lzZSBub3QgaWYgbmFtZSBlbmRzIHdpdGggW11cbiAgICAgIC8vIGNsZWFuIGFuZCByZXNldCBldmVudHNcbiAgICAgIGNvbnN0IGVscyA9IGVsZW0ucXVlcnlTZWxlY3RvckFsbCgnaW5wdXQsIHNlbGVjdCwgbGFiZWwsIGRpdicpO1xuICAgICAgZWxzLmZvckVhY2goKGVsKSA9PiB7XG4gICAgICAgIGlmICghZWwuZGF0YXNldC5oYXNPd25Qcm9wZXJ0eSgncmVhZG5seScpKSBlbC5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgICBpZiAobiAhPT0gbnVsbCkgeyAvLyBjaGFuZ2UgbmFtZXMgYW5kIGlkIHdoZW4gYWRkaW5nIGEgbmV3IHJvdyAtIG5vdCBpZiBjbGVhciBvbmx5XG4gICAgICAgICAgbm4gPSAobm4gPT09IG51bGwpID8gbiArIDEgOiBubjtcbiAgICAgICAgICBlbCA9IHRoaXMuaW5kZXhFbGVtZW50KGVsLCBuLCBubik7XG4gICAgICAgIH1cbiAgICAgICAgc3dpdGNoIChlbC50YWdOYW1lLnRvTG93ZXJDYXNlKCkpIHtcbiAgICAgICAgICBjYXNlICdpbnB1dCc6XG4gICAgICAgICAgICBlbC5jaGVja2VkID0gZmFsc2U7XG4gICAgICAgICAgICAvLyBkaXNhYmxlIGNvbnRhY3QgYXMgcHJpdmlsZWdlIGlzIGVtcHR5XG4gICAgICAgICAgICBpZiAoZWwubmFtZSA9PSB0aGlzLm9wdGlvbnMuY29udGFjdGZpZWxkbmFtZSkge1xuICAgICAgICAgICAgICBlbC52YWx1ZSA9IFwiMFwiO1xuICAgICAgICAgICAgICBlbC5kaXNhYmxlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlICdzZWxlY3QnOlxuICAgICAgICAgICAgLy8gcmVtb3ZlIG9wdGlvbnMgZXhjZXB0IHRoZSBmaXJzdCBvbmUgd2l0aCBzZWxlY3RcbiAgICAgICAgICAgIEFycmF5LmZyb20oZWwub3B0aW9ucykuZm9yRWFjaChvcHRpb24gPT4ge1xuICAgICAgICAgICAgICBpZiAocGFyc2VJbnQob3B0aW9uLnZhbHVlKSA+IDApIG9wdGlvbi5yZW1vdmUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy8gdG9kbyBzaG91bGtkIGhhdmUgYmVlbiByZW1vdmVkXG4gICAgICAgICAgICBlbC5zZWxlY3RlZEluZGV4ID0gMDtcbiAgICAgICAgICAgIGlmICghZWwudG9tc2VsZWN0KSB7XG4gICAgICAgICAgICAgIFsndG9tLXNlbGVjdCcsICd0b21zZWxlY3RlZCcsICd0cy1oaWRkZW4tYWNjZXNzaWJsZSddLmZvckVhY2goY2wgPT4ge1xuICAgICAgICAgICAgICAgIGVsLmNsYXNzTGlzdC5yZW1vdmUoY2wpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSBlbC50b21zZWxlY3QuZGVzdHJveSgpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSAnZGl2JzpcbiAgICAgICAgICAgIGlmIChuICE9PSBudWxsICYmIGVsLmRhdGFzZXQuY29tcG9uZW50KSBlbC5yZW1vdmUoKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgIH0pXG5cbiAgICB9KVxuICAgIC8qIGFkZCBmdW5jdGlvbm5hbGl0aWVzICovXG4gICAgaWYgKHNlcGFyKSB7XG4gICAgICBsaW5lLmNsYXNzTGlzdC5hZGQoJ25ldycpO1xuICAgICAgc2VwYXIuYWZ0ZXIobGluZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGxpbmU7XG4gIH1cblxuICBzZXRMaW5lKGxpbmUsIG1iID0ge1xuICAgIGtleTogJycsXG4gICAgdmFsdWU6ICcnXG4gIH0sIHByaXYsIGN0KSB7XG5cbiAgICBwcml2ID0gZGVmaW5lZF9wcml2aWxlZ2VzW3ByaXZdID8gZGVmaW5lZF9wcml2aWxlZ2VzW3ByaXZdIDogZGVmaW5lZF9wcml2aWxlZ2VzLnZpZXdlcnM7XG4gICAgaWYgKCFwcml2KSByZXR1cm47XG4gICAgY29uc3Qge1xuICAgICAgbWVtYmVyLFxuICAgICAgcHJpdnMsXG4gICAgICBjb250YWN0LFxuICAgICAgZGVsZXRcbiAgICB9ID0gdGhpcy5nZXRJbnB1dHMobGluZSwgcHJpdik7XG5cbiAgICBpZiAoIW1lbWJlciB8fCAhcHJpdnMgfHwgIWNvbnRhY3QgfHwgIWRlbGV0KSByZXR1cm47XG4gICAgLy8gc2FuaXRpemVcbiAgICBtYi5rZXkgPSBET01QdXJpZnkuc2FuaXRpemUobWIua2V5KTtcbiAgICBtYi52YWx1ZSA9IERPTVB1cmlmeS5zYW5pdGl6ZShtYi52YWx1ZSk7XG5cbiAgICBsZXQgb3B0aW9uID0gbWVtYmVyLnF1ZXJ5U2VsZWN0b3IoJ29wdGlvblt2YWx1ZT1cIicgKyBtYi5rZXkgKyAnXCJdJyk7XG4gICAgaWYgKG9wdGlvbiA9PT0gbnVsbCkge1xuICAgICAgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XG4gICAgICBvcHRpb24udmFsdWUgPSBtYi5rZXk7XG4gICAgICBvcHRpb24udGV4dCA9IG1iLnZhbHVlO1xuICAgICAgbWVtYmVyLmFwcGVuZChvcHRpb24pO1xuICAgIH1cbiAgICBvcHRpb24uc2VsZWN0ZWQgPSB0cnVlO1xuICAgIGlmICghbWVtYmVyLnRvbXNlbGVjdCkge1xuICAgICAgSnNUb21TZWxlY3QuYXBwbHlUbyhtZW1iZXIpO1xuICAgIH1cbiAgICBwcml2cy5jaGVja2VkID0gdHJ1ZTtcbiAgICBjb250YWN0LnZhbHVlID0gbWIua2V5O1xuICAgIGlmIChwcml2ID09PSByaWdodHMubWFuYWdlKSB7XG4gICAgICBjb250YWN0LmRpc2FibGVkID0gZmFsc2U7XG4gICAgICBpZiAoY3QgPT09IHRydWUgJiYgIWNvbnRhY3QuY2hlY2tlZCkgY29udGFjdC5jaGVja2VkID0gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29udGFjdC5kaXNhYmxlZCA9IHRydWU7XG4gICAgICBjb250YWN0LmNoZWNrZWQgPSBmYWxzZTtcbiAgICB9XG5cbiAgfVxuICBnZXRJbnB1dHMobGluZSwgcHJpdiA9IGZhbHNlKSB7XG4gICAgY29uc3QgbWVtYmVyID0gbGluZS5xdWVyeVNlbGVjdG9yKFwiW25hbWUqPSdbXCIgKyB0aGlzLm9wdGlvbnMuaWRlbnQgKyBcIl0nXVwiKTtcbiAgICBsZXQgcHJpdnM7XG4gICAgaWYgKHByaXYpIHtcbiAgICAgIHByaXZzID0gbGluZS5xdWVyeVNlbGVjdG9yKCdpbnB1dFtuYW1lKj1cIlsnICsgdGhpcy5vcHRpb25zLnByaXZpbGVnZSArICddXCJdW3ZhbHVlPVwiJyArIHByaXYgKyAnXCJdJyk7XG4gICAgfSBlbHNlIHByaXZzID0gbGluZS5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dFtuYW1lKj1cIlsnICsgdGhpcy5vcHRpb25zLnByaXZpbGVnZSArICddXCJdJyk7XG4gICAgY29uc3QgY29udGFjdCA9IGxpbmUucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZT1cIicgKyB0aGlzLm9wdGlvbnMuY29udGFjdGZpZWxkbmFtZSArICdcIl0nKTtcbiAgICBjb25zdCBkZWxldCA9IGxpbmUucXVlcnlTZWxlY3RvcihcImlucHV0W25hbWUqPSdbXCIgKyB0aGlzLm9wdGlvbnMuZGVsZXQgKyBcIl0nXVwiKTtcbiAgICByZXR1cm4ge1xuICAgICAgbWVtYmVyOiBtZW1iZXIsXG4gICAgICBwcml2czogcHJpdnMsXG4gICAgICBjb250YWN0OiBjb250YWN0LFxuICAgICAgZGVsZXQ6IGRlbGV0XG4gICAgfTtcbiAgfVxuICBhc3luYyBpbXBvcnRQcml2aWxlZ2VzKHByaXZpbGVnZXMsIHJlcGxhY2UgPSBmYWxzZSwgY29udGFjdCA9IG51bGwsIGltcG9ydGVkdGFnID0gbnVsbCwgZGlzbWlzcyA9IG51bGwpIHtcbiAgICBpZiAocmVwbGFjZSA9PT0gdHJ1ZSkgdGhpcy5jbGVhckFsbCgpO1xuICAgIHRyeSB7XG4gICAgICBPYmplY3QuZW50cmllcyhwcml2aWxlZ2VzKS5mb3JFYWNoKChbcHJpdiwgbWVtYmVyc10pID0+IHtcbiAgICAgICAgbWVtYmVycy5mb3JFYWNoKChtZW1iZXIpID0+IHtcbiAgICAgICAgICBjb25zdCBsYXN0bGluZSA9IHRoaXMubmV3TGluZSh0cnVlLCBtZW1iZXIuaWQpO1xuICAgICAgICAgIGlmIChsYXN0bGluZSkge1xuICAgICAgICAgICAgdGhpcy5zZXRMaW5lKGxhc3RsaW5lLCB7XG4gICAgICAgICAgICAgIGtleTogbWVtYmVyLmlkLFxuICAgICAgICAgICAgICB2YWx1ZTogbWVtYmVyLm5hbWUsXG4gICAgICAgICAgICB9LCBwcml2LCAoY29udGFjdCAhPT0gbnVsbCAmJiAoY29udGFjdC5pZCA9PT0gbWVtYmVyLmlkKSkpO1xuICAgICAgICAgICAgaWYgKGltcG9ydGVkdGFnKSBpbXBvcnRlZHRhZyhsYXN0bGluZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJlcGxhY2UgPSBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIGlmIChkaXNtaXNzKSBkaXNtaXNzKCk7XG4gICAgICBBbGVydEJveC5kaXNtaXNzQWxlcnQodGhpcy5rZXltZXNzYWdlcy5pbXBvcnRwcml2ZXJyb3IpO1xuXG4gICAgICB0aGlzLm9yZGVyUm93cygpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBBbGVydEJveC5hZGRBbGVydCh7XG4gICAgICAgIHR5cGU6IEFsZXJ0Qm94LmFsZXJ0Y29uZmlnLnR5cGVzLmVycm9yLFxuICAgICAgICBjb250ZW50OiB0aGlzLmtleW1lc3NhZ2VzLmltcG9ydHByaXZlcnJvcixcbiAgICAgICAgZGlzbWlzc2libGU6IHRydWUsXG4gICAgICAgIGludmVyc2U6IHRydWVcbiAgICAgIH0pO1xuICAgICAgY29uc29sZS5sb2coJ2VycicsIGVycik7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG4gIGFjdGl2YXRlRXZlbnRzKGxpbmUsIHRzID0gZmFsc2UpIHtcbiAgICBpZiAoIWxpbmUpIHJldHVybjtcbiAgICBjb25zdCB7XG4gICAgICBtZW1iZXIsXG4gICAgICBwcml2cyxcbiAgICAgIGNvbnRhY3QsXG4gICAgICBkZWxldFxuICAgIH0gPSB0aGlzLmdldElucHV0cyhsaW5lKTtcbiAgICBpZiAoIW1lbWJlciB8fCAhcHJpdnMgfHwgIWNvbnRhY3QgfHwgIWRlbGV0KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3Qgc2libGluZ3MgPSBzID0+IFsuLi5zLnBhcmVudEVsZW1lbnQuY2hpbGRyZW5dLmZpbHRlcihjID0+IGMubm9kZVR5cGUgPT0gMSAmJiBjICE9IHMgJiYgYy5jbGFzc0xpc3QuY29udGFpbnMoJ3JvdycpICYmIGMuZGF0YXNldC5ibG9jayAhPT0gbnVsbCAmJiBjLmRhdGFzZXQuYmxvY2sgPT09IHRoaXMub3B0aW9ucy50YXJnZXQpO1xuICAgIC8vIGFjdGl2YXRlIHRvbSBzZWxlY3QgaWYgbmVlZGVkXG4gICAgLy8gZW5hYmxlL2Rpc2FibGUgY29udGFjdCB3aGVuIHByaXZpbGVnZSBjaGFuZ2VzXG4gICAgaWYgKCFtZW1iZXIuY3VycmVudGxpc3QpIG1lbWJlci5jdXJyZW50bGlzdCA9IHRoaXMuY3VycmVudGxpc3Q7XG4gICAgaWYgKG1lbWJlci52YWx1ZSAmJiAhdGhpcy5jdXJyZW50bGlzdFttZW1iZXIudmFsdWVdKSB0aGlzLmN1cnJlbnRsaXN0W21lbWJlci52YWx1ZV0gPSB0cnVlO1xuICAgIGlmICh0cyA9PT0gdHJ1ZSAmJiAhbWVtYmVyLnRvbXNlbGVjdCkge1xuICAgICAgSnNUb21TZWxlY3QuYXBwbHlUbyhtZW1iZXIpO1xuICAgIH1cbiAgICBjb25zdCBsaW5lU2V0dGluZ3MgPSAocHIsIGN0LCBkbCwgc3luY2hybyA9IGZhbHNlKSA9PiB7XG4gICAgICBpZiAocHIgJiYgcHIuY2hlY2tlZCkge1xuICAgICAgICBwci5jaGVja2VkID0gdHJ1ZTtcbiAgICAgICAgaWYgKEFsZXJ0Qm94Lmhhc01lc3NhZ2UobGluZSkpIEFsZXJ0Qm94LnJlbW92ZU1lc3NhZ2Uoe1xuICAgICAgICAgIHR5cGU6IEFsZXJ0Qm94LmFsZXJ0Y29uZmlnLnR5cGVzLmRhbmdlcixcbiAgICAgICAgICBwYXJlbnQ6IGxpbmUsXG4gICAgICAgICAgY29udGVudDogdGhpcy5rZXltZXNzYWdlcy51aGFzbm9wcml2XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgaWYgKHByICYmIHByLnZhbHVlID09PSByaWdodHMubWFuYWdlKSB7XG4gICAgICAgIC8vIG1hbmFnZXIgLSBjYW4ndCBkZWxldGUgbGluZSAtIGNhbiBjaG9vc2UgYXMgY29udGFjdFxuICAgICAgICBkbC5kaXNhYmxlZCA9IHRydWU7XG4gICAgICAgIGN0LmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgIEFsZXJ0Qm94LmRpc21pc3NBbGVydCh0aGlzLmtleW1lc3NhZ2VzLm5vbWFuYWdlcik7XG4gICAgICAgIGlmIChjdC5jaGVja2VkKSB7XG4gICAgICAgICAgQWxlcnRCb3guZGlzbWlzc0FsZXJ0KHRoaXMua2V5bWVzc2FnZXMubm9jb250YWN0KTtcbiAgICAgICAgICBjdC5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgndmFsaWQnKSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIG5vdCBtYW5hZ2VyIC0gY2FuIGRlbGV0IGxpbmUgLSBjYW5ub3QgY2hvc2UgYXMgY29udGFjdFxuICAgICAgICBjdC5jaGVja2VkID0gZmFsc2U7XG4gICAgICAgIGRsLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgIGN0LmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgaWYgKHN5bmNocm8gPT09IHRydWUpIHtcbiAgICAgICAgc3luY2hyb1NpYmxpbmdzKGxpbmUpO1xuICAgICAgfVxuICAgICAgLy8gZGlzbWlzcyBhbGVydHNcbiAgICAgIGlmICghZGwuY2tlY2tlZCkge1xuICAgICAgICBBbGVydEJveC5kaXNtaXNzQWxlcnQodGhpcy5rZXltZXNzYWdlcy5ub2JvZHkpO1xuICAgICAgICBpZiAoQWxlcnRCb3guaGFzTWVzc2FnZShsaW5lKSkgQWxlcnRCb3gucmVtb3ZlTWVzc2FnZSh7XG4gICAgICAgICAgdHlwZTogQWxlcnRCb3guYWxlcnRjb25maWcudHlwZXMuZGFuZ2VyLFxuICAgICAgICAgIHBhcmVudDogbGluZSxcbiAgICAgICAgICBjb250ZW50OiB0aGlzLmtleW1lc3NhZ2VzLm9uZWF0bGVhc3RcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICAgIGNvbnN0IHN5bmNocm9TaWJsaW5ncyA9IChsaW5lKSA9PiB7XG4gICAgICBjb25zdCBsbnMgPSBzaWJsaW5ncyhsaW5lKTtcbiAgICAgIGxucy5mb3JFYWNoKChsbikgPT4ge1xuICAgICAgICBjb25zdCBkbCA9IGxuLnF1ZXJ5U2VsZWN0b3IoXCJpbnB1dFtuYW1lKj0nW1wiICsgdGhpcy5vcHRpb25zLmRlbGV0ICsgXCJdJ11cIik7XG4gICAgICAgIGNvbnN0IGN0ID0gbG4ucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZT1cIicgKyB0aGlzLm9wdGlvbnMuY29udGFjdGZpZWxkbmFtZSArICdcIl0nKTtcbiAgICAgICAgY29uc3QgcHIgPSBsbi5xdWVyeVNlbGVjdG9yKCdpbnB1dFtuYW1lKj1cIlsnICsgdGhpcy5vcHRpb25zLnByaXZpbGVnZSArICddXCJdOmNoZWNrZWQnKTtcbiAgICAgICAgbGluZVNldHRpbmdzKHByLCBjdCwgZGwsIGZhbHNlKTtcblxuICAgICAgfSlcbiAgICB9XG5cbiAgICBtZW1iZXIuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKGUpID0+IHtcbiAgICAgIGNvbnRhY3QudmFsdWUgPSBtZW1iZXIudmFsdWU7XG4gICAgICBpZiAocGFyc2VJbnQobWVtYmVyLnZhbHVlKSA+IDAgJiYgQWxlcnRCb3guaGFzTWVzc2FnZShtZW1iZXIpKSBBbGVydEJveC5yZW1vdmVNZXNzYWdlKHtcbiAgICAgICAgdHlwZTogQWxlcnRCb3guYWxlcnRjb25maWcudHlwZXMuZGFuZ2VyLFxuICAgICAgICBwYXJlbnQ6IG1lbWJlcixcbiAgICAgICAgY29udGVudDogdGhpcy5rZXltZXNzYWdlcy5lbXB0eW5hbWVcbiAgICAgIH0pO1xuICAgIH0pXG4gICAgcHJpdnMuZm9yRWFjaCgocHJpdikgPT4ge1xuICAgICAgaWYgKHByaXYuZGF0YXNldC5oYXNPd25Qcm9wZXJ0eShcInJlYWRvbmx5XCIpKSBpbnB1dF9yZWFkX29ubHkocHJpdik7XG4gICAgICBwcml2LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIChlKSA9PiB7XG4gICAgICAgIGlmIChwcml2LmNoZWNrZWQpIGxpbmVTZXR0aW5ncyhwcml2LCBjb250YWN0LCBkZWxldCwgZmFsc2UpO1xuICAgICAgfSk7XG5cbiAgICAgIGlmIChwcml2LmNoZWNrZWQpIGxpbmVTZXR0aW5ncyhwcml2LCBjb250YWN0LCBkZWxldCwgZmFsc2UpO1xuICAgIH0pXG4gICAgaWYgKGNvbnRhY3QuZGF0YXNldC5oYXNPd25Qcm9wZXJ0eShcInJlYWRvbmx5XCIpKSBpbnB1dF9yZWFkX29ubHkoY29udGFjdCk7XG4gICAgY29udGFjdC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoZSkgPT4ge1xuICAgICAgaWYgKGNvbnRhY3QuY2hlY2tlZCkge1xuICAgICAgICBkZWxldC5kaXNhYmxlZCA9IHRydWU7XG4gICAgICB9IGVsc2UgZGVsZXQuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgIGNvbnN0IHByaXYgPSBsaW5lLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWUqPVwiWycgKyB0aGlzLm9wdGlvbnMucHJpdmlsZWdlICsgJ11cIl06Y2hlY2tlZCcpO1xuICAgICAgbGluZVNldHRpbmdzKHByaXYsIGNvbnRhY3QsIGRlbGV0LCB0cnVlKTtcbiAgICAgIC8vIGVuYWJsZSBvdGhlcndpc2VcbiAgICB9KVxuICAgIC8vIGRlbGV0IG9rIGZvciBhbGwgd2hlbiBuZXcgbGluZVxuICAgIC8vXG5cbiAgICBkZWxldC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAvLyBhdCBsZWFzdCBvbmUgcHJpdiBsaW5lXG4gICAgICBjb25zdCBkZWxldGxhYmVsID0gZGVsZXQuY2xvc2VzdCgnbGFiZWwnKTtcbiAgICAgIGNvbnN0IGxpbmVzID0gdGhpcy5maWVsZHNldC5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1ibG9jaz1cIicgKyB0aGlzLm9wdGlvbnMudGFyZ2V0ICsgJ1wiXTpub3QoW2RhdGEtbW9kPVwicmVtb3ZlXCJdKScpO1xuICAgICAgaWYgKGxpbmVzLmxlbmd0aCA8PSAxICYmIGUudGFyZ2V0LmNoZWNrZWQpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBsaW5lLnJlbW92ZUF0dHJpYnV0ZSgnZGF0YS1tb2QnKTtcbiAgICAgICAgbWVtYmVyLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgIGUudGFyZ2V0LmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgQWxlcnRCb3guYWRkTWVzc2FnZSh7XG4gICAgICAgICAgdHlwZTogQWxlcnRCb3guYWxlcnRjb25maWcudHlwZXMuZGFuZ2VyLFxuICAgICAgICAgIHBhcmVudDogbGluZSxcbiAgICAgICAgICBjb250ZW50OiB0aGlzLmtleW1lc3NhZ2VzLm9uZWF0bGVhc3QsXG4gICAgICAgICAgZHVyYXRpb246IDMwMDBcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH0gZWxzZSBpZiAoZS50YXJnZXQuY2hlY2tlZCkge1xuICAgICAgICBpZiAoQWxlcnRCb3guaGFzTWVzc2FnZShtZW1iZXIpKSBBbGVydEJveC5yZW1vdmVNZXNzYWdlKHtcbiAgICAgICAgICB0eXBlOiBBbGVydEJveC5hbGVydGNvbmZpZy50eXBlcy5kYW5nZXIsXG4gICAgICAgICAgcGFyZW50OiBtZW1iZXJcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChsaW5lLmNsYXNzTGlzdC5jb250YWlucygnbmV3JykpIHtcbiAgICAgICAgICBsaW5lLnJlbW92ZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChkZWxldGxhYmVsICYmIGRlbGV0bGFiZWwuZGF0YXNldC5yZXN0b3JlKSBkZWxldGxhYmVsLmRhdGFzZXQudGl0bGUgPSBkZWxldGxhYmVsLmRhdGFzZXQucmVzdG9yZTtcbiAgICAgICAgICBsaW5lLnNldEF0dHJpYnV0ZSgnZGF0YS1tb2QnLCAncmVtb3ZlJyk7XG4gICAgICAgICAgcHJpdnMuZm9yRWFjaChwcml2ID0+IHtcbiAgICAgICAgICAgIHByaXYuZGF0YXNldC5jaGVja2VkID0gcHJpdi5jaGVja2VkO1xuICAgICAgICAgICAgcHJpdi5jaGVja2VkID0gZmFsc2U7XG4gICAgICAgICAgICBwcml2LmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIGNvbnRhY3QuY2hlY2tlZCA9IGZhbHNlO1xuICAgICAgICAgIGNvbnRhY3QuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICAgIG1lbWJlci5kaXNhYmxlZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChkZWxldGxhYmVsICYmIGRlbGV0bGFiZWwuZGF0YXNldC5yZW1vdmUpIGRlbGV0bGFiZWwuZGF0YXNldC50aXRsZSA9IGRlbGV0bGFiZWwuZGF0YXNldC5yZW1vdmU7XG4gICAgICAgIGxpbmUucmVtb3ZlQXR0cmlidXRlKCdkYXRhLW1vZCcpO1xuICAgICAgICBwcml2cy5mb3JFYWNoKHByaXYgPT4ge1xuICAgICAgICAgIHByaXYuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgICBpZiAocHJpdi5kYXRhc2V0LmNoZWNrZWQgPT09IFwidHJ1ZVwiKSBwcml2LmNoZWNrZWQgPSB0cnVlO1xuICAgICAgICAgIGVsc2UgcHJpdi5jaGVja2VkID0gZmFsc2U7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIG1lbWJlci5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgfVxuICAgIH0pO1xuICAgIC8vIGRlbGV0IG1vdXNlb3ZlciAtIGV4cGxhaW4gd2h5IGl0IGlzIGRpc2FibGVkIHdoZW4gbWFuYWdlIGlzIGNoZWNrZWRcbiAgICBkZWxldC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW92ZXInLCAoZSkgPT4ge1xuICAgICAgaWYgKGUudGFyZ2V0LmRpc2FibGVkKSB7XG4gICAgICAgIGxldCBwciA9IGxpbmUucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZSo9XCJbJyArIHRoaXMub3B0aW9ucy5wcml2aWxlZ2UgKyAnXVwiXTpjaGVja2VkJyk7XG4gICAgICAgIGlmICghcHIpIHJldHVybjtcbiAgICAgICAgcHIgPSBwci52YWx1ZS50b0xvd2VyQ2FzZSgpXG4gICAgICAgIGUudGFyZ2V0LmRhdGFzZXQudGl0bGUgPSAoZS50YXJnZXQuZGF0YXNldFtwcl0pID8gZS50YXJnZXQuZGF0YXNldFtwcl0gOiBlLnRhcmdldC5kYXRhc2V0LnRpdGxlXG4gICAgICB9XG4gICAgfSlcbiAgICAvLyBkaXNhYmxlIGRlbGV0IGlmIHVzZXIgaXMgdGhlIG9ubHkgbWFuYWdlclxuICAgIGlmICh0aGlzLmN1cnJlbnRfdWlkID09PSBtZW1iZXIudmFsdWUpIGRlbGV0LmRpc2FibGVkID0gdHJ1ZTtcbiAgfVxuXG4gIHZhbGlkYXRlRmllbGRzKGFkZCA9IGZhbHNlKSB7IC8vIGNoZWNrIG1hbmFnZXJzIGFuZCBjb250YWN0X3VzZXJfaWQgb24gc3VibWl0XG4gICAgY29uc3QgY2hlY2tfY29udGFjdCA9ICgpID0+IHtcbiAgICAgIC8vIGNoZWNrIGlmIG9uZSBtYW5hZ2VyIGF0IGxlYXN0XG4gICAgICBjb25zdCBtYW5hZ2VycyA9IHRoaXMuZmllbGRzZXQucXVlcnlTZWxlY3RvckFsbCgnW25hbWUqPVwiWycgKyB0aGlzLm9wdGlvbnMucHJpdmlsZWdlICsgJ11cIl1bdmFsdWU9XCInICsgcmlnaHRzLm1hbmFnZSArICdcIl06Y2hlY2tlZCcpO1xuICAgICAgaWYgKG1hbmFnZXJzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBBbGVydEJveC5hZGRBbGVydCh7XG4gICAgICAgICAgdHlwZTogQWxlcnRCb3guYWxlcnRjb25maWcudHlwZXMuZGFuZ2VyLFxuICAgICAgICAgIGNvbnRlbnQ6IHRoaXMua2V5bWVzc2FnZXMubm9tYW5hZ2VyLFxuICAgICAgICAgIGRpc21pc3NpYmxlOiB0cnVlLFxuICAgICAgICAgIGludmVyc2U6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMudGFiRXJyb3IodHJ1ZSk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIEFsZXJ0Qm94LmRpc21pc3NBbGVydCh0aGlzLmtleW1lc3NhZ2VzLm5vbWFuYWdlcik7XG4gICAgICAgIHRoaXMudGFiRXJyb3IoZmFsc2UpO1xuICAgICAgfVxuICAgICAgLy8gY2hlY2sgY29udGFjdFxuXG4gICAgICBjb25zdCBjb250YWN0ID0gdGhpcy5maWVsZHNldC5xdWVyeVNlbGVjdG9yKCdbbmFtZT1cIicgKyB0aGlzLm9wdGlvbnMuY29udGFjdGZpZWxkbmFtZSArICdcIl06Y2hlY2tlZCcpO1xuICAgICAgaWYgKGNvbnRhY3QgPT09IG51bGwpIHtcbiAgICAgICAgQWxlcnRCb3guYWRkQWxlcnQoe1xuICAgICAgICAgIHR5cGU6IEFsZXJ0Qm94LmFsZXJ0Y29uZmlnLnR5cGVzLmRhbmdlcixcbiAgICAgICAgICBjb250ZW50OiB0aGlzLmtleW1lc3NhZ2VzLm5vY29udGFjdCxcbiAgICAgICAgICBkaXNtaXNzaWJsZTogdHJ1ZSxcbiAgICAgICAgICBpbnZlcnNlOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnRhYkVycm9yKHRydWUpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBBbGVydEJveC5kaXNtaXNzQWxlcnQodGhpcy5rZXltZXNzYWdlcy5ub2NvbnRhY3QpO1xuICAgICAgdGhpcy50YWJFcnJvcihmYWxzZSk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgY29uc3QgaGFzX21lbWJlciA9IChtZW1iZXIpID0+IHtcbiAgICAgICAgcmV0dXJuIChtZW1iZXIudmFsdWUgJiYgcGFyc2VJbnQobWVtYmVyLnZhbHVlKT4wKTtcbiAgICB9XG4gICAgY29uc3QgaGFzX3ByaXYgPSAobGluZSkgPT4ge1xuICAgICAgY29uc3QgcHJpdiA9IGxpbmUucXVlcnlTZWxlY3RvcignW25hbWUqPVwiWycgKyB0aGlzLm9wdGlvbnMucHJpdmlsZWdlICsgJ11cIl06Y2hlY2tlZCcpO1xuICAgICAgaWYgKHByaXYgJiYgcHJpdi52YWx1ZSkgcmV0dXJuIHRydWU7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbnN0IGxpbmVzID0gdGhpcy5maWVsZHNldC5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1ibG9jaz1cIicgKyB0aGlzLm9wdGlvbnMudGFyZ2V0ICsgJ1wiXScpO1xuICAgIGxldCBuID0gbGluZXMubGVuZ3RoO1xuICAgIGxldCB2ZXJpZiA9IHRydWU7XG4gICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7XG4gICAgICBjb25zdCBtZW1iZXIgPSBsaW5lLnF1ZXJ5U2VsZWN0b3IoJ1tuYW1lKj1cIlsnICsgdGhpcy5vcHRpb25zLmlkZW50ICsgJ11cIl0nKTtcbiAgICAgIGlmIChsaW5lLmRhdGFzZXQuaGFzT3duUHJvcGVydHkoXCJtb2RlbFwiKSB8fCBsaW5lLmRhdGFzZXQubW9kICYmIGxpbmUuZGF0YXNldC5tb2QgPT09ICdyZW1vdmUnKSB7XG4gICAgICAgIGlmIChuID4gMSkge1xuICAgICAgICAgIGxpbmUucmVtb3ZlKCk7XG4gICAgICAgICAgbi0tO1xuICAgICAgICB9IGVsc2UgcmV0dXJuIGZhbHNlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgIGlmICghaGFzX21lbWJlcihtZW1iZXIpKSB7XG4gICAgICAgIEFsZXJ0Qm94LmFkZE1lc3NhZ2Uoe1xuICAgICAgICAgIHR5cGU6IEFsZXJ0Qm94LmFsZXJ0Y29uZmlnLnR5cGVzLmRhbmdlcixcbiAgICAgICAgICBwYXJlbnQ6IG1lbWJlcixcbiAgICAgICAgICBjb250ZW50OiB0aGlzLmtleW1lc3NhZ2VzLmVtcHR5bmFtZVxuICAgICAgICB9KTtcbiAgICAgICAgbWVtYmVyLmZvY3VzKCk7XG4gICAgICAgIGNvbnN0IHJlc3AgPSBmYWxzZTsgLy8gbm8gY29uZmltYm94IGp1c3Qgd2FpdCBmb3IgdXNlciBhY3Rpb25cbiAgICAgICAgLy8gY2FsbGJhY2sgaWYgY29uZmlybWJveCByZXNwb25zZSBpcyBjaG9zZW4gaWYgJ2NvbmZpcm0nXG4gICAgICAgIGlmIChyZXNwID09PSB0cnVlKSB7XG4gICAgICAgICAgaWYgKG4gPiAxKSB7XG4gICAgICAgICAgICBsaW5lLnJlbW92ZSgpO1xuICAgICAgICAgICAgbi0tO1xuICAgICAgICAgIH0gZWxzZSByZXR1cm4gZmFsc2U7XG4gICAgICAgIH0gZWxzZSByZXR1cm4gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIGlmICghaGFzX3ByaXYobGluZSkpIHtcbiAgICAgICAgQWxlcnRCb3guYWRkTWVzc2FnZSh7XG4gICAgICAgICAgdHlwZTogQWxlcnRCb3guYWxlcnRjb25maWcudHlwZXMuZGFuZ2VyLFxuICAgICAgICAgIHBhcmVudDogbGluZSxcbiAgICAgICAgICBjb250ZW50OiB0aGlzLmtleW1lc3NhZ2VzLnVoYXNub3ByaXZcbiAgICAgICAgfSk7XG4gICAgICAgIHZlcmlmID0gZmFsc2U7XG4gICAgICB9ICBlbHNlIGlmIChBbGVydEJveC5oYXNNZXNzYWdlKGxpbmUpKSB7XG4gICAgICAgIEFsZXJ0Qm94LnJlbW92ZU1lc3NhZ2Uoe1xuICAgICAgICAgIHR5cGU6IEFsZXJ0Qm94LmFsZXJ0Y29uZmlnLnR5cGVzLmRhbmdlcixcbiAgICAgICAgICBwYXJlbnQ6IGxpbmUsXG4gICAgICAgICAgY29udGVudDogdGhpcy5rZXltZXNzYWdlcy51aGFzbm9wcml2XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBpZiAobiA9PT0gMCkge1xuICAgICAgQWxlcnRCb3guYWRkQWxlcnQoe1xuICAgICAgICB0eXBlOiBBbGVydEJveC5hbGVydGNvbmZpZy50eXBlcy5kYW5nZXIsXG4gICAgICAgIGNvbnRlbnQ6IHRoaXMua2V5bWVzc2FnZXMubm9ib2R5LFxuICAgICAgICBkaXNtaXNzaWJsZTogdHJ1ZSxcbiAgICAgICAgaW52ZXJzZTogdHJ1ZVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSBlbHNlIEFsZXJ0Qm94LmRpc21pc3NBbGVydCh0aGlzLmtleW1lc3NhZ2VzLm5vYm9keSk7XG4gICAgY29uc3QgaGFzY29udGFjdCA9IHRoaXMuZmllbGRzZXQuZGF0YXNldC5oYXNPd25Qcm9wZXJ0eShcInJlYWRvbmx5XCIpIHx8IGNoZWNrX2NvbnRhY3QoKTtcbiAgICByZXR1cm4gKGhhc2NvbnRhY3QgJiYgdmVyaWYpO1xuICB9XG5cbiAgZm9ybWF0UHJpdmlsZWdlcygpIHtcbiAgICBjb25zdCBsaW5lcyA9IHRoaXMuZmllbGRzZXQucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtYmxvY2s9XCInICsgdGhpcy5vcHRpb25zLnRhcmdldCArICdcIl0nKTtcbiAgICBjb25zdCBmb3JtYXRfcHJpdmlsZWdlID0gKGxpbmUpID0+IHtcbiAgICAgIGNvbnN0IGVscyA9IGxpbmUucXVlcnlTZWxlY3RvckFsbCgnW25hbWUqPVwibWVtYmVyc1tcIicpO1xuICAgICAgZWxzLmZvckVhY2goKGVsKSA9PiB7XG4gICAgICAgIGxldCBuYW1lID0gZWwubmFtZTtcbiAgICAgICAgbmFtZSA9IG5hbWUuc3BsaXQoJ1snKTtcbiAgICAgICAgbmFtZS5wb3AoKTtcbiAgICAgICAgZWwubmFtZSA9IG5hbWUuam9pbignWycpO1xuICAgICAgICBpZiAoZWwubmFtZS5pbmRleE9mKCdbJyArIHRoaXMub3B0aW9ucy5wcml2aWxlZ2UgKyAnXScpID4gMCkge1xuICAgICAgICAgIGVsLnR5cGUgPSAnY2hlY2tib3gnO1xuICAgICAgICAgIGVsLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpO1xuICAgICAgICB9XG5cbiAgICAgIH0pO1xuICAgIH1cbiAgICBsaW5lcy5mb3JFYWNoKGxpbmUgPT4ge1xuICAgICAgZm9ybWF0X3ByaXZpbGVnZShsaW5lKTtcbiAgICB9KTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG5cbiAgZ2V0TGluZVByaXZpbGVnZShpZCkge1xuICAgIGxldCBwcml2aWxlZ2UgPSBudWxsO1xuICAgIGNvbnN0IGxpbmVzID0gdGhpcy5maWVsZHNldC5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1ibG9jaz1cIicgKyB0aGlzLm9wdGlvbnMudGFyZ2V0ICsgJ1wiXScpXG4gICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7XG4gICAgICBpZiAocGFyc2VJbnQobGluZS5xdWVyeVNlbGVjdG9yKCdbbmFtZSo9XCJbJyArIHRoaXMub3B0aW9ucy5pZGVudCArICddXCJdJykudmFsdWUpID09PSBwYXJzZUludChpZCkpIHtcbiAgICAgICAgcHJpdmlsZWdlID0gbGluZTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHByaXZpbGVnZTtcbiAgfVxuICBjbGVhckFsbCgpIHtcbiAgICBsZXQgbGluZXMgPSB0aGlzLmZpZWxkc2V0LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLWJsb2NrPVwiJyArIHRoaXMub3B0aW9ucy50YXJnZXQgKyAnXCJdJyk7XG4gICAgbGluZXMuZm9yRWFjaCgobGluZSwgaW5kZXgpID0+IHtcbiAgICAgIGxpbmUucmVtb3ZlKCk7XG4gICAgfSk7XG5cbiAgfVxuICBvcmRlclJvd3MoKSB7XG4gICAgY29uc3QgbGluZXMgPSBBcnJheS5mcm9tKHRoaXMuZmllbGRzZXQucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtYmxvY2s9XCInICsgdGhpcy5vcHRpb25zLnRhcmdldCArICdcIl0nKSk7XG4gICAgaWYgKGxpbmVzLmxlbmd0aCA+IDIpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHJpZ2h0c3NvcnRlZCA9IE9iamVjdC52YWx1ZXMocmlnaHRzKTtcbiAgICAgICAgbGluZXMuc29ydCgobGluZWEsIGxpbmViKSA9PiB7XG4gICAgICAgICAgY29uc3QgYSA9IHRoaXMuZ2V0SW5wdXRzKGxpbmVhKTtcbiAgICAgICAgICBjb25zdCBiID0gdGhpcy5nZXRJbnB1dHMobGluZWIpO1xuICAgICAgICAgIGNvbnN0IG5hbWViID0gbmV3IFN0cmluZyhiLm1lbWJlci5vcHRpb25zW2IubWVtYmVyLnNlbGVjdGVkSW5kZXhdLnRleHQpLnRvTG93ZXJDYXNlKCkuc3BsaXQoJyAnKVxuICAgICAgICAgIGNvbnN0IG5hbWVhID0gbmV3IFN0cmluZyhhLm1lbWJlci5vcHRpb25zW2EubWVtYmVyLnNlbGVjdGVkSW5kZXhdLnRleHQpLnRvTG93ZXJDYXNlKCkuc3BsaXQoJyAnKTtcbiAgICAgICAgICBjb25zdCBwcml2YSA9IEFycmF5LmZyb20oYS5wcml2cykuZmlsdGVyKHByaXYgPT4gKHByaXYuY2hlY2tlZCkpO1xuICAgICAgICAgIGNvbnN0IHByaXZiID0gQXJyYXkuZnJvbShiLnByaXZzKS5maWx0ZXIocHJpdiA9PiAocHJpdi5jaGVja2VkKSk7XG4gICAgICAgICAgY29uc3QgY29tcGEgPSAoKyFhLmNvbnRhY3QuY2hlY2tlZCkgKyBgIGAgKyByaWdodHNzb3J0ZWQuaW5kZXhPZigoKHByaXZhLmxlbmd0aCkgPyBwcml2YVswXS52YWx1ZSA6IG51bGwpKSArIGAgYCArICgobmFtZWEubGVuZ3RoID4gMSkgPyBuYW1lYS5wb3AoKSArIGAgYCArIG5hbWVhWzBdIDogbmFtZWFbMF0pO1xuICAgICAgICAgIGNvbnN0IGNvbXBiID0gKCshYi5jb250YWN0LmNoZWNrZWQpICsgYCBgICsgcmlnaHRzc29ydGVkLmluZGV4T2YoKChwcml2Yi5sZW5ndGgpID8gcHJpdmJbMF0udmFsdWUgOiBudWxsKSkgKyBgIGAgKyAoKG5hbWViLmxlbmd0aCA+IDEpID8gbmFtZWIucG9wKCkgKyBgIGAgKyBuYW1lYlswXSA6IG5hbWViWzBdKTtcbiAgICAgICAgICBpZiAoY29tcGIgPiBjb21wYSkgcmV0dXJuIC0xO1xuICAgICAgICAgIGVsc2UgaWYgKGNvbXBhID4gY29tcGIpIHJldHVybiAxO1xuICAgICAgICAgIGVsc2UgcmV0dXJuIDA7XG4gICAgICAgIH0pXG4gICAgICAgIGNvbnN0IGNsb25lID0gdGhpcy5saW5lY29udGFpbmVyO1xuICAgICAgICBsaW5lcy5mb3JFYWNoKChsaW5lLCBpKSA9PiB7XG4gICAgICAgICAgY2xvbmUuYXBwZW5kQ2hpbGQobGluZSk7XG4gICAgICAgIH0pO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdlcnIgbm90IHNvcnRlZCcsIGVycik7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgdGFiRXJyb3Iob24pIHtcbiAgICBjb25zdCB0YWIgPSAodGhpcy5maWVsZHNldC5jbGFzc0xpc3QuY29udGFpbnMoZG9tc2VsZWN0b3JzLmNvbXBvbmVudC50YWJzLnRhYi5zdWJzdHIoMSkpKSA/IHRoaXMuZmllbGRzZXQgOiAoKHRoaXMuZmllbGRzZXQucGFyZW50RWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoZG9tc2VsZWN0b3JzLmNvbXBvbmVudC50YWJzLnRhYi5zdWJzdHIoMSkpKSA/IHRoaXMuZmllbGRzZXQucGFyZW50RWxlbWVudCA6IG51bGwpO1xuICAgIGlmICh0YWIgPT09IG51bGwpIHJldHVybjtcbiAgICBpZiAob24gPT09IHRydWUpIHRhYi5jbGFzc0xpc3QuYWRkKGNzcy5lcnJvcik7XG4gICAgZWxzZSB0YWIuY2xhc3NMaXN0LnJlbW92ZShjc3MuZXJyb3IpO1xuICB9XG59Il0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/modules/project-privileges.js\n")}}]);