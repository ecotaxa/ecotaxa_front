/*! For license information please see src_modules_js-my-files_js.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["src_modules_js-my-files_js"],{"./src/modules/js-my-files.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   JsMyFiles: () => (/* binding */ JsMyFiles)\n/* harmony export */ });\n/* harmony import */ var _modules_utils_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../modules/utils.js */ \"./src/modules/utils.js\");\n/* harmony import */ var _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../modules/modules-config.js */ \"./src/modules/modules-config.js\");\n\n\n\nconst accept = '.tsv,.png,.jpg, .jpeg,.zip,.gz,.7z,.bz2';\nconst localcss = {\n  mright: 'mr-4',\n}\nconst dirseparator = \"/\";\nclass JsMyFiles {\n  done = true;\n  jsDirToZip = null;\n  counters = {};\n  _events = {};\n  eventnames = {\n    complete: 'complete',\n    error: 'error',\n  }\n  constructor(container, options = {}) {\n    if (!container.jsmyfiles) {\n      container = (container instanceof HTMLElement) ? container : document.querySelector(container);\n      if (!container) return;\n      (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.dom_purify)(container, 'dataset');\n      this.container = container;\n      console.log(\"/gui/files/list\")\n      const defaultOptions = {\n\n        url: \"/gui/files/list\",\n        compress: {\n          label: 'compress'\n        },\n        controls: {\n          scan: {\n            display: {\n              counter: 'counter',\n              size: 'size',\n            }\n          },\n          zip: {\n            btn: {\n              zip: 'makezip',\n              zipped: 'makezipped'\n            },\n            display: {\n              size: 'sizezipped',\n              counter: 'counterzipped',\n            }\n          },\n\n        },\n        upload: {\n          label: 'upload'\n        },\n        btnprefix: 'btn',\n        btnfilelist: null,\n        selector: {\n          doupload: '.target-upload',\n          droptarget: '.droptarget',\n          trigger: '.trigger',\n          entries: '.entries',\n          dirlist: '.dirlist',\n          uploadfile: 'uploadfile',\n          displayresult: 'results',\n        },\n        entrycontrols: {\n          selector: '.entrycontrols',\n          url: 'gui/me/my_files/',\n          controls: [{\n              action: 'newfolder',\n              text: 'new folder',\n              icon: 'icon-folder-plus-sm',\n              typentry: 'entryD'\n            }, {\n              action: 'rename',\n              text: 'rename',\n              icon: 'icon-pencil-sm'\n            },\n            {\n              action: 'delete',\n              text: 'delete',\n              icon: 'icon-trash-sm'\n            },\n          ]\n        },\n        display: {\n          progression: 'display-progression',\n          dropzone: 'dropzone',\n          boxtitle: 'boxtitle',\n          counters: 'counters',\n          sizes: 'sizes',\n          timers: 'timers'\n        },\n\n      };\n      this.options = Object.assign(defaultOptions, options);\n      this.init();\n      container.jsmyfiles = this;\n    }\n    return container.jsmyfiles;\n  }\n  init() {\n    // create dirlist box\n    this.addDropzone();\n    this.addDisplayProgression();\n    this.addDirList();\n    this.initEvents();\n  }\n  initTimer() {\n    this.timer = new Date();\n  }\n  initEvents() {\n    (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.add_custom_events)(this);\n\n    //To be refactored - for steppers )\n    this.on(this.eventnames.processed, async (e) => {\n      if (this.nextaction) await this.nextaction();\n    })\n    // alerts on error\n    this.on(this.eventnames.error, (e) => {\n      console.log('scandir receive error message', e)\n      if (window.alertbox) {\n        window.alertbox.renderAlert({\n          type: window.alertbox.alertconfig.types.error,\n          content: e,\n          inverse: true,\n          dismissible: true\n        });\n      }\n    })\n    window.addEventListener('beforeunload', (e) => {\n      if (!this.done) {\n        e.preventDefault();\n        e.returnValue = (this.options.preventclose) ? this.options.preventclose : `Some work is in progress in this window.\\nAre you sure you want to leave?`;\n      }\n\n\n    });\n  }\n  addDropzone() { //\n    this.dropzone = document.createElement('div');\n    this.dropzone.id = this.options.display.dropzone;\n    this.dropzone.innerHTML = `<input type=\"file\" class=\"hidden\"  name=\"${this.options.selector.uploadfile}\" id=\"${this.options.selector.uploadfile}\">\n            <div class=\"${this.options.selector.droptarget.substr(1)}\">\n            <div class=\"${this.options.display.boxtitle}\"><span class=\"${this.options.selector.trigger.slice(1)}\">${this.container.dataset.textbrowse}</span>  ${this.container.dataset.textdrop}</div>\n          </div>`;\n    this.container.append(this.dropzone);\n    this.setDropTarget(this.dropzone.querySelector(this.options.selector.droptarget));\n    this.container.querySelector(this.options.selector.trigger).addEventListener('click', async (e) => {\n      this.handleBrowse();\n    });\n  }\n  setDropTarget(droptarget) {\n    const dropclass = this.options.selector.droptarget.substr(1);\n    const target_dragover = (e) => {\n      this.handleDragOver(e);\n    }\n    const target_drop = async (e) => {\n      this.handleDrop(e);\n    }\n    // set events and css for new dropzone\n    if (!this.droptarget || this.droptarget != droptarget) {\n      if (this.droptarget) {\n        this.droptarget.removeEventListener('dragover', target_dragover);\n        this.droptarget.removeEventListener('drop', target_drop);\n        this.droptarget.classList.remove(dropclass);\n      }\n      this.droptarget = droptarget;\n      this.droptarget.addEventListener('dragover', target_dragover);\n      this.droptarget.addEventListener('drop', target_drop);\n      this.droptarget.classList.add(dropclass);\n    }\n  }\n  async addDirList(source = null) {\n    let el = this.container.querySelector(this.options.selector.dirlist);\n    console.log('el dirlist', el)\n    if (!el) {\n      el = document.createElement('div');\n      el.classList.add(this.options.selector.dirlist.substr(1));\n      this.container.append(el);\n      this.displaylist = el;\n    }\n    this.serverList();\n  }\n  addDisplayProgression() {\n    // add counters\n    if (this.displayprogression) return;\n    let el = document.getElementById(this.options.display.progression);\n    if (!el) {\n      console.log('counterscreate')\n      el = document.createElement('div');\n      el.id = this.options.display.progression;\n      el.innerHTML = `<div class=\"flex sm:flex-row\"><div class=\"${this.options.display.counters}\"></div><div class=\"${this.options.display.sizes}\"></div><div class=\"${_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.progress}\"></div><div class=\"${this.options.display.timers}\"></div></div>`;\n      this.container.prepend(el);\n      this.displayprogression = el;\n    }\n  }\n  serverList(parent = null, subdir = null, tag = null) {\n    parent = parent ? parent : this.container.querySelector(this.options.selector.dirlist);\n    if (!parent) return;\n    // remove, move\n    const entry_controls = () => {\n      let box = this.container.querySelector(this.options.entrycontrols.selector);\n      if (box === null) {\n        box = document.createElement('div');\n        box.classList.add(this.options.entrycontrols.selector.substr(1));\n        this.options.entrycontrols.controls.forEach(control => {\n          const el = document.createElement('span');\n          if (control.typentry) el.dataset.typentry = control.typentry;\n          if (control.icon) {\n            el.insertAdjacentHTML('afterbegin', `<i class=\"icon ${control.icon}\"></i>`);\n            el.dataset.title = control.text;\n          } else el.textContent = control.text;\n          box.append(el);\n          el.addEventListener('click', async (e) => {\n            if (el.parentElement.classList.contains('entryD') || el.parentElement.classList.contains('entryD')) {\n              const name = (el.parentElement.dataset.name) ? new URLSearchParams({\n                entry: el.parentElement.dataset.name\n              }) : null;\n              if (name === null) return false;\n              const response = await fetch(this.options.entrycontrols.url + control.action + name, (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.fetchSettings)());\n              const json = await response.json();\n              if (json.success) {\n                switch (json.action) {\n                  case 'rename':\n                    el.parentElement.textContent = json.name;\n                    break;\n                  case 'delete':\n                    el.parentElement.remove();\n                    break;\n                }\n                return true;\n              } else {\n                console.log('err', json)\n\n              }\n            }\n            return false;\n          });\n        });\n        box.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n        this.container.append(box);\n      }\n      return box;\n    }\n    const entrycontrols = entry_controls();\n    const attach_controls = (el, typentry = null) => {\n      if (!el.dataset.name) return false;\n      console.log('entrycontrols parent', entrycontrols.parentElement)\n      entrycontrols.parentElement.classList.remove('has-controls');\n      el.insertBefore(entrycontrols, el.firstElementChild);\n      entrycontrols.querySelectorAll('[data-typentry]').forEach(ctrl => {\n        if (!ctrl.dataset.typentry || typentry === ctrl.dataset.typentry) ctrl.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n        else ctrl.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n      });\n      el.classList.add('has-controls');\n      entrycontrols.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n\n    }\n    parent.classList.add('wait');\n    const el = parent.querySelector(this.options.selector.entries);\n    if (el) el.remove();\n    tag = (tag) ? ((tag === 'select') ? 'optiongroup' : tag) : 'ul';\n    const subtag = (tag === 'ul') ? 'li' : 'option';\n    fetch(this.options.url + ((subdir) ? subdir : ''), (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.fetchSettings)()).then(response => response.json()).then(async json => {\n      if (json.entries && json.entries.length) {\n        if (parent.dataset.label) parent.insertAdjacentHTML('afterbegin', `<label>${parent.dataset.label}</label>`);\n        let html = [`<${tag} class=\"${this.options.selector.entries.slice(1)}\">`],\n          files = [],\n          directories = [],\n          entries = json.entries;\n        while (entries.length > 0) {\n          const entry = entries.shift();\n          if (entry.type === 'F') files.push(entry);\n          else directories.push(entry);\n        };\n        files.sort((a, b) => (a.name < b.name));\n        directories.sort((a, b) => (a.name < b.name));\n        [directories, files].forEach(entries => {\n          entries.forEach((entry) => {\n            const ext = entry.name.split('.').pop();\n            const entrydetail = `<span class=\"entry${entry.type}\"><i class=\"icon p-[0.125rem] icon-${((entry.type === \"D\") ? 'folder-sm' : ((_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.filter_files.images.split(',').indexOf(ext)>=0)?'image-sm':'document-sm'))} align-text-bottom mb-0.5 mr-0.5\"></i>${entry.name}</span>`;\n            html.push(`<${subtag} ${(entry.type==='D')?`draggable=\"true\"`:``} data-name=\"${entry.name}\" ${(tag==='select')?` class=\"entry${entry.type}\"`:``}>${entrydetail}`);\n            html.push(`</${subtag}>`);\n          });\n        });\n        html.push(`</${tag}>`);\n        parent.insertAdjacentHTML('beforeend', html.join(``));\n        parent.querySelectorAll('.entryF').forEach(file => {\n          file.addEventListener('click', (e) => {\n            e.stopImmediatePropagation();\n            attach_controls(file.parentElement);\n            this.detachDropzone();\n          });\n        });\n        parent.querySelectorAll('.entryD').forEach(dir => {\n          dir.addEventListener('click', (e) => {\n            e.stopImmediatePropagation();\n            const dirlist = dir.parentElement;\n            dirlist.classList.toggle('on');\n            const ico = e.currentTarget.querySelector('i.icon');\n            if (ico) {\n              ico.classList.toggle('icon-folder-sm');\n              ico.classList.toggle('icon-folder-open-sm');\n            }\n            if (dirlist.classList.contains('on')) {\n              console.log('is on', dirlist)\n              if (!dirlist.dataset.load) {\n                this.serverList(dirlist, ((subdir) ? subdir + '/' : '/') + dirlist.dataset.name, tag);\n\n              }\n            }\n          });\n\n        });\n\n      }\n      await this.addUploadDialog((subdir === null) ? this.container : parent);\n      parent.classList.remove('wait');\n      parent.dataset.loaded = true;\n      parent.classList.add('on');\n      if (subdir) {\n        console.log('subdir attach', parent);\n        attach_controls(parent, 'entryD');\n        this.setDropTarget(parent);\n      }\n    });\n\n  }\n\n  attachDropzone(target) {\n    if (this.dropzone.dataset.enabled) {\n      this.targetdir = target;\n      target.append(this.dropzone);\n    }\n  }\n  detachDropzone() {\n    if (this.dropzone.dataset.enabled) {\n      this.targetdir = null;\n      this.container.append(this.dropzone);\n    }\n  }\n\n  openDirDialog(accept, callback) {\n    const input = document.createElement(\"input\");\n    input.type = \"file\";\n    input.directory = true;\n    input.multiple = true;\n    input.webkitdirectory = true;\n    input.allowdirs = true;\n    input.accept = accept;\n    input.addEventListener(\"change\", callback);\n    input.dispatchEvent(new MouseEvent(\"click\"));\n  }\n  handleDragOver(e) {\n    e.preventDefault();\n    e.dataTransfer.dropEffect = \"move\";\n  }\n  // browse\n  async handleBrowse() {\n    this.initTimer();\n    this.openDirDialog(accept, async (e) => {\n      const files = e.target.files;\n      this.toggleCounters(true);\n      await this.jsDirToZip.scanFiles(files);\n    });\n  }\n  // or drag&drop\n  async handleDrop(e) {\n    let dataTransfer;\n    if (e.dataTransfer) {\n      e.preventDefault();\n      dataTransfer = e.dataTransfer;\n    } else dataTransfer = e;\n    this.done = false;\n    this.initTimer();\n    const items = [...((dataTransfer.items) ? dataTransfer.items : dataTransfer.files)];\n    if (items.length) {\n      this.enableDropzone(false);\n      await items.forEach(async item => {\n        if (item.kind === \"file\") {\n          item = await item.webkitGetAsEntry();\n          this.toggleCounters(true);\n          await this.readEntry(item);\n        }\n      })\n    }\n  }\n  showComplete() {\n    this.timer = (new Date() - this.timer) / 1000;\n    console.log('item-------------------------------------' + parseInt(this.timer / 60) + ' --- ' + (\n      this.timer - (parseInt(this.timer / 60) * 60)));\n    this.enableDropzone();\n  }\n\n  stopOnError(err) {\n    console.log('err', err);\n  }\n\n  enableDropzone(enable = true, destroy = false) {\n    if (destroy) this.dropzone.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n    if (enable) this.dropzone.dataset.enabled = true;\n    else delete this.dropzone.dataset.enabled;\n\n  }\n\n  addConsoleMessage(message) {\n    //message {message:, parent:}\n    const tag = 'p';\n    let el = message.parent.querySelector('.' + _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.console);\n    if (el === null) {\n      el = document.createElement('div');\n      el.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.console);\n      message.parent.prepend(el);\n    }\n    if (message.id) {\n      const msg = el.querySelector(`${tag}[data-id=\"${message.id}\"]`);\n      if (msg) msg.innerHTML = message.content;\n      else el.insertAdjacentHTML('beforeend', `<${tag} data-id=\"${message.id}\">${message.content}</${tag}>`);\n    } else el.insertAdjacentHTML('beforeend', `<${tag}>${message.content}</${tag}>`);\n\n  }\n\n  async addUploadDialog(item) {\n    item = (item) ? item : this.container;\n    if (this.options.controls.scan) {\n      this.enableDropzone(true);\n      this.attachDropzone(item);\n      if (this.options.controls.zip) {\n        const {\n          JsDirToZip\n        } = await Promise.all(/*! import() */[__webpack_require__.e(\"vendors-node_modules_fflate_esm_browser_js\"), __webpack_require__.e(\"src_modules_files_js-dirtozip_js\")]).then(__webpack_require__.bind(__webpack_require__, /*! ../modules/files/js-dirtozip.js */ \"./src/modules/files/js-dirtozip.js\"));\n        this.jsDirToZip = new JsDirToZip();\n        this.jsDirToZip.on(this.jsDirToZip.eventnames.ready, (e) => {\n          console.log('ready')\n          this.initControls();\n        });\n        this.jsDirToZip.on(this.jsDirToZip.eventnames.message, async (e) => {\n          switch (e.name) {\n            case 'console':\n              this.addConsoleMessage({\n                id: (e.id) ? e.id : null,\n                content: e.message,\n                parent: (e.parent) ? item : this.container\n              });\n              break;\n            case window.alertbox.alertconfig.types.error:\n            case window.alertbox.alertconfig.types.success:\n            case window.alertbox.alertconfig.types.danger:\n            case window.alertbox.alertconfig.types.info:\n              window.alertbox.renderAlert({\n                type: e.name,\n                content: e.message,\n                dismissible: true,\n                inverse: false\n              });\n              console.log('error', e);\n              break;\n            default:\n              console.log('message', e);\n              break;\n          }\n        })\n\n\n        const self = this;\n        this.jsDirToZip.on(this.jsDirToZip.eventnames.ready, (e) => {\n          self.showControl(this.jsDirToZip.eventnames.ready);\n        });\n        this.jsDirToZip.on(this.jsDirToZip.eventnames.counter, (e) => {\n          self.fileCounter(e.name, e.filepath, e.size);\n        });\n        this.jsDirToZip.on(this.jsDirToZip.eventnames.complete, (e) => {\n          if (!e || !e.name) {\n            console.log('no emit complete name');\n            return;\n          }\n          self.showControl(e.name, ((e.hasOwnProperty('bigfile') && e.bigfile) ? 'zipped' : 'zip'), (e.hasOwnProperty('part')) ? e.part : ((e.hasOwnProperty('bigfile')) ? e.bigfile : null));\n        });\n        this.jsDirToZip.on(this.jsDirToZip.eventnames.pending, (e) => {\n          self.showControl(this.jsDirToZip.eventnames.pending, ((e && e.hasOwnProperty('bigfile') && e.bigfile) ? 'zipped' : 'zip'));\n        });\n        this.jsDirToZip.on(this.jsDirToZip.eventnames.gzip, (e) => {\n          console.log('gzipped', e)\n          self.showControl(this.jsDirToZip.eventnames.gzip, 'zipped', e);\n        });\n        this.jsDirToZip.on(this.jsDirToZip.eventnames.terminate, (e) => {\n          console.log('terminate', e)\n          self.showControl(this.jsDirToZip.eventnames.terminate, ((e && e.hasOwnProperty('bigfile') && e.bigfile) ? 'zipped' : 'zip'));\n        });\n      }\n\n    }\n\n  }\n  async readEntry(entry) {\n    await this.jsDirToZip.scanHandle(entry);\n  }\n  getCurrentDirPath() {\n    if (this.targetdir === null) return '';\n    const current_path = (el, dirs = []) => {\n\n      if (el != null) {\n        dirs.push(el.dataset.name);\n        el = el.closest('.entryD');\n        if (el !== null) {\n          el = el.parentElement;\n          if (el !== null && el.dataset.name) current_path(el, dirs);\n        }\n      }\n      return dirs;\n    }\n    const dirs = current_path(this.targetdir);\n    return dirs.join(dirseparator);\n  }\n\n  async addFilesStore(name, callback) {\n    name = (name) ? name : this.options.dbname;\n    if (!this.jsFilesStore) {\n      const {\n        JsFilesStore\n      } = await __webpack_require__.e(/*! import() */ \"src_modules_files_js-filesystem_js\").then(__webpack_require__.bind(__webpack_require__, /*! ../modules/files/js-filesystem.js */ \"./src/modules/files/js-filesystem.js\"));\n      this.jsFilesStore = new JsFilesStore(null, callback);\n      this.displayFiles();\n    }\n    if (callback) await callback();\n  }\n  displayFiles() {\n    this.jsFilesStore.getItems('local');\n  }\n\n  fileCounter(item, filepath, size = null) {\n    const counters = this.counters[item];\n    counters.counter++;\n    if (size !== null) counters.size += parseInt(size);\n    counters.display.counter.textContent = counters.counter;\n    if (counters.display.size) counters.display.size.textContent = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.format_bytes)(counters.size);\n    this.jsDirToZip.quotaEstimate();\n  }\n\n  resetCounter(item) {\n    const counters = this.counters[item];\n    ['counter', 'size'].forEach(el => {\n      counters.display[el].textContent = 0;\n    });\n    this.toggleCounters(false);\n  }\n\n  toggleCounters(show = true) {\n    const el = document.getElementById(this.options.display.progression);\n    if (!el) return;\n    if (show) el.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n    else el.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n  }\n\n  initFileCounter(item, opts, i) {\n    const sep = (i) ? ` / ` : ``;\n    let counter = 0;\n    let counterdisplay = null;\n    let size = 0;\n    let sizedisplay = null;\n    // create dom display elements\n\n\n    let boxcounters = document.getElementById(this.options.display.progression);\n    const itemopts = {\n      display: {},\n\n    };\n    Object.entries(opts).forEach(([k, val]) => {\n      const cl = k + 's';\n      const txt = {\n        counter: ' read',\n        size: ' read',\n        counterzipped: ' compressed',\n        sizezipped: ' compressed'\n      }\n      let elinsert = boxcounters.querySelector('.' + cl);\n      if (!elinsert) elinsert = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)('div', {\n        class: cl\n      }, boxcounters, ``);\n      let el = elinsert.querySelector('.' + val);\n      if (!el) {\n        el = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)('span', {\n          class: val,\n        }, elinsert);\n        if (txt.hasOwnProperty(val)) elinsert.append(document.createTextNode(txt[val]));\n      } else this.resetCounter(item);\n      itemopts.display[k] = el;\n      itemopts[k] = 0;\n    });\n\n    this.counters = { ...this.counters,\n      ...{\n        [item]: itemopts\n      }\n    };\n  }\n\n  showControl(action, target = 'zip', opts = null) {\n    let message, text = null;\n    // 'zip' ---only btn for zip actions for the moment\n    const btn = this[this.options.btnprefix + 'zip' + target];\n    if (!btn) return;\n    btn.removeAttribute(\"disabled\");\n    switch (action) {\n      case this.jsDirToZip.eventnames.ready:\n        if (btn.dataset.message) delete btn.dataset.message;\n        btn.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n        this.initControls();\n        break;\n      case this.jsDirToZip.eventnames.endzip:\n        const part = opts;\n        if (!part) this.showComplete();\n        btn.textContent = `Close zip file` + ((part) ? part : ``);\n        btn.title = (part) ? `Your file is too big - you have to send this part before continuing to process the directory` : `Click to end zip file`;\n        message = {\n          name: this.jsDirToZip.eventnames.endzip,\n          part: part,\n          bigfile: (target !== 'zip'),\n        };\n        if (part) message[\"part\"] = part;\n        btn.dataset.message = JSON.stringify(message);\n        break;\n      case this.jsDirToZip.eventnames.bigfile:\n        btn.textContent = `Upload big File separately`;\n        message = {\n          name: this.jsDirToZip.eventnames.bigfile,\n          path: this.getCurrentDirPath(),\n          bigfile: true\n        };\n\n        const filepath = opts;\n        if (filepath) message[\"path\"] = filepath;\n        btn.dataset.message = JSON.stringify(message);\n        console.log('bigfile', message)\n        break;\n      case this.jsDirToZip.eventnames.sendfile:\n        message = {\n          name: this.jsDirToZip.eventnames.sendfile,\n          path: this.getCurrentDirPath(),\n          bigfile: opts,\n        };\n        btn.textContent = `Upload zip file`;\n        if (message.bigfile !== null) btn.textContent += ` ` + opts;\n        btn.dataset.message = JSON.stringify(message);\n        console.log('messageup', message)\n        break;\n      case this.jsDirToZip.eventnames.pending:\n        btn.textContent = ` Pending ` + ((target !== 'zip') ? ' big file' : '');\n        btn.dataset.message = '';\n        btn.setAttribute(\"disabled\", true);\n        break;\n      case this.jsDirToZip.eventnames.gzip:\n        text = `compressing separately big file :${(opts && opts.bigfile)?opts.bigfile:``} ${(opts && opts.size)?opts.size:``}`;\n        btn.textContent = text;\n        btn.setAttribute(\"disabled\", true);\n        console.log('optsbigfl', opts)\n        btn.dataset.message = JSON.stringify({\n          name: this.jsDirToZip.eventnames.endzip,\n          path: (opts.hasOwnProperty(\"bigfile\")) ? opts.bigfile : e.path,\n          bigfile: (opts.hasOwnProperty(\"bigfile\") && opts.bigfile !== \"\"),\n        });\n        break;\n      case this.jsDirToZip.eventnames.terminate:\n        console.log('terminate ' + ((target !== 'zip') ? 'bigfile' : ''));\n        this.serverList(this.targetdir);\n        //default:\n        btn.dataset.message = JSON.stringify({\n          name: 'ready',\n          bigfile: (target !== 'zip')\n        });\n        btn.textContent = `End!! ${ ((target !== 'zip') ? 'bigfile' : '')}`;\n\n        break;\n    }\n    if (btn.dataset.message) btn.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n  }\n  emitToZip(btn) {\n    const message = (btn.dataset.message) ? JSON.parse(btn.dataset.message) : null;\n    if (!message) btn.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n    if (message) {\n      if (message.name) {\n        const name = message.name;\n        delete message.name;\n        console.log('emit ----' + name, message)\n        this.jsDirToZip.emit(name, message);\n      }\n    }\n    if (name === this.jsDirToZip.eventnames.sendfile) btn.disabled = true;\n  }\n  getBtn(item, target) {\n    const btnkey = this.options.btnprefix + item + target;\n    if (this[btnkey]) return this[btnkey];\n    const display = this.options.controls[item].btn[target];\n    const btn = document.getElementById(display);\n    const parent = (this.targetdir) ? this.targetdir : this.displayprogression;\n    if (!btn) {\n      parent.insertAdjacentHTML('beforeend', `<button id=\"${display}\" class=\"button ${display} ${localcss.mright} ${_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide}\"></button>`);\n      this[btnkey] = document.getElementById(display);\n      this[btnkey].addEventListener('click', async (e) => {\n        e.stopImmediatePropagation();\n        this.emitToZip(e.currentTarget);\n      });\n    } else parent.append(btn);\n    return this[btnkey];\n  }\n\n  initControls(item = null) {\n    Object.entries(this.options.controls).forEach(([key, control], i) => {\n      this.initFileCounter(key, control.display, i);\n      if (control.btn) this.activateControls(key, control.btn);\n    });\n  }\n  activateControls(key, btns) {\n    Object.keys(btns).forEach((btn) => {\n      this[this.options.btnprefix + key + btn] = this.getBtn(key, btn);\n    })\n\n  }\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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REFBNEQsUUFBUSxrQkFBa0IsU0FBUyxFQUFFLGlCQUFpQixFQUFFLDJEQUFHLE1BQU07QUFDN0g7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1AsTUFBTTtBQUNOO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvbW9kdWxlcy9qcy1teS1maWxlcy5qcz8xM2I5Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIGRvbV9wdXJpZnksXG4gIGZldGNoU2V0dGluZ3MsXG4gIGFkZF9jdXN0b21fZXZlbnRzLFxuICBjcmVhdGVfYm94LFxuICBmb3JtYXRfYnl0ZXNcbn0gZnJvbSAnLi4vbW9kdWxlcy91dGlscy5qcyc7XG5pbXBvcnQge1xuICBjc3MsXG4gIGZpbHRlcl9maWxlc1xufSBmcm9tICcuLi9tb2R1bGVzL21vZHVsZXMtY29uZmlnLmpzJztcbmltcG9ydCB7XG4gIGdlbmVyYXRlX3V1aWQsXG59IGZyb20gJy4uL21vZHVsZXMvdXRpbHMuanMnO1xuY29uc3QgYWNjZXB0ID0gJy50c3YsLnBuZywuanBnLCAuanBlZywuemlwLC5neiwuN3osLmJ6Mic7XG5jb25zdCBsb2NhbGNzcyA9IHtcbiAgbXJpZ2h0OiAnbXItNCcsXG59XG5jb25zdCBkaXJzZXBhcmF0b3IgPSBcIi9cIjtcbmV4cG9ydCBjbGFzcyBKc015RmlsZXMge1xuICBkb25lID0gdHJ1ZTtcbiAganNEaXJUb1ppcCA9IG51bGw7XG4gIGNvdW50ZXJzID0ge307XG4gIF9ldmVudHMgPSB7fTtcbiAgZXZlbnRuYW1lcyA9IHtcbiAgICBjb21wbGV0ZTogJ2NvbXBsZXRlJyxcbiAgICBlcnJvcjogJ2Vycm9yJyxcbiAgfVxuICBjb25zdHJ1Y3Rvcihjb250YWluZXIsIG9wdGlvbnMgPSB7fSkge1xuICAgIGlmICghY29udGFpbmVyLmpzbXlmaWxlcykge1xuICAgICAgY29udGFpbmVyID0gKGNvbnRhaW5lciBpbnN0YW5jZW9mIEhUTUxFbGVtZW50KSA/IGNvbnRhaW5lciA6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoY29udGFpbmVyKTtcbiAgICAgIGlmICghY29udGFpbmVyKSByZXR1cm47XG4gICAgICBkb21fcHVyaWZ5KGNvbnRhaW5lciwgJ2RhdGFzZXQnKTtcbiAgICAgIHRoaXMuY29udGFpbmVyID0gY29udGFpbmVyO1xuICAgICAgY29uc29sZS5sb2coXCIvZ3VpL2ZpbGVzL2xpc3RcIilcbiAgICAgIGNvbnN0IGRlZmF1bHRPcHRpb25zID0ge1xuXG4gICAgICAgIHVybDogXCIvZ3VpL2ZpbGVzL2xpc3RcIixcbiAgICAgICAgY29tcHJlc3M6IHtcbiAgICAgICAgICBsYWJlbDogJ2NvbXByZXNzJ1xuICAgICAgICB9LFxuICAgICAgICBjb250cm9sczoge1xuICAgICAgICAgIHNjYW46IHtcbiAgICAgICAgICAgIGRpc3BsYXk6IHtcbiAgICAgICAgICAgICAgY291bnRlcjogJ2NvdW50ZXInLFxuICAgICAgICAgICAgICBzaXplOiAnc2l6ZScsXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICB6aXA6IHtcbiAgICAgICAgICAgIGJ0bjoge1xuICAgICAgICAgICAgICB6aXA6ICdtYWtlemlwJyxcbiAgICAgICAgICAgICAgemlwcGVkOiAnbWFrZXppcHBlZCdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBkaXNwbGF5OiB7XG4gICAgICAgICAgICAgIHNpemU6ICdzaXplemlwcGVkJyxcbiAgICAgICAgICAgICAgY291bnRlcjogJ2NvdW50ZXJ6aXBwZWQnLFxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG5cbiAgICAgICAgfSxcbiAgICAgICAgdXBsb2FkOiB7XG4gICAgICAgICAgbGFiZWw6ICd1cGxvYWQnXG4gICAgICAgIH0sXG4gICAgICAgIGJ0bnByZWZpeDogJ2J0bicsXG4gICAgICAgIGJ0bmZpbGVsaXN0OiBudWxsLFxuICAgICAgICBzZWxlY3Rvcjoge1xuICAgICAgICAgIGRvdXBsb2FkOiAnLnRhcmdldC11cGxvYWQnLFxuICAgICAgICAgIGRyb3B0YXJnZXQ6ICcuZHJvcHRhcmdldCcsXG4gICAgICAgICAgdHJpZ2dlcjogJy50cmlnZ2VyJyxcbiAgICAgICAgICBlbnRyaWVzOiAnLmVudHJpZXMnLFxuICAgICAgICAgIGRpcmxpc3Q6ICcuZGlybGlzdCcsXG4gICAgICAgICAgdXBsb2FkZmlsZTogJ3VwbG9hZGZpbGUnLFxuICAgICAgICAgIGRpc3BsYXlyZXN1bHQ6ICdyZXN1bHRzJyxcbiAgICAgICAgfSxcbiAgICAgICAgZW50cnljb250cm9sczoge1xuICAgICAgICAgIHNlbGVjdG9yOiAnLmVudHJ5Y29udHJvbHMnLFxuICAgICAgICAgIHVybDogJ2d1aS9tZS9teV9maWxlcy8nLFxuICAgICAgICAgIGNvbnRyb2xzOiBbe1xuICAgICAgICAgICAgICBhY3Rpb246ICduZXdmb2xkZXInLFxuICAgICAgICAgICAgICB0ZXh0OiAnbmV3IGZvbGRlcicsXG4gICAgICAgICAgICAgIGljb246ICdpY29uLWZvbGRlci1wbHVzLXNtJyxcbiAgICAgICAgICAgICAgdHlwZW50cnk6ICdlbnRyeUQnXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgIGFjdGlvbjogJ3JlbmFtZScsXG4gICAgICAgICAgICAgIHRleHQ6ICdyZW5hbWUnLFxuICAgICAgICAgICAgICBpY29uOiAnaWNvbi1wZW5jaWwtc20nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBhY3Rpb246ICdkZWxldGUnLFxuICAgICAgICAgICAgICB0ZXh0OiAnZGVsZXRlJyxcbiAgICAgICAgICAgICAgaWNvbjogJ2ljb24tdHJhc2gtc20nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF1cbiAgICAgICAgfSxcbiAgICAgICAgZGlzcGxheToge1xuICAgICAgICAgIHByb2dyZXNzaW9uOiAnZGlzcGxheS1wcm9ncmVzc2lvbicsXG4gICAgICAgICAgZHJvcHpvbmU6ICdkcm9wem9uZScsXG4gICAgICAgICAgYm94dGl0bGU6ICdib3h0aXRsZScsXG4gICAgICAgICAgY291bnRlcnM6ICdjb3VudGVycycsXG4gICAgICAgICAgc2l6ZXM6ICdzaXplcycsXG4gICAgICAgICAgdGltZXJzOiAndGltZXJzJ1xuICAgICAgICB9LFxuXG4gICAgICB9O1xuICAgICAgdGhpcy5vcHRpb25zID0gT2JqZWN0LmFzc2lnbihkZWZhdWx0T3B0aW9ucywgb3B0aW9ucyk7XG4gICAgICB0aGlzLmluaXQoKTtcbiAgICAgIGNvbnRhaW5lci5qc215ZmlsZXMgPSB0aGlzO1xuICAgIH1cbiAgICByZXR1cm4gY29udGFpbmVyLmpzbXlmaWxlcztcbiAgfVxuICBpbml0KCkge1xuICAgIC8vIGNyZWF0ZSBkaXJsaXN0IGJveFxuICAgIHRoaXMuYWRkRHJvcHpvbmUoKTtcbiAgICB0aGlzLmFkZERpc3BsYXlQcm9ncmVzc2lvbigpO1xuICAgIHRoaXMuYWRkRGlyTGlzdCgpO1xuICAgIHRoaXMuaW5pdEV2ZW50cygpO1xuICB9XG4gIGluaXRUaW1lcigpIHtcbiAgICB0aGlzLnRpbWVyID0gbmV3IERhdGUoKTtcbiAgfVxuICBpbml0RXZlbnRzKCkge1xuICAgIGFkZF9jdXN0b21fZXZlbnRzKHRoaXMpO1xuXG4gICAgLy9UbyBiZSByZWZhY3RvcmVkIC0gZm9yIHN0ZXBwZXJzIClcbiAgICB0aGlzLm9uKHRoaXMuZXZlbnRuYW1lcy5wcm9jZXNzZWQsIGFzeW5jIChlKSA9PiB7XG4gICAgICBpZiAodGhpcy5uZXh0YWN0aW9uKSBhd2FpdCB0aGlzLm5leHRhY3Rpb24oKTtcbiAgICB9KVxuICAgIC8vIGFsZXJ0cyBvbiBlcnJvclxuICAgIHRoaXMub24odGhpcy5ldmVudG5hbWVzLmVycm9yLCAoZSkgPT4ge1xuICAgICAgY29uc29sZS5sb2coJ3NjYW5kaXIgcmVjZWl2ZSBlcnJvciBtZXNzYWdlJywgZSlcbiAgICAgIGlmICh3aW5kb3cuYWxlcnRib3gpIHtcbiAgICAgICAgd2luZG93LmFsZXJ0Ym94LnJlbmRlckFsZXJ0KHtcbiAgICAgICAgICB0eXBlOiB3aW5kb3cuYWxlcnRib3guYWxlcnRjb25maWcudHlwZXMuZXJyb3IsXG4gICAgICAgICAgY29udGVudDogZSxcbiAgICAgICAgICBpbnZlcnNlOiB0cnVlLFxuICAgICAgICAgIGRpc21pc3NpYmxlOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2JlZm9yZXVubG9hZCcsIChlKSA9PiB7XG4gICAgICBpZiAoIXRoaXMuZG9uZSkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGUucmV0dXJuVmFsdWUgPSAodGhpcy5vcHRpb25zLnByZXZlbnRjbG9zZSkgPyB0aGlzLm9wdGlvbnMucHJldmVudGNsb3NlIDogYFNvbWUgd29yayBpcyBpbiBwcm9ncmVzcyBpbiB0aGlzIHdpbmRvdy5cXG5BcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gbGVhdmU/YDtcbiAgICAgIH1cblxuXG4gICAgfSk7XG4gIH1cbiAgYWRkRHJvcHpvbmUoKSB7IC8vXG4gICAgdGhpcy5kcm9wem9uZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIHRoaXMuZHJvcHpvbmUuaWQgPSB0aGlzLm9wdGlvbnMuZGlzcGxheS5kcm9wem9uZTtcbiAgICB0aGlzLmRyb3B6b25lLmlubmVySFRNTCA9IGA8aW5wdXQgdHlwZT1cImZpbGVcIiBjbGFzcz1cImhpZGRlblwiICBuYW1lPVwiJHt0aGlzLm9wdGlvbnMuc2VsZWN0b3IudXBsb2FkZmlsZX1cIiBpZD1cIiR7dGhpcy5vcHRpb25zLnNlbGVjdG9yLnVwbG9hZGZpbGV9XCI+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiJHt0aGlzLm9wdGlvbnMuc2VsZWN0b3IuZHJvcHRhcmdldC5zdWJzdHIoMSl9XCI+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiJHt0aGlzLm9wdGlvbnMuZGlzcGxheS5ib3h0aXRsZX1cIj48c3BhbiBjbGFzcz1cIiR7dGhpcy5vcHRpb25zLnNlbGVjdG9yLnRyaWdnZXIuc2xpY2UoMSl9XCI+JHt0aGlzLmNvbnRhaW5lci5kYXRhc2V0LnRleHRicm93c2V9PC9zcGFuPiAgJHt0aGlzLmNvbnRhaW5lci5kYXRhc2V0LnRleHRkcm9wfTwvZGl2PlxuICAgICAgICAgIDwvZGl2PmA7XG4gICAgdGhpcy5jb250YWluZXIuYXBwZW5kKHRoaXMuZHJvcHpvbmUpO1xuICAgIHRoaXMuc2V0RHJvcFRhcmdldCh0aGlzLmRyb3B6b25lLnF1ZXJ5U2VsZWN0b3IodGhpcy5vcHRpb25zLnNlbGVjdG9yLmRyb3B0YXJnZXQpKTtcbiAgICB0aGlzLmNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKHRoaXMub3B0aW9ucy5zZWxlY3Rvci50cmlnZ2VyKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jIChlKSA9PiB7XG4gICAgICB0aGlzLmhhbmRsZUJyb3dzZSgpO1xuICAgIH0pO1xuICB9XG4gIHNldERyb3BUYXJnZXQoZHJvcHRhcmdldCkge1xuICAgIGNvbnN0IGRyb3BjbGFzcyA9IHRoaXMub3B0aW9ucy5zZWxlY3Rvci5kcm9wdGFyZ2V0LnN1YnN0cigxKTtcbiAgICBjb25zdCB0YXJnZXRfZHJhZ292ZXIgPSAoZSkgPT4ge1xuICAgICAgdGhpcy5oYW5kbGVEcmFnT3ZlcihlKTtcbiAgICB9XG4gICAgY29uc3QgdGFyZ2V0X2Ryb3AgPSBhc3luYyAoZSkgPT4ge1xuICAgICAgdGhpcy5oYW5kbGVEcm9wKGUpO1xuICAgIH1cbiAgICAvLyBzZXQgZXZlbnRzIGFuZCBjc3MgZm9yIG5ldyBkcm9wem9uZVxuICAgIGlmICghdGhpcy5kcm9wdGFyZ2V0IHx8IHRoaXMuZHJvcHRhcmdldCAhPSBkcm9wdGFyZ2V0KSB7XG4gICAgICBpZiAodGhpcy5kcm9wdGFyZ2V0KSB7XG4gICAgICAgIHRoaXMuZHJvcHRhcmdldC5yZW1vdmVFdmVudExpc3RlbmVyKCdkcmFnb3ZlcicsIHRhcmdldF9kcmFnb3Zlcik7XG4gICAgICAgIHRoaXMuZHJvcHRhcmdldC5yZW1vdmVFdmVudExpc3RlbmVyKCdkcm9wJywgdGFyZ2V0X2Ryb3ApO1xuICAgICAgICB0aGlzLmRyb3B0YXJnZXQuY2xhc3NMaXN0LnJlbW92ZShkcm9wY2xhc3MpO1xuICAgICAgfVxuICAgICAgdGhpcy5kcm9wdGFyZ2V0ID0gZHJvcHRhcmdldDtcbiAgICAgIHRoaXMuZHJvcHRhcmdldC5hZGRFdmVudExpc3RlbmVyKCdkcmFnb3ZlcicsIHRhcmdldF9kcmFnb3Zlcik7XG4gICAgICB0aGlzLmRyb3B0YXJnZXQuYWRkRXZlbnRMaXN0ZW5lcignZHJvcCcsIHRhcmdldF9kcm9wKTtcbiAgICAgIHRoaXMuZHJvcHRhcmdldC5jbGFzc0xpc3QuYWRkKGRyb3BjbGFzcyk7XG4gICAgfVxuICB9XG4gIGFzeW5jIGFkZERpckxpc3Qoc291cmNlID0gbnVsbCkge1xuICAgIGxldCBlbCA9IHRoaXMuY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IodGhpcy5vcHRpb25zLnNlbGVjdG9yLmRpcmxpc3QpO1xuICAgIGNvbnNvbGUubG9nKCdlbCBkaXJsaXN0JywgZWwpXG4gICAgaWYgKCFlbCkge1xuICAgICAgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgIGVsLmNsYXNzTGlzdC5hZGQodGhpcy5vcHRpb25zLnNlbGVjdG9yLmRpcmxpc3Quc3Vic3RyKDEpKTtcbiAgICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZChlbCk7XG4gICAgICB0aGlzLmRpc3BsYXlsaXN0ID0gZWw7XG4gICAgfVxuICAgIHRoaXMuc2VydmVyTGlzdCgpO1xuICB9XG4gIGFkZERpc3BsYXlQcm9ncmVzc2lvbigpIHtcbiAgICAvLyBhZGQgY291bnRlcnNcbiAgICBpZiAodGhpcy5kaXNwbGF5cHJvZ3Jlc3Npb24pIHJldHVybjtcbiAgICBsZXQgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLm9wdGlvbnMuZGlzcGxheS5wcm9ncmVzc2lvbik7XG4gICAgaWYgKCFlbCkge1xuICAgICAgY29uc29sZS5sb2coJ2NvdW50ZXJzY3JlYXRlJylcbiAgICAgIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICBlbC5pZCA9IHRoaXMub3B0aW9ucy5kaXNwbGF5LnByb2dyZXNzaW9uO1xuICAgICAgZWwuaW5uZXJIVE1MID0gYDxkaXYgY2xhc3M9XCJmbGV4IHNtOmZsZXgtcm93XCI+PGRpdiBjbGFzcz1cIiR7dGhpcy5vcHRpb25zLmRpc3BsYXkuY291bnRlcnN9XCI+PC9kaXY+PGRpdiBjbGFzcz1cIiR7dGhpcy5vcHRpb25zLmRpc3BsYXkuc2l6ZXN9XCI+PC9kaXY+PGRpdiBjbGFzcz1cIiR7Y3NzLnByb2dyZXNzfVwiPjwvZGl2PjxkaXYgY2xhc3M9XCIke3RoaXMub3B0aW9ucy5kaXNwbGF5LnRpbWVyc31cIj48L2Rpdj48L2Rpdj5gO1xuICAgICAgdGhpcy5jb250YWluZXIucHJlcGVuZChlbCk7XG4gICAgICB0aGlzLmRpc3BsYXlwcm9ncmVzc2lvbiA9IGVsO1xuICAgIH1cbiAgfVxuICBzZXJ2ZXJMaXN0KHBhcmVudCA9IG51bGwsIHN1YmRpciA9IG51bGwsIHRhZyA9IG51bGwpIHtcbiAgICBwYXJlbnQgPSBwYXJlbnQgPyBwYXJlbnQgOiB0aGlzLmNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKHRoaXMub3B0aW9ucy5zZWxlY3Rvci5kaXJsaXN0KTtcbiAgICBpZiAoIXBhcmVudCkgcmV0dXJuO1xuICAgIC8vIHJlbW92ZSwgbW92ZVxuICAgIGNvbnN0IGVudHJ5X2NvbnRyb2xzID0gKCkgPT4ge1xuICAgICAgbGV0IGJveCA9IHRoaXMuY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IodGhpcy5vcHRpb25zLmVudHJ5Y29udHJvbHMuc2VsZWN0b3IpO1xuICAgICAgaWYgKGJveCA9PT0gbnVsbCkge1xuICAgICAgICBib3ggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgYm94LmNsYXNzTGlzdC5hZGQodGhpcy5vcHRpb25zLmVudHJ5Y29udHJvbHMuc2VsZWN0b3Iuc3Vic3RyKDEpKTtcbiAgICAgICAgdGhpcy5vcHRpb25zLmVudHJ5Y29udHJvbHMuY29udHJvbHMuZm9yRWFjaChjb250cm9sID0+IHtcbiAgICAgICAgICBjb25zdCBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgICAgICAgICBpZiAoY29udHJvbC50eXBlbnRyeSkgZWwuZGF0YXNldC50eXBlbnRyeSA9IGNvbnRyb2wudHlwZW50cnk7XG4gICAgICAgICAgaWYgKGNvbnRyb2wuaWNvbikge1xuICAgICAgICAgICAgZWwuaW5zZXJ0QWRqYWNlbnRIVE1MKCdhZnRlcmJlZ2luJywgYDxpIGNsYXNzPVwiaWNvbiAke2NvbnRyb2wuaWNvbn1cIj48L2k+YCk7XG4gICAgICAgICAgICBlbC5kYXRhc2V0LnRpdGxlID0gY29udHJvbC50ZXh0O1xuICAgICAgICAgIH0gZWxzZSBlbC50ZXh0Q29udGVudCA9IGNvbnRyb2wudGV4dDtcbiAgICAgICAgICBib3guYXBwZW5kKGVsKTtcbiAgICAgICAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jIChlKSA9PiB7XG4gICAgICAgICAgICBpZiAoZWwucGFyZW50RWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoJ2VudHJ5RCcpIHx8IGVsLnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdlbnRyeUQnKSkge1xuICAgICAgICAgICAgICBjb25zdCBuYW1lID0gKGVsLnBhcmVudEVsZW1lbnQuZGF0YXNldC5uYW1lKSA/IG5ldyBVUkxTZWFyY2hQYXJhbXMoe1xuICAgICAgICAgICAgICAgIGVudHJ5OiBlbC5wYXJlbnRFbGVtZW50LmRhdGFzZXQubmFtZVxuICAgICAgICAgICAgICB9KSA6IG51bGw7XG4gICAgICAgICAgICAgIGlmIChuYW1lID09PSBudWxsKSByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godGhpcy5vcHRpb25zLmVudHJ5Y29udHJvbHMudXJsICsgY29udHJvbC5hY3Rpb24gKyBuYW1lLCBmZXRjaFNldHRpbmdzKCkpO1xuICAgICAgICAgICAgICBjb25zdCBqc29uID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgICAgICAgICBpZiAoanNvbi5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChqc29uLmFjdGlvbikge1xuICAgICAgICAgICAgICAgICAgY2FzZSAncmVuYW1lJzpcbiAgICAgICAgICAgICAgICAgICAgZWwucGFyZW50RWxlbWVudC50ZXh0Q29udGVudCA9IGpzb24ubmFtZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICBjYXNlICdkZWxldGUnOlxuICAgICAgICAgICAgICAgICAgICBlbC5wYXJlbnRFbGVtZW50LnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2VycicsIGpzb24pXG5cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgYm94LmNsYXNzTGlzdC5hZGQoY3NzLmhpZGUpO1xuICAgICAgICB0aGlzLmNvbnRhaW5lci5hcHBlbmQoYm94KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBib3g7XG4gICAgfVxuICAgIGNvbnN0IGVudHJ5Y29udHJvbHMgPSBlbnRyeV9jb250cm9scygpO1xuICAgIGNvbnN0IGF0dGFjaF9jb250cm9scyA9IChlbCwgdHlwZW50cnkgPSBudWxsKSA9PiB7XG4gICAgICBpZiAoIWVsLmRhdGFzZXQubmFtZSkgcmV0dXJuIGZhbHNlO1xuICAgICAgY29uc29sZS5sb2coJ2VudHJ5Y29udHJvbHMgcGFyZW50JywgZW50cnljb250cm9scy5wYXJlbnRFbGVtZW50KVxuICAgICAgZW50cnljb250cm9scy5wYXJlbnRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2hhcy1jb250cm9scycpO1xuICAgICAgZWwuaW5zZXJ0QmVmb3JlKGVudHJ5Y29udHJvbHMsIGVsLmZpcnN0RWxlbWVudENoaWxkKTtcbiAgICAgIGVudHJ5Y29udHJvbHMucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtdHlwZW50cnldJykuZm9yRWFjaChjdHJsID0+IHtcbiAgICAgICAgaWYgKCFjdHJsLmRhdGFzZXQudHlwZW50cnkgfHwgdHlwZW50cnkgPT09IGN0cmwuZGF0YXNldC50eXBlbnRyeSkgY3RybC5jbGFzc0xpc3QucmVtb3ZlKGNzcy5oaWRlKTtcbiAgICAgICAgZWxzZSBjdHJsLmNsYXNzTGlzdC5hZGQoY3NzLmhpZGUpO1xuICAgICAgfSk7XG4gICAgICBlbC5jbGFzc0xpc3QuYWRkKCdoYXMtY29udHJvbHMnKTtcbiAgICAgIGVudHJ5Y29udHJvbHMuY2xhc3NMaXN0LnJlbW92ZShjc3MuaGlkZSk7XG5cbiAgICB9XG4gICAgcGFyZW50LmNsYXNzTGlzdC5hZGQoJ3dhaXQnKTtcbiAgICBjb25zdCBlbCA9IHBhcmVudC5xdWVyeVNlbGVjdG9yKHRoaXMub3B0aW9ucy5zZWxlY3Rvci5lbnRyaWVzKTtcbiAgICBpZiAoZWwpIGVsLnJlbW92ZSgpO1xuICAgIHRhZyA9ICh0YWcpID8gKCh0YWcgPT09ICdzZWxlY3QnKSA/ICdvcHRpb25ncm91cCcgOiB0YWcpIDogJ3VsJztcbiAgICBjb25zdCBzdWJ0YWcgPSAodGFnID09PSAndWwnKSA/ICdsaScgOiAnb3B0aW9uJztcbiAgICBmZXRjaCh0aGlzLm9wdGlvbnMudXJsICsgKChzdWJkaXIpID8gc3ViZGlyIDogJycpLCBmZXRjaFNldHRpbmdzKCkpLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuanNvbigpKS50aGVuKGFzeW5jIGpzb24gPT4ge1xuICAgICAgaWYgKGpzb24uZW50cmllcyAmJiBqc29uLmVudHJpZXMubGVuZ3RoKSB7XG4gICAgICAgIGlmIChwYXJlbnQuZGF0YXNldC5sYWJlbCkgcGFyZW50Lmluc2VydEFkamFjZW50SFRNTCgnYWZ0ZXJiZWdpbicsIGA8bGFiZWw+JHtwYXJlbnQuZGF0YXNldC5sYWJlbH08L2xhYmVsPmApO1xuICAgICAgICBsZXQgaHRtbCA9IFtgPCR7dGFnfSBjbGFzcz1cIiR7dGhpcy5vcHRpb25zLnNlbGVjdG9yLmVudHJpZXMuc2xpY2UoMSl9XCI+YF0sXG4gICAgICAgICAgZmlsZXMgPSBbXSxcbiAgICAgICAgICBkaXJlY3RvcmllcyA9IFtdLFxuICAgICAgICAgIGVudHJpZXMgPSBqc29uLmVudHJpZXM7XG4gICAgICAgIHdoaWxlIChlbnRyaWVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBjb25zdCBlbnRyeSA9IGVudHJpZXMuc2hpZnQoKTtcbiAgICAgICAgICBpZiAoZW50cnkudHlwZSA9PT0gJ0YnKSBmaWxlcy5wdXNoKGVudHJ5KTtcbiAgICAgICAgICBlbHNlIGRpcmVjdG9yaWVzLnB1c2goZW50cnkpO1xuICAgICAgICB9O1xuICAgICAgICBmaWxlcy5zb3J0KChhLCBiKSA9PiAoYS5uYW1lIDwgYi5uYW1lKSk7XG4gICAgICAgIGRpcmVjdG9yaWVzLnNvcnQoKGEsIGIpID0+IChhLm5hbWUgPCBiLm5hbWUpKTtcbiAgICAgICAgW2RpcmVjdG9yaWVzLCBmaWxlc10uZm9yRWFjaChlbnRyaWVzID0+IHtcbiAgICAgICAgICBlbnRyaWVzLmZvckVhY2goKGVudHJ5KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBleHQgPSBlbnRyeS5uYW1lLnNwbGl0KCcuJykucG9wKCk7XG4gICAgICAgICAgICBjb25zdCBlbnRyeWRldGFpbCA9IGA8c3BhbiBjbGFzcz1cImVudHJ5JHtlbnRyeS50eXBlfVwiPjxpIGNsYXNzPVwiaWNvbiBwLVswLjEyNXJlbV0gaWNvbi0keygoZW50cnkudHlwZSA9PT0gXCJEXCIpID8gJ2ZvbGRlci1zbScgOiAoKGZpbHRlcl9maWxlcy5pbWFnZXMuc3BsaXQoJywnKS5pbmRleE9mKGV4dCk+PTApPydpbWFnZS1zbSc6J2RvY3VtZW50LXNtJykpfSBhbGlnbi10ZXh0LWJvdHRvbSBtYi0wLjUgbXItMC41XCI+PC9pPiR7ZW50cnkubmFtZX08L3NwYW4+YDtcbiAgICAgICAgICAgIGh0bWwucHVzaChgPCR7c3VidGFnfSAkeyhlbnRyeS50eXBlPT09J0QnKT9gZHJhZ2dhYmxlPVwidHJ1ZVwiYDpgYH0gZGF0YS1uYW1lPVwiJHtlbnRyeS5uYW1lfVwiICR7KHRhZz09PSdzZWxlY3QnKT9gIGNsYXNzPVwiZW50cnkke2VudHJ5LnR5cGV9XCJgOmBgfT4ke2VudHJ5ZGV0YWlsfWApO1xuICAgICAgICAgICAgaHRtbC5wdXNoKGA8LyR7c3VidGFnfT5gKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGh0bWwucHVzaChgPC8ke3RhZ30+YCk7XG4gICAgICAgIHBhcmVudC5pbnNlcnRBZGphY2VudEhUTUwoJ2JlZm9yZWVuZCcsIGh0bWwuam9pbihgYCkpO1xuICAgICAgICBwYXJlbnQucXVlcnlTZWxlY3RvckFsbCgnLmVudHJ5RicpLmZvckVhY2goZmlsZSA9PiB7XG4gICAgICAgICAgZmlsZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgICAgICBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgYXR0YWNoX2NvbnRyb2xzKGZpbGUucGFyZW50RWxlbWVudCk7XG4gICAgICAgICAgICB0aGlzLmRldGFjaERyb3B6b25lKCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBwYXJlbnQucXVlcnlTZWxlY3RvckFsbCgnLmVudHJ5RCcpLmZvckVhY2goZGlyID0+IHtcbiAgICAgICAgICBkaXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgICAgICAgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIGNvbnN0IGRpcmxpc3QgPSBkaXIucGFyZW50RWxlbWVudDtcbiAgICAgICAgICAgIGRpcmxpc3QuY2xhc3NMaXN0LnRvZ2dsZSgnb24nKTtcbiAgICAgICAgICAgIGNvbnN0IGljbyA9IGUuY3VycmVudFRhcmdldC5xdWVyeVNlbGVjdG9yKCdpLmljb24nKTtcbiAgICAgICAgICAgIGlmIChpY28pIHtcbiAgICAgICAgICAgICAgaWNvLmNsYXNzTGlzdC50b2dnbGUoJ2ljb24tZm9sZGVyLXNtJyk7XG4gICAgICAgICAgICAgIGljby5jbGFzc0xpc3QudG9nZ2xlKCdpY29uLWZvbGRlci1vcGVuLXNtJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZGlybGlzdC5jbGFzc0xpc3QuY29udGFpbnMoJ29uJykpIHtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2lzIG9uJywgZGlybGlzdClcbiAgICAgICAgICAgICAgaWYgKCFkaXJsaXN0LmRhdGFzZXQubG9hZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2VydmVyTGlzdChkaXJsaXN0LCAoKHN1YmRpcikgPyBzdWJkaXIgKyAnLycgOiAnLycpICsgZGlybGlzdC5kYXRhc2V0Lm5hbWUsIHRhZyk7XG5cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuXG4gICAgICAgIH0pO1xuXG4gICAgICB9XG4gICAgICBhd2FpdCB0aGlzLmFkZFVwbG9hZERpYWxvZygoc3ViZGlyID09PSBudWxsKSA/IHRoaXMuY29udGFpbmVyIDogcGFyZW50KTtcbiAgICAgIHBhcmVudC5jbGFzc0xpc3QucmVtb3ZlKCd3YWl0Jyk7XG4gICAgICBwYXJlbnQuZGF0YXNldC5sb2FkZWQgPSB0cnVlO1xuICAgICAgcGFyZW50LmNsYXNzTGlzdC5hZGQoJ29uJyk7XG4gICAgICBpZiAoc3ViZGlyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdzdWJkaXIgYXR0YWNoJywgcGFyZW50KTtcbiAgICAgICAgYXR0YWNoX2NvbnRyb2xzKHBhcmVudCwgJ2VudHJ5RCcpO1xuICAgICAgICB0aGlzLnNldERyb3BUYXJnZXQocGFyZW50KTtcbiAgICAgIH1cbiAgICB9KTtcblxuICB9XG5cbiAgYXR0YWNoRHJvcHpvbmUodGFyZ2V0KSB7XG4gICAgaWYgKHRoaXMuZHJvcHpvbmUuZGF0YXNldC5lbmFibGVkKSB7XG4gICAgICB0aGlzLnRhcmdldGRpciA9IHRhcmdldDtcbiAgICAgIHRhcmdldC5hcHBlbmQodGhpcy5kcm9wem9uZSk7XG4gICAgfVxuICB9XG4gIGRldGFjaERyb3B6b25lKCkge1xuICAgIGlmICh0aGlzLmRyb3B6b25lLmRhdGFzZXQuZW5hYmxlZCkge1xuICAgICAgdGhpcy50YXJnZXRkaXIgPSBudWxsO1xuICAgICAgdGhpcy5jb250YWluZXIuYXBwZW5kKHRoaXMuZHJvcHpvbmUpO1xuICAgIH1cbiAgfVxuXG4gIG9wZW5EaXJEaWFsb2coYWNjZXB0LCBjYWxsYmFjaykge1xuICAgIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpO1xuICAgIGlucHV0LnR5cGUgPSBcImZpbGVcIjtcbiAgICBpbnB1dC5kaXJlY3RvcnkgPSB0cnVlO1xuICAgIGlucHV0Lm11bHRpcGxlID0gdHJ1ZTtcbiAgICBpbnB1dC53ZWJraXRkaXJlY3RvcnkgPSB0cnVlO1xuICAgIGlucHV0LmFsbG93ZGlycyA9IHRydWU7XG4gICAgaW5wdXQuYWNjZXB0ID0gYWNjZXB0O1xuICAgIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgY2FsbGJhY2spO1xuICAgIGlucHV0LmRpc3BhdGNoRXZlbnQobmV3IE1vdXNlRXZlbnQoXCJjbGlja1wiKSk7XG4gIH1cbiAgaGFuZGxlRHJhZ092ZXIoZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBlLmRhdGFUcmFuc2Zlci5kcm9wRWZmZWN0ID0gXCJtb3ZlXCI7XG4gIH1cbiAgLy8gYnJvd3NlXG4gIGFzeW5jIGhhbmRsZUJyb3dzZSgpIHtcbiAgICB0aGlzLmluaXRUaW1lcigpO1xuICAgIHRoaXMub3BlbkRpckRpYWxvZyhhY2NlcHQsIGFzeW5jIChlKSA9PiB7XG4gICAgICBjb25zdCBmaWxlcyA9IGUudGFyZ2V0LmZpbGVzO1xuICAgICAgdGhpcy50b2dnbGVDb3VudGVycyh0cnVlKTtcbiAgICAgIGF3YWl0IHRoaXMuanNEaXJUb1ppcC5zY2FuRmlsZXMoZmlsZXMpO1xuICAgIH0pO1xuICB9XG4gIC8vIG9yIGRyYWcmZHJvcFxuICBhc3luYyBoYW5kbGVEcm9wKGUpIHtcbiAgICBsZXQgZGF0YVRyYW5zZmVyO1xuICAgIGlmIChlLmRhdGFUcmFuc2Zlcikge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgZGF0YVRyYW5zZmVyID0gZS5kYXRhVHJhbnNmZXI7XG4gICAgfSBlbHNlIGRhdGFUcmFuc2ZlciA9IGU7XG4gICAgdGhpcy5kb25lID0gZmFsc2U7XG4gICAgdGhpcy5pbml0VGltZXIoKTtcbiAgICBjb25zdCBpdGVtcyA9IFsuLi4oKGRhdGFUcmFuc2Zlci5pdGVtcykgPyBkYXRhVHJhbnNmZXIuaXRlbXMgOiBkYXRhVHJhbnNmZXIuZmlsZXMpXTtcbiAgICBpZiAoaXRlbXMubGVuZ3RoKSB7XG4gICAgICB0aGlzLmVuYWJsZURyb3B6b25lKGZhbHNlKTtcbiAgICAgIGF3YWl0IGl0ZW1zLmZvckVhY2goYXN5bmMgaXRlbSA9PiB7XG4gICAgICAgIGlmIChpdGVtLmtpbmQgPT09IFwiZmlsZVwiKSB7XG4gICAgICAgICAgaXRlbSA9IGF3YWl0IGl0ZW0ud2Via2l0R2V0QXNFbnRyeSgpO1xuICAgICAgICAgIHRoaXMudG9nZ2xlQ291bnRlcnModHJ1ZSk7XG4gICAgICAgICAgYXdhaXQgdGhpcy5yZWFkRW50cnkoaXRlbSk7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfVxuICB9XG4gIHNob3dDb21wbGV0ZSgpIHtcbiAgICB0aGlzLnRpbWVyID0gKG5ldyBEYXRlKCkgLSB0aGlzLnRpbWVyKSAvIDEwMDA7XG4gICAgY29uc29sZS5sb2coJ2l0ZW0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tJyArIHBhcnNlSW50KHRoaXMudGltZXIgLyA2MCkgKyAnIC0tLSAnICsgKFxuICAgICAgdGhpcy50aW1lciAtIChwYXJzZUludCh0aGlzLnRpbWVyIC8gNjApICogNjApKSk7XG4gICAgdGhpcy5lbmFibGVEcm9wem9uZSgpO1xuICB9XG5cbiAgc3RvcE9uRXJyb3IoZXJyKSB7XG4gICAgY29uc29sZS5sb2coJ2VycicsIGVycik7XG4gIH1cblxuICBlbmFibGVEcm9wem9uZShlbmFibGUgPSB0cnVlLCBkZXN0cm95ID0gZmFsc2UpIHtcbiAgICBpZiAoZGVzdHJveSkgdGhpcy5kcm9wem9uZS5jbGFzc0xpc3QuYWRkKGNzcy5oaWRlKTtcbiAgICBpZiAoZW5hYmxlKSB0aGlzLmRyb3B6b25lLmRhdGFzZXQuZW5hYmxlZCA9IHRydWU7XG4gICAgZWxzZSBkZWxldGUgdGhpcy5kcm9wem9uZS5kYXRhc2V0LmVuYWJsZWQ7XG5cbiAgfVxuXG4gIGFkZENvbnNvbGVNZXNzYWdlKG1lc3NhZ2UpIHtcbiAgICAvL21lc3NhZ2Uge21lc3NhZ2U6LCBwYXJlbnQ6fVxuICAgIGNvbnN0IHRhZyA9ICdwJztcbiAgICBsZXQgZWwgPSBtZXNzYWdlLnBhcmVudC5xdWVyeVNlbGVjdG9yKCcuJyArIGNzcy5jb25zb2xlKTtcbiAgICBpZiAoZWwgPT09IG51bGwpIHtcbiAgICAgIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICBlbC5jbGFzc0xpc3QuYWRkKGNzcy5jb25zb2xlKTtcbiAgICAgIG1lc3NhZ2UucGFyZW50LnByZXBlbmQoZWwpO1xuICAgIH1cbiAgICBpZiAobWVzc2FnZS5pZCkge1xuICAgICAgY29uc3QgbXNnID0gZWwucXVlcnlTZWxlY3RvcihgJHt0YWd9W2RhdGEtaWQ9XCIke21lc3NhZ2UuaWR9XCJdYCk7XG4gICAgICBpZiAobXNnKSBtc2cuaW5uZXJIVE1MID0gbWVzc2FnZS5jb250ZW50O1xuICAgICAgZWxzZSBlbC5pbnNlcnRBZGphY2VudEhUTUwoJ2JlZm9yZWVuZCcsIGA8JHt0YWd9IGRhdGEtaWQ9XCIke21lc3NhZ2UuaWR9XCI+JHttZXNzYWdlLmNvbnRlbnR9PC8ke3RhZ30+YCk7XG4gICAgfSBlbHNlIGVsLmluc2VydEFkamFjZW50SFRNTCgnYmVmb3JlZW5kJywgYDwke3RhZ30+JHttZXNzYWdlLmNvbnRlbnR9PC8ke3RhZ30+YCk7XG5cbiAgfVxuXG4gIGFzeW5jIGFkZFVwbG9hZERpYWxvZyhpdGVtKSB7XG4gICAgaXRlbSA9IChpdGVtKSA/IGl0ZW0gOiB0aGlzLmNvbnRhaW5lcjtcbiAgICBpZiAodGhpcy5vcHRpb25zLmNvbnRyb2xzLnNjYW4pIHtcbiAgICAgIHRoaXMuZW5hYmxlRHJvcHpvbmUodHJ1ZSk7XG4gICAgICB0aGlzLmF0dGFjaERyb3B6b25lKGl0ZW0pO1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy5jb250cm9scy56aXApIHtcbiAgICAgICAgY29uc3Qge1xuICAgICAgICAgIEpzRGlyVG9aaXBcbiAgICAgICAgfSA9IGF3YWl0IGltcG9ydCgnLi4vbW9kdWxlcy9maWxlcy9qcy1kaXJ0b3ppcC5qcycpO1xuICAgICAgICB0aGlzLmpzRGlyVG9aaXAgPSBuZXcgSnNEaXJUb1ppcCgpO1xuICAgICAgICB0aGlzLmpzRGlyVG9aaXAub24odGhpcy5qc0RpclRvWmlwLmV2ZW50bmFtZXMucmVhZHksIChlKSA9PiB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ3JlYWR5JylcbiAgICAgICAgICB0aGlzLmluaXRDb250cm9scygpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5qc0RpclRvWmlwLm9uKHRoaXMuanNEaXJUb1ppcC5ldmVudG5hbWVzLm1lc3NhZ2UsIGFzeW5jIChlKSA9PiB7XG4gICAgICAgICAgc3dpdGNoIChlLm5hbWUpIHtcbiAgICAgICAgICAgIGNhc2UgJ2NvbnNvbGUnOlxuICAgICAgICAgICAgICB0aGlzLmFkZENvbnNvbGVNZXNzYWdlKHtcbiAgICAgICAgICAgICAgICBpZDogKGUuaWQpID8gZS5pZCA6IG51bGwsXG4gICAgICAgICAgICAgICAgY29udGVudDogZS5tZXNzYWdlLFxuICAgICAgICAgICAgICAgIHBhcmVudDogKGUucGFyZW50KSA/IGl0ZW0gOiB0aGlzLmNvbnRhaW5lclxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIHdpbmRvdy5hbGVydGJveC5hbGVydGNvbmZpZy50eXBlcy5lcnJvcjpcbiAgICAgICAgICAgIGNhc2Ugd2luZG93LmFsZXJ0Ym94LmFsZXJ0Y29uZmlnLnR5cGVzLnN1Y2Nlc3M6XG4gICAgICAgICAgICBjYXNlIHdpbmRvdy5hbGVydGJveC5hbGVydGNvbmZpZy50eXBlcy5kYW5nZXI6XG4gICAgICAgICAgICBjYXNlIHdpbmRvdy5hbGVydGJveC5hbGVydGNvbmZpZy50eXBlcy5pbmZvOlxuICAgICAgICAgICAgICB3aW5kb3cuYWxlcnRib3gucmVuZGVyQWxlcnQoe1xuICAgICAgICAgICAgICAgIHR5cGU6IGUubmFtZSxcbiAgICAgICAgICAgICAgICBjb250ZW50OiBlLm1lc3NhZ2UsXG4gICAgICAgICAgICAgICAgZGlzbWlzc2libGU6IHRydWUsXG4gICAgICAgICAgICAgICAgaW52ZXJzZTogZmFsc2VcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlcnJvcicsIGUpO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdtZXNzYWdlJywgZSk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfSlcblxuXG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuICAgICAgICB0aGlzLmpzRGlyVG9aaXAub24odGhpcy5qc0RpclRvWmlwLmV2ZW50bmFtZXMucmVhZHksIChlKSA9PiB7XG4gICAgICAgICAgc2VsZi5zaG93Q29udHJvbCh0aGlzLmpzRGlyVG9aaXAuZXZlbnRuYW1lcy5yZWFkeSk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmpzRGlyVG9aaXAub24odGhpcy5qc0RpclRvWmlwLmV2ZW50bmFtZXMuY291bnRlciwgKGUpID0+IHtcbiAgICAgICAgICBzZWxmLmZpbGVDb3VudGVyKGUubmFtZSwgZS5maWxlcGF0aCwgZS5zaXplKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuanNEaXJUb1ppcC5vbih0aGlzLmpzRGlyVG9aaXAuZXZlbnRuYW1lcy5jb21wbGV0ZSwgKGUpID0+IHtcbiAgICAgICAgICBpZiAoIWUgfHwgIWUubmFtZSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ25vIGVtaXQgY29tcGxldGUgbmFtZScpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBzZWxmLnNob3dDb250cm9sKGUubmFtZSwgKChlLmhhc093blByb3BlcnR5KCdiaWdmaWxlJykgJiYgZS5iaWdmaWxlKSA/ICd6aXBwZWQnIDogJ3ppcCcpLCAoZS5oYXNPd25Qcm9wZXJ0eSgncGFydCcpKSA/IGUucGFydCA6ICgoZS5oYXNPd25Qcm9wZXJ0eSgnYmlnZmlsZScpKSA/IGUuYmlnZmlsZSA6IG51bGwpKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuanNEaXJUb1ppcC5vbih0aGlzLmpzRGlyVG9aaXAuZXZlbnRuYW1lcy5wZW5kaW5nLCAoZSkgPT4ge1xuICAgICAgICAgIHNlbGYuc2hvd0NvbnRyb2wodGhpcy5qc0RpclRvWmlwLmV2ZW50bmFtZXMucGVuZGluZywgKChlICYmIGUuaGFzT3duUHJvcGVydHkoJ2JpZ2ZpbGUnKSAmJiBlLmJpZ2ZpbGUpID8gJ3ppcHBlZCcgOiAnemlwJykpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5qc0RpclRvWmlwLm9uKHRoaXMuanNEaXJUb1ppcC5ldmVudG5hbWVzLmd6aXAsIChlKSA9PiB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ2d6aXBwZWQnLCBlKVxuICAgICAgICAgIHNlbGYuc2hvd0NvbnRyb2wodGhpcy5qc0RpclRvWmlwLmV2ZW50bmFtZXMuZ3ppcCwgJ3ppcHBlZCcsIGUpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5qc0RpclRvWmlwLm9uKHRoaXMuanNEaXJUb1ppcC5ldmVudG5hbWVzLnRlcm1pbmF0ZSwgKGUpID0+IHtcbiAgICAgICAgICBjb25zb2xlLmxvZygndGVybWluYXRlJywgZSlcbiAgICAgICAgICBzZWxmLnNob3dDb250cm9sKHRoaXMuanNEaXJUb1ppcC5ldmVudG5hbWVzLnRlcm1pbmF0ZSwgKChlICYmIGUuaGFzT3duUHJvcGVydHkoJ2JpZ2ZpbGUnKSAmJiBlLmJpZ2ZpbGUpID8gJ3ppcHBlZCcgOiAnemlwJykpO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgIH1cblxuICB9XG4gIGFzeW5jIHJlYWRFbnRyeShlbnRyeSkge1xuICAgIGF3YWl0IHRoaXMuanNEaXJUb1ppcC5zY2FuSGFuZGxlKGVudHJ5KTtcbiAgfVxuICBnZXRDdXJyZW50RGlyUGF0aCgpIHtcbiAgICBpZiAodGhpcy50YXJnZXRkaXIgPT09IG51bGwpIHJldHVybiAnJztcbiAgICBjb25zdCBjdXJyZW50X3BhdGggPSAoZWwsIGRpcnMgPSBbXSkgPT4ge1xuXG4gICAgICBpZiAoZWwgIT0gbnVsbCkge1xuICAgICAgICBkaXJzLnB1c2goZWwuZGF0YXNldC5uYW1lKTtcbiAgICAgICAgZWwgPSBlbC5jbG9zZXN0KCcuZW50cnlEJyk7XG4gICAgICAgIGlmIChlbCAhPT0gbnVsbCkge1xuICAgICAgICAgIGVsID0gZWwucGFyZW50RWxlbWVudDtcbiAgICAgICAgICBpZiAoZWwgIT09IG51bGwgJiYgZWwuZGF0YXNldC5uYW1lKSBjdXJyZW50X3BhdGgoZWwsIGRpcnMpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gZGlycztcbiAgICB9XG4gICAgY29uc3QgZGlycyA9IGN1cnJlbnRfcGF0aCh0aGlzLnRhcmdldGRpcik7XG4gICAgcmV0dXJuIGRpcnMuam9pbihkaXJzZXBhcmF0b3IpO1xuICB9XG5cbiAgYXN5bmMgYWRkRmlsZXNTdG9yZShuYW1lLCBjYWxsYmFjaykge1xuICAgIG5hbWUgPSAobmFtZSkgPyBuYW1lIDogdGhpcy5vcHRpb25zLmRibmFtZTtcbiAgICBpZiAoIXRoaXMuanNGaWxlc1N0b3JlKSB7XG4gICAgICBjb25zdCB7XG4gICAgICAgIEpzRmlsZXNTdG9yZVxuICAgICAgfSA9IGF3YWl0IGltcG9ydCgnLi4vbW9kdWxlcy9maWxlcy9qcy1maWxlc3lzdGVtLmpzJyk7XG4gICAgICB0aGlzLmpzRmlsZXNTdG9yZSA9IG5ldyBKc0ZpbGVzU3RvcmUobnVsbCwgY2FsbGJhY2spO1xuICAgICAgdGhpcy5kaXNwbGF5RmlsZXMoKTtcbiAgICB9XG4gICAgaWYgKGNhbGxiYWNrKSBhd2FpdCBjYWxsYmFjaygpO1xuICB9XG4gIGRpc3BsYXlGaWxlcygpIHtcbiAgICB0aGlzLmpzRmlsZXNTdG9yZS5nZXRJdGVtcygnbG9jYWwnKTtcbiAgfVxuXG4gIGZpbGVDb3VudGVyKGl0ZW0sIGZpbGVwYXRoLCBzaXplID0gbnVsbCkge1xuICAgIGNvbnN0IGNvdW50ZXJzID0gdGhpcy5jb3VudGVyc1tpdGVtXTtcbiAgICBjb3VudGVycy5jb3VudGVyKys7XG4gICAgaWYgKHNpemUgIT09IG51bGwpIGNvdW50ZXJzLnNpemUgKz0gcGFyc2VJbnQoc2l6ZSk7XG4gICAgY291bnRlcnMuZGlzcGxheS5jb3VudGVyLnRleHRDb250ZW50ID0gY291bnRlcnMuY291bnRlcjtcbiAgICBpZiAoY291bnRlcnMuZGlzcGxheS5zaXplKSBjb3VudGVycy5kaXNwbGF5LnNpemUudGV4dENvbnRlbnQgPSBmb3JtYXRfYnl0ZXMoY291bnRlcnMuc2l6ZSk7XG4gICAgdGhpcy5qc0RpclRvWmlwLnF1b3RhRXN0aW1hdGUoKTtcbiAgfVxuXG4gIHJlc2V0Q291bnRlcihpdGVtKSB7XG4gICAgY29uc3QgY291bnRlcnMgPSB0aGlzLmNvdW50ZXJzW2l0ZW1dO1xuICAgIFsnY291bnRlcicsICdzaXplJ10uZm9yRWFjaChlbCA9PiB7XG4gICAgICBjb3VudGVycy5kaXNwbGF5W2VsXS50ZXh0Q29udGVudCA9IDA7XG4gICAgfSk7XG4gICAgdGhpcy50b2dnbGVDb3VudGVycyhmYWxzZSk7XG4gIH1cblxuICB0b2dnbGVDb3VudGVycyhzaG93ID0gdHJ1ZSkge1xuICAgIGNvbnN0IGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy5vcHRpb25zLmRpc3BsYXkucHJvZ3Jlc3Npb24pO1xuICAgIGlmICghZWwpIHJldHVybjtcbiAgICBpZiAoc2hvdykgZWwuY2xhc3NMaXN0LnJlbW92ZShjc3MuaGlkZSk7XG4gICAgZWxzZSBlbC5jbGFzc0xpc3QuYWRkKGNzcy5oaWRlKTtcbiAgfVxuXG4gIGluaXRGaWxlQ291bnRlcihpdGVtLCBvcHRzLCBpKSB7XG4gICAgY29uc3Qgc2VwID0gKGkpID8gYCAvIGAgOiBgYDtcbiAgICBsZXQgY291bnRlciA9IDA7XG4gICAgbGV0IGNvdW50ZXJkaXNwbGF5ID0gbnVsbDtcbiAgICBsZXQgc2l6ZSA9IDA7XG4gICAgbGV0IHNpemVkaXNwbGF5ID0gbnVsbDtcbiAgICAvLyBjcmVhdGUgZG9tIGRpc3BsYXkgZWxlbWVudHNcblxuXG4gICAgbGV0IGJveGNvdW50ZXJzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy5vcHRpb25zLmRpc3BsYXkucHJvZ3Jlc3Npb24pO1xuICAgIGNvbnN0IGl0ZW1vcHRzID0ge1xuICAgICAgZGlzcGxheToge30sXG5cbiAgICB9O1xuICAgIE9iamVjdC5lbnRyaWVzKG9wdHMpLmZvckVhY2goKFtrLCB2YWxdKSA9PiB7XG4gICAgICBjb25zdCBjbCA9IGsgKyAncyc7XG4gICAgICBjb25zdCB0eHQgPSB7XG4gICAgICAgIGNvdW50ZXI6ICcgcmVhZCcsXG4gICAgICAgIHNpemU6ICcgcmVhZCcsXG4gICAgICAgIGNvdW50ZXJ6aXBwZWQ6ICcgY29tcHJlc3NlZCcsXG4gICAgICAgIHNpemV6aXBwZWQ6ICcgY29tcHJlc3NlZCdcbiAgICAgIH1cbiAgICAgIGxldCBlbGluc2VydCA9IGJveGNvdW50ZXJzLnF1ZXJ5U2VsZWN0b3IoJy4nICsgY2wpO1xuICAgICAgaWYgKCFlbGluc2VydCkgZWxpbnNlcnQgPSBjcmVhdGVfYm94KCdkaXYnLCB7XG4gICAgICAgIGNsYXNzOiBjbFxuICAgICAgfSwgYm94Y291bnRlcnMsIGBgKTtcbiAgICAgIGxldCBlbCA9IGVsaW5zZXJ0LnF1ZXJ5U2VsZWN0b3IoJy4nICsgdmFsKTtcbiAgICAgIGlmICghZWwpIHtcbiAgICAgICAgZWwgPSBjcmVhdGVfYm94KCdzcGFuJywge1xuICAgICAgICAgIGNsYXNzOiB2YWwsXG4gICAgICAgIH0sIGVsaW5zZXJ0KTtcbiAgICAgICAgaWYgKHR4dC5oYXNPd25Qcm9wZXJ0eSh2YWwpKSBlbGluc2VydC5hcHBlbmQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodHh0W3ZhbF0pKTtcbiAgICAgIH0gZWxzZSB0aGlzLnJlc2V0Q291bnRlcihpdGVtKTtcbiAgICAgIGl0ZW1vcHRzLmRpc3BsYXlba10gPSBlbDtcbiAgICAgIGl0ZW1vcHRzW2tdID0gMDtcbiAgICB9KTtcblxuICAgIHRoaXMuY291bnRlcnMgPSB7IC4uLnRoaXMuY291bnRlcnMsXG4gICAgICAuLi57XG4gICAgICAgIFtpdGVtXTogaXRlbW9wdHNcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgc2hvd0NvbnRyb2woYWN0aW9uLCB0YXJnZXQgPSAnemlwJywgb3B0cyA9IG51bGwpIHtcbiAgICBsZXQgbWVzc2FnZSwgdGV4dCA9IG51bGw7XG4gICAgLy8gJ3ppcCcgLS0tb25seSBidG4gZm9yIHppcCBhY3Rpb25zIGZvciB0aGUgbW9tZW50XG4gICAgY29uc3QgYnRuID0gdGhpc1t0aGlzLm9wdGlvbnMuYnRucHJlZml4ICsgJ3ppcCcgKyB0YXJnZXRdO1xuICAgIGlmICghYnRuKSByZXR1cm47XG4gICAgYnRuLnJlbW92ZUF0dHJpYnV0ZShcImRpc2FibGVkXCIpO1xuICAgIHN3aXRjaCAoYWN0aW9uKSB7XG4gICAgICBjYXNlIHRoaXMuanNEaXJUb1ppcC5ldmVudG5hbWVzLnJlYWR5OlxuICAgICAgICBpZiAoYnRuLmRhdGFzZXQubWVzc2FnZSkgZGVsZXRlIGJ0bi5kYXRhc2V0Lm1lc3NhZ2U7XG4gICAgICAgIGJ0bi5jbGFzc0xpc3QuYWRkKGNzcy5oaWRlKTtcbiAgICAgICAgdGhpcy5pbml0Q29udHJvbHMoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIHRoaXMuanNEaXJUb1ppcC5ldmVudG5hbWVzLmVuZHppcDpcbiAgICAgICAgY29uc3QgcGFydCA9IG9wdHM7XG4gICAgICAgIGlmICghcGFydCkgdGhpcy5zaG93Q29tcGxldGUoKTtcbiAgICAgICAgYnRuLnRleHRDb250ZW50ID0gYENsb3NlIHppcCBmaWxlYCArICgocGFydCkgPyBwYXJ0IDogYGApO1xuICAgICAgICBidG4udGl0bGUgPSAocGFydCkgPyBgWW91ciBmaWxlIGlzIHRvbyBiaWcgLSB5b3UgaGF2ZSB0byBzZW5kIHRoaXMgcGFydCBiZWZvcmUgY29udGludWluZyB0byBwcm9jZXNzIHRoZSBkaXJlY3RvcnlgIDogYENsaWNrIHRvIGVuZCB6aXAgZmlsZWA7XG4gICAgICAgIG1lc3NhZ2UgPSB7XG4gICAgICAgICAgbmFtZTogdGhpcy5qc0RpclRvWmlwLmV2ZW50bmFtZXMuZW5kemlwLFxuICAgICAgICAgIHBhcnQ6IHBhcnQsXG4gICAgICAgICAgYmlnZmlsZTogKHRhcmdldCAhPT0gJ3ppcCcpLFxuICAgICAgICB9O1xuICAgICAgICBpZiAocGFydCkgbWVzc2FnZVtcInBhcnRcIl0gPSBwYXJ0O1xuICAgICAgICBidG4uZGF0YXNldC5tZXNzYWdlID0gSlNPTi5zdHJpbmdpZnkobWVzc2FnZSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSB0aGlzLmpzRGlyVG9aaXAuZXZlbnRuYW1lcy5iaWdmaWxlOlxuICAgICAgICBidG4udGV4dENvbnRlbnQgPSBgVXBsb2FkIGJpZyBGaWxlIHNlcGFyYXRlbHlgO1xuICAgICAgICBtZXNzYWdlID0ge1xuICAgICAgICAgIG5hbWU6IHRoaXMuanNEaXJUb1ppcC5ldmVudG5hbWVzLmJpZ2ZpbGUsXG4gICAgICAgICAgcGF0aDogdGhpcy5nZXRDdXJyZW50RGlyUGF0aCgpLFxuICAgICAgICAgIGJpZ2ZpbGU6IHRydWVcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBmaWxlcGF0aCA9IG9wdHM7XG4gICAgICAgIGlmIChmaWxlcGF0aCkgbWVzc2FnZVtcInBhdGhcIl0gPSBmaWxlcGF0aDtcbiAgICAgICAgYnRuLmRhdGFzZXQubWVzc2FnZSA9IEpTT04uc3RyaW5naWZ5KG1lc3NhZ2UpO1xuICAgICAgICBjb25zb2xlLmxvZygnYmlnZmlsZScsIG1lc3NhZ2UpXG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSB0aGlzLmpzRGlyVG9aaXAuZXZlbnRuYW1lcy5zZW5kZmlsZTpcbiAgICAgICAgbWVzc2FnZSA9IHtcbiAgICAgICAgICBuYW1lOiB0aGlzLmpzRGlyVG9aaXAuZXZlbnRuYW1lcy5zZW5kZmlsZSxcbiAgICAgICAgICBwYXRoOiB0aGlzLmdldEN1cnJlbnREaXJQYXRoKCksXG4gICAgICAgICAgYmlnZmlsZTogb3B0cyxcbiAgICAgICAgfTtcbiAgICAgICAgYnRuLnRleHRDb250ZW50ID0gYFVwbG9hZCB6aXAgZmlsZWA7XG4gICAgICAgIGlmIChtZXNzYWdlLmJpZ2ZpbGUgIT09IG51bGwpIGJ0bi50ZXh0Q29udGVudCArPSBgIGAgKyBvcHRzO1xuICAgICAgICBidG4uZGF0YXNldC5tZXNzYWdlID0gSlNPTi5zdHJpbmdpZnkobWVzc2FnZSk7XG4gICAgICAgIGNvbnNvbGUubG9nKCdtZXNzYWdldXAnLCBtZXNzYWdlKVxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgdGhpcy5qc0RpclRvWmlwLmV2ZW50bmFtZXMucGVuZGluZzpcbiAgICAgICAgYnRuLnRleHRDb250ZW50ID0gYCBQZW5kaW5nIGAgKyAoKHRhcmdldCAhPT0gJ3ppcCcpID8gJyBiaWcgZmlsZScgOiAnJyk7XG4gICAgICAgIGJ0bi5kYXRhc2V0Lm1lc3NhZ2UgPSAnJztcbiAgICAgICAgYnRuLnNldEF0dHJpYnV0ZShcImRpc2FibGVkXCIsIHRydWUpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgdGhpcy5qc0RpclRvWmlwLmV2ZW50bmFtZXMuZ3ppcDpcbiAgICAgICAgdGV4dCA9IGBjb21wcmVzc2luZyBzZXBhcmF0ZWx5IGJpZyBmaWxlIDokeyhvcHRzICYmIG9wdHMuYmlnZmlsZSk/b3B0cy5iaWdmaWxlOmBgfSAkeyhvcHRzICYmIG9wdHMuc2l6ZSk/b3B0cy5zaXplOmBgfWA7XG4gICAgICAgIGJ0bi50ZXh0Q29udGVudCA9IHRleHQ7XG4gICAgICAgIGJ0bi5zZXRBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiLCB0cnVlKTtcbiAgICAgICAgY29uc29sZS5sb2coJ29wdHNiaWdmbCcsIG9wdHMpXG4gICAgICAgIGJ0bi5kYXRhc2V0Lm1lc3NhZ2UgPSBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgbmFtZTogdGhpcy5qc0RpclRvWmlwLmV2ZW50bmFtZXMuZW5kemlwLFxuICAgICAgICAgIHBhdGg6IChvcHRzLmhhc093blByb3BlcnR5KFwiYmlnZmlsZVwiKSkgPyBvcHRzLmJpZ2ZpbGUgOiBlLnBhdGgsXG4gICAgICAgICAgYmlnZmlsZTogKG9wdHMuaGFzT3duUHJvcGVydHkoXCJiaWdmaWxlXCIpICYmIG9wdHMuYmlnZmlsZSAhPT0gXCJcIiksXG4gICAgICAgIH0pO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgdGhpcy5qc0RpclRvWmlwLmV2ZW50bmFtZXMudGVybWluYXRlOlxuICAgICAgICBjb25zb2xlLmxvZygndGVybWluYXRlICcgKyAoKHRhcmdldCAhPT0gJ3ppcCcpID8gJ2JpZ2ZpbGUnIDogJycpKTtcbiAgICAgICAgdGhpcy5zZXJ2ZXJMaXN0KHRoaXMudGFyZ2V0ZGlyKTtcbiAgICAgICAgLy9kZWZhdWx0OlxuICAgICAgICBidG4uZGF0YXNldC5tZXNzYWdlID0gSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgIG5hbWU6ICdyZWFkeScsXG4gICAgICAgICAgYmlnZmlsZTogKHRhcmdldCAhPT0gJ3ppcCcpXG4gICAgICAgIH0pO1xuICAgICAgICBidG4udGV4dENvbnRlbnQgPSBgRW5kISEgJHsgKCh0YXJnZXQgIT09ICd6aXAnKSA/ICdiaWdmaWxlJyA6ICcnKX1gO1xuXG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBpZiAoYnRuLmRhdGFzZXQubWVzc2FnZSkgYnRuLmNsYXNzTGlzdC5yZW1vdmUoY3NzLmhpZGUpO1xuICB9XG4gIGVtaXRUb1ppcChidG4pIHtcbiAgICBjb25zdCBtZXNzYWdlID0gKGJ0bi5kYXRhc2V0Lm1lc3NhZ2UpID8gSlNPTi5wYXJzZShidG4uZGF0YXNldC5tZXNzYWdlKSA6IG51bGw7XG4gICAgaWYgKCFtZXNzYWdlKSBidG4uY2xhc3NMaXN0LmFkZChjc3MuaGlkZSk7XG4gICAgaWYgKG1lc3NhZ2UpIHtcbiAgICAgIGlmIChtZXNzYWdlLm5hbWUpIHtcbiAgICAgICAgY29uc3QgbmFtZSA9IG1lc3NhZ2UubmFtZTtcbiAgICAgICAgZGVsZXRlIG1lc3NhZ2UubmFtZTtcbiAgICAgICAgY29uc29sZS5sb2coJ2VtaXQgLS0tLScgKyBuYW1lLCBtZXNzYWdlKVxuICAgICAgICB0aGlzLmpzRGlyVG9aaXAuZW1pdChuYW1lLCBtZXNzYWdlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKG5hbWUgPT09IHRoaXMuanNEaXJUb1ppcC5ldmVudG5hbWVzLnNlbmRmaWxlKSBidG4uZGlzYWJsZWQgPSB0cnVlO1xuICB9XG4gIGdldEJ0bihpdGVtLCB0YXJnZXQpIHtcbiAgICBjb25zdCBidG5rZXkgPSB0aGlzLm9wdGlvbnMuYnRucHJlZml4ICsgaXRlbSArIHRhcmdldDtcbiAgICBpZiAodGhpc1tidG5rZXldKSByZXR1cm4gdGhpc1tidG5rZXldO1xuICAgIGNvbnN0IGRpc3BsYXkgPSB0aGlzLm9wdGlvbnMuY29udHJvbHNbaXRlbV0uYnRuW3RhcmdldF07XG4gICAgY29uc3QgYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZGlzcGxheSk7XG4gICAgY29uc3QgcGFyZW50ID0gKHRoaXMudGFyZ2V0ZGlyKSA/IHRoaXMudGFyZ2V0ZGlyIDogdGhpcy5kaXNwbGF5cHJvZ3Jlc3Npb247XG4gICAgaWYgKCFidG4pIHtcbiAgICAgIHBhcmVudC5pbnNlcnRBZGphY2VudEhUTUwoJ2JlZm9yZWVuZCcsIGA8YnV0dG9uIGlkPVwiJHtkaXNwbGF5fVwiIGNsYXNzPVwiYnV0dG9uICR7ZGlzcGxheX0gJHtsb2NhbGNzcy5tcmlnaHR9ICR7Y3NzLmhpZGV9XCI+PC9idXR0b24+YCk7XG4gICAgICB0aGlzW2J0bmtleV0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChkaXNwbGF5KTtcbiAgICAgIHRoaXNbYnRua2V5XS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jIChlKSA9PiB7XG4gICAgICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG4gICAgICAgIHRoaXMuZW1pdFRvWmlwKGUuY3VycmVudFRhcmdldCk7XG4gICAgICB9KTtcbiAgICB9IGVsc2UgcGFyZW50LmFwcGVuZChidG4pO1xuICAgIHJldHVybiB0aGlzW2J0bmtleV07XG4gIH1cblxuICBpbml0Q29udHJvbHMoaXRlbSA9IG51bGwpIHtcbiAgICBPYmplY3QuZW50cmllcyh0aGlzLm9wdGlvbnMuY29udHJvbHMpLmZvckVhY2goKFtrZXksIGNvbnRyb2xdLCBpKSA9PiB7XG4gICAgICB0aGlzLmluaXRGaWxlQ291bnRlcihrZXksIGNvbnRyb2wuZGlzcGxheSwgaSk7XG4gICAgICBpZiAoY29udHJvbC5idG4pIHRoaXMuYWN0aXZhdGVDb250cm9scyhrZXksIGNvbnRyb2wuYnRuKTtcbiAgICB9KTtcbiAgfVxuICBhY3RpdmF0ZUNvbnRyb2xzKGtleSwgYnRucykge1xuICAgIE9iamVjdC5rZXlzKGJ0bnMpLmZvckVhY2goKGJ0bikgPT4ge1xuICAgICAgdGhpc1t0aGlzLm9wdGlvbnMuYnRucHJlZml4ICsga2V5ICsgYnRuXSA9IHRoaXMuZ2V0QnRuKGtleSwgYnRuKTtcbiAgICB9KVxuXG4gIH1cbn0iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/modules/js-my-files.js\n")}}]);