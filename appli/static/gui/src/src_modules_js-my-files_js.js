/*! For license information please see src_modules_js-my-files_js.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["src_modules_js-my-files_js"],{"./src/modules/js-my-files.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   JsMyFiles: () => (/* binding */ JsMyFiles)\n/* harmony export */ });\n/* harmony import */ var _modules_utils_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../modules/utils.js */ \"./src/modules/utils.js\");\n/* harmony import */ var _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../modules/modules-config.js */ \"./src/modules/modules-config.js\");\n\n\n\nconst accept = '.tsv,.png,.jpg, .jpeg,.zip,.gz,.7z,.bz2';\nconst localcss = {\n  mright: 'mr-4',\n}\nlet instance = null;\nclass JsMyFiles {\n  done = true;\n  jsDirToZip = null;\n  counters = {};\n  path = '';\n  _events = {};\n  eventnames = {\n    complete: 'complete',\n    error: 'error',\n  }\n  constructor(container, options = {}) {\n    if (!instance) {\n      container = (container instanceof HTMLElement) ? container : document.querySelector(container);\n      if (!container) return;\n      (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.dom_purify)(container, 'dataset');\n      this.container = container;\n      console.log(\"/gui/files/list\")\n      const defaultOptions = {\n\n        url: \"/gui/files/list\",\n        compress: {\n          label: 'compress'\n        },\n        counters: {\n          id: 'display-file-counters',\n        },\n        controls: {\n          zip: {\n            btn: {\n              zip: 'makezip',\n              zipped: 'makezipped'\n            },\n            display: {\n              size: 'sizezipped',\n              counter: 'counterzipped',\n            }\n          },\n          scan: {\n            display: {\n              counter: 'counter',\n              size: 'size',\n            }\n          },\n        },\n        upload: {\n          label: 'upload'\n        },\n        btnprefix: 'btn',\n        btnfilelist: null,\n        selector: {\n          doupload: '.target-upload',\n          droptarget: '.droptarget',\n          trigger: '.trigger',\n          dirlist: '.dirlist',\n          entries: '.entries',\n          uploadfile: 'uploadfile',\n          displayresult: 'results',\n        },\n        display: {\n\n          local: 'local-list',\n          server: 'server-list',\n          dropzone: 'dropzone',\n          dirlist: 'dirlist',\n          boxtitle: 'boxtitle',\n        },\n\n\n        css: {\n          enabled: 'enabled'\n        }\n      };\n      this.options = Object.assign(defaultOptions, options);\n      this.init();\n      instance = this;\n    }\n    return instance;\n  }\n  init() {\n    // create dirlist box\n    let el = this.container.querySelector(this.options.selector.dirlist);\n    if (!el) {\n      el = document.createElement('div');\n      el.classList.add(this.options.selector.dirlist.slice(1));\n      this.container.append(el)\n    }\n    if (this.options.btnfilelist) {\n      const btnfiles = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)('div', el, {\n        class: 'button is-secondary',\n        text: this.options.btnfilelist\n      });\n      btnfiles.addEventListener('click', (e) => {\n        this.serverList(el);\n        this.classList.toggle(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n      });\n    } else this.serverList(el);\n\n\n    //\n    // create a filepicker depends on browser\n    this.dropzone = document.createElement('div');\n    this.dropzone.id = this.options.display.dropzone;\n    this.dropzone.innerHTML = `<input type=\"file\" class=\"hidden\"  name=\"${this.options.selector.uploadfile}\" id=\"${this.options.selector.uploadfile}\">\n            <div class=\"${this.options.selector.droptarget.slice(1)}\">\n            <div id=\"${this.options.display.boxtitle}\"><span class=\"${this.options.selector.trigger.slice(1)}\">${this.container.dataset.textbrowse}</span>  ${this.container.dataset.textdrop}</div>\n          </div>`;\n    this.container.append(this.dropzone);\n    // add counters\n    el = document.getElementById(this.options.counters.id);\n    if (!el) {\n      console.log('counterscreate')\n      el = document.createElement('div');\n      el.id = this.options.counters.id;\n      el.innerHTML = `<div class=\"counters\"></div><div class=\"sizes\"></div><div class=\"progresss\"></div><div class=\"timers\"></div>`;\n      this.container.append(el);\n\n    }\n    this.displaylist = document.getElementById(this.options.display.dirlist);\n    const droptarget = this.container.querySelector(this.options.selector.droptarget);\n    droptarget.addEventListener('dragover', (e) => {\n      this.handleDragOver(e);\n    });\n    droptarget.addEventListener('drop', async (e) => {\n      this.handleDrop(e);\n    });\n    this.container.querySelector(this.options.selector.trigger).addEventListener('click', (e) => {\n      let datatransfer = e;\n      this.openDirDialog(accept, (e) => {\n        console.log('edrop', datatransfer)\n      });\n    });\n    (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.add_custom_events)(this);\n\n    this.on(this.eventnames.error, (e) => {\n      consoile.log('scandir recevie error messgae', e)\n    })\n    this.on(this.eventnames.processed, async (e) => {\n      if (this.nextaction) await this.nextaction();\n    })\n\n    window.addEventListener('beforeunload', (e) => {\n      if (!this.done) {\n        e.preventDefault();\n        e.returnValue = (this.options.preventclose) ? this.options.preventclose : `Some work is in progress in this window.\\nAre you sure you want to leave?`;\n      }\n\n    });\n\n\n  }\n  async addDirList(source) {\n\n  }\n  serverList(parent = null, subdir = null, tag = null) {\n    parent = parent ? parent : this.container.querySelector(this.options.selector.dirlist);\n    if (!parent) return;\n    parent.classList.add('wait');\n\n    const el = parent.querySelector(this.options.selector.entries);\n    if (el) el.remove();\n    tag = (tag) ? ((tag === 'select') ? 'optiongroup' : tag) : 'ul';\n    const subtag = (tag === 'ul') ? 'li' : 'option';\n    console.log('list subdir', subdir)\n    fetch(this.options.url + ((subdir) ? subdir : ''), (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.fetchSettings)()).then(response => response.json()).then(async json => {\n      console.log('jspn', json)\n      if (json.entries && json.entries.length) {\n        if (parent.dataset.label) parent.insertAdjacentHTML('afterbegin', `<label>${parent.dataset.label}</label>`);\n        let html = [`<${tag} class=\"${this.options.selector.entries.slice(1)}\">`],\n          files = [],\n          directories = [],\n          entries = json.entries;\n        while (entries.length > 0) {\n          const entry = entries.shift();\n          if (entry.type === 'F') files.push(entry);\n          else directories.push(entry);\n        };\n        files.sort((a, b) => (a.name < b.name));\n        directories.sort((a, b) => (a.name < b.name));\n        [directories, files].forEach(entries => {\n          entries.forEach((entry) => {\n            const ext = entry.name.split('.').pop();\n            const del = `<i class=\"icon-sm icon-trash delentry ml-2 hidden\" alt=\"delete\"></i>`;\n            const entrydetail = `<span class=\"entry${entry.type}\"><i class=\"icon p-[0.125rem] icon-${((entry.type === \"D\") ? 'folder-sm' : ((_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.filter_files.images.split(',').indexOf(ext)>=0)?'image-sm':'document-sm'))} align-text-bottom mb-0.5 mr-0.5\"></i>${entry.name}</span>`;\n            html.push(`<${subtag} ${(entry.type==='D')?`draggable=\"true\"`:``} data-name=\"${entry.name}\" ${(tag==='select')?` class=\"entry${entry.type}\"`:``}>${entrydetail}`);\n            html.push(`${del}</${subtag}>`);\n          });\n        });\n        html.push(`</${tag}>`);\n        parent.insertAdjacentHTML('beforeend', html.join(``));\n\n        parent.querySelectorAll('.entryD').forEach(dir => {\n          dir.addEventListener('click', (e) => {\n            e.stopImmediatePropagation();\n            const dirlist = e.currentTarget.parentElement;\n\n            dirlist.classList.toggle('on');\n            const ico = e.currentTarget.querySelector('i.icon');\n            if (ico) {\n              ico.classList.toggle('icon-folder-sm');\n              ico.classList.toggle('icon-folder-open-sm');\n            }\n            if (dirlist.classList.contains('on')) {\n              if (!dirlist.dataset.load) {\n                this.serverList(dirlist, ((subdir) ? subdir + '/' : '/') + dirlist.dataset.name, tag);\n              }\n            }\n          });\n          dir.querySelectorAll('.entryF').forEach(file => {\n            const del_file = () => {\n              alert('del', delfile.parentElement.dataset.name);\n            }\n            const trash = e.currentTarget.parentElement.querySelector('.delentry');\n            console.log('trash', trash)\n            file.addEventListener('mouseenter', (e) => {\n              console.log('file', e)\n              trash.classList.remove('hidden');\n              file.addEventListener('click', del_file);\n            });\n            file.addEventListener('mouseout', (e) => {\n              trash.classList.add('hidden');\n              file.removeEventListener('click', del_file);\n            });\n          });\n        });\n\n      }\n      await this.addUploadDialog(this.container);\n      parent.classList.remove('wait');\n      parent.dataset.loaded = true;\n\n    });\n\n  }\n\n  attachDropzone(target) {\n    this.targetdir = (target.parentElement.dataset.name) ? target.parentElement.dataset.name : '';\n    this.dropzone.classList.add(this.options.css.enabled);\n    target.append(this.dropzone);\n  }\n  detachDropzone() {\n    this.targetdir = null;\n    this.container.classList.remove(this.options.css.enabled);\n\n  }\n\n  openDirDialog(accept, callback) {\n    const input = document.createElement(\"input\");\n    input.type = \"file\";\n    input.directory = true;\n    input.multiple = true;\n    input.webkitdirectory = true;\n    input.allowdirs = true;\n    input.accept = accept;\n    input.addEventListener(\"change\", callback);\n    input.dispatchEvent(new MouseEvent(\"click\"));\n  }\n  handleDragOver(e) {\n    e.preventDefault();\n    e.dataTransfer.dropEffect = \"move\";\n  }\n\n  async handleDrop(e) {\n    let dataTransfer;\n    if (e.dataTransfer) {\n      e.preventDefault();\n      dataTransfer = e.dataTransfer;\n    } else dataTransfer = e;\n    this.done = false;\n    this.timer = new Date();\n    const items = [...((dataTransfer.items) ? dataTransfer.items : dataTransfer.files)];\n    if (items.length) {\n      this.enableDropzone(false);\n      await items.forEach(async item => {\n        if (item.kind === \"file\") {\n          item = await item.webkitGetAsEntry();\n          console.log('itemtoread', item)\n\n          await this.readEntry(item);\n        }\n      })\n    }\n  }\n  showComplete() {\n    this.timer = (new Date() - this.timer) / 1000;\n    console.log('item-------------------------------------' + parseInt(this.timer / 60) + ' --- ' + (\n      this.timer - (parseInt(this.timer / 60) * 60)));\n    this.enableDropzone();\n  }\n\n  stopOnError(err) {\n    console.log('err', err);\n  }\n\n  enableDropzone(enable = true, destroy = false) {\n    if (destroy) this.dropzone.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n    if (enable) this.dropzone.classList.add(this.options.css.enabled);\n    else this.dropzone.classList.remove(this.options.css.enabled);\n\n  }\n\n  async addUploadDialog(item) {\n    item = (item) ? item : this.container;\n    if (this.options.controls.scan) {\n      this.attachDropzone(item);\n      if (this.options.controls.zip) {\n        const {\n          JsDirToZip\n        } = await Promise.all(/*! import() */[__webpack_require__.e(\"vendors-node_modules_fflate_esm_browser_js\"), __webpack_require__.e(\"src_modules_files_js-dirtozip_js\")]).then(__webpack_require__.bind(__webpack_require__, /*! ../modules/files/js-dirtozip.js */ \"./src/modules/files/js-dirtozip.js\"));\n        this.jsDirToZip = new JsDirToZip();\n        this.jsDirToZip.on(this.jsDirToZip.eventnames.ready, (e) => {\n          console.log('ready')\n          this.initDisplays();\n        });\n        this.jsDirToZip.on(this.jsDirToZip.eventnames.message, async (e) => {\n          console.log('e', e);\n          let type = 'info';\n          switch (e.name) {\n            case 'console':\n              console.log('console', e);\n              type = window.alertbox.alertconfig.types.info;\n              break;\n            case 'error':\n              type = window.alertbox.alertconfig.types.error;\n              console.log('error', e);\n            default:\n              console.log('message', e);\n          }\n          window.alertbox.renderAlert({\n            type: type,\n            content: e.message,\n            dismissible: true,\n            inverse: false\n          });\n        });\n        const self = this;\n        this.jsDirToZip.on(this.jsDirToZip.eventnames.ready, (e) => {\n          self.showControl(this.jsDirToZip.eventnames.ready);\n        });\n        this.jsDirToZip.on(this.jsDirToZip.eventnames.counter, (e) => {\n          self.fileCounter(e.name, e.filepath, e.size);\n        });\n        this.jsDirToZip.on(this.jsDirToZip.eventnames.complete, (e) => {\n          if (!e || !e.name) {\n            console.log('no emit complete name');\n            return;\n          }\n\n          self.showControl(e.name, ((e.hasOwnProperty('bigfile') && e.bigfile) ? 'zipped' : 'zip'), (e.hasOwnProperty('part')) ? e.part : ((e.hasOwnProperty('bigfile')) ? e.bigfile : null));\n        });\n        this.jsDirToZip.on(this.jsDirToZip.eventnames.pending, (e) => {\n          self.showControl(this.jsDirToZip.eventnames.pending, ((e && e.hasOwnProperty('bigfile') && e.bigfile) ? 'zipped' : 'zip'));\n        });\n        this.jsDirToZip.on(this.jsDirToZip.eventnames.gzip, (e) => {\n          console.log('gzipped', e)\n          self.showControl(this.jsDirToZip.eventnames.gzip, 'zipped', e);\n        });\n        this.jsDirToZip.on(this.jsDirToZip.eventnames.terminate, (e) => {\n          console.log('terminate', e)\n          self.showControl(this.jsDirToZip.eventnames.terminate, ((e && e.hasOwnProperty('bigfile') && e.bigfile) ? 'zipped' : 'zip'));\n        });\n      }\n\n    }\n\n  }\n  async readEntry(entry) {\n    this.toggleCounters(true);\n    await this.jsDirToZip.scanHandle(entry);\n  }\n\n\n  async addFilesStore(name, callback) {\n    name = (name) ? name : this.options.dbname;\n    if (!this.jsFilesStore) {\n      const {\n        JsFilesStore\n      } = await __webpack_require__.e(/*! import() */ \"src_modules_files_js-filesystem_js\").then(__webpack_require__.bind(__webpack_require__, /*! ../modules/files/js-filesystem.js */ \"./src/modules/files/js-filesystem.js\"));\n      this.jsFilesStore = new JsFilesStore(null, callback);\n      this.displayFiles();\n    }\n    if (callback) await callback();\n  }\n  displayFiles() {\n    this.jsFilesStore.getItems('local');\n  }\n\n  fileCounter(item, filepath, size = null) {\n    const counters = this.counters[item];\n    counters.counter++;\n    if (size !== null) counters.size += parseInt(size);\n    counters.display.counter.textContent = counters.counter;\n    if (counters.display.size) counters.display.size.textContent = counters.size;\n  }\n  resetCounter(item) {\n    const counters = this.counters[item];\n    ['counter', 'size'].forEach(el => {\n      counters.display[el].textContent = 0;\n    });\n    this.toggleCounters(false);\n  }\n  toggleCounters(show = true) {\n    const el = document.getElementById(this.options.counters.id);\n    if (!el) return;\n    if (show) el.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n    else el.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n  }\n\n  initFileCounter(item, opts, i) {\n    const sep = (i) ? ` / ` : ``;\n    let counter = 0;\n    let counterdisplay = null;\n    let size = 0;\n    let sizedisplay = null;\n    // create dom display elements\n\n\n    let boxcounters = document.getElementById(this.options.counters.id);\n    const itemopts = {\n      display: {},\n\n    };\n    Object.entries(opts).forEach(([k, val]) => {\n      const cl = k + 's';\n      let elinsert = boxcounters.querySelector('.' + cl);\n      if (!elinsert) elinsert = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)('div', {\n        class: cl\n      }, boxcounters, ``);\n      let el = elinsert.querySelector('.' + val);\n      if (!el) {\n        el = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)('span', {\n          class: val\n        }, elinsert);\n      } else this.resetCounter(item);\n      itemopts.display[k] = el;\n      itemopts[k] = 0;\n    });\n\n    this.counters = { ...this.counters,\n      ...{\n        [item]: itemopts\n      }\n    };\n  }\n  showControl(action, target = 'zip', opts = null) {\n\n    let message, text = null;\n    // 'zip' ---only btn for zip actions for the moment\n    const btn = this[this.options.btnprefix + 'zip' + target];\n    console.log('shoiwcontrol', btn)\n    if (!btn) return;\n    btn.removeAttribute(\"disabled\");\n    switch (action) {\n      case this.jsDirToZip.eventnames.ready:\n        if (btn.dataset.message) delete btn.dataset.message;\n        btn.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n        this.initDisplays();\n        break;\n      case this.jsDirToZip.eventnames.endzip:\n        const part = opts;\n        if (!part) this.showComplete();\n        btn.textContent = `Close zip file` + ((part) ? part : ``);\n        btn.title = (part) ? `Your file is too big - you have to send this part before continuing to process the directory` : `Click to end zip file`;\n        message = {\n          name: this.jsDirToZip.eventnames.endzip,\n          part: part,\n          bigfile: (target !== 'zip')\n        };\n        if (part) message[\"part\"] = part;\n        btn.dataset.message = JSON.stringify(message);\n        break;\n      case this.jsDirToZip.eventnames.bigfile:\n        btn.textContent = `Upload big File separately`;\n        message = {\n          name: this.jsDirToZip.eventnames.bigfile,\n          path: this.path,\n          bigfile: true\n        };\n\n        const filepath = opts;\n        if (filepath) message[\"path\"] = filepath;\n        btn.dataset.message = JSON.stringify(message);\n        console.log('bigfile', message)\n        break;\n      case this.jsDirToZip.eventnames.sendfile:\n        message = {\n          name: this.jsDirToZip.eventnames.sendfile,\n          path: this.path,\n          bigfile: opts\n        };\n        btn.textContent = `Upload zip file`;\n        if (message.bigfile !== null) btn.textContent += ` ` + opts;\n        btn.dataset.message = JSON.stringify(message);\n        console.log('messageup', message)\n        break;\n      case this.jsDirToZip.eventnames.pending:\n        btn.textContent = ` Pending ` + ((target !== 'zip') ? ' big file' : '');\n        btn.dataset.message = '';\n        btn.setAttribute(\"disabled\", true);\n        break;\n      case this.jsDirToZip.eventnames.gzip:\n        text = `compressing separately big file :${(opts && opts.bigfile)?opts.bigfile:``} ${(opts && opts.size)?opts.size:``}`;\n        btn.textContent = text;\n        btn.setAttribute(\"disabled\", true);\n        console.log('optsbigfl', opts)\n        btn.dataset.message = JSON.stringify({\n          name: this.jsDirToZip.eventnames.endzip,\n          path: (opts.hasOwnProperty(\"bigfile\")) ? opts.bigfile : e.path,\n          bigfile: (opts.hasOwnProperty(\"bigfile\") && opts.bigfile !== \"\")\n        });\n        break;\n      case this.jsDirToZip.eventnames.terminate:\n        console.log('terminate ' + ((target !== 'zip') ? 'bigfile' : ''));\n        this.serverList();\n        //default:\n        btn.dataset.message = JSON.stringify({\n          name: 'ready',\n          bigfile: (target !== 'zip')\n        });\n        btn.textContent = `End!! ${ ((target !== 'zip') ? 'bigfile' : '')}`;\n\n        break;\n    }\n    if (btn.dataset.message) btn.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n  }\n  emitToZip(btn) {\n    const message = (btn.dataset.message) ? JSON.parse(btn.dataset.message) : null;\n    console.log('message', message)\n    if (!message) btn.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n    if (message) {\n      if (message.name) {\n        const name = message.name;\n        delete message.name;\n        console.log('emit ----' + name, message)\n        this.jsDirToZip.emit(name, message);\n      }\n    }\n    if (name === this.jsDirToZip.eventnames.sendfile) btn.disabled = true;\n  }\n  getBtn(item, target, parent = null) {\n    const btnkey = this.options.btnprefix + item + target;\n    if (this[btnkey]) return this[btnkey];\n    const display = this.options.controls[item].btn[target];\n    const btn = document.getElementById(display);\n    if (!btn) {\n      parent = (parent) ? parent : this.dropzone;\n      parent.insertAdjacentHTML('beforeend', `<button id=\"${display}\" class=\"button ${display} ${localcss.mright} ${_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide}\"></button>`);\n      this[btnkey] = document.getElementById(display);\n      this[btnkey].addEventListener('click', async (e) => {\n        this.emitToZip(e.currentTarget);\n      });\n    }\n    return this[btnkey];\n  }\n\n  initDisplays() {\n    console.log('initdispay', this.options.controls)\n    Object.entries(this.options.controls).forEach(([key, item], i) => {\n      this.initFileCounter(key, item.display, i);\n      if (item.btn) this.activateControls(key, item.btn);\n    });\n\n  }\n  activateControls(key, btns) {\n    Object.keys(btns).forEach((btn) => {\n      this[this.options.btnprefix + key + btn] = this.getBtn(key, btn);\n    })\n\n  }\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsNkNBQTZDLDJEQUFHO0FBQ2hEO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLFFBQVEsNlJBQXlDO0FBQzNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUSxRQUFRLGdOQUEyQztBQUMzRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQywyREFBRztBQUNyQywwQkFBMEIsMkRBQUc7QUFDN0I7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQSxpQkFBaUI7O0FBRWpCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDLDZEQUFVO0FBQzFDO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQSxhQUFhLDZEQUFVO0FBQ3ZCO0FBQ0EsU0FBUztBQUNULFFBQVE7QUFDUjtBQUNBO0FBQ0EsS0FBSzs7QUFFTCxzQkFBc0I7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQiwyREFBRztBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1EQUFtRCx3Q0FBd0MsRUFBRSxpQ0FBaUM7QUFDOUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxvQ0FBb0Msc0NBQXNDOztBQUUxRTtBQUNBO0FBQ0Esa0RBQWtELDJEQUFHO0FBQ3JEO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0NBQW9DLDJEQUFHO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0REFBNEQsUUFBUSxrQkFBa0IsU0FBUyxFQUFFLGlCQUFpQixFQUFFLDJEQUFHLE1BQU07QUFDN0g7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9tb2R1bGVzL2pzLW15LWZpbGVzLmpzPzEzYjkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgZG9tX3B1cmlmeSxcbiAgZmV0Y2hTZXR0aW5ncyxcbiAgYWRkX2N1c3RvbV9ldmVudHMsXG4gIGNyZWF0ZV9ib3hcbn0gZnJvbSAnLi4vbW9kdWxlcy91dGlscy5qcyc7XG5pbXBvcnQge1xuICBjc3MsXG4gIGZpbHRlcl9maWxlc1xufSBmcm9tICcuLi9tb2R1bGVzL21vZHVsZXMtY29uZmlnLmpzJztcbmltcG9ydCB7XG4gIGdlbmVyYXRlX3V1aWQsXG59IGZyb20gJy4uL21vZHVsZXMvdXRpbHMuanMnO1xuY29uc3QgYWNjZXB0ID0gJy50c3YsLnBuZywuanBnLCAuanBlZywuemlwLC5neiwuN3osLmJ6Mic7XG5jb25zdCBsb2NhbGNzcyA9IHtcbiAgbXJpZ2h0OiAnbXItNCcsXG59XG5sZXQgaW5zdGFuY2UgPSBudWxsO1xuZXhwb3J0IGNsYXNzIEpzTXlGaWxlcyB7XG4gIGRvbmUgPSB0cnVlO1xuICBqc0RpclRvWmlwID0gbnVsbDtcbiAgY291bnRlcnMgPSB7fTtcbiAgcGF0aCA9ICcnO1xuICBfZXZlbnRzID0ge307XG4gIGV2ZW50bmFtZXMgPSB7XG4gICAgY29tcGxldGU6ICdjb21wbGV0ZScsXG4gICAgZXJyb3I6ICdlcnJvcicsXG4gIH1cbiAgY29uc3RydWN0b3IoY29udGFpbmVyLCBvcHRpb25zID0ge30pIHtcbiAgICBpZiAoIWluc3RhbmNlKSB7XG4gICAgICBjb250YWluZXIgPSAoY29udGFpbmVyIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQpID8gY29udGFpbmVyIDogZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihjb250YWluZXIpO1xuICAgICAgaWYgKCFjb250YWluZXIpIHJldHVybjtcbiAgICAgIGRvbV9wdXJpZnkoY29udGFpbmVyLCAnZGF0YXNldCcpO1xuICAgICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7XG4gICAgICBjb25zb2xlLmxvZyhcIi9ndWkvZmlsZXMvbGlzdFwiKVxuICAgICAgY29uc3QgZGVmYXVsdE9wdGlvbnMgPSB7XG5cbiAgICAgICAgdXJsOiBcIi9ndWkvZmlsZXMvbGlzdFwiLFxuICAgICAgICBjb21wcmVzczoge1xuICAgICAgICAgIGxhYmVsOiAnY29tcHJlc3MnXG4gICAgICAgIH0sXG4gICAgICAgIGNvdW50ZXJzOiB7XG4gICAgICAgICAgaWQ6ICdkaXNwbGF5LWZpbGUtY291bnRlcnMnLFxuICAgICAgICB9LFxuICAgICAgICBjb250cm9sczoge1xuICAgICAgICAgIHppcDoge1xuICAgICAgICAgICAgYnRuOiB7XG4gICAgICAgICAgICAgIHppcDogJ21ha2V6aXAnLFxuICAgICAgICAgICAgICB6aXBwZWQ6ICdtYWtlemlwcGVkJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRpc3BsYXk6IHtcbiAgICAgICAgICAgICAgc2l6ZTogJ3NpemV6aXBwZWQnLFxuICAgICAgICAgICAgICBjb3VudGVyOiAnY291bnRlcnppcHBlZCcsXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzY2FuOiB7XG4gICAgICAgICAgICBkaXNwbGF5OiB7XG4gICAgICAgICAgICAgIGNvdW50ZXI6ICdjb3VudGVyJyxcbiAgICAgICAgICAgICAgc2l6ZTogJ3NpemUnLFxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHVwbG9hZDoge1xuICAgICAgICAgIGxhYmVsOiAndXBsb2FkJ1xuICAgICAgICB9LFxuICAgICAgICBidG5wcmVmaXg6ICdidG4nLFxuICAgICAgICBidG5maWxlbGlzdDogbnVsbCxcbiAgICAgICAgc2VsZWN0b3I6IHtcbiAgICAgICAgICBkb3VwbG9hZDogJy50YXJnZXQtdXBsb2FkJyxcbiAgICAgICAgICBkcm9wdGFyZ2V0OiAnLmRyb3B0YXJnZXQnLFxuICAgICAgICAgIHRyaWdnZXI6ICcudHJpZ2dlcicsXG4gICAgICAgICAgZGlybGlzdDogJy5kaXJsaXN0JyxcbiAgICAgICAgICBlbnRyaWVzOiAnLmVudHJpZXMnLFxuICAgICAgICAgIHVwbG9hZGZpbGU6ICd1cGxvYWRmaWxlJyxcbiAgICAgICAgICBkaXNwbGF5cmVzdWx0OiAncmVzdWx0cycsXG4gICAgICAgIH0sXG4gICAgICAgIGRpc3BsYXk6IHtcblxuICAgICAgICAgIGxvY2FsOiAnbG9jYWwtbGlzdCcsXG4gICAgICAgICAgc2VydmVyOiAnc2VydmVyLWxpc3QnLFxuICAgICAgICAgIGRyb3B6b25lOiAnZHJvcHpvbmUnLFxuICAgICAgICAgIGRpcmxpc3Q6ICdkaXJsaXN0JyxcbiAgICAgICAgICBib3h0aXRsZTogJ2JveHRpdGxlJyxcbiAgICAgICAgfSxcblxuXG4gICAgICAgIGNzczoge1xuICAgICAgICAgIGVuYWJsZWQ6ICdlbmFibGVkJ1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgdGhpcy5vcHRpb25zID0gT2JqZWN0LmFzc2lnbihkZWZhdWx0T3B0aW9ucywgb3B0aW9ucyk7XG4gICAgICB0aGlzLmluaXQoKTtcbiAgICAgIGluc3RhbmNlID0gdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIGluc3RhbmNlO1xuICB9XG4gIGluaXQoKSB7XG4gICAgLy8gY3JlYXRlIGRpcmxpc3QgYm94XG4gICAgbGV0IGVsID0gdGhpcy5jb250YWluZXIucXVlcnlTZWxlY3Rvcih0aGlzLm9wdGlvbnMuc2VsZWN0b3IuZGlybGlzdCk7XG4gICAgaWYgKCFlbCkge1xuICAgICAgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgIGVsLmNsYXNzTGlzdC5hZGQodGhpcy5vcHRpb25zLnNlbGVjdG9yLmRpcmxpc3Quc2xpY2UoMSkpO1xuICAgICAgdGhpcy5jb250YWluZXIuYXBwZW5kKGVsKVxuICAgIH1cbiAgICBpZiAodGhpcy5vcHRpb25zLmJ0bmZpbGVsaXN0KSB7XG4gICAgICBjb25zdCBidG5maWxlcyA9IGNyZWF0ZV9ib3goJ2RpdicsIGVsLCB7XG4gICAgICAgIGNsYXNzOiAnYnV0dG9uIGlzLXNlY29uZGFyeScsXG4gICAgICAgIHRleHQ6IHRoaXMub3B0aW9ucy5idG5maWxlbGlzdFxuICAgICAgfSk7XG4gICAgICBidG5maWxlcy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgIHRoaXMuc2VydmVyTGlzdChlbCk7XG4gICAgICAgIHRoaXMuY2xhc3NMaXN0LnRvZ2dsZShjc3MuaGlkZSk7XG4gICAgICB9KTtcbiAgICB9IGVsc2UgdGhpcy5zZXJ2ZXJMaXN0KGVsKTtcblxuXG4gICAgLy9cbiAgICAvLyBjcmVhdGUgYSBmaWxlcGlja2VyIGRlcGVuZHMgb24gYnJvd3NlclxuICAgIHRoaXMuZHJvcHpvbmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICB0aGlzLmRyb3B6b25lLmlkID0gdGhpcy5vcHRpb25zLmRpc3BsYXkuZHJvcHpvbmU7XG4gICAgdGhpcy5kcm9wem9uZS5pbm5lckhUTUwgPSBgPGlucHV0IHR5cGU9XCJmaWxlXCIgY2xhc3M9XCJoaWRkZW5cIiAgbmFtZT1cIiR7dGhpcy5vcHRpb25zLnNlbGVjdG9yLnVwbG9hZGZpbGV9XCIgaWQ9XCIke3RoaXMub3B0aW9ucy5zZWxlY3Rvci51cGxvYWRmaWxlfVwiPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cIiR7dGhpcy5vcHRpb25zLnNlbGVjdG9yLmRyb3B0YXJnZXQuc2xpY2UoMSl9XCI+XG4gICAgICAgICAgICA8ZGl2IGlkPVwiJHt0aGlzLm9wdGlvbnMuZGlzcGxheS5ib3h0aXRsZX1cIj48c3BhbiBjbGFzcz1cIiR7dGhpcy5vcHRpb25zLnNlbGVjdG9yLnRyaWdnZXIuc2xpY2UoMSl9XCI+JHt0aGlzLmNvbnRhaW5lci5kYXRhc2V0LnRleHRicm93c2V9PC9zcGFuPiAgJHt0aGlzLmNvbnRhaW5lci5kYXRhc2V0LnRleHRkcm9wfTwvZGl2PlxuICAgICAgICAgIDwvZGl2PmA7XG4gICAgdGhpcy5jb250YWluZXIuYXBwZW5kKHRoaXMuZHJvcHpvbmUpO1xuICAgIC8vIGFkZCBjb3VudGVyc1xuICAgIGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy5vcHRpb25zLmNvdW50ZXJzLmlkKTtcbiAgICBpZiAoIWVsKSB7XG4gICAgICBjb25zb2xlLmxvZygnY291bnRlcnNjcmVhdGUnKVxuICAgICAgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgIGVsLmlkID0gdGhpcy5vcHRpb25zLmNvdW50ZXJzLmlkO1xuICAgICAgZWwuaW5uZXJIVE1MID0gYDxkaXYgY2xhc3M9XCJjb3VudGVyc1wiPjwvZGl2PjxkaXYgY2xhc3M9XCJzaXplc1wiPjwvZGl2PjxkaXYgY2xhc3M9XCJwcm9ncmVzc3NcIj48L2Rpdj48ZGl2IGNsYXNzPVwidGltZXJzXCI+PC9kaXY+YDtcbiAgICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZChlbCk7XG5cbiAgICB9XG4gICAgdGhpcy5kaXNwbGF5bGlzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMub3B0aW9ucy5kaXNwbGF5LmRpcmxpc3QpO1xuICAgIGNvbnN0IGRyb3B0YXJnZXQgPSB0aGlzLmNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKHRoaXMub3B0aW9ucy5zZWxlY3Rvci5kcm9wdGFyZ2V0KTtcbiAgICBkcm9wdGFyZ2V0LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdvdmVyJywgKGUpID0+IHtcbiAgICAgIHRoaXMuaGFuZGxlRHJhZ092ZXIoZSk7XG4gICAgfSk7XG4gICAgZHJvcHRhcmdldC5hZGRFdmVudExpc3RlbmVyKCdkcm9wJywgYXN5bmMgKGUpID0+IHtcbiAgICAgIHRoaXMuaGFuZGxlRHJvcChlKTtcbiAgICB9KTtcbiAgICB0aGlzLmNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKHRoaXMub3B0aW9ucy5zZWxlY3Rvci50cmlnZ2VyKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICBsZXQgZGF0YXRyYW5zZmVyID0gZTtcbiAgICAgIHRoaXMub3BlbkRpckRpYWxvZyhhY2NlcHQsIChlKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdlZHJvcCcsIGRhdGF0cmFuc2ZlcilcbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIGFkZF9jdXN0b21fZXZlbnRzKHRoaXMpO1xuXG4gICAgdGhpcy5vbih0aGlzLmV2ZW50bmFtZXMuZXJyb3IsIChlKSA9PiB7XG4gICAgICBjb25zb2lsZS5sb2coJ3NjYW5kaXIgcmVjZXZpZSBlcnJvciBtZXNzZ2FlJywgZSlcbiAgICB9KVxuICAgIHRoaXMub24odGhpcy5ldmVudG5hbWVzLnByb2Nlc3NlZCwgYXN5bmMgKGUpID0+IHtcbiAgICAgIGlmICh0aGlzLm5leHRhY3Rpb24pIGF3YWl0IHRoaXMubmV4dGFjdGlvbigpO1xuICAgIH0pXG5cbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignYmVmb3JldW5sb2FkJywgKGUpID0+IHtcbiAgICAgIGlmICghdGhpcy5kb25lKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgZS5yZXR1cm5WYWx1ZSA9ICh0aGlzLm9wdGlvbnMucHJldmVudGNsb3NlKSA/IHRoaXMub3B0aW9ucy5wcmV2ZW50Y2xvc2UgOiBgU29tZSB3b3JrIGlzIGluIHByb2dyZXNzIGluIHRoaXMgd2luZG93LlxcbkFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBsZWF2ZT9gO1xuICAgICAgfVxuXG4gICAgfSk7XG5cblxuICB9XG4gIGFzeW5jIGFkZERpckxpc3Qoc291cmNlKSB7XG5cbiAgfVxuICBzZXJ2ZXJMaXN0KHBhcmVudCA9IG51bGwsIHN1YmRpciA9IG51bGwsIHRhZyA9IG51bGwpIHtcbiAgICBwYXJlbnQgPSBwYXJlbnQgPyBwYXJlbnQgOiB0aGlzLmNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKHRoaXMub3B0aW9ucy5zZWxlY3Rvci5kaXJsaXN0KTtcbiAgICBpZiAoIXBhcmVudCkgcmV0dXJuO1xuICAgIHBhcmVudC5jbGFzc0xpc3QuYWRkKCd3YWl0Jyk7XG5cbiAgICBjb25zdCBlbCA9IHBhcmVudC5xdWVyeVNlbGVjdG9yKHRoaXMub3B0aW9ucy5zZWxlY3Rvci5lbnRyaWVzKTtcbiAgICBpZiAoZWwpIGVsLnJlbW92ZSgpO1xuICAgIHRhZyA9ICh0YWcpID8gKCh0YWcgPT09ICdzZWxlY3QnKSA/ICdvcHRpb25ncm91cCcgOiB0YWcpIDogJ3VsJztcbiAgICBjb25zdCBzdWJ0YWcgPSAodGFnID09PSAndWwnKSA/ICdsaScgOiAnb3B0aW9uJztcbiAgICBjb25zb2xlLmxvZygnbGlzdCBzdWJkaXInLCBzdWJkaXIpXG4gICAgZmV0Y2godGhpcy5vcHRpb25zLnVybCArICgoc3ViZGlyKSA/IHN1YmRpciA6ICcnKSwgZmV0Y2hTZXR0aW5ncygpKS50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLmpzb24oKSkudGhlbihhc3luYyBqc29uID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKCdqc3BuJywganNvbilcbiAgICAgIGlmIChqc29uLmVudHJpZXMgJiYganNvbi5lbnRyaWVzLmxlbmd0aCkge1xuICAgICAgICBpZiAocGFyZW50LmRhdGFzZXQubGFiZWwpIHBhcmVudC5pbnNlcnRBZGphY2VudEhUTUwoJ2FmdGVyYmVnaW4nLCBgPGxhYmVsPiR7cGFyZW50LmRhdGFzZXQubGFiZWx9PC9sYWJlbD5gKTtcbiAgICAgICAgbGV0IGh0bWwgPSBbYDwke3RhZ30gY2xhc3M9XCIke3RoaXMub3B0aW9ucy5zZWxlY3Rvci5lbnRyaWVzLnNsaWNlKDEpfVwiPmBdLFxuICAgICAgICAgIGZpbGVzID0gW10sXG4gICAgICAgICAgZGlyZWN0b3JpZXMgPSBbXSxcbiAgICAgICAgICBlbnRyaWVzID0ganNvbi5lbnRyaWVzO1xuICAgICAgICB3aGlsZSAoZW50cmllcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgY29uc3QgZW50cnkgPSBlbnRyaWVzLnNoaWZ0KCk7XG4gICAgICAgICAgaWYgKGVudHJ5LnR5cGUgPT09ICdGJykgZmlsZXMucHVzaChlbnRyeSk7XG4gICAgICAgICAgZWxzZSBkaXJlY3Rvcmllcy5wdXNoKGVudHJ5KTtcbiAgICAgICAgfTtcbiAgICAgICAgZmlsZXMuc29ydCgoYSwgYikgPT4gKGEubmFtZSA8IGIubmFtZSkpO1xuICAgICAgICBkaXJlY3Rvcmllcy5zb3J0KChhLCBiKSA9PiAoYS5uYW1lIDwgYi5uYW1lKSk7XG4gICAgICAgIFtkaXJlY3RvcmllcywgZmlsZXNdLmZvckVhY2goZW50cmllcyA9PiB7XG4gICAgICAgICAgZW50cmllcy5mb3JFYWNoKChlbnRyeSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZXh0ID0gZW50cnkubmFtZS5zcGxpdCgnLicpLnBvcCgpO1xuICAgICAgICAgICAgY29uc3QgZGVsID0gYDxpIGNsYXNzPVwiaWNvbi1zbSBpY29uLXRyYXNoIGRlbGVudHJ5IG1sLTIgaGlkZGVuXCIgYWx0PVwiZGVsZXRlXCI+PC9pPmA7XG4gICAgICAgICAgICBjb25zdCBlbnRyeWRldGFpbCA9IGA8c3BhbiBjbGFzcz1cImVudHJ5JHtlbnRyeS50eXBlfVwiPjxpIGNsYXNzPVwiaWNvbiBwLVswLjEyNXJlbV0gaWNvbi0keygoZW50cnkudHlwZSA9PT0gXCJEXCIpID8gJ2ZvbGRlci1zbScgOiAoKGZpbHRlcl9maWxlcy5pbWFnZXMuc3BsaXQoJywnKS5pbmRleE9mKGV4dCk+PTApPydpbWFnZS1zbSc6J2RvY3VtZW50LXNtJykpfSBhbGlnbi10ZXh0LWJvdHRvbSBtYi0wLjUgbXItMC41XCI+PC9pPiR7ZW50cnkubmFtZX08L3NwYW4+YDtcbiAgICAgICAgICAgIGh0bWwucHVzaChgPCR7c3VidGFnfSAkeyhlbnRyeS50eXBlPT09J0QnKT9gZHJhZ2dhYmxlPVwidHJ1ZVwiYDpgYH0gZGF0YS1uYW1lPVwiJHtlbnRyeS5uYW1lfVwiICR7KHRhZz09PSdzZWxlY3QnKT9gIGNsYXNzPVwiZW50cnkke2VudHJ5LnR5cGV9XCJgOmBgfT4ke2VudHJ5ZGV0YWlsfWApO1xuICAgICAgICAgICAgaHRtbC5wdXNoKGAke2RlbH08LyR7c3VidGFnfT5gKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGh0bWwucHVzaChgPC8ke3RhZ30+YCk7XG4gICAgICAgIHBhcmVudC5pbnNlcnRBZGphY2VudEhUTUwoJ2JlZm9yZWVuZCcsIGh0bWwuam9pbihgYCkpO1xuXG4gICAgICAgIHBhcmVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZW50cnlEJykuZm9yRWFjaChkaXIgPT4ge1xuICAgICAgICAgIGRpci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgICAgICBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgY29uc3QgZGlybGlzdCA9IGUuY3VycmVudFRhcmdldC5wYXJlbnRFbGVtZW50O1xuXG4gICAgICAgICAgICBkaXJsaXN0LmNsYXNzTGlzdC50b2dnbGUoJ29uJyk7XG4gICAgICAgICAgICBjb25zdCBpY28gPSBlLmN1cnJlbnRUYXJnZXQucXVlcnlTZWxlY3RvcignaS5pY29uJyk7XG4gICAgICAgICAgICBpZiAoaWNvKSB7XG4gICAgICAgICAgICAgIGljby5jbGFzc0xpc3QudG9nZ2xlKCdpY29uLWZvbGRlci1zbScpO1xuICAgICAgICAgICAgICBpY28uY2xhc3NMaXN0LnRvZ2dsZSgnaWNvbi1mb2xkZXItb3Blbi1zbScpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGRpcmxpc3QuY2xhc3NMaXN0LmNvbnRhaW5zKCdvbicpKSB7XG4gICAgICAgICAgICAgIGlmICghZGlybGlzdC5kYXRhc2V0LmxvYWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlcnZlckxpc3QoZGlybGlzdCwgKChzdWJkaXIpID8gc3ViZGlyICsgJy8nIDogJy8nKSArIGRpcmxpc3QuZGF0YXNldC5uYW1lLCB0YWcpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgZGlyLnF1ZXJ5U2VsZWN0b3JBbGwoJy5lbnRyeUYnKS5mb3JFYWNoKGZpbGUgPT4ge1xuICAgICAgICAgICAgY29uc3QgZGVsX2ZpbGUgPSAoKSA9PiB7XG4gICAgICAgICAgICAgIGFsZXJ0KCdkZWwnLCBkZWxmaWxlLnBhcmVudEVsZW1lbnQuZGF0YXNldC5uYW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHRyYXNoID0gZS5jdXJyZW50VGFyZ2V0LnBhcmVudEVsZW1lbnQucXVlcnlTZWxlY3RvcignLmRlbGVudHJ5Jyk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygndHJhc2gnLCB0cmFzaClcbiAgICAgICAgICAgIGZpbGUuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VlbnRlcicsIChlKSA9PiB7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdmaWxlJywgZSlcbiAgICAgICAgICAgICAgdHJhc2guY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7XG4gICAgICAgICAgICAgIGZpbGUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBkZWxfZmlsZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGZpbGUuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdXQnLCAoZSkgPT4ge1xuICAgICAgICAgICAgICB0cmFzaC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTtcbiAgICAgICAgICAgICAgZmlsZS5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGRlbF9maWxlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgfVxuICAgICAgYXdhaXQgdGhpcy5hZGRVcGxvYWREaWFsb2codGhpcy5jb250YWluZXIpO1xuICAgICAgcGFyZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3dhaXQnKTtcbiAgICAgIHBhcmVudC5kYXRhc2V0LmxvYWRlZCA9IHRydWU7XG5cbiAgICB9KTtcblxuICB9XG5cbiAgYXR0YWNoRHJvcHpvbmUodGFyZ2V0KSB7XG4gICAgdGhpcy50YXJnZXRkaXIgPSAodGFyZ2V0LnBhcmVudEVsZW1lbnQuZGF0YXNldC5uYW1lKSA/IHRhcmdldC5wYXJlbnRFbGVtZW50LmRhdGFzZXQubmFtZSA6ICcnO1xuICAgIHRoaXMuZHJvcHpvbmUuY2xhc3NMaXN0LmFkZCh0aGlzLm9wdGlvbnMuY3NzLmVuYWJsZWQpO1xuICAgIHRhcmdldC5hcHBlbmQodGhpcy5kcm9wem9uZSk7XG4gIH1cbiAgZGV0YWNoRHJvcHpvbmUoKSB7XG4gICAgdGhpcy50YXJnZXRkaXIgPSBudWxsO1xuICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5vcHRpb25zLmNzcy5lbmFibGVkKTtcblxuICB9XG5cbiAgb3BlbkRpckRpYWxvZyhhY2NlcHQsIGNhbGxiYWNrKSB7XG4gICAgY29uc3QgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIik7XG4gICAgaW5wdXQudHlwZSA9IFwiZmlsZVwiO1xuICAgIGlucHV0LmRpcmVjdG9yeSA9IHRydWU7XG4gICAgaW5wdXQubXVsdGlwbGUgPSB0cnVlO1xuICAgIGlucHV0LndlYmtpdGRpcmVjdG9yeSA9IHRydWU7XG4gICAgaW5wdXQuYWxsb3dkaXJzID0gdHJ1ZTtcbiAgICBpbnB1dC5hY2NlcHQgPSBhY2NlcHQ7XG4gICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCBjYWxsYmFjayk7XG4gICAgaW5wdXQuZGlzcGF0Y2hFdmVudChuZXcgTW91c2VFdmVudChcImNsaWNrXCIpKTtcbiAgfVxuICBoYW5kbGVEcmFnT3ZlcihlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGUuZGF0YVRyYW5zZmVyLmRyb3BFZmZlY3QgPSBcIm1vdmVcIjtcbiAgfVxuXG4gIGFzeW5jIGhhbmRsZURyb3AoZSkge1xuICAgIGxldCBkYXRhVHJhbnNmZXI7XG4gICAgaWYgKGUuZGF0YVRyYW5zZmVyKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBkYXRhVHJhbnNmZXIgPSBlLmRhdGFUcmFuc2ZlcjtcbiAgICB9IGVsc2UgZGF0YVRyYW5zZmVyID0gZTtcbiAgICB0aGlzLmRvbmUgPSBmYWxzZTtcbiAgICB0aGlzLnRpbWVyID0gbmV3IERhdGUoKTtcbiAgICBjb25zdCBpdGVtcyA9IFsuLi4oKGRhdGFUcmFuc2Zlci5pdGVtcykgPyBkYXRhVHJhbnNmZXIuaXRlbXMgOiBkYXRhVHJhbnNmZXIuZmlsZXMpXTtcbiAgICBpZiAoaXRlbXMubGVuZ3RoKSB7XG4gICAgICB0aGlzLmVuYWJsZURyb3B6b25lKGZhbHNlKTtcbiAgICAgIGF3YWl0IGl0ZW1zLmZvckVhY2goYXN5bmMgaXRlbSA9PiB7XG4gICAgICAgIGlmIChpdGVtLmtpbmQgPT09IFwiZmlsZVwiKSB7XG4gICAgICAgICAgaXRlbSA9IGF3YWl0IGl0ZW0ud2Via2l0R2V0QXNFbnRyeSgpO1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdpdGVtdG9yZWFkJywgaXRlbSlcblxuICAgICAgICAgIGF3YWl0IHRoaXMucmVhZEVudHJ5KGl0ZW0pO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgIH1cbiAgfVxuICBzaG93Q29tcGxldGUoKSB7XG4gICAgdGhpcy50aW1lciA9IChuZXcgRGF0ZSgpIC0gdGhpcy50aW1lcikgLyAxMDAwO1xuICAgIGNvbnNvbGUubG9nKCdpdGVtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLScgKyBwYXJzZUludCh0aGlzLnRpbWVyIC8gNjApICsgJyAtLS0gJyArIChcbiAgICAgIHRoaXMudGltZXIgLSAocGFyc2VJbnQodGhpcy50aW1lciAvIDYwKSAqIDYwKSkpO1xuICAgIHRoaXMuZW5hYmxlRHJvcHpvbmUoKTtcbiAgfVxuXG4gIHN0b3BPbkVycm9yKGVycikge1xuICAgIGNvbnNvbGUubG9nKCdlcnInLCBlcnIpO1xuICB9XG5cbiAgZW5hYmxlRHJvcHpvbmUoZW5hYmxlID0gdHJ1ZSwgZGVzdHJveSA9IGZhbHNlKSB7XG4gICAgaWYgKGRlc3Ryb3kpIHRoaXMuZHJvcHpvbmUuY2xhc3NMaXN0LmFkZChjc3MuaGlkZSk7XG4gICAgaWYgKGVuYWJsZSkgdGhpcy5kcm9wem9uZS5jbGFzc0xpc3QuYWRkKHRoaXMub3B0aW9ucy5jc3MuZW5hYmxlZCk7XG4gICAgZWxzZSB0aGlzLmRyb3B6b25lLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5vcHRpb25zLmNzcy5lbmFibGVkKTtcblxuICB9XG5cbiAgYXN5bmMgYWRkVXBsb2FkRGlhbG9nKGl0ZW0pIHtcbiAgICBpdGVtID0gKGl0ZW0pID8gaXRlbSA6IHRoaXMuY29udGFpbmVyO1xuICAgIGlmICh0aGlzLm9wdGlvbnMuY29udHJvbHMuc2Nhbikge1xuICAgICAgdGhpcy5hdHRhY2hEcm9wem9uZShpdGVtKTtcbiAgICAgIGlmICh0aGlzLm9wdGlvbnMuY29udHJvbHMuemlwKSB7XG4gICAgICAgIGNvbnN0IHtcbiAgICAgICAgICBKc0RpclRvWmlwXG4gICAgICAgIH0gPSBhd2FpdCBpbXBvcnQoJy4uL21vZHVsZXMvZmlsZXMvanMtZGlydG96aXAuanMnKTtcbiAgICAgICAgdGhpcy5qc0RpclRvWmlwID0gbmV3IEpzRGlyVG9aaXAoKTtcbiAgICAgICAgdGhpcy5qc0RpclRvWmlwLm9uKHRoaXMuanNEaXJUb1ppcC5ldmVudG5hbWVzLnJlYWR5LCAoZSkgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdyZWFkeScpXG4gICAgICAgICAgdGhpcy5pbml0RGlzcGxheXMoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuanNEaXJUb1ppcC5vbih0aGlzLmpzRGlyVG9aaXAuZXZlbnRuYW1lcy5tZXNzYWdlLCBhc3luYyAoZSkgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdlJywgZSk7XG4gICAgICAgICAgbGV0IHR5cGUgPSAnaW5mbyc7XG4gICAgICAgICAgc3dpdGNoIChlLm5hbWUpIHtcbiAgICAgICAgICAgIGNhc2UgJ2NvbnNvbGUnOlxuICAgICAgICAgICAgICBjb25zb2xlLmxvZygnY29uc29sZScsIGUpO1xuICAgICAgICAgICAgICB0eXBlID0gd2luZG93LmFsZXJ0Ym94LmFsZXJ0Y29uZmlnLnR5cGVzLmluZm87XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnZXJyb3InOlxuICAgICAgICAgICAgICB0eXBlID0gd2luZG93LmFsZXJ0Ym94LmFsZXJ0Y29uZmlnLnR5cGVzLmVycm9yO1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZXJyb3InLCBlKTtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdtZXNzYWdlJywgZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHdpbmRvdy5hbGVydGJveC5yZW5kZXJBbGVydCh7XG4gICAgICAgICAgICB0eXBlOiB0eXBlLFxuICAgICAgICAgICAgY29udGVudDogZS5tZXNzYWdlLFxuICAgICAgICAgICAgZGlzbWlzc2libGU6IHRydWUsXG4gICAgICAgICAgICBpbnZlcnNlOiBmYWxzZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgICAgIHRoaXMuanNEaXJUb1ppcC5vbih0aGlzLmpzRGlyVG9aaXAuZXZlbnRuYW1lcy5yZWFkeSwgKGUpID0+IHtcbiAgICAgICAgICBzZWxmLnNob3dDb250cm9sKHRoaXMuanNEaXJUb1ppcC5ldmVudG5hbWVzLnJlYWR5KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuanNEaXJUb1ppcC5vbih0aGlzLmpzRGlyVG9aaXAuZXZlbnRuYW1lcy5jb3VudGVyLCAoZSkgPT4ge1xuICAgICAgICAgIHNlbGYuZmlsZUNvdW50ZXIoZS5uYW1lLCBlLmZpbGVwYXRoLCBlLnNpemUpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5qc0RpclRvWmlwLm9uKHRoaXMuanNEaXJUb1ppcC5ldmVudG5hbWVzLmNvbXBsZXRlLCAoZSkgPT4ge1xuICAgICAgICAgIGlmICghZSB8fCAhZS5uYW1lKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnbm8gZW1pdCBjb21wbGV0ZSBuYW1lJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgc2VsZi5zaG93Q29udHJvbChlLm5hbWUsICgoZS5oYXNPd25Qcm9wZXJ0eSgnYmlnZmlsZScpICYmIGUuYmlnZmlsZSkgPyAnemlwcGVkJyA6ICd6aXAnKSwgKGUuaGFzT3duUHJvcGVydHkoJ3BhcnQnKSkgPyBlLnBhcnQgOiAoKGUuaGFzT3duUHJvcGVydHkoJ2JpZ2ZpbGUnKSkgPyBlLmJpZ2ZpbGUgOiBudWxsKSk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmpzRGlyVG9aaXAub24odGhpcy5qc0RpclRvWmlwLmV2ZW50bmFtZXMucGVuZGluZywgKGUpID0+IHtcbiAgICAgICAgICBzZWxmLnNob3dDb250cm9sKHRoaXMuanNEaXJUb1ppcC5ldmVudG5hbWVzLnBlbmRpbmcsICgoZSAmJiBlLmhhc093blByb3BlcnR5KCdiaWdmaWxlJykgJiYgZS5iaWdmaWxlKSA/ICd6aXBwZWQnIDogJ3ppcCcpKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuanNEaXJUb1ppcC5vbih0aGlzLmpzRGlyVG9aaXAuZXZlbnRuYW1lcy5nemlwLCAoZSkgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdnemlwcGVkJywgZSlcbiAgICAgICAgICBzZWxmLnNob3dDb250cm9sKHRoaXMuanNEaXJUb1ppcC5ldmVudG5hbWVzLmd6aXAsICd6aXBwZWQnLCBlKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuanNEaXJUb1ppcC5vbih0aGlzLmpzRGlyVG9aaXAuZXZlbnRuYW1lcy50ZXJtaW5hdGUsIChlKSA9PiB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ3Rlcm1pbmF0ZScsIGUpXG4gICAgICAgICAgc2VsZi5zaG93Q29udHJvbCh0aGlzLmpzRGlyVG9aaXAuZXZlbnRuYW1lcy50ZXJtaW5hdGUsICgoZSAmJiBlLmhhc093blByb3BlcnR5KCdiaWdmaWxlJykgJiYgZS5iaWdmaWxlKSA/ICd6aXBwZWQnIDogJ3ppcCcpKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICB9XG5cbiAgfVxuICBhc3luYyByZWFkRW50cnkoZW50cnkpIHtcbiAgICB0aGlzLnRvZ2dsZUNvdW50ZXJzKHRydWUpO1xuICAgIGF3YWl0IHRoaXMuanNEaXJUb1ppcC5zY2FuSGFuZGxlKGVudHJ5KTtcbiAgfVxuXG5cbiAgYXN5bmMgYWRkRmlsZXNTdG9yZShuYW1lLCBjYWxsYmFjaykge1xuICAgIG5hbWUgPSAobmFtZSkgPyBuYW1lIDogdGhpcy5vcHRpb25zLmRibmFtZTtcbiAgICBpZiAoIXRoaXMuanNGaWxlc1N0b3JlKSB7XG4gICAgICBjb25zdCB7XG4gICAgICAgIEpzRmlsZXNTdG9yZVxuICAgICAgfSA9IGF3YWl0IGltcG9ydCgnLi4vbW9kdWxlcy9maWxlcy9qcy1maWxlc3lzdGVtLmpzJyk7XG4gICAgICB0aGlzLmpzRmlsZXNTdG9yZSA9IG5ldyBKc0ZpbGVzU3RvcmUobnVsbCwgY2FsbGJhY2spO1xuICAgICAgdGhpcy5kaXNwbGF5RmlsZXMoKTtcbiAgICB9XG4gICAgaWYgKGNhbGxiYWNrKSBhd2FpdCBjYWxsYmFjaygpO1xuICB9XG4gIGRpc3BsYXlGaWxlcygpIHtcbiAgICB0aGlzLmpzRmlsZXNTdG9yZS5nZXRJdGVtcygnbG9jYWwnKTtcbiAgfVxuXG4gIGZpbGVDb3VudGVyKGl0ZW0sIGZpbGVwYXRoLCBzaXplID0gbnVsbCkge1xuICAgIGNvbnN0IGNvdW50ZXJzID0gdGhpcy5jb3VudGVyc1tpdGVtXTtcbiAgICBjb3VudGVycy5jb3VudGVyKys7XG4gICAgaWYgKHNpemUgIT09IG51bGwpIGNvdW50ZXJzLnNpemUgKz0gcGFyc2VJbnQoc2l6ZSk7XG4gICAgY291bnRlcnMuZGlzcGxheS5jb3VudGVyLnRleHRDb250ZW50ID0gY291bnRlcnMuY291bnRlcjtcbiAgICBpZiAoY291bnRlcnMuZGlzcGxheS5zaXplKSBjb3VudGVycy5kaXNwbGF5LnNpemUudGV4dENvbnRlbnQgPSBjb3VudGVycy5zaXplO1xuICB9XG4gIHJlc2V0Q291bnRlcihpdGVtKSB7XG4gICAgY29uc3QgY291bnRlcnMgPSB0aGlzLmNvdW50ZXJzW2l0ZW1dO1xuICAgIFsnY291bnRlcicsICdzaXplJ10uZm9yRWFjaChlbCA9PiB7XG4gICAgICBjb3VudGVycy5kaXNwbGF5W2VsXS50ZXh0Q29udGVudCA9IDA7XG4gICAgfSk7XG4gICAgdGhpcy50b2dnbGVDb3VudGVycyhmYWxzZSk7XG4gIH1cbiAgdG9nZ2xlQ291bnRlcnMoc2hvdyA9IHRydWUpIHtcbiAgICBjb25zdCBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMub3B0aW9ucy5jb3VudGVycy5pZCk7XG4gICAgaWYgKCFlbCkgcmV0dXJuO1xuICAgIGlmIChzaG93KSBlbC5jbGFzc0xpc3QucmVtb3ZlKGNzcy5oaWRlKTtcbiAgICBlbHNlIGVsLmNsYXNzTGlzdC5hZGQoY3NzLmhpZGUpO1xuICB9XG5cbiAgaW5pdEZpbGVDb3VudGVyKGl0ZW0sIG9wdHMsIGkpIHtcbiAgICBjb25zdCBzZXAgPSAoaSkgPyBgIC8gYCA6IGBgO1xuICAgIGxldCBjb3VudGVyID0gMDtcbiAgICBsZXQgY291bnRlcmRpc3BsYXkgPSBudWxsO1xuICAgIGxldCBzaXplID0gMDtcbiAgICBsZXQgc2l6ZWRpc3BsYXkgPSBudWxsO1xuICAgIC8vIGNyZWF0ZSBkb20gZGlzcGxheSBlbGVtZW50c1xuXG5cbiAgICBsZXQgYm94Y291bnRlcnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLm9wdGlvbnMuY291bnRlcnMuaWQpO1xuICAgIGNvbnN0IGl0ZW1vcHRzID0ge1xuICAgICAgZGlzcGxheToge30sXG5cbiAgICB9O1xuICAgIE9iamVjdC5lbnRyaWVzKG9wdHMpLmZvckVhY2goKFtrLCB2YWxdKSA9PiB7XG4gICAgICBjb25zdCBjbCA9IGsgKyAncyc7XG4gICAgICBsZXQgZWxpbnNlcnQgPSBib3hjb3VudGVycy5xdWVyeVNlbGVjdG9yKCcuJyArIGNsKTtcbiAgICAgIGlmICghZWxpbnNlcnQpIGVsaW5zZXJ0ID0gY3JlYXRlX2JveCgnZGl2Jywge1xuICAgICAgICBjbGFzczogY2xcbiAgICAgIH0sIGJveGNvdW50ZXJzLCBgYCk7XG4gICAgICBsZXQgZWwgPSBlbGluc2VydC5xdWVyeVNlbGVjdG9yKCcuJyArIHZhbCk7XG4gICAgICBpZiAoIWVsKSB7XG4gICAgICAgIGVsID0gY3JlYXRlX2JveCgnc3BhbicsIHtcbiAgICAgICAgICBjbGFzczogdmFsXG4gICAgICAgIH0sIGVsaW5zZXJ0KTtcbiAgICAgIH0gZWxzZSB0aGlzLnJlc2V0Q291bnRlcihpdGVtKTtcbiAgICAgIGl0ZW1vcHRzLmRpc3BsYXlba10gPSBlbDtcbiAgICAgIGl0ZW1vcHRzW2tdID0gMDtcbiAgICB9KTtcblxuICAgIHRoaXMuY291bnRlcnMgPSB7IC4uLnRoaXMuY291bnRlcnMsXG4gICAgICAuLi57XG4gICAgICAgIFtpdGVtXTogaXRlbW9wdHNcbiAgICAgIH1cbiAgICB9O1xuICB9XG4gIHNob3dDb250cm9sKGFjdGlvbiwgdGFyZ2V0ID0gJ3ppcCcsIG9wdHMgPSBudWxsKSB7XG5cbiAgICBsZXQgbWVzc2FnZSwgdGV4dCA9IG51bGw7XG4gICAgLy8gJ3ppcCcgLS0tb25seSBidG4gZm9yIHppcCBhY3Rpb25zIGZvciB0aGUgbW9tZW50XG4gICAgY29uc3QgYnRuID0gdGhpc1t0aGlzLm9wdGlvbnMuYnRucHJlZml4ICsgJ3ppcCcgKyB0YXJnZXRdO1xuICAgIGNvbnNvbGUubG9nKCdzaG9pd2NvbnRyb2wnLCBidG4pXG4gICAgaWYgKCFidG4pIHJldHVybjtcbiAgICBidG4ucmVtb3ZlQXR0cmlidXRlKFwiZGlzYWJsZWRcIik7XG4gICAgc3dpdGNoIChhY3Rpb24pIHtcbiAgICAgIGNhc2UgdGhpcy5qc0RpclRvWmlwLmV2ZW50bmFtZXMucmVhZHk6XG4gICAgICAgIGlmIChidG4uZGF0YXNldC5tZXNzYWdlKSBkZWxldGUgYnRuLmRhdGFzZXQubWVzc2FnZTtcbiAgICAgICAgYnRuLmNsYXNzTGlzdC5hZGQoY3NzLmhpZGUpO1xuICAgICAgICB0aGlzLmluaXREaXNwbGF5cygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgdGhpcy5qc0RpclRvWmlwLmV2ZW50bmFtZXMuZW5kemlwOlxuICAgICAgICBjb25zdCBwYXJ0ID0gb3B0cztcbiAgICAgICAgaWYgKCFwYXJ0KSB0aGlzLnNob3dDb21wbGV0ZSgpO1xuICAgICAgICBidG4udGV4dENvbnRlbnQgPSBgQ2xvc2UgemlwIGZpbGVgICsgKChwYXJ0KSA/IHBhcnQgOiBgYCk7XG4gICAgICAgIGJ0bi50aXRsZSA9IChwYXJ0KSA/IGBZb3VyIGZpbGUgaXMgdG9vIGJpZyAtIHlvdSBoYXZlIHRvIHNlbmQgdGhpcyBwYXJ0IGJlZm9yZSBjb250aW51aW5nIHRvIHByb2Nlc3MgdGhlIGRpcmVjdG9yeWAgOiBgQ2xpY2sgdG8gZW5kIHppcCBmaWxlYDtcbiAgICAgICAgbWVzc2FnZSA9IHtcbiAgICAgICAgICBuYW1lOiB0aGlzLmpzRGlyVG9aaXAuZXZlbnRuYW1lcy5lbmR6aXAsXG4gICAgICAgICAgcGFydDogcGFydCxcbiAgICAgICAgICBiaWdmaWxlOiAodGFyZ2V0ICE9PSAnemlwJylcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKHBhcnQpIG1lc3NhZ2VbXCJwYXJ0XCJdID0gcGFydDtcbiAgICAgICAgYnRuLmRhdGFzZXQubWVzc2FnZSA9IEpTT04uc3RyaW5naWZ5KG1lc3NhZ2UpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgdGhpcy5qc0RpclRvWmlwLmV2ZW50bmFtZXMuYmlnZmlsZTpcbiAgICAgICAgYnRuLnRleHRDb250ZW50ID0gYFVwbG9hZCBiaWcgRmlsZSBzZXBhcmF0ZWx5YDtcbiAgICAgICAgbWVzc2FnZSA9IHtcbiAgICAgICAgICBuYW1lOiB0aGlzLmpzRGlyVG9aaXAuZXZlbnRuYW1lcy5iaWdmaWxlLFxuICAgICAgICAgIHBhdGg6IHRoaXMucGF0aCxcbiAgICAgICAgICBiaWdmaWxlOiB0cnVlXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgZmlsZXBhdGggPSBvcHRzO1xuICAgICAgICBpZiAoZmlsZXBhdGgpIG1lc3NhZ2VbXCJwYXRoXCJdID0gZmlsZXBhdGg7XG4gICAgICAgIGJ0bi5kYXRhc2V0Lm1lc3NhZ2UgPSBKU09OLnN0cmluZ2lmeShtZXNzYWdlKTtcbiAgICAgICAgY29uc29sZS5sb2coJ2JpZ2ZpbGUnLCBtZXNzYWdlKVxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgdGhpcy5qc0RpclRvWmlwLmV2ZW50bmFtZXMuc2VuZGZpbGU6XG4gICAgICAgIG1lc3NhZ2UgPSB7XG4gICAgICAgICAgbmFtZTogdGhpcy5qc0RpclRvWmlwLmV2ZW50bmFtZXMuc2VuZGZpbGUsXG4gICAgICAgICAgcGF0aDogdGhpcy5wYXRoLFxuICAgICAgICAgIGJpZ2ZpbGU6IG9wdHNcbiAgICAgICAgfTtcbiAgICAgICAgYnRuLnRleHRDb250ZW50ID0gYFVwbG9hZCB6aXAgZmlsZWA7XG4gICAgICAgIGlmIChtZXNzYWdlLmJpZ2ZpbGUgIT09IG51bGwpIGJ0bi50ZXh0Q29udGVudCArPSBgIGAgKyBvcHRzO1xuICAgICAgICBidG4uZGF0YXNldC5tZXNzYWdlID0gSlNPTi5zdHJpbmdpZnkobWVzc2FnZSk7XG4gICAgICAgIGNvbnNvbGUubG9nKCdtZXNzYWdldXAnLCBtZXNzYWdlKVxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgdGhpcy5qc0RpclRvWmlwLmV2ZW50bmFtZXMucGVuZGluZzpcbiAgICAgICAgYnRuLnRleHRDb250ZW50ID0gYCBQZW5kaW5nIGAgKyAoKHRhcmdldCAhPT0gJ3ppcCcpID8gJyBiaWcgZmlsZScgOiAnJyk7XG4gICAgICAgIGJ0bi5kYXRhc2V0Lm1lc3NhZ2UgPSAnJztcbiAgICAgICAgYnRuLnNldEF0dHJpYnV0ZShcImRpc2FibGVkXCIsIHRydWUpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgdGhpcy5qc0RpclRvWmlwLmV2ZW50bmFtZXMuZ3ppcDpcbiAgICAgICAgdGV4dCA9IGBjb21wcmVzc2luZyBzZXBhcmF0ZWx5IGJpZyBmaWxlIDokeyhvcHRzICYmIG9wdHMuYmlnZmlsZSk/b3B0cy5iaWdmaWxlOmBgfSAkeyhvcHRzICYmIG9wdHMuc2l6ZSk/b3B0cy5zaXplOmBgfWA7XG4gICAgICAgIGJ0bi50ZXh0Q29udGVudCA9IHRleHQ7XG4gICAgICAgIGJ0bi5zZXRBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiLCB0cnVlKTtcbiAgICAgICAgY29uc29sZS5sb2coJ29wdHNiaWdmbCcsIG9wdHMpXG4gICAgICAgIGJ0bi5kYXRhc2V0Lm1lc3NhZ2UgPSBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgbmFtZTogdGhpcy5qc0RpclRvWmlwLmV2ZW50bmFtZXMuZW5kemlwLFxuICAgICAgICAgIHBhdGg6IChvcHRzLmhhc093blByb3BlcnR5KFwiYmlnZmlsZVwiKSkgPyBvcHRzLmJpZ2ZpbGUgOiBlLnBhdGgsXG4gICAgICAgICAgYmlnZmlsZTogKG9wdHMuaGFzT3duUHJvcGVydHkoXCJiaWdmaWxlXCIpICYmIG9wdHMuYmlnZmlsZSAhPT0gXCJcIilcbiAgICAgICAgfSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSB0aGlzLmpzRGlyVG9aaXAuZXZlbnRuYW1lcy50ZXJtaW5hdGU6XG4gICAgICAgIGNvbnNvbGUubG9nKCd0ZXJtaW5hdGUgJyArICgodGFyZ2V0ICE9PSAnemlwJykgPyAnYmlnZmlsZScgOiAnJykpO1xuICAgICAgICB0aGlzLnNlcnZlckxpc3QoKTtcbiAgICAgICAgLy9kZWZhdWx0OlxuICAgICAgICBidG4uZGF0YXNldC5tZXNzYWdlID0gSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgIG5hbWU6ICdyZWFkeScsXG4gICAgICAgICAgYmlnZmlsZTogKHRhcmdldCAhPT0gJ3ppcCcpXG4gICAgICAgIH0pO1xuICAgICAgICBidG4udGV4dENvbnRlbnQgPSBgRW5kISEgJHsgKCh0YXJnZXQgIT09ICd6aXAnKSA/ICdiaWdmaWxlJyA6ICcnKX1gO1xuXG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBpZiAoYnRuLmRhdGFzZXQubWVzc2FnZSkgYnRuLmNsYXNzTGlzdC5yZW1vdmUoY3NzLmhpZGUpO1xuICB9XG4gIGVtaXRUb1ppcChidG4pIHtcbiAgICBjb25zdCBtZXNzYWdlID0gKGJ0bi5kYXRhc2V0Lm1lc3NhZ2UpID8gSlNPTi5wYXJzZShidG4uZGF0YXNldC5tZXNzYWdlKSA6IG51bGw7XG4gICAgY29uc29sZS5sb2coJ21lc3NhZ2UnLCBtZXNzYWdlKVxuICAgIGlmICghbWVzc2FnZSkgYnRuLmNsYXNzTGlzdC5hZGQoY3NzLmhpZGUpO1xuICAgIGlmIChtZXNzYWdlKSB7XG4gICAgICBpZiAobWVzc2FnZS5uYW1lKSB7XG4gICAgICAgIGNvbnN0IG5hbWUgPSBtZXNzYWdlLm5hbWU7XG4gICAgICAgIGRlbGV0ZSBtZXNzYWdlLm5hbWU7XG4gICAgICAgIGNvbnNvbGUubG9nKCdlbWl0IC0tLS0nICsgbmFtZSwgbWVzc2FnZSlcbiAgICAgICAgdGhpcy5qc0RpclRvWmlwLmVtaXQobmFtZSwgbWVzc2FnZSk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChuYW1lID09PSB0aGlzLmpzRGlyVG9aaXAuZXZlbnRuYW1lcy5zZW5kZmlsZSkgYnRuLmRpc2FibGVkID0gdHJ1ZTtcbiAgfVxuICBnZXRCdG4oaXRlbSwgdGFyZ2V0LCBwYXJlbnQgPSBudWxsKSB7XG4gICAgY29uc3QgYnRua2V5ID0gdGhpcy5vcHRpb25zLmJ0bnByZWZpeCArIGl0ZW0gKyB0YXJnZXQ7XG4gICAgaWYgKHRoaXNbYnRua2V5XSkgcmV0dXJuIHRoaXNbYnRua2V5XTtcbiAgICBjb25zdCBkaXNwbGF5ID0gdGhpcy5vcHRpb25zLmNvbnRyb2xzW2l0ZW1dLmJ0blt0YXJnZXRdO1xuICAgIGNvbnN0IGJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGRpc3BsYXkpO1xuICAgIGlmICghYnRuKSB7XG4gICAgICBwYXJlbnQgPSAocGFyZW50KSA/IHBhcmVudCA6IHRoaXMuZHJvcHpvbmU7XG4gICAgICBwYXJlbnQuaW5zZXJ0QWRqYWNlbnRIVE1MKCdiZWZvcmVlbmQnLCBgPGJ1dHRvbiBpZD1cIiR7ZGlzcGxheX1cIiBjbGFzcz1cImJ1dHRvbiAke2Rpc3BsYXl9ICR7bG9jYWxjc3MubXJpZ2h0fSAke2Nzcy5oaWRlfVwiPjwvYnV0dG9uPmApO1xuICAgICAgdGhpc1tidG5rZXldID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZGlzcGxheSk7XG4gICAgICB0aGlzW2J0bmtleV0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoZSkgPT4ge1xuICAgICAgICB0aGlzLmVtaXRUb1ppcChlLmN1cnJlbnRUYXJnZXQpO1xuICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzW2J0bmtleV07XG4gIH1cblxuICBpbml0RGlzcGxheXMoKSB7XG4gICAgY29uc29sZS5sb2coJ2luaXRkaXNwYXknLCB0aGlzLm9wdGlvbnMuY29udHJvbHMpXG4gICAgT2JqZWN0LmVudHJpZXModGhpcy5vcHRpb25zLmNvbnRyb2xzKS5mb3JFYWNoKChba2V5LCBpdGVtXSwgaSkgPT4ge1xuICAgICAgdGhpcy5pbml0RmlsZUNvdW50ZXIoa2V5LCBpdGVtLmRpc3BsYXksIGkpO1xuICAgICAgaWYgKGl0ZW0uYnRuKSB0aGlzLmFjdGl2YXRlQ29udHJvbHMoa2V5LCBpdGVtLmJ0bik7XG4gICAgfSk7XG5cbiAgfVxuICBhY3RpdmF0ZUNvbnRyb2xzKGtleSwgYnRucykge1xuICAgIE9iamVjdC5rZXlzKGJ0bnMpLmZvckVhY2goKGJ0bikgPT4ge1xuICAgICAgdGhpc1t0aGlzLm9wdGlvbnMuYnRucHJlZml4ICsga2V5ICsgYnRuXSA9IHRoaXMuZ2V0QnRuKGtleSwgYnRuKTtcbiAgICB9KVxuXG4gIH1cbn0iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/modules/js-my-files.js\n")}}]);