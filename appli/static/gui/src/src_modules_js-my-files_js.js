/*! For license information please see src_modules_js-my-files_js.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["src_modules_js-my-files_js"],{"./src/modules/files/js-dirlist.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   JsDirList: () => (/* binding */ JsDirList),\n/* harmony export */   eventEntry: () => (/* binding */ eventEntry)\n/* harmony export */ });\n/* harmony import */ var _modules_utils_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../modules/utils.js */ \"./src/modules/utils.js\");\n/* harmony import */ var _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../modules/modules-config.js */ \"./src/modules/modules-config.js\");\n\n\nconst filter_files = {\n  images: \"png,jpeg,jpg,gif\",\n  tsv: \"txt,tsv,zip, gzip,gz\"\n}\n\nconst eventEntry = new CustomEvent('eventEntry', {\n  detail: () => {\n    console.log('customevent', undefined.entry)\n  },\n})\nconst defaultOptions = {\n  api_parameters: {\n    entry: 'entry',\n    dest: 'dest'\n  },\n  url: '/gui/files',\n  controls: {\n    scan: {\n      display: {\n        counter: 'counter',\n        size: 'size',\n      }\n    },\n    zip: {\n      btn: {\n        zip: 'makezip',\n        zipped: 'makezipped'\n      },\n      display: {\n        size: 'sizezipped',\n        counter: 'counterzipped',\n      }\n    },\n\n  },\n  upload: {\n    label: 'upload'\n  },\n  btnprefix: 'btn',\n  btnfilelist: null,\n  entry: {\n    selector: '[data-name]',\n\n    tags: {\n      tag: 'ul',\n      subtag: 'li',\n      label: 'span'\n    },\n    selectors: {\n      entries: '.entries'\n    },\n    draggable: true,\n    prefix: `entry`,\n    type: {\n      root: \"R\",\n      trash: \"T\",\n      directory: \"D\",\n      file: \"F\",\n      trashed: \"X\",\n    },\n    specialdirs: [\"R\", \"T\"],\n    trash_dir_name: 'trash.',\n    css: {\n      on: 'on',\n      entryF: 'entryF',\n      entryD: 'entryD',\n      entryR: 'entryR',\n      entryT: 'entryT',\n      editable: 'editable',\n      dragging: 'dragging',\n      dragover: 'dragover',\n      dragitem: 'dragitem'\n    },\n    icons: {\n      image: 'img',\n      document: 'doc'\n    },\n  },\n  entrycontrols: {\n    selectors: {\n      typentries: '[data-typentries]',\n      hascontrols: '.has-controls',\n    },\n    controls: {\n      list: {\n        action: 'list',\n        typentries: ['D', 'R', 'T']\n      },\n      create: {\n        action: 'create',\n        text: 'new folder',\n        icon: 'icon-folder-plus-sm',\n        typentries: ['D', 'R']\n      },\n      remove: {\n        action: 'remove',\n        text: 'delete',\n        icon: 'icon-trash-sm',\n        typentries: ['D', 'F', 'X']\n      },\n      move: {\n        action: 'move',\n        typentries: ['D', 'F']\n      },\n      rename: {\n        action: 'rename',\n        trigger: 'dblclick',\n        typentries: ['D', 'F']\n      }\n    },\n    css: {\n      entrycontrols: 'entrycontrols',\n      entries: '.entries',\n    }\n  },\n  selectors: {\n    doupload: '.target-upload',\n    droptarget: '.droptarget',\n    dirlist: '.dirlist',\n    uploadfile: 'uploadfile',\n    displayresult: 'results',\n    trigger: '.trigger',\n  },\n}\nclass Entry {\n  _events;\n  eventnames;\n  name;\n  type;\n  label;\n  entries = [];\n  options = {\n    selector: '[data-name]',\n    tags: {\n      tag: 'ul',\n      subtag: 'li',\n      label: 'span'\n    },\n    selectors: {\n      entries: '.entries'\n    },\n    css: {\n      on: 'on',\n    },\n    draggable: true,\n    prefix: `entry`,\n  };\n\n  constructor(entry, options = {}) {\n    this.name = entry.name;\n    this.type = entry.type;\n    this.root = options.root;\n    this.parent = (options.parent) ? options.parent : null;\n    this.options = Object.assign(this.options, defaultOptions);\n    this.options = Object.assign(this.options, options);\n    this.label = (options.label) ? options.label : null;\n    this.init(entry);\n    return this;\n  }\n  init(entry) {\n    //\n    (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.add_custom_events)(this);\n    const dataset = {\n      name: this.name,\n      type: this.type\n    }\n    if (this.label !== null) dataset.label = this.label;\n    const el = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)(this.options.tags.subtag, {\n      draggable: this.options.draggable,\n      dataset: dataset,\n    });\n    const cl = (this.options.class) ? this.options.class : [];\n    cl.unshift(`${this.options.prefix}${this.type}`);\n    this.label = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)(this.options.tags.label, {\n      class: cl,\n      text: (entry.label) ? entry.label : entry.name\n    }, el);\n    this.container = el;\n    this.initEvents();\n  }\n  initEvents() {\n    Object.entries(this.options.actions).forEach(([key, action]) => {\n      this.on(action, (e) => {\n        this[key](e);\n      });\n    });\n  }\n  getParent() {\n    return this.parent;\n  }\n  getLabelElement() {\n    return this.label;\n  }\n  getParentElement() {\n    return this.container.parentElement.closest(this.options.selector);\n  }\n\n  getEntries() {\n    return this.entries();\n  }\n  getEntriesElement(create = false) {\n    let entries = this.container.querySelector(this.options.selectors.entries);\n    if (create && entries === null) {\n      return (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)(this.options.tags.tag, {\n        class: this.options.selectors.entries.substr(1)\n      }, this.container);\n    }\n    return entries;\n  }\n\n  appendEntry(entry) {\n    if (entry.parent) {\n      console.log('this', entry)\n      const n = entry.parent.entries.indexOf(entry);\n      delete entry.parent.entries[n];\n    }\n    entry.parent = this;\n    this.entries.push(entry);\n    const parent = this.getEntriesElement(true);\n    parent.append(entry.container);\n    return entry;\n  }\n  createEntry(entry) {\n    const new_entry = new Entry(entry);\n    this.appendEntry(new_entry);\n  }\n  //\n  createListEntries(listentries) {\n    const direntry = this.getEntriesElement(true);\n    listentries.forEach(entries => {\n      entries.forEach((entry) => {\n        const new_entry = this.createEntry(entry);\n\n      });\n    });\n  }\n\n  isOn() {\n    return this.active;\n\n  }\n  toggleOn() {\n    this.active = !(this.active);\n    this.container.classList.toggle(this.options.css.on);\n  }\n  setOff() {\n    this.active = false;\n    this.container.classList.remove(this.options.css.on);\n  }\n  emitEvent(action = null, ev = null) {\n    const self = this;\n    const detail = {\n      entry: self,\n    }\n    if (action) detail.action = action;\n    if (ev) detail.event = ev;\n    eventEntry.initCustomEvent('eventEntry', true, true, detail);\n    window.dispatchEvent(eventEntry);\n  }\n  moveHandlers() {\n    return [{\n      name: 'dragover',\n      func: (e) => {\n        this.handleDragOver(e);\n      }\n    }, {\n      name: 'drop',\n      func: (e) => {\n        this.handleDrop(e);\n      }\n    }];\n  }\n  dropHandlers() {\n    return [{\n      name: 'dragover',\n      func: (e) => {\n        this.handleDragOver(e);\n      }\n    }, {\n      name: 'drop',\n      func: (e) => {\n        this.handleDrop(e);\n      }\n    }];\n  }\n  handleDrop(e) {\n\n  }\n  addListeners() {\n    let func = (e) => {\n      e.stopImmediatePropagation();\n      this.dirControls(() => {\n        this.emitEvent(this.eventnames.attach);\n      });\n    };\n    let listeners = []\n    if ([this.options.type.root, this.options.type.trash].indexOf(this.type) < 0) {\n      if (this.isInTrash()) console.log(' isintrash ' + this.name, this.isInTrash())\n      listeners = this.moveHandlers();\n      if (this.type === this.options.type.file) {\n        func = (e) => {\n          e.stopImmediatePropagation();\n          this.toggleOn();\n          this.emitEvent();\n        }\n      } else if (this.isInTrash()) {\n        this.type = this.options.type.trashed;\n      } else listeners = listeners.concat(this.dropHandlers());\n      this.listenRename();\n    }\n    listeners.unshift({\n      name: 'click',\n      target: 'label',\n      func: func\n    });\n    for (const listener of listeners) {\n      const el = (listener.target === 'label') ? this.getLabelElement() : this.container;\n      el.addEventListener(listener.name, listener.func);\n    }\n  }\n  removeListeners(listeners) {\n    for (const listener in listeners) {\n      const el = (listener.target === 'label') ? this.getLabelElement() : this.container;\n      el.removeEventListener(listener.label, listener.func);\n    }\n  }\n  destroy() {\n    this.container.remove();\n  }\n\n  handleDragStart(e) {\n    this.container.classList.add(this.options.css.dragging);\n    e.dataTransfer.effectAllowed = 'move';\n    this.emitEvent('dragstart');\n  }\n  handleDragOver(e) {\n    e.stopPropagation();\n    e.preventDefault();\n    this.emitEvent('dragover');\n    return;\n  }\n  handleDragEnd(e) {\n    e.stopPropagation();\n    e.preventDefault();\n    if (this.container.classList.contains(this.options.css.dragging)) this.container.classList.remove(this.options.css.dragging);\n    this.emitEvent('dragend');\n  }\n  resetDragOver() {\n    document.querySelectorAll('.' + this.options.css.dragover).forEach(el => {\n      el.classList.remove(this.options.css.dragover);\n    });\n  }\n  handleDrop(e) {\n    /***/\n    this.emitEvent('drop', e);\n  }\n\n  unMove() {\n    if (this.from) {\n      this.move(this.from);\n      this.from.container.append(this);\n      this.from = null;\n    }\n  }\n}\n\nclass EntryAction extends Entry {\n  eventnames = {\n    attach: 'attach',\n    detach: 'detach',\n    istrashdir: 'istrashdir',\n    trashed: 'trashed',\n  }\n  isTrashDir(name = null) {\n    return ((name === null) ? this.name : name).indexOf(this.options.trash_dir_name) === 0;\n  }\n  isInTrash(path = null) {\n    path = (path === null) ? this.getCurrentDirPath() : path;\n    if (path === null) (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.stop_on_error)('path_not_found');\n    path = path.split(_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.dirseparator);\n    return (path.length > 1 && path[0].indexOf(this.options.trash_dir_name)) === 0;\n  }\n\n  setWait() {\n    this.loaded = this.container.dataset.loaded = false;\n    this.container.classList.add('wait');\n  }\n  setLoaded() {\n    this.container.classList.remove('wait');\n    this.loaded = this.container.dataset.loaded = true;\n  }\n\n  dirControls(callback = null) {\n    const el = this.container;\n    if (el.dataset.action === \"create\") return;\n    this.toggleOn();\n    if (this.isOn()) this.dirActivate(callback).then(() => {\n      this.emitEvent();\n    });\n\n  }\n\n  async dirActivate(callback = null) {\n    if (!this.loaded) this.list().then(() => {\n      if (callback) callback(this);\n    });\n    else if (callback) callback(this);\n  }\n\n  getCurrentDirPath() {\n    const current_path = (entry, dirs = []) => {\n      if (entry.name) {\n        dirs.push(entry.name);\n        entry = entry.getParent();\n        if (entry !== null) return current_path(entry, dirs);\n      }\n      return dirs;\n    }\n    let dirs = current_path(this);\n    if (dirs.length > 1) dirs = dirs.reverse();\n    return dirs.join(_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.dirseparator);\n  }\n\n  async fetchAction(action, callback = null, callback_error = null) {\n    const api_parameters = this.options.api_parameters;\n    const label = this.getLabelElement();\n    let entrypath = this.getCurrentDirPath();\n    if (entrypath === '') return;\n    const data = new FormData();\n    data.append(api_parameters.entry, entrypath);\n    switch (action) {\n      case this.options.actions.create:\n        if (label === null) return;\n        entrypath = entrypath + _modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.dirseparator + label.textContent;\n        if (entrypath.trim() !== \"\") data.append(api_parameters.entry, entrypath);\n        break;\n      case this.options.actions.move:\n        // get new path - append item to drop directory\n        if (callback !== null) {\n          let destpath = callback();\n          callback = null;\n          if (destpath === entrypath) {\n            console.log('dest = entry', destpath);\n            return;\n          }\n          data.append(api_parameters.dest, destpath);\n          console.log(entrypath + ' destmove ', destpath)\n        } else return;\n        break;\n      case this.options.actions.rename:\n        const destpath = entrypath.split(_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.dirseparator);\n        destpath[destpath.length - 1] = label.textContent;\n        if (destpath.join(_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.dirseparator) === entrypath) return;\n        data.append(api_parameters.dest, destpath.join(_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.dirseparator));\n        break;\n    }\n    const response = await fetch(this.options.url + _modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.urlseparator + action, (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.fetchSettings)({\n      method: \"POST\",\n      body: data\n    }));\n    const json = await response.json();\n    console.log('responsejson', json)\n    if (json.status === 200) {\n      if (callback) callback(json.message);\n      return true;\n    } else {\n      if (callback_error) callback_error(json);\n      else (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.stop_on_error)(json);\n    }\n  }\n  listenRename(evt = 'dblclick') {\n    const entry = this;\n    const label = entry.getLabelElement();\n    label.addEventListener(evt, (e) => {\n      const send_rename = async (e) => {\n        if (e.key === 'Enter') {\n          e.preventDefault();\n          label.contentEditable = false;\n          entry.container.draggable = (this.options.specialdirs.indexOf(entry.type) < 0);\n          const callback = (txt) => {\n            label.classList.remove(entry.options.css.editable);\n            if (txt === \"\") window.alertbox.addItemMessage(label, {\n              type: 'error',\n              content: window.alertbox.i18nmessages.exists,\n              duration: 2000\n            });\n            else txt = txt.split(_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.dirseparator).pop();\n            label.removeEventListener('keydown', send_rename);\n            label.textContent = txt;\n            if (entry.type === entry.options.type.directory) entry.dirControls();\n            delete entry.container.dataset.action;\n          }\n          const action = (entry.container.dataset.action) ? entry.container.dataset.action : entry.options.actions.rename;\n          console.log('action entry_rename ' + action, entry.container)\n          await entry.fetchAction(action, callback);\n        }\n      }\n      label.contentEditable = true;\n      entry.container.draggable = false;\n      label.classList.add(entry.options.css.editable);\n      label.addEventListener('keydown', send_rename);\n    });\n  }\n\n  createEntry(entry) {\n    const ext = entry.name.split('.').pop();\n    const options = this.options;\n    options.draggable = (options.specialdirs.indexOf(entry.type) < 0);\n    options.class = [];\n    if (this.isTrashDir(entry.name)) entry.type = this.options.type.trash;\n    const cl = (entry.type === options.type.file) ? (filter_files.images.split(',').indexOf(ext) >= 0) ? options.icons.image : options.icons.document : null;\n    if (cl !== null) options.class.push(cl);\n    const new_entry = new EntryAction(entry, options);\n    if (entry.type === this.options.type.trash) new_entry.emitEvent(this.eventnames.istrashdir);\n    this.appendEntry(new_entry);\n    new_entry.addListeners();\n    return new_entry;\n  }\n\n  async list() {\n    if (this.type === this.options.type.file) return;\n    const tag = this.options.tags.tag;\n    const subtag = this.options.tags.subtag;\n    const subdir = (this.name) ? this.getCurrentDirPath() : null;\n    this.setWait();\n    const el = this.getEntriesElement();\n    if (el) el.remove();\n    fetch(this.options.url + _modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.urlseparator + this.options.actions.list + ((subdir) ? _modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.dirseparator + subdir : ''), (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.fetchSettings)()).then(response => response.json()).then(async json => {\n      if (json.entries && json.entries.length) {\n        let files = [],\n          directories = [],\n          entries = json.entries;\n        while (entries.length > 0) {\n          const entry = entries.shift();\n          if (entry.type === this.options.type.file) files.push(entry);\n          else directories.push(entry);\n        };\n        files.sort((a, b) => (a.name < b.name));\n        directories.sort((a, b) => (a.name < b.name));\n        this.createListEntries([directories, files]);\n      }\n      this.setLoaded();\n    });\n  }\n  remove() {\n    if (this.isTrashDir()) return;\n    const from = this.getCurrentDirPath();\n    this.fetchAction(this.options.actions.remove).then(ret => {\n      console.log('remove ', this)\n      this.from = from;\n      this.removeListeners(this.dropHandlers());\n      this.setOff();\n      this.container.animate({\n        transform: \"translateX(-100%) scale(0)\"\n      }, {\n        duration: 1000\n      });\n      setTimeout(() => {\n        if (this.isInTrash(this.from)) this.destroy();\n        else this.emitEvent(this.eventnames.trashed);\n      }, 1000);\n\n    });\n  }\n  create() {\n    const new_entry = this.createEntry({\n      type: 'D',\n      name: 'NewFolder'\n    });\n    new_entry.container.dataset.action = this.options.actions.create;\n    new_entry.label.dispatchEvent(new Event('dblclick'));\n  }\n  rename() {\n    if (this.isTrashDir()) return;\n    this.fetchAction(this.options.actions.rename).then(() => {\n      console.log('renamed', this)\n    });\n  }\n\n  move(dest) {\n    if (this.isTrashDir()) return;\n    const from = this.getCurrentDirPath();\n\n    this.fetchAction(this.options.actions.move, () => {\n      return dest.getCurrentDirPath();\n    }).then(() => {\n      this.from = from;\n      const entries = dest.getEntriesElement(true);\n      entries.append(this.container);\n    }).catch(err => {});\n  }\n}\n\nclass JsEntryControls {\n  _events = {};\n  eventnames = {\n    control: 'control',\n    error: 'error',\n  }\n  options = defaultOptions.entrycontrols;\n  box;\n  container;\n  entry = null;\n  constructor(container = document, options = {}) {\n    if (!container.jsentrycontrols) {\n      this.options = Object.assign(this.options, options);\n      this.container = container;\n      this.entry = null;\n      this.init();\n      container.jsentrycontrols = this;\n    }\n    return container.jsentrycontrols;\n  }\n  init() {\n    (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.add_custom_events)(this);\n    this.box = this.createControls();\n    this.initEvents();\n\n  }\n  createControls() {\n    const box = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)('div', {\n      class: [this.options.css.entrycontrols, _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide]\n    });\n    Object.values(this.options.controls).filter(control => (control.icon || control.text)).forEach(control => {\n      const ctrl = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)('span', {}, box);\n      if (control.typentries) ctrl.dataset.typentries = control.typentries;\n      if (control.icon) {\n        const icon = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)('i', {\n          class: ['icon', control.icon]\n        }, ctrl);\n        ctrl.dataset.title = control.text;\n      } else ctrl.textContent = control.text;\n      //add listener\n      const evt = (control.trigger) ? control.trigger : 'click';\n      const func = (e) => {\n        if (this.entry === null) return;\n        const detail = {\n          callback: () => {\n            console.log('done', control.action);\n          }\n        }\n        this.entry.emit(control.action, detail);\n      }\n      ctrl.addEventListener(evt, func);\n      //\n      control.ctrl = ctrl;\n    });\n    return box;\n  }\n  initEvents() {}\n  detachControls() {\n    if (this.entry === null) return;\n    this.entry.container.classList.remove(this.options.selectors.hascontrols.substr(1));\n    this.box.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n    this.box.disabled = true;\n    this.container.append(this.box);\n    this.entry = null;\n  }\n\n  attachControls(entry) {\n    this.detachControls();\n    this.entry = entry;\n    this.entry.container.prepend(this.box);\n    this.entry.container.classList.add(this.options.selectors.hascontrols.substr(1));\n    this.activateControls();\n    this.box.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n    delete this.box.disabled;\n  }\n\n  activateControls() {\n    if (this.entry === null) return;\n    // add btns\n    const isintrash = this.entry.isInTrash();\n    Object.values(this.options.controls).filter(control => (control.icon || control.text)).forEach(control => {\n      const ctrl = control.ctrl;\n      const typentries = (ctrl.dataset.typentries) ? ctrl.dataset.typentries.split(',') : [];\n      const type = (isintrash) ? this.entry.options.type.trashed : this.entry.container.dataset.type;\n      if (typentries.indexOf(type) >= 0) {\n        ctrl.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n      } else ctrl.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n    });\n    //\n  }\n}\n\nclass JsDirList {\n  _events = {};\n  eventnames = {\n    attach: 'attach',\n    detach: 'detach',\n    action: 'action',\n    complete: 'complete',\n    error: 'error',\n  }\n  options = defaultOptions;\n\n  constructor(parent, options = {}) {\n    if (!parent.jsdirlist) {\n      parent = (parent instanceof HTMLElement) ? parent : document.querySelector(parent);\n      if (!parent) return;\n      this.options = Object.assign(this.options, options);\n      this.options.entry.url = this.options.url;\n      this.container = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)(this.options.entry.tags.tag, {\n        class: this.options.selectors.dirlist.substr(1)\n      }, parent);\n      this.init();\n      this.container.append(this.root.container);\n      parent.jsdirlist = this;\n    }\n    return parent.jsdirlist;\n  }\n\n  init() {\n    (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.add_custom_events)(this);\n    const type = this.options.entry.type.root;\n    const obj = {};\n    this.entrycontrols = (this.options.controls) ? new JsEntryControls(this.container, this.options.entrycontrols) : null;\n    Object.entries(this.options.entrycontrols.controls).forEach(([key, control]) => {\n      obj[key] = control.action;\n    });\n    this.options.entry.actions = obj;\n    this.initEvents();\n    const options = this.options.entry;\n    options.draggable = false;\n    this.root = new EntryAction({\n      type: type,\n      name: '',\n      label: '..',\n      root: this\n    }, options);\n\n    this.root.addListeners();\n\n  }\n  initEvents() {\n    console.log(' init events%%%%%%%%%%%%%%%%%%%%%%%ù)', this.entrycontrols)\n    // events controls on entries\n    const self = this;\n    // alerts on error\n    this.on(this.eventnames.error, (e) => {\n      console.log('dirlist receive error message', e)\n      if (window.alertbox) {\n        window.alertbox.renderAlert({\n          type: window.alertbox.alertconfig.types.error,\n          content: e,\n          inverse: true,\n          dismissible: true\n        });\n      }\n    });\n    window.addEventListener('eventEntry', (e) => {\n      const eventnames = e.detail.entry.eventnames;\n      switch (e.detail.action) {\n        case eventnames.istrashdir:\n          this.trashdir = e.detail.entry;\n          break;\n        case eventnames.trashed:\n          console.log(' trashed from---------', e.detail.entry.from)\n          if (e.detail.entry.isInTrash(e.detail.entry.from)) this.detachControls();\n          else {\n            this.trashdir.appendEntry(e.detail.entry, this.trashdir);\n            e.detail.entry.from = e.detail.entry.getCurrentDirPath();\n            console.log(' new path after trashed from---------', e.detail.entry.from);\n            this.attachControls(e.detail.entry);\n            e.detail.entry.container.classList.add('bg-danger-100');\n          }\n          this.emit(this.eventnames.detach, e.detail);\n          break;\n        case eventnames.detach:\n          this.detachControls();\n        case eventnames.attach:\n          // no upload on trash dir\n          const type = (e.detail.entry.isInTrash()) ? e.detail.entry.options.type.trashed : e.detail.entry.container.dataset.type;\n          if (type === e.detail.entry.options.type.trash) return;\n          if (e.detail.action === eventnames.attach && type === e.detail.entry.options.type.trashed) return;\n          this.emit(this.eventnames[e.detail.action], e.detail);\n          break;\n        case \"dragstart\":\n          this.detachControls();\n          this.dragentry = this.activentry = e.detail.entry;\n          e.detail.entry.container.classList.add(e.detail.entry.options.css.dragging);\n          break;\n        case \"dragover\":\n          if (!this.dragentry) return;\n          if (this.overitem !== e.detail.entry.container) {\n            if (this.overitem) this.overitem.classList.remove(e.detail.entry.options.css.dragover);\n            e.detail.entry.container.classList.add(e.detail.entry.options.css.dragover);\n            this.overitem = e.detail.entry.container;\n          }\n          break;\n        case \"dragend\":\n          this.dragentry = null;\n          if (this.overitem) this.overitem.classList.remove(e.detail.entry.options.css.dragover);\n          this.overitem = null;\n          break;\n        case \"drop\":\n          if (!this.dragentry) {\n            console.log(' drop upload ', e)\n            this.emit(this.eventnames.action, e);\n            return true;\n          } else {\n            console.log(' dragentry drop', e);\n          }\n          e.stopPropagation();\n          const el = this.dragentry.container;\n          const dest_entry = e.detail.entry;\n          dest_entry.resetDragOver();\n          if (this.dragentry !== null) {\n            console.log(\"move file or dir\", this.dragendentry)\n            if (this.dragentry.options.actions.move) {\n              try {\n                this.dragentry.move(dest_entry);\n                parent.append(el);\n              } catch (error) {\n                this.dragentry.unMove();\n              }\n            } else console.log('noactionon drop');\n          } else console.log(' parent===null or dragitem===null or dragitem===parent', this.dragentry)\n          return;\n          break;\n        default:\n          if (e.detail.entry.active) this.attachControls(e.detail.entry);\n          else {\n            this.attachControls(this.root);\n          }\n          break;\n      }\n    });\n  }\n  attachControls(entry) {\n\n    this.detachControls();\n    if (this.entrycontrols) {\n      this.entrycontrols.attachControls(entry);\n    } else this.detachControls();\n    this.activentry = entry;\n  }\n\n  detachControls() {\n    if (this.entrycontrols) this.entrycontrols.attachControls(this.root);\n    this.activentry = this.root;\n  }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvbW9kdWxlcy9maWxlcy9qcy1kaXJsaXN0LmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFTOEI7QUFHVztBQUN6QztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsK0JBQStCLFNBQUk7QUFDbkMsR0FBRztBQUNILENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUwsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7O0FBRUEsaUNBQWlDO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUksb0VBQWlCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlLDZEQUFVO0FBQ3pCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxrQkFBa0Isb0JBQW9CLEVBQUUsVUFBVTtBQUNsRCxpQkFBaUIsNkRBQVU7QUFDM0I7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYSw2REFBVTtBQUN2QjtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBTztBQUNQLEtBQUs7QUFDTDs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztB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VDtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQjtBQUNoQjtBQUNBO0FBQ0EsY0FBYztBQUNkLFlBQVk7QUFDWjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vc3JjL21vZHVsZXMvZmlsZXMvanMtZGlybGlzdC5qcz8yM2M1Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIGRvbV9wdXJpZnksXG4gIGZldGNoU2V0dGluZ3MsXG4gIGNyZWF0ZV9ib3gsXG4gIGRpcnNlcGFyYXRvcixcbiAgdXJsc2VwYXJhdG9yLFxuICBhZGRfY3VzdG9tX2V2ZW50cyxcbiAgc3RvcF9vbl9lcnJvclxufVxuZnJvbSAnLi4vLi4vbW9kdWxlcy91dGlscy5qcyc7XG5pbXBvcnQge1xuICBjc3MsXG59IGZyb20gJy4uLy4uL21vZHVsZXMvbW9kdWxlcy1jb25maWcuanMnO1xuY29uc3QgZmlsdGVyX2ZpbGVzID0ge1xuICBpbWFnZXM6IFwicG5nLGpwZWcsanBnLGdpZlwiLFxuICB0c3Y6IFwidHh0LHRzdix6aXAsIGd6aXAsZ3pcIlxufVxuXG5jb25zdCBldmVudEVudHJ5ID0gbmV3IEN1c3RvbUV2ZW50KCdldmVudEVudHJ5Jywge1xuICBkZXRhaWw6ICgpID0+IHtcbiAgICBjb25zb2xlLmxvZygnY3VzdG9tZXZlbnQnLCB0aGlzLmVudHJ5KVxuICB9LFxufSlcbmNvbnN0IGRlZmF1bHRPcHRpb25zID0ge1xuICBhcGlfcGFyYW1ldGVyczoge1xuICAgIGVudHJ5OiAnZW50cnknLFxuICAgIGRlc3Q6ICdkZXN0J1xuICB9LFxuICB1cmw6ICcvZ3VpL2ZpbGVzJyxcbiAgY29udHJvbHM6IHtcbiAgICBzY2FuOiB7XG4gICAgICBkaXNwbGF5OiB7XG4gICAgICAgIGNvdW50ZXI6ICdjb3VudGVyJyxcbiAgICAgICAgc2l6ZTogJ3NpemUnLFxuICAgICAgfVxuICAgIH0sXG4gICAgemlwOiB7XG4gICAgICBidG46IHtcbiAgICAgICAgemlwOiAnbWFrZXppcCcsXG4gICAgICAgIHppcHBlZDogJ21ha2V6aXBwZWQnXG4gICAgICB9LFxuICAgICAgZGlzcGxheToge1xuICAgICAgICBzaXplOiAnc2l6ZXppcHBlZCcsXG4gICAgICAgIGNvdW50ZXI6ICdjb3VudGVyemlwcGVkJyxcbiAgICAgIH1cbiAgICB9LFxuXG4gIH0sXG4gIHVwbG9hZDoge1xuICAgIGxhYmVsOiAndXBsb2FkJ1xuICB9LFxuICBidG5wcmVmaXg6ICdidG4nLFxuICBidG5maWxlbGlzdDogbnVsbCxcbiAgZW50cnk6IHtcbiAgICBzZWxlY3RvcjogJ1tkYXRhLW5hbWVdJyxcblxuICAgIHRhZ3M6IHtcbiAgICAgIHRhZzogJ3VsJyxcbiAgICAgIHN1YnRhZzogJ2xpJyxcbiAgICAgIGxhYmVsOiAnc3BhbidcbiAgICB9LFxuICAgIHNlbGVjdG9yczoge1xuICAgICAgZW50cmllczogJy5lbnRyaWVzJ1xuICAgIH0sXG4gICAgZHJhZ2dhYmxlOiB0cnVlLFxuICAgIHByZWZpeDogYGVudHJ5YCxcbiAgICB0eXBlOiB7XG4gICAgICByb290OiBcIlJcIixcbiAgICAgIHRyYXNoOiBcIlRcIixcbiAgICAgIGRpcmVjdG9yeTogXCJEXCIsXG4gICAgICBmaWxlOiBcIkZcIixcbiAgICAgIHRyYXNoZWQ6IFwiWFwiLFxuICAgIH0sXG4gICAgc3BlY2lhbGRpcnM6IFtcIlJcIiwgXCJUXCJdLFxuICAgIHRyYXNoX2Rpcl9uYW1lOiAndHJhc2guJyxcbiAgICBjc3M6IHtcbiAgICAgIG9uOiAnb24nLFxuICAgICAgZW50cnlGOiAnZW50cnlGJyxcbiAgICAgIGVudHJ5RDogJ2VudHJ5RCcsXG4gICAgICBlbnRyeVI6ICdlbnRyeVInLFxuICAgICAgZW50cnlUOiAnZW50cnlUJyxcbiAgICAgIGVkaXRhYmxlOiAnZWRpdGFibGUnLFxuICAgICAgZHJhZ2dpbmc6ICdkcmFnZ2luZycsXG4gICAgICBkcmFnb3ZlcjogJ2RyYWdvdmVyJyxcbiAgICAgIGRyYWdpdGVtOiAnZHJhZ2l0ZW0nXG4gICAgfSxcbiAgICBpY29uczoge1xuICAgICAgaW1hZ2U6ICdpbWcnLFxuICAgICAgZG9jdW1lbnQ6ICdkb2MnXG4gICAgfSxcbiAgfSxcbiAgZW50cnljb250cm9sczoge1xuICAgIHNlbGVjdG9yczoge1xuICAgICAgdHlwZW50cmllczogJ1tkYXRhLXR5cGVudHJpZXNdJyxcbiAgICAgIGhhc2NvbnRyb2xzOiAnLmhhcy1jb250cm9scycsXG4gICAgfSxcbiAgICBjb250cm9sczoge1xuICAgICAgbGlzdDoge1xuICAgICAgICBhY3Rpb246ICdsaXN0JyxcbiAgICAgICAgdHlwZW50cmllczogWydEJywgJ1InLCAnVCddXG4gICAgICB9LFxuICAgICAgY3JlYXRlOiB7XG4gICAgICAgIGFjdGlvbjogJ2NyZWF0ZScsXG4gICAgICAgIHRleHQ6ICduZXcgZm9sZGVyJyxcbiAgICAgICAgaWNvbjogJ2ljb24tZm9sZGVyLXBsdXMtc20nLFxuICAgICAgICB0eXBlbnRyaWVzOiBbJ0QnLCAnUiddXG4gICAgICB9LFxuICAgICAgcmVtb3ZlOiB7XG4gICAgICAgIGFjdGlvbjogJ3JlbW92ZScsXG4gICAgICAgIHRleHQ6ICdkZWxldGUnLFxuICAgICAgICBpY29uOiAnaWNvbi10cmFzaC1zbScsXG4gICAgICAgIHR5cGVudHJpZXM6IFsnRCcsICdGJywgJ1gnXVxuICAgICAgfSxcbiAgICAgIG1vdmU6IHtcbiAgICAgICAgYWN0aW9uOiAnbW92ZScsXG4gICAgICAgIHR5cGVudHJpZXM6IFsnRCcsICdGJ11cbiAgICAgIH0sXG4gICAgICByZW5hbWU6IHtcbiAgICAgICAgYWN0aW9uOiAncmVuYW1lJyxcbiAgICAgICAgdHJpZ2dlcjogJ2RibGNsaWNrJyxcbiAgICAgICAgdHlwZW50cmllczogWydEJywgJ0YnXVxuICAgICAgfVxuICAgIH0sXG4gICAgY3NzOiB7XG4gICAgICBlbnRyeWNvbnRyb2xzOiAnZW50cnljb250cm9scycsXG4gICAgICBlbnRyaWVzOiAnLmVudHJpZXMnLFxuICAgIH1cbiAgfSxcbiAgc2VsZWN0b3JzOiB7XG4gICAgZG91cGxvYWQ6ICcudGFyZ2V0LXVwbG9hZCcsXG4gICAgZHJvcHRhcmdldDogJy5kcm9wdGFyZ2V0JyxcbiAgICBkaXJsaXN0OiAnLmRpcmxpc3QnLFxuICAgIHVwbG9hZGZpbGU6ICd1cGxvYWRmaWxlJyxcbiAgICBkaXNwbGF5cmVzdWx0OiAncmVzdWx0cycsXG4gICAgdHJpZ2dlcjogJy50cmlnZ2VyJyxcbiAgfSxcbn1cbmNsYXNzIEVudHJ5IHtcbiAgX2V2ZW50cztcbiAgZXZlbnRuYW1lcztcbiAgbmFtZTtcbiAgdHlwZTtcbiAgbGFiZWw7XG4gIGVudHJpZXMgPSBbXTtcbiAgb3B0aW9ucyA9IHtcbiAgICBzZWxlY3RvcjogJ1tkYXRhLW5hbWVdJyxcbiAgICB0YWdzOiB7XG4gICAgICB0YWc6ICd1bCcsXG4gICAgICBzdWJ0YWc6ICdsaScsXG4gICAgICBsYWJlbDogJ3NwYW4nXG4gICAgfSxcbiAgICBzZWxlY3RvcnM6IHtcbiAgICAgIGVudHJpZXM6ICcuZW50cmllcydcbiAgICB9LFxuICAgIGNzczoge1xuICAgICAgb246ICdvbicsXG4gICAgfSxcbiAgICBkcmFnZ2FibGU6IHRydWUsXG4gICAgcHJlZml4OiBgZW50cnlgLFxuICB9O1xuXG4gIGNvbnN0cnVjdG9yKGVudHJ5LCBvcHRpb25zID0ge30pIHtcbiAgICB0aGlzLm5hbWUgPSBlbnRyeS5uYW1lO1xuICAgIHRoaXMudHlwZSA9IGVudHJ5LnR5cGU7XG4gICAgdGhpcy5yb290ID0gb3B0aW9ucy5yb290O1xuICAgIHRoaXMucGFyZW50ID0gKG9wdGlvbnMucGFyZW50KSA/IG9wdGlvbnMucGFyZW50IDogbnVsbDtcbiAgICB0aGlzLm9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHRoaXMub3B0aW9ucywgZGVmYXVsdE9wdGlvbnMpO1xuICAgIHRoaXMub3B0aW9ucyA9IE9iamVjdC5hc3NpZ24odGhpcy5vcHRpb25zLCBvcHRpb25zKTtcbiAgICB0aGlzLmxhYmVsID0gKG9wdGlvbnMubGFiZWwpID8gb3B0aW9ucy5sYWJlbCA6IG51bGw7XG4gICAgdGhpcy5pbml0KGVudHJ5KTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICBpbml0KGVudHJ5KSB7XG4gICAgLy9cbiAgICBhZGRfY3VzdG9tX2V2ZW50cyh0aGlzKTtcbiAgICBjb25zdCBkYXRhc2V0ID0ge1xuICAgICAgbmFtZTogdGhpcy5uYW1lLFxuICAgICAgdHlwZTogdGhpcy50eXBlXG4gICAgfVxuICAgIGlmICh0aGlzLmxhYmVsICE9PSBudWxsKSBkYXRhc2V0LmxhYmVsID0gdGhpcy5sYWJlbDtcbiAgICBjb25zdCBlbCA9IGNyZWF0ZV9ib3godGhpcy5vcHRpb25zLnRhZ3Muc3VidGFnLCB7XG4gICAgICBkcmFnZ2FibGU6IHRoaXMub3B0aW9ucy5kcmFnZ2FibGUsXG4gICAgICBkYXRhc2V0OiBkYXRhc2V0LFxuICAgIH0pO1xuICAgIGNvbnN0IGNsID0gKHRoaXMub3B0aW9ucy5jbGFzcykgPyB0aGlzLm9wdGlvbnMuY2xhc3MgOiBbXTtcbiAgICBjbC51bnNoaWZ0KGAke3RoaXMub3B0aW9ucy5wcmVmaXh9JHt0aGlzLnR5cGV9YCk7XG4gICAgdGhpcy5sYWJlbCA9IGNyZWF0ZV9ib3godGhpcy5vcHRpb25zLnRhZ3MubGFiZWwsIHtcbiAgICAgIGNsYXNzOiBjbCxcbiAgICAgIHRleHQ6IChlbnRyeS5sYWJlbCkgPyBlbnRyeS5sYWJlbCA6IGVudHJ5Lm5hbWVcbiAgICB9LCBlbCk7XG4gICAgdGhpcy5jb250YWluZXIgPSBlbDtcbiAgICB0aGlzLmluaXRFdmVudHMoKTtcbiAgfVxuICBpbml0RXZlbnRzKCkge1xuICAgIE9iamVjdC5lbnRyaWVzKHRoaXMub3B0aW9ucy5hY3Rpb25zKS5mb3JFYWNoKChba2V5LCBhY3Rpb25dKSA9PiB7XG4gICAgICB0aGlzLm9uKGFjdGlvbiwgKGUpID0+IHtcbiAgICAgICAgdGhpc1trZXldKGUpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cbiAgZ2V0UGFyZW50KCkge1xuICAgIHJldHVybiB0aGlzLnBhcmVudDtcbiAgfVxuICBnZXRMYWJlbEVsZW1lbnQoKSB7XG4gICAgcmV0dXJuIHRoaXMubGFiZWw7XG4gIH1cbiAgZ2V0UGFyZW50RWxlbWVudCgpIHtcbiAgICByZXR1cm4gdGhpcy5jb250YWluZXIucGFyZW50RWxlbWVudC5jbG9zZXN0KHRoaXMub3B0aW9ucy5zZWxlY3Rvcik7XG4gIH1cblxuICBnZXRFbnRyaWVzKCkge1xuICAgIHJldHVybiB0aGlzLmVudHJpZXMoKTtcbiAgfVxuICBnZXRFbnRyaWVzRWxlbWVudChjcmVhdGUgPSBmYWxzZSkge1xuICAgIGxldCBlbnRyaWVzID0gdGhpcy5jb250YWluZXIucXVlcnlTZWxlY3Rvcih0aGlzLm9wdGlvbnMuc2VsZWN0b3JzLmVudHJpZXMpO1xuICAgIGlmIChjcmVhdGUgJiYgZW50cmllcyA9PT0gbnVsbCkge1xuICAgICAgcmV0dXJuIGNyZWF0ZV9ib3godGhpcy5vcHRpb25zLnRhZ3MudGFnLCB7XG4gICAgICAgIGNsYXNzOiB0aGlzLm9wdGlvbnMuc2VsZWN0b3JzLmVudHJpZXMuc3Vic3RyKDEpXG4gICAgICB9LCB0aGlzLmNvbnRhaW5lcik7XG4gICAgfVxuICAgIHJldHVybiBlbnRyaWVzO1xuICB9XG5cbiAgYXBwZW5kRW50cnkoZW50cnkpIHtcbiAgICBpZiAoZW50cnkucGFyZW50KSB7XG4gICAgICBjb25zb2xlLmxvZygndGhpcycsIGVudHJ5KVxuICAgICAgY29uc3QgbiA9IGVudHJ5LnBhcmVudC5lbnRyaWVzLmluZGV4T2YoZW50cnkpO1xuICAgICAgZGVsZXRlIGVudHJ5LnBhcmVudC5lbnRyaWVzW25dO1xuICAgIH1cbiAgICBlbnRyeS5wYXJlbnQgPSB0aGlzO1xuICAgIHRoaXMuZW50cmllcy5wdXNoKGVudHJ5KTtcbiAgICBjb25zdCBwYXJlbnQgPSB0aGlzLmdldEVudHJpZXNFbGVtZW50KHRydWUpO1xuICAgIHBhcmVudC5hcHBlbmQoZW50cnkuY29udGFpbmVyKTtcbiAgICByZXR1cm4gZW50cnk7XG4gIH1cbiAgY3JlYXRlRW50cnkoZW50cnkpIHtcbiAgICBjb25zdCBuZXdfZW50cnkgPSBuZXcgRW50cnkoZW50cnkpO1xuICAgIHRoaXMuYXBwZW5kRW50cnkobmV3X2VudHJ5KTtcbiAgfVxuICAvL1xuICBjcmVhdGVMaXN0RW50cmllcyhsaXN0ZW50cmllcykge1xuICAgIGNvbnN0IGRpcmVudHJ5ID0gdGhpcy5nZXRFbnRyaWVzRWxlbWVudCh0cnVlKTtcbiAgICBsaXN0ZW50cmllcy5mb3JFYWNoKGVudHJpZXMgPT4ge1xuICAgICAgZW50cmllcy5mb3JFYWNoKChlbnRyeSkgPT4ge1xuICAgICAgICBjb25zdCBuZXdfZW50cnkgPSB0aGlzLmNyZWF0ZUVudHJ5KGVudHJ5KTtcblxuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBpc09uKCkge1xuICAgIHJldHVybiB0aGlzLmFjdGl2ZTtcblxuICB9XG4gIHRvZ2dsZU9uKCkge1xuICAgIHRoaXMuYWN0aXZlID0gISh0aGlzLmFjdGl2ZSk7XG4gICAgdGhpcy5jb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSh0aGlzLm9wdGlvbnMuY3NzLm9uKTtcbiAgfVxuICBzZXRPZmYoKSB7XG4gICAgdGhpcy5hY3RpdmUgPSBmYWxzZTtcbiAgICB0aGlzLmNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKHRoaXMub3B0aW9ucy5jc3Mub24pO1xuICB9XG4gIGVtaXRFdmVudChhY3Rpb24gPSBudWxsLCBldiA9IG51bGwpIHtcbiAgICBjb25zdCBzZWxmID0gdGhpcztcbiAgICBjb25zdCBkZXRhaWwgPSB7XG4gICAgICBlbnRyeTogc2VsZixcbiAgICB9XG4gICAgaWYgKGFjdGlvbikgZGV0YWlsLmFjdGlvbiA9IGFjdGlvbjtcbiAgICBpZiAoZXYpIGRldGFpbC5ldmVudCA9IGV2O1xuICAgIGV2ZW50RW50cnkuaW5pdEN1c3RvbUV2ZW50KCdldmVudEVudHJ5JywgdHJ1ZSwgdHJ1ZSwgZGV0YWlsKTtcbiAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudChldmVudEVudHJ5KTtcbiAgfVxuICBtb3ZlSGFuZGxlcnMoKSB7XG4gICAgcmV0dXJuIFt7XG4gICAgICBuYW1lOiAnZHJhZ292ZXInLFxuICAgICAgZnVuYzogKGUpID0+IHtcbiAgICAgICAgdGhpcy5oYW5kbGVEcmFnT3ZlcihlKTtcbiAgICAgIH1cbiAgICB9LCB7XG4gICAgICBuYW1lOiAnZHJvcCcsXG4gICAgICBmdW5jOiAoZSkgPT4ge1xuICAgICAgICB0aGlzLmhhbmRsZURyb3AoZSk7XG4gICAgICB9XG4gICAgfV07XG4gIH1cbiAgZHJvcEhhbmRsZXJzKCkge1xuICAgIHJldHVybiBbe1xuICAgICAgbmFtZTogJ2RyYWdvdmVyJyxcbiAgICAgIGZ1bmM6IChlKSA9PiB7XG4gICAgICAgIHRoaXMuaGFuZGxlRHJhZ092ZXIoZSk7XG4gICAgICB9XG4gICAgfSwge1xuICAgICAgbmFtZTogJ2Ryb3AnLFxuICAgICAgZnVuYzogKGUpID0+IHtcbiAgICAgICAgdGhpcy5oYW5kbGVEcm9wKGUpO1xuICAgICAgfVxuICAgIH1dO1xuICB9XG4gIGhhbmRsZURyb3AoZSkge1xuXG4gIH1cbiAgYWRkTGlzdGVuZXJzKCkge1xuICAgIGxldCBmdW5jID0gKGUpID0+IHtcbiAgICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG4gICAgICB0aGlzLmRpckNvbnRyb2xzKCgpID0+IHtcbiAgICAgICAgdGhpcy5lbWl0RXZlbnQodGhpcy5ldmVudG5hbWVzLmF0dGFjaCk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIGxldCBsaXN0ZW5lcnMgPSBbXVxuICAgIGlmIChbdGhpcy5vcHRpb25zLnR5cGUucm9vdCwgdGhpcy5vcHRpb25zLnR5cGUudHJhc2hdLmluZGV4T2YodGhpcy50eXBlKSA8IDApIHtcbiAgICAgIGlmICh0aGlzLmlzSW5UcmFzaCgpKSBjb25zb2xlLmxvZygnIGlzaW50cmFzaCAnICsgdGhpcy5uYW1lLCB0aGlzLmlzSW5UcmFzaCgpKVxuICAgICAgbGlzdGVuZXJzID0gdGhpcy5tb3ZlSGFuZGxlcnMoKTtcbiAgICAgIGlmICh0aGlzLnR5cGUgPT09IHRoaXMub3B0aW9ucy50eXBlLmZpbGUpIHtcbiAgICAgICAgZnVuYyA9IChlKSA9PiB7XG4gICAgICAgICAgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICB0aGlzLnRvZ2dsZU9uKCk7XG4gICAgICAgICAgdGhpcy5lbWl0RXZlbnQoKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICh0aGlzLmlzSW5UcmFzaCgpKSB7XG4gICAgICAgIHRoaXMudHlwZSA9IHRoaXMub3B0aW9ucy50eXBlLnRyYXNoZWQ7XG4gICAgICB9IGVsc2UgbGlzdGVuZXJzID0gbGlzdGVuZXJzLmNvbmNhdCh0aGlzLmRyb3BIYW5kbGVycygpKTtcbiAgICAgIHRoaXMubGlzdGVuUmVuYW1lKCk7XG4gICAgfVxuICAgIGxpc3RlbmVycy51bnNoaWZ0KHtcbiAgICAgIG5hbWU6ICdjbGljaycsXG4gICAgICB0YXJnZXQ6ICdsYWJlbCcsXG4gICAgICBmdW5jOiBmdW5jXG4gICAgfSk7XG4gICAgZm9yIChjb25zdCBsaXN0ZW5lciBvZiBsaXN0ZW5lcnMpIHtcbiAgICAgIGNvbnN0IGVsID0gKGxpc3RlbmVyLnRhcmdldCA9PT0gJ2xhYmVsJykgPyB0aGlzLmdldExhYmVsRWxlbWVudCgpIDogdGhpcy5jb250YWluZXI7XG4gICAgICBlbC5hZGRFdmVudExpc3RlbmVyKGxpc3RlbmVyLm5hbWUsIGxpc3RlbmVyLmZ1bmMpO1xuICAgIH1cbiAgfVxuICByZW1vdmVMaXN0ZW5lcnMobGlzdGVuZXJzKSB7XG4gICAgZm9yIChjb25zdCBsaXN0ZW5lciBpbiBsaXN0ZW5lcnMpIHtcbiAgICAgIGNvbnN0IGVsID0gKGxpc3RlbmVyLnRhcmdldCA9PT0gJ2xhYmVsJykgPyB0aGlzLmdldExhYmVsRWxlbWVudCgpIDogdGhpcy5jb250YWluZXI7XG4gICAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKGxpc3RlbmVyLmxhYmVsLCBsaXN0ZW5lci5mdW5jKTtcbiAgICB9XG4gIH1cbiAgZGVzdHJveSgpIHtcbiAgICB0aGlzLmNvbnRhaW5lci5yZW1vdmUoKTtcbiAgfVxuXG4gIGhhbmRsZURyYWdTdGFydChlKSB7XG4gICAgdGhpcy5jb250YWluZXIuY2xhc3NMaXN0LmFkZCh0aGlzLm9wdGlvbnMuY3NzLmRyYWdnaW5nKTtcbiAgICBlLmRhdGFUcmFuc2Zlci5lZmZlY3RBbGxvd2VkID0gJ21vdmUnO1xuICAgIHRoaXMuZW1pdEV2ZW50KCdkcmFnc3RhcnQnKTtcbiAgfVxuICBoYW5kbGVEcmFnT3ZlcihlKSB7XG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgdGhpcy5lbWl0RXZlbnQoJ2RyYWdvdmVyJyk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGhhbmRsZURyYWdFbmQoZSkge1xuICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGlmICh0aGlzLmNvbnRhaW5lci5jbGFzc0xpc3QuY29udGFpbnModGhpcy5vcHRpb25zLmNzcy5kcmFnZ2luZykpIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5vcHRpb25zLmNzcy5kcmFnZ2luZyk7XG4gICAgdGhpcy5lbWl0RXZlbnQoJ2RyYWdlbmQnKTtcbiAgfVxuICByZXNldERyYWdPdmVyKCkge1xuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy4nICsgdGhpcy5vcHRpb25zLmNzcy5kcmFnb3ZlcikuZm9yRWFjaChlbCA9PiB7XG4gICAgICBlbC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMub3B0aW9ucy5jc3MuZHJhZ292ZXIpO1xuICAgIH0pO1xuICB9XG4gIGhhbmRsZURyb3AoZSkge1xuICAgIC8qKiovXG4gICAgdGhpcy5lbWl0RXZlbnQoJ2Ryb3AnLCBlKTtcbiAgfVxuXG4gIHVuTW92ZSgpIHtcbiAgICBpZiAodGhpcy5mcm9tKSB7XG4gICAgICB0aGlzLm1vdmUodGhpcy5mcm9tKTtcbiAgICAgIHRoaXMuZnJvbS5jb250YWluZXIuYXBwZW5kKHRoaXMpO1xuICAgICAgdGhpcy5mcm9tID0gbnVsbDtcbiAgICB9XG4gIH1cbn1cblxuY2xhc3MgRW50cnlBY3Rpb24gZXh0ZW5kcyBFbnRyeSB7XG4gIGV2ZW50bmFtZXMgPSB7XG4gICAgYXR0YWNoOiAnYXR0YWNoJyxcbiAgICBkZXRhY2g6ICdkZXRhY2gnLFxuICAgIGlzdHJhc2hkaXI6ICdpc3RyYXNoZGlyJyxcbiAgICB0cmFzaGVkOiAndHJhc2hlZCcsXG4gIH1cbiAgaXNUcmFzaERpcihuYW1lID0gbnVsbCkge1xuICAgIHJldHVybiAoKG5hbWUgPT09IG51bGwpID8gdGhpcy5uYW1lIDogbmFtZSkuaW5kZXhPZih0aGlzLm9wdGlvbnMudHJhc2hfZGlyX25hbWUpID09PSAwO1xuICB9XG4gIGlzSW5UcmFzaChwYXRoID0gbnVsbCkge1xuICAgIHBhdGggPSAocGF0aCA9PT0gbnVsbCkgPyB0aGlzLmdldEN1cnJlbnREaXJQYXRoKCkgOiBwYXRoO1xuICAgIGlmIChwYXRoID09PSBudWxsKSBzdG9wX29uX2Vycm9yKCdwYXRoX25vdF9mb3VuZCcpO1xuICAgIHBhdGggPSBwYXRoLnNwbGl0KGRpcnNlcGFyYXRvcik7XG4gICAgcmV0dXJuIChwYXRoLmxlbmd0aCA+IDEgJiYgcGF0aFswXS5pbmRleE9mKHRoaXMub3B0aW9ucy50cmFzaF9kaXJfbmFtZSkpID09PSAwO1xuICB9XG5cbiAgc2V0V2FpdCgpIHtcbiAgICB0aGlzLmxvYWRlZCA9IHRoaXMuY29udGFpbmVyLmRhdGFzZXQubG9hZGVkID0gZmFsc2U7XG4gICAgdGhpcy5jb250YWluZXIuY2xhc3NMaXN0LmFkZCgnd2FpdCcpO1xuICB9XG4gIHNldExvYWRlZCgpIHtcbiAgICB0aGlzLmNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCd3YWl0Jyk7XG4gICAgdGhpcy5sb2FkZWQgPSB0aGlzLmNvbnRhaW5lci5kYXRhc2V0LmxvYWRlZCA9IHRydWU7XG4gIH1cblxuICBkaXJDb250cm9scyhjYWxsYmFjayA9IG51bGwpIHtcbiAgICBjb25zdCBlbCA9IHRoaXMuY29udGFpbmVyO1xuICAgIGlmIChlbC5kYXRhc2V0LmFjdGlvbiA9PT0gXCJjcmVhdGVcIikgcmV0dXJuO1xuICAgIHRoaXMudG9nZ2xlT24oKTtcbiAgICBpZiAodGhpcy5pc09uKCkpIHRoaXMuZGlyQWN0aXZhdGUoY2FsbGJhY2spLnRoZW4oKCkgPT4ge1xuICAgICAgdGhpcy5lbWl0RXZlbnQoKTtcbiAgICB9KTtcblxuICB9XG5cbiAgYXN5bmMgZGlyQWN0aXZhdGUoY2FsbGJhY2sgPSBudWxsKSB7XG4gICAgaWYgKCF0aGlzLmxvYWRlZCkgdGhpcy5saXN0KCkudGhlbigoKSA9PiB7XG4gICAgICBpZiAoY2FsbGJhY2spIGNhbGxiYWNrKHRoaXMpO1xuICAgIH0pO1xuICAgIGVsc2UgaWYgKGNhbGxiYWNrKSBjYWxsYmFjayh0aGlzKTtcbiAgfVxuXG4gIGdldEN1cnJlbnREaXJQYXRoKCkge1xuICAgIGNvbnN0IGN1cnJlbnRfcGF0aCA9IChlbnRyeSwgZGlycyA9IFtdKSA9PiB7XG4gICAgICBpZiAoZW50cnkubmFtZSkge1xuICAgICAgICBkaXJzLnB1c2goZW50cnkubmFtZSk7XG4gICAgICAgIGVudHJ5ID0gZW50cnkuZ2V0UGFyZW50KCk7XG4gICAgICAgIGlmIChlbnRyeSAhPT0gbnVsbCkgcmV0dXJuIGN1cnJlbnRfcGF0aChlbnRyeSwgZGlycyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gZGlycztcbiAgICB9XG4gICAgbGV0IGRpcnMgPSBjdXJyZW50X3BhdGgodGhpcyk7XG4gICAgaWYgKGRpcnMubGVuZ3RoID4gMSkgZGlycyA9IGRpcnMucmV2ZXJzZSgpO1xuICAgIHJldHVybiBkaXJzLmpvaW4oZGlyc2VwYXJhdG9yKTtcbiAgfVxuXG4gIGFzeW5jIGZldGNoQWN0aW9uKGFjdGlvbiwgY2FsbGJhY2sgPSBudWxsLCBjYWxsYmFja19lcnJvciA9IG51bGwpIHtcbiAgICBjb25zdCBhcGlfcGFyYW1ldGVycyA9IHRoaXMub3B0aW9ucy5hcGlfcGFyYW1ldGVycztcbiAgICBjb25zdCBsYWJlbCA9IHRoaXMuZ2V0TGFiZWxFbGVtZW50KCk7XG4gICAgbGV0IGVudHJ5cGF0aCA9IHRoaXMuZ2V0Q3VycmVudERpclBhdGgoKTtcbiAgICBpZiAoZW50cnlwYXRoID09PSAnJykgcmV0dXJuO1xuICAgIGNvbnN0IGRhdGEgPSBuZXcgRm9ybURhdGEoKTtcbiAgICBkYXRhLmFwcGVuZChhcGlfcGFyYW1ldGVycy5lbnRyeSwgZW50cnlwYXRoKTtcbiAgICBzd2l0Y2ggKGFjdGlvbikge1xuICAgICAgY2FzZSB0aGlzLm9wdGlvbnMuYWN0aW9ucy5jcmVhdGU6XG4gICAgICAgIGlmIChsYWJlbCA9PT0gbnVsbCkgcmV0dXJuO1xuICAgICAgICBlbnRyeXBhdGggPSBlbnRyeXBhdGggKyBkaXJzZXBhcmF0b3IgKyBsYWJlbC50ZXh0Q29udGVudDtcbiAgICAgICAgaWYgKGVudHJ5cGF0aC50cmltKCkgIT09IFwiXCIpIGRhdGEuYXBwZW5kKGFwaV9wYXJhbWV0ZXJzLmVudHJ5LCBlbnRyeXBhdGgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgdGhpcy5vcHRpb25zLmFjdGlvbnMubW92ZTpcbiAgICAgICAgLy8gZ2V0IG5ldyBwYXRoIC0gYXBwZW5kIGl0ZW0gdG8gZHJvcCBkaXJlY3RvcnlcbiAgICAgICAgaWYgKGNhbGxiYWNrICE9PSBudWxsKSB7XG4gICAgICAgICAgbGV0IGRlc3RwYXRoID0gY2FsbGJhY2soKTtcbiAgICAgICAgICBjYWxsYmFjayA9IG51bGw7XG4gICAgICAgICAgaWYgKGRlc3RwYXRoID09PSBlbnRyeXBhdGgpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdkZXN0ID0gZW50cnknLCBkZXN0cGF0aCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGRhdGEuYXBwZW5kKGFwaV9wYXJhbWV0ZXJzLmRlc3QsIGRlc3RwYXRoKTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhlbnRyeXBhdGggKyAnIGRlc3Rtb3ZlICcsIGRlc3RwYXRoKVxuICAgICAgICB9IGVsc2UgcmV0dXJuO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgdGhpcy5vcHRpb25zLmFjdGlvbnMucmVuYW1lOlxuICAgICAgICBjb25zdCBkZXN0cGF0aCA9IGVudHJ5cGF0aC5zcGxpdChkaXJzZXBhcmF0b3IpO1xuICAgICAgICBkZXN0cGF0aFtkZXN0cGF0aC5sZW5ndGggLSAxXSA9IGxhYmVsLnRleHRDb250ZW50O1xuICAgICAgICBpZiAoZGVzdHBhdGguam9pbihkaXJzZXBhcmF0b3IpID09PSBlbnRyeXBhdGgpIHJldHVybjtcbiAgICAgICAgZGF0YS5hcHBlbmQoYXBpX3BhcmFtZXRlcnMuZGVzdCwgZGVzdHBhdGguam9pbihkaXJzZXBhcmF0b3IpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godGhpcy5vcHRpb25zLnVybCArIHVybHNlcGFyYXRvciArIGFjdGlvbiwgZmV0Y2hTZXR0aW5ncyh7XG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgYm9keTogZGF0YVxuICAgIH0pKTtcbiAgICBjb25zdCBqc29uID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgIGNvbnNvbGUubG9nKCdyZXNwb25zZWpzb24nLCBqc29uKVxuICAgIGlmIChqc29uLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICBpZiAoY2FsbGJhY2spIGNhbGxiYWNrKGpzb24ubWVzc2FnZSk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGNhbGxiYWNrX2Vycm9yKSBjYWxsYmFja19lcnJvcihqc29uKTtcbiAgICAgIGVsc2Ugc3RvcF9vbl9lcnJvcihqc29uKTtcbiAgICB9XG4gIH1cbiAgbGlzdGVuUmVuYW1lKGV2dCA9ICdkYmxjbGljaycpIHtcbiAgICBjb25zdCBlbnRyeSA9IHRoaXM7XG4gICAgY29uc3QgbGFiZWwgPSBlbnRyeS5nZXRMYWJlbEVsZW1lbnQoKTtcbiAgICBsYWJlbC5hZGRFdmVudExpc3RlbmVyKGV2dCwgKGUpID0+IHtcbiAgICAgIGNvbnN0IHNlbmRfcmVuYW1lID0gYXN5bmMgKGUpID0+IHtcbiAgICAgICAgaWYgKGUua2V5ID09PSAnRW50ZXInKSB7XG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIGxhYmVsLmNvbnRlbnRFZGl0YWJsZSA9IGZhbHNlO1xuICAgICAgICAgIGVudHJ5LmNvbnRhaW5lci5kcmFnZ2FibGUgPSAodGhpcy5vcHRpb25zLnNwZWNpYWxkaXJzLmluZGV4T2YoZW50cnkudHlwZSkgPCAwKTtcbiAgICAgICAgICBjb25zdCBjYWxsYmFjayA9ICh0eHQpID0+IHtcbiAgICAgICAgICAgIGxhYmVsLmNsYXNzTGlzdC5yZW1vdmUoZW50cnkub3B0aW9ucy5jc3MuZWRpdGFibGUpO1xuICAgICAgICAgICAgaWYgKHR4dCA9PT0gXCJcIikgd2luZG93LmFsZXJ0Ym94LmFkZEl0ZW1NZXNzYWdlKGxhYmVsLCB7XG4gICAgICAgICAgICAgIHR5cGU6ICdlcnJvcicsXG4gICAgICAgICAgICAgIGNvbnRlbnQ6IHdpbmRvdy5hbGVydGJveC5pMThubWVzc2FnZXMuZXhpc3RzLFxuICAgICAgICAgICAgICBkdXJhdGlvbjogMjAwMFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBlbHNlIHR4dCA9IHR4dC5zcGxpdChkaXJzZXBhcmF0b3IpLnBvcCgpO1xuICAgICAgICAgICAgbGFiZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHNlbmRfcmVuYW1lKTtcbiAgICAgICAgICAgIGxhYmVsLnRleHRDb250ZW50ID0gdHh0O1xuICAgICAgICAgICAgaWYgKGVudHJ5LnR5cGUgPT09IGVudHJ5Lm9wdGlvbnMudHlwZS5kaXJlY3RvcnkpIGVudHJ5LmRpckNvbnRyb2xzKCk7XG4gICAgICAgICAgICBkZWxldGUgZW50cnkuY29udGFpbmVyLmRhdGFzZXQuYWN0aW9uO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCBhY3Rpb24gPSAoZW50cnkuY29udGFpbmVyLmRhdGFzZXQuYWN0aW9uKSA/IGVudHJ5LmNvbnRhaW5lci5kYXRhc2V0LmFjdGlvbiA6IGVudHJ5Lm9wdGlvbnMuYWN0aW9ucy5yZW5hbWU7XG4gICAgICAgICAgY29uc29sZS5sb2coJ2FjdGlvbiBlbnRyeV9yZW5hbWUgJyArIGFjdGlvbiwgZW50cnkuY29udGFpbmVyKVxuICAgICAgICAgIGF3YWl0IGVudHJ5LmZldGNoQWN0aW9uKGFjdGlvbiwgY2FsbGJhY2spO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBsYWJlbC5jb250ZW50RWRpdGFibGUgPSB0cnVlO1xuICAgICAgZW50cnkuY29udGFpbmVyLmRyYWdnYWJsZSA9IGZhbHNlO1xuICAgICAgbGFiZWwuY2xhc3NMaXN0LmFkZChlbnRyeS5vcHRpb25zLmNzcy5lZGl0YWJsZSk7XG4gICAgICBsYWJlbC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgc2VuZF9yZW5hbWUpO1xuICAgIH0pO1xuICB9XG5cbiAgY3JlYXRlRW50cnkoZW50cnkpIHtcbiAgICBjb25zdCBleHQgPSBlbnRyeS5uYW1lLnNwbGl0KCcuJykucG9wKCk7XG4gICAgY29uc3Qgb3B0aW9ucyA9IHRoaXMub3B0aW9ucztcbiAgICBvcHRpb25zLmRyYWdnYWJsZSA9IChvcHRpb25zLnNwZWNpYWxkaXJzLmluZGV4T2YoZW50cnkudHlwZSkgPCAwKTtcbiAgICBvcHRpb25zLmNsYXNzID0gW107XG4gICAgaWYgKHRoaXMuaXNUcmFzaERpcihlbnRyeS5uYW1lKSkgZW50cnkudHlwZSA9IHRoaXMub3B0aW9ucy50eXBlLnRyYXNoO1xuICAgIGNvbnN0IGNsID0gKGVudHJ5LnR5cGUgPT09IG9wdGlvbnMudHlwZS5maWxlKSA/IChmaWx0ZXJfZmlsZXMuaW1hZ2VzLnNwbGl0KCcsJykuaW5kZXhPZihleHQpID49IDApID8gb3B0aW9ucy5pY29ucy5pbWFnZSA6IG9wdGlvbnMuaWNvbnMuZG9jdW1lbnQgOiBudWxsO1xuICAgIGlmIChjbCAhPT0gbnVsbCkgb3B0aW9ucy5jbGFzcy5wdXNoKGNsKTtcbiAgICBjb25zdCBuZXdfZW50cnkgPSBuZXcgRW50cnlBY3Rpb24oZW50cnksIG9wdGlvbnMpO1xuICAgIGlmIChlbnRyeS50eXBlID09PSB0aGlzLm9wdGlvbnMudHlwZS50cmFzaCkgbmV3X2VudHJ5LmVtaXRFdmVudCh0aGlzLmV2ZW50bmFtZXMuaXN0cmFzaGRpcik7XG4gICAgdGhpcy5hcHBlbmRFbnRyeShuZXdfZW50cnkpO1xuICAgIG5ld19lbnRyeS5hZGRMaXN0ZW5lcnMoKTtcbiAgICByZXR1cm4gbmV3X2VudHJ5O1xuICB9XG5cbiAgYXN5bmMgbGlzdCgpIHtcbiAgICBpZiAodGhpcy50eXBlID09PSB0aGlzLm9wdGlvbnMudHlwZS5maWxlKSByZXR1cm47XG4gICAgY29uc3QgdGFnID0gdGhpcy5vcHRpb25zLnRhZ3MudGFnO1xuICAgIGNvbnN0IHN1YnRhZyA9IHRoaXMub3B0aW9ucy50YWdzLnN1YnRhZztcbiAgICBjb25zdCBzdWJkaXIgPSAodGhpcy5uYW1lKSA/IHRoaXMuZ2V0Q3VycmVudERpclBhdGgoKSA6IG51bGw7XG4gICAgdGhpcy5zZXRXYWl0KCk7XG4gICAgY29uc3QgZWwgPSB0aGlzLmdldEVudHJpZXNFbGVtZW50KCk7XG4gICAgaWYgKGVsKSBlbC5yZW1vdmUoKTtcbiAgICBmZXRjaCh0aGlzLm9wdGlvbnMudXJsICsgdXJsc2VwYXJhdG9yICsgdGhpcy5vcHRpb25zLmFjdGlvbnMubGlzdCArICgoc3ViZGlyKSA/IGRpcnNlcGFyYXRvciArIHN1YmRpciA6ICcnKSwgZmV0Y2hTZXR0aW5ncygpKS50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLmpzb24oKSkudGhlbihhc3luYyBqc29uID0+IHtcbiAgICAgIGlmIChqc29uLmVudHJpZXMgJiYganNvbi5lbnRyaWVzLmxlbmd0aCkge1xuICAgICAgICBsZXQgZmlsZXMgPSBbXSxcbiAgICAgICAgICBkaXJlY3RvcmllcyA9IFtdLFxuICAgICAgICAgIGVudHJpZXMgPSBqc29uLmVudHJpZXM7XG4gICAgICAgIHdoaWxlIChlbnRyaWVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBjb25zdCBlbnRyeSA9IGVudHJpZXMuc2hpZnQoKTtcbiAgICAgICAgICBpZiAoZW50cnkudHlwZSA9PT0gdGhpcy5vcHRpb25zLnR5cGUuZmlsZSkgZmlsZXMucHVzaChlbnRyeSk7XG4gICAgICAgICAgZWxzZSBkaXJlY3Rvcmllcy5wdXNoKGVudHJ5KTtcbiAgICAgICAgfTtcbiAgICAgICAgZmlsZXMuc29ydCgoYSwgYikgPT4gKGEubmFtZSA8IGIubmFtZSkpO1xuICAgICAgICBkaXJlY3Rvcmllcy5zb3J0KChhLCBiKSA9PiAoYS5uYW1lIDwgYi5uYW1lKSk7XG4gICAgICAgIHRoaXMuY3JlYXRlTGlzdEVudHJpZXMoW2RpcmVjdG9yaWVzLCBmaWxlc10pO1xuICAgICAgfVxuICAgICAgdGhpcy5zZXRMb2FkZWQoKTtcbiAgICB9KTtcbiAgfVxuICByZW1vdmUoKSB7XG4gICAgaWYgKHRoaXMuaXNUcmFzaERpcigpKSByZXR1cm47XG4gICAgY29uc3QgZnJvbSA9IHRoaXMuZ2V0Q3VycmVudERpclBhdGgoKTtcbiAgICB0aGlzLmZldGNoQWN0aW9uKHRoaXMub3B0aW9ucy5hY3Rpb25zLnJlbW92ZSkudGhlbihyZXQgPT4ge1xuICAgICAgY29uc29sZS5sb2coJ3JlbW92ZSAnLCB0aGlzKVxuICAgICAgdGhpcy5mcm9tID0gZnJvbTtcbiAgICAgIHRoaXMucmVtb3ZlTGlzdGVuZXJzKHRoaXMuZHJvcEhhbmRsZXJzKCkpO1xuICAgICAgdGhpcy5zZXRPZmYoKTtcbiAgICAgIHRoaXMuY29udGFpbmVyLmFuaW1hdGUoe1xuICAgICAgICB0cmFuc2Zvcm06IFwidHJhbnNsYXRlWCgtMTAwJSkgc2NhbGUoMClcIlxuICAgICAgfSwge1xuICAgICAgICBkdXJhdGlvbjogMTAwMFxuICAgICAgfSk7XG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgaWYgKHRoaXMuaXNJblRyYXNoKHRoaXMuZnJvbSkpIHRoaXMuZGVzdHJveSgpO1xuICAgICAgICBlbHNlIHRoaXMuZW1pdEV2ZW50KHRoaXMuZXZlbnRuYW1lcy50cmFzaGVkKTtcbiAgICAgIH0sIDEwMDApO1xuXG4gICAgfSk7XG4gIH1cbiAgY3JlYXRlKCkge1xuICAgIGNvbnN0IG5ld19lbnRyeSA9IHRoaXMuY3JlYXRlRW50cnkoe1xuICAgICAgdHlwZTogJ0QnLFxuICAgICAgbmFtZTogJ05ld0ZvbGRlcidcbiAgICB9KTtcbiAgICBuZXdfZW50cnkuY29udGFpbmVyLmRhdGFzZXQuYWN0aW9uID0gdGhpcy5vcHRpb25zLmFjdGlvbnMuY3JlYXRlO1xuICAgIG5ld19lbnRyeS5sYWJlbC5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgnZGJsY2xpY2snKSk7XG4gIH1cbiAgcmVuYW1lKCkge1xuICAgIGlmICh0aGlzLmlzVHJhc2hEaXIoKSkgcmV0dXJuO1xuICAgIHRoaXMuZmV0Y2hBY3Rpb24odGhpcy5vcHRpb25zLmFjdGlvbnMucmVuYW1lKS50aGVuKCgpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKCdyZW5hbWVkJywgdGhpcylcbiAgICB9KTtcbiAgfVxuXG4gIG1vdmUoZGVzdCkge1xuICAgIGlmICh0aGlzLmlzVHJhc2hEaXIoKSkgcmV0dXJuO1xuICAgIGNvbnN0IGZyb20gPSB0aGlzLmdldEN1cnJlbnREaXJQYXRoKCk7XG5cbiAgICB0aGlzLmZldGNoQWN0aW9uKHRoaXMub3B0aW9ucy5hY3Rpb25zLm1vdmUsICgpID0+IHtcbiAgICAgIHJldHVybiBkZXN0LmdldEN1cnJlbnREaXJQYXRoKCk7XG4gICAgfSkudGhlbigoKSA9PiB7XG4gICAgICB0aGlzLmZyb20gPSBmcm9tO1xuICAgICAgY29uc3QgZW50cmllcyA9IGRlc3QuZ2V0RW50cmllc0VsZW1lbnQodHJ1ZSk7XG4gICAgICBlbnRyaWVzLmFwcGVuZCh0aGlzLmNvbnRhaW5lcik7XG4gICAgfSkuY2F0Y2goZXJyID0+IHt9KTtcbiAgfVxufVxuXG5jbGFzcyBKc0VudHJ5Q29udHJvbHMge1xuICBfZXZlbnRzID0ge307XG4gIGV2ZW50bmFtZXMgPSB7XG4gICAgY29udHJvbDogJ2NvbnRyb2wnLFxuICAgIGVycm9yOiAnZXJyb3InLFxuICB9XG4gIG9wdGlvbnMgPSBkZWZhdWx0T3B0aW9ucy5lbnRyeWNvbnRyb2xzO1xuICBib3g7XG4gIGNvbnRhaW5lcjtcbiAgZW50cnkgPSBudWxsO1xuICBjb25zdHJ1Y3Rvcihjb250YWluZXIgPSBkb2N1bWVudCwgb3B0aW9ucyA9IHt9KSB7XG4gICAgaWYgKCFjb250YWluZXIuanNlbnRyeWNvbnRyb2xzKSB7XG4gICAgICB0aGlzLm9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHRoaXMub3B0aW9ucywgb3B0aW9ucyk7XG4gICAgICB0aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcbiAgICAgIHRoaXMuZW50cnkgPSBudWxsO1xuICAgICAgdGhpcy5pbml0KCk7XG4gICAgICBjb250YWluZXIuanNlbnRyeWNvbnRyb2xzID0gdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIGNvbnRhaW5lci5qc2VudHJ5Y29udHJvbHM7XG4gIH1cbiAgaW5pdCgpIHtcbiAgICBhZGRfY3VzdG9tX2V2ZW50cyh0aGlzKTtcbiAgICB0aGlzLmJveCA9IHRoaXMuY3JlYXRlQ29udHJvbHMoKTtcbiAgICB0aGlzLmluaXRFdmVudHMoKTtcblxuICB9XG4gIGNyZWF0ZUNvbnRyb2xzKCkge1xuICAgIGNvbnN0IGJveCA9IGNyZWF0ZV9ib3goJ2RpdicsIHtcbiAgICAgIGNsYXNzOiBbdGhpcy5vcHRpb25zLmNzcy5lbnRyeWNvbnRyb2xzLCBjc3MuaGlkZV1cbiAgICB9KTtcbiAgICBPYmplY3QudmFsdWVzKHRoaXMub3B0aW9ucy5jb250cm9scykuZmlsdGVyKGNvbnRyb2wgPT4gKGNvbnRyb2wuaWNvbiB8fCBjb250cm9sLnRleHQpKS5mb3JFYWNoKGNvbnRyb2wgPT4ge1xuICAgICAgY29uc3QgY3RybCA9IGNyZWF0ZV9ib3goJ3NwYW4nLCB7fSwgYm94KTtcbiAgICAgIGlmIChjb250cm9sLnR5cGVudHJpZXMpIGN0cmwuZGF0YXNldC50eXBlbnRyaWVzID0gY29udHJvbC50eXBlbnRyaWVzO1xuICAgICAgaWYgKGNvbnRyb2wuaWNvbikge1xuICAgICAgICBjb25zdCBpY29uID0gY3JlYXRlX2JveCgnaScsIHtcbiAgICAgICAgICBjbGFzczogWydpY29uJywgY29udHJvbC5pY29uXVxuICAgICAgICB9LCBjdHJsKTtcbiAgICAgICAgY3RybC5kYXRhc2V0LnRpdGxlID0gY29udHJvbC50ZXh0O1xuICAgICAgfSBlbHNlIGN0cmwudGV4dENvbnRlbnQgPSBjb250cm9sLnRleHQ7XG4gICAgICAvL2FkZCBsaXN0ZW5lclxuICAgICAgY29uc3QgZXZ0ID0gKGNvbnRyb2wudHJpZ2dlcikgPyBjb250cm9sLnRyaWdnZXIgOiAnY2xpY2snO1xuICAgICAgY29uc3QgZnVuYyA9IChlKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLmVudHJ5ID09PSBudWxsKSByZXR1cm47XG4gICAgICAgIGNvbnN0IGRldGFpbCA9IHtcbiAgICAgICAgICBjYWxsYmFjazogKCkgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ2RvbmUnLCBjb250cm9sLmFjdGlvbik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuZW50cnkuZW1pdChjb250cm9sLmFjdGlvbiwgZGV0YWlsKTtcbiAgICAgIH1cbiAgICAgIGN0cmwuYWRkRXZlbnRMaXN0ZW5lcihldnQsIGZ1bmMpO1xuICAgICAgLy9cbiAgICAgIGNvbnRyb2wuY3RybCA9IGN0cmw7XG4gICAgfSk7XG4gICAgcmV0dXJuIGJveDtcbiAgfVxuICBpbml0RXZlbnRzKCkge31cbiAgZGV0YWNoQ29udHJvbHMoKSB7XG4gICAgaWYgKHRoaXMuZW50cnkgPT09IG51bGwpIHJldHVybjtcbiAgICB0aGlzLmVudHJ5LmNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKHRoaXMub3B0aW9ucy5zZWxlY3RvcnMuaGFzY29udHJvbHMuc3Vic3RyKDEpKTtcbiAgICB0aGlzLmJveC5jbGFzc0xpc3QuYWRkKGNzcy5oaWRlKTtcbiAgICB0aGlzLmJveC5kaXNhYmxlZCA9IHRydWU7XG4gICAgdGhpcy5jb250YWluZXIuYXBwZW5kKHRoaXMuYm94KTtcbiAgICB0aGlzLmVudHJ5ID0gbnVsbDtcbiAgfVxuXG4gIGF0dGFjaENvbnRyb2xzKGVudHJ5KSB7XG4gICAgdGhpcy5kZXRhY2hDb250cm9scygpO1xuICAgIHRoaXMuZW50cnkgPSBlbnRyeTtcbiAgICB0aGlzLmVudHJ5LmNvbnRhaW5lci5wcmVwZW5kKHRoaXMuYm94KTtcbiAgICB0aGlzLmVudHJ5LmNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKHRoaXMub3B0aW9ucy5zZWxlY3RvcnMuaGFzY29udHJvbHMuc3Vic3RyKDEpKTtcbiAgICB0aGlzLmFjdGl2YXRlQ29udHJvbHMoKTtcbiAgICB0aGlzLmJveC5jbGFzc0xpc3QucmVtb3ZlKGNzcy5oaWRlKTtcbiAgICBkZWxldGUgdGhpcy5ib3guZGlzYWJsZWQ7XG4gIH1cblxuICBhY3RpdmF0ZUNvbnRyb2xzKCkge1xuICAgIGlmICh0aGlzLmVudHJ5ID09PSBudWxsKSByZXR1cm47XG4gICAgLy8gYWRkIGJ0bnNcbiAgICBjb25zdCBpc2ludHJhc2ggPSB0aGlzLmVudHJ5LmlzSW5UcmFzaCgpO1xuICAgIE9iamVjdC52YWx1ZXModGhpcy5vcHRpb25zLmNvbnRyb2xzKS5maWx0ZXIoY29udHJvbCA9PiAoY29udHJvbC5pY29uIHx8IGNvbnRyb2wudGV4dCkpLmZvckVhY2goY29udHJvbCA9PiB7XG4gICAgICBjb25zdCBjdHJsID0gY29udHJvbC5jdHJsO1xuICAgICAgY29uc3QgdHlwZW50cmllcyA9IChjdHJsLmRhdGFzZXQudHlwZW50cmllcykgPyBjdHJsLmRhdGFzZXQudHlwZW50cmllcy5zcGxpdCgnLCcpIDogW107XG4gICAgICBjb25zdCB0eXBlID0gKGlzaW50cmFzaCkgPyB0aGlzLmVudHJ5Lm9wdGlvbnMudHlwZS50cmFzaGVkIDogdGhpcy5lbnRyeS5jb250YWluZXIuZGF0YXNldC50eXBlO1xuICAgICAgaWYgKHR5cGVudHJpZXMuaW5kZXhPZih0eXBlKSA+PSAwKSB7XG4gICAgICAgIGN0cmwuY2xhc3NMaXN0LnJlbW92ZShjc3MuaGlkZSk7XG4gICAgICB9IGVsc2UgY3RybC5jbGFzc0xpc3QuYWRkKGNzcy5oaWRlKTtcbiAgICB9KTtcbiAgICAvL1xuICB9XG59XG5cbmNsYXNzIEpzRGlyTGlzdCB7XG4gIF9ldmVudHMgPSB7fTtcbiAgZXZlbnRuYW1lcyA9IHtcbiAgICBhdHRhY2g6ICdhdHRhY2gnLFxuICAgIGRldGFjaDogJ2RldGFjaCcsXG4gICAgYWN0aW9uOiAnYWN0aW9uJyxcbiAgICBjb21wbGV0ZTogJ2NvbXBsZXRlJyxcbiAgICBlcnJvcjogJ2Vycm9yJyxcbiAgfVxuICBvcHRpb25zID0gZGVmYXVsdE9wdGlvbnM7XG5cbiAgY29uc3RydWN0b3IocGFyZW50LCBvcHRpb25zID0ge30pIHtcbiAgICBpZiAoIXBhcmVudC5qc2Rpcmxpc3QpIHtcbiAgICAgIHBhcmVudCA9IChwYXJlbnQgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCkgPyBwYXJlbnQgOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHBhcmVudCk7XG4gICAgICBpZiAoIXBhcmVudCkgcmV0dXJuO1xuICAgICAgdGhpcy5vcHRpb25zID0gT2JqZWN0LmFzc2lnbih0aGlzLm9wdGlvbnMsIG9wdGlvbnMpO1xuICAgICAgdGhpcy5vcHRpb25zLmVudHJ5LnVybCA9IHRoaXMub3B0aW9ucy51cmw7XG4gICAgICB0aGlzLmNvbnRhaW5lciA9IGNyZWF0ZV9ib3godGhpcy5vcHRpb25zLmVudHJ5LnRhZ3MudGFnLCB7XG4gICAgICAgIGNsYXNzOiB0aGlzLm9wdGlvbnMuc2VsZWN0b3JzLmRpcmxpc3Quc3Vic3RyKDEpXG4gICAgICB9LCBwYXJlbnQpO1xuICAgICAgdGhpcy5pbml0KCk7XG4gICAgICB0aGlzLmNvbnRhaW5lci5hcHBlbmQodGhpcy5yb290LmNvbnRhaW5lcik7XG4gICAgICBwYXJlbnQuanNkaXJsaXN0ID0gdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIHBhcmVudC5qc2Rpcmxpc3Q7XG4gIH1cblxuICBpbml0KCkge1xuICAgIGFkZF9jdXN0b21fZXZlbnRzKHRoaXMpO1xuICAgIGNvbnN0IHR5cGUgPSB0aGlzLm9wdGlvbnMuZW50cnkudHlwZS5yb290O1xuICAgIGNvbnN0IG9iaiA9IHt9O1xuICAgIHRoaXMuZW50cnljb250cm9scyA9ICh0aGlzLm9wdGlvbnMuY29udHJvbHMpID8gbmV3IEpzRW50cnlDb250cm9scyh0aGlzLmNvbnRhaW5lciwgdGhpcy5vcHRpb25zLmVudHJ5Y29udHJvbHMpIDogbnVsbDtcbiAgICBPYmplY3QuZW50cmllcyh0aGlzLm9wdGlvbnMuZW50cnljb250cm9scy5jb250cm9scykuZm9yRWFjaCgoW2tleSwgY29udHJvbF0pID0+IHtcbiAgICAgIG9ialtrZXldID0gY29udHJvbC5hY3Rpb247XG4gICAgfSk7XG4gICAgdGhpcy5vcHRpb25zLmVudHJ5LmFjdGlvbnMgPSBvYmo7XG4gICAgdGhpcy5pbml0RXZlbnRzKCk7XG4gICAgY29uc3Qgb3B0aW9ucyA9IHRoaXMub3B0aW9ucy5lbnRyeTtcbiAgICBvcHRpb25zLmRyYWdnYWJsZSA9IGZhbHNlO1xuICAgIHRoaXMucm9vdCA9IG5ldyBFbnRyeUFjdGlvbih7XG4gICAgICB0eXBlOiB0eXBlLFxuICAgICAgbmFtZTogJycsXG4gICAgICBsYWJlbDogJy4uJyxcbiAgICAgIHJvb3Q6IHRoaXNcbiAgICB9LCBvcHRpb25zKTtcblxuICAgIHRoaXMucm9vdC5hZGRMaXN0ZW5lcnMoKTtcblxuICB9XG4gIGluaXRFdmVudHMoKSB7XG4gICAgY29uc29sZS5sb2coJyBpbml0IGV2ZW50cyUlJSUlJSUlJSUlJSUlJSUlJSUlJSUlw7kpJywgdGhpcy5lbnRyeWNvbnRyb2xzKVxuICAgIC8vIGV2ZW50cyBjb250cm9scyBvbiBlbnRyaWVzXG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgLy8gYWxlcnRzIG9uIGVycm9yXG4gICAgdGhpcy5vbih0aGlzLmV2ZW50bmFtZXMuZXJyb3IsIChlKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZygnZGlybGlzdCByZWNlaXZlIGVycm9yIG1lc3NhZ2UnLCBlKVxuICAgICAgaWYgKHdpbmRvdy5hbGVydGJveCkge1xuICAgICAgICB3aW5kb3cuYWxlcnRib3gucmVuZGVyQWxlcnQoe1xuICAgICAgICAgIHR5cGU6IHdpbmRvdy5hbGVydGJveC5hbGVydGNvbmZpZy50eXBlcy5lcnJvcixcbiAgICAgICAgICBjb250ZW50OiBlLFxuICAgICAgICAgIGludmVyc2U6IHRydWUsXG4gICAgICAgICAgZGlzbWlzc2libGU6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2V2ZW50RW50cnknLCAoZSkgPT4ge1xuICAgICAgY29uc3QgZXZlbnRuYW1lcyA9IGUuZGV0YWlsLmVudHJ5LmV2ZW50bmFtZXM7XG4gICAgICBzd2l0Y2ggKGUuZGV0YWlsLmFjdGlvbikge1xuICAgICAgICBjYXNlIGV2ZW50bmFtZXMuaXN0cmFzaGRpcjpcbiAgICAgICAgICB0aGlzLnRyYXNoZGlyID0gZS5kZXRhaWwuZW50cnk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgZXZlbnRuYW1lcy50cmFzaGVkOlxuICAgICAgICAgIGNvbnNvbGUubG9nKCcgdHJhc2hlZCBmcm9tLS0tLS0tLS0tJywgZS5kZXRhaWwuZW50cnkuZnJvbSlcbiAgICAgICAgICBpZiAoZS5kZXRhaWwuZW50cnkuaXNJblRyYXNoKGUuZGV0YWlsLmVudHJ5LmZyb20pKSB0aGlzLmRldGFjaENvbnRyb2xzKCk7XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnRyYXNoZGlyLmFwcGVuZEVudHJ5KGUuZGV0YWlsLmVudHJ5LCB0aGlzLnRyYXNoZGlyKTtcbiAgICAgICAgICAgIGUuZGV0YWlsLmVudHJ5LmZyb20gPSBlLmRldGFpbC5lbnRyeS5nZXRDdXJyZW50RGlyUGF0aCgpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJyBuZXcgcGF0aCBhZnRlciB0cmFzaGVkIGZyb20tLS0tLS0tLS0nLCBlLmRldGFpbC5lbnRyeS5mcm9tKTtcbiAgICAgICAgICAgIHRoaXMuYXR0YWNoQ29udHJvbHMoZS5kZXRhaWwuZW50cnkpO1xuICAgICAgICAgICAgZS5kZXRhaWwuZW50cnkuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2JnLWRhbmdlci0xMDAnKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5lbWl0KHRoaXMuZXZlbnRuYW1lcy5kZXRhY2gsIGUuZGV0YWlsKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBldmVudG5hbWVzLmRldGFjaDpcbiAgICAgICAgICB0aGlzLmRldGFjaENvbnRyb2xzKCk7XG4gICAgICAgIGNhc2UgZXZlbnRuYW1lcy5hdHRhY2g6XG4gICAgICAgICAgLy8gbm8gdXBsb2FkIG9uIHRyYXNoIGRpclxuICAgICAgICAgIGNvbnN0IHR5cGUgPSAoZS5kZXRhaWwuZW50cnkuaXNJblRyYXNoKCkpID8gZS5kZXRhaWwuZW50cnkub3B0aW9ucy50eXBlLnRyYXNoZWQgOiBlLmRldGFpbC5lbnRyeS5jb250YWluZXIuZGF0YXNldC50eXBlO1xuICAgICAgICAgIGlmICh0eXBlID09PSBlLmRldGFpbC5lbnRyeS5vcHRpb25zLnR5cGUudHJhc2gpIHJldHVybjtcbiAgICAgICAgICBpZiAoZS5kZXRhaWwuYWN0aW9uID09PSBldmVudG5hbWVzLmF0dGFjaCAmJiB0eXBlID09PSBlLmRldGFpbC5lbnRyeS5vcHRpb25zLnR5cGUudHJhc2hlZCkgcmV0dXJuO1xuICAgICAgICAgIHRoaXMuZW1pdCh0aGlzLmV2ZW50bmFtZXNbZS5kZXRhaWwuYWN0aW9uXSwgZS5kZXRhaWwpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiZHJhZ3N0YXJ0XCI6XG4gICAgICAgICAgdGhpcy5kZXRhY2hDb250cm9scygpO1xuICAgICAgICAgIHRoaXMuZHJhZ2VudHJ5ID0gdGhpcy5hY3RpdmVudHJ5ID0gZS5kZXRhaWwuZW50cnk7XG4gICAgICAgICAgZS5kZXRhaWwuZW50cnkuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoZS5kZXRhaWwuZW50cnkub3B0aW9ucy5jc3MuZHJhZ2dpbmcpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiZHJhZ292ZXJcIjpcbiAgICAgICAgICBpZiAoIXRoaXMuZHJhZ2VudHJ5KSByZXR1cm47XG4gICAgICAgICAgaWYgKHRoaXMub3Zlcml0ZW0gIT09IGUuZGV0YWlsLmVudHJ5LmNvbnRhaW5lcikge1xuICAgICAgICAgICAgaWYgKHRoaXMub3Zlcml0ZW0pIHRoaXMub3Zlcml0ZW0uY2xhc3NMaXN0LnJlbW92ZShlLmRldGFpbC5lbnRyeS5vcHRpb25zLmNzcy5kcmFnb3Zlcik7XG4gICAgICAgICAgICBlLmRldGFpbC5lbnRyeS5jb250YWluZXIuY2xhc3NMaXN0LmFkZChlLmRldGFpbC5lbnRyeS5vcHRpb25zLmNzcy5kcmFnb3Zlcik7XG4gICAgICAgICAgICB0aGlzLm92ZXJpdGVtID0gZS5kZXRhaWwuZW50cnkuY29udGFpbmVyO1xuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImRyYWdlbmRcIjpcbiAgICAgICAgICB0aGlzLmRyYWdlbnRyeSA9IG51bGw7XG4gICAgICAgICAgaWYgKHRoaXMub3Zlcml0ZW0pIHRoaXMub3Zlcml0ZW0uY2xhc3NMaXN0LnJlbW92ZShlLmRldGFpbC5lbnRyeS5vcHRpb25zLmNzcy5kcmFnb3Zlcik7XG4gICAgICAgICAgdGhpcy5vdmVyaXRlbSA9IG51bGw7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJkcm9wXCI6XG4gICAgICAgICAgaWYgKCF0aGlzLmRyYWdlbnRyeSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJyBkcm9wIHVwbG9hZCAnLCBlKVxuICAgICAgICAgICAgdGhpcy5lbWl0KHRoaXMuZXZlbnRuYW1lcy5hY3Rpb24sIGUpO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCcgZHJhZ2VudHJ5IGRyb3AnLCBlKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICBjb25zdCBlbCA9IHRoaXMuZHJhZ2VudHJ5LmNvbnRhaW5lcjtcbiAgICAgICAgICBjb25zdCBkZXN0X2VudHJ5ID0gZS5kZXRhaWwuZW50cnk7XG4gICAgICAgICAgZGVzdF9lbnRyeS5yZXNldERyYWdPdmVyKCk7XG4gICAgICAgICAgaWYgKHRoaXMuZHJhZ2VudHJ5ICE9PSBudWxsKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIm1vdmUgZmlsZSBvciBkaXJcIiwgdGhpcy5kcmFnZW5kZW50cnkpXG4gICAgICAgICAgICBpZiAodGhpcy5kcmFnZW50cnkub3B0aW9ucy5hY3Rpb25zLm1vdmUpIHtcbiAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICB0aGlzLmRyYWdlbnRyeS5tb3ZlKGRlc3RfZW50cnkpO1xuICAgICAgICAgICAgICAgIHBhcmVudC5hcHBlbmQoZWwpO1xuICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIHRoaXMuZHJhZ2VudHJ5LnVuTW92ZSgpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgY29uc29sZS5sb2coJ25vYWN0aW9ub24gZHJvcCcpO1xuICAgICAgICAgIH0gZWxzZSBjb25zb2xlLmxvZygnIHBhcmVudD09PW51bGwgb3IgZHJhZ2l0ZW09PT1udWxsIG9yIGRyYWdpdGVtPT09cGFyZW50JywgdGhpcy5kcmFnZW50cnkpXG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIGlmIChlLmRldGFpbC5lbnRyeS5hY3RpdmUpIHRoaXMuYXR0YWNoQ29udHJvbHMoZS5kZXRhaWwuZW50cnkpO1xuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5hdHRhY2hDb250cm9scyh0aGlzLnJvb3QpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuICBhdHRhY2hDb250cm9scyhlbnRyeSkge1xuXG4gICAgdGhpcy5kZXRhY2hDb250cm9scygpO1xuICAgIGlmICh0aGlzLmVudHJ5Y29udHJvbHMpIHtcbiAgICAgIHRoaXMuZW50cnljb250cm9scy5hdHRhY2hDb250cm9scyhlbnRyeSk7XG4gICAgfSBlbHNlIHRoaXMuZGV0YWNoQ29udHJvbHMoKTtcbiAgICB0aGlzLmFjdGl2ZW50cnkgPSBlbnRyeTtcbiAgfVxuXG4gIGRldGFjaENvbnRyb2xzKCkge1xuICAgIGlmICh0aGlzLmVudHJ5Y29udHJvbHMpIHRoaXMuZW50cnljb250cm9scy5hdHRhY2hDb250cm9scyh0aGlzLnJvb3QpO1xuICAgIHRoaXMuYWN0aXZlbnRyeSA9IHRoaXMucm9vdDtcbiAgfVxufVxuZXhwb3J0IHtcbiAgSnNEaXJMaXN0LFxuICBldmVudEVudHJ5XG59OyJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/modules/files/js-dirlist.js\n")},"./src/modules/js-my-files.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   JsMyFiles: () => (/* binding */ JsMyFiles)\n/* harmony export */ });\n/* harmony import */ var _modules_utils_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../modules/utils.js */ \"./src/modules/utils.js\");\n/* harmony import */ var _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../modules/modules-config.js */ \"./src/modules/modules-config.js\");\n/* harmony import */ var _modules_files_js_dirlist_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../modules/files/js-dirlist.js */ \"./src/modules/files/js-dirlist.js\");\n\n\n\n\nconst objaccept = {\n  \"image/*\": [\".png\", \".jpeg\", \".jpg\"],\n  \"text/tab-separated-values\": [\".tsv\"],\n  \"application/zip\": [\".zip\"],\n  \"application/gzip\": [\".gz\"],\n  \"application/x-bzip\": [\".bz\"],\n  \"application/x-bzip2\": [\".bz2\"]\n}\nconst accept = Object.values(objaccept).reduce((a, b) => a.concat(b));\n_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.mright = 'mr-4';\nconst filter_files = {\n  images: \"png,jpeg,jpg,gif\",\n  tsv: \"txt,tsv,zip, gzip,gz\"\n}\nclass JsMyFiles {\n  done = true;\n  jsDirToZip = null;\n  jsDirList = null;\n  trash_dir_name = 'trash.';\n  counters = {};\n  _events = {};\n  eventnames = {\n    complete: 'complete',\n    error: 'error',\n  }\n  constructor(container, options = {}) {\n    if (!container.jsmyfiles) {\n      container = (container instanceof HTMLElement) ? container : document.querySelector(container);\n      if (!container) return;\n      (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.dom_purify)(container, 'dataset');\n      this.container = container;\n      console.log(\"/gui/files/list\")\n      const defaultOptions = {\n        controls: {\n          scan: {\n            display: {\n              counter: 'counter',\n              size: 'size',\n            }\n          },\n          zip: {\n            btn: {\n              zip: 'makezip',\n              zipped: 'makezipped'\n            },\n            display: {\n              size: 'sizezipped',\n              counter: 'counterzipped',\n            }\n          },\n\n        },\n        upload: {\n          label: 'upload'\n        },\n        btnprefix: 'btn',\n        btnfilelist: null,\n        selectors: {\n          droptarget: '.droptarget',\n          trigger: '.trigger',\n          uploadfile: 'uploadfile',\n        },\n        display: {\n          progression: 'display-progression',\n          dropzone: 'dropzone',\n          boxtitle: 'boxtitle',\n          counters: 'counters',\n          sizes: 'sizes',\n          timers: 'timers'\n        },\n\n        css: {\n          dragover: 'dragover'\n        }\n      };\n      this.options = Object.assign(defaultOptions, options);\n      this.options.browse = (container.dataset.browse) ? container.dataset.browse.split(',') : ['directory', 'file'];\n      this.haspicker = (window.showDirectoryPicker);\n      this.options.browse = (container.dataset.browse) ? container.dataset.browse.split(',') : ['directory', 'file'];\n      this.init();\n      container.jsmyfiles = this;\n    }\n    return container.jsmyfiles;\n  }\n  init() {\n    // create dirlist box\n    (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.add_custom_events)(this);\n    this.addDisplayProgression();\n\n    this.addDirList();\n    this.addDropzone();\n    this.initControls();\n    this.initEvents().then(() => {\n      this.resetCounters();\n    });\n  }\n  initTimer() {\n    this.timer = new Date();\n  }\n  async initEvents() {\n    (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.add_custom_events)(this);\n    console.log(' init events%%%%%%%%%%%%%%%%%%%%%%%ù)')\n    //To be refactored - for steppers )\n    this.on(this.eventnames.processed, async (e) => {\n      if (this.nextaction) await this.nextaction();\n    });\n    // alerts on error\n    this.on(this.eventnames.error, (e) => {\n      console.log('scandir receive error message', e)\n      if (window.alertbox) {\n        window.alertbox.renderAlert({\n          type: window.alertbox.alertconfig.types.error,\n          content: e,\n          inverse: true,\n          dismissible: true\n        });\n      }\n    });\n    const self = this;\n    if (this.options.controls.zip) {\n      const {\n        JsDirToZip\n      } = await Promise.all(/*! import() */[__webpack_require__.e(\"vendors-node_modules_fflate_esm_browser_js\"), __webpack_require__.e(\"src_modules_files_js-dirtozip_js\")]).then(__webpack_require__.bind(__webpack_require__, /*! ../modules/files/js-dirtozip.js */ \"./src/modules/files/js-dirtozip.js\"));\n      this.jsDirToZip = new JsDirToZip();\n      Object.keys(this.jsDirToZip.eventnames).forEach((key) => {\n        this.eventnames[key] = this.jsDirToZip.eventnames[key];\n        this.jsDirToZip.on(key, (e) => {\n          switch (key) {\n            case 'counter':\n              self.fileCounter(e);\n              break;\n            case 'complete':\n              if (!e || !e.name) {\n                console.log('no emit complete name');\n                return;\n              }\n              self.showControl(e.name, e);\n            case 'message':\n              switch (e.name) {\n                case 'console':\n                  this.addConsoleMessage({\n                    id: (e.id) ? e.id : null,\n                    content: e.message,\n                    parent: this.container\n                  });\n                  break;\n                case window.alertbox.alertconfig.types.error:\n                case window.alertbox.alertconfig.types.success:\n                case window.alertbox.alertconfig.types.danger:\n                case window.alertbox.alertconfig.types.info:\n                  window.alertbox.renderAlert({\n                    type: e.name,\n                    content: e.message,\n                    dismissible: true,\n                    inverse: false\n                  });\n                  console.log('error', e);\n                  break;\n                default:\n                  console.log('message', e);\n                  break;\n              }\n              break;\n            case 'terminate':\n              console.log('terminate', e)\n            default:\n              self.showControl(key, e);\n              break;\n          }\n        });\n      });\n\n    }\n    window.addEventListener('beforeunload', (e) => {\n      if (!this.done) {\n        e.preventDefault();\n        e.returnValue = (this.options.preventclose) ? this.options.preventclose : `Some work is in progress in this window.\\nAre you sure you want to leave?`;\n      }\n    });\n  }\n  emitToZip(btn) {\n    const message = (btn.dataset.message) ? JSON.parse(btn.dataset.message) : null;\n    if (!message) btn.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n    if (message) {\n      if (message.name) {\n        const name = message.name;\n        delete message.name;\n        console.log('emit ----' + name, message)\n        this.jsDirToZip.emit(name, message);\n      }\n    }\n    if (name === this.eventnames.sendfile) btn.disabled = true;\n  }\n\n  quotaEstimate(obj) {\n    return this.jsDirToZip.quotaEstimate();\n  }\n  scanBrowse(e, options) {\n    return this.jsDirToZip.scanBrowse(e, options);\n\n  }\n  scanHandle(dir, options) {\n    return this.jsDirToZip.scanHandle(dir, options);\n  }\n  async handleBrowse(e) {\n    this.initTimer();\n    this.toggleCounters(true);\n    if (!this.haspicker) e = e.target.files;\n    await this.scanBrowse(e, {\n      accept: accept,\n    });\n  }\n\n  addDropzone() { //\n    this.dropzone = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)('div', {\n      id: this.options.display.dropzone\n    });\n\n    const input = (this.haspicker) ? null : (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)('input', {\n      type: \"file\",\n      name: this.options.selectors.uploadfile,\n      id: this.options.selectors.uploadfile,\n      multiple: true,\n      allowdirs: true,\n      accept: accept,\n      class: 'hidden'\n    }, this.dropzone);\n    if (input) input.addEventListener(\"change\", (e) => {\n      this.handleBrowse(e)\n    });\n    const btns = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)('div', {},\n      this.dropzone);\n\n    this.options.browse.forEach(opt => {\n      const text = (this.container.dataset[`textbrowse${opt}`]) ? this.container.dataset[`textbrowse${opt}`] : `browse${opt}`;\n      const btn = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)('span', {\n        class: this.options.selectors.trigger.slice(1),\n        dataset: {\n          type: opt\n        },\n        text: text\n      }, btns);\n      btn.addEventListener('click', async (e) => {\n        if (this.haspicker) {\n          this.openDirDialog(opt, (e) => {\n            this.handleBrowse(e)\n          });\n        } else {\n          if (opt === \"directory\") {\n            input.directory = true;\n            input.webkitdirectory = true;\n          } else { //file\n            input.directory = false;\n            input.webkitdirectory = false;\n          }\n          input.dispatchEvent(new MouseEvent(\"click\"));\n\n        }\n\n      });\n    });\n    const spandrop = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)('span', {\n      text: this.container.dataset.textdrop\n    }, btns);\n\n  }\n\n  toggleDropTarget(on = true) {\n    const self = this;\n    const droptarget = (this.activentry) ? this.activentry.container : null;\n\n    if (droptarget === null) return;\n    const cssdragover = (this.jsDirList) ? this.jsDirList.options.entry.css.dragover : this.options.css.dragover;\n    const target_dragover = (e) => {\n      if (!this.dragover && this.activentry && this.activentry.container === e.currentTarget) {\n        droptarget.classList.add(cssdragover);\n      }\n      //self.handleDragOver(e);\n    }\n    const target_drop = async (e) => {\n      droptarget.classList.remove(cssdragover);\n      self.handleDrop(e);\n    }\n\n    // set events and css for new dropzone\n    if (on === false) {\n      droptarget.removeEventListener('dragover', target_dragover);\n      droptarget.removeEventListener('drop', target_drop);\n      droptarget.classList.remove(this.options.selectors.droptarget.substr(1));\n    } else {\n      droptarget.addEventListener('dragover', target_dragover);\n      droptarget.addEventListener('drop', target_drop);\n      droptarget.classList.add(this.options.selectors.droptarget.substr(1));\n    }\n  }\n\n  async addDirList() {\n    console.log('dirlist add addDILRLLLL', this.container)\n    this.jsDirList = new _modules_files_js_dirlist_js__WEBPACK_IMPORTED_MODULE_2__.JsDirList(this.container);\n    this.activentry = this.jsDirList.root;\n    this.rootitem = this.targetitem = this.activentry.container;\n    this.jsDirList.on(this.jsDirList.eventnames.attach, (e) => {\n      if (!e.entry) return;\n      this.detachDropzone();\n      this.activentry = e.entry;\n      this.targetitem = this.activentry.container;\n      this.addUploadDialog();\n    });\n    this.jsDirList.on(this.jsDirList.eventnames.detach, (e) => {\n      console.log('myfiles dirlist event', e)\n      this.enableDropzone();\n      this.detachDropzone();\n      this.activentry = null;\n      this.targetitem = null;\n    });\n    this.jsDirList.on(this.jsDirList.eventnames.action, (e) => {\n      console.log('action not managed', e)\n      switch (e.action) {\n        case 'drop':\n          e.target = e.entry.container;\n          this.handleDrop(e.event);\n          break;\n      }\n    });\n    this.activentry.label.dispatchEvent(new Event('click'));\n  }\n\n  addDisplayProgression() {\n    // add counters\n    if (this.displayprogression) return;\n    let el = document.getElementById(this.options.display.progression);\n    if (!el) {\n      el = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)('div', {\n        id: this.options.display.progression\n      }, this.container);\n      el.innerHTML = `<div class=\"flex sm:flex-row\"><div class=\"${this.options.display.counters}\"></div><div class=\"${this.options.display.sizes}\"></div><div class=\"${_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.progress}\"></div><div class=\"${this.options.display.timers}\"></div></div>`;\n      this.displayprogression = el;\n    }\n  }\n  enableDropzone(enable = true, destroy = false) {\n    if (destroy) this.dropzone.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n    if (enable) this.dropzone.dataset.enabled = true;\n    else delete this.dropzone.dataset.enabled;\n  }\n  //\n  attachDropzone() {\n    if (this.dropzone.dataset.enabled) {\n      this.targetitem.insertBefore(this.dropzone, this.activentry.label.nextSibling);\n      this.toggleDropTarget(true);\n    }\n  }\n  detachDropzone() {\n    if (this.dropzone.dataset.enabled) {\n      this.targetitem = null;\n      if (this.rootitem !== this.targetitem) {\n        this.rootitem.append(this.dropzone);\n\n      } else {\n        this.container.append(this.dropzone);\n        this.toggleDropTarget(false);\n      }\n    }\n\n  }\n\n  openDirDialog(type, callback) {\n    // if chrome 86 , edge 86, opera 72\n    const showpick = (type === \"directory\") ? window.showDirectoryPicker : window.showOpenFilePicker;\n    const pickopts = (type === \"directory\") ? {\n      mode: \"read\",\n      multiple: true\n    } : {\n      types: [{\n        description: \"Images,.tsv, zip, gzip, tar files\",\n        accept: objaccept,\n      }, ],\n      excludeAcceptAllOption: true,\n      multiple: true,\n    };\n    showpick(pickopts).then(pick => {\n      callback(pick);\n    });\n  }\n\n  //  drag&drop\n  async handleDrop(e) {\n    let dataTransfer;\n    if (e.dataTransfer) {\n      e.preventDefault();\n      dataTransfer = e.dataTransfer;\n    } else dataTransfer = e;\n    this.done = false;\n    this.initTimer();\n    const items = [...((dataTransfer.items) ? dataTransfer.items : dataTransfer.files)];\n    if (items.length) {\n      this.enableDropzone(false);\n      await items.forEach(async item => {\n        if (item.kind === \"file\") {\n          item = await item.webkitGetAsEntry();\n          this.toggleCounters(true);\n          await this.scanHandle(item);\n        }\n      })\n    }\n  }\n  handleDragOver(e) {\n    e.preventDefault();\n    e.dataTransfer.dropEffect = \"move\";\n  }\n  showComplete() {\n    this.timer = (new Date() - this.timer) / 1000;\n    console.log('item-------------------------------------' + parseInt(this.timer / 60) + ' --- ' + (\n      this.timer - (parseInt(this.timer / 60) * 60)));\n    this.enableDropzone();\n  }\n\n  stopOnError(err) {\n    console.log('err', err);\n  }\n\n  enableDropzone(enable = true, destroy = false) {\n    console.log('thisdropzone', this.dropzone)\n    if (destroy) this.dropzone.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n    if (enable) this.dropzone.dataset.enabled = true;\n    else delete this.dropzone.dataset.enabled;\n  }\n\n  addConsoleMessage(message) {\n    //message {message:, parent:}\n    message.parent = (message.parent) ? message.parent : this.container;\n    window.alertbox.addConsoleMessage(message);\n  }\n\n  addUploadDialog() {\n    if (this.options.controls.scan) {\n      this.enableDropzone(true);\n      this.attachDropzone();\n    }\n  }\n\n  async addFilesStore(name, callback) {\n    name = (name) ? name : this.options.dbname;\n    if (!this.jsFilesStore) {\n      const {\n        JsFilesStore\n      } = await __webpack_require__.e(/*! import() */ \"src_modules_files_js-filesystem_js\").then(__webpack_require__.bind(__webpack_require__, /*! ../modules/files/js-filesystem.js */ \"./src/modules/files/js-filesystem.js\"));\n      this.jsFilesStore = new JsFilesStore(null, callback);\n      this.displayFiles();\n    }\n    if (callback) await callback();\n  }\n  displayFiles() {\n    this.jsFilesStore.getItems('local');\n  }\n\n  fileCounter(e) {\n    const counters = this.counters[e.name];\n    counters.counter += 1\n    if (e.size !== null) counters.size += parseInt(e.size);\n    counters.display.counter.textContent = counters.counter;\n    if (counters.display.size) counters.display.size.textContent = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.format_bytes)(counters.size);\n    this.quotaEstimate();\n  }\n\n  resetCounter(item) {\n    const counters = this.counters[item];\n    ['counter', 'size'].forEach(el => {\n      this.counters[item][el] = 0;\n      counters.display[el].textContent = 0;\n    });\n    this.toggleCounters(false);\n  }\n  resetCounters() {\n    Object.keys(this.options.controls).forEach(key => {\n      this.resetCounter(key);\n    })\n  }\n  toggleCounters(show = true) {\n    const el = document.getElementById(this.options.display.progression);\n    if (!el) return;\n    if (show) el.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n    else el.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n  }\n\n  initFileCounter(item, opts, i) {\n    const sep = (i) ? ` / ` : ``;\n    let counter = 0;\n    let counterdisplay = null;\n    let size = 0;\n    let sizedisplay = null;\n    // create dom display elements\n\n\n    let boxcounters = document.getElementById(this.options.display.progression);\n    const itemopts = {\n      display: {},\n\n    };\n    Object.entries(opts).forEach(([k, val]) => {\n      const cl = k + 's';\n      const txt = {\n        counter: ' read',\n        size: ' read',\n        counterzipped: ' compressed',\n        sizezipped: ' compressed'\n      }\n      let elinsert = boxcounters.querySelector('.' + cl);\n      if (!elinsert) elinsert = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)('div', {\n        class: cl\n      }, boxcounters, ``);\n      let el = elinsert.querySelector('.' + val);\n      if (!el) {\n        el = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)('span', {\n          class: val,\n        }, elinsert, ` / `);\n        if (txt.hasOwnProperty(val)) elinsert.append(document.createTextNode(txt[val]));\n      } else this.resetCounter(item);\n      itemopts.display[k] = el;\n      itemopts[k] = 0;\n    });\n\n    this.counters = { ...this.counters,\n      ...{\n        [item]: itemopts\n      }\n    };\n  }\n\n  showControl(action, opts) {\n    console.log('opts', opts)\n    const target = ((opts.hasOwnProperty('bigfile') && opts.bigfile) ? 'zipped' : 'zip');\n    let message, text = null;\n    // 'zip' ---only btn for zip actions for the moment\n    const btn = this[this.options.btnprefix + 'zip' + target];\n    if (!btn) return;\n    btn.removeAttribute(\"disabled\");\n    const part = (opts && opts.part) ? opts.part : false;\n    const bigfile = (opts && opts.bigfile) ? opts.bigfile : false;\n    const filepath = (opts && opts.path) ? opts.path : this.activentry.getCurrentDirPath();\n    console.log('filepath', filepath)\n    switch (action) {\n      case this.eventnames.ready:\n        this.resetCounters();\n        this.activentry.list();\n        if (btn.dataset.message) delete btn.dataset.message;\n        btn.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n        break;\n      case this.eventnames.follow:\n        if (btn.dataset.message) delete btn.dataset.message;\n        btn.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n        break;\n      case this.eventnames.endzip:\n        if (!part) this.showComplete();\n        btn.textContent = `Close zip file` + ((part) ? part : ``);\n        btn.title = (part) ? `Your file is too big - you have to send this part before continuing to process the directory` : `Click to end zip file`;\n        message = {\n          name: this.eventnames.endzip,\n          part: part,\n          path: filepath,\n          bigfile: (target !== 'zip') ? bigfile : false,\n        };\n        btn.dataset.message = JSON.stringify(message);\n        break;\n      case this.eventnames.bigfile:\n        btn.textContent = `Upload big File separately`;\n        message = {\n          name: this.eventnames.bigfile,\n          path: filepath,\n          part: part,\n          bigfile: bigfile\n        };\n        btn.dataset.message = JSON.stringify(message);\n        console.log('bigfile', message)\n        break;\n      case this.eventnames.sendfile:\n        console.log('opts sendfile', opts)\n        message = {\n          name: this.eventnames.sendfile,\n          path: filepath,\n          part: part,\n          bigfile: bigfile\n        };\n        btn.textContent = `Upload zip file`;\n        console.log('message -sendfile- Upload zip file', message)\n        if (message.bigfile && message.bigfile !== '') btn.textContent += ` ` + opts;\n        btn.dataset.message = JSON.stringify(message);\n        console.log('messageup', message)\n        break;\n      case this.eventnames.pending:\n        btn.textContent = ` Pending ` + ((target !== 'zip') ? ' big file' : '');\n        btn.dataset.message = '';\n        btn.setAttribute(\"disabled\", true);\n        break;\n      case this.eventnames.gzip:\n        text = `compressing separately big file :${(opts && opts.bigfile)?opts.bigfile:``} ${(opts && opts.size)?opts.size:``}`;\n        btn.textContent = text;\n        btn.setAttribute(\"disabled\", true);\n        console.log('optsbigfl', opts)\n        btn.dataset.message = JSON.stringify({\n          name: this.eventnames.endzip,\n          path: filepath,\n          part: part,\n          bigfile: bigfile\n        });\n        break;\n      case this.eventnames.terminate:\n        console.log('terminate ' + ((target !== 'zip') ? 'bigfile' : ''));\n\n        //default:\n        btn.dataset.message = JSON.stringify({\n          name: 'ready',\n          bigfile: (target !== 'zip')\n        });\n        btn.click();\n        break;\n    }\n    if (btn.dataset.message) btn.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n  }\n\n  getBtn(item, target) {\n    const btnkey = this.options.btnprefix + item + target;\n    if (this[btnkey]) return this[btnkey];\n    const display = this.options.controls[item].btn[target];\n    const btn = document.getElementById(display);\n    const parent = this.displayprogression;\n    if (!btn) {\n      parent.insertAdjacentHTML('beforeend', `<button id=\"${display}\" class=\"button ${display} ${_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.mright} ${_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide}\"></button>`);\n      this[btnkey] = document.getElementById(display);\n      this[btnkey].addEventListener('click', async (e) => {\n        e.stopImmediatePropagation();\n        this.emitToZip(e.currentTarget);\n      });\n    } else parent.append(btn);\n    return this[btnkey];\n  }\n\n  initControls() {\n    Object.entries(this.options.controls).forEach(([key, control], i) => {\n      this.initFileCounter(key, control.display, i);\n      if (control.btn) this.activateControls(key, control.btn);\n    });\n  }\n  activateControls(key, btns) {\n    Object.keys(btns).forEach((btn) => {\n      this[this.options.btnprefix + key + btn] = this.getBtn(key, btn);\n    })\n\n  }\n\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFDQTtBQUNBO0FBQ0E7QUFDQSxtREFBbUQsd0NBQXdDLEVBQUUsaUNBQWlDO0FBQzlIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLGtEQUFrRCwyREFBRztBQUNyRDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDREQUE0RCxRQUFRLGtCQUFrQixTQUFTLEVBQUUsMkRBQUcsU0FBUyxFQUFFLDJEQUFHLE1BQU07QUFDeEg7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1AsTUFBTTtBQUNOO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMOztBQUVBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vc3JjL21vZHVsZXMvanMtbXktZmlsZXMuanM/MTNiOSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBicm93c2VyX2FjY2VwdCxcbiAgZG9tX3B1cmlmeSxcbiAgZmV0Y2hTZXR0aW5ncyxcbiAgYWRkX2N1c3RvbV9ldmVudHMsXG4gIGNyZWF0ZV9ib3gsXG4gIGZvcm1hdF9ieXRlcyxcbiAgZGlyc2VwYXJhdG9yXG59IGZyb20gJy4uL21vZHVsZXMvdXRpbHMuanMnO1xuaW1wb3J0IHtcbiAgY3NzLFxufSBmcm9tICcuLi9tb2R1bGVzL21vZHVsZXMtY29uZmlnLmpzJztcbmltcG9ydCB7XG4gIGdlbmVyYXRlX3V1aWQsXG59IGZyb20gJy4uL21vZHVsZXMvdXRpbHMuanMnO1xuaW1wb3J0IHtcbiAgSnNEaXJMaXN0LFxuICBkZWZhdWx0T3B0aW9uc1xufSBmcm9tICcuLi9tb2R1bGVzL2ZpbGVzL2pzLWRpcmxpc3QuanMnO1xuY29uc3Qgb2JqYWNjZXB0ID0ge1xuICBcImltYWdlLypcIjogW1wiLnBuZ1wiLCBcIi5qcGVnXCIsIFwiLmpwZ1wiXSxcbiAgXCJ0ZXh0L3RhYi1zZXBhcmF0ZWQtdmFsdWVzXCI6IFtcIi50c3ZcIl0sXG4gIFwiYXBwbGljYXRpb24vemlwXCI6IFtcIi56aXBcIl0sXG4gIFwiYXBwbGljYXRpb24vZ3ppcFwiOiBbXCIuZ3pcIl0sXG4gIFwiYXBwbGljYXRpb24veC1iemlwXCI6IFtcIi5ielwiXSxcbiAgXCJhcHBsaWNhdGlvbi94LWJ6aXAyXCI6IFtcIi5iejJcIl1cbn1cbmNvbnN0IGFjY2VwdCA9IE9iamVjdC52YWx1ZXMob2JqYWNjZXB0KS5yZWR1Y2UoKGEsIGIpID0+IGEuY29uY2F0KGIpKTtcbmNzcy5tcmlnaHQgPSAnbXItNCc7XG5jb25zdCBmaWx0ZXJfZmlsZXMgPSB7XG4gIGltYWdlczogXCJwbmcsanBlZyxqcGcsZ2lmXCIsXG4gIHRzdjogXCJ0eHQsdHN2LHppcCwgZ3ppcCxnelwiXG59XG5leHBvcnQgY2xhc3MgSnNNeUZpbGVzIHtcbiAgZG9uZSA9IHRydWU7XG4gIGpzRGlyVG9aaXAgPSBudWxsO1xuICBqc0Rpckxpc3QgPSBudWxsO1xuICB0cmFzaF9kaXJfbmFtZSA9ICd0cmFzaC4nO1xuICBjb3VudGVycyA9IHt9O1xuICBfZXZlbnRzID0ge307XG4gIGV2ZW50bmFtZXMgPSB7XG4gICAgY29tcGxldGU6ICdjb21wbGV0ZScsXG4gICAgZXJyb3I6ICdlcnJvcicsXG4gIH1cbiAgY29uc3RydWN0b3IoY29udGFpbmVyLCBvcHRpb25zID0ge30pIHtcbiAgICBpZiAoIWNvbnRhaW5lci5qc215ZmlsZXMpIHtcbiAgICAgIGNvbnRhaW5lciA9IChjb250YWluZXIgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCkgPyBjb250YWluZXIgOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lcik7XG4gICAgICBpZiAoIWNvbnRhaW5lcikgcmV0dXJuO1xuICAgICAgZG9tX3B1cmlmeShjb250YWluZXIsICdkYXRhc2V0Jyk7XG4gICAgICB0aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcbiAgICAgIGNvbnNvbGUubG9nKFwiL2d1aS9maWxlcy9saXN0XCIpXG4gICAgICBjb25zdCBkZWZhdWx0T3B0aW9ucyA9IHtcbiAgICAgICAgY29udHJvbHM6IHtcbiAgICAgICAgICBzY2FuOiB7XG4gICAgICAgICAgICBkaXNwbGF5OiB7XG4gICAgICAgICAgICAgIGNvdW50ZXI6ICdjb3VudGVyJyxcbiAgICAgICAgICAgICAgc2l6ZTogJ3NpemUnLFxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgemlwOiB7XG4gICAgICAgICAgICBidG46IHtcbiAgICAgICAgICAgICAgemlwOiAnbWFrZXppcCcsXG4gICAgICAgICAgICAgIHppcHBlZDogJ21ha2V6aXBwZWQnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGlzcGxheToge1xuICAgICAgICAgICAgICBzaXplOiAnc2l6ZXppcHBlZCcsXG4gICAgICAgICAgICAgIGNvdW50ZXI6ICdjb3VudGVyemlwcGVkJyxcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuXG4gICAgICAgIH0sXG4gICAgICAgIHVwbG9hZDoge1xuICAgICAgICAgIGxhYmVsOiAndXBsb2FkJ1xuICAgICAgICB9LFxuICAgICAgICBidG5wcmVmaXg6ICdidG4nLFxuICAgICAgICBidG5maWxlbGlzdDogbnVsbCxcbiAgICAgICAgc2VsZWN0b3JzOiB7XG4gICAgICAgICAgZHJvcHRhcmdldDogJy5kcm9wdGFyZ2V0JyxcbiAgICAgICAgICB0cmlnZ2VyOiAnLnRyaWdnZXInLFxuICAgICAgICAgIHVwbG9hZGZpbGU6ICd1cGxvYWRmaWxlJyxcbiAgICAgICAgfSxcbiAgICAgICAgZGlzcGxheToge1xuICAgICAgICAgIHByb2dyZXNzaW9uOiAnZGlzcGxheS1wcm9ncmVzc2lvbicsXG4gICAgICAgICAgZHJvcHpvbmU6ICdkcm9wem9uZScsXG4gICAgICAgICAgYm94dGl0bGU6ICdib3h0aXRsZScsXG4gICAgICAgICAgY291bnRlcnM6ICdjb3VudGVycycsXG4gICAgICAgICAgc2l6ZXM6ICdzaXplcycsXG4gICAgICAgICAgdGltZXJzOiAndGltZXJzJ1xuICAgICAgICB9LFxuXG4gICAgICAgIGNzczoge1xuICAgICAgICAgIGRyYWdvdmVyOiAnZHJhZ292ZXInXG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICB0aGlzLm9wdGlvbnMgPSBPYmplY3QuYXNzaWduKGRlZmF1bHRPcHRpb25zLCBvcHRpb25zKTtcbiAgICAgIHRoaXMub3B0aW9ucy5icm93c2UgPSAoY29udGFpbmVyLmRhdGFzZXQuYnJvd3NlKSA/IGNvbnRhaW5lci5kYXRhc2V0LmJyb3dzZS5zcGxpdCgnLCcpIDogWydkaXJlY3RvcnknLCAnZmlsZSddO1xuICAgICAgdGhpcy5oYXNwaWNrZXIgPSAod2luZG93LnNob3dEaXJlY3RvcnlQaWNrZXIpO1xuICAgICAgdGhpcy5vcHRpb25zLmJyb3dzZSA9IChjb250YWluZXIuZGF0YXNldC5icm93c2UpID8gY29udGFpbmVyLmRhdGFzZXQuYnJvd3NlLnNwbGl0KCcsJykgOiBbJ2RpcmVjdG9yeScsICdmaWxlJ107XG4gICAgICB0aGlzLmluaXQoKTtcbiAgICAgIGNvbnRhaW5lci5qc215ZmlsZXMgPSB0aGlzO1xuICAgIH1cbiAgICByZXR1cm4gY29udGFpbmVyLmpzbXlmaWxlcztcbiAgfVxuICBpbml0KCkge1xuICAgIC8vIGNyZWF0ZSBkaXJsaXN0IGJveFxuICAgIGFkZF9jdXN0b21fZXZlbnRzKHRoaXMpO1xuICAgIHRoaXMuYWRkRGlzcGxheVByb2dyZXNzaW9uKCk7XG5cbiAgICB0aGlzLmFkZERpckxpc3QoKTtcbiAgICB0aGlzLmFkZERyb3B6b25lKCk7XG4gICAgdGhpcy5pbml0Q29udHJvbHMoKTtcbiAgICB0aGlzLmluaXRFdmVudHMoKS50aGVuKCgpID0+IHtcbiAgICAgIHRoaXMucmVzZXRDb3VudGVycygpO1xuICAgIH0pO1xuICB9XG4gIGluaXRUaW1lcigpIHtcbiAgICB0aGlzLnRpbWVyID0gbmV3IERhdGUoKTtcbiAgfVxuICBhc3luYyBpbml0RXZlbnRzKCkge1xuICAgIGFkZF9jdXN0b21fZXZlbnRzKHRoaXMpO1xuICAgIGNvbnNvbGUubG9nKCcgaW5pdCBldmVudHMlJSUlJSUlJSUlJSUlJSUlJSUlJSUlJcO5KScpXG4gICAgLy9UbyBiZSByZWZhY3RvcmVkIC0gZm9yIHN0ZXBwZXJzIClcbiAgICB0aGlzLm9uKHRoaXMuZXZlbnRuYW1lcy5wcm9jZXNzZWQsIGFzeW5jIChlKSA9PiB7XG4gICAgICBpZiAodGhpcy5uZXh0YWN0aW9uKSBhd2FpdCB0aGlzLm5leHRhY3Rpb24oKTtcbiAgICB9KTtcbiAgICAvLyBhbGVydHMgb24gZXJyb3JcbiAgICB0aGlzLm9uKHRoaXMuZXZlbnRuYW1lcy5lcnJvciwgKGUpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKCdzY2FuZGlyIHJlY2VpdmUgZXJyb3IgbWVzc2FnZScsIGUpXG4gICAgICBpZiAod2luZG93LmFsZXJ0Ym94KSB7XG4gICAgICAgIHdpbmRvdy5hbGVydGJveC5yZW5kZXJBbGVydCh7XG4gICAgICAgICAgdHlwZTogd2luZG93LmFsZXJ0Ym94LmFsZXJ0Y29uZmlnLnR5cGVzLmVycm9yLFxuICAgICAgICAgIGNvbnRlbnQ6IGUsXG4gICAgICAgICAgaW52ZXJzZTogdHJ1ZSxcbiAgICAgICAgICBkaXNtaXNzaWJsZTogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBjb25zdCBzZWxmID0gdGhpcztcbiAgICBpZiAodGhpcy5vcHRpb25zLmNvbnRyb2xzLnppcCkge1xuICAgICAgY29uc3Qge1xuICAgICAgICBKc0RpclRvWmlwXG4gICAgICB9ID0gYXdhaXQgaW1wb3J0KCcuLi9tb2R1bGVzL2ZpbGVzL2pzLWRpcnRvemlwLmpzJyk7XG4gICAgICB0aGlzLmpzRGlyVG9aaXAgPSBuZXcgSnNEaXJUb1ppcCgpO1xuICAgICAgT2JqZWN0LmtleXModGhpcy5qc0RpclRvWmlwLmV2ZW50bmFtZXMpLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgICB0aGlzLmV2ZW50bmFtZXNba2V5XSA9IHRoaXMuanNEaXJUb1ppcC5ldmVudG5hbWVzW2tleV07XG4gICAgICAgIHRoaXMuanNEaXJUb1ppcC5vbihrZXksIChlKSA9PiB7XG4gICAgICAgICAgc3dpdGNoIChrZXkpIHtcbiAgICAgICAgICAgIGNhc2UgJ2NvdW50ZXInOlxuICAgICAgICAgICAgICBzZWxmLmZpbGVDb3VudGVyKGUpO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2NvbXBsZXRlJzpcbiAgICAgICAgICAgICAgaWYgKCFlIHx8ICFlLm5hbWUpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnbm8gZW1pdCBjb21wbGV0ZSBuYW1lJyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHNlbGYuc2hvd0NvbnRyb2woZS5uYW1lLCBlKTtcbiAgICAgICAgICAgIGNhc2UgJ21lc3NhZ2UnOlxuICAgICAgICAgICAgICBzd2l0Y2ggKGUubmFtZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgJ2NvbnNvbGUnOlxuICAgICAgICAgICAgICAgICAgdGhpcy5hZGRDb25zb2xlTWVzc2FnZSh7XG4gICAgICAgICAgICAgICAgICAgIGlkOiAoZS5pZCkgPyBlLmlkIDogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVudDogZS5tZXNzYWdlLFxuICAgICAgICAgICAgICAgICAgICBwYXJlbnQ6IHRoaXMuY29udGFpbmVyXG4gICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2Ugd2luZG93LmFsZXJ0Ym94LmFsZXJ0Y29uZmlnLnR5cGVzLmVycm9yOlxuICAgICAgICAgICAgICAgIGNhc2Ugd2luZG93LmFsZXJ0Ym94LmFsZXJ0Y29uZmlnLnR5cGVzLnN1Y2Nlc3M6XG4gICAgICAgICAgICAgICAgY2FzZSB3aW5kb3cuYWxlcnRib3guYWxlcnRjb25maWcudHlwZXMuZGFuZ2VyOlxuICAgICAgICAgICAgICAgIGNhc2Ugd2luZG93LmFsZXJ0Ym94LmFsZXJ0Y29uZmlnLnR5cGVzLmluZm86XG4gICAgICAgICAgICAgICAgICB3aW5kb3cuYWxlcnRib3gucmVuZGVyQWxlcnQoe1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiBlLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGUubWVzc2FnZSxcbiAgICAgICAgICAgICAgICAgICAgZGlzbWlzc2libGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGludmVyc2U6IGZhbHNlXG4gICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlcnJvcicsIGUpO1xuICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdtZXNzYWdlJywgZSk7XG4gICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3Rlcm1pbmF0ZSc6XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKCd0ZXJtaW5hdGUnLCBlKVxuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgc2VsZi5zaG93Q29udHJvbChrZXksIGUpO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICB9XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2JlZm9yZXVubG9hZCcsIChlKSA9PiB7XG4gICAgICBpZiAoIXRoaXMuZG9uZSkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGUucmV0dXJuVmFsdWUgPSAodGhpcy5vcHRpb25zLnByZXZlbnRjbG9zZSkgPyB0aGlzLm9wdGlvbnMucHJldmVudGNsb3NlIDogYFNvbWUgd29yayBpcyBpbiBwcm9ncmVzcyBpbiB0aGlzIHdpbmRvdy5cXG5BcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gbGVhdmU/YDtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuICBlbWl0VG9aaXAoYnRuKSB7XG4gICAgY29uc3QgbWVzc2FnZSA9IChidG4uZGF0YXNldC5tZXNzYWdlKSA/IEpTT04ucGFyc2UoYnRuLmRhdGFzZXQubWVzc2FnZSkgOiBudWxsO1xuICAgIGlmICghbWVzc2FnZSkgYnRuLmNsYXNzTGlzdC5hZGQoY3NzLmhpZGUpO1xuICAgIGlmIChtZXNzYWdlKSB7XG4gICAgICBpZiAobWVzc2FnZS5uYW1lKSB7XG4gICAgICAgIGNvbnN0IG5hbWUgPSBtZXNzYWdlLm5hbWU7XG4gICAgICAgIGRlbGV0ZSBtZXNzYWdlLm5hbWU7XG4gICAgICAgIGNvbnNvbGUubG9nKCdlbWl0IC0tLS0nICsgbmFtZSwgbWVzc2FnZSlcbiAgICAgICAgdGhpcy5qc0RpclRvWmlwLmVtaXQobmFtZSwgbWVzc2FnZSk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChuYW1lID09PSB0aGlzLmV2ZW50bmFtZXMuc2VuZGZpbGUpIGJ0bi5kaXNhYmxlZCA9IHRydWU7XG4gIH1cblxuICBxdW90YUVzdGltYXRlKG9iaikge1xuICAgIHJldHVybiB0aGlzLmpzRGlyVG9aaXAucXVvdGFFc3RpbWF0ZSgpO1xuICB9XG4gIHNjYW5Ccm93c2UoZSwgb3B0aW9ucykge1xuICAgIHJldHVybiB0aGlzLmpzRGlyVG9aaXAuc2NhbkJyb3dzZShlLCBvcHRpb25zKTtcblxuICB9XG4gIHNjYW5IYW5kbGUoZGlyLCBvcHRpb25zKSB7XG4gICAgcmV0dXJuIHRoaXMuanNEaXJUb1ppcC5zY2FuSGFuZGxlKGRpciwgb3B0aW9ucyk7XG4gIH1cbiAgYXN5bmMgaGFuZGxlQnJvd3NlKGUpIHtcbiAgICB0aGlzLmluaXRUaW1lcigpO1xuICAgIHRoaXMudG9nZ2xlQ291bnRlcnModHJ1ZSk7XG4gICAgaWYgKCF0aGlzLmhhc3BpY2tlcikgZSA9IGUudGFyZ2V0LmZpbGVzO1xuICAgIGF3YWl0IHRoaXMuc2NhbkJyb3dzZShlLCB7XG4gICAgICBhY2NlcHQ6IGFjY2VwdCxcbiAgICB9KTtcbiAgfVxuXG4gIGFkZERyb3B6b25lKCkgeyAvL1xuICAgIHRoaXMuZHJvcHpvbmUgPSBjcmVhdGVfYm94KCdkaXYnLCB7XG4gICAgICBpZDogdGhpcy5vcHRpb25zLmRpc3BsYXkuZHJvcHpvbmVcbiAgICB9KTtcblxuICAgIGNvbnN0IGlucHV0ID0gKHRoaXMuaGFzcGlja2VyKSA/IG51bGwgOiBjcmVhdGVfYm94KCdpbnB1dCcsIHtcbiAgICAgIHR5cGU6IFwiZmlsZVwiLFxuICAgICAgbmFtZTogdGhpcy5vcHRpb25zLnNlbGVjdG9ycy51cGxvYWRmaWxlLFxuICAgICAgaWQ6IHRoaXMub3B0aW9ucy5zZWxlY3RvcnMudXBsb2FkZmlsZSxcbiAgICAgIG11bHRpcGxlOiB0cnVlLFxuICAgICAgYWxsb3dkaXJzOiB0cnVlLFxuICAgICAgYWNjZXB0OiBhY2NlcHQsXG4gICAgICBjbGFzczogJ2hpZGRlbidcbiAgICB9LCB0aGlzLmRyb3B6b25lKTtcbiAgICBpZiAoaW5wdXQpIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgKGUpID0+IHtcbiAgICAgIHRoaXMuaGFuZGxlQnJvd3NlKGUpXG4gICAgfSk7XG4gICAgY29uc3QgYnRucyA9IGNyZWF0ZV9ib3goJ2RpdicsIHt9LFxuICAgICAgdGhpcy5kcm9wem9uZSk7XG5cbiAgICB0aGlzLm9wdGlvbnMuYnJvd3NlLmZvckVhY2gob3B0ID0+IHtcbiAgICAgIGNvbnN0IHRleHQgPSAodGhpcy5jb250YWluZXIuZGF0YXNldFtgdGV4dGJyb3dzZSR7b3B0fWBdKSA/IHRoaXMuY29udGFpbmVyLmRhdGFzZXRbYHRleHRicm93c2Uke29wdH1gXSA6IGBicm93c2Uke29wdH1gO1xuICAgICAgY29uc3QgYnRuID0gY3JlYXRlX2JveCgnc3BhbicsIHtcbiAgICAgICAgY2xhc3M6IHRoaXMub3B0aW9ucy5zZWxlY3RvcnMudHJpZ2dlci5zbGljZSgxKSxcbiAgICAgICAgZGF0YXNldDoge1xuICAgICAgICAgIHR5cGU6IG9wdFxuICAgICAgICB9LFxuICAgICAgICB0ZXh0OiB0ZXh0XG4gICAgICB9LCBidG5zKTtcbiAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jIChlKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLmhhc3BpY2tlcikge1xuICAgICAgICAgIHRoaXMub3BlbkRpckRpYWxvZyhvcHQsIChlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUJyb3dzZShlKVxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChvcHQgPT09IFwiZGlyZWN0b3J5XCIpIHtcbiAgICAgICAgICAgIGlucHV0LmRpcmVjdG9yeSA9IHRydWU7XG4gICAgICAgICAgICBpbnB1dC53ZWJraXRkaXJlY3RvcnkgPSB0cnVlO1xuICAgICAgICAgIH0gZWxzZSB7IC8vZmlsZVxuICAgICAgICAgICAgaW5wdXQuZGlyZWN0b3J5ID0gZmFsc2U7XG4gICAgICAgICAgICBpbnB1dC53ZWJraXRkaXJlY3RvcnkgPSBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaW5wdXQuZGlzcGF0Y2hFdmVudChuZXcgTW91c2VFdmVudChcImNsaWNrXCIpKTtcblxuICAgICAgICB9XG5cbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIGNvbnN0IHNwYW5kcm9wID0gY3JlYXRlX2JveCgnc3BhbicsIHtcbiAgICAgIHRleHQ6IHRoaXMuY29udGFpbmVyLmRhdGFzZXQudGV4dGRyb3BcbiAgICB9LCBidG5zKTtcblxuICB9XG5cbiAgdG9nZ2xlRHJvcFRhcmdldChvbiA9IHRydWUpIHtcbiAgICBjb25zdCBzZWxmID0gdGhpcztcbiAgICBjb25zdCBkcm9wdGFyZ2V0ID0gKHRoaXMuYWN0aXZlbnRyeSkgPyB0aGlzLmFjdGl2ZW50cnkuY29udGFpbmVyIDogbnVsbDtcblxuICAgIGlmIChkcm9wdGFyZ2V0ID09PSBudWxsKSByZXR1cm47XG4gICAgY29uc3QgY3NzZHJhZ292ZXIgPSAodGhpcy5qc0Rpckxpc3QpID8gdGhpcy5qc0Rpckxpc3Qub3B0aW9ucy5lbnRyeS5jc3MuZHJhZ292ZXIgOiB0aGlzLm9wdGlvbnMuY3NzLmRyYWdvdmVyO1xuICAgIGNvbnN0IHRhcmdldF9kcmFnb3ZlciA9IChlKSA9PiB7XG4gICAgICBpZiAoIXRoaXMuZHJhZ292ZXIgJiYgdGhpcy5hY3RpdmVudHJ5ICYmIHRoaXMuYWN0aXZlbnRyeS5jb250YWluZXIgPT09IGUuY3VycmVudFRhcmdldCkge1xuICAgICAgICBkcm9wdGFyZ2V0LmNsYXNzTGlzdC5hZGQoY3NzZHJhZ292ZXIpO1xuICAgICAgfVxuICAgICAgLy9zZWxmLmhhbmRsZURyYWdPdmVyKGUpO1xuICAgIH1cbiAgICBjb25zdCB0YXJnZXRfZHJvcCA9IGFzeW5jIChlKSA9PiB7XG4gICAgICBkcm9wdGFyZ2V0LmNsYXNzTGlzdC5yZW1vdmUoY3NzZHJhZ292ZXIpO1xuICAgICAgc2VsZi5oYW5kbGVEcm9wKGUpO1xuICAgIH1cblxuICAgIC8vIHNldCBldmVudHMgYW5kIGNzcyBmb3IgbmV3IGRyb3B6b25lXG4gICAgaWYgKG9uID09PSBmYWxzZSkge1xuICAgICAgZHJvcHRhcmdldC5yZW1vdmVFdmVudExpc3RlbmVyKCdkcmFnb3ZlcicsIHRhcmdldF9kcmFnb3Zlcik7XG4gICAgICBkcm9wdGFyZ2V0LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2Ryb3AnLCB0YXJnZXRfZHJvcCk7XG4gICAgICBkcm9wdGFyZ2V0LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5vcHRpb25zLnNlbGVjdG9ycy5kcm9wdGFyZ2V0LnN1YnN0cigxKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRyb3B0YXJnZXQuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ292ZXInLCB0YXJnZXRfZHJhZ292ZXIpO1xuICAgICAgZHJvcHRhcmdldC5hZGRFdmVudExpc3RlbmVyKCdkcm9wJywgdGFyZ2V0X2Ryb3ApO1xuICAgICAgZHJvcHRhcmdldC5jbGFzc0xpc3QuYWRkKHRoaXMub3B0aW9ucy5zZWxlY3RvcnMuZHJvcHRhcmdldC5zdWJzdHIoMSkpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGFkZERpckxpc3QoKSB7XG4gICAgY29uc29sZS5sb2coJ2Rpcmxpc3QgYWRkIGFkZERJTFJMTExMJywgdGhpcy5jb250YWluZXIpXG4gICAgdGhpcy5qc0Rpckxpc3QgPSBuZXcgSnNEaXJMaXN0KHRoaXMuY29udGFpbmVyKTtcbiAgICB0aGlzLmFjdGl2ZW50cnkgPSB0aGlzLmpzRGlyTGlzdC5yb290O1xuICAgIHRoaXMucm9vdGl0ZW0gPSB0aGlzLnRhcmdldGl0ZW0gPSB0aGlzLmFjdGl2ZW50cnkuY29udGFpbmVyO1xuICAgIHRoaXMuanNEaXJMaXN0Lm9uKHRoaXMuanNEaXJMaXN0LmV2ZW50bmFtZXMuYXR0YWNoLCAoZSkgPT4ge1xuICAgICAgaWYgKCFlLmVudHJ5KSByZXR1cm47XG4gICAgICB0aGlzLmRldGFjaERyb3B6b25lKCk7XG4gICAgICB0aGlzLmFjdGl2ZW50cnkgPSBlLmVudHJ5O1xuICAgICAgdGhpcy50YXJnZXRpdGVtID0gdGhpcy5hY3RpdmVudHJ5LmNvbnRhaW5lcjtcbiAgICAgIHRoaXMuYWRkVXBsb2FkRGlhbG9nKCk7XG4gICAgfSk7XG4gICAgdGhpcy5qc0Rpckxpc3Qub24odGhpcy5qc0Rpckxpc3QuZXZlbnRuYW1lcy5kZXRhY2gsIChlKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZygnbXlmaWxlcyBkaXJsaXN0IGV2ZW50JywgZSlcbiAgICAgIHRoaXMuZW5hYmxlRHJvcHpvbmUoKTtcbiAgICAgIHRoaXMuZGV0YWNoRHJvcHpvbmUoKTtcbiAgICAgIHRoaXMuYWN0aXZlbnRyeSA9IG51bGw7XG4gICAgICB0aGlzLnRhcmdldGl0ZW0gPSBudWxsO1xuICAgIH0pO1xuICAgIHRoaXMuanNEaXJMaXN0Lm9uKHRoaXMuanNEaXJMaXN0LmV2ZW50bmFtZXMuYWN0aW9uLCAoZSkgPT4ge1xuICAgICAgY29uc29sZS5sb2coJ2FjdGlvbiBub3QgbWFuYWdlZCcsIGUpXG4gICAgICBzd2l0Y2ggKGUuYWN0aW9uKSB7XG4gICAgICAgIGNhc2UgJ2Ryb3AnOlxuICAgICAgICAgIGUudGFyZ2V0ID0gZS5lbnRyeS5jb250YWluZXI7XG4gICAgICAgICAgdGhpcy5oYW5kbGVEcm9wKGUuZXZlbnQpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHRoaXMuYWN0aXZlbnRyeS5sYWJlbC5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgnY2xpY2snKSk7XG4gIH1cblxuICBhZGREaXNwbGF5UHJvZ3Jlc3Npb24oKSB7XG4gICAgLy8gYWRkIGNvdW50ZXJzXG4gICAgaWYgKHRoaXMuZGlzcGxheXByb2dyZXNzaW9uKSByZXR1cm47XG4gICAgbGV0IGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy5vcHRpb25zLmRpc3BsYXkucHJvZ3Jlc3Npb24pO1xuICAgIGlmICghZWwpIHtcbiAgICAgIGVsID0gY3JlYXRlX2JveCgnZGl2Jywge1xuICAgICAgICBpZDogdGhpcy5vcHRpb25zLmRpc3BsYXkucHJvZ3Jlc3Npb25cbiAgICAgIH0sIHRoaXMuY29udGFpbmVyKTtcbiAgICAgIGVsLmlubmVySFRNTCA9IGA8ZGl2IGNsYXNzPVwiZmxleCBzbTpmbGV4LXJvd1wiPjxkaXYgY2xhc3M9XCIke3RoaXMub3B0aW9ucy5kaXNwbGF5LmNvdW50ZXJzfVwiPjwvZGl2PjxkaXYgY2xhc3M9XCIke3RoaXMub3B0aW9ucy5kaXNwbGF5LnNpemVzfVwiPjwvZGl2PjxkaXYgY2xhc3M9XCIke2Nzcy5wcm9ncmVzc31cIj48L2Rpdj48ZGl2IGNsYXNzPVwiJHt0aGlzLm9wdGlvbnMuZGlzcGxheS50aW1lcnN9XCI+PC9kaXY+PC9kaXY+YDtcbiAgICAgIHRoaXMuZGlzcGxheXByb2dyZXNzaW9uID0gZWw7XG4gICAgfVxuICB9XG4gIGVuYWJsZURyb3B6b25lKGVuYWJsZSA9IHRydWUsIGRlc3Ryb3kgPSBmYWxzZSkge1xuICAgIGlmIChkZXN0cm95KSB0aGlzLmRyb3B6b25lLmNsYXNzTGlzdC5hZGQoY3NzLmhpZGUpO1xuICAgIGlmIChlbmFibGUpIHRoaXMuZHJvcHpvbmUuZGF0YXNldC5lbmFibGVkID0gdHJ1ZTtcbiAgICBlbHNlIGRlbGV0ZSB0aGlzLmRyb3B6b25lLmRhdGFzZXQuZW5hYmxlZDtcbiAgfVxuICAvL1xuICBhdHRhY2hEcm9wem9uZSgpIHtcbiAgICBpZiAodGhpcy5kcm9wem9uZS5kYXRhc2V0LmVuYWJsZWQpIHtcbiAgICAgIHRoaXMudGFyZ2V0aXRlbS5pbnNlcnRCZWZvcmUodGhpcy5kcm9wem9uZSwgdGhpcy5hY3RpdmVudHJ5LmxhYmVsLm5leHRTaWJsaW5nKTtcbiAgICAgIHRoaXMudG9nZ2xlRHJvcFRhcmdldCh0cnVlKTtcbiAgICB9XG4gIH1cbiAgZGV0YWNoRHJvcHpvbmUoKSB7XG4gICAgaWYgKHRoaXMuZHJvcHpvbmUuZGF0YXNldC5lbmFibGVkKSB7XG4gICAgICB0aGlzLnRhcmdldGl0ZW0gPSBudWxsO1xuICAgICAgaWYgKHRoaXMucm9vdGl0ZW0gIT09IHRoaXMudGFyZ2V0aXRlbSkge1xuICAgICAgICB0aGlzLnJvb3RpdGVtLmFwcGVuZCh0aGlzLmRyb3B6b25lKTtcblxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5jb250YWluZXIuYXBwZW5kKHRoaXMuZHJvcHpvbmUpO1xuICAgICAgICB0aGlzLnRvZ2dsZURyb3BUYXJnZXQoZmFsc2UpO1xuICAgICAgfVxuICAgIH1cblxuICB9XG5cbiAgb3BlbkRpckRpYWxvZyh0eXBlLCBjYWxsYmFjaykge1xuICAgIC8vIGlmIGNocm9tZSA4NiAsIGVkZ2UgODYsIG9wZXJhIDcyXG4gICAgY29uc3Qgc2hvd3BpY2sgPSAodHlwZSA9PT0gXCJkaXJlY3RvcnlcIikgPyB3aW5kb3cuc2hvd0RpcmVjdG9yeVBpY2tlciA6IHdpbmRvdy5zaG93T3BlbkZpbGVQaWNrZXI7XG4gICAgY29uc3QgcGlja29wdHMgPSAodHlwZSA9PT0gXCJkaXJlY3RvcnlcIikgPyB7XG4gICAgICBtb2RlOiBcInJlYWRcIixcbiAgICAgIG11bHRpcGxlOiB0cnVlXG4gICAgfSA6IHtcbiAgICAgIHR5cGVzOiBbe1xuICAgICAgICBkZXNjcmlwdGlvbjogXCJJbWFnZXMsLnRzdiwgemlwLCBnemlwLCB0YXIgZmlsZXNcIixcbiAgICAgICAgYWNjZXB0OiBvYmphY2NlcHQsXG4gICAgICB9LCBdLFxuICAgICAgZXhjbHVkZUFjY2VwdEFsbE9wdGlvbjogdHJ1ZSxcbiAgICAgIG11bHRpcGxlOiB0cnVlLFxuICAgIH07XG4gICAgc2hvd3BpY2socGlja29wdHMpLnRoZW4ocGljayA9PiB7XG4gICAgICBjYWxsYmFjayhwaWNrKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8vICBkcmFnJmRyb3BcbiAgYXN5bmMgaGFuZGxlRHJvcChlKSB7XG4gICAgbGV0IGRhdGFUcmFuc2ZlcjtcbiAgICBpZiAoZS5kYXRhVHJhbnNmZXIpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGRhdGFUcmFuc2ZlciA9IGUuZGF0YVRyYW5zZmVyO1xuICAgIH0gZWxzZSBkYXRhVHJhbnNmZXIgPSBlO1xuICAgIHRoaXMuZG9uZSA9IGZhbHNlO1xuICAgIHRoaXMuaW5pdFRpbWVyKCk7XG4gICAgY29uc3QgaXRlbXMgPSBbLi4uKChkYXRhVHJhbnNmZXIuaXRlbXMpID8gZGF0YVRyYW5zZmVyLml0ZW1zIDogZGF0YVRyYW5zZmVyLmZpbGVzKV07XG4gICAgaWYgKGl0ZW1zLmxlbmd0aCkge1xuICAgICAgdGhpcy5lbmFibGVEcm9wem9uZShmYWxzZSk7XG4gICAgICBhd2FpdCBpdGVtcy5mb3JFYWNoKGFzeW5jIGl0ZW0gPT4ge1xuICAgICAgICBpZiAoaXRlbS5raW5kID09PSBcImZpbGVcIikge1xuICAgICAgICAgIGl0ZW0gPSBhd2FpdCBpdGVtLndlYmtpdEdldEFzRW50cnkoKTtcbiAgICAgICAgICB0aGlzLnRvZ2dsZUNvdW50ZXJzKHRydWUpO1xuICAgICAgICAgIGF3YWl0IHRoaXMuc2NhbkhhbmRsZShpdGVtKTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9XG4gIH1cbiAgaGFuZGxlRHJhZ092ZXIoZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBlLmRhdGFUcmFuc2Zlci5kcm9wRWZmZWN0ID0gXCJtb3ZlXCI7XG4gIH1cbiAgc2hvd0NvbXBsZXRlKCkge1xuICAgIHRoaXMudGltZXIgPSAobmV3IERhdGUoKSAtIHRoaXMudGltZXIpIC8gMTAwMDtcbiAgICBjb25zb2xlLmxvZygnaXRlbS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0nICsgcGFyc2VJbnQodGhpcy50aW1lciAvIDYwKSArICcgLS0tICcgKyAoXG4gICAgICB0aGlzLnRpbWVyIC0gKHBhcnNlSW50KHRoaXMudGltZXIgLyA2MCkgKiA2MCkpKTtcbiAgICB0aGlzLmVuYWJsZURyb3B6b25lKCk7XG4gIH1cblxuICBzdG9wT25FcnJvcihlcnIpIHtcbiAgICBjb25zb2xlLmxvZygnZXJyJywgZXJyKTtcbiAgfVxuXG4gIGVuYWJsZURyb3B6b25lKGVuYWJsZSA9IHRydWUsIGRlc3Ryb3kgPSBmYWxzZSkge1xuICAgIGNvbnNvbGUubG9nKCd0aGlzZHJvcHpvbmUnLCB0aGlzLmRyb3B6b25lKVxuICAgIGlmIChkZXN0cm95KSB0aGlzLmRyb3B6b25lLmNsYXNzTGlzdC5hZGQoY3NzLmhpZGUpO1xuICAgIGlmIChlbmFibGUpIHRoaXMuZHJvcHpvbmUuZGF0YXNldC5lbmFibGVkID0gdHJ1ZTtcbiAgICBlbHNlIGRlbGV0ZSB0aGlzLmRyb3B6b25lLmRhdGFzZXQuZW5hYmxlZDtcbiAgfVxuXG4gIGFkZENvbnNvbGVNZXNzYWdlKG1lc3NhZ2UpIHtcbiAgICAvL21lc3NhZ2Uge21lc3NhZ2U6LCBwYXJlbnQ6fVxuICAgIG1lc3NhZ2UucGFyZW50ID0gKG1lc3NhZ2UucGFyZW50KSA/IG1lc3NhZ2UucGFyZW50IDogdGhpcy5jb250YWluZXI7XG4gICAgd2luZG93LmFsZXJ0Ym94LmFkZENvbnNvbGVNZXNzYWdlKG1lc3NhZ2UpO1xuICB9XG5cbiAgYWRkVXBsb2FkRGlhbG9nKCkge1xuICAgIGlmICh0aGlzLm9wdGlvbnMuY29udHJvbHMuc2Nhbikge1xuICAgICAgdGhpcy5lbmFibGVEcm9wem9uZSh0cnVlKTtcbiAgICAgIHRoaXMuYXR0YWNoRHJvcHpvbmUoKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBhZGRGaWxlc1N0b3JlKG5hbWUsIGNhbGxiYWNrKSB7XG4gICAgbmFtZSA9IChuYW1lKSA/IG5hbWUgOiB0aGlzLm9wdGlvbnMuZGJuYW1lO1xuICAgIGlmICghdGhpcy5qc0ZpbGVzU3RvcmUpIHtcbiAgICAgIGNvbnN0IHtcbiAgICAgICAgSnNGaWxlc1N0b3JlXG4gICAgICB9ID0gYXdhaXQgaW1wb3J0KCcuLi9tb2R1bGVzL2ZpbGVzL2pzLWZpbGVzeXN0ZW0uanMnKTtcbiAgICAgIHRoaXMuanNGaWxlc1N0b3JlID0gbmV3IEpzRmlsZXNTdG9yZShudWxsLCBjYWxsYmFjayk7XG4gICAgICB0aGlzLmRpc3BsYXlGaWxlcygpO1xuICAgIH1cbiAgICBpZiAoY2FsbGJhY2spIGF3YWl0IGNhbGxiYWNrKCk7XG4gIH1cbiAgZGlzcGxheUZpbGVzKCkge1xuICAgIHRoaXMuanNGaWxlc1N0b3JlLmdldEl0ZW1zKCdsb2NhbCcpO1xuICB9XG5cbiAgZmlsZUNvdW50ZXIoZSkge1xuICAgIGNvbnN0IGNvdW50ZXJzID0gdGhpcy5jb3VudGVyc1tlLm5hbWVdO1xuICAgIGNvdW50ZXJzLmNvdW50ZXIgKz0gMVxuICAgIGlmIChlLnNpemUgIT09IG51bGwpIGNvdW50ZXJzLnNpemUgKz0gcGFyc2VJbnQoZS5zaXplKTtcbiAgICBjb3VudGVycy5kaXNwbGF5LmNvdW50ZXIudGV4dENvbnRlbnQgPSBjb3VudGVycy5jb3VudGVyO1xuICAgIGlmIChjb3VudGVycy5kaXNwbGF5LnNpemUpIGNvdW50ZXJzLmRpc3BsYXkuc2l6ZS50ZXh0Q29udGVudCA9IGZvcm1hdF9ieXRlcyhjb3VudGVycy5zaXplKTtcbiAgICB0aGlzLnF1b3RhRXN0aW1hdGUoKTtcbiAgfVxuXG4gIHJlc2V0Q291bnRlcihpdGVtKSB7XG4gICAgY29uc3QgY291bnRlcnMgPSB0aGlzLmNvdW50ZXJzW2l0ZW1dO1xuICAgIFsnY291bnRlcicsICdzaXplJ10uZm9yRWFjaChlbCA9PiB7XG4gICAgICB0aGlzLmNvdW50ZXJzW2l0ZW1dW2VsXSA9IDA7XG4gICAgICBjb3VudGVycy5kaXNwbGF5W2VsXS50ZXh0Q29udGVudCA9IDA7XG4gICAgfSk7XG4gICAgdGhpcy50b2dnbGVDb3VudGVycyhmYWxzZSk7XG4gIH1cbiAgcmVzZXRDb3VudGVycygpIHtcbiAgICBPYmplY3Qua2V5cyh0aGlzLm9wdGlvbnMuY29udHJvbHMpLmZvckVhY2goa2V5ID0+IHtcbiAgICAgIHRoaXMucmVzZXRDb3VudGVyKGtleSk7XG4gICAgfSlcbiAgfVxuICB0b2dnbGVDb3VudGVycyhzaG93ID0gdHJ1ZSkge1xuICAgIGNvbnN0IGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy5vcHRpb25zLmRpc3BsYXkucHJvZ3Jlc3Npb24pO1xuICAgIGlmICghZWwpIHJldHVybjtcbiAgICBpZiAoc2hvdykgZWwuY2xhc3NMaXN0LnJlbW92ZShjc3MuaGlkZSk7XG4gICAgZWxzZSBlbC5jbGFzc0xpc3QuYWRkKGNzcy5oaWRlKTtcbiAgfVxuXG4gIGluaXRGaWxlQ291bnRlcihpdGVtLCBvcHRzLCBpKSB7XG4gICAgY29uc3Qgc2VwID0gKGkpID8gYCAvIGAgOiBgYDtcbiAgICBsZXQgY291bnRlciA9IDA7XG4gICAgbGV0IGNvdW50ZXJkaXNwbGF5ID0gbnVsbDtcbiAgICBsZXQgc2l6ZSA9IDA7XG4gICAgbGV0IHNpemVkaXNwbGF5ID0gbnVsbDtcbiAgICAvLyBjcmVhdGUgZG9tIGRpc3BsYXkgZWxlbWVudHNcblxuXG4gICAgbGV0IGJveGNvdW50ZXJzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy5vcHRpb25zLmRpc3BsYXkucHJvZ3Jlc3Npb24pO1xuICAgIGNvbnN0IGl0ZW1vcHRzID0ge1xuICAgICAgZGlzcGxheToge30sXG5cbiAgICB9O1xuICAgIE9iamVjdC5lbnRyaWVzKG9wdHMpLmZvckVhY2goKFtrLCB2YWxdKSA9PiB7XG4gICAgICBjb25zdCBjbCA9IGsgKyAncyc7XG4gICAgICBjb25zdCB0eHQgPSB7XG4gICAgICAgIGNvdW50ZXI6ICcgcmVhZCcsXG4gICAgICAgIHNpemU6ICcgcmVhZCcsXG4gICAgICAgIGNvdW50ZXJ6aXBwZWQ6ICcgY29tcHJlc3NlZCcsXG4gICAgICAgIHNpemV6aXBwZWQ6ICcgY29tcHJlc3NlZCdcbiAgICAgIH1cbiAgICAgIGxldCBlbGluc2VydCA9IGJveGNvdW50ZXJzLnF1ZXJ5U2VsZWN0b3IoJy4nICsgY2wpO1xuICAgICAgaWYgKCFlbGluc2VydCkgZWxpbnNlcnQgPSBjcmVhdGVfYm94KCdkaXYnLCB7XG4gICAgICAgIGNsYXNzOiBjbFxuICAgICAgfSwgYm94Y291bnRlcnMsIGBgKTtcbiAgICAgIGxldCBlbCA9IGVsaW5zZXJ0LnF1ZXJ5U2VsZWN0b3IoJy4nICsgdmFsKTtcbiAgICAgIGlmICghZWwpIHtcbiAgICAgICAgZWwgPSBjcmVhdGVfYm94KCdzcGFuJywge1xuICAgICAgICAgIGNsYXNzOiB2YWwsXG4gICAgICAgIH0sIGVsaW5zZXJ0LCBgIC8gYCk7XG4gICAgICAgIGlmICh0eHQuaGFzT3duUHJvcGVydHkodmFsKSkgZWxpbnNlcnQuYXBwZW5kKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHR4dFt2YWxdKSk7XG4gICAgICB9IGVsc2UgdGhpcy5yZXNldENvdW50ZXIoaXRlbSk7XG4gICAgICBpdGVtb3B0cy5kaXNwbGF5W2tdID0gZWw7XG4gICAgICBpdGVtb3B0c1trXSA9IDA7XG4gICAgfSk7XG5cbiAgICB0aGlzLmNvdW50ZXJzID0geyAuLi50aGlzLmNvdW50ZXJzLFxuICAgICAgLi4ue1xuICAgICAgICBbaXRlbV06IGl0ZW1vcHRzXG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIHNob3dDb250cm9sKGFjdGlvbiwgb3B0cykge1xuICAgIGNvbnNvbGUubG9nKCdvcHRzJywgb3B0cylcbiAgICBjb25zdCB0YXJnZXQgPSAoKG9wdHMuaGFzT3duUHJvcGVydHkoJ2JpZ2ZpbGUnKSAmJiBvcHRzLmJpZ2ZpbGUpID8gJ3ppcHBlZCcgOiAnemlwJyk7XG4gICAgbGV0IG1lc3NhZ2UsIHRleHQgPSBudWxsO1xuICAgIC8vICd6aXAnIC0tLW9ubHkgYnRuIGZvciB6aXAgYWN0aW9ucyBmb3IgdGhlIG1vbWVudFxuICAgIGNvbnN0IGJ0biA9IHRoaXNbdGhpcy5vcHRpb25zLmJ0bnByZWZpeCArICd6aXAnICsgdGFyZ2V0XTtcbiAgICBpZiAoIWJ0bikgcmV0dXJuO1xuICAgIGJ0bi5yZW1vdmVBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiKTtcbiAgICBjb25zdCBwYXJ0ID0gKG9wdHMgJiYgb3B0cy5wYXJ0KSA/IG9wdHMucGFydCA6IGZhbHNlO1xuICAgIGNvbnN0IGJpZ2ZpbGUgPSAob3B0cyAmJiBvcHRzLmJpZ2ZpbGUpID8gb3B0cy5iaWdmaWxlIDogZmFsc2U7XG4gICAgY29uc3QgZmlsZXBhdGggPSAob3B0cyAmJiBvcHRzLnBhdGgpID8gb3B0cy5wYXRoIDogdGhpcy5hY3RpdmVudHJ5LmdldEN1cnJlbnREaXJQYXRoKCk7XG4gICAgY29uc29sZS5sb2coJ2ZpbGVwYXRoJywgZmlsZXBhdGgpXG4gICAgc3dpdGNoIChhY3Rpb24pIHtcbiAgICAgIGNhc2UgdGhpcy5ldmVudG5hbWVzLnJlYWR5OlxuICAgICAgICB0aGlzLnJlc2V0Q291bnRlcnMoKTtcbiAgICAgICAgdGhpcy5hY3RpdmVudHJ5Lmxpc3QoKTtcbiAgICAgICAgaWYgKGJ0bi5kYXRhc2V0Lm1lc3NhZ2UpIGRlbGV0ZSBidG4uZGF0YXNldC5tZXNzYWdlO1xuICAgICAgICBidG4uY2xhc3NMaXN0LmFkZChjc3MuaGlkZSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSB0aGlzLmV2ZW50bmFtZXMuZm9sbG93OlxuICAgICAgICBpZiAoYnRuLmRhdGFzZXQubWVzc2FnZSkgZGVsZXRlIGJ0bi5kYXRhc2V0Lm1lc3NhZ2U7XG4gICAgICAgIGJ0bi5jbGFzc0xpc3QuYWRkKGNzcy5oaWRlKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIHRoaXMuZXZlbnRuYW1lcy5lbmR6aXA6XG4gICAgICAgIGlmICghcGFydCkgdGhpcy5zaG93Q29tcGxldGUoKTtcbiAgICAgICAgYnRuLnRleHRDb250ZW50ID0gYENsb3NlIHppcCBmaWxlYCArICgocGFydCkgPyBwYXJ0IDogYGApO1xuICAgICAgICBidG4udGl0bGUgPSAocGFydCkgPyBgWW91ciBmaWxlIGlzIHRvbyBiaWcgLSB5b3UgaGF2ZSB0byBzZW5kIHRoaXMgcGFydCBiZWZvcmUgY29udGludWluZyB0byBwcm9jZXNzIHRoZSBkaXJlY3RvcnlgIDogYENsaWNrIHRvIGVuZCB6aXAgZmlsZWA7XG4gICAgICAgIG1lc3NhZ2UgPSB7XG4gICAgICAgICAgbmFtZTogdGhpcy5ldmVudG5hbWVzLmVuZHppcCxcbiAgICAgICAgICBwYXJ0OiBwYXJ0LFxuICAgICAgICAgIHBhdGg6IGZpbGVwYXRoLFxuICAgICAgICAgIGJpZ2ZpbGU6ICh0YXJnZXQgIT09ICd6aXAnKSA/IGJpZ2ZpbGUgOiBmYWxzZSxcbiAgICAgICAgfTtcbiAgICAgICAgYnRuLmRhdGFzZXQubWVzc2FnZSA9IEpTT04uc3RyaW5naWZ5KG1lc3NhZ2UpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgdGhpcy5ldmVudG5hbWVzLmJpZ2ZpbGU6XG4gICAgICAgIGJ0bi50ZXh0Q29udGVudCA9IGBVcGxvYWQgYmlnIEZpbGUgc2VwYXJhdGVseWA7XG4gICAgICAgIG1lc3NhZ2UgPSB7XG4gICAgICAgICAgbmFtZTogdGhpcy5ldmVudG5hbWVzLmJpZ2ZpbGUsXG4gICAgICAgICAgcGF0aDogZmlsZXBhdGgsXG4gICAgICAgICAgcGFydDogcGFydCxcbiAgICAgICAgICBiaWdmaWxlOiBiaWdmaWxlXG4gICAgICAgIH07XG4gICAgICAgIGJ0bi5kYXRhc2V0Lm1lc3NhZ2UgPSBKU09OLnN0cmluZ2lmeShtZXNzYWdlKTtcbiAgICAgICAgY29uc29sZS5sb2coJ2JpZ2ZpbGUnLCBtZXNzYWdlKVxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgdGhpcy5ldmVudG5hbWVzLnNlbmRmaWxlOlxuICAgICAgICBjb25zb2xlLmxvZygnb3B0cyBzZW5kZmlsZScsIG9wdHMpXG4gICAgICAgIG1lc3NhZ2UgPSB7XG4gICAgICAgICAgbmFtZTogdGhpcy5ldmVudG5hbWVzLnNlbmRmaWxlLFxuICAgICAgICAgIHBhdGg6IGZpbGVwYXRoLFxuICAgICAgICAgIHBhcnQ6IHBhcnQsXG4gICAgICAgICAgYmlnZmlsZTogYmlnZmlsZVxuICAgICAgICB9O1xuICAgICAgICBidG4udGV4dENvbnRlbnQgPSBgVXBsb2FkIHppcCBmaWxlYDtcbiAgICAgICAgY29uc29sZS5sb2coJ21lc3NhZ2UgLXNlbmRmaWxlLSBVcGxvYWQgemlwIGZpbGUnLCBtZXNzYWdlKVxuICAgICAgICBpZiAobWVzc2FnZS5iaWdmaWxlICYmIG1lc3NhZ2UuYmlnZmlsZSAhPT0gJycpIGJ0bi50ZXh0Q29udGVudCArPSBgIGAgKyBvcHRzO1xuICAgICAgICBidG4uZGF0YXNldC5tZXNzYWdlID0gSlNPTi5zdHJpbmdpZnkobWVzc2FnZSk7XG4gICAgICAgIGNvbnNvbGUubG9nKCdtZXNzYWdldXAnLCBtZXNzYWdlKVxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgdGhpcy5ldmVudG5hbWVzLnBlbmRpbmc6XG4gICAgICAgIGJ0bi50ZXh0Q29udGVudCA9IGAgUGVuZGluZyBgICsgKCh0YXJnZXQgIT09ICd6aXAnKSA/ICcgYmlnIGZpbGUnIDogJycpO1xuICAgICAgICBidG4uZGF0YXNldC5tZXNzYWdlID0gJyc7XG4gICAgICAgIGJ0bi5zZXRBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiLCB0cnVlKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIHRoaXMuZXZlbnRuYW1lcy5nemlwOlxuICAgICAgICB0ZXh0ID0gYGNvbXByZXNzaW5nIHNlcGFyYXRlbHkgYmlnIGZpbGUgOiR7KG9wdHMgJiYgb3B0cy5iaWdmaWxlKT9vcHRzLmJpZ2ZpbGU6YGB9ICR7KG9wdHMgJiYgb3B0cy5zaXplKT9vcHRzLnNpemU6YGB9YDtcbiAgICAgICAgYnRuLnRleHRDb250ZW50ID0gdGV4dDtcbiAgICAgICAgYnRuLnNldEF0dHJpYnV0ZShcImRpc2FibGVkXCIsIHRydWUpO1xuICAgICAgICBjb25zb2xlLmxvZygnb3B0c2JpZ2ZsJywgb3B0cylcbiAgICAgICAgYnRuLmRhdGFzZXQubWVzc2FnZSA9IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICBuYW1lOiB0aGlzLmV2ZW50bmFtZXMuZW5kemlwLFxuICAgICAgICAgIHBhdGg6IGZpbGVwYXRoLFxuICAgICAgICAgIHBhcnQ6IHBhcnQsXG4gICAgICAgICAgYmlnZmlsZTogYmlnZmlsZVxuICAgICAgICB9KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIHRoaXMuZXZlbnRuYW1lcy50ZXJtaW5hdGU6XG4gICAgICAgIGNvbnNvbGUubG9nKCd0ZXJtaW5hdGUgJyArICgodGFyZ2V0ICE9PSAnemlwJykgPyAnYmlnZmlsZScgOiAnJykpO1xuXG4gICAgICAgIC8vZGVmYXVsdDpcbiAgICAgICAgYnRuLmRhdGFzZXQubWVzc2FnZSA9IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICBuYW1lOiAncmVhZHknLFxuICAgICAgICAgIGJpZ2ZpbGU6ICh0YXJnZXQgIT09ICd6aXAnKVxuICAgICAgICB9KTtcbiAgICAgICAgYnRuLmNsaWNrKCk7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBpZiAoYnRuLmRhdGFzZXQubWVzc2FnZSkgYnRuLmNsYXNzTGlzdC5yZW1vdmUoY3NzLmhpZGUpO1xuICB9XG5cbiAgZ2V0QnRuKGl0ZW0sIHRhcmdldCkge1xuICAgIGNvbnN0IGJ0bmtleSA9IHRoaXMub3B0aW9ucy5idG5wcmVmaXggKyBpdGVtICsgdGFyZ2V0O1xuICAgIGlmICh0aGlzW2J0bmtleV0pIHJldHVybiB0aGlzW2J0bmtleV07XG4gICAgY29uc3QgZGlzcGxheSA9IHRoaXMub3B0aW9ucy5jb250cm9sc1tpdGVtXS5idG5bdGFyZ2V0XTtcbiAgICBjb25zdCBidG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChkaXNwbGF5KTtcbiAgICBjb25zdCBwYXJlbnQgPSB0aGlzLmRpc3BsYXlwcm9ncmVzc2lvbjtcbiAgICBpZiAoIWJ0bikge1xuICAgICAgcGFyZW50Lmluc2VydEFkamFjZW50SFRNTCgnYmVmb3JlZW5kJywgYDxidXR0b24gaWQ9XCIke2Rpc3BsYXl9XCIgY2xhc3M9XCJidXR0b24gJHtkaXNwbGF5fSAke2Nzcy5tcmlnaHR9ICR7Y3NzLmhpZGV9XCI+PC9idXR0b24+YCk7XG4gICAgICB0aGlzW2J0bmtleV0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChkaXNwbGF5KTtcbiAgICAgIHRoaXNbYnRua2V5XS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jIChlKSA9PiB7XG4gICAgICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG4gICAgICAgIHRoaXMuZW1pdFRvWmlwKGUuY3VycmVudFRhcmdldCk7XG4gICAgICB9KTtcbiAgICB9IGVsc2UgcGFyZW50LmFwcGVuZChidG4pO1xuICAgIHJldHVybiB0aGlzW2J0bmtleV07XG4gIH1cblxuICBpbml0Q29udHJvbHMoKSB7XG4gICAgT2JqZWN0LmVudHJpZXModGhpcy5vcHRpb25zLmNvbnRyb2xzKS5mb3JFYWNoKChba2V5LCBjb250cm9sXSwgaSkgPT4ge1xuICAgICAgdGhpcy5pbml0RmlsZUNvdW50ZXIoa2V5LCBjb250cm9sLmRpc3BsYXksIGkpO1xuICAgICAgaWYgKGNvbnRyb2wuYnRuKSB0aGlzLmFjdGl2YXRlQ29udHJvbHMoa2V5LCBjb250cm9sLmJ0bik7XG4gICAgfSk7XG4gIH1cbiAgYWN0aXZhdGVDb250cm9scyhrZXksIGJ0bnMpIHtcbiAgICBPYmplY3Qua2V5cyhidG5zKS5mb3JFYWNoKChidG4pID0+IHtcbiAgICAgIHRoaXNbdGhpcy5vcHRpb25zLmJ0bnByZWZpeCArIGtleSArIGJ0bl0gPSB0aGlzLmdldEJ0bihrZXksIGJ0bik7XG4gICAgfSlcblxuICB9XG5cbn0iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/modules/js-my-files.js\n")}}]);