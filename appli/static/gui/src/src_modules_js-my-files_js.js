/*! For license information please see src_modules_js-my-files_js.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["src_modules_js-my-files_js"],{"./src/modules/js-my-files.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   JsMyFiles: () => (/* binding */ JsMyFiles)\n/* harmony export */ });\n/* harmony import */ var _modules_utils_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../modules/utils.js */ \"./src/modules/utils.js\");\n/* harmony import */ var _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../modules/modules-config.js */ \"./src/modules/modules-config.js\");\n\n\n\nconst accept = '.tsv,.png,.jpg, .jpeg,.zip,.gz,.7z,.bz2';\nconst localcss = {\n  mright: 'mr-4',\n}\nlet instance = null;\nclass JsMyFiles {\n  done = true;\n  jsDirToZip = null;\n  counters = {};\n  path = '';\n  _events = {};\n  eventnames = {\n    complete: 'complete',\n    error: 'error',\n  }\n  constructor(container, options = {}) {\n    if (!instance) {\n      container = (container instanceof HTMLElement) ? container : document.querySelector(container);\n      if (!container) return;\n      (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.dom_purify)(container, 'dataset');\n      this.container = container;\n      console.log(\"/gui/files/list\")\n      const defaultOptions = {\n\n        url: \"/gui/files/list\",\n        compress: {\n          label: 'compress'\n        },\n        counters: {\n          id: 'display-file-counters',\n        },\n        controls: {\n          scan: {\n            display: {\n              counter: 'counter',\n              size: 'size',\n            }\n          },\n          zip: {\n            btn: {\n              zip: 'makezip',\n              zipped: 'makezipped'\n            },\n            display: {\n              size: 'sizezipped',\n              counter: 'counterzipped',\n            }\n          },\n\n        },\n        upload: {\n          label: 'upload'\n        },\n        btnprefix: 'btn',\n        btnfilelist: null,\n        selector: {\n          doupload: '.target-upload',\n          droptarget: '.droptarget',\n          trigger: '.trigger',\n          dirlist: '.dirlist',\n          entries: '.entries',\n          uploadfile: 'uploadfile',\n          displayresult: 'results',\n\n        },\n        entrycontrols: {\n          selector: '.entrycontrols',\n          url: 'gui/me/my_files/',\n          controls: [{\n              action: 'rename',\n              text: 'rename',\n              icon: 'icon-pencil-sm'\n            },\n            {\n              action: 'delete',\n              text: 'delete',\n              icon: 'icon-trash-sm'\n            },\n          ]\n        },\n        display: {\n\n          local: 'local-list',\n          server: 'server-list',\n          dropzone: 'dropzone',\n          dirlist: 'dirlist',\n          boxtitle: 'boxtitle',\n        },\n\n\n        css: {\n          enabled: 'enabled'\n        }\n      };\n      this.options = Object.assign(defaultOptions, options);\n      this.init();\n      instance = this;\n    }\n    return instance;\n  }\n  init() {\n    // create dirlist box\n    let el = this.container.querySelector(this.options.selector.dirlist);\n    if (!el) {\n      el = document.createElement('div');\n      el.classList.add(this.options.selector.dirlist.slice(1));\n      this.container.append(el)\n    }\n    if (this.options.btnfilelist) {\n      const btnfiles = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)('div', {\n        class: 'button is-secondary',\n        text: this.options.btnfilelist\n      }, el);\n      btnfiles.addEventListener('click', (e) => {\n        this.serverList(el);\n        this.classList.toggle(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n      });\n    } else this.serverList(el);\n\n\n    //\n    // create a filepicker depends on browser\n    this.dropzone = document.createElement('div');\n    this.dropzone.id = this.options.display.dropzone;\n    this.dropzone.innerHTML = `<input type=\"file\" class=\"hidden\"  name=\"${this.options.selector.uploadfile}\" id=\"${this.options.selector.uploadfile}\">\n            <div class=\"${this.options.selector.droptarget.substr(1)}\">\n            <div id=\"${this.options.display.boxtitle}\"><span class=\"${this.options.selector.trigger.slice(1)}\">${this.container.dataset.textbrowse}</span>  ${this.container.dataset.textdrop}</div>\n          </div>`;\n    this.container.append(this.dropzone);\n    // add counters\n    el = document.getElementById(this.options.counters.id);\n    if (!el) {\n      console.log('counterscreate')\n      el = document.createElement('div');\n      el.id = this.options.counters.id;\n      el.innerHTML = `<div class=\"counters\"></div><div class=\"sizes\"></div><div class=\"progresss\"></div><div class=\"timers\"></div>`;\n      this.container.append(el);\n\n    }\n    this.displaylist = document.getElementById(this.options.display.dirlist);\n    const droptarget = this.container.querySelector(this.options.selector.droptarget);\n    droptarget.addEventListener('dragover', (e) => {\n      this.handleDragOver(e);\n    });\n    droptarget.addEventListener('drop', async (e) => {\n      this.handleDrop(e);\n    });\n    this.container.querySelector(this.options.selector.trigger).addEventListener('click', async (e) => {\n      this.openDirDialog(accept, async (e) => {\n        const files = e.target.files;\n        this.toggleCounters(true);\n        await this.jsDirToZip.scanFiles(files);\n      });\n    });\n    (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.add_custom_events)(this);\n\n    this.on(this.eventnames.error, (e) => {\n      consoile.log('scandir receive error message', e)\n    })\n    this.on(this.eventnames.processed, async (e) => {\n      if (this.nextaction) await this.nextaction();\n    })\n\n    window.addEventListener('beforeunload', (e) => {\n      if (!this.done) {\n        e.preventDefault();\n        e.returnValue = (this.options.preventclose) ? this.options.preventclose : `Some work is in progress in this window.\\nAre you sure you want to leave?`;\n      }\n\n    });\n\n\n  }\n  async addDirList(source) {\n\n  }\n\n\n  serverList(parent = null, subdir = null, tag = null) {\n    parent = parent ? parent : this.container.querySelector(this.options.selector.dirlist);\n    if (!parent) return;\n    // remove, move\n    const entry_controls = () => {\n      let box = this.container.querySelector(this.options.entrycontrols.selector);\n      if (box === null) {\n        box = document.createElement('div');\n        box.classList.add(this.options.entrycontrols.selector.substr(1));\n        this.options.entrycontrols.controls.forEach(control => {\n          const el = document.createElement('span');\n          if (control.icon) {\n            el.insertAdjacentHTML('afterbegin', `<i class=\"icon ${control.icon}\"></i>`);\n            el.dataset.title = control.text;\n          } else el.textContent = control.text;\n          box.append(el);\n          el.addEventListener('click', async (e) => {\n            if (el.parentElement.classList.contains('entryD') || el.parentElement.classList.contains('entryD')) {\n              const name = (el.parentElement.dataset.name) ? new URLSearchParams({\n                entry: el.parentElement.dataset.name\n              }) : null;\n              if (name === null) return false;\n              const response = await fetch(this.options.entrycontrols.url + control.action + name, (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.fetchSettings)());\n              const json = await response.json();\n              if (json.success) {\n                switch (json.action) {\n                  case 'rename':\n                    el.parentElement.textContent = json.name;\n                    break;\n                  case 'delete':\n                    el.parentElement.remove();\n                    break;\n                }\n                return true;\n              } else {\n                console.log('err', json)\n\n              }\n            }\n            return false;\n          });\n        });\n        box.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n        this.container.append(box);\n      }\n      return box;\n    }\n    const entrycontrols = entry_controls();\n    const attach_controls = (el) => {\n      if (!el.dataset.name) return false;\n      console.log('entrycontrols parent', entrycontrols.parentElement)\n      entrycontrols.parentElement.classList.remove('has-controls');\n      el.insertBefore(entrycontrols, el.firstElementChild);\n      el.classList.add('has-controls');\n      entrycontrols.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n    }\n    parent.classList.add('wait');\n    const el = parent.querySelector(this.options.selector.entries);\n    if (el) el.remove();\n    tag = (tag) ? ((tag === 'select') ? 'optiongroup' : tag) : 'ul';\n    const subtag = (tag === 'ul') ? 'li' : 'option';\n    fetch(this.options.url + ((subdir) ? subdir : ''), (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.fetchSettings)()).then(response => response.json()).then(async json => {\n      if (json.entries && json.entries.length) {\n        if (parent.dataset.label) parent.insertAdjacentHTML('afterbegin', `<label>${parent.dataset.label}</label>`);\n        let html = [`<${tag} class=\"${this.options.selector.entries.slice(1)}\">`],\n          files = [],\n          directories = [],\n          entries = json.entries;\n        while (entries.length > 0) {\n          const entry = entries.shift();\n          if (entry.type === 'F') files.push(entry);\n          else directories.push(entry);\n        };\n        files.sort((a, b) => (a.name < b.name));\n        directories.sort((a, b) => (a.name < b.name));\n        [directories, files].forEach(entries => {\n          entries.forEach((entry) => {\n            const ext = entry.name.split('.').pop();\n            const entrydetail = `<span class=\"entry${entry.type}\"><i class=\"icon p-[0.125rem] icon-${((entry.type === \"D\") ? 'folder-sm' : ((_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.filter_files.images.split(',').indexOf(ext)>=0)?'image-sm':'document-sm'))} align-text-bottom mb-0.5 mr-0.5\"></i>${entry.name}</span>`;\n            html.push(`<${subtag} ${(entry.type==='D')?`draggable=\"true\"`:``} data-name=\"${entry.name}\" ${(tag==='select')?` class=\"entry${entry.type}\"`:``}>${entrydetail}`);\n            html.push(`</${subtag}>`);\n          });\n        });\n        html.push(`</${tag}>`);\n        parent.insertAdjacentHTML('beforeend', html.join(``));\n        parent.querySelectorAll('.entryF').forEach(file => {\n          file.addEventListener('click', (e) => {\n            e.stopImmediatePropagation();\n            attach_controls(file.parentElement);\n          });\n        });\n        parent.querySelectorAll('.entryD').forEach(dir => {\n          dir.addEventListener('click', (e) => {\n            e.stopImmediatePropagation();\n            const dirlist = dir.parentElement;\n            dirlist.classList.toggle('on');\n            const ico = e.currentTarget.querySelector('i.icon');\n            if (ico) {\n              ico.classList.toggle('icon-folder-sm');\n              ico.classList.toggle('icon-folder-open-sm');\n            }\n            if (dirlist.classList.contains('on')) {\n              if (!dirlist.dataset.load) {\n                this.serverList(dirlist, ((subdir) ? subdir + '/' : '/') + dirlist.dataset.name, tag);\n\n              }\n            }\n          });\n          //attach_controls(dir.querySelector('summary'));\n\n        });\n\n      }\n      await this.addUploadDialog((subdir === null) ? this.container : parent);\n      parent.classList.remove('wait');\n      parent.dataset.loaded = true;\n\n      if (subdir) {\n        console.log('subdir attach', parent);\n        attach_controls(parent);\n      }\n    });\n\n  }\n\n  attachDropzone(target) {\n    this.targetdir = (target.parentElement.dataset.name) ? target.parentElement.dataset.name : '';\n    this.dropzone.classList.add(this.options.css.enabled);\n    target.append(this.dropzone);\n  }\n  detachDropzone() {\n    this.targetdir = null;\n    this.container.classList.remove(this.options.css.enabled);\n\n  }\n\n  openDirDialog(accept, callback) {\n    const input = document.createElement(\"input\");\n    input.type = \"file\";\n    input.directory = true;\n    input.multiple = true;\n    input.webkitdirectory = true;\n    input.allowdirs = true;\n    input.accept = accept;\n    input.addEventListener(\"change\", callback);\n    input.dispatchEvent(new MouseEvent(\"click\"));\n  }\n  handleDragOver(e) {\n    e.preventDefault();\n    e.dataTransfer.dropEffect = \"move\";\n  }\n\n  async handleDrop(e) {\n    let dataTransfer;\n    if (e.dataTransfer) {\n      e.preventDefault();\n      dataTransfer = e.dataTransfer;\n    } else dataTransfer = e;\n    this.done = false;\n    this.timer = new Date();\n    const items = [...((dataTransfer.items) ? dataTransfer.items : dataTransfer.files)];\n    if (items.length) {\n      this.enableDropzone(false);\n      await items.forEach(async item => {\n        if (item.kind === \"file\") {\n          item = await item.webkitGetAsEntry();\n          this.toggleCounters(true);\n          await this.readEntry(item);\n        }\n      })\n    }\n  }\n  showComplete() {\n    this.timer = (new Date() - this.timer) / 1000;\n    console.log('item-------------------------------------' + parseInt(this.timer / 60) + ' --- ' + (\n      this.timer - (parseInt(this.timer / 60) * 60)));\n    this.enableDropzone();\n  }\n\n  stopOnError(err) {\n    console.log('err', err);\n  }\n\n  enableDropzone(enable = true, destroy = false) {\n    if (destroy) this.dropzone.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n    if (enable) this.dropzone.classList.add(this.options.css.enabled);\n    else this.dropzone.classList.remove(this.options.css.enabled);\n\n  }\n\n  addConsoleMessage(message) {\n    //message {message:, parent:}\n    const tag = 'p';\n    let el = message.parent.querySelector('.' + _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.console);\n    if (el === null) {\n      el = document.createElement('div');\n      el.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.console);\n      message.parent.prepend(el);\n    }\n    if (message.id) {\n      const msg = el.querySelector(`${tag}[data-id=\"${message.id}\"]`);\n      if (msg) msg.innerHTML = message.content;\n      else el.insertAdjacentHTML('beforeend', `<${tag} data-id=\"${message.id}\">${message.content}</${tag}>`);\n    } else el.insertAdjacentHTML('beforeend', `<${tag}>${message.content}</${tag}>`);\n\n  }\n\n  async addUploadDialog(item) {\n    item = (item) ? item : this.container;\n    if (this.options.controls.scan) {\n      this.attachDropzone(item);\n      if (this.options.controls.zip) {\n        const {\n          JsDirToZip\n        } = await Promise.all(/*! import() */[__webpack_require__.e(\"vendors-node_modules_fflate_esm_browser_js\"), __webpack_require__.e(\"src_modules_files_js-dirtozip_js\")]).then(__webpack_require__.bind(__webpack_require__, /*! ../modules/files/js-dirtozip.js */ \"./src/modules/files/js-dirtozip.js\"));\n        this.jsDirToZip = new JsDirToZip();\n        this.jsDirToZip.on(this.jsDirToZip.eventnames.ready, (e) => {\n          console.log('ready')\n          this.initDisplays();\n        });\n        this.jsDirToZip.on(this.jsDirToZip.eventnames.message, async (e) => {\n          console.log('e', e);\n          switch (e.name) {\n            case 'console':\n              this.addConsoleMessage({\n                id: (e.id) ? e.id : null,\n                content: e.message,\n                parent: item\n              });\n              break;\n            case window.alertbox.alertconfig.types.error:\n            case window.alertbox.alertconfig.types.success:\n            case window.alertbox.alertconfig.types.danger:\n            case window.alertbox.alertconfig.types.info:\n              window.alertbox.renderAlert({\n                type: e.name,\n                content: e.message,\n                dismissible: true,\n                inverse: false\n              });\n              console.log('error', e);\n              break;\n            default:\n              console.log('message', e);\n              break;\n          }\n        })\n\n\n        const self = this;\n        this.jsDirToZip.on(this.jsDirToZip.eventnames.ready, (e) => {\n          self.showControl(this.jsDirToZip.eventnames.ready);\n        });\n        this.jsDirToZip.on(this.jsDirToZip.eventnames.counter, (e) => {\n          self.fileCounter(e.name, e.filepath, e.size);\n        });\n        this.jsDirToZip.on(this.jsDirToZip.eventnames.complete, (e) => {\n          if (!e || !e.name) {\n            console.log('no emit complete name');\n            return;\n          }\n          self.showControl(e.name, ((e.hasOwnProperty('bigfile') && e.bigfile) ? 'zipped' : 'zip'), (e.hasOwnProperty('part')) ? e.part : ((e.hasOwnProperty('bigfile')) ? e.bigfile : null));\n        });\n        this.jsDirToZip.on(this.jsDirToZip.eventnames.pending, (e) => {\n          self.showControl(this.jsDirToZip.eventnames.pending, ((e && e.hasOwnProperty('bigfile') && e.bigfile) ? 'zipped' : 'zip'));\n        });\n        this.jsDirToZip.on(this.jsDirToZip.eventnames.gzip, (e) => {\n          console.log('gzipped', e)\n          self.showControl(this.jsDirToZip.eventnames.gzip, 'zipped', e);\n        });\n        this.jsDirToZip.on(this.jsDirToZip.eventnames.terminate, (e) => {\n          console.log('terminate', e)\n          self.showControl(this.jsDirToZip.eventnames.terminate, ((e && e.hasOwnProperty('bigfile') && e.bigfile) ? 'zipped' : 'zip'));\n        });\n      }\n\n    }\n\n  }\n  async readEntry(entry) {\n    await this.jsDirToZip.scanHandle(entry);\n  }\n\n\n  async addFilesStore(name, callback) {\n    name = (name) ? name : this.options.dbname;\n    if (!this.jsFilesStore) {\n      const {\n        JsFilesStore\n      } = await __webpack_require__.e(/*! import() */ \"src_modules_files_js-filesystem_js\").then(__webpack_require__.bind(__webpack_require__, /*! ../modules/files/js-filesystem.js */ \"./src/modules/files/js-filesystem.js\"));\n      this.jsFilesStore = new JsFilesStore(null, callback);\n      this.displayFiles();\n    }\n    if (callback) await callback();\n  }\n  displayFiles() {\n    this.jsFilesStore.getItems('local');\n  }\n\n  fileCounter(item, filepath, size = null) {\n    const counters = this.counters[item];\n    counters.counter++;\n    if (size !== null) counters.size += parseInt(size);\n    counters.display.counter.textContent = counters.counter;\n    if (counters.display.size) counters.display.size.textContent = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.format_bytes)(counters.size);\n    this.jsDirToZip.quotaEstimate();\n  }\n\n  resetCounter(item) {\n    const counters = this.counters[item];\n    ['counter', 'size'].forEach(el => {\n      counters.display[el].textContent = 0;\n    });\n    this.toggleCounters(false);\n  }\n\n  toggleCounters(show = true) {\n    const el = document.getElementById(this.options.counters.id);\n    if (!el) return;\n    if (show) el.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n    else el.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n  }\n\n  initFileCounter(item, opts, i) {\n    const sep = (i) ? ` / ` : ``;\n    let counter = 0;\n    let counterdisplay = null;\n    let size = 0;\n    let sizedisplay = null;\n    // create dom display elements\n\n\n    let boxcounters = document.getElementById(this.options.counters.id);\n    const itemopts = {\n      display: {},\n\n    };\n    Object.entries(opts).forEach(([k, val]) => {\n      const cl = k + 's';\n      const txt = {\n        counter: ' read',\n        size: ' read',\n        counterzipped: ' compressed',\n        sizezipped: ' compressed'\n      }\n      let elinsert = boxcounters.querySelector('.' + cl);\n      if (!elinsert) elinsert = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)('div', {\n        class: cl\n      }, boxcounters, ``);\n      let el = elinsert.querySelector('.' + val);\n      if (!el) {\n        el = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)('span', {\n          class: val,\n        }, elinsert);\n        if (txt.hasOwnProperty(val)) elinsert.append(document.createTextNode(txt[val]));\n      } else this.resetCounter(item);\n      itemopts.display[k] = el;\n      itemopts[k] = 0;\n    });\n\n    this.counters = { ...this.counters,\n      ...{\n        [item]: itemopts\n      }\n    };\n  }\n\n  showControl(action, target = 'zip', opts = null) {\n    let message, text = null;\n    // 'zip' ---only btn for zip actions for the moment\n    const btn = this[this.options.btnprefix + 'zip' + target];\n    if (!btn) return;\n    btn.removeAttribute(\"disabled\");\n    switch (action) {\n      case this.jsDirToZip.eventnames.ready:\n        if (btn.dataset.message) delete btn.dataset.message;\n        btn.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n        this.initDisplays();\n        break;\n      case this.jsDirToZip.eventnames.endzip:\n        const part = opts;\n        if (!part) this.showComplete();\n        btn.textContent = `Close zip file` + ((part) ? part : ``);\n        btn.title = (part) ? `Your file is too big - you have to send this part before continuing to process the directory` : `Click to end zip file`;\n        message = {\n          name: this.jsDirToZip.eventnames.endzip,\n          part: part,\n          bigfile: (target !== 'zip')\n        };\n        if (part) message[\"part\"] = part;\n        btn.dataset.message = JSON.stringify(message);\n        break;\n      case this.jsDirToZip.eventnames.bigfile:\n        btn.textContent = `Upload big File separately`;\n        message = {\n          name: this.jsDirToZip.eventnames.bigfile,\n          path: this.path,\n          bigfile: true\n        };\n\n        const filepath = opts;\n        if (filepath) message[\"path\"] = filepath;\n        btn.dataset.message = JSON.stringify(message);\n        console.log('bigfile', message)\n        break;\n      case this.jsDirToZip.eventnames.sendfile:\n        message = {\n          name: this.jsDirToZip.eventnames.sendfile,\n          path: this.path,\n          bigfile: opts\n        };\n        btn.textContent = `Upload zip file`;\n        if (message.bigfile !== null) btn.textContent += ` ` + opts;\n        btn.dataset.message = JSON.stringify(message);\n        console.log('messageup', message)\n        break;\n      case this.jsDirToZip.eventnames.pending:\n        btn.textContent = ` Pending ` + ((target !== 'zip') ? ' big file' : '');\n        btn.dataset.message = '';\n        btn.setAttribute(\"disabled\", true);\n        break;\n      case this.jsDirToZip.eventnames.gzip:\n        text = `compressing separately big file :${(opts && opts.bigfile)?opts.bigfile:``} ${(opts && opts.size)?opts.size:``}`;\n        btn.textContent = text;\n        btn.setAttribute(\"disabled\", true);\n        console.log('optsbigfl', opts)\n        btn.dataset.message = JSON.stringify({\n          name: this.jsDirToZip.eventnames.endzip,\n          path: (opts.hasOwnProperty(\"bigfile\")) ? opts.bigfile : e.path,\n          bigfile: (opts.hasOwnProperty(\"bigfile\") && opts.bigfile !== \"\")\n        });\n        break;\n      case this.jsDirToZip.eventnames.terminate:\n        console.log('terminate ' + ((target !== 'zip') ? 'bigfile' : ''));\n        this.serverList();\n        //default:\n        btn.dataset.message = JSON.stringify({\n          name: 'ready',\n          bigfile: (target !== 'zip')\n        });\n        btn.textContent = `End!! ${ ((target !== 'zip') ? 'bigfile' : '')}`;\n\n        break;\n    }\n    if (btn.dataset.message) btn.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n  }\n  emitToZip(btn) {\n    const message = (btn.dataset.message) ? JSON.parse(btn.dataset.message) : null;\n    console.log('message', message)\n    if (!message) btn.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n    if (message) {\n      if (message.name) {\n        const name = message.name;\n        delete message.name;\n        console.log('emit ----' + name, message)\n        this.jsDirToZip.emit(name, message);\n      }\n    }\n    if (name === this.jsDirToZip.eventnames.sendfile) btn.disabled = true;\n  }\n  getBtn(item, target, parent = null) {\n    const btnkey = this.options.btnprefix + item + target;\n    if (this[btnkey]) return this[btnkey];\n    const display = this.options.controls[item].btn[target];\n    const btn = document.getElementById(display);\n    if (!btn) {\n      parent = (parent) ? parent : this.dropzone;\n      parent.insertAdjacentHTML('beforeend', `<button id=\"${display}\" class=\"button ${display} ${localcss.mright} ${_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide}\"></button>`);\n      this[btnkey] = document.getElementById(display);\n      this[btnkey].addEventListener('click', async (e) => {\n        this.emitToZip(e.currentTarget);\n      });\n    }\n    return this[btnkey];\n  }\n\n  initDisplays() {\n    console.log('initdispay', this.options.controls)\n    Object.entries(this.options.controls).forEach(([key, item], i) => {\n      this.initFileCounter(key, item.display, i);\n      if (item.btn) this.activateControls(key, item.btn);\n    });\n\n  }\n  activateControls(key, btns) {\n    Object.keys(btns).forEach((btn) => {\n      this[this.options.btnprefix + key + btn] = this.getBtn(key, btn);\n    })\n\n  }\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QTtBQUNBO0FBQ0EsMEJBQTBCLDJEQUFHO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbURBQW1ELHdDQUF3QyxFQUFFLGlDQUFpQztBQUM5SDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULG9DQUFvQyxzQ0FBc0M7O0FBRTFFO0FBQ0E7QUFDQSxrREFBa0QsMkRBQUc7QUFDckQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0MsMkRBQUc7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDREQUE0RCxRQUFRLGtCQUFrQixTQUFTLEVBQUUsaUJBQWlCLEVBQUUsMkRBQUcsTUFBTTtBQUM3SDtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vc3JjL21vZHVsZXMvanMtbXktZmlsZXMuanM/MTNiOSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBkb21fcHVyaWZ5LFxuICBmZXRjaFNldHRpbmdzLFxuICBhZGRfY3VzdG9tX2V2ZW50cyxcbiAgY3JlYXRlX2JveCxcbiAgZm9ybWF0X2J5dGVzXG59IGZyb20gJy4uL21vZHVsZXMvdXRpbHMuanMnO1xuaW1wb3J0IHtcbiAgY3NzLFxuICBmaWx0ZXJfZmlsZXNcbn0gZnJvbSAnLi4vbW9kdWxlcy9tb2R1bGVzLWNvbmZpZy5qcyc7XG5pbXBvcnQge1xuICBnZW5lcmF0ZV91dWlkLFxufSBmcm9tICcuLi9tb2R1bGVzL3V0aWxzLmpzJztcbmNvbnN0IGFjY2VwdCA9ICcudHN2LC5wbmcsLmpwZywgLmpwZWcsLnppcCwuZ3osLjd6LC5iejInO1xuY29uc3QgbG9jYWxjc3MgPSB7XG4gIG1yaWdodDogJ21yLTQnLFxufVxubGV0IGluc3RhbmNlID0gbnVsbDtcbmV4cG9ydCBjbGFzcyBKc015RmlsZXMge1xuICBkb25lID0gdHJ1ZTtcbiAganNEaXJUb1ppcCA9IG51bGw7XG4gIGNvdW50ZXJzID0ge307XG4gIHBhdGggPSAnJztcbiAgX2V2ZW50cyA9IHt9O1xuICBldmVudG5hbWVzID0ge1xuICAgIGNvbXBsZXRlOiAnY29tcGxldGUnLFxuICAgIGVycm9yOiAnZXJyb3InLFxuICB9XG4gIGNvbnN0cnVjdG9yKGNvbnRhaW5lciwgb3B0aW9ucyA9IHt9KSB7XG4gICAgaWYgKCFpbnN0YW5jZSkge1xuICAgICAgY29udGFpbmVyID0gKGNvbnRhaW5lciBpbnN0YW5jZW9mIEhUTUxFbGVtZW50KSA/IGNvbnRhaW5lciA6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoY29udGFpbmVyKTtcbiAgICAgIGlmICghY29udGFpbmVyKSByZXR1cm47XG4gICAgICBkb21fcHVyaWZ5KGNvbnRhaW5lciwgJ2RhdGFzZXQnKTtcbiAgICAgIHRoaXMuY29udGFpbmVyID0gY29udGFpbmVyO1xuICAgICAgY29uc29sZS5sb2coXCIvZ3VpL2ZpbGVzL2xpc3RcIilcbiAgICAgIGNvbnN0IGRlZmF1bHRPcHRpb25zID0ge1xuXG4gICAgICAgIHVybDogXCIvZ3VpL2ZpbGVzL2xpc3RcIixcbiAgICAgICAgY29tcHJlc3M6IHtcbiAgICAgICAgICBsYWJlbDogJ2NvbXByZXNzJ1xuICAgICAgICB9LFxuICAgICAgICBjb3VudGVyczoge1xuICAgICAgICAgIGlkOiAnZGlzcGxheS1maWxlLWNvdW50ZXJzJyxcbiAgICAgICAgfSxcbiAgICAgICAgY29udHJvbHM6IHtcbiAgICAgICAgICBzY2FuOiB7XG4gICAgICAgICAgICBkaXNwbGF5OiB7XG4gICAgICAgICAgICAgIGNvdW50ZXI6ICdjb3VudGVyJyxcbiAgICAgICAgICAgICAgc2l6ZTogJ3NpemUnLFxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgemlwOiB7XG4gICAgICAgICAgICBidG46IHtcbiAgICAgICAgICAgICAgemlwOiAnbWFrZXppcCcsXG4gICAgICAgICAgICAgIHppcHBlZDogJ21ha2V6aXBwZWQnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGlzcGxheToge1xuICAgICAgICAgICAgICBzaXplOiAnc2l6ZXppcHBlZCcsXG4gICAgICAgICAgICAgIGNvdW50ZXI6ICdjb3VudGVyemlwcGVkJyxcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuXG4gICAgICAgIH0sXG4gICAgICAgIHVwbG9hZDoge1xuICAgICAgICAgIGxhYmVsOiAndXBsb2FkJ1xuICAgICAgICB9LFxuICAgICAgICBidG5wcmVmaXg6ICdidG4nLFxuICAgICAgICBidG5maWxlbGlzdDogbnVsbCxcbiAgICAgICAgc2VsZWN0b3I6IHtcbiAgICAgICAgICBkb3VwbG9hZDogJy50YXJnZXQtdXBsb2FkJyxcbiAgICAgICAgICBkcm9wdGFyZ2V0OiAnLmRyb3B0YXJnZXQnLFxuICAgICAgICAgIHRyaWdnZXI6ICcudHJpZ2dlcicsXG4gICAgICAgICAgZGlybGlzdDogJy5kaXJsaXN0JyxcbiAgICAgICAgICBlbnRyaWVzOiAnLmVudHJpZXMnLFxuICAgICAgICAgIHVwbG9hZGZpbGU6ICd1cGxvYWRmaWxlJyxcbiAgICAgICAgICBkaXNwbGF5cmVzdWx0OiAncmVzdWx0cycsXG5cbiAgICAgICAgfSxcbiAgICAgICAgZW50cnljb250cm9sczoge1xuICAgICAgICAgIHNlbGVjdG9yOiAnLmVudHJ5Y29udHJvbHMnLFxuICAgICAgICAgIHVybDogJ2d1aS9tZS9teV9maWxlcy8nLFxuICAgICAgICAgIGNvbnRyb2xzOiBbe1xuICAgICAgICAgICAgICBhY3Rpb246ICdyZW5hbWUnLFxuICAgICAgICAgICAgICB0ZXh0OiAncmVuYW1lJyxcbiAgICAgICAgICAgICAgaWNvbjogJ2ljb24tcGVuY2lsLXNtJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgYWN0aW9uOiAnZGVsZXRlJyxcbiAgICAgICAgICAgICAgdGV4dDogJ2RlbGV0ZScsXG4gICAgICAgICAgICAgIGljb246ICdpY29uLXRyYXNoLXNtJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICBdXG4gICAgICAgIH0sXG4gICAgICAgIGRpc3BsYXk6IHtcblxuICAgICAgICAgIGxvY2FsOiAnbG9jYWwtbGlzdCcsXG4gICAgICAgICAgc2VydmVyOiAnc2VydmVyLWxpc3QnLFxuICAgICAgICAgIGRyb3B6b25lOiAnZHJvcHpvbmUnLFxuICAgICAgICAgIGRpcmxpc3Q6ICdkaXJsaXN0JyxcbiAgICAgICAgICBib3h0aXRsZTogJ2JveHRpdGxlJyxcbiAgICAgICAgfSxcblxuXG4gICAgICAgIGNzczoge1xuICAgICAgICAgIGVuYWJsZWQ6ICdlbmFibGVkJ1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgdGhpcy5vcHRpb25zID0gT2JqZWN0LmFzc2lnbihkZWZhdWx0T3B0aW9ucywgb3B0aW9ucyk7XG4gICAgICB0aGlzLmluaXQoKTtcbiAgICAgIGluc3RhbmNlID0gdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIGluc3RhbmNlO1xuICB9XG4gIGluaXQoKSB7XG4gICAgLy8gY3JlYXRlIGRpcmxpc3QgYm94XG4gICAgbGV0IGVsID0gdGhpcy5jb250YWluZXIucXVlcnlTZWxlY3Rvcih0aGlzLm9wdGlvbnMuc2VsZWN0b3IuZGlybGlzdCk7XG4gICAgaWYgKCFlbCkge1xuICAgICAgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgIGVsLmNsYXNzTGlzdC5hZGQodGhpcy5vcHRpb25zLnNlbGVjdG9yLmRpcmxpc3Quc2xpY2UoMSkpO1xuICAgICAgdGhpcy5jb250YWluZXIuYXBwZW5kKGVsKVxuICAgIH1cbiAgICBpZiAodGhpcy5vcHRpb25zLmJ0bmZpbGVsaXN0KSB7XG4gICAgICBjb25zdCBidG5maWxlcyA9IGNyZWF0ZV9ib3goJ2RpdicsIHtcbiAgICAgICAgY2xhc3M6ICdidXR0b24gaXMtc2Vjb25kYXJ5JyxcbiAgICAgICAgdGV4dDogdGhpcy5vcHRpb25zLmJ0bmZpbGVsaXN0XG4gICAgICB9LCBlbCk7XG4gICAgICBidG5maWxlcy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgIHRoaXMuc2VydmVyTGlzdChlbCk7XG4gICAgICAgIHRoaXMuY2xhc3NMaXN0LnRvZ2dsZShjc3MuaGlkZSk7XG4gICAgICB9KTtcbiAgICB9IGVsc2UgdGhpcy5zZXJ2ZXJMaXN0KGVsKTtcblxuXG4gICAgLy9cbiAgICAvLyBjcmVhdGUgYSBmaWxlcGlja2VyIGRlcGVuZHMgb24gYnJvd3NlclxuICAgIHRoaXMuZHJvcHpvbmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICB0aGlzLmRyb3B6b25lLmlkID0gdGhpcy5vcHRpb25zLmRpc3BsYXkuZHJvcHpvbmU7XG4gICAgdGhpcy5kcm9wem9uZS5pbm5lckhUTUwgPSBgPGlucHV0IHR5cGU9XCJmaWxlXCIgY2xhc3M9XCJoaWRkZW5cIiAgbmFtZT1cIiR7dGhpcy5vcHRpb25zLnNlbGVjdG9yLnVwbG9hZGZpbGV9XCIgaWQ9XCIke3RoaXMub3B0aW9ucy5zZWxlY3Rvci51cGxvYWRmaWxlfVwiPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cIiR7dGhpcy5vcHRpb25zLnNlbGVjdG9yLmRyb3B0YXJnZXQuc3Vic3RyKDEpfVwiPlxuICAgICAgICAgICAgPGRpdiBpZD1cIiR7dGhpcy5vcHRpb25zLmRpc3BsYXkuYm94dGl0bGV9XCI+PHNwYW4gY2xhc3M9XCIke3RoaXMub3B0aW9ucy5zZWxlY3Rvci50cmlnZ2VyLnNsaWNlKDEpfVwiPiR7dGhpcy5jb250YWluZXIuZGF0YXNldC50ZXh0YnJvd3NlfTwvc3Bhbj4gICR7dGhpcy5jb250YWluZXIuZGF0YXNldC50ZXh0ZHJvcH08L2Rpdj5cbiAgICAgICAgICA8L2Rpdj5gO1xuICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZCh0aGlzLmRyb3B6b25lKTtcbiAgICAvLyBhZGQgY291bnRlcnNcbiAgICBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMub3B0aW9ucy5jb3VudGVycy5pZCk7XG4gICAgaWYgKCFlbCkge1xuICAgICAgY29uc29sZS5sb2coJ2NvdW50ZXJzY3JlYXRlJylcbiAgICAgIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICBlbC5pZCA9IHRoaXMub3B0aW9ucy5jb3VudGVycy5pZDtcbiAgICAgIGVsLmlubmVySFRNTCA9IGA8ZGl2IGNsYXNzPVwiY291bnRlcnNcIj48L2Rpdj48ZGl2IGNsYXNzPVwic2l6ZXNcIj48L2Rpdj48ZGl2IGNsYXNzPVwicHJvZ3Jlc3NzXCI+PC9kaXY+PGRpdiBjbGFzcz1cInRpbWVyc1wiPjwvZGl2PmA7XG4gICAgICB0aGlzLmNvbnRhaW5lci5hcHBlbmQoZWwpO1xuXG4gICAgfVxuICAgIHRoaXMuZGlzcGxheWxpc3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLm9wdGlvbnMuZGlzcGxheS5kaXJsaXN0KTtcbiAgICBjb25zdCBkcm9wdGFyZ2V0ID0gdGhpcy5jb250YWluZXIucXVlcnlTZWxlY3Rvcih0aGlzLm9wdGlvbnMuc2VsZWN0b3IuZHJvcHRhcmdldCk7XG4gICAgZHJvcHRhcmdldC5hZGRFdmVudExpc3RlbmVyKCdkcmFnb3ZlcicsIChlKSA9PiB7XG4gICAgICB0aGlzLmhhbmRsZURyYWdPdmVyKGUpO1xuICAgIH0pO1xuICAgIGRyb3B0YXJnZXQuYWRkRXZlbnRMaXN0ZW5lcignZHJvcCcsIGFzeW5jIChlKSA9PiB7XG4gICAgICB0aGlzLmhhbmRsZURyb3AoZSk7XG4gICAgfSk7XG4gICAgdGhpcy5jb250YWluZXIucXVlcnlTZWxlY3Rvcih0aGlzLm9wdGlvbnMuc2VsZWN0b3IudHJpZ2dlcikuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoZSkgPT4ge1xuICAgICAgdGhpcy5vcGVuRGlyRGlhbG9nKGFjY2VwdCwgYXN5bmMgKGUpID0+IHtcbiAgICAgICAgY29uc3QgZmlsZXMgPSBlLnRhcmdldC5maWxlcztcbiAgICAgICAgdGhpcy50b2dnbGVDb3VudGVycyh0cnVlKTtcbiAgICAgICAgYXdhaXQgdGhpcy5qc0RpclRvWmlwLnNjYW5GaWxlcyhmaWxlcyk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgICBhZGRfY3VzdG9tX2V2ZW50cyh0aGlzKTtcblxuICAgIHRoaXMub24odGhpcy5ldmVudG5hbWVzLmVycm9yLCAoZSkgPT4ge1xuICAgICAgY29uc29pbGUubG9nKCdzY2FuZGlyIHJlY2VpdmUgZXJyb3IgbWVzc2FnZScsIGUpXG4gICAgfSlcbiAgICB0aGlzLm9uKHRoaXMuZXZlbnRuYW1lcy5wcm9jZXNzZWQsIGFzeW5jIChlKSA9PiB7XG4gICAgICBpZiAodGhpcy5uZXh0YWN0aW9uKSBhd2FpdCB0aGlzLm5leHRhY3Rpb24oKTtcbiAgICB9KVxuXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2JlZm9yZXVubG9hZCcsIChlKSA9PiB7XG4gICAgICBpZiAoIXRoaXMuZG9uZSkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGUucmV0dXJuVmFsdWUgPSAodGhpcy5vcHRpb25zLnByZXZlbnRjbG9zZSkgPyB0aGlzLm9wdGlvbnMucHJldmVudGNsb3NlIDogYFNvbWUgd29yayBpcyBpbiBwcm9ncmVzcyBpbiB0aGlzIHdpbmRvdy5cXG5BcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gbGVhdmU/YDtcbiAgICAgIH1cblxuICAgIH0pO1xuXG5cbiAgfVxuICBhc3luYyBhZGREaXJMaXN0KHNvdXJjZSkge1xuXG4gIH1cblxuXG4gIHNlcnZlckxpc3QocGFyZW50ID0gbnVsbCwgc3ViZGlyID0gbnVsbCwgdGFnID0gbnVsbCkge1xuICAgIHBhcmVudCA9IHBhcmVudCA/IHBhcmVudCA6IHRoaXMuY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IodGhpcy5vcHRpb25zLnNlbGVjdG9yLmRpcmxpc3QpO1xuICAgIGlmICghcGFyZW50KSByZXR1cm47XG4gICAgLy8gcmVtb3ZlLCBtb3ZlXG4gICAgY29uc3QgZW50cnlfY29udHJvbHMgPSAoKSA9PiB7XG4gICAgICBsZXQgYm94ID0gdGhpcy5jb250YWluZXIucXVlcnlTZWxlY3Rvcih0aGlzLm9wdGlvbnMuZW50cnljb250cm9scy5zZWxlY3Rvcik7XG4gICAgICBpZiAoYm94ID09PSBudWxsKSB7XG4gICAgICAgIGJveCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBib3guY2xhc3NMaXN0LmFkZCh0aGlzLm9wdGlvbnMuZW50cnljb250cm9scy5zZWxlY3Rvci5zdWJzdHIoMSkpO1xuICAgICAgICB0aGlzLm9wdGlvbnMuZW50cnljb250cm9scy5jb250cm9scy5mb3JFYWNoKGNvbnRyb2wgPT4ge1xuICAgICAgICAgIGNvbnN0IGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICAgICAgICAgIGlmIChjb250cm9sLmljb24pIHtcbiAgICAgICAgICAgIGVsLmluc2VydEFkamFjZW50SFRNTCgnYWZ0ZXJiZWdpbicsIGA8aSBjbGFzcz1cImljb24gJHtjb250cm9sLmljb259XCI+PC9pPmApO1xuICAgICAgICAgICAgZWwuZGF0YXNldC50aXRsZSA9IGNvbnRyb2wudGV4dDtcbiAgICAgICAgICB9IGVsc2UgZWwudGV4dENvbnRlbnQgPSBjb250cm9sLnRleHQ7XG4gICAgICAgICAgYm94LmFwcGVuZChlbCk7XG4gICAgICAgICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoZSkgPT4ge1xuICAgICAgICAgICAgaWYgKGVsLnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdlbnRyeUQnKSB8fCBlbC5wYXJlbnRFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnZW50cnlEJykpIHtcbiAgICAgICAgICAgICAgY29uc3QgbmFtZSA9IChlbC5wYXJlbnRFbGVtZW50LmRhdGFzZXQubmFtZSkgPyBuZXcgVVJMU2VhcmNoUGFyYW1zKHtcbiAgICAgICAgICAgICAgICBlbnRyeTogZWwucGFyZW50RWxlbWVudC5kYXRhc2V0Lm5hbWVcbiAgICAgICAgICAgICAgfSkgOiBudWxsO1xuICAgICAgICAgICAgICBpZiAobmFtZSA9PT0gbnVsbCkgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHRoaXMub3B0aW9ucy5lbnRyeWNvbnRyb2xzLnVybCArIGNvbnRyb2wuYWN0aW9uICsgbmFtZSwgZmV0Y2hTZXR0aW5ncygpKTtcbiAgICAgICAgICAgICAgY29uc3QganNvbiA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICAgICAgaWYgKGpzb24uc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgIHN3aXRjaCAoanNvbi5hY3Rpb24pIHtcbiAgICAgICAgICAgICAgICAgIGNhc2UgJ3JlbmFtZSc6XG4gICAgICAgICAgICAgICAgICAgIGVsLnBhcmVudEVsZW1lbnQudGV4dENvbnRlbnQgPSBqc29uLm5hbWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgY2FzZSAnZGVsZXRlJzpcbiAgICAgICAgICAgICAgICAgICAgZWwucGFyZW50RWxlbWVudC5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlcnInLCBqc29uKVxuXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGJveC5jbGFzc0xpc3QuYWRkKGNzcy5oaWRlKTtcbiAgICAgICAgdGhpcy5jb250YWluZXIuYXBwZW5kKGJveCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gYm94O1xuICAgIH1cbiAgICBjb25zdCBlbnRyeWNvbnRyb2xzID0gZW50cnlfY29udHJvbHMoKTtcbiAgICBjb25zdCBhdHRhY2hfY29udHJvbHMgPSAoZWwpID0+IHtcbiAgICAgIGlmICghZWwuZGF0YXNldC5uYW1lKSByZXR1cm4gZmFsc2U7XG4gICAgICBjb25zb2xlLmxvZygnZW50cnljb250cm9scyBwYXJlbnQnLCBlbnRyeWNvbnRyb2xzLnBhcmVudEVsZW1lbnQpXG4gICAgICBlbnRyeWNvbnRyb2xzLnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnaGFzLWNvbnRyb2xzJyk7XG4gICAgICBlbC5pbnNlcnRCZWZvcmUoZW50cnljb250cm9scywgZWwuZmlyc3RFbGVtZW50Q2hpbGQpO1xuICAgICAgZWwuY2xhc3NMaXN0LmFkZCgnaGFzLWNvbnRyb2xzJyk7XG4gICAgICBlbnRyeWNvbnRyb2xzLmNsYXNzTGlzdC5yZW1vdmUoY3NzLmhpZGUpO1xuICAgIH1cbiAgICBwYXJlbnQuY2xhc3NMaXN0LmFkZCgnd2FpdCcpO1xuICAgIGNvbnN0IGVsID0gcGFyZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5vcHRpb25zLnNlbGVjdG9yLmVudHJpZXMpO1xuICAgIGlmIChlbCkgZWwucmVtb3ZlKCk7XG4gICAgdGFnID0gKHRhZykgPyAoKHRhZyA9PT0gJ3NlbGVjdCcpID8gJ29wdGlvbmdyb3VwJyA6IHRhZykgOiAndWwnO1xuICAgIGNvbnN0IHN1YnRhZyA9ICh0YWcgPT09ICd1bCcpID8gJ2xpJyA6ICdvcHRpb24nO1xuICAgIGZldGNoKHRoaXMub3B0aW9ucy51cmwgKyAoKHN1YmRpcikgPyBzdWJkaXIgOiAnJyksIGZldGNoU2V0dGluZ3MoKSkudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpLnRoZW4oYXN5bmMganNvbiA9PiB7XG4gICAgICBpZiAoanNvbi5lbnRyaWVzICYmIGpzb24uZW50cmllcy5sZW5ndGgpIHtcbiAgICAgICAgaWYgKHBhcmVudC5kYXRhc2V0LmxhYmVsKSBwYXJlbnQuaW5zZXJ0QWRqYWNlbnRIVE1MKCdhZnRlcmJlZ2luJywgYDxsYWJlbD4ke3BhcmVudC5kYXRhc2V0LmxhYmVsfTwvbGFiZWw+YCk7XG4gICAgICAgIGxldCBodG1sID0gW2A8JHt0YWd9IGNsYXNzPVwiJHt0aGlzLm9wdGlvbnMuc2VsZWN0b3IuZW50cmllcy5zbGljZSgxKX1cIj5gXSxcbiAgICAgICAgICBmaWxlcyA9IFtdLFxuICAgICAgICAgIGRpcmVjdG9yaWVzID0gW10sXG4gICAgICAgICAgZW50cmllcyA9IGpzb24uZW50cmllcztcbiAgICAgICAgd2hpbGUgKGVudHJpZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGNvbnN0IGVudHJ5ID0gZW50cmllcy5zaGlmdCgpO1xuICAgICAgICAgIGlmIChlbnRyeS50eXBlID09PSAnRicpIGZpbGVzLnB1c2goZW50cnkpO1xuICAgICAgICAgIGVsc2UgZGlyZWN0b3JpZXMucHVzaChlbnRyeSk7XG4gICAgICAgIH07XG4gICAgICAgIGZpbGVzLnNvcnQoKGEsIGIpID0+IChhLm5hbWUgPCBiLm5hbWUpKTtcbiAgICAgICAgZGlyZWN0b3JpZXMuc29ydCgoYSwgYikgPT4gKGEubmFtZSA8IGIubmFtZSkpO1xuICAgICAgICBbZGlyZWN0b3JpZXMsIGZpbGVzXS5mb3JFYWNoKGVudHJpZXMgPT4ge1xuICAgICAgICAgIGVudHJpZXMuZm9yRWFjaCgoZW50cnkpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGV4dCA9IGVudHJ5Lm5hbWUuc3BsaXQoJy4nKS5wb3AoKTtcbiAgICAgICAgICAgIGNvbnN0IGVudHJ5ZGV0YWlsID0gYDxzcGFuIGNsYXNzPVwiZW50cnkke2VudHJ5LnR5cGV9XCI+PGkgY2xhc3M9XCJpY29uIHAtWzAuMTI1cmVtXSBpY29uLSR7KChlbnRyeS50eXBlID09PSBcIkRcIikgPyAnZm9sZGVyLXNtJyA6ICgoZmlsdGVyX2ZpbGVzLmltYWdlcy5zcGxpdCgnLCcpLmluZGV4T2YoZXh0KT49MCk/J2ltYWdlLXNtJzonZG9jdW1lbnQtc20nKSl9IGFsaWduLXRleHQtYm90dG9tIG1iLTAuNSBtci0wLjVcIj48L2k+JHtlbnRyeS5uYW1lfTwvc3Bhbj5gO1xuICAgICAgICAgICAgaHRtbC5wdXNoKGA8JHtzdWJ0YWd9ICR7KGVudHJ5LnR5cGU9PT0nRCcpP2BkcmFnZ2FibGU9XCJ0cnVlXCJgOmBgfSBkYXRhLW5hbWU9XCIke2VudHJ5Lm5hbWV9XCIgJHsodGFnPT09J3NlbGVjdCcpP2AgY2xhc3M9XCJlbnRyeSR7ZW50cnkudHlwZX1cImA6YGB9PiR7ZW50cnlkZXRhaWx9YCk7XG4gICAgICAgICAgICBodG1sLnB1c2goYDwvJHtzdWJ0YWd9PmApO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgaHRtbC5wdXNoKGA8LyR7dGFnfT5gKTtcbiAgICAgICAgcGFyZW50Lmluc2VydEFkamFjZW50SFRNTCgnYmVmb3JlZW5kJywgaHRtbC5qb2luKGBgKSk7XG4gICAgICAgIHBhcmVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZW50cnlGJykuZm9yRWFjaChmaWxlID0+IHtcbiAgICAgICAgICBmaWxlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICBhdHRhY2hfY29udHJvbHMoZmlsZS5wYXJlbnRFbGVtZW50KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHBhcmVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZW50cnlEJykuZm9yRWFjaChkaXIgPT4ge1xuICAgICAgICAgIGRpci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgICAgICBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgY29uc3QgZGlybGlzdCA9IGRpci5wYXJlbnRFbGVtZW50O1xuICAgICAgICAgICAgZGlybGlzdC5jbGFzc0xpc3QudG9nZ2xlKCdvbicpO1xuICAgICAgICAgICAgY29uc3QgaWNvID0gZS5jdXJyZW50VGFyZ2V0LnF1ZXJ5U2VsZWN0b3IoJ2kuaWNvbicpO1xuICAgICAgICAgICAgaWYgKGljbykge1xuICAgICAgICAgICAgICBpY28uY2xhc3NMaXN0LnRvZ2dsZSgnaWNvbi1mb2xkZXItc20nKTtcbiAgICAgICAgICAgICAgaWNvLmNsYXNzTGlzdC50b2dnbGUoJ2ljb24tZm9sZGVyLW9wZW4tc20nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChkaXJsaXN0LmNsYXNzTGlzdC5jb250YWlucygnb24nKSkge1xuICAgICAgICAgICAgICBpZiAoIWRpcmxpc3QuZGF0YXNldC5sb2FkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXJ2ZXJMaXN0KGRpcmxpc3QsICgoc3ViZGlyKSA/IHN1YmRpciArICcvJyA6ICcvJykgKyBkaXJsaXN0LmRhdGFzZXQubmFtZSwgdGFnKTtcblxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgLy9hdHRhY2hfY29udHJvbHMoZGlyLnF1ZXJ5U2VsZWN0b3IoJ3N1bW1hcnknKSk7XG5cbiAgICAgICAgfSk7XG5cbiAgICAgIH1cbiAgICAgIGF3YWl0IHRoaXMuYWRkVXBsb2FkRGlhbG9nKChzdWJkaXIgPT09IG51bGwpID8gdGhpcy5jb250YWluZXIgOiBwYXJlbnQpO1xuICAgICAgcGFyZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3dhaXQnKTtcbiAgICAgIHBhcmVudC5kYXRhc2V0LmxvYWRlZCA9IHRydWU7XG5cbiAgICAgIGlmIChzdWJkaXIpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ3N1YmRpciBhdHRhY2gnLCBwYXJlbnQpO1xuICAgICAgICBhdHRhY2hfY29udHJvbHMocGFyZW50KTtcbiAgICAgIH1cbiAgICB9KTtcblxuICB9XG5cbiAgYXR0YWNoRHJvcHpvbmUodGFyZ2V0KSB7XG4gICAgdGhpcy50YXJnZXRkaXIgPSAodGFyZ2V0LnBhcmVudEVsZW1lbnQuZGF0YXNldC5uYW1lKSA/IHRhcmdldC5wYXJlbnRFbGVtZW50LmRhdGFzZXQubmFtZSA6ICcnO1xuICAgIHRoaXMuZHJvcHpvbmUuY2xhc3NMaXN0LmFkZCh0aGlzLm9wdGlvbnMuY3NzLmVuYWJsZWQpO1xuICAgIHRhcmdldC5hcHBlbmQodGhpcy5kcm9wem9uZSk7XG4gIH1cbiAgZGV0YWNoRHJvcHpvbmUoKSB7XG4gICAgdGhpcy50YXJnZXRkaXIgPSBudWxsO1xuICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5vcHRpb25zLmNzcy5lbmFibGVkKTtcblxuICB9XG5cbiAgb3BlbkRpckRpYWxvZyhhY2NlcHQsIGNhbGxiYWNrKSB7XG4gICAgY29uc3QgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIik7XG4gICAgaW5wdXQudHlwZSA9IFwiZmlsZVwiO1xuICAgIGlucHV0LmRpcmVjdG9yeSA9IHRydWU7XG4gICAgaW5wdXQubXVsdGlwbGUgPSB0cnVlO1xuICAgIGlucHV0LndlYmtpdGRpcmVjdG9yeSA9IHRydWU7XG4gICAgaW5wdXQuYWxsb3dkaXJzID0gdHJ1ZTtcbiAgICBpbnB1dC5hY2NlcHQgPSBhY2NlcHQ7XG4gICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCBjYWxsYmFjayk7XG4gICAgaW5wdXQuZGlzcGF0Y2hFdmVudChuZXcgTW91c2VFdmVudChcImNsaWNrXCIpKTtcbiAgfVxuICBoYW5kbGVEcmFnT3ZlcihlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGUuZGF0YVRyYW5zZmVyLmRyb3BFZmZlY3QgPSBcIm1vdmVcIjtcbiAgfVxuXG4gIGFzeW5jIGhhbmRsZURyb3AoZSkge1xuICAgIGxldCBkYXRhVHJhbnNmZXI7XG4gICAgaWYgKGUuZGF0YVRyYW5zZmVyKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBkYXRhVHJhbnNmZXIgPSBlLmRhdGFUcmFuc2ZlcjtcbiAgICB9IGVsc2UgZGF0YVRyYW5zZmVyID0gZTtcbiAgICB0aGlzLmRvbmUgPSBmYWxzZTtcbiAgICB0aGlzLnRpbWVyID0gbmV3IERhdGUoKTtcbiAgICBjb25zdCBpdGVtcyA9IFsuLi4oKGRhdGFUcmFuc2Zlci5pdGVtcykgPyBkYXRhVHJhbnNmZXIuaXRlbXMgOiBkYXRhVHJhbnNmZXIuZmlsZXMpXTtcbiAgICBpZiAoaXRlbXMubGVuZ3RoKSB7XG4gICAgICB0aGlzLmVuYWJsZURyb3B6b25lKGZhbHNlKTtcbiAgICAgIGF3YWl0IGl0ZW1zLmZvckVhY2goYXN5bmMgaXRlbSA9PiB7XG4gICAgICAgIGlmIChpdGVtLmtpbmQgPT09IFwiZmlsZVwiKSB7XG4gICAgICAgICAgaXRlbSA9IGF3YWl0IGl0ZW0ud2Via2l0R2V0QXNFbnRyeSgpO1xuICAgICAgICAgIHRoaXMudG9nZ2xlQ291bnRlcnModHJ1ZSk7XG4gICAgICAgICAgYXdhaXQgdGhpcy5yZWFkRW50cnkoaXRlbSk7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfVxuICB9XG4gIHNob3dDb21wbGV0ZSgpIHtcbiAgICB0aGlzLnRpbWVyID0gKG5ldyBEYXRlKCkgLSB0aGlzLnRpbWVyKSAvIDEwMDA7XG4gICAgY29uc29sZS5sb2coJ2l0ZW0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tJyArIHBhcnNlSW50KHRoaXMudGltZXIgLyA2MCkgKyAnIC0tLSAnICsgKFxuICAgICAgdGhpcy50aW1lciAtIChwYXJzZUludCh0aGlzLnRpbWVyIC8gNjApICogNjApKSk7XG4gICAgdGhpcy5lbmFibGVEcm9wem9uZSgpO1xuICB9XG5cbiAgc3RvcE9uRXJyb3IoZXJyKSB7XG4gICAgY29uc29sZS5sb2coJ2VycicsIGVycik7XG4gIH1cblxuICBlbmFibGVEcm9wem9uZShlbmFibGUgPSB0cnVlLCBkZXN0cm95ID0gZmFsc2UpIHtcbiAgICBpZiAoZGVzdHJveSkgdGhpcy5kcm9wem9uZS5jbGFzc0xpc3QuYWRkKGNzcy5oaWRlKTtcbiAgICBpZiAoZW5hYmxlKSB0aGlzLmRyb3B6b25lLmNsYXNzTGlzdC5hZGQodGhpcy5vcHRpb25zLmNzcy5lbmFibGVkKTtcbiAgICBlbHNlIHRoaXMuZHJvcHpvbmUuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLm9wdGlvbnMuY3NzLmVuYWJsZWQpO1xuXG4gIH1cblxuICBhZGRDb25zb2xlTWVzc2FnZShtZXNzYWdlKSB7XG4gICAgLy9tZXNzYWdlIHttZXNzYWdlOiwgcGFyZW50On1cbiAgICBjb25zdCB0YWcgPSAncCc7XG4gICAgbGV0IGVsID0gbWVzc2FnZS5wYXJlbnQucXVlcnlTZWxlY3RvcignLicgKyBjc3MuY29uc29sZSk7XG4gICAgaWYgKGVsID09PSBudWxsKSB7XG4gICAgICBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgZWwuY2xhc3NMaXN0LmFkZChjc3MuY29uc29sZSk7XG4gICAgICBtZXNzYWdlLnBhcmVudC5wcmVwZW5kKGVsKTtcbiAgICB9XG4gICAgaWYgKG1lc3NhZ2UuaWQpIHtcbiAgICAgIGNvbnN0IG1zZyA9IGVsLnF1ZXJ5U2VsZWN0b3IoYCR7dGFnfVtkYXRhLWlkPVwiJHttZXNzYWdlLmlkfVwiXWApO1xuICAgICAgaWYgKG1zZykgbXNnLmlubmVySFRNTCA9IG1lc3NhZ2UuY29udGVudDtcbiAgICAgIGVsc2UgZWwuaW5zZXJ0QWRqYWNlbnRIVE1MKCdiZWZvcmVlbmQnLCBgPCR7dGFnfSBkYXRhLWlkPVwiJHttZXNzYWdlLmlkfVwiPiR7bWVzc2FnZS5jb250ZW50fTwvJHt0YWd9PmApO1xuICAgIH0gZWxzZSBlbC5pbnNlcnRBZGphY2VudEhUTUwoJ2JlZm9yZWVuZCcsIGA8JHt0YWd9PiR7bWVzc2FnZS5jb250ZW50fTwvJHt0YWd9PmApO1xuXG4gIH1cblxuICBhc3luYyBhZGRVcGxvYWREaWFsb2coaXRlbSkge1xuICAgIGl0ZW0gPSAoaXRlbSkgPyBpdGVtIDogdGhpcy5jb250YWluZXI7XG4gICAgaWYgKHRoaXMub3B0aW9ucy5jb250cm9scy5zY2FuKSB7XG4gICAgICB0aGlzLmF0dGFjaERyb3B6b25lKGl0ZW0pO1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy5jb250cm9scy56aXApIHtcbiAgICAgICAgY29uc3Qge1xuICAgICAgICAgIEpzRGlyVG9aaXBcbiAgICAgICAgfSA9IGF3YWl0IGltcG9ydCgnLi4vbW9kdWxlcy9maWxlcy9qcy1kaXJ0b3ppcC5qcycpO1xuICAgICAgICB0aGlzLmpzRGlyVG9aaXAgPSBuZXcgSnNEaXJUb1ppcCgpO1xuICAgICAgICB0aGlzLmpzRGlyVG9aaXAub24odGhpcy5qc0RpclRvWmlwLmV2ZW50bmFtZXMucmVhZHksIChlKSA9PiB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ3JlYWR5JylcbiAgICAgICAgICB0aGlzLmluaXREaXNwbGF5cygpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5qc0RpclRvWmlwLm9uKHRoaXMuanNEaXJUb1ppcC5ldmVudG5hbWVzLm1lc3NhZ2UsIGFzeW5jIChlKSA9PiB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ2UnLCBlKTtcbiAgICAgICAgICBzd2l0Y2ggKGUubmFtZSkge1xuICAgICAgICAgICAgY2FzZSAnY29uc29sZSc6XG4gICAgICAgICAgICAgIHRoaXMuYWRkQ29uc29sZU1lc3NhZ2Uoe1xuICAgICAgICAgICAgICAgIGlkOiAoZS5pZCkgPyBlLmlkIDogbnVsbCxcbiAgICAgICAgICAgICAgICBjb250ZW50OiBlLm1lc3NhZ2UsXG4gICAgICAgICAgICAgICAgcGFyZW50OiBpdGVtXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2Ugd2luZG93LmFsZXJ0Ym94LmFsZXJ0Y29uZmlnLnR5cGVzLmVycm9yOlxuICAgICAgICAgICAgY2FzZSB3aW5kb3cuYWxlcnRib3guYWxlcnRjb25maWcudHlwZXMuc3VjY2VzczpcbiAgICAgICAgICAgIGNhc2Ugd2luZG93LmFsZXJ0Ym94LmFsZXJ0Y29uZmlnLnR5cGVzLmRhbmdlcjpcbiAgICAgICAgICAgIGNhc2Ugd2luZG93LmFsZXJ0Ym94LmFsZXJ0Y29uZmlnLnR5cGVzLmluZm86XG4gICAgICAgICAgICAgIHdpbmRvdy5hbGVydGJveC5yZW5kZXJBbGVydCh7XG4gICAgICAgICAgICAgICAgdHlwZTogZS5uYW1lLFxuICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGUubWVzc2FnZSxcbiAgICAgICAgICAgICAgICBkaXNtaXNzaWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBpbnZlcnNlOiBmYWxzZVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2Vycm9yJywgZSk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ21lc3NhZ2UnLCBlKTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuXG5cbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgICAgIHRoaXMuanNEaXJUb1ppcC5vbih0aGlzLmpzRGlyVG9aaXAuZXZlbnRuYW1lcy5yZWFkeSwgKGUpID0+IHtcbiAgICAgICAgICBzZWxmLnNob3dDb250cm9sKHRoaXMuanNEaXJUb1ppcC5ldmVudG5hbWVzLnJlYWR5KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuanNEaXJUb1ppcC5vbih0aGlzLmpzRGlyVG9aaXAuZXZlbnRuYW1lcy5jb3VudGVyLCAoZSkgPT4ge1xuICAgICAgICAgIHNlbGYuZmlsZUNvdW50ZXIoZS5uYW1lLCBlLmZpbGVwYXRoLCBlLnNpemUpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5qc0RpclRvWmlwLm9uKHRoaXMuanNEaXJUb1ppcC5ldmVudG5hbWVzLmNvbXBsZXRlLCAoZSkgPT4ge1xuICAgICAgICAgIGlmICghZSB8fCAhZS5uYW1lKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnbm8gZW1pdCBjb21wbGV0ZSBuYW1lJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIHNlbGYuc2hvd0NvbnRyb2woZS5uYW1lLCAoKGUuaGFzT3duUHJvcGVydHkoJ2JpZ2ZpbGUnKSAmJiBlLmJpZ2ZpbGUpID8gJ3ppcHBlZCcgOiAnemlwJyksIChlLmhhc093blByb3BlcnR5KCdwYXJ0JykpID8gZS5wYXJ0IDogKChlLmhhc093blByb3BlcnR5KCdiaWdmaWxlJykpID8gZS5iaWdmaWxlIDogbnVsbCkpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5qc0RpclRvWmlwLm9uKHRoaXMuanNEaXJUb1ppcC5ldmVudG5hbWVzLnBlbmRpbmcsIChlKSA9PiB7XG4gICAgICAgICAgc2VsZi5zaG93Q29udHJvbCh0aGlzLmpzRGlyVG9aaXAuZXZlbnRuYW1lcy5wZW5kaW5nLCAoKGUgJiYgZS5oYXNPd25Qcm9wZXJ0eSgnYmlnZmlsZScpICYmIGUuYmlnZmlsZSkgPyAnemlwcGVkJyA6ICd6aXAnKSk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmpzRGlyVG9aaXAub24odGhpcy5qc0RpclRvWmlwLmV2ZW50bmFtZXMuZ3ppcCwgKGUpID0+IHtcbiAgICAgICAgICBjb25zb2xlLmxvZygnZ3ppcHBlZCcsIGUpXG4gICAgICAgICAgc2VsZi5zaG93Q29udHJvbCh0aGlzLmpzRGlyVG9aaXAuZXZlbnRuYW1lcy5nemlwLCAnemlwcGVkJywgZSk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmpzRGlyVG9aaXAub24odGhpcy5qc0RpclRvWmlwLmV2ZW50bmFtZXMudGVybWluYXRlLCAoZSkgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCd0ZXJtaW5hdGUnLCBlKVxuICAgICAgICAgIHNlbGYuc2hvd0NvbnRyb2wodGhpcy5qc0RpclRvWmlwLmV2ZW50bmFtZXMudGVybWluYXRlLCAoKGUgJiYgZS5oYXNPd25Qcm9wZXJ0eSgnYmlnZmlsZScpICYmIGUuYmlnZmlsZSkgPyAnemlwcGVkJyA6ICd6aXAnKSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgfVxuXG4gIH1cbiAgYXN5bmMgcmVhZEVudHJ5KGVudHJ5KSB7XG4gICAgYXdhaXQgdGhpcy5qc0RpclRvWmlwLnNjYW5IYW5kbGUoZW50cnkpO1xuICB9XG5cblxuICBhc3luYyBhZGRGaWxlc1N0b3JlKG5hbWUsIGNhbGxiYWNrKSB7XG4gICAgbmFtZSA9IChuYW1lKSA/IG5hbWUgOiB0aGlzLm9wdGlvbnMuZGJuYW1lO1xuICAgIGlmICghdGhpcy5qc0ZpbGVzU3RvcmUpIHtcbiAgICAgIGNvbnN0IHtcbiAgICAgICAgSnNGaWxlc1N0b3JlXG4gICAgICB9ID0gYXdhaXQgaW1wb3J0KCcuLi9tb2R1bGVzL2ZpbGVzL2pzLWZpbGVzeXN0ZW0uanMnKTtcbiAgICAgIHRoaXMuanNGaWxlc1N0b3JlID0gbmV3IEpzRmlsZXNTdG9yZShudWxsLCBjYWxsYmFjayk7XG4gICAgICB0aGlzLmRpc3BsYXlGaWxlcygpO1xuICAgIH1cbiAgICBpZiAoY2FsbGJhY2spIGF3YWl0IGNhbGxiYWNrKCk7XG4gIH1cbiAgZGlzcGxheUZpbGVzKCkge1xuICAgIHRoaXMuanNGaWxlc1N0b3JlLmdldEl0ZW1zKCdsb2NhbCcpO1xuICB9XG5cbiAgZmlsZUNvdW50ZXIoaXRlbSwgZmlsZXBhdGgsIHNpemUgPSBudWxsKSB7XG4gICAgY29uc3QgY291bnRlcnMgPSB0aGlzLmNvdW50ZXJzW2l0ZW1dO1xuICAgIGNvdW50ZXJzLmNvdW50ZXIrKztcbiAgICBpZiAoc2l6ZSAhPT0gbnVsbCkgY291bnRlcnMuc2l6ZSArPSBwYXJzZUludChzaXplKTtcbiAgICBjb3VudGVycy5kaXNwbGF5LmNvdW50ZXIudGV4dENvbnRlbnQgPSBjb3VudGVycy5jb3VudGVyO1xuICAgIGlmIChjb3VudGVycy5kaXNwbGF5LnNpemUpIGNvdW50ZXJzLmRpc3BsYXkuc2l6ZS50ZXh0Q29udGVudCA9IGZvcm1hdF9ieXRlcyhjb3VudGVycy5zaXplKTtcbiAgICB0aGlzLmpzRGlyVG9aaXAucXVvdGFFc3RpbWF0ZSgpO1xuICB9XG5cbiAgcmVzZXRDb3VudGVyKGl0ZW0pIHtcbiAgICBjb25zdCBjb3VudGVycyA9IHRoaXMuY291bnRlcnNbaXRlbV07XG4gICAgWydjb3VudGVyJywgJ3NpemUnXS5mb3JFYWNoKGVsID0+IHtcbiAgICAgIGNvdW50ZXJzLmRpc3BsYXlbZWxdLnRleHRDb250ZW50ID0gMDtcbiAgICB9KTtcbiAgICB0aGlzLnRvZ2dsZUNvdW50ZXJzKGZhbHNlKTtcbiAgfVxuXG4gIHRvZ2dsZUNvdW50ZXJzKHNob3cgPSB0cnVlKSB7XG4gICAgY29uc3QgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLm9wdGlvbnMuY291bnRlcnMuaWQpO1xuICAgIGlmICghZWwpIHJldHVybjtcbiAgICBpZiAoc2hvdykgZWwuY2xhc3NMaXN0LnJlbW92ZShjc3MuaGlkZSk7XG4gICAgZWxzZSBlbC5jbGFzc0xpc3QuYWRkKGNzcy5oaWRlKTtcbiAgfVxuXG4gIGluaXRGaWxlQ291bnRlcihpdGVtLCBvcHRzLCBpKSB7XG4gICAgY29uc3Qgc2VwID0gKGkpID8gYCAvIGAgOiBgYDtcbiAgICBsZXQgY291bnRlciA9IDA7XG4gICAgbGV0IGNvdW50ZXJkaXNwbGF5ID0gbnVsbDtcbiAgICBsZXQgc2l6ZSA9IDA7XG4gICAgbGV0IHNpemVkaXNwbGF5ID0gbnVsbDtcbiAgICAvLyBjcmVhdGUgZG9tIGRpc3BsYXkgZWxlbWVudHNcblxuXG4gICAgbGV0IGJveGNvdW50ZXJzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy5vcHRpb25zLmNvdW50ZXJzLmlkKTtcbiAgICBjb25zdCBpdGVtb3B0cyA9IHtcbiAgICAgIGRpc3BsYXk6IHt9LFxuXG4gICAgfTtcbiAgICBPYmplY3QuZW50cmllcyhvcHRzKS5mb3JFYWNoKChbaywgdmFsXSkgPT4ge1xuICAgICAgY29uc3QgY2wgPSBrICsgJ3MnO1xuICAgICAgY29uc3QgdHh0ID0ge1xuICAgICAgICBjb3VudGVyOiAnIHJlYWQnLFxuICAgICAgICBzaXplOiAnIHJlYWQnLFxuICAgICAgICBjb3VudGVyemlwcGVkOiAnIGNvbXByZXNzZWQnLFxuICAgICAgICBzaXplemlwcGVkOiAnIGNvbXByZXNzZWQnXG4gICAgICB9XG4gICAgICBsZXQgZWxpbnNlcnQgPSBib3hjb3VudGVycy5xdWVyeVNlbGVjdG9yKCcuJyArIGNsKTtcbiAgICAgIGlmICghZWxpbnNlcnQpIGVsaW5zZXJ0ID0gY3JlYXRlX2JveCgnZGl2Jywge1xuICAgICAgICBjbGFzczogY2xcbiAgICAgIH0sIGJveGNvdW50ZXJzLCBgYCk7XG4gICAgICBsZXQgZWwgPSBlbGluc2VydC5xdWVyeVNlbGVjdG9yKCcuJyArIHZhbCk7XG4gICAgICBpZiAoIWVsKSB7XG4gICAgICAgIGVsID0gY3JlYXRlX2JveCgnc3BhbicsIHtcbiAgICAgICAgICBjbGFzczogdmFsLFxuICAgICAgICB9LCBlbGluc2VydCk7XG4gICAgICAgIGlmICh0eHQuaGFzT3duUHJvcGVydHkodmFsKSkgZWxpbnNlcnQuYXBwZW5kKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHR4dFt2YWxdKSk7XG4gICAgICB9IGVsc2UgdGhpcy5yZXNldENvdW50ZXIoaXRlbSk7XG4gICAgICBpdGVtb3B0cy5kaXNwbGF5W2tdID0gZWw7XG4gICAgICBpdGVtb3B0c1trXSA9IDA7XG4gICAgfSk7XG5cbiAgICB0aGlzLmNvdW50ZXJzID0geyAuLi50aGlzLmNvdW50ZXJzLFxuICAgICAgLi4ue1xuICAgICAgICBbaXRlbV06IGl0ZW1vcHRzXG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIHNob3dDb250cm9sKGFjdGlvbiwgdGFyZ2V0ID0gJ3ppcCcsIG9wdHMgPSBudWxsKSB7XG4gICAgbGV0IG1lc3NhZ2UsIHRleHQgPSBudWxsO1xuICAgIC8vICd6aXAnIC0tLW9ubHkgYnRuIGZvciB6aXAgYWN0aW9ucyBmb3IgdGhlIG1vbWVudFxuICAgIGNvbnN0IGJ0biA9IHRoaXNbdGhpcy5vcHRpb25zLmJ0bnByZWZpeCArICd6aXAnICsgdGFyZ2V0XTtcbiAgICBpZiAoIWJ0bikgcmV0dXJuO1xuICAgIGJ0bi5yZW1vdmVBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiKTtcbiAgICBzd2l0Y2ggKGFjdGlvbikge1xuICAgICAgY2FzZSB0aGlzLmpzRGlyVG9aaXAuZXZlbnRuYW1lcy5yZWFkeTpcbiAgICAgICAgaWYgKGJ0bi5kYXRhc2V0Lm1lc3NhZ2UpIGRlbGV0ZSBidG4uZGF0YXNldC5tZXNzYWdlO1xuICAgICAgICBidG4uY2xhc3NMaXN0LmFkZChjc3MuaGlkZSk7XG4gICAgICAgIHRoaXMuaW5pdERpc3BsYXlzKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSB0aGlzLmpzRGlyVG9aaXAuZXZlbnRuYW1lcy5lbmR6aXA6XG4gICAgICAgIGNvbnN0IHBhcnQgPSBvcHRzO1xuICAgICAgICBpZiAoIXBhcnQpIHRoaXMuc2hvd0NvbXBsZXRlKCk7XG4gICAgICAgIGJ0bi50ZXh0Q29udGVudCA9IGBDbG9zZSB6aXAgZmlsZWAgKyAoKHBhcnQpID8gcGFydCA6IGBgKTtcbiAgICAgICAgYnRuLnRpdGxlID0gKHBhcnQpID8gYFlvdXIgZmlsZSBpcyB0b28gYmlnIC0geW91IGhhdmUgdG8gc2VuZCB0aGlzIHBhcnQgYmVmb3JlIGNvbnRpbnVpbmcgdG8gcHJvY2VzcyB0aGUgZGlyZWN0b3J5YCA6IGBDbGljayB0byBlbmQgemlwIGZpbGVgO1xuICAgICAgICBtZXNzYWdlID0ge1xuICAgICAgICAgIG5hbWU6IHRoaXMuanNEaXJUb1ppcC5ldmVudG5hbWVzLmVuZHppcCxcbiAgICAgICAgICBwYXJ0OiBwYXJ0LFxuICAgICAgICAgIGJpZ2ZpbGU6ICh0YXJnZXQgIT09ICd6aXAnKVxuICAgICAgICB9O1xuICAgICAgICBpZiAocGFydCkgbWVzc2FnZVtcInBhcnRcIl0gPSBwYXJ0O1xuICAgICAgICBidG4uZGF0YXNldC5tZXNzYWdlID0gSlNPTi5zdHJpbmdpZnkobWVzc2FnZSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSB0aGlzLmpzRGlyVG9aaXAuZXZlbnRuYW1lcy5iaWdmaWxlOlxuICAgICAgICBidG4udGV4dENvbnRlbnQgPSBgVXBsb2FkIGJpZyBGaWxlIHNlcGFyYXRlbHlgO1xuICAgICAgICBtZXNzYWdlID0ge1xuICAgICAgICAgIG5hbWU6IHRoaXMuanNEaXJUb1ppcC5ldmVudG5hbWVzLmJpZ2ZpbGUsXG4gICAgICAgICAgcGF0aDogdGhpcy5wYXRoLFxuICAgICAgICAgIGJpZ2ZpbGU6IHRydWVcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBmaWxlcGF0aCA9IG9wdHM7XG4gICAgICAgIGlmIChmaWxlcGF0aCkgbWVzc2FnZVtcInBhdGhcIl0gPSBmaWxlcGF0aDtcbiAgICAgICAgYnRuLmRhdGFzZXQubWVzc2FnZSA9IEpTT04uc3RyaW5naWZ5KG1lc3NhZ2UpO1xuICAgICAgICBjb25zb2xlLmxvZygnYmlnZmlsZScsIG1lc3NhZ2UpXG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSB0aGlzLmpzRGlyVG9aaXAuZXZlbnRuYW1lcy5zZW5kZmlsZTpcbiAgICAgICAgbWVzc2FnZSA9IHtcbiAgICAgICAgICBuYW1lOiB0aGlzLmpzRGlyVG9aaXAuZXZlbnRuYW1lcy5zZW5kZmlsZSxcbiAgICAgICAgICBwYXRoOiB0aGlzLnBhdGgsXG4gICAgICAgICAgYmlnZmlsZTogb3B0c1xuICAgICAgICB9O1xuICAgICAgICBidG4udGV4dENvbnRlbnQgPSBgVXBsb2FkIHppcCBmaWxlYDtcbiAgICAgICAgaWYgKG1lc3NhZ2UuYmlnZmlsZSAhPT0gbnVsbCkgYnRuLnRleHRDb250ZW50ICs9IGAgYCArIG9wdHM7XG4gICAgICAgIGJ0bi5kYXRhc2V0Lm1lc3NhZ2UgPSBKU09OLnN0cmluZ2lmeShtZXNzYWdlKTtcbiAgICAgICAgY29uc29sZS5sb2coJ21lc3NhZ2V1cCcsIG1lc3NhZ2UpXG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSB0aGlzLmpzRGlyVG9aaXAuZXZlbnRuYW1lcy5wZW5kaW5nOlxuICAgICAgICBidG4udGV4dENvbnRlbnQgPSBgIFBlbmRpbmcgYCArICgodGFyZ2V0ICE9PSAnemlwJykgPyAnIGJpZyBmaWxlJyA6ICcnKTtcbiAgICAgICAgYnRuLmRhdGFzZXQubWVzc2FnZSA9ICcnO1xuICAgICAgICBidG4uc2V0QXR0cmlidXRlKFwiZGlzYWJsZWRcIiwgdHJ1ZSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSB0aGlzLmpzRGlyVG9aaXAuZXZlbnRuYW1lcy5nemlwOlxuICAgICAgICB0ZXh0ID0gYGNvbXByZXNzaW5nIHNlcGFyYXRlbHkgYmlnIGZpbGUgOiR7KG9wdHMgJiYgb3B0cy5iaWdmaWxlKT9vcHRzLmJpZ2ZpbGU6YGB9ICR7KG9wdHMgJiYgb3B0cy5zaXplKT9vcHRzLnNpemU6YGB9YDtcbiAgICAgICAgYnRuLnRleHRDb250ZW50ID0gdGV4dDtcbiAgICAgICAgYnRuLnNldEF0dHJpYnV0ZShcImRpc2FibGVkXCIsIHRydWUpO1xuICAgICAgICBjb25zb2xlLmxvZygnb3B0c2JpZ2ZsJywgb3B0cylcbiAgICAgICAgYnRuLmRhdGFzZXQubWVzc2FnZSA9IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICBuYW1lOiB0aGlzLmpzRGlyVG9aaXAuZXZlbnRuYW1lcy5lbmR6aXAsXG4gICAgICAgICAgcGF0aDogKG9wdHMuaGFzT3duUHJvcGVydHkoXCJiaWdmaWxlXCIpKSA/IG9wdHMuYmlnZmlsZSA6IGUucGF0aCxcbiAgICAgICAgICBiaWdmaWxlOiAob3B0cy5oYXNPd25Qcm9wZXJ0eShcImJpZ2ZpbGVcIikgJiYgb3B0cy5iaWdmaWxlICE9PSBcIlwiKVxuICAgICAgICB9KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIHRoaXMuanNEaXJUb1ppcC5ldmVudG5hbWVzLnRlcm1pbmF0ZTpcbiAgICAgICAgY29uc29sZS5sb2coJ3Rlcm1pbmF0ZSAnICsgKCh0YXJnZXQgIT09ICd6aXAnKSA/ICdiaWdmaWxlJyA6ICcnKSk7XG4gICAgICAgIHRoaXMuc2VydmVyTGlzdCgpO1xuICAgICAgICAvL2RlZmF1bHQ6XG4gICAgICAgIGJ0bi5kYXRhc2V0Lm1lc3NhZ2UgPSBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgbmFtZTogJ3JlYWR5JyxcbiAgICAgICAgICBiaWdmaWxlOiAodGFyZ2V0ICE9PSAnemlwJylcbiAgICAgICAgfSk7XG4gICAgICAgIGJ0bi50ZXh0Q29udGVudCA9IGBFbmQhISAkeyAoKHRhcmdldCAhPT0gJ3ppcCcpID8gJ2JpZ2ZpbGUnIDogJycpfWA7XG5cbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGlmIChidG4uZGF0YXNldC5tZXNzYWdlKSBidG4uY2xhc3NMaXN0LnJlbW92ZShjc3MuaGlkZSk7XG4gIH1cbiAgZW1pdFRvWmlwKGJ0bikge1xuICAgIGNvbnN0IG1lc3NhZ2UgPSAoYnRuLmRhdGFzZXQubWVzc2FnZSkgPyBKU09OLnBhcnNlKGJ0bi5kYXRhc2V0Lm1lc3NhZ2UpIDogbnVsbDtcbiAgICBjb25zb2xlLmxvZygnbWVzc2FnZScsIG1lc3NhZ2UpXG4gICAgaWYgKCFtZXNzYWdlKSBidG4uY2xhc3NMaXN0LmFkZChjc3MuaGlkZSk7XG4gICAgaWYgKG1lc3NhZ2UpIHtcbiAgICAgIGlmIChtZXNzYWdlLm5hbWUpIHtcbiAgICAgICAgY29uc3QgbmFtZSA9IG1lc3NhZ2UubmFtZTtcbiAgICAgICAgZGVsZXRlIG1lc3NhZ2UubmFtZTtcbiAgICAgICAgY29uc29sZS5sb2coJ2VtaXQgLS0tLScgKyBuYW1lLCBtZXNzYWdlKVxuICAgICAgICB0aGlzLmpzRGlyVG9aaXAuZW1pdChuYW1lLCBtZXNzYWdlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKG5hbWUgPT09IHRoaXMuanNEaXJUb1ppcC5ldmVudG5hbWVzLnNlbmRmaWxlKSBidG4uZGlzYWJsZWQgPSB0cnVlO1xuICB9XG4gIGdldEJ0bihpdGVtLCB0YXJnZXQsIHBhcmVudCA9IG51bGwpIHtcbiAgICBjb25zdCBidG5rZXkgPSB0aGlzLm9wdGlvbnMuYnRucHJlZml4ICsgaXRlbSArIHRhcmdldDtcbiAgICBpZiAodGhpc1tidG5rZXldKSByZXR1cm4gdGhpc1tidG5rZXldO1xuICAgIGNvbnN0IGRpc3BsYXkgPSB0aGlzLm9wdGlvbnMuY29udHJvbHNbaXRlbV0uYnRuW3RhcmdldF07XG4gICAgY29uc3QgYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZGlzcGxheSk7XG4gICAgaWYgKCFidG4pIHtcbiAgICAgIHBhcmVudCA9IChwYXJlbnQpID8gcGFyZW50IDogdGhpcy5kcm9wem9uZTtcbiAgICAgIHBhcmVudC5pbnNlcnRBZGphY2VudEhUTUwoJ2JlZm9yZWVuZCcsIGA8YnV0dG9uIGlkPVwiJHtkaXNwbGF5fVwiIGNsYXNzPVwiYnV0dG9uICR7ZGlzcGxheX0gJHtsb2NhbGNzcy5tcmlnaHR9ICR7Y3NzLmhpZGV9XCI+PC9idXR0b24+YCk7XG4gICAgICB0aGlzW2J0bmtleV0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChkaXNwbGF5KTtcbiAgICAgIHRoaXNbYnRua2V5XS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jIChlKSA9PiB7XG4gICAgICAgIHRoaXMuZW1pdFRvWmlwKGUuY3VycmVudFRhcmdldCk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXNbYnRua2V5XTtcbiAgfVxuXG4gIGluaXREaXNwbGF5cygpIHtcbiAgICBjb25zb2xlLmxvZygnaW5pdGRpc3BheScsIHRoaXMub3B0aW9ucy5jb250cm9scylcbiAgICBPYmplY3QuZW50cmllcyh0aGlzLm9wdGlvbnMuY29udHJvbHMpLmZvckVhY2goKFtrZXksIGl0ZW1dLCBpKSA9PiB7XG4gICAgICB0aGlzLmluaXRGaWxlQ291bnRlcihrZXksIGl0ZW0uZGlzcGxheSwgaSk7XG4gICAgICBpZiAoaXRlbS5idG4pIHRoaXMuYWN0aXZhdGVDb250cm9scyhrZXksIGl0ZW0uYnRuKTtcbiAgICB9KTtcblxuICB9XG4gIGFjdGl2YXRlQ29udHJvbHMoa2V5LCBidG5zKSB7XG4gICAgT2JqZWN0LmtleXMoYnRucykuZm9yRWFjaCgoYnRuKSA9PiB7XG4gICAgICB0aGlzW3RoaXMub3B0aW9ucy5idG5wcmVmaXggKyBrZXkgKyBidG5dID0gdGhpcy5nZXRCdG4oa2V5LCBidG4pO1xuICAgIH0pXG5cbiAgfVxufSJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/modules/js-my-files.js\n")}}]);