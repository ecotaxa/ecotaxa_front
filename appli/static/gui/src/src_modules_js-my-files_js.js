"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["src_modules_js-my-files_js"],{"./src/modules/files/js-dirlist.js"(module,__webpack_exports__,__webpack_require__){eval("{__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   JsDirList: () => (/* binding */ JsDirList),\n/* harmony export */   dirlistOptions: () => (/* binding */ dirlistOptions)\n/* harmony export */ });\n/* harmony import */ var _modules_utils_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../modules/utils.js */ \"./src/modules/utils.js\");\n/* harmony import */ var _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../modules/modules-config.js */ \"./src/modules/modules-config.js\");\n/* harmony import */ var _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../modules/alert-box.js */ \"./src/modules/alert-box.js\");\n/* harmony import */ var _modules_module_event_emitter_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../modules/module-event-emitter.js */ \"./src/modules/module-event-emitter.js\");\n/* harmony import */ var _modules_entry_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../modules/entry.js */ \"./src/modules/entry.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_modules_alert_box_js__WEBPACK_IMPORTED_MODULE_2__, _modules_module_event_emitter_js__WEBPACK_IMPORTED_MODULE_3__, _modules_entry_js__WEBPACK_IMPORTED_MODULE_4__]);\n([_modules_alert_box_js__WEBPACK_IMPORTED_MODULE_2__, _modules_module_event_emitter_js__WEBPACK_IMPORTED_MODULE_3__, _modules_entry_js__WEBPACK_IMPORTED_MODULE_4__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\nconst filter_files = {\n  images: \"png,jpeg,jpg,gif\",\n  tsv: \"txt,tsv,zip, gzip,gz\"\n}\n// local css\n_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.intrash = 'intrash';\n// original types\nconst json_types = {\n  directory: 'D',\n  file: 'F'\n}\nconst trash_dir_name = 'trash.';\nconst dirlistOptions = {\n  api_parameters: {\n    entry: 'entry',\n    dest: 'dest',\n    rootname: 'My Files',\n  },\n  url: '/gui/files',\n  controls: {\n    scan: {\n      display: {\n        counter: 'counter',\n        size: 'size',\n      }\n    },\n    zip: {\n      btn: {\n        zip: 'makezip',\n        zipped: 'makezipped'\n      },\n      display: {\n        size: 'sizezipped',\n        counter: 'counterzipped',\n      }\n    },\n  },\n  upload: {\n    label: 'upload'\n  },\n  btnprefix: 'btn',\n  btnfilelist: null,\n  entry: {\n    draggables: [_modules_entry_js__WEBPACK_IMPORTED_MODULE_4__.entryTypes.branch, _modules_entry_js__WEBPACK_IMPORTED_MODULE_4__.entryTypes.node],\n    icons: {\n      image: 'img',\n      document: 'doc'\n    },\n  },\n  entrycontrols: {\n    selectors: {\n      typentries: '[data-typentries]',\n      hascontrols: '.has-controls',\n    },\n    controls: {\n      list: {\n        action: 'list',\n        typentries: [_modules_entry_js__WEBPACK_IMPORTED_MODULE_4__.entryTypes.branch, _modules_entry_js__WEBPACK_IMPORTED_MODULE_4__.entryTypes.root, _modules_entry_js__WEBPACK_IMPORTED_MODULE_4__.entryTypes.discard]\n      },\n      create: {\n        action: 'create',\n        text: 'new folder',\n        icon: 'icon-folder-plus',\n        typentries: [_modules_entry_js__WEBPACK_IMPORTED_MODULE_4__.entryTypes.branch, _modules_entry_js__WEBPACK_IMPORTED_MODULE_4__.entryTypes.root]\n      },\n      remove: {\n        action: 'remove',\n        text: 'delete',\n        icon: 'icon-trash',\n        typentries: [_modules_entry_js__WEBPACK_IMPORTED_MODULE_4__.entryTypes.branch, _modules_entry_js__WEBPACK_IMPORTED_MODULE_4__.entryTypes.node, _modules_entry_js__WEBPACK_IMPORTED_MODULE_4__.entryTypes.root, _modules_entry_js__WEBPACK_IMPORTED_MODULE_4__.entryTypes.discard, _modules_entry_js__WEBPACK_IMPORTED_MODULE_4__.entryTypes.discarded]\n      },\n      move: {\n        action: 'move',\n        typentries: [_modules_entry_js__WEBPACK_IMPORTED_MODULE_4__.entryTypes.branch, _modules_entry_js__WEBPACK_IMPORTED_MODULE_4__.entryTypes.node]\n      },\n      rename: {\n        action: 'rename',\n        trigger: 'dblclick',\n        typentries: [_modules_entry_js__WEBPACK_IMPORTED_MODULE_4__.entryTypes.branch, _modules_entry_js__WEBPACK_IMPORTED_MODULE_4__.entryTypes.node]\n      }\n    },\n    css: {\n      entrycontrols: 'entrycontrols',\n      entries: '.entries',\n    }\n  },\n  selectors: {\n    doupload: '.target-upload',\n    droptarget: '.droptarget',\n    dirlist: '.dirlist',\n    uploadfile: 'uploadfile',\n    displayimport: 'displayimport',\n    trigger: '.trigger',\n  },\n}\n\nfunction EntryAction(args, options) {\n  const entryaction = new _modules_entry_js__WEBPACK_IMPORTED_MODULE_4__.Entry(args, options);\n  entryaction.eventnames = {\n    attach: 'attach',\n    detach: 'detach',\n    isdiscard: 'isdiscard',\n    discarded: 'discarded',\n    editable: 'editable'\n  };\n  entryaction.newEntry = function(entry) {\n\n    return EntryAction(entry, this.options);\n  }\n  entryaction.isTrashDir = function(name = null) {\n    return ((name === null) ? this.name : name).indexOf(trash_dir_name) === 0;\n  }\n  entryaction.isInTrash = function(path = null) {\n    path = (path === null) ? this.getCurrentDirPath() : path;\n    if (path === null) (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.stop_on_error)('path_not_found');\n    path = path.split(_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.dirseparator);\n    return (path.length > 1 && path[0].indexOf(trash_dir_name)) === 0;\n  }\n  entryaction.branchListener = function(callback = null) {\n    const el = this.container;\n    if (el.dataset.action === \"create\") return;\n    this.toggleActive();\n    if (this.isActive()) this.branchActivate(callback).then(() => {\n      this.emitEvent();\n    });\n  }\n\n  entryaction.getCurrentDirPath = function() {\n    return this.getCurrentPath().join(_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.dirseparator);\n  }\n\n  entryaction.fetchAction = async function(action, callback = null, callback_error = null) {\n    const api_parameters = this.options.api_parameters;\n    const label = this.getLabelElement();\n    let entrypath = this.getCurrentDirPath();\n    if (entrypath === '' && action!==this.options.actions.remove) return;\n    const data = new FormData();\n    data.append(api_parameters.entry, entrypath);\n    switch (action) {\n      case this.options.actions.create:\n        if (label === null) return;\n        entrypath = entrypath.split(_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.dirseparator);\n        entrypath[entrypath.length - 1] = label.textContent;\n        if (entrypath !== \"\") data.set(api_parameters.entry, entrypath.join(_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.dirseparator));\n        break;\n      case this.options.actions.move:\n        // get new path - append item to drop directory\n        if (callback !== null) {\n          let destpath = callback();\n          callback = null;\n          if (destpath === entrypath) return;\n          data.append(api_parameters.dest, destpath);\n        } else return;\n        break;\n      case this.options.actions.remove:\n      if (entrypath==='') callback=() => {this.loaded=false;this.setOff();this.setOpen();}\n      break;\n      case this.options.actions.rename:\n        const destpath = entrypath.split(_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.dirseparator);\n        destpath[destpath.length - 1] = label.textContent;\n        if (destpath.join(_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.dirseparator) === entrypath)   return;\n        data.append(api_parameters.dest, destpath.join(_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.dirseparator));\n        break;\n    }\n    const response = await fetch(this.options.url + _modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.urlseparator + action, (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.fetchSettings)({\n      method: \"POST\",\n      body: data,\n    }));\n    const json = await response.json();\n    if (response.status === 200) {\n      if (callback) callback(json.message);\n      return true;\n    } else {\n      if (callback_error) {\n        callback_error(json);\n      } else {\n        if (typeof json.body === 'string') json.body = JSON.parse(json.body);\n        const detail = (json.body.detail) ? json.body.detail : json.body;\n        _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_2__.AlertBox.addAlert({\n          type: \"error\",\n          content: response.status + ' ' + json.text + ' ' + detail,\n          dismissible: true\n        })\n      }\n      return false;\n    }\n  }\n  entryaction.listenRename = function(evt = 'dblclick') {\n    const entry = this;\n    const label = entry.getLabelElement();\n    label.addEventListener(evt, (e) => {\n      label.dataset.oldname = label.textContent;\n      if (this.type === _modules_entry_js__WEBPACK_IMPORTED_MODULE_4__.entryTypes.discard) {\n        e.preventDefault();\n        return;\n      }\n      entry.setEditable();\n      (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.set_cursor_editable)(entry.label);\n    });\n    // remove editable when click on entry\n    entry.container.addEventListener('click', (e) => {\n      e.preventDefault();\n      e.stopImmediatePropagation();\n      entry.setEditable(false);\n      if (entry.container.dataset.action === entry.options.actions.create) entry.container.remove();\n    });\n  }\n  entryaction.setEditable = function(on = true) {\n    const entry = this;\n    const label = entry.getLabelElement();\n    const send_rename = async (e) => {\n      if (e.key === 'Enter') {\n        e.preventDefault();\n        if (label.dataset.oldname && label.dataset.oldname !== label.textContent) {\n          const callback = (txt) => {\n            if (txt === \"\") _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_2__.AlertBox.addMessage(label, {\n              type: 'error',\n              content: _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_2__.AlertBox.i18nmessages.exists,\n              duration: 2000,\n              dismissible:true\n            });\n            else txt = txt.split(_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.dirseparator).pop();\n            label.textContent = txt;\n            if (entry.type === _modules_entry_js__WEBPACK_IMPORTED_MODULE_4__.entryTypes.branch) entry.branchListener();\n            delete entry.container.dataset.action;\n          }\n          const action = (entry.container.dataset.action) ? entry.container.dataset.action : entry.options.actions.rename;\n          await entry.fetchAction(action, callback);\n        } else _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_2__.AlertBox.addAlert({\n        type: \"warning\",\n        content: (entry.isnew)?\"Entry not created. Modify the folder name.\":\"Name not modified. Modify the entry name.\",\n        dismissible:true\n      });\n        entry.setEditable(false);\n      }\n    }\n    if (on === true) {\n      label.contentEditable = true;\n      entry.container.draggable = false;\n      label.classList.add(entry.options.css.editable);\n      label.addEventListener('keydown', send_rename);\n    } else {\n      label.contentEditable = false;\n      label.classList.remove(entry.options.css.editable);\n      label.removeEventListener('keydown', send_rename);\n      entry.container.draggable = entry.isDraggable();\n    }\n  }\n  entryaction.getListeners = function() {\n    let listeners = [];\n    let func = (e) => {\n      e.stopImmediatePropagation();\n      this.branchListener(() => {\n        this.emitEvent(this.eventnames.attach);\n      });\n    };\n\n    if ([_modules_entry_js__WEBPACK_IMPORTED_MODULE_4__.entryTypes.root, _modules_entry_js__WEBPACK_IMPORTED_MODULE_4__.entryTypes.discard].indexOf(this.type) < 0) {\n      listeners = this.moveHandlers();\n      if (this.type === _modules_entry_js__WEBPACK_IMPORTED_MODULE_4__.entryTypes.node) {\n        func = (e) => {\n          e.stopImmediatePropagation();\n          this.toggleActive();\n          this.emitEvent();\n        }\n      } else if (this.isInTrash()) {\n        this.type = _modules_entry_js__WEBPACK_IMPORTED_MODULE_4__.entryTypes.discarded;\n      } else listeners = listeners.concat(this.dropHandlers());\n      this.listenRename();\n    } else listeners = listeners.concat(this.dropHandlers());\n    listeners.unshift({\n      name: 'click',\n      target: 'label',\n      func: func\n    });\n    return listeners;\n  }\n  entryaction.setAttributes = function(entry) {\n    // convert attributes\n    entry.type = (entry.type === json_types.directory) ? _modules_entry_js__WEBPACK_IMPORTED_MODULE_4__.entryTypes.branch : _modules_entry_js__WEBPACK_IMPORTED_MODULE_4__.entryTypes.node;\n    if (this.isTrashDir(entry.name)) entry.type = _modules_entry_js__WEBPACK_IMPORTED_MODULE_4__.entryTypes.discard;\n    entry.parent = this;\n    return entry;\n  }\n  entryaction.extraStyles = function(entry) {\n    const ext = entry.name.split('.').pop();\n    const cl = (entry.type === _modules_entry_js__WEBPACK_IMPORTED_MODULE_4__.entryTypes.node) ? (filter_files.images.split(',').indexOf(ext) >= 0) ? this.options.icons.image : this.options.icons.document : null;\n  }\n  entryaction.setDiscard = function() {\n    if (this.type === _modules_entry_js__WEBPACK_IMPORTED_MODULE_4__.entryTypes.discard) this.emitEvent(this.eventnames.isdiscard);\n  }\n\n  entryaction.getUrl = function() {\n    const subdir = (this.name) ? this.getCurrentDirPath() : null;\n    return this.options.url + _modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.urlseparator + this.options.actions.list + ((subdir) ? _modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.dirseparator + subdir : '');\n  }\n  entryaction.jsonEntries = async function(response) {\n    const json = await response.json();\n    return (json.entries) ? json.entries : undefined;\n  }\n\n  entryaction.remove = function() {\n   this.fetchAction(this.options.actions.remove).then(ret => {\n      if (ret === true) {\n        this.setParent(null);\n        this.removeListeners(this.dropHandlers());\n        this.setOff();\n        this.container.animate({\n          transform: \"translateX(-100%) scale(0)\"\n        }, {\n          duration: 1000\n        });\n        setTimeout(() => {\n           if (this.from && this.from.isInTrash()) this.destroy();\n            else if(this.isTrashDir() || this.type===_modules_entry_js__WEBPACK_IMPORTED_MODULE_4__.entryTypes.root)  this.list();\n          else this.emitEvent(this.eventnames.discarded);\n        }, 1000);\n      }\n    }).catch(error => {\n      _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_2__.AlertBox.addMessage({\n        parent: this.container,\n        type: \"error\",\n        content: (error.message)?error.message:error.error+' '+error.text,\n        dismissible:true\n      })\n    });\n  }\n  entryaction.create = function() {\n    const new_entry = this.createEntry({\n      type: json_types.directory,\n      name: 'NewFolder'\n    });\n    const create_entry=() => {\n    const entries = this.getEntriesElement();\n     // move new entry to top of the list\n    entries.prepend(new_entry.container);\n    new_entry.container.dataset.action = this.options.actions.create;\n    new_entry.isnew=true;\n    new_entry.label.dispatchEvent(new Event('dblclick'));}\n    if(!this.loaded) this.list().then(()=>{\n    this.setOpen(true);\n    create_entry();\n    }); else create_entry();\n   }\n  entryaction.rename = function() {\n    if (this.isTrashDir()) return;\n    this.fetchAction(this.options.actions.rename).then(() => {\n      console.log('renamed', this)\n    });\n  }\n\n  entryaction.move = function(dest, callback = null) {\n    if (this.isTrashDir()) return;\n    if (this.isDiscarded()) return this.remove();\n    this.fetchAction(this.options.actions.move, () => {\n      return dest.getCurrentDirPath() + _modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.dirseparator + this.name;\n    }).then(() => {\n      this.setParent(dest);\n      if (callback !== null) callback();\n    }).catch(error => {\n         _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_2__.AlertBox.addMessage({\n        parent: this.container,\n        type: \"error\",\n        content: (error.message)?error.message:error.error+' '+error.text,\n        dismissible:true\n      })\n    });\n  }\n  entryaction.setParent = function(dest) {\n    this.from = this.parent;\n    if (dest !== null) {\n      dest.entries.push(this);\n      this.parent = dest;\n      const entries = dest.getEntriesElement(true);\n      entries.append(this.container);\n    }\n    const i = this.parent.entries.indexOf(this);\n    if (i >= 0) delete this.parent.entries[i];\n    else console.log('entry not found in parent entries', this.parent);\n\n  }\n  return entryaction;\n}\n\nclass JsDirList {\n  eventnames = {\n    attach: 'attach',\n    detach: 'detach',\n    action: 'action',\n    complete: 'complete',\n    error: 'error',\n  }\n  options;\n  uuid;\n  detachcallback=null;\n  constructor(parent, options = {}) {\n    if (!parent.jsdirlist) {\n      parent = (parent instanceof HTMLElement) ? parent : document.querySelector(parent);\n      if (!parent) return;\n      this.options = { ...dirlistOptions,\n        ...options\n      };\n\n      this.options.entry = { ..._modules_entry_js__WEBPACK_IMPORTED_MODULE_4__.entryOptions,\n        ...this.options.entry,\n      };\n      this.options.entry.url = this.options.url;\n      this.container = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)(\n        this.options.entry.tags.tag, {\n          class: this.options.selectors.dirlist.substr(1)\n        }, parent);\n      // unique id to communicate ModuleEventEmitter\n      this.uuid = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.generate_uuid)();\n      this.init();\n      this.container.append(this.root.container);\n      parent.jsdirlist = this;\n    }\n    return parent.jsdirlist;\n  }\n  init() {\n    const type = _modules_entry_js__WEBPACK_IMPORTED_MODULE_4__.entryTypes.root;\n    const obj = {};\n    this.entrycontrols = (this.entrycontrols === undefined) ? (0,_modules_entry_js__WEBPACK_IMPORTED_MODULE_4__.EntryControls)(this.container, this.options.entrycontrols) : null;\n    Object.entries(this.options.entrycontrols.controls).forEach(([key, control]) => {\n      obj[key] = control.action;\n    });\n    this.options.entry.actions = obj;\n\n    const options = { ...this.options.entry,\n      ...{\n        api_parameters: this.options.api_parameters\n      }\n    };\n    options.listener = this.uuid;\n    this.root = EntryAction({\n      type: type,\n      name: '',\n      label: this.options.api_parameters.rootname,\n      class: this.options.api_parameters.rootclass\n\n    }, options);\n    this.initEvents();\n    this.root.addListeners();\n  }\n\n  initEvents(options) {\n    // events controls on entries\n    const self = this;\n    _modules_module_event_emitter_js__WEBPACK_IMPORTED_MODULE_3__.ModuleEventEmitter.on(this.options.entry.event.name, (e) => {\n      const evtnames = e.entry.eventnames;\n      switch (e.action) {\n        case evtnames.isdiscard:\n          if (this.trashdir) this.trashdir.container.remove();\n          this.trashdir = e.entry;\n          this.root.container.parentElement.insertBefore(e.entry.container, this.root.container);\n          this.root.container.append(e.entry.container);\n          break;\n        case evtnames.discarded:\n          let parent = e.entry.parent;\n          if (e.entry.isInTrash()) {\n            e.entry.container.remove();\n            parent = this.root;\n          } else {\n            e.entry.moveTo(this.trashdir);\n            e.entry.container.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.intrash);\n          }\n          this.attachControls(parent);\n          break;\n        case evtnames.attach:\n         if (this.detachcallback) this.detachcallback();\n          // no upload on trash dir\n          const type = (e.entry.isInTrash()) ? _modules_entry_js__WEBPACK_IMPORTED_MODULE_4__.entryTypes.discarded : e.entry.container.dataset.type;\n          if (type === _modules_entry_js__WEBPACK_IMPORTED_MODULE_4__.entryTypes.discard) return;\n          if (e.action === evtnames.attach && type === _modules_entry_js__WEBPACK_IMPORTED_MODULE_4__.entryTypes.discarded) return;\n          this.attachControls(e.entry);\n          break;\n        case \"dragstart\":\n          this.dragentry = this.activentry = e.entry;\n          e.entry.container.classList.add(e.entry.options.css.dragging);\n          this.detachControls();\n          break;\n        case \"dragover\":\n          if (!this.dragentry) return;\n          if (this.overitem !== e.entry.container) {\n            if (this.overitem) this.overitem.classList.remove(e.entry.options.css.dragover);\n            e.entry.container.classList.add(e.entry.options.css.dragover);\n            this.overitem = e.entry.container;\n          }\n          break;\n        case \"dragend\":\n          this.dragentry = null;\n          if (this.overitem) this.overitem.classList.remove(e.entry.options.css.dragover);\n          this.overitem = null;\n          break;\n        case \"drop\":\n          if (!this.dragentry) {\n            _modules_module_event_emitter_js__WEBPACK_IMPORTED_MODULE_3__.ModuleEventEmitter.emit(this.eventnames.action, e, this.uuid);\n          }\n          const dest_entry = e.entry;\n          dest_entry.resetDragOver();\n          if (this.dragentry) {\n            if (this.dragentry.options.actions.move) {\n              try {\n                this.dragentry.move(dest_entry);\n                if ([_modules_entry_js__WEBPACK_IMPORTED_MODULE_4__.entryTypes.discarded].indexOf(dest_entry.type) >= 0) this.attachControls(dest_entry);\n              } catch (error) {\n                console.log('error drop ', error)\n                this.dragentry.unMove();\n              }\n            } else console.log('no action on drop');\n          }\n          break;\n        case evtnames.editable:\n          if (this.editable) this.editable.setEditable(false);\n          break;\n\n        default:\n          if (e.entry.active) {\n            this.attachControls(e.entry);\n          } else this.attachControls(this.root);\n          break;\n      }\n    }, this.uuid);\n  }\n  getActiventry() {\n    return this.activentry;\n  }\n  setActiventry(entry = null) {\n    this.activentry = entry;\n  }\n  attachControls(entry) {\n    if (this.entrycontrols) this.entrycontrols.attachControls(entry);\n    this.activentry = entry;\n    _modules_module_event_emitter_js__WEBPACK_IMPORTED_MODULE_3__.ModuleEventEmitter.emit(this.eventnames.attach, {\n      entry: this.activentry\n    }, this.uuid);\n  }\n\n  detachControls() {\n    const dest = (this.activentry) ? ((this.activentry.parent) ? this.activentry.parent : this.root) : this.root;\n    if (this.entrycontrols) this.entrycontrols.attachControls(dest);\n    this.activentry = dest;\n    _modules_module_event_emitter_js__WEBPACK_IMPORTED_MODULE_3__.ModuleEventEmitter.emit(this.eventnames.attach, {\n      entry: dest\n    }, this.uuid);\n  }\n}\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksZ0ZBQWtCO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCLHlEQUFVO0FBQy9CLGdCQUFnQjtBQUNoQjtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUksZ0ZBQWtCO0FBQ3RCO0FBQ0EsS0FBSztBQUNMOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSSxnRkFBa0I7QUFDdEI7QUFDQSxLQUFLO0FBQ0w7QUFDQSxDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vc3JjL21vZHVsZXMvZmlsZXMvanMtZGlybGlzdC5qcz8yM2M1Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIGRvbV9wdXJpZnksXG4gIGZldGNoU2V0dGluZ3MsXG4gIGNyZWF0ZV9ib3gsXG4gIGRpcnNlcGFyYXRvcixcbiAgdXJsc2VwYXJhdG9yLFxuICBzdG9wX29uX2Vycm9yLFxuICBnZW5lcmF0ZV91dWlkLFxuICBzZXRfY3Vyc29yX2VkaXRhYmxlXG59XG5mcm9tICcuLi8uLi9tb2R1bGVzL3V0aWxzLmpzJztcbmltcG9ydCB7XG4gIGNzcyxcbn0gZnJvbSAnLi4vLi4vbW9kdWxlcy9tb2R1bGVzLWNvbmZpZy5qcyc7XG5pbXBvcnQge1xuICBBbGVydEJveFxufSBmcm9tICcuLi8uLi9tb2R1bGVzL2FsZXJ0LWJveC5qcyc7XG5pbXBvcnQge1xuICBNb2R1bGVFdmVudEVtaXR0ZXIsXG59IGZyb20gJy4uLy4uL21vZHVsZXMvbW9kdWxlLWV2ZW50LWVtaXR0ZXIuanMnO1xuaW1wb3J0IHtcbiAgZW50cnlUeXBlcyxcbiAgZW50cnlPcHRpb25zLFxuICBFbnRyeSxcbiAgRW50cnlDb250cm9sc1xufSBmcm9tICcuLi8uLi9tb2R1bGVzL2VudHJ5LmpzJztcbmNvbnN0IGZpbHRlcl9maWxlcyA9IHtcbiAgaW1hZ2VzOiBcInBuZyxqcGVnLGpwZyxnaWZcIixcbiAgdHN2OiBcInR4dCx0c3YsemlwLCBnemlwLGd6XCJcbn1cbi8vIGxvY2FsIGNzc1xuY3NzLmludHJhc2ggPSAnaW50cmFzaCc7XG4vLyBvcmlnaW5hbCB0eXBlc1xuY29uc3QganNvbl90eXBlcyA9IHtcbiAgZGlyZWN0b3J5OiAnRCcsXG4gIGZpbGU6ICdGJ1xufVxuY29uc3QgdHJhc2hfZGlyX25hbWUgPSAndHJhc2guJztcbmV4cG9ydCBjb25zdCBkaXJsaXN0T3B0aW9ucyA9IHtcbiAgYXBpX3BhcmFtZXRlcnM6IHtcbiAgICBlbnRyeTogJ2VudHJ5JyxcbiAgICBkZXN0OiAnZGVzdCcsXG4gICAgcm9vdG5hbWU6ICdNeSBGaWxlcycsXG4gIH0sXG4gIHVybDogJy9ndWkvZmlsZXMnLFxuICBjb250cm9sczoge1xuICAgIHNjYW46IHtcbiAgICAgIGRpc3BsYXk6IHtcbiAgICAgICAgY291bnRlcjogJ2NvdW50ZXInLFxuICAgICAgICBzaXplOiAnc2l6ZScsXG4gICAgICB9XG4gICAgfSxcbiAgICB6aXA6IHtcbiAgICAgIGJ0bjoge1xuICAgICAgICB6aXA6ICdtYWtlemlwJyxcbiAgICAgICAgemlwcGVkOiAnbWFrZXppcHBlZCdcbiAgICAgIH0sXG4gICAgICBkaXNwbGF5OiB7XG4gICAgICAgIHNpemU6ICdzaXplemlwcGVkJyxcbiAgICAgICAgY291bnRlcjogJ2NvdW50ZXJ6aXBwZWQnLFxuICAgICAgfVxuICAgIH0sXG4gIH0sXG4gIHVwbG9hZDoge1xuICAgIGxhYmVsOiAndXBsb2FkJ1xuICB9LFxuICBidG5wcmVmaXg6ICdidG4nLFxuICBidG5maWxlbGlzdDogbnVsbCxcbiAgZW50cnk6IHtcbiAgICBkcmFnZ2FibGVzOiBbZW50cnlUeXBlcy5icmFuY2gsIGVudHJ5VHlwZXMubm9kZV0sXG4gICAgaWNvbnM6IHtcbiAgICAgIGltYWdlOiAnaW1nJyxcbiAgICAgIGRvY3VtZW50OiAnZG9jJ1xuICAgIH0sXG4gIH0sXG4gIGVudHJ5Y29udHJvbHM6IHtcbiAgICBzZWxlY3RvcnM6IHtcbiAgICAgIHR5cGVudHJpZXM6ICdbZGF0YS10eXBlbnRyaWVzXScsXG4gICAgICBoYXNjb250cm9sczogJy5oYXMtY29udHJvbHMnLFxuICAgIH0sXG4gICAgY29udHJvbHM6IHtcbiAgICAgIGxpc3Q6IHtcbiAgICAgICAgYWN0aW9uOiAnbGlzdCcsXG4gICAgICAgIHR5cGVudHJpZXM6IFtlbnRyeVR5cGVzLmJyYW5jaCwgZW50cnlUeXBlcy5yb290LCBlbnRyeVR5cGVzLmRpc2NhcmRdXG4gICAgICB9LFxuICAgICAgY3JlYXRlOiB7XG4gICAgICAgIGFjdGlvbjogJ2NyZWF0ZScsXG4gICAgICAgIHRleHQ6ICduZXcgZm9sZGVyJyxcbiAgICAgICAgaWNvbjogJ2ljb24tZm9sZGVyLXBsdXMnLFxuICAgICAgICB0eXBlbnRyaWVzOiBbZW50cnlUeXBlcy5icmFuY2gsIGVudHJ5VHlwZXMucm9vdF1cbiAgICAgIH0sXG4gICAgICByZW1vdmU6IHtcbiAgICAgICAgYWN0aW9uOiAncmVtb3ZlJyxcbiAgICAgICAgdGV4dDogJ2RlbGV0ZScsXG4gICAgICAgIGljb246ICdpY29uLXRyYXNoJyxcbiAgICAgICAgdHlwZW50cmllczogW2VudHJ5VHlwZXMuYnJhbmNoLCBlbnRyeVR5cGVzLm5vZGUsIGVudHJ5VHlwZXMucm9vdCwgZW50cnlUeXBlcy5kaXNjYXJkLCBlbnRyeVR5cGVzLmRpc2NhcmRlZF1cbiAgICAgIH0sXG4gICAgICBtb3ZlOiB7XG4gICAgICAgIGFjdGlvbjogJ21vdmUnLFxuICAgICAgICB0eXBlbnRyaWVzOiBbZW50cnlUeXBlcy5icmFuY2gsIGVudHJ5VHlwZXMubm9kZV1cbiAgICAgIH0sXG4gICAgICByZW5hbWU6IHtcbiAgICAgICAgYWN0aW9uOiAncmVuYW1lJyxcbiAgICAgICAgdHJpZ2dlcjogJ2RibGNsaWNrJyxcbiAgICAgICAgdHlwZW50cmllczogW2VudHJ5VHlwZXMuYnJhbmNoLCBlbnRyeVR5cGVzLm5vZGVdXG4gICAgICB9XG4gICAgfSxcbiAgICBjc3M6IHtcbiAgICAgIGVudHJ5Y29udHJvbHM6ICdlbnRyeWNvbnRyb2xzJyxcbiAgICAgIGVudHJpZXM6ICcuZW50cmllcycsXG4gICAgfVxuICB9LFxuICBzZWxlY3RvcnM6IHtcbiAgICBkb3VwbG9hZDogJy50YXJnZXQtdXBsb2FkJyxcbiAgICBkcm9wdGFyZ2V0OiAnLmRyb3B0YXJnZXQnLFxuICAgIGRpcmxpc3Q6ICcuZGlybGlzdCcsXG4gICAgdXBsb2FkZmlsZTogJ3VwbG9hZGZpbGUnLFxuICAgIGRpc3BsYXlpbXBvcnQ6ICdkaXNwbGF5aW1wb3J0JyxcbiAgICB0cmlnZ2VyOiAnLnRyaWdnZXInLFxuICB9LFxufVxuXG5mdW5jdGlvbiBFbnRyeUFjdGlvbihhcmdzLCBvcHRpb25zKSB7XG4gIGNvbnN0IGVudHJ5YWN0aW9uID0gbmV3IEVudHJ5KGFyZ3MsIG9wdGlvbnMpO1xuICBlbnRyeWFjdGlvbi5ldmVudG5hbWVzID0ge1xuICAgIGF0dGFjaDogJ2F0dGFjaCcsXG4gICAgZGV0YWNoOiAnZGV0YWNoJyxcbiAgICBpc2Rpc2NhcmQ6ICdpc2Rpc2NhcmQnLFxuICAgIGRpc2NhcmRlZDogJ2Rpc2NhcmRlZCcsXG4gICAgZWRpdGFibGU6ICdlZGl0YWJsZSdcbiAgfTtcbiAgZW50cnlhY3Rpb24ubmV3RW50cnkgPSBmdW5jdGlvbihlbnRyeSkge1xuXG4gICAgcmV0dXJuIEVudHJ5QWN0aW9uKGVudHJ5LCB0aGlzLm9wdGlvbnMpO1xuICB9XG4gIGVudHJ5YWN0aW9uLmlzVHJhc2hEaXIgPSBmdW5jdGlvbihuYW1lID0gbnVsbCkge1xuICAgIHJldHVybiAoKG5hbWUgPT09IG51bGwpID8gdGhpcy5uYW1lIDogbmFtZSkuaW5kZXhPZih0cmFzaF9kaXJfbmFtZSkgPT09IDA7XG4gIH1cbiAgZW50cnlhY3Rpb24uaXNJblRyYXNoID0gZnVuY3Rpb24ocGF0aCA9IG51bGwpIHtcbiAgICBwYXRoID0gKHBhdGggPT09IG51bGwpID8gdGhpcy5nZXRDdXJyZW50RGlyUGF0aCgpIDogcGF0aDtcbiAgICBpZiAocGF0aCA9PT0gbnVsbCkgc3RvcF9vbl9lcnJvcigncGF0aF9ub3RfZm91bmQnKTtcbiAgICBwYXRoID0gcGF0aC5zcGxpdChkaXJzZXBhcmF0b3IpO1xuICAgIHJldHVybiAocGF0aC5sZW5ndGggPiAxICYmIHBhdGhbMF0uaW5kZXhPZih0cmFzaF9kaXJfbmFtZSkpID09PSAwO1xuICB9XG4gIGVudHJ5YWN0aW9uLmJyYW5jaExpc3RlbmVyID0gZnVuY3Rpb24oY2FsbGJhY2sgPSBudWxsKSB7XG4gICAgY29uc3QgZWwgPSB0aGlzLmNvbnRhaW5lcjtcbiAgICBpZiAoZWwuZGF0YXNldC5hY3Rpb24gPT09IFwiY3JlYXRlXCIpIHJldHVybjtcbiAgICB0aGlzLnRvZ2dsZUFjdGl2ZSgpO1xuICAgIGlmICh0aGlzLmlzQWN0aXZlKCkpIHRoaXMuYnJhbmNoQWN0aXZhdGUoY2FsbGJhY2spLnRoZW4oKCkgPT4ge1xuICAgICAgdGhpcy5lbWl0RXZlbnQoKTtcbiAgICB9KTtcbiAgfVxuXG4gIGVudHJ5YWN0aW9uLmdldEN1cnJlbnREaXJQYXRoID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0Q3VycmVudFBhdGgoKS5qb2luKGRpcnNlcGFyYXRvcik7XG4gIH1cblxuICBlbnRyeWFjdGlvbi5mZXRjaEFjdGlvbiA9IGFzeW5jIGZ1bmN0aW9uKGFjdGlvbiwgY2FsbGJhY2sgPSBudWxsLCBjYWxsYmFja19lcnJvciA9IG51bGwpIHtcbiAgICBjb25zdCBhcGlfcGFyYW1ldGVycyA9IHRoaXMub3B0aW9ucy5hcGlfcGFyYW1ldGVycztcbiAgICBjb25zdCBsYWJlbCA9IHRoaXMuZ2V0TGFiZWxFbGVtZW50KCk7XG4gICAgbGV0IGVudHJ5cGF0aCA9IHRoaXMuZ2V0Q3VycmVudERpclBhdGgoKTtcbiAgICBpZiAoZW50cnlwYXRoID09PSAnJyAmJiBhY3Rpb24hPT10aGlzLm9wdGlvbnMuYWN0aW9ucy5yZW1vdmUpIHJldHVybjtcbiAgICBjb25zdCBkYXRhID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgZGF0YS5hcHBlbmQoYXBpX3BhcmFtZXRlcnMuZW50cnksIGVudHJ5cGF0aCk7XG4gICAgc3dpdGNoIChhY3Rpb24pIHtcbiAgICAgIGNhc2UgdGhpcy5vcHRpb25zLmFjdGlvbnMuY3JlYXRlOlxuICAgICAgICBpZiAobGFiZWwgPT09IG51bGwpIHJldHVybjtcbiAgICAgICAgZW50cnlwYXRoID0gZW50cnlwYXRoLnNwbGl0KGRpcnNlcGFyYXRvcik7XG4gICAgICAgIGVudHJ5cGF0aFtlbnRyeXBhdGgubGVuZ3RoIC0gMV0gPSBsYWJlbC50ZXh0Q29udGVudDtcbiAgICAgICAgaWYgKGVudHJ5cGF0aCAhPT0gXCJcIikgZGF0YS5zZXQoYXBpX3BhcmFtZXRlcnMuZW50cnksIGVudHJ5cGF0aC5qb2luKGRpcnNlcGFyYXRvcikpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgdGhpcy5vcHRpb25zLmFjdGlvbnMubW92ZTpcbiAgICAgICAgLy8gZ2V0IG5ldyBwYXRoIC0gYXBwZW5kIGl0ZW0gdG8gZHJvcCBkaXJlY3RvcnlcbiAgICAgICAgaWYgKGNhbGxiYWNrICE9PSBudWxsKSB7XG4gICAgICAgICAgbGV0IGRlc3RwYXRoID0gY2FsbGJhY2soKTtcbiAgICAgICAgICBjYWxsYmFjayA9IG51bGw7XG4gICAgICAgICAgaWYgKGRlc3RwYXRoID09PSBlbnRyeXBhdGgpIHJldHVybjtcbiAgICAgICAgICBkYXRhLmFwcGVuZChhcGlfcGFyYW1ldGVycy5kZXN0LCBkZXN0cGF0aCk7XG4gICAgICAgIH0gZWxzZSByZXR1cm47XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSB0aGlzLm9wdGlvbnMuYWN0aW9ucy5yZW1vdmU6XG4gICAgICBpZiAoZW50cnlwYXRoPT09JycpIGNhbGxiYWNrPSgpID0+IHt0aGlzLmxvYWRlZD1mYWxzZTt0aGlzLnNldE9mZigpO3RoaXMuc2V0T3BlbigpO31cbiAgICAgIGJyZWFrO1xuICAgICAgY2FzZSB0aGlzLm9wdGlvbnMuYWN0aW9ucy5yZW5hbWU6XG4gICAgICAgIGNvbnN0IGRlc3RwYXRoID0gZW50cnlwYXRoLnNwbGl0KGRpcnNlcGFyYXRvcik7XG4gICAgICAgIGRlc3RwYXRoW2Rlc3RwYXRoLmxlbmd0aCAtIDFdID0gbGFiZWwudGV4dENvbnRlbnQ7XG4gICAgICAgIGlmIChkZXN0cGF0aC5qb2luKGRpcnNlcGFyYXRvcikgPT09IGVudHJ5cGF0aCkgICByZXR1cm47XG4gICAgICAgIGRhdGEuYXBwZW5kKGFwaV9wYXJhbWV0ZXJzLmRlc3QsIGRlc3RwYXRoLmpvaW4oZGlyc2VwYXJhdG9yKSk7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHRoaXMub3B0aW9ucy51cmwgKyB1cmxzZXBhcmF0b3IgKyBhY3Rpb24sIGZldGNoU2V0dGluZ3Moe1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGJvZHk6IGRhdGEsXG4gICAgfSkpO1xuICAgIGNvbnN0IGpzb24gPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICBpZiAoY2FsbGJhY2spIGNhbGxiYWNrKGpzb24ubWVzc2FnZSk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGNhbGxiYWNrX2Vycm9yKSB7XG4gICAgICAgIGNhbGxiYWNrX2Vycm9yKGpzb24pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKHR5cGVvZiBqc29uLmJvZHkgPT09ICdzdHJpbmcnKSBqc29uLmJvZHkgPSBKU09OLnBhcnNlKGpzb24uYm9keSk7XG4gICAgICAgIGNvbnN0IGRldGFpbCA9IChqc29uLmJvZHkuZGV0YWlsKSA/IGpzb24uYm9keS5kZXRhaWwgOiBqc29uLmJvZHk7XG4gICAgICAgIEFsZXJ0Qm94LmFkZEFsZXJ0KHtcbiAgICAgICAgICB0eXBlOiBcImVycm9yXCIsXG4gICAgICAgICAgY29udGVudDogcmVzcG9uc2Uuc3RhdHVzICsgJyAnICsganNvbi50ZXh0ICsgJyAnICsgZGV0YWlsLFxuICAgICAgICAgIGRpc21pc3NpYmxlOiB0cnVlXG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG4gIGVudHJ5YWN0aW9uLmxpc3RlblJlbmFtZSA9IGZ1bmN0aW9uKGV2dCA9ICdkYmxjbGljaycpIHtcbiAgICBjb25zdCBlbnRyeSA9IHRoaXM7XG4gICAgY29uc3QgbGFiZWwgPSBlbnRyeS5nZXRMYWJlbEVsZW1lbnQoKTtcbiAgICBsYWJlbC5hZGRFdmVudExpc3RlbmVyKGV2dCwgKGUpID0+IHtcbiAgICAgIGxhYmVsLmRhdGFzZXQub2xkbmFtZSA9IGxhYmVsLnRleHRDb250ZW50O1xuICAgICAgaWYgKHRoaXMudHlwZSA9PT0gZW50cnlUeXBlcy5kaXNjYXJkKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgZW50cnkuc2V0RWRpdGFibGUoKTtcbiAgICAgIHNldF9jdXJzb3JfZWRpdGFibGUoZW50cnkubGFiZWwpO1xuICAgIH0pO1xuICAgIC8vIHJlbW92ZSBlZGl0YWJsZSB3aGVuIGNsaWNrIG9uIGVudHJ5XG4gICAgZW50cnkuY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG4gICAgICBlbnRyeS5zZXRFZGl0YWJsZShmYWxzZSk7XG4gICAgICBpZiAoZW50cnkuY29udGFpbmVyLmRhdGFzZXQuYWN0aW9uID09PSBlbnRyeS5vcHRpb25zLmFjdGlvbnMuY3JlYXRlKSBlbnRyeS5jb250YWluZXIucmVtb3ZlKCk7XG4gICAgfSk7XG4gIH1cbiAgZW50cnlhY3Rpb24uc2V0RWRpdGFibGUgPSBmdW5jdGlvbihvbiA9IHRydWUpIHtcbiAgICBjb25zdCBlbnRyeSA9IHRoaXM7XG4gICAgY29uc3QgbGFiZWwgPSBlbnRyeS5nZXRMYWJlbEVsZW1lbnQoKTtcbiAgICBjb25zdCBzZW5kX3JlbmFtZSA9IGFzeW5jIChlKSA9PiB7XG4gICAgICBpZiAoZS5rZXkgPT09ICdFbnRlcicpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBpZiAobGFiZWwuZGF0YXNldC5vbGRuYW1lICYmIGxhYmVsLmRhdGFzZXQub2xkbmFtZSAhPT0gbGFiZWwudGV4dENvbnRlbnQpIHtcbiAgICAgICAgICBjb25zdCBjYWxsYmFjayA9ICh0eHQpID0+IHtcbiAgICAgICAgICAgIGlmICh0eHQgPT09IFwiXCIpIEFsZXJ0Qm94LmFkZE1lc3NhZ2UobGFiZWwsIHtcbiAgICAgICAgICAgICAgdHlwZTogJ2Vycm9yJyxcbiAgICAgICAgICAgICAgY29udGVudDogQWxlcnRCb3guaTE4bm1lc3NhZ2VzLmV4aXN0cyxcbiAgICAgICAgICAgICAgZHVyYXRpb246IDIwMDAsXG4gICAgICAgICAgICAgIGRpc21pc3NpYmxlOnRydWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZWxzZSB0eHQgPSB0eHQuc3BsaXQoZGlyc2VwYXJhdG9yKS5wb3AoKTtcbiAgICAgICAgICAgIGxhYmVsLnRleHRDb250ZW50ID0gdHh0O1xuICAgICAgICAgICAgaWYgKGVudHJ5LnR5cGUgPT09IGVudHJ5VHlwZXMuYnJhbmNoKSBlbnRyeS5icmFuY2hMaXN0ZW5lcigpO1xuICAgICAgICAgICAgZGVsZXRlIGVudHJ5LmNvbnRhaW5lci5kYXRhc2V0LmFjdGlvbjtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3QgYWN0aW9uID0gKGVudHJ5LmNvbnRhaW5lci5kYXRhc2V0LmFjdGlvbikgPyBlbnRyeS5jb250YWluZXIuZGF0YXNldC5hY3Rpb24gOiBlbnRyeS5vcHRpb25zLmFjdGlvbnMucmVuYW1lO1xuICAgICAgICAgIGF3YWl0IGVudHJ5LmZldGNoQWN0aW9uKGFjdGlvbiwgY2FsbGJhY2spO1xuICAgICAgICB9IGVsc2UgQWxlcnRCb3guYWRkQWxlcnQoe1xuICAgICAgICB0eXBlOiBcIndhcm5pbmdcIixcbiAgICAgICAgY29udGVudDogKGVudHJ5LmlzbmV3KT9cIkVudHJ5IG5vdCBjcmVhdGVkLiBNb2RpZnkgdGhlIGZvbGRlciBuYW1lLlwiOlwiTmFtZSBub3QgbW9kaWZpZWQuIE1vZGlmeSB0aGUgZW50cnkgbmFtZS5cIixcbiAgICAgICAgZGlzbWlzc2libGU6dHJ1ZVxuICAgICAgfSk7XG4gICAgICAgIGVudHJ5LnNldEVkaXRhYmxlKGZhbHNlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKG9uID09PSB0cnVlKSB7XG4gICAgICBsYWJlbC5jb250ZW50RWRpdGFibGUgPSB0cnVlO1xuICAgICAgZW50cnkuY29udGFpbmVyLmRyYWdnYWJsZSA9IGZhbHNlO1xuICAgICAgbGFiZWwuY2xhc3NMaXN0LmFkZChlbnRyeS5vcHRpb25zLmNzcy5lZGl0YWJsZSk7XG4gICAgICBsYWJlbC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgc2VuZF9yZW5hbWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBsYWJlbC5jb250ZW50RWRpdGFibGUgPSBmYWxzZTtcbiAgICAgIGxhYmVsLmNsYXNzTGlzdC5yZW1vdmUoZW50cnkub3B0aW9ucy5jc3MuZWRpdGFibGUpO1xuICAgICAgbGFiZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHNlbmRfcmVuYW1lKTtcbiAgICAgIGVudHJ5LmNvbnRhaW5lci5kcmFnZ2FibGUgPSBlbnRyeS5pc0RyYWdnYWJsZSgpO1xuICAgIH1cbiAgfVxuICBlbnRyeWFjdGlvbi5nZXRMaXN0ZW5lcnMgPSBmdW5jdGlvbigpIHtcbiAgICBsZXQgbGlzdGVuZXJzID0gW107XG4gICAgbGV0IGZ1bmMgPSAoZSkgPT4ge1xuICAgICAgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcbiAgICAgIHRoaXMuYnJhbmNoTGlzdGVuZXIoKCkgPT4ge1xuICAgICAgICB0aGlzLmVtaXRFdmVudCh0aGlzLmV2ZW50bmFtZXMuYXR0YWNoKTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICBpZiAoW2VudHJ5VHlwZXMucm9vdCwgZW50cnlUeXBlcy5kaXNjYXJkXS5pbmRleE9mKHRoaXMudHlwZSkgPCAwKSB7XG4gICAgICBsaXN0ZW5lcnMgPSB0aGlzLm1vdmVIYW5kbGVycygpO1xuICAgICAgaWYgKHRoaXMudHlwZSA9PT0gZW50cnlUeXBlcy5ub2RlKSB7XG4gICAgICAgIGZ1bmMgPSAoZSkgPT4ge1xuICAgICAgICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgdGhpcy50b2dnbGVBY3RpdmUoKTtcbiAgICAgICAgICB0aGlzLmVtaXRFdmVudCgpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHRoaXMuaXNJblRyYXNoKCkpIHtcbiAgICAgICAgdGhpcy50eXBlID0gZW50cnlUeXBlcy5kaXNjYXJkZWQ7XG4gICAgICB9IGVsc2UgbGlzdGVuZXJzID0gbGlzdGVuZXJzLmNvbmNhdCh0aGlzLmRyb3BIYW5kbGVycygpKTtcbiAgICAgIHRoaXMubGlzdGVuUmVuYW1lKCk7XG4gICAgfSBlbHNlIGxpc3RlbmVycyA9IGxpc3RlbmVycy5jb25jYXQodGhpcy5kcm9wSGFuZGxlcnMoKSk7XG4gICAgbGlzdGVuZXJzLnVuc2hpZnQoe1xuICAgICAgbmFtZTogJ2NsaWNrJyxcbiAgICAgIHRhcmdldDogJ2xhYmVsJyxcbiAgICAgIGZ1bmM6IGZ1bmNcbiAgICB9KTtcbiAgICByZXR1cm4gbGlzdGVuZXJzO1xuICB9XG4gIGVudHJ5YWN0aW9uLnNldEF0dHJpYnV0ZXMgPSBmdW5jdGlvbihlbnRyeSkge1xuICAgIC8vIGNvbnZlcnQgYXR0cmlidXRlc1xuICAgIGVudHJ5LnR5cGUgPSAoZW50cnkudHlwZSA9PT0ganNvbl90eXBlcy5kaXJlY3RvcnkpID8gZW50cnlUeXBlcy5icmFuY2ggOiBlbnRyeVR5cGVzLm5vZGU7XG4gICAgaWYgKHRoaXMuaXNUcmFzaERpcihlbnRyeS5uYW1lKSkgZW50cnkudHlwZSA9IGVudHJ5VHlwZXMuZGlzY2FyZDtcbiAgICBlbnRyeS5wYXJlbnQgPSB0aGlzO1xuICAgIHJldHVybiBlbnRyeTtcbiAgfVxuICBlbnRyeWFjdGlvbi5leHRyYVN0eWxlcyA9IGZ1bmN0aW9uKGVudHJ5KSB7XG4gICAgY29uc3QgZXh0ID0gZW50cnkubmFtZS5zcGxpdCgnLicpLnBvcCgpO1xuICAgIGNvbnN0IGNsID0gKGVudHJ5LnR5cGUgPT09IGVudHJ5VHlwZXMubm9kZSkgPyAoZmlsdGVyX2ZpbGVzLmltYWdlcy5zcGxpdCgnLCcpLmluZGV4T2YoZXh0KSA+PSAwKSA/IHRoaXMub3B0aW9ucy5pY29ucy5pbWFnZSA6IHRoaXMub3B0aW9ucy5pY29ucy5kb2N1bWVudCA6IG51bGw7XG4gIH1cbiAgZW50cnlhY3Rpb24uc2V0RGlzY2FyZCA9IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLnR5cGUgPT09IGVudHJ5VHlwZXMuZGlzY2FyZCkgdGhpcy5lbWl0RXZlbnQodGhpcy5ldmVudG5hbWVzLmlzZGlzY2FyZCk7XG4gIH1cblxuICBlbnRyeWFjdGlvbi5nZXRVcmwgPSBmdW5jdGlvbigpIHtcbiAgICBjb25zdCBzdWJkaXIgPSAodGhpcy5uYW1lKSA/IHRoaXMuZ2V0Q3VycmVudERpclBhdGgoKSA6IG51bGw7XG4gICAgcmV0dXJuIHRoaXMub3B0aW9ucy51cmwgKyB1cmxzZXBhcmF0b3IgKyB0aGlzLm9wdGlvbnMuYWN0aW9ucy5saXN0ICsgKChzdWJkaXIpID8gZGlyc2VwYXJhdG9yICsgc3ViZGlyIDogJycpO1xuICB9XG4gIGVudHJ5YWN0aW9uLmpzb25FbnRyaWVzID0gYXN5bmMgZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICBjb25zdCBqc29uID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgIHJldHVybiAoanNvbi5lbnRyaWVzKSA/IGpzb24uZW50cmllcyA6IHVuZGVmaW5lZDtcbiAgfVxuXG4gIGVudHJ5YWN0aW9uLnJlbW92ZSA9IGZ1bmN0aW9uKCkge1xuICAgdGhpcy5mZXRjaEFjdGlvbih0aGlzLm9wdGlvbnMuYWN0aW9ucy5yZW1vdmUpLnRoZW4ocmV0ID0+IHtcbiAgICAgIGlmIChyZXQgPT09IHRydWUpIHtcbiAgICAgICAgdGhpcy5zZXRQYXJlbnQobnVsbCk7XG4gICAgICAgIHRoaXMucmVtb3ZlTGlzdGVuZXJzKHRoaXMuZHJvcEhhbmRsZXJzKCkpO1xuICAgICAgICB0aGlzLnNldE9mZigpO1xuICAgICAgICB0aGlzLmNvbnRhaW5lci5hbmltYXRlKHtcbiAgICAgICAgICB0cmFuc2Zvcm06IFwidHJhbnNsYXRlWCgtMTAwJSkgc2NhbGUoMClcIlxuICAgICAgICB9LCB7XG4gICAgICAgICAgZHVyYXRpb246IDEwMDBcbiAgICAgICAgfSk7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICBpZiAodGhpcy5mcm9tICYmIHRoaXMuZnJvbS5pc0luVHJhc2goKSkgdGhpcy5kZXN0cm95KCk7XG4gICAgICAgICAgICBlbHNlIGlmKHRoaXMuaXNUcmFzaERpcigpIHx8IHRoaXMudHlwZT09PWVudHJ5VHlwZXMucm9vdCkgIHRoaXMubGlzdCgpO1xuICAgICAgICAgIGVsc2UgdGhpcy5lbWl0RXZlbnQodGhpcy5ldmVudG5hbWVzLmRpc2NhcmRlZCk7XG4gICAgICAgIH0sIDEwMDApO1xuICAgICAgfVxuICAgIH0pLmNhdGNoKGVycm9yID0+IHtcbiAgICAgIEFsZXJ0Qm94LmFkZE1lc3NhZ2Uoe1xuICAgICAgICBwYXJlbnQ6IHRoaXMuY29udGFpbmVyLFxuICAgICAgICB0eXBlOiBcImVycm9yXCIsXG4gICAgICAgIGNvbnRlbnQ6IChlcnJvci5tZXNzYWdlKT9lcnJvci5tZXNzYWdlOmVycm9yLmVycm9yKycgJytlcnJvci50ZXh0LFxuICAgICAgICBkaXNtaXNzaWJsZTp0cnVlXG4gICAgICB9KVxuICAgIH0pO1xuICB9XG4gIGVudHJ5YWN0aW9uLmNyZWF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgIGNvbnN0IG5ld19lbnRyeSA9IHRoaXMuY3JlYXRlRW50cnkoe1xuICAgICAgdHlwZToganNvbl90eXBlcy5kaXJlY3RvcnksXG4gICAgICBuYW1lOiAnTmV3Rm9sZGVyJ1xuICAgIH0pO1xuICAgIGNvbnN0IGNyZWF0ZV9lbnRyeT0oKSA9PiB7XG4gICAgY29uc3QgZW50cmllcyA9IHRoaXMuZ2V0RW50cmllc0VsZW1lbnQoKTtcbiAgICAgLy8gbW92ZSBuZXcgZW50cnkgdG8gdG9wIG9mIHRoZSBsaXN0XG4gICAgZW50cmllcy5wcmVwZW5kKG5ld19lbnRyeS5jb250YWluZXIpO1xuICAgIG5ld19lbnRyeS5jb250YWluZXIuZGF0YXNldC5hY3Rpb24gPSB0aGlzLm9wdGlvbnMuYWN0aW9ucy5jcmVhdGU7XG4gICAgbmV3X2VudHJ5LmlzbmV3PXRydWU7XG4gICAgbmV3X2VudHJ5LmxhYmVsLmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCdkYmxjbGljaycpKTt9XG4gICAgaWYoIXRoaXMubG9hZGVkKSB0aGlzLmxpc3QoKS50aGVuKCgpPT57XG4gICAgdGhpcy5zZXRPcGVuKHRydWUpO1xuICAgIGNyZWF0ZV9lbnRyeSgpO1xuICAgIH0pOyBlbHNlIGNyZWF0ZV9lbnRyeSgpO1xuICAgfVxuICBlbnRyeWFjdGlvbi5yZW5hbWUgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5pc1RyYXNoRGlyKCkpIHJldHVybjtcbiAgICB0aGlzLmZldGNoQWN0aW9uKHRoaXMub3B0aW9ucy5hY3Rpb25zLnJlbmFtZSkudGhlbigoKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZygncmVuYW1lZCcsIHRoaXMpXG4gICAgfSk7XG4gIH1cblxuICBlbnRyeWFjdGlvbi5tb3ZlID0gZnVuY3Rpb24oZGVzdCwgY2FsbGJhY2sgPSBudWxsKSB7XG4gICAgaWYgKHRoaXMuaXNUcmFzaERpcigpKSByZXR1cm47XG4gICAgaWYgKHRoaXMuaXNEaXNjYXJkZWQoKSkgcmV0dXJuIHRoaXMucmVtb3ZlKCk7XG4gICAgdGhpcy5mZXRjaEFjdGlvbih0aGlzLm9wdGlvbnMuYWN0aW9ucy5tb3ZlLCAoKSA9PiB7XG4gICAgICByZXR1cm4gZGVzdC5nZXRDdXJyZW50RGlyUGF0aCgpICsgZGlyc2VwYXJhdG9yICsgdGhpcy5uYW1lO1xuICAgIH0pLnRoZW4oKCkgPT4ge1xuICAgICAgdGhpcy5zZXRQYXJlbnQoZGVzdCk7XG4gICAgICBpZiAoY2FsbGJhY2sgIT09IG51bGwpIGNhbGxiYWNrKCk7XG4gICAgfSkuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgICAgQWxlcnRCb3guYWRkTWVzc2FnZSh7XG4gICAgICAgIHBhcmVudDogdGhpcy5jb250YWluZXIsXG4gICAgICAgIHR5cGU6IFwiZXJyb3JcIixcbiAgICAgICAgY29udGVudDogKGVycm9yLm1lc3NhZ2UpP2Vycm9yLm1lc3NhZ2U6ZXJyb3IuZXJyb3IrJyAnK2Vycm9yLnRleHQsXG4gICAgICAgIGRpc21pc3NpYmxlOnRydWVcbiAgICAgIH0pXG4gICAgfSk7XG4gIH1cbiAgZW50cnlhY3Rpb24uc2V0UGFyZW50ID0gZnVuY3Rpb24oZGVzdCkge1xuICAgIHRoaXMuZnJvbSA9IHRoaXMucGFyZW50O1xuICAgIGlmIChkZXN0ICE9PSBudWxsKSB7XG4gICAgICBkZXN0LmVudHJpZXMucHVzaCh0aGlzKTtcbiAgICAgIHRoaXMucGFyZW50ID0gZGVzdDtcbiAgICAgIGNvbnN0IGVudHJpZXMgPSBkZXN0LmdldEVudHJpZXNFbGVtZW50KHRydWUpO1xuICAgICAgZW50cmllcy5hcHBlbmQodGhpcy5jb250YWluZXIpO1xuICAgIH1cbiAgICBjb25zdCBpID0gdGhpcy5wYXJlbnQuZW50cmllcy5pbmRleE9mKHRoaXMpO1xuICAgIGlmIChpID49IDApIGRlbGV0ZSB0aGlzLnBhcmVudC5lbnRyaWVzW2ldO1xuICAgIGVsc2UgY29uc29sZS5sb2coJ2VudHJ5IG5vdCBmb3VuZCBpbiBwYXJlbnQgZW50cmllcycsIHRoaXMucGFyZW50KTtcblxuICB9XG4gIHJldHVybiBlbnRyeWFjdGlvbjtcbn1cblxuZXhwb3J0IGNsYXNzIEpzRGlyTGlzdCB7XG4gIGV2ZW50bmFtZXMgPSB7XG4gICAgYXR0YWNoOiAnYXR0YWNoJyxcbiAgICBkZXRhY2g6ICdkZXRhY2gnLFxuICAgIGFjdGlvbjogJ2FjdGlvbicsXG4gICAgY29tcGxldGU6ICdjb21wbGV0ZScsXG4gICAgZXJyb3I6ICdlcnJvcicsXG4gIH1cbiAgb3B0aW9ucztcbiAgdXVpZDtcbiAgZGV0YWNoY2FsbGJhY2s9bnVsbDtcbiAgY29uc3RydWN0b3IocGFyZW50LCBvcHRpb25zID0ge30pIHtcbiAgICBpZiAoIXBhcmVudC5qc2Rpcmxpc3QpIHtcbiAgICAgIHBhcmVudCA9IChwYXJlbnQgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCkgPyBwYXJlbnQgOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHBhcmVudCk7XG4gICAgICBpZiAoIXBhcmVudCkgcmV0dXJuO1xuICAgICAgdGhpcy5vcHRpb25zID0geyAuLi5kaXJsaXN0T3B0aW9ucyxcbiAgICAgICAgLi4ub3B0aW9uc1xuICAgICAgfTtcblxuICAgICAgdGhpcy5vcHRpb25zLmVudHJ5ID0geyAuLi5lbnRyeU9wdGlvbnMsXG4gICAgICAgIC4uLnRoaXMub3B0aW9ucy5lbnRyeSxcbiAgICAgIH07XG4gICAgICB0aGlzLm9wdGlvbnMuZW50cnkudXJsID0gdGhpcy5vcHRpb25zLnVybDtcbiAgICAgIHRoaXMuY29udGFpbmVyID0gY3JlYXRlX2JveChcbiAgICAgICAgdGhpcy5vcHRpb25zLmVudHJ5LnRhZ3MudGFnLCB7XG4gICAgICAgICAgY2xhc3M6IHRoaXMub3B0aW9ucy5zZWxlY3RvcnMuZGlybGlzdC5zdWJzdHIoMSlcbiAgICAgICAgfSwgcGFyZW50KTtcbiAgICAgIC8vIHVuaXF1ZSBpZCB0byBjb21tdW5pY2F0ZSBNb2R1bGVFdmVudEVtaXR0ZXJcbiAgICAgIHRoaXMudXVpZCA9IGdlbmVyYXRlX3V1aWQoKTtcbiAgICAgIHRoaXMuaW5pdCgpO1xuICAgICAgdGhpcy5jb250YWluZXIuYXBwZW5kKHRoaXMucm9vdC5jb250YWluZXIpO1xuICAgICAgcGFyZW50LmpzZGlybGlzdCA9IHRoaXM7XG4gICAgfVxuICAgIHJldHVybiBwYXJlbnQuanNkaXJsaXN0O1xuICB9XG4gIGluaXQoKSB7XG4gICAgY29uc3QgdHlwZSA9IGVudHJ5VHlwZXMucm9vdDtcbiAgICBjb25zdCBvYmogPSB7fTtcbiAgICB0aGlzLmVudHJ5Y29udHJvbHMgPSAodGhpcy5lbnRyeWNvbnRyb2xzID09PSB1bmRlZmluZWQpID8gRW50cnlDb250cm9scyh0aGlzLmNvbnRhaW5lciwgdGhpcy5vcHRpb25zLmVudHJ5Y29udHJvbHMpIDogbnVsbDtcbiAgICBPYmplY3QuZW50cmllcyh0aGlzLm9wdGlvbnMuZW50cnljb250cm9scy5jb250cm9scykuZm9yRWFjaCgoW2tleSwgY29udHJvbF0pID0+IHtcbiAgICAgIG9ialtrZXldID0gY29udHJvbC5hY3Rpb247XG4gICAgfSk7XG4gICAgdGhpcy5vcHRpb25zLmVudHJ5LmFjdGlvbnMgPSBvYmo7XG5cbiAgICBjb25zdCBvcHRpb25zID0geyAuLi50aGlzLm9wdGlvbnMuZW50cnksXG4gICAgICAuLi57XG4gICAgICAgIGFwaV9wYXJhbWV0ZXJzOiB0aGlzLm9wdGlvbnMuYXBpX3BhcmFtZXRlcnNcbiAgICAgIH1cbiAgICB9O1xuICAgIG9wdGlvbnMubGlzdGVuZXIgPSB0aGlzLnV1aWQ7XG4gICAgdGhpcy5yb290ID0gRW50cnlBY3Rpb24oe1xuICAgICAgdHlwZTogdHlwZSxcbiAgICAgIG5hbWU6ICcnLFxuICAgICAgbGFiZWw6IHRoaXMub3B0aW9ucy5hcGlfcGFyYW1ldGVycy5yb290bmFtZSxcbiAgICAgIGNsYXNzOiB0aGlzLm9wdGlvbnMuYXBpX3BhcmFtZXRlcnMucm9vdGNsYXNzXG5cbiAgICB9LCBvcHRpb25zKTtcbiAgICB0aGlzLmluaXRFdmVudHMoKTtcbiAgICB0aGlzLnJvb3QuYWRkTGlzdGVuZXJzKCk7XG4gIH1cblxuICBpbml0RXZlbnRzKG9wdGlvbnMpIHtcbiAgICAvLyBldmVudHMgY29udHJvbHMgb24gZW50cmllc1xuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuICAgIE1vZHVsZUV2ZW50RW1pdHRlci5vbih0aGlzLm9wdGlvbnMuZW50cnkuZXZlbnQubmFtZSwgKGUpID0+IHtcbiAgICAgIGNvbnN0IGV2dG5hbWVzID0gZS5lbnRyeS5ldmVudG5hbWVzO1xuICAgICAgc3dpdGNoIChlLmFjdGlvbikge1xuICAgICAgICBjYXNlIGV2dG5hbWVzLmlzZGlzY2FyZDpcbiAgICAgICAgICBpZiAodGhpcy50cmFzaGRpcikgdGhpcy50cmFzaGRpci5jb250YWluZXIucmVtb3ZlKCk7XG4gICAgICAgICAgdGhpcy50cmFzaGRpciA9IGUuZW50cnk7XG4gICAgICAgICAgdGhpcy5yb290LmNvbnRhaW5lci5wYXJlbnRFbGVtZW50Lmluc2VydEJlZm9yZShlLmVudHJ5LmNvbnRhaW5lciwgdGhpcy5yb290LmNvbnRhaW5lcik7XG4gICAgICAgICAgdGhpcy5yb290LmNvbnRhaW5lci5hcHBlbmQoZS5lbnRyeS5jb250YWluZXIpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIGV2dG5hbWVzLmRpc2NhcmRlZDpcbiAgICAgICAgICBsZXQgcGFyZW50ID0gZS5lbnRyeS5wYXJlbnQ7XG4gICAgICAgICAgaWYgKGUuZW50cnkuaXNJblRyYXNoKCkpIHtcbiAgICAgICAgICAgIGUuZW50cnkuY29udGFpbmVyLnJlbW92ZSgpO1xuICAgICAgICAgICAgcGFyZW50ID0gdGhpcy5yb290O1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBlLmVudHJ5Lm1vdmVUbyh0aGlzLnRyYXNoZGlyKTtcbiAgICAgICAgICAgIGUuZW50cnkuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoY3NzLmludHJhc2gpO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLmF0dGFjaENvbnRyb2xzKHBhcmVudCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgZXZ0bmFtZXMuYXR0YWNoOlxuICAgICAgICAgaWYgKHRoaXMuZGV0YWNoY2FsbGJhY2spIHRoaXMuZGV0YWNoY2FsbGJhY2soKTtcbiAgICAgICAgICAvLyBubyB1cGxvYWQgb24gdHJhc2ggZGlyXG4gICAgICAgICAgY29uc3QgdHlwZSA9IChlLmVudHJ5LmlzSW5UcmFzaCgpKSA/IGVudHJ5VHlwZXMuZGlzY2FyZGVkIDogZS5lbnRyeS5jb250YWluZXIuZGF0YXNldC50eXBlO1xuICAgICAgICAgIGlmICh0eXBlID09PSBlbnRyeVR5cGVzLmRpc2NhcmQpIHJldHVybjtcbiAgICAgICAgICBpZiAoZS5hY3Rpb24gPT09IGV2dG5hbWVzLmF0dGFjaCAmJiB0eXBlID09PSBlbnRyeVR5cGVzLmRpc2NhcmRlZCkgcmV0dXJuO1xuICAgICAgICAgIHRoaXMuYXR0YWNoQ29udHJvbHMoZS5lbnRyeSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJkcmFnc3RhcnRcIjpcbiAgICAgICAgICB0aGlzLmRyYWdlbnRyeSA9IHRoaXMuYWN0aXZlbnRyeSA9IGUuZW50cnk7XG4gICAgICAgICAgZS5lbnRyeS5jb250YWluZXIuY2xhc3NMaXN0LmFkZChlLmVudHJ5Lm9wdGlvbnMuY3NzLmRyYWdnaW5nKTtcbiAgICAgICAgICB0aGlzLmRldGFjaENvbnRyb2xzKCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJkcmFnb3ZlclwiOlxuICAgICAgICAgIGlmICghdGhpcy5kcmFnZW50cnkpIHJldHVybjtcbiAgICAgICAgICBpZiAodGhpcy5vdmVyaXRlbSAhPT0gZS5lbnRyeS5jb250YWluZXIpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLm92ZXJpdGVtKSB0aGlzLm92ZXJpdGVtLmNsYXNzTGlzdC5yZW1vdmUoZS5lbnRyeS5vcHRpb25zLmNzcy5kcmFnb3Zlcik7XG4gICAgICAgICAgICBlLmVudHJ5LmNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKGUuZW50cnkub3B0aW9ucy5jc3MuZHJhZ292ZXIpO1xuICAgICAgICAgICAgdGhpcy5vdmVyaXRlbSA9IGUuZW50cnkuY29udGFpbmVyO1xuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImRyYWdlbmRcIjpcbiAgICAgICAgICB0aGlzLmRyYWdlbnRyeSA9IG51bGw7XG4gICAgICAgICAgaWYgKHRoaXMub3Zlcml0ZW0pIHRoaXMub3Zlcml0ZW0uY2xhc3NMaXN0LnJlbW92ZShlLmVudHJ5Lm9wdGlvbnMuY3NzLmRyYWdvdmVyKTtcbiAgICAgICAgICB0aGlzLm92ZXJpdGVtID0gbnVsbDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImRyb3BcIjpcbiAgICAgICAgICBpZiAoIXRoaXMuZHJhZ2VudHJ5KSB7XG4gICAgICAgICAgICBNb2R1bGVFdmVudEVtaXR0ZXIuZW1pdCh0aGlzLmV2ZW50bmFtZXMuYWN0aW9uLCBlLCB0aGlzLnV1aWQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCBkZXN0X2VudHJ5ID0gZS5lbnRyeTtcbiAgICAgICAgICBkZXN0X2VudHJ5LnJlc2V0RHJhZ092ZXIoKTtcbiAgICAgICAgICBpZiAodGhpcy5kcmFnZW50cnkpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmRyYWdlbnRyeS5vcHRpb25zLmFjdGlvbnMubW92ZSkge1xuICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHRoaXMuZHJhZ2VudHJ5Lm1vdmUoZGVzdF9lbnRyeSk7XG4gICAgICAgICAgICAgICAgaWYgKFtlbnRyeVR5cGVzLmRpc2NhcmRlZF0uaW5kZXhPZihkZXN0X2VudHJ5LnR5cGUpID49IDApIHRoaXMuYXR0YWNoQ29udHJvbHMoZGVzdF9lbnRyeSk7XG4gICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2Vycm9yIGRyb3AgJywgZXJyb3IpXG4gICAgICAgICAgICAgICAgdGhpcy5kcmFnZW50cnkudW5Nb3ZlKCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBjb25zb2xlLmxvZygnbm8gYWN0aW9uIG9uIGRyb3AnKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgZXZ0bmFtZXMuZWRpdGFibGU6XG4gICAgICAgICAgaWYgKHRoaXMuZWRpdGFibGUpIHRoaXMuZWRpdGFibGUuc2V0RWRpdGFibGUoZmFsc2UpO1xuICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgaWYgKGUuZW50cnkuYWN0aXZlKSB7XG4gICAgICAgICAgICB0aGlzLmF0dGFjaENvbnRyb2xzKGUuZW50cnkpO1xuICAgICAgICAgIH0gZWxzZSB0aGlzLmF0dGFjaENvbnRyb2xzKHRoaXMucm9vdCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfSwgdGhpcy51dWlkKTtcbiAgfVxuICBnZXRBY3RpdmVudHJ5KCkge1xuICAgIHJldHVybiB0aGlzLmFjdGl2ZW50cnk7XG4gIH1cbiAgc2V0QWN0aXZlbnRyeShlbnRyeSA9IG51bGwpIHtcbiAgICB0aGlzLmFjdGl2ZW50cnkgPSBlbnRyeTtcbiAgfVxuICBhdHRhY2hDb250cm9scyhlbnRyeSkge1xuICAgIGlmICh0aGlzLmVudHJ5Y29udHJvbHMpIHRoaXMuZW50cnljb250cm9scy5hdHRhY2hDb250cm9scyhlbnRyeSk7XG4gICAgdGhpcy5hY3RpdmVudHJ5ID0gZW50cnk7XG4gICAgTW9kdWxlRXZlbnRFbWl0dGVyLmVtaXQodGhpcy5ldmVudG5hbWVzLmF0dGFjaCwge1xuICAgICAgZW50cnk6IHRoaXMuYWN0aXZlbnRyeVxuICAgIH0sIHRoaXMudXVpZCk7XG4gIH1cblxuICBkZXRhY2hDb250cm9scygpIHtcbiAgICBjb25zdCBkZXN0ID0gKHRoaXMuYWN0aXZlbnRyeSkgPyAoKHRoaXMuYWN0aXZlbnRyeS5wYXJlbnQpID8gdGhpcy5hY3RpdmVudHJ5LnBhcmVudCA6IHRoaXMucm9vdCkgOiB0aGlzLnJvb3Q7XG4gICAgaWYgKHRoaXMuZW50cnljb250cm9scykgdGhpcy5lbnRyeWNvbnRyb2xzLmF0dGFjaENvbnRyb2xzKGRlc3QpO1xuICAgIHRoaXMuYWN0aXZlbnRyeSA9IGRlc3Q7XG4gICAgTW9kdWxlRXZlbnRFbWl0dGVyLmVtaXQodGhpcy5ldmVudG5hbWVzLmF0dGFjaCwge1xuICAgICAgZW50cnk6IGRlc3RcbiAgICB9LCB0aGlzLnV1aWQpO1xuICB9XG59Il0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/modules/files/js-dirlist.js\n\n}")},"./src/modules/js-my-files.js"(module,__webpack_exports__,__webpack_require__){eval("{__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   JsMyFiles: () => (/* binding */ JsMyFiles)\n/* harmony export */ });\n/* harmony import */ var _modules_utils_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../modules/utils.js */ \"./src/modules/utils.js\");\n/* harmony import */ var _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../modules/modules-config.js */ \"./src/modules/modules-config.js\");\n/* harmony import */ var _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../modules/alert-box.js */ \"./src/modules/alert-box.js\");\n/* harmony import */ var _modules_files_js_dirlist_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../modules/files/js-dirlist.js */ \"./src/modules/files/js-dirlist.js\");\n/* harmony import */ var _modules_module_event_emitter_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../modules/module-event-emitter.js */ \"./src/modules/module-event-emitter.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_modules_alert_box_js__WEBPACK_IMPORTED_MODULE_2__, _modules_files_js_dirlist_js__WEBPACK_IMPORTED_MODULE_3__, _modules_module_event_emitter_js__WEBPACK_IMPORTED_MODULE_4__]);\n([_modules_alert_box_js__WEBPACK_IMPORTED_MODULE_2__, _modules_files_js_dirlist_js__WEBPACK_IMPORTED_MODULE_3__, _modules_module_event_emitter_js__WEBPACK_IMPORTED_MODULE_4__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\nconst objaccept = {\n  \"image/*\": [\".png\", \".jpeg\", \".jpg\"],\n  \"text/tab-separated-values\": [\".tsv\"],\n  \"application/zip\": [\".zip\"],\n  \"application/gzip\": [\".gz\"],\n  \"application/x-bzip\": [\".bz\"],\n  \"application/x-bzip2\": [\".bz2\"]\n}\nconst accept = Object.values(objaccept).reduce((a, b) => a.concat(b));\n_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.button = 'button p-1 mx-auto sm:mr-4 mb-4';\nconst filter_files = {\n  images: \"png,jpeg,jpg,gif\",\n  tsv: \"txt,tsv,zip, gzip,gz\"\n}\nclass JsMyFiles {\n  done = true;\n  jsDirToZip = null;\n  jsDirList = null;\n  trash_dir_name = 'trash.';\n  counters = {};\n  _events = {};\n  eventnames = {\n    complete: 'complete',\n    error: 'error',\n\n  };\n  rejected = [];\n  errorfile = [];\n  listener;\n  constructor(container, options = {}) {\n    if (!container.jsmyfiles) {\n      container = (container instanceof HTMLElement) ? container : document.querySelector(container);\n      if (!container) return;\n      (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.dom_purify)(container, 'dataset');\n      this.container = container;\n      const defaultOptions = {\n        controls: {\n          scan: {\n            display: {\n              counter: 'counter',\n              size: 'size',\n            }\n          },\n          zip: {\n            btn: {\n              zip: 'makezip',\n              zipped: 'makezipped'\n            },\n            display: {\n              size: 'sizezipped',\n              counter: 'counterzipped',\n            }\n          },\n          reject: {\n            display: {\n              counter: 'counterrejected'\n            }\n          },\n          errorfile: {\n            display: {\n              counter: 'countererrorfile'\n            }\n          }\n        },\n        upload: {\n          label: 'upload'\n        },\n        btnprefix: 'btn',\n        btnfilelist: null,\n        selectors: {\n          droptarget: '.droptarget',\n          trigger: '.trigger',\n          uploadfile: 'uploadfile',\n        },\n        display: {\n          progression: 'display-progression',\n          dropzone: 'dropzone',\n          boxtitle: 'boxtitle',\n          counters: 'counters',\n          sizes: 'sizes',\n          timers: 'timers'\n        },\n\n        css: {\n          dragover: 'dragover'\n        }\n      };\n      this.options = Object.assign(defaultOptions, options);\n      this.options.browse = (container.dataset.browse) ? container.dataset.browse.split(',') : ['directory', 'file'];\n      this.haspicker = (window.showDirectoryPicker);\n      this.uuid = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.generate_uuid)();\n      this.init();\n      container.jsmyfiles = this;\n    }\n    return container.jsmyfiles;\n  }\n  init() {\n    // create dirlist box\n    this.addDisplayProgression();\n    this.addDropzone();\n    this.addDirList();\n    this.initControls();\n    this.initEvents().then(() => {\n      this.resetCounters();\n    });\n  }\n  initTimer() {\n    this.timer = new Date();\n  }\n  async initEvents() {\n    //To be refactored - for steppers )\n    _modules_module_event_emitter_js__WEBPACK_IMPORTED_MODULE_4__.ModuleEventEmitter.on(this.eventnames.processed, async (e) => {\n      if (this.nextaction) await this.nextaction();\n    }, this.uuid);\n    const self = this;\n    if (this.options.controls.zip) {\n      const {\n        JsDirToZip\n      } = await Promise.all(/*! import() */[__webpack_require__.e(\"vendors-node_modules_detect-browser_es_index_js-node_modules_fflate_esm_browser_js\"), __webpack_require__.e(\"src_modules_files_js-dirtozip_js\")]).then(__webpack_require__.bind(__webpack_require__, /*! ../modules/files/js-dirtozip.js */ \"./src/modules/files/js-dirtozip.js\"));\n      this.jsDirToZip = JsDirToZip({\n        listener: this.uuid\n      });\n\n      Object.keys(this.jsDirToZip.eventnames).forEach((key) => {\n        this.eventnames[key] = this.jsDirToZip.eventnames[key];\n        _modules_module_event_emitter_js__WEBPACK_IMPORTED_MODULE_4__.ModuleEventEmitter.on(key, (e) => {\n          switch (key) {\n            case this.eventnames.counter:\n              this.fileCounter(e);\n              break;\n            case this.eventnames.reject:\n              this.rejected.push(e.path);\n              this.fileCounter({\n                name: 'reject',\n                path: e.path,\n              });\n              break;\n            case this.eventnames.follow:\n            case this.eventnames.complete:\n              if (!e || !e.hasOwnProperty(\"name\") || e.name === \"\") {\n                console.log('no emit complete name' + key, e);\n                return;\n              }\n              self.showControl(e.name, e);\n              break;\n            case this.eventnames.message:\n              switch (e.name) {\n                case 'console':\n                  this.addConsoleMessage({\n                    id: (e.id) ? e.id : null,\n                    content: e.message,\n                    parent: this.container\n                  });\n                  break;\n                  case 'browser':\n                  if (this.activentry) this.detachDropzone();\n                   _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_2__.AlertBox.addAlert({\n                    type: _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_2__.AlertBox.alertconfig.types.danger,\n                    content: e.message,\n                    dismissible: false,\n                    inverse: false\n                  });\n                  break;\n                case this.eventnames.errorfile:\n                    self.showControl(e.name, e);\n                    e.name=_modules_alert_box_js__WEBPACK_IMPORTED_MODULE_2__.AlertBox.alertconfig.types.error;\n                    e.message+=(e.path)?' '+e.path:'';\n                case _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_2__.AlertBox.alertconfig.types.error:\n                case _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_2__.AlertBox.alertconfig.types.success:\n                case _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_2__.AlertBox.alertconfig.types.danger:\n                case _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_2__.AlertBox.alertconfig.types.info:\n                  _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_2__.AlertBox.addAlert({\n                    type: e.name,\n                    content: e.message,\n                    dismissible: true,\n                    inverse: false\n                  });\n                  break;\n                default:\n                  _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_2__.AlertBox.addAlert({\n                    type: _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_2__.AlertBox.alertconfig.types.info,\n                    content: e.message,\n                    dismissible: true,\n                    inverse: true\n                  });\n                  break;\n              }\n              break;\n          }\n        }, this.uuid);\n      });\n            this.jsDirToZip.browserRequired() ;\n    }\n    window.addEventListener('beforeunload', (e) => {\n      if (!this.done) {\n        e.preventDefault();\n        e.returnValue = (this.options.preventclose) ? this.options.preventclose : `Some work is in progress in this window.\\nAre you sure you want to leave?`;\n      }\n    });\n  }\n  emitToZip(btn) {\n    const message = (btn.dataset.message) ? JSON.parse(btn.dataset.message) : null;\n    if (!message) btn.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n    if (message) {\n      if (message.name) {\n        const name = message.name;\n        delete message.name;\n        _modules_module_event_emitter_js__WEBPACK_IMPORTED_MODULE_4__.ModuleEventEmitter.emit(name, message, this.jsDirToZip.uuid);\n      }\n    }\n    if (name === this.eventnames.sendfile) btn.disabled = true;\n  }\n\n  quotaEstimate(obj) {\n    return this.jsDirToZip.quotaEstimate();\n  }\n  scanBrowse(e, options) {\n\n    return this.jsDirToZip.scanBrowse(e, options);\n  }\n  scanHandle(dir, options) {\n    return this.jsDirToZip.scanHandle(dir, options);\n  }\n  async handleBrowse(e) {\n    if (!this.setUploadEntry()) return;\n    this.initTimer();\n    this.toggleCounters(true);\n    if (!this.haspicker) e = e.target.files;\n    await this.scanBrowse(e, {\n      accept: accept,\n    });\n  }\n\n  addDropzone() { //\n    this.dropzone = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)('div', {\n      id: this.options.display.dropzone\n    });\n    const input = (this.haspicker) ? null : (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)('input', {\n      type: \"file\",\n      name: this.options.selectors.uploadfile,\n      id: this.options.selectors.uploadfile,\n      multiple: true,\n      allowdirs: true,\n      accept: accept,\n      class: 'hidden'\n    }, this.dropzone);\n    if (input) input.addEventListener(\"change\", (e) => {\n      this.handleBrowse(e)\n    });\n    const btns = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)('div', {},\n      this.dropzone);\n\n    this.options.browse.forEach(opt => {\n      const text = (this.container.dataset[`textbrowse${opt}`]) ? this.container.dataset[`textbrowse${opt}`] : `browse${opt}`;\n      const btn = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)('span', {\n        class: this.options.selectors.trigger.slice(1),\n        dataset: {\n          type: opt\n        },\n        text: text\n      }, btns);\n\n      btn.addEventListener('click', async (e) => {\n        if (this.haspicker) {\n          this.openDirDialog(opt, (e) => {\n            this.handleBrowse(e)\n          });\n        } else {\n          if (opt === \"directory\") {\n            input.directory = true;\n            input.webkitdirectory = true;\n          } else { //file\n            input.directory = false;\n            input.webkitdirectory = false;\n          }\n          input.dispatchEvent(new MouseEvent(\"click\"));\n\n        }\n        // if other functionalities add controls ( like import) clear\n        if(this.eventnames.clearother) _modules_module_event_emitter_js__WEBPACK_IMPORTED_MODULE_4__.ModuleEventEmitter.emit(this.eventnames.clearother,{},this.uuid);\n      });\n    });\n\n    const spandrop = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)('span', {\n      text: this.container.dataset.textdrop\n    }, btns);\n    const browselink = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)('a', {\n    text:this.container.dataset.textbrowse,class:'modal', spandrop})\n  }\n\n  toggleDropTarget(on = true) {\n    const self = this;\n     const droptarget = (this.activentry) ? this.activentry.container : null;\n    if (droptarget === null) return;\n\n    function highlight(e) {\n        droptarget.classList.add(cssdragover)\n    }\n    function unhighlight(e) {\n        droptarget.classList.remove(cssdragover);\n    }\n    const cssdragover = (this.jsDirList) ? (this.jsDirList.options.entry) ? this.jsDirList.options.entry.css.dragover : this.options.css.dragover : this.options.css.dragover;\n    const target_dragover = (e) => {e.preventDefault();\n      if (!this.dragover && this.activentry && this.activentry.container === e.currentTarget) {\n        droptarget.classList.add(cssdragover);\n      }\n    e.dataTransfer.dropEffect = \"move\";\n    }\n    const target_drop = async (e) => { await self.handleDrop(e);}\n    // set events and css for new dropzone\n    if (on === false) {\n     ['dragenter', 'dragover'].forEach(eventname => {\n        droptarget.removeEventListener(eventname, highlight, false);\n    });\n    ['dragleave', 'drop'].forEach(eventname => {\n        droptarget.removeEventListener(eventname, unhighlight, false);\n    });\n      droptarget.removeEventListener('drop', target_drop);\n      droptarget.classList.remove(this.options.selectors.droptarget.substr(1));\n    } else {\n    ['dragenter', 'dragover'].forEach(eventname => {\n        droptarget.addEventListener(eventname, highlight, false);\n    });\n    ['dragleave', 'drop'].forEach(eventname => {\n    droptarget.addEventListener(eventname, unhighlight, false);\n    });\n      droptarget.addEventListener('drop', target_drop);\n      droptarget.classList.add(this.options.selectors.droptarget.substr(1));\n    }\n  }\n\n  async addDirList() {\n    this.jsDirList = new _modules_files_js_dirlist_js__WEBPACK_IMPORTED_MODULE_3__.JsDirList(this.container);\n    this.activentry = this.jsDirList.root;\n    this.rootitem = this.targetitem = this.activentry.container;\n    _modules_module_event_emitter_js__WEBPACK_IMPORTED_MODULE_4__.ModuleEventEmitter.on(this.jsDirList.eventnames.attach, (e) => {\n      if (!e.entry) return;\n      if (e.entry !== this.activentry && this.activentry.isBranch(true)) this.detachDropzone();\n      this.activentry = e.entry;\n      this.targetitem = this.activentry.container;\n      if (this.activentry.isBranch(true)) this.addUploadDialog();\n    }, this.jsDirList.uuid);\n    _modules_module_event_emitter_js__WEBPACK_IMPORTED_MODULE_4__.ModuleEventEmitter.on(this.jsDirList.eventnames.detach, (e) => {\n      this.detachDropzone();\n      this.activentry = null;\n      this.uploadentry = null;\n      this.targetitem = null;\n    }, this.jsDirList.uuid);\n    _modules_module_event_emitter_js__WEBPACK_IMPORTED_MODULE_4__.ModuleEventEmitter.on(this.jsDirList.eventnames.action, (e) => {\n      switch (e.action) {\n        case \"drop\":\n          this.handleDrop(e.event);\n          break;\n\n        default:\n          console.log('action not managed ' + e.action, e);\n          break;\n      }\n    }, this.jsDirList.uuid);\n    this.activentry.label.dispatchEvent(new Event('click'));\n  }\n\n  addDisplayProgression() {\n    // add counters\n    if (this.displayprogression) return;\n    let el = document.getElementById(this.options.display.progression);\n    if (!el) {\n      el = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)('div', {\n        id: this.options.display.progression\n      }, this.container);\n      el.insertAdjacentHTML('afterbegin', `<div class=\"${this.options.display.progression}\"><div class=\"${this.options.display.counters}\"></div><div class=\"${this.options.display.sizes}\"></div><div class=\"${_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.progress}\"></div><div class=\"${this.options.display.timers}\"></div></div>`);\n      this.displayprogression = el;\n    }\n  }\n  enableDropzone(enable = true, destroy = false) {\n    if (destroy || enable === false) this.dropzone.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n    if (enable) {\n      this.dropzone.dataset.active = true;\n      this.dropzone.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n    } else delete this.dropzone.dataset.active;\n  }\n  //\n  attachDropzone() {\n    if (this.dropzone.dataset.active) {\n      this.targetitem.insertBefore(this.dropzone, this.activentry.label.nextElementSibling);\n      this.toggleDropTarget(true);\n    }\n    ['dragover', 'dragenter'].forEach(eventname => {\n     window.addEventListener(eventname, function(e) {e.preventDefault();}, false);\n    });\n  }\n  detachDropzone() {\n    this.enableDropzone(false);\n    this.toggleDropTarget(false);\n  }\n\n  openDirDialog(type, callback) {\n    // if chrome 86 , edge 86, opera 72\n    const showpick = (type === \"directory\") ? window.showDirectoryPicker : window.showOpenFilePicker;\n    const pickopts = (type === \"directory\") ? {\n      mode: \"read\",\n      multiple: true\n    } : {\n      types: [{\n        description: \"Images,.tsv, zip, gzip, tar files\",\n        accept: objaccept,\n      }, ],\n      excludeAcceptAllOption: true,\n      multiple: true,\n    };\n    showpick(pickopts).then(pick => {\n      callback(pick);\n    });\n  }\n\n  setUploadEntry() {\n    if (this.uploadentry && this.uploadentry !== this.activentry) {\n      _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_2__.AlertBox.addAlert({\n        type: \"error\",\n        content: 'Only one upload destination authorized. Close and upload the current zipfile.',\n        dismissible: true,\n        inverse: true\n      });\n      return false;\n    }\n    this.uploadentry = this.activentry;\n     _modules_module_event_emitter_js__WEBPACK_IMPORTED_MODULE_4__.ModuleEventEmitter.emit(this.jsDirToZip.eventnames.setuploadpath, {name:this.jsDirToZip.eventnames.setuploadpath, path:this.uploadentry.getCurrentDirPath()}, this.jsDirToZip.uuid);\n    return true;\n  }\n  // drag&drop\n\n\n  async handleDrop(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    if (!this.setUploadEntry()) return;\n    let dataTransfer;\n    if (e.dataTransfer) {\n      dataTransfer = e.dataTransfer;\n    } else dataTransfer = e;\n    this.initTimer();\n    const items = [...((dataTransfer.items) ? dataTransfer.items : dataTransfer.files)];\n    if (items.length) {\n      this.enableDropzone(false);\n      await items.forEach(async item => {\n        if (item.kind === \"file\") {\n          item = await item.webkitGetAsEntry();\n          this.toggleCounters(true);\n          await this.scanHandle(item);\n\n        }\n      })\n    }\n  }\n   showComplete() {\n    this.timer = (new Date() - this.timer) / 1000;\n    this.enableDropzone(true);\n  }\n\n  stopOnError(err) {\n    console.log('err', err);\n  }\n\n  addConsoleMessage(message) {\n    //message {message:, parent:}\n    message.parent = (message.parent) ? message.parent : this.container;\n    _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_2__.AlertBox.addConsole(message);\n  }\n\n  addUploadDialog() {\n    if (this.options.controls.scan) {\n      this.enableDropzone(true);\n      this.attachDropzone();\n    }\n  }\n\n  async addFilesStore(name, callback) {\n    name = (name) ? name : this.options.dbname;\n    if (!this.jsFilesStore) {\n      const {\n        JsFilesStore\n      } = await __webpack_require__.e(/*! import() */ \"src_modules_files_js-filesystem_js\").then(__webpack_require__.bind(__webpack_require__, /*! ../modules/files/js-filesystem.js */ \"./src/modules/files/js-filesystem.js\"));\n      this.jsFilesStore = new JsFilesStore(null, callback);\n      this.displayFiles();\n    }\n    if (callback) await callback();\n  }\n  displayFiles() {\n    this.jsFilesStore.getItems('local');\n  }\n\n  fileCounter(e) {\n    const counters = this.counters[e.name];\n    counters.counter += 1;\n    if (e.size !== null) counters.size += parseInt(e.size);\n    counters.display.counter.textContent = counters.counter;\n    if (counters.display.size) counters.display.size.textContent = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.format_bytes)(counters.size);\n    this.quotaEstimate();\n  }\n\n  resetCounter(item) {\n    const counters = this.counters[item];\n    ['counter', 'size'].forEach(el => {\n      if (counters.display[el]) {\n        counters[el] = 0;\n        counters.display[el].textContent = 0;\n      }\n    });\n  }\n  resetCounters() {\n    Object.keys(this.options.controls).forEach(key => {\n      this.resetCounter(key);\n    });\n    this.toggleCounters(false);\n  }\n  toggleCounters(show = true) {\n    const el = document.getElementById(this.options.display.progression);\n    if (!el) return;\n    if (show) el.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n    else el.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n  }\n\n  initFileCounter(item, opts, i) {\n    const sep = (i) ? ` / ` : ``;\n    let counter = 0;\n    let counterdisplay = null;\n    let size = 0;\n    let sizedisplay = null;\n    // create dom display elements\n\n\n    let boxcounters = document.getElementById(this.options.display.progression);\n\n    const itemopts = {\n      display: {},\n    };\n    Object.entries(opts).forEach(([k, val]) => {\n      const cl = k + 's';\n      const txt = {\n        counter: ' read',\n        size: ' read',\n        counterzipped: ' compressed',\n        sizezipped: ' compressed',\n        counterrejected: ' rejected',\n        countererrorfile: ' error',\n      }\n      const displaylist = ['counterrejected', 'countererrorfile'];\n      let elinsert = boxcounters.querySelector('.' + cl);\n      if (!elinsert) elinsert = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)('div', {\n        class: cl\n      }, boxcounters, ``);\n      let el = elinsert.querySelector('.' + val);\n      if (!el) {\n        el = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)('span', {\n          class: val,\n        }, elinsert, ` / `);\n        if (txt.hasOwnProperty(val)) {\n          // add a link to display the rejected files list\n          if (displaylist.indexOf(val) >= 0) {\n            const link = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)('a', {\n              text: txt[val],\n              class: 'text-error',\n              title: `Click to display the list of ${txt[val]} files`\n            }, elinsert);\n            link.addEventListener('click', (e) => {\n              e.preventDefault();\n              this.displayExcept(link, val);\n            });\n          } else elinsert.append(document.createTextNode(txt[val]));\n        }\n      } else this.resetCounter(item);\n      itemopts.display[k] = el;\n      itemopts[k] = 0;\n    });\n\n    this.counters = { ...this.counters,\n      ...{\n        [item]: itemopts\n      }\n    };\n\n  }\n  displayExcept(el, type) {\n    type = type.replace('counter', '');\n    const textval = {\n      rejected: ` type rejected`,\n      errorfile: ` in error`\n    };\n    if (Object.keys(textval).indexOf(type) < 0) return;\n    const message = {\n      type: _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_2__.AlertBox.alertconfig.types.warning,\n      parent: el,\n      content: `Files ${this.rejected.join('<br>')} ${textval[type]}`,\n    };\n    if (el.dataset.hasmessage) {\n      _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_2__.AlertBox.removeMessage(message);\n      delete el.dataset.hasmessage;\n    } else {\n      el.dataset.hasmessage = true;\n      _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_2__.AlertBox.addMessage(message);\n    }\n  }\n\n  showControl(action, opts) {\n    const part = (opts && opts.part) ? opts.part : false;\n    const bigfile = (opts && opts.bigfile) ? opts.bigfile : false;\n    const filepath = (opts && opts.path) ? opts.path : this.uploadentry.getCurrentDirPath();\n    const target = ((opts.hasOwnProperty('bigfile') && bigfile !== false) ? 'zipped' : 'zip');\n    let message, text = null;\n    // 'zip' ---only btn for zip actions for the moment\n    const btn = this[this.options.btnprefix + 'zip' + target];\n    if (!btn) return;\n    btn.disabled = false;\n    let click_btn=false;\n    switch (action) {\n      case this.eventnames.ready:\n        this.resetCounters();\n        if (this.uploadentry)  this.uploadentry.list().then(()=>{ this.uploadentry.setOpen(true);this.uploadentry = null;});\n        message = null;\n        break;\n      case this.eventnames.follow:\n          message = {};\n          btn.disabled = true;\n        break;\n      case this.eventnames.bigfile:\n        if (bigfile && bigfile !== '') {\n          btn.textContent = `Upload big File separately`;\n          message = {\n            name: this.eventnames.endzip,\n            path: filepath,\n            part: part,\n            bigfile: bigfile\n          };\n        }\n        break;\n        case this.eventnames.endzip:\n        if (!part) this.showComplete();\n        // combine endzip and upload for prod\n       // btn.textContent = `Uploading file` + ((part) ? ` ` + part : ``);\n        btn.dataset.message = JSON.stringify({\n          name: this.eventnames.endzip,\n          part: part,\n          path: filepath,\n          bigfile: bigfile,\n        });\n         setTimeout( () => {this.emitToZip(btn);},1000);\n         return;\n        // removed by dead control flow\n\n    case this.eventnames.sendfile:\n        this.done=false;\n        btn.dataset.message = JSON.stringify({\n          name: this.eventnames.sendfile,\n          path: filepath,\n          part: part,\n          bigfile: bigfile\n        });\n        setTimeout( () => {this.emitToZip(btn);},1000);\n        if(btn.previousElementSibling && btn.previousElementSibling.tagName.toLowerCase()!==\"svg\")  btn.insertAdjacentHTML('beforebegin', (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.html_spinner)('text-stone-200 ml-1 mr-2 align-text-bottom inline-block'));\n        return;\n        // removed by dead control flow\n\n      case this.eventnames.pending:\n        btn.textContent = ` Uploading ` + ((target !== 'zip') ? ' big file' : '');\n        btn.disabled = true;\n        message = {};\n        break;\n      case this.eventnames.gzip:\n        text = `compressing big file :${(opts && opts.bigfile)?filepath :``} ${(opts && opts.size)?(0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.format_bytes)(opts.size):``}`;\n        btn.textContent = text;\n        btn.disabled = true;\n        message = {};\n        break;\n      case this.eventnames.terminate:\n        if (btn.previousElementSibling && btn.previousElementSibling.tagName.toLowerCase()===\"svg\")  btn.previousElementSibling.remove();\n        btn.dataset.message = JSON.stringify({\n          name: this.eventnames.init,\n          bigfile: bigfile,\n          part: part,\n          path: filepath\n        });\n        this.done=true;\n        btn.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n        btn.click();\n        return;\n        // removed by dead control flow\n\n      case this.eventnames.errorfile:\n      case this.eventnames.error:\n        btn.textContent = (opts.text) ? opts.text : `Error `+JSON.stringify(message);\n        btn.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.console);\n        btn.disabled=true;\n        message=null;\n        break;\n      default:\n        console.log('default control' + action, opts);\n        return;\n        // removed by dead control flow\n\n    }\n    if (message === null) {\n      delete btn.dataset.message;\n      btn.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n    } else {\n      btn.dataset.message = JSON.stringify(message);\n      btn.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide);\n      if (btn.disabled) {\n        btn.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.console);\n       if(!btn.classList.contains(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.console) && btn.previousElementSibling && btn.previousElementSibling.tagName.toLowerCase()!==\"svg\") btn.insertAdjacentHTML('beforebegin', (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.html_spinner)('text-stone-200 ml-1 mr-2 align-text-bottom inline-block'));\n      } else btn.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.console);\n    }\n  }\n\n  getBtn(item, target) {\n    const btnkey = this.options.btnprefix + item + target;\n    if (this[btnkey]) return this[btnkey];\n    const display = this.options.controls[item].btn[target];\n    const btn = document.getElementById(display);\n    const parent = this.displayprogression;\n    if (!btn) {\n      this[btnkey] = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.create_box)('button', {\n        id: display,\n        class: [display, _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.hide].concat(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.button.split(' '))\n      }, parent);\n      this[btnkey].addEventListener('click', async (e) => {\n        e.stopImmediatePropagation();\n        e.preventDefault();\n        this.emitToZip(e.currentTarget);\n      });\n    } else parent.append(btn);\n    return this[btnkey];\n  }\n\n  initControls() {\n    Object.entries(this.options.controls).forEach(([key, control], i) => {\n       this.initFileCounter(key, control.display, i);\n      if (control.btn) this.activateControls(key, control.btn);\n    });\n  }\n  activateControls(key, btns) {\n    Object.keys(btns).forEach((btn) => {\n      this[this.options.btnprefix + key + btn] = this.getBtn(key, btn);\n    })\n\n  }\n\n}\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LCtEQUFZO0FBQ3RKO0FBQ0EsUUFBUTtBQUFNO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0NBQXdDLHFDQUFxQyxFQUFFLG9CQUFvQiwrREFBWSxlQUFlO0FBQzlIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSwwQkFBMEIsMkRBQUc7QUFDN0I7QUFDQTtBQUNBLFFBQVE7QUFBTTtBQUNkO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQiwyREFBRztBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQU07QUFDZDtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsMkRBQUc7QUFDM0IsTUFBTTtBQUNOO0FBQ0EsMkJBQTJCLDJEQUFHO0FBQzlCO0FBQ0EsMEJBQTBCLDJEQUFHO0FBQzdCLGtDQUFrQywyREFBRywySUFBMkksK0RBQVk7QUFDNUwsUUFBUSwwQkFBMEIsMkRBQUc7QUFDckM7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQiw2REFBVTtBQUMvQjtBQUNBLHlCQUF5QiwyREFBRyxjQUFjLDJEQUFHO0FBQzdDLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxNQUFNO0FBQ047QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7O0FBRUEsQyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9tb2R1bGVzL2pzLW15LWZpbGVzLmpzPzEzYjkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgZG9tX3B1cmlmeSxcbiAgZmV0Y2hTZXR0aW5ncyxcbiAgY3JlYXRlX2JveCxcbiAgZm9ybWF0X2J5dGVzLFxuICBnZW5lcmF0ZV91dWlkLFxuICBkaXJzZXBhcmF0b3IsXG4gIGh0bWxfc3Bpbm5lclxufSBmcm9tICcuLi9tb2R1bGVzL3V0aWxzLmpzJztcbmltcG9ydCB7XG4gIGNzcyxcbn0gZnJvbSAnLi4vbW9kdWxlcy9tb2R1bGVzLWNvbmZpZy5qcyc7XG5pbXBvcnQge1xuICBBbGVydEJveFxufSBmcm9tICcuLi9tb2R1bGVzL2FsZXJ0LWJveC5qcyc7XG5pbXBvcnQge1xuICBKc0Rpckxpc3QsXG4gIGRpcmxpc3RPcHRpb25zXG59IGZyb20gJy4uL21vZHVsZXMvZmlsZXMvanMtZGlybGlzdC5qcyc7XG5pbXBvcnQge1xuICBNb2R1bGVFdmVudEVtaXR0ZXJcbn0gZnJvbSAnLi4vbW9kdWxlcy9tb2R1bGUtZXZlbnQtZW1pdHRlci5qcyc7XG5jb25zdCBvYmphY2NlcHQgPSB7XG4gIFwiaW1hZ2UvKlwiOiBbXCIucG5nXCIsIFwiLmpwZWdcIiwgXCIuanBnXCJdLFxuICBcInRleHQvdGFiLXNlcGFyYXRlZC12YWx1ZXNcIjogW1wiLnRzdlwiXSxcbiAgXCJhcHBsaWNhdGlvbi96aXBcIjogW1wiLnppcFwiXSxcbiAgXCJhcHBsaWNhdGlvbi9nemlwXCI6IFtcIi5nelwiXSxcbiAgXCJhcHBsaWNhdGlvbi94LWJ6aXBcIjogW1wiLmJ6XCJdLFxuICBcImFwcGxpY2F0aW9uL3gtYnppcDJcIjogW1wiLmJ6MlwiXVxufVxuY29uc3QgYWNjZXB0ID0gT2JqZWN0LnZhbHVlcyhvYmphY2NlcHQpLnJlZHVjZSgoYSwgYikgPT4gYS5jb25jYXQoYikpO1xuY3NzLmJ1dHRvbiA9ICdidXR0b24gcC0xIG14LWF1dG8gc206bXItNCBtYi00JztcbmNvbnN0IGZpbHRlcl9maWxlcyA9IHtcbiAgaW1hZ2VzOiBcInBuZyxqcGVnLGpwZyxnaWZcIixcbiAgdHN2OiBcInR4dCx0c3YsemlwLCBnemlwLGd6XCJcbn1cbmV4cG9ydCBjbGFzcyBKc015RmlsZXMge1xuICBkb25lID0gdHJ1ZTtcbiAganNEaXJUb1ppcCA9IG51bGw7XG4gIGpzRGlyTGlzdCA9IG51bGw7XG4gIHRyYXNoX2Rpcl9uYW1lID0gJ3RyYXNoLic7XG4gIGNvdW50ZXJzID0ge307XG4gIF9ldmVudHMgPSB7fTtcbiAgZXZlbnRuYW1lcyA9IHtcbiAgICBjb21wbGV0ZTogJ2NvbXBsZXRlJyxcbiAgICBlcnJvcjogJ2Vycm9yJyxcblxuICB9O1xuICByZWplY3RlZCA9IFtdO1xuICBlcnJvcmZpbGUgPSBbXTtcbiAgbGlzdGVuZXI7XG4gIGNvbnN0cnVjdG9yKGNvbnRhaW5lciwgb3B0aW9ucyA9IHt9KSB7XG4gICAgaWYgKCFjb250YWluZXIuanNteWZpbGVzKSB7XG4gICAgICBjb250YWluZXIgPSAoY29udGFpbmVyIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQpID8gY29udGFpbmVyIDogZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihjb250YWluZXIpO1xuICAgICAgaWYgKCFjb250YWluZXIpIHJldHVybjtcbiAgICAgIGRvbV9wdXJpZnkoY29udGFpbmVyLCAnZGF0YXNldCcpO1xuICAgICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7XG4gICAgICBjb25zdCBkZWZhdWx0T3B0aW9ucyA9IHtcbiAgICAgICAgY29udHJvbHM6IHtcbiAgICAgICAgICBzY2FuOiB7XG4gICAgICAgICAgICBkaXNwbGF5OiB7XG4gICAgICAgICAgICAgIGNvdW50ZXI6ICdjb3VudGVyJyxcbiAgICAgICAgICAgICAgc2l6ZTogJ3NpemUnLFxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgemlwOiB7XG4gICAgICAgICAgICBidG46IHtcbiAgICAgICAgICAgICAgemlwOiAnbWFrZXppcCcsXG4gICAgICAgICAgICAgIHppcHBlZDogJ21ha2V6aXBwZWQnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGlzcGxheToge1xuICAgICAgICAgICAgICBzaXplOiAnc2l6ZXppcHBlZCcsXG4gICAgICAgICAgICAgIGNvdW50ZXI6ICdjb3VudGVyemlwcGVkJyxcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHJlamVjdDoge1xuICAgICAgICAgICAgZGlzcGxheToge1xuICAgICAgICAgICAgICBjb3VudGVyOiAnY291bnRlcnJlamVjdGVkJ1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgZXJyb3JmaWxlOiB7XG4gICAgICAgICAgICBkaXNwbGF5OiB7XG4gICAgICAgICAgICAgIGNvdW50ZXI6ICdjb3VudGVyZXJyb3JmaWxlJ1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgdXBsb2FkOiB7XG4gICAgICAgICAgbGFiZWw6ICd1cGxvYWQnXG4gICAgICAgIH0sXG4gICAgICAgIGJ0bnByZWZpeDogJ2J0bicsXG4gICAgICAgIGJ0bmZpbGVsaXN0OiBudWxsLFxuICAgICAgICBzZWxlY3RvcnM6IHtcbiAgICAgICAgICBkcm9wdGFyZ2V0OiAnLmRyb3B0YXJnZXQnLFxuICAgICAgICAgIHRyaWdnZXI6ICcudHJpZ2dlcicsXG4gICAgICAgICAgdXBsb2FkZmlsZTogJ3VwbG9hZGZpbGUnLFxuICAgICAgICB9LFxuICAgICAgICBkaXNwbGF5OiB7XG4gICAgICAgICAgcHJvZ3Jlc3Npb246ICdkaXNwbGF5LXByb2dyZXNzaW9uJyxcbiAgICAgICAgICBkcm9wem9uZTogJ2Ryb3B6b25lJyxcbiAgICAgICAgICBib3h0aXRsZTogJ2JveHRpdGxlJyxcbiAgICAgICAgICBjb3VudGVyczogJ2NvdW50ZXJzJyxcbiAgICAgICAgICBzaXplczogJ3NpemVzJyxcbiAgICAgICAgICB0aW1lcnM6ICd0aW1lcnMnXG4gICAgICAgIH0sXG5cbiAgICAgICAgY3NzOiB7XG4gICAgICAgICAgZHJhZ292ZXI6ICdkcmFnb3ZlcidcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHRoaXMub3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oZGVmYXVsdE9wdGlvbnMsIG9wdGlvbnMpO1xuICAgICAgdGhpcy5vcHRpb25zLmJyb3dzZSA9IChjb250YWluZXIuZGF0YXNldC5icm93c2UpID8gY29udGFpbmVyLmRhdGFzZXQuYnJvd3NlLnNwbGl0KCcsJykgOiBbJ2RpcmVjdG9yeScsICdmaWxlJ107XG4gICAgICB0aGlzLmhhc3BpY2tlciA9ICh3aW5kb3cuc2hvd0RpcmVjdG9yeVBpY2tlcik7XG4gICAgICB0aGlzLnV1aWQgPSBnZW5lcmF0ZV91dWlkKCk7XG4gICAgICB0aGlzLmluaXQoKTtcbiAgICAgIGNvbnRhaW5lci5qc215ZmlsZXMgPSB0aGlzO1xuICAgIH1cbiAgICByZXR1cm4gY29udGFpbmVyLmpzbXlmaWxlcztcbiAgfVxuICBpbml0KCkge1xuICAgIC8vIGNyZWF0ZSBkaXJsaXN0IGJveFxuICAgIHRoaXMuYWRkRGlzcGxheVByb2dyZXNzaW9uKCk7XG4gICAgdGhpcy5hZGREcm9wem9uZSgpO1xuICAgIHRoaXMuYWRkRGlyTGlzdCgpO1xuICAgIHRoaXMuaW5pdENvbnRyb2xzKCk7XG4gICAgdGhpcy5pbml0RXZlbnRzKCkudGhlbigoKSA9PiB7XG4gICAgICB0aGlzLnJlc2V0Q291bnRlcnMoKTtcbiAgICB9KTtcbiAgfVxuICBpbml0VGltZXIoKSB7XG4gICAgdGhpcy50aW1lciA9IG5ldyBEYXRlKCk7XG4gIH1cbiAgYXN5bmMgaW5pdEV2ZW50cygpIHtcbiAgICAvL1RvIGJlIHJlZmFjdG9yZWQgLSBmb3Igc3RlcHBlcnMgKVxuICAgIE1vZHVsZUV2ZW50RW1pdHRlci5vbih0aGlzLmV2ZW50bmFtZXMucHJvY2Vzc2VkLCBhc3luYyAoZSkgPT4ge1xuICAgICAgaWYgKHRoaXMubmV4dGFjdGlvbikgYXdhaXQgdGhpcy5uZXh0YWN0aW9uKCk7XG4gICAgfSwgdGhpcy51dWlkKTtcbiAgICBjb25zdCBzZWxmID0gdGhpcztcbiAgICBpZiAodGhpcy5vcHRpb25zLmNvbnRyb2xzLnppcCkge1xuICAgICAgY29uc3Qge1xuICAgICAgICBKc0RpclRvWmlwXG4gICAgICB9ID0gYXdhaXQgaW1wb3J0KCcuLi9tb2R1bGVzL2ZpbGVzL2pzLWRpcnRvemlwLmpzJyk7XG4gICAgICB0aGlzLmpzRGlyVG9aaXAgPSBKc0RpclRvWmlwKHtcbiAgICAgICAgbGlzdGVuZXI6IHRoaXMudXVpZFxuICAgICAgfSk7XG5cbiAgICAgIE9iamVjdC5rZXlzKHRoaXMuanNEaXJUb1ppcC5ldmVudG5hbWVzKS5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgICAgdGhpcy5ldmVudG5hbWVzW2tleV0gPSB0aGlzLmpzRGlyVG9aaXAuZXZlbnRuYW1lc1trZXldO1xuICAgICAgICBNb2R1bGVFdmVudEVtaXR0ZXIub24oa2V5LCAoZSkgPT4ge1xuICAgICAgICAgIHN3aXRjaCAoa2V5KSB7XG4gICAgICAgICAgICBjYXNlIHRoaXMuZXZlbnRuYW1lcy5jb3VudGVyOlxuICAgICAgICAgICAgICB0aGlzLmZpbGVDb3VudGVyKGUpO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgdGhpcy5ldmVudG5hbWVzLnJlamVjdDpcbiAgICAgICAgICAgICAgdGhpcy5yZWplY3RlZC5wdXNoKGUucGF0aCk7XG4gICAgICAgICAgICAgIHRoaXMuZmlsZUNvdW50ZXIoe1xuICAgICAgICAgICAgICAgIG5hbWU6ICdyZWplY3QnLFxuICAgICAgICAgICAgICAgIHBhdGg6IGUucGF0aCxcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSB0aGlzLmV2ZW50bmFtZXMuZm9sbG93OlxuICAgICAgICAgICAgY2FzZSB0aGlzLmV2ZW50bmFtZXMuY29tcGxldGU6XG4gICAgICAgICAgICAgIGlmICghZSB8fCAhZS5oYXNPd25Qcm9wZXJ0eShcIm5hbWVcIikgfHwgZS5uYW1lID09PSBcIlwiKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ25vIGVtaXQgY29tcGxldGUgbmFtZScgKyBrZXksIGUpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBzZWxmLnNob3dDb250cm9sKGUubmFtZSwgZSk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSB0aGlzLmV2ZW50bmFtZXMubWVzc2FnZTpcbiAgICAgICAgICAgICAgc3dpdGNoIChlLm5hbWUpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdjb25zb2xlJzpcbiAgICAgICAgICAgICAgICAgIHRoaXMuYWRkQ29uc29sZU1lc3NhZ2Uoe1xuICAgICAgICAgICAgICAgICAgICBpZDogKGUuaWQpID8gZS5pZCA6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGUubWVzc2FnZSxcbiAgICAgICAgICAgICAgICAgICAgcGFyZW50OiB0aGlzLmNvbnRhaW5lclxuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgIGNhc2UgJ2Jyb3dzZXInOlxuICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlbnRyeSkgdGhpcy5kZXRhY2hEcm9wem9uZSgpO1xuICAgICAgICAgICAgICAgICAgIEFsZXJ0Qm94LmFkZEFsZXJ0KHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogQWxlcnRCb3guYWxlcnRjb25maWcudHlwZXMuZGFuZ2VyLFxuICAgICAgICAgICAgICAgICAgICBjb250ZW50OiBlLm1lc3NhZ2UsXG4gICAgICAgICAgICAgICAgICAgIGRpc21pc3NpYmxlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgaW52ZXJzZTogZmFsc2VcbiAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSB0aGlzLmV2ZW50bmFtZXMuZXJyb3JmaWxlOlxuICAgICAgICAgICAgICAgICAgICBzZWxmLnNob3dDb250cm9sKGUubmFtZSwgZSk7XG4gICAgICAgICAgICAgICAgICAgIGUubmFtZT1BbGVydEJveC5hbGVydGNvbmZpZy50eXBlcy5lcnJvcjtcbiAgICAgICAgICAgICAgICAgICAgZS5tZXNzYWdlKz0oZS5wYXRoKT8nICcrZS5wYXRoOicnO1xuICAgICAgICAgICAgICAgIGNhc2UgQWxlcnRCb3guYWxlcnRjb25maWcudHlwZXMuZXJyb3I6XG4gICAgICAgICAgICAgICAgY2FzZSBBbGVydEJveC5hbGVydGNvbmZpZy50eXBlcy5zdWNjZXNzOlxuICAgICAgICAgICAgICAgIGNhc2UgQWxlcnRCb3guYWxlcnRjb25maWcudHlwZXMuZGFuZ2VyOlxuICAgICAgICAgICAgICAgIGNhc2UgQWxlcnRCb3guYWxlcnRjb25maWcudHlwZXMuaW5mbzpcbiAgICAgICAgICAgICAgICAgIEFsZXJ0Qm94LmFkZEFsZXJ0KHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogZS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICBjb250ZW50OiBlLm1lc3NhZ2UsXG4gICAgICAgICAgICAgICAgICAgIGRpc21pc3NpYmxlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBpbnZlcnNlOiBmYWxzZVxuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgQWxlcnRCb3guYWRkQWxlcnQoe1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiBBbGVydEJveC5hbGVydGNvbmZpZy50eXBlcy5pbmZvLFxuICAgICAgICAgICAgICAgICAgICBjb250ZW50OiBlLm1lc3NhZ2UsXG4gICAgICAgICAgICAgICAgICAgIGRpc21pc3NpYmxlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBpbnZlcnNlOiB0cnVlXG4gICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfSwgdGhpcy51dWlkKTtcbiAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5qc0RpclRvWmlwLmJyb3dzZXJSZXF1aXJlZCgpIDtcbiAgICB9XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2JlZm9yZXVubG9hZCcsIChlKSA9PiB7XG4gICAgICBpZiAoIXRoaXMuZG9uZSkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGUucmV0dXJuVmFsdWUgPSAodGhpcy5vcHRpb25zLnByZXZlbnRjbG9zZSkgPyB0aGlzLm9wdGlvbnMucHJldmVudGNsb3NlIDogYFNvbWUgd29yayBpcyBpbiBwcm9ncmVzcyBpbiB0aGlzIHdpbmRvdy5cXG5BcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gbGVhdmU/YDtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuICBlbWl0VG9aaXAoYnRuKSB7XG4gICAgY29uc3QgbWVzc2FnZSA9IChidG4uZGF0YXNldC5tZXNzYWdlKSA/IEpTT04ucGFyc2UoYnRuLmRhdGFzZXQubWVzc2FnZSkgOiBudWxsO1xuICAgIGlmICghbWVzc2FnZSkgYnRuLmNsYXNzTGlzdC5hZGQoY3NzLmhpZGUpO1xuICAgIGlmIChtZXNzYWdlKSB7XG4gICAgICBpZiAobWVzc2FnZS5uYW1lKSB7XG4gICAgICAgIGNvbnN0IG5hbWUgPSBtZXNzYWdlLm5hbWU7XG4gICAgICAgIGRlbGV0ZSBtZXNzYWdlLm5hbWU7XG4gICAgICAgIE1vZHVsZUV2ZW50RW1pdHRlci5lbWl0KG5hbWUsIG1lc3NhZ2UsIHRoaXMuanNEaXJUb1ppcC51dWlkKTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKG5hbWUgPT09IHRoaXMuZXZlbnRuYW1lcy5zZW5kZmlsZSkgYnRuLmRpc2FibGVkID0gdHJ1ZTtcbiAgfVxuXG4gIHF1b3RhRXN0aW1hdGUob2JqKSB7XG4gICAgcmV0dXJuIHRoaXMuanNEaXJUb1ppcC5xdW90YUVzdGltYXRlKCk7XG4gIH1cbiAgc2NhbkJyb3dzZShlLCBvcHRpb25zKSB7XG5cbiAgICByZXR1cm4gdGhpcy5qc0RpclRvWmlwLnNjYW5Ccm93c2UoZSwgb3B0aW9ucyk7XG4gIH1cbiAgc2NhbkhhbmRsZShkaXIsIG9wdGlvbnMpIHtcbiAgICByZXR1cm4gdGhpcy5qc0RpclRvWmlwLnNjYW5IYW5kbGUoZGlyLCBvcHRpb25zKTtcbiAgfVxuICBhc3luYyBoYW5kbGVCcm93c2UoZSkge1xuICAgIGlmICghdGhpcy5zZXRVcGxvYWRFbnRyeSgpKSByZXR1cm47XG4gICAgdGhpcy5pbml0VGltZXIoKTtcbiAgICB0aGlzLnRvZ2dsZUNvdW50ZXJzKHRydWUpO1xuICAgIGlmICghdGhpcy5oYXNwaWNrZXIpIGUgPSBlLnRhcmdldC5maWxlcztcbiAgICBhd2FpdCB0aGlzLnNjYW5Ccm93c2UoZSwge1xuICAgICAgYWNjZXB0OiBhY2NlcHQsXG4gICAgfSk7XG4gIH1cblxuICBhZGREcm9wem9uZSgpIHsgLy9cbiAgICB0aGlzLmRyb3B6b25lID0gY3JlYXRlX2JveCgnZGl2Jywge1xuICAgICAgaWQ6IHRoaXMub3B0aW9ucy5kaXNwbGF5LmRyb3B6b25lXG4gICAgfSk7XG4gICAgY29uc3QgaW5wdXQgPSAodGhpcy5oYXNwaWNrZXIpID8gbnVsbCA6IGNyZWF0ZV9ib3goJ2lucHV0Jywge1xuICAgICAgdHlwZTogXCJmaWxlXCIsXG4gICAgICBuYW1lOiB0aGlzLm9wdGlvbnMuc2VsZWN0b3JzLnVwbG9hZGZpbGUsXG4gICAgICBpZDogdGhpcy5vcHRpb25zLnNlbGVjdG9ycy51cGxvYWRmaWxlLFxuICAgICAgbXVsdGlwbGU6IHRydWUsXG4gICAgICBhbGxvd2RpcnM6IHRydWUsXG4gICAgICBhY2NlcHQ6IGFjY2VwdCxcbiAgICAgIGNsYXNzOiAnaGlkZGVuJ1xuICAgIH0sIHRoaXMuZHJvcHpvbmUpO1xuICAgIGlmIChpbnB1dCkgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCAoZSkgPT4ge1xuICAgICAgdGhpcy5oYW5kbGVCcm93c2UoZSlcbiAgICB9KTtcbiAgICBjb25zdCBidG5zID0gY3JlYXRlX2JveCgnZGl2Jywge30sXG4gICAgICB0aGlzLmRyb3B6b25lKTtcblxuICAgIHRoaXMub3B0aW9ucy5icm93c2UuZm9yRWFjaChvcHQgPT4ge1xuICAgICAgY29uc3QgdGV4dCA9ICh0aGlzLmNvbnRhaW5lci5kYXRhc2V0W2B0ZXh0YnJvd3NlJHtvcHR9YF0pID8gdGhpcy5jb250YWluZXIuZGF0YXNldFtgdGV4dGJyb3dzZSR7b3B0fWBdIDogYGJyb3dzZSR7b3B0fWA7XG4gICAgICBjb25zdCBidG4gPSBjcmVhdGVfYm94KCdzcGFuJywge1xuICAgICAgICBjbGFzczogdGhpcy5vcHRpb25zLnNlbGVjdG9ycy50cmlnZ2VyLnNsaWNlKDEpLFxuICAgICAgICBkYXRhc2V0OiB7XG4gICAgICAgICAgdHlwZTogb3B0XG4gICAgICAgIH0sXG4gICAgICAgIHRleHQ6IHRleHRcbiAgICAgIH0sIGJ0bnMpO1xuXG4gICAgICBidG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoZSkgPT4ge1xuICAgICAgICBpZiAodGhpcy5oYXNwaWNrZXIpIHtcbiAgICAgICAgICB0aGlzLm9wZW5EaXJEaWFsb2cob3B0LCAoZSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVCcm93c2UoZSlcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAob3B0ID09PSBcImRpcmVjdG9yeVwiKSB7XG4gICAgICAgICAgICBpbnB1dC5kaXJlY3RvcnkgPSB0cnVlO1xuICAgICAgICAgICAgaW5wdXQud2Via2l0ZGlyZWN0b3J5ID0gdHJ1ZTtcbiAgICAgICAgICB9IGVsc2UgeyAvL2ZpbGVcbiAgICAgICAgICAgIGlucHV0LmRpcmVjdG9yeSA9IGZhbHNlO1xuICAgICAgICAgICAgaW5wdXQud2Via2l0ZGlyZWN0b3J5ID0gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlucHV0LmRpc3BhdGNoRXZlbnQobmV3IE1vdXNlRXZlbnQoXCJjbGlja1wiKSk7XG5cbiAgICAgICAgfVxuICAgICAgICAvLyBpZiBvdGhlciBmdW5jdGlvbmFsaXRpZXMgYWRkIGNvbnRyb2xzICggbGlrZSBpbXBvcnQpIGNsZWFyXG4gICAgICAgIGlmKHRoaXMuZXZlbnRuYW1lcy5jbGVhcm90aGVyKSBNb2R1bGVFdmVudEVtaXR0ZXIuZW1pdCh0aGlzLmV2ZW50bmFtZXMuY2xlYXJvdGhlcix7fSx0aGlzLnV1aWQpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBjb25zdCBzcGFuZHJvcCA9IGNyZWF0ZV9ib3goJ3NwYW4nLCB7XG4gICAgICB0ZXh0OiB0aGlzLmNvbnRhaW5lci5kYXRhc2V0LnRleHRkcm9wXG4gICAgfSwgYnRucyk7XG4gICAgY29uc3QgYnJvd3NlbGluayA9IGNyZWF0ZV9ib3goJ2EnLCB7XG4gICAgdGV4dDp0aGlzLmNvbnRhaW5lci5kYXRhc2V0LnRleHRicm93c2UsY2xhc3M6J21vZGFsJywgc3BhbmRyb3B9KVxuICB9XG5cbiAgdG9nZ2xlRHJvcFRhcmdldChvbiA9IHRydWUpIHtcbiAgICBjb25zdCBzZWxmID0gdGhpcztcbiAgICAgY29uc3QgZHJvcHRhcmdldCA9ICh0aGlzLmFjdGl2ZW50cnkpID8gdGhpcy5hY3RpdmVudHJ5LmNvbnRhaW5lciA6IG51bGw7XG4gICAgaWYgKGRyb3B0YXJnZXQgPT09IG51bGwpIHJldHVybjtcblxuICAgIGZ1bmN0aW9uIGhpZ2hsaWdodChlKSB7XG4gICAgICAgIGRyb3B0YXJnZXQuY2xhc3NMaXN0LmFkZChjc3NkcmFnb3ZlcilcbiAgICB9XG4gICAgZnVuY3Rpb24gdW5oaWdobGlnaHQoZSkge1xuICAgICAgICBkcm9wdGFyZ2V0LmNsYXNzTGlzdC5yZW1vdmUoY3NzZHJhZ292ZXIpO1xuICAgIH1cbiAgICBjb25zdCBjc3NkcmFnb3ZlciA9ICh0aGlzLmpzRGlyTGlzdCkgPyAodGhpcy5qc0Rpckxpc3Qub3B0aW9ucy5lbnRyeSkgPyB0aGlzLmpzRGlyTGlzdC5vcHRpb25zLmVudHJ5LmNzcy5kcmFnb3ZlciA6IHRoaXMub3B0aW9ucy5jc3MuZHJhZ292ZXIgOiB0aGlzLm9wdGlvbnMuY3NzLmRyYWdvdmVyO1xuICAgIGNvbnN0IHRhcmdldF9kcmFnb3ZlciA9IChlKSA9PiB7ZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgaWYgKCF0aGlzLmRyYWdvdmVyICYmIHRoaXMuYWN0aXZlbnRyeSAmJiB0aGlzLmFjdGl2ZW50cnkuY29udGFpbmVyID09PSBlLmN1cnJlbnRUYXJnZXQpIHtcbiAgICAgICAgZHJvcHRhcmdldC5jbGFzc0xpc3QuYWRkKGNzc2RyYWdvdmVyKTtcbiAgICAgIH1cbiAgICBlLmRhdGFUcmFuc2Zlci5kcm9wRWZmZWN0ID0gXCJtb3ZlXCI7XG4gICAgfVxuICAgIGNvbnN0IHRhcmdldF9kcm9wID0gYXN5bmMgKGUpID0+IHsgYXdhaXQgc2VsZi5oYW5kbGVEcm9wKGUpO31cbiAgICAvLyBzZXQgZXZlbnRzIGFuZCBjc3MgZm9yIG5ldyBkcm9wem9uZVxuICAgIGlmIChvbiA9PT0gZmFsc2UpIHtcbiAgICAgWydkcmFnZW50ZXInLCAnZHJhZ292ZXInXS5mb3JFYWNoKGV2ZW50bmFtZSA9PiB7XG4gICAgICAgIGRyb3B0YXJnZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudG5hbWUsIGhpZ2hsaWdodCwgZmFsc2UpO1xuICAgIH0pO1xuICAgIFsnZHJhZ2xlYXZlJywgJ2Ryb3AnXS5mb3JFYWNoKGV2ZW50bmFtZSA9PiB7XG4gICAgICAgIGRyb3B0YXJnZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudG5hbWUsIHVuaGlnaGxpZ2h0LCBmYWxzZSk7XG4gICAgfSk7XG4gICAgICBkcm9wdGFyZ2V0LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2Ryb3AnLCB0YXJnZXRfZHJvcCk7XG4gICAgICBkcm9wdGFyZ2V0LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5vcHRpb25zLnNlbGVjdG9ycy5kcm9wdGFyZ2V0LnN1YnN0cigxKSk7XG4gICAgfSBlbHNlIHtcbiAgICBbJ2RyYWdlbnRlcicsICdkcmFnb3ZlciddLmZvckVhY2goZXZlbnRuYW1lID0+IHtcbiAgICAgICAgZHJvcHRhcmdldC5hZGRFdmVudExpc3RlbmVyKGV2ZW50bmFtZSwgaGlnaGxpZ2h0LCBmYWxzZSk7XG4gICAgfSk7XG4gICAgWydkcmFnbGVhdmUnLCAnZHJvcCddLmZvckVhY2goZXZlbnRuYW1lID0+IHtcbiAgICBkcm9wdGFyZ2V0LmFkZEV2ZW50TGlzdGVuZXIoZXZlbnRuYW1lLCB1bmhpZ2hsaWdodCwgZmFsc2UpO1xuICAgIH0pO1xuICAgICAgZHJvcHRhcmdldC5hZGRFdmVudExpc3RlbmVyKCdkcm9wJywgdGFyZ2V0X2Ryb3ApO1xuICAgICAgZHJvcHRhcmdldC5jbGFzc0xpc3QuYWRkKHRoaXMub3B0aW9ucy5zZWxlY3RvcnMuZHJvcHRhcmdldC5zdWJzdHIoMSkpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGFkZERpckxpc3QoKSB7XG4gICAgdGhpcy5qc0Rpckxpc3QgPSBuZXcgSnNEaXJMaXN0KHRoaXMuY29udGFpbmVyKTtcbiAgICB0aGlzLmFjdGl2ZW50cnkgPSB0aGlzLmpzRGlyTGlzdC5yb290O1xuICAgIHRoaXMucm9vdGl0ZW0gPSB0aGlzLnRhcmdldGl0ZW0gPSB0aGlzLmFjdGl2ZW50cnkuY29udGFpbmVyO1xuICAgIE1vZHVsZUV2ZW50RW1pdHRlci5vbih0aGlzLmpzRGlyTGlzdC5ldmVudG5hbWVzLmF0dGFjaCwgKGUpID0+IHtcbiAgICAgIGlmICghZS5lbnRyeSkgcmV0dXJuO1xuICAgICAgaWYgKGUuZW50cnkgIT09IHRoaXMuYWN0aXZlbnRyeSAmJiB0aGlzLmFjdGl2ZW50cnkuaXNCcmFuY2godHJ1ZSkpIHRoaXMuZGV0YWNoRHJvcHpvbmUoKTtcbiAgICAgIHRoaXMuYWN0aXZlbnRyeSA9IGUuZW50cnk7XG4gICAgICB0aGlzLnRhcmdldGl0ZW0gPSB0aGlzLmFjdGl2ZW50cnkuY29udGFpbmVyO1xuICAgICAgaWYgKHRoaXMuYWN0aXZlbnRyeS5pc0JyYW5jaCh0cnVlKSkgdGhpcy5hZGRVcGxvYWREaWFsb2coKTtcbiAgICB9LCB0aGlzLmpzRGlyTGlzdC51dWlkKTtcbiAgICBNb2R1bGVFdmVudEVtaXR0ZXIub24odGhpcy5qc0Rpckxpc3QuZXZlbnRuYW1lcy5kZXRhY2gsIChlKSA9PiB7XG4gICAgICB0aGlzLmRldGFjaERyb3B6b25lKCk7XG4gICAgICB0aGlzLmFjdGl2ZW50cnkgPSBudWxsO1xuICAgICAgdGhpcy51cGxvYWRlbnRyeSA9IG51bGw7XG4gICAgICB0aGlzLnRhcmdldGl0ZW0gPSBudWxsO1xuICAgIH0sIHRoaXMuanNEaXJMaXN0LnV1aWQpO1xuICAgIE1vZHVsZUV2ZW50RW1pdHRlci5vbih0aGlzLmpzRGlyTGlzdC5ldmVudG5hbWVzLmFjdGlvbiwgKGUpID0+IHtcbiAgICAgIHN3aXRjaCAoZS5hY3Rpb24pIHtcbiAgICAgICAgY2FzZSBcImRyb3BcIjpcbiAgICAgICAgICB0aGlzLmhhbmRsZURyb3AoZS5ldmVudCk7XG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICBjb25zb2xlLmxvZygnYWN0aW9uIG5vdCBtYW5hZ2VkICcgKyBlLmFjdGlvbiwgZSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfSwgdGhpcy5qc0Rpckxpc3QudXVpZCk7XG4gICAgdGhpcy5hY3RpdmVudHJ5LmxhYmVsLmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCdjbGljaycpKTtcbiAgfVxuXG4gIGFkZERpc3BsYXlQcm9ncmVzc2lvbigpIHtcbiAgICAvLyBhZGQgY291bnRlcnNcbiAgICBpZiAodGhpcy5kaXNwbGF5cHJvZ3Jlc3Npb24pIHJldHVybjtcbiAgICBsZXQgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLm9wdGlvbnMuZGlzcGxheS5wcm9ncmVzc2lvbik7XG4gICAgaWYgKCFlbCkge1xuICAgICAgZWwgPSBjcmVhdGVfYm94KCdkaXYnLCB7XG4gICAgICAgIGlkOiB0aGlzLm9wdGlvbnMuZGlzcGxheS5wcm9ncmVzc2lvblxuICAgICAgfSwgdGhpcy5jb250YWluZXIpO1xuICAgICAgZWwuaW5zZXJ0QWRqYWNlbnRIVE1MKCdhZnRlcmJlZ2luJywgYDxkaXYgY2xhc3M9XCIke3RoaXMub3B0aW9ucy5kaXNwbGF5LnByb2dyZXNzaW9ufVwiPjxkaXYgY2xhc3M9XCIke3RoaXMub3B0aW9ucy5kaXNwbGF5LmNvdW50ZXJzfVwiPjwvZGl2PjxkaXYgY2xhc3M9XCIke3RoaXMub3B0aW9ucy5kaXNwbGF5LnNpemVzfVwiPjwvZGl2PjxkaXYgY2xhc3M9XCIke2Nzcy5wcm9ncmVzc31cIj48L2Rpdj48ZGl2IGNsYXNzPVwiJHt0aGlzLm9wdGlvbnMuZGlzcGxheS50aW1lcnN9XCI+PC9kaXY+PC9kaXY+YCk7XG4gICAgICB0aGlzLmRpc3BsYXlwcm9ncmVzc2lvbiA9IGVsO1xuICAgIH1cbiAgfVxuICBlbmFibGVEcm9wem9uZShlbmFibGUgPSB0cnVlLCBkZXN0cm95ID0gZmFsc2UpIHtcbiAgICBpZiAoZGVzdHJveSB8fCBlbmFibGUgPT09IGZhbHNlKSB0aGlzLmRyb3B6b25lLmNsYXNzTGlzdC5hZGQoY3NzLmhpZGUpO1xuICAgIGlmIChlbmFibGUpIHtcbiAgICAgIHRoaXMuZHJvcHpvbmUuZGF0YXNldC5hY3RpdmUgPSB0cnVlO1xuICAgICAgdGhpcy5kcm9wem9uZS5jbGFzc0xpc3QucmVtb3ZlKGNzcy5oaWRlKTtcbiAgICB9IGVsc2UgZGVsZXRlIHRoaXMuZHJvcHpvbmUuZGF0YXNldC5hY3RpdmU7XG4gIH1cbiAgLy9cbiAgYXR0YWNoRHJvcHpvbmUoKSB7XG4gICAgaWYgKHRoaXMuZHJvcHpvbmUuZGF0YXNldC5hY3RpdmUpIHtcbiAgICAgIHRoaXMudGFyZ2V0aXRlbS5pbnNlcnRCZWZvcmUodGhpcy5kcm9wem9uZSwgdGhpcy5hY3RpdmVudHJ5LmxhYmVsLm5leHRFbGVtZW50U2libGluZyk7XG4gICAgICB0aGlzLnRvZ2dsZURyb3BUYXJnZXQodHJ1ZSk7XG4gICAgfVxuICAgIFsnZHJhZ292ZXInLCAnZHJhZ2VudGVyJ10uZm9yRWFjaChldmVudG5hbWUgPT4ge1xuICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihldmVudG5hbWUsIGZ1bmN0aW9uKGUpIHtlLnByZXZlbnREZWZhdWx0KCk7fSwgZmFsc2UpO1xuICAgIH0pO1xuICB9XG4gIGRldGFjaERyb3B6b25lKCkge1xuICAgIHRoaXMuZW5hYmxlRHJvcHpvbmUoZmFsc2UpO1xuICAgIHRoaXMudG9nZ2xlRHJvcFRhcmdldChmYWxzZSk7XG4gIH1cblxuICBvcGVuRGlyRGlhbG9nKHR5cGUsIGNhbGxiYWNrKSB7XG4gICAgLy8gaWYgY2hyb21lIDg2ICwgZWRnZSA4Niwgb3BlcmEgNzJcbiAgICBjb25zdCBzaG93cGljayA9ICh0eXBlID09PSBcImRpcmVjdG9yeVwiKSA/IHdpbmRvdy5zaG93RGlyZWN0b3J5UGlja2VyIDogd2luZG93LnNob3dPcGVuRmlsZVBpY2tlcjtcbiAgICBjb25zdCBwaWNrb3B0cyA9ICh0eXBlID09PSBcImRpcmVjdG9yeVwiKSA/IHtcbiAgICAgIG1vZGU6IFwicmVhZFwiLFxuICAgICAgbXVsdGlwbGU6IHRydWVcbiAgICB9IDoge1xuICAgICAgdHlwZXM6IFt7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIkltYWdlcywudHN2LCB6aXAsIGd6aXAsIHRhciBmaWxlc1wiLFxuICAgICAgICBhY2NlcHQ6IG9iamFjY2VwdCxcbiAgICAgIH0sIF0sXG4gICAgICBleGNsdWRlQWNjZXB0QWxsT3B0aW9uOiB0cnVlLFxuICAgICAgbXVsdGlwbGU6IHRydWUsXG4gICAgfTtcbiAgICBzaG93cGljayhwaWNrb3B0cykudGhlbihwaWNrID0+IHtcbiAgICAgIGNhbGxiYWNrKHBpY2spO1xuICAgIH0pO1xuICB9XG5cbiAgc2V0VXBsb2FkRW50cnkoKSB7XG4gICAgaWYgKHRoaXMudXBsb2FkZW50cnkgJiYgdGhpcy51cGxvYWRlbnRyeSAhPT0gdGhpcy5hY3RpdmVudHJ5KSB7XG4gICAgICBBbGVydEJveC5hZGRBbGVydCh7XG4gICAgICAgIHR5cGU6IFwiZXJyb3JcIixcbiAgICAgICAgY29udGVudDogJ09ubHkgb25lIHVwbG9hZCBkZXN0aW5hdGlvbiBhdXRob3JpemVkLiBDbG9zZSBhbmQgdXBsb2FkIHRoZSBjdXJyZW50IHppcGZpbGUuJyxcbiAgICAgICAgZGlzbWlzc2libGU6IHRydWUsXG4gICAgICAgIGludmVyc2U6IHRydWVcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICB0aGlzLnVwbG9hZGVudHJ5ID0gdGhpcy5hY3RpdmVudHJ5O1xuICAgICBNb2R1bGVFdmVudEVtaXR0ZXIuZW1pdCh0aGlzLmpzRGlyVG9aaXAuZXZlbnRuYW1lcy5zZXR1cGxvYWRwYXRoLCB7bmFtZTp0aGlzLmpzRGlyVG9aaXAuZXZlbnRuYW1lcy5zZXR1cGxvYWRwYXRoLCBwYXRoOnRoaXMudXBsb2FkZW50cnkuZ2V0Q3VycmVudERpclBhdGgoKX0sIHRoaXMuanNEaXJUb1ppcC51dWlkKTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICAvLyBkcmFnJmRyb3BcblxuXG4gIGFzeW5jIGhhbmRsZURyb3AoZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIGlmICghdGhpcy5zZXRVcGxvYWRFbnRyeSgpKSByZXR1cm47XG4gICAgbGV0IGRhdGFUcmFuc2ZlcjtcbiAgICBpZiAoZS5kYXRhVHJhbnNmZXIpIHtcbiAgICAgIGRhdGFUcmFuc2ZlciA9IGUuZGF0YVRyYW5zZmVyO1xuICAgIH0gZWxzZSBkYXRhVHJhbnNmZXIgPSBlO1xuICAgIHRoaXMuaW5pdFRpbWVyKCk7XG4gICAgY29uc3QgaXRlbXMgPSBbLi4uKChkYXRhVHJhbnNmZXIuaXRlbXMpID8gZGF0YVRyYW5zZmVyLml0ZW1zIDogZGF0YVRyYW5zZmVyLmZpbGVzKV07XG4gICAgaWYgKGl0ZW1zLmxlbmd0aCkge1xuICAgICAgdGhpcy5lbmFibGVEcm9wem9uZShmYWxzZSk7XG4gICAgICBhd2FpdCBpdGVtcy5mb3JFYWNoKGFzeW5jIGl0ZW0gPT4ge1xuICAgICAgICBpZiAoaXRlbS5raW5kID09PSBcImZpbGVcIikge1xuICAgICAgICAgIGl0ZW0gPSBhd2FpdCBpdGVtLndlYmtpdEdldEFzRW50cnkoKTtcbiAgICAgICAgICB0aGlzLnRvZ2dsZUNvdW50ZXJzKHRydWUpO1xuICAgICAgICAgIGF3YWl0IHRoaXMuc2NhbkhhbmRsZShpdGVtKTtcblxuICAgICAgICB9XG4gICAgICB9KVxuICAgIH1cbiAgfVxuICAgc2hvd0NvbXBsZXRlKCkge1xuICAgIHRoaXMudGltZXIgPSAobmV3IERhdGUoKSAtIHRoaXMudGltZXIpIC8gMTAwMDtcbiAgICB0aGlzLmVuYWJsZURyb3B6b25lKHRydWUpO1xuICB9XG5cbiAgc3RvcE9uRXJyb3IoZXJyKSB7XG4gICAgY29uc29sZS5sb2coJ2VycicsIGVycik7XG4gIH1cblxuICBhZGRDb25zb2xlTWVzc2FnZShtZXNzYWdlKSB7XG4gICAgLy9tZXNzYWdlIHttZXNzYWdlOiwgcGFyZW50On1cbiAgICBtZXNzYWdlLnBhcmVudCA9IChtZXNzYWdlLnBhcmVudCkgPyBtZXNzYWdlLnBhcmVudCA6IHRoaXMuY29udGFpbmVyO1xuICAgIEFsZXJ0Qm94LmFkZENvbnNvbGUobWVzc2FnZSk7XG4gIH1cblxuICBhZGRVcGxvYWREaWFsb2coKSB7XG4gICAgaWYgKHRoaXMub3B0aW9ucy5jb250cm9scy5zY2FuKSB7XG4gICAgICB0aGlzLmVuYWJsZURyb3B6b25lKHRydWUpO1xuICAgICAgdGhpcy5hdHRhY2hEcm9wem9uZSgpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGFkZEZpbGVzU3RvcmUobmFtZSwgY2FsbGJhY2spIHtcbiAgICBuYW1lID0gKG5hbWUpID8gbmFtZSA6IHRoaXMub3B0aW9ucy5kYm5hbWU7XG4gICAgaWYgKCF0aGlzLmpzRmlsZXNTdG9yZSkge1xuICAgICAgY29uc3Qge1xuICAgICAgICBKc0ZpbGVzU3RvcmVcbiAgICAgIH0gPSBhd2FpdCBpbXBvcnQoJy4uL21vZHVsZXMvZmlsZXMvanMtZmlsZXN5c3RlbS5qcycpO1xuICAgICAgdGhpcy5qc0ZpbGVzU3RvcmUgPSBuZXcgSnNGaWxlc1N0b3JlKG51bGwsIGNhbGxiYWNrKTtcbiAgICAgIHRoaXMuZGlzcGxheUZpbGVzKCk7XG4gICAgfVxuICAgIGlmIChjYWxsYmFjaykgYXdhaXQgY2FsbGJhY2soKTtcbiAgfVxuICBkaXNwbGF5RmlsZXMoKSB7XG4gICAgdGhpcy5qc0ZpbGVzU3RvcmUuZ2V0SXRlbXMoJ2xvY2FsJyk7XG4gIH1cblxuICBmaWxlQ291bnRlcihlKSB7XG4gICAgY29uc3QgY291bnRlcnMgPSB0aGlzLmNvdW50ZXJzW2UubmFtZV07XG4gICAgY291bnRlcnMuY291bnRlciArPSAxO1xuICAgIGlmIChlLnNpemUgIT09IG51bGwpIGNvdW50ZXJzLnNpemUgKz0gcGFyc2VJbnQoZS5zaXplKTtcbiAgICBjb3VudGVycy5kaXNwbGF5LmNvdW50ZXIudGV4dENvbnRlbnQgPSBjb3VudGVycy5jb3VudGVyO1xuICAgIGlmIChjb3VudGVycy5kaXNwbGF5LnNpemUpIGNvdW50ZXJzLmRpc3BsYXkuc2l6ZS50ZXh0Q29udGVudCA9IGZvcm1hdF9ieXRlcyhjb3VudGVycy5zaXplKTtcbiAgICB0aGlzLnF1b3RhRXN0aW1hdGUoKTtcbiAgfVxuXG4gIHJlc2V0Q291bnRlcihpdGVtKSB7XG4gICAgY29uc3QgY291bnRlcnMgPSB0aGlzLmNvdW50ZXJzW2l0ZW1dO1xuICAgIFsnY291bnRlcicsICdzaXplJ10uZm9yRWFjaChlbCA9PiB7XG4gICAgICBpZiAoY291bnRlcnMuZGlzcGxheVtlbF0pIHtcbiAgICAgICAgY291bnRlcnNbZWxdID0gMDtcbiAgICAgICAgY291bnRlcnMuZGlzcGxheVtlbF0udGV4dENvbnRlbnQgPSAwO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG4gIHJlc2V0Q291bnRlcnMoKSB7XG4gICAgT2JqZWN0LmtleXModGhpcy5vcHRpb25zLmNvbnRyb2xzKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgICB0aGlzLnJlc2V0Q291bnRlcihrZXkpO1xuICAgIH0pO1xuICAgIHRoaXMudG9nZ2xlQ291bnRlcnMoZmFsc2UpO1xuICB9XG4gIHRvZ2dsZUNvdW50ZXJzKHNob3cgPSB0cnVlKSB7XG4gICAgY29uc3QgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLm9wdGlvbnMuZGlzcGxheS5wcm9ncmVzc2lvbik7XG4gICAgaWYgKCFlbCkgcmV0dXJuO1xuICAgIGlmIChzaG93KSBlbC5jbGFzc0xpc3QucmVtb3ZlKGNzcy5oaWRlKTtcbiAgICBlbHNlIGVsLmNsYXNzTGlzdC5hZGQoY3NzLmhpZGUpO1xuICB9XG5cbiAgaW5pdEZpbGVDb3VudGVyKGl0ZW0sIG9wdHMsIGkpIHtcbiAgICBjb25zdCBzZXAgPSAoaSkgPyBgIC8gYCA6IGBgO1xuICAgIGxldCBjb3VudGVyID0gMDtcbiAgICBsZXQgY291bnRlcmRpc3BsYXkgPSBudWxsO1xuICAgIGxldCBzaXplID0gMDtcbiAgICBsZXQgc2l6ZWRpc3BsYXkgPSBudWxsO1xuICAgIC8vIGNyZWF0ZSBkb20gZGlzcGxheSBlbGVtZW50c1xuXG5cbiAgICBsZXQgYm94Y291bnRlcnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLm9wdGlvbnMuZGlzcGxheS5wcm9ncmVzc2lvbik7XG5cbiAgICBjb25zdCBpdGVtb3B0cyA9IHtcbiAgICAgIGRpc3BsYXk6IHt9LFxuICAgIH07XG4gICAgT2JqZWN0LmVudHJpZXMob3B0cykuZm9yRWFjaCgoW2ssIHZhbF0pID0+IHtcbiAgICAgIGNvbnN0IGNsID0gayArICdzJztcbiAgICAgIGNvbnN0IHR4dCA9IHtcbiAgICAgICAgY291bnRlcjogJyByZWFkJyxcbiAgICAgICAgc2l6ZTogJyByZWFkJyxcbiAgICAgICAgY291bnRlcnppcHBlZDogJyBjb21wcmVzc2VkJyxcbiAgICAgICAgc2l6ZXppcHBlZDogJyBjb21wcmVzc2VkJyxcbiAgICAgICAgY291bnRlcnJlamVjdGVkOiAnIHJlamVjdGVkJyxcbiAgICAgICAgY291bnRlcmVycm9yZmlsZTogJyBlcnJvcicsXG4gICAgICB9XG4gICAgICBjb25zdCBkaXNwbGF5bGlzdCA9IFsnY291bnRlcnJlamVjdGVkJywgJ2NvdW50ZXJlcnJvcmZpbGUnXTtcbiAgICAgIGxldCBlbGluc2VydCA9IGJveGNvdW50ZXJzLnF1ZXJ5U2VsZWN0b3IoJy4nICsgY2wpO1xuICAgICAgaWYgKCFlbGluc2VydCkgZWxpbnNlcnQgPSBjcmVhdGVfYm94KCdkaXYnLCB7XG4gICAgICAgIGNsYXNzOiBjbFxuICAgICAgfSwgYm94Y291bnRlcnMsIGBgKTtcbiAgICAgIGxldCBlbCA9IGVsaW5zZXJ0LnF1ZXJ5U2VsZWN0b3IoJy4nICsgdmFsKTtcbiAgICAgIGlmICghZWwpIHtcbiAgICAgICAgZWwgPSBjcmVhdGVfYm94KCdzcGFuJywge1xuICAgICAgICAgIGNsYXNzOiB2YWwsXG4gICAgICAgIH0sIGVsaW5zZXJ0LCBgIC8gYCk7XG4gICAgICAgIGlmICh0eHQuaGFzT3duUHJvcGVydHkodmFsKSkge1xuICAgICAgICAgIC8vIGFkZCBhIGxpbmsgdG8gZGlzcGxheSB0aGUgcmVqZWN0ZWQgZmlsZXMgbGlzdFxuICAgICAgICAgIGlmIChkaXNwbGF5bGlzdC5pbmRleE9mKHZhbCkgPj0gMCkge1xuICAgICAgICAgICAgY29uc3QgbGluayA9IGNyZWF0ZV9ib3goJ2EnLCB7XG4gICAgICAgICAgICAgIHRleHQ6IHR4dFt2YWxdLFxuICAgICAgICAgICAgICBjbGFzczogJ3RleHQtZXJyb3InLFxuICAgICAgICAgICAgICB0aXRsZTogYENsaWNrIHRvIGRpc3BsYXkgdGhlIGxpc3Qgb2YgJHt0eHRbdmFsXX0gZmlsZXNgXG4gICAgICAgICAgICB9LCBlbGluc2VydCk7XG4gICAgICAgICAgICBsaW5rLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICB0aGlzLmRpc3BsYXlFeGNlcHQobGluaywgdmFsKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0gZWxzZSBlbGluc2VydC5hcHBlbmQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodHh0W3ZhbF0pKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHRoaXMucmVzZXRDb3VudGVyKGl0ZW0pO1xuICAgICAgaXRlbW9wdHMuZGlzcGxheVtrXSA9IGVsO1xuICAgICAgaXRlbW9wdHNba10gPSAwO1xuICAgIH0pO1xuXG4gICAgdGhpcy5jb3VudGVycyA9IHsgLi4udGhpcy5jb3VudGVycyxcbiAgICAgIC4uLntcbiAgICAgICAgW2l0ZW1dOiBpdGVtb3B0c1xuICAgICAgfVxuICAgIH07XG5cbiAgfVxuICBkaXNwbGF5RXhjZXB0KGVsLCB0eXBlKSB7XG4gICAgdHlwZSA9IHR5cGUucmVwbGFjZSgnY291bnRlcicsICcnKTtcbiAgICBjb25zdCB0ZXh0dmFsID0ge1xuICAgICAgcmVqZWN0ZWQ6IGAgdHlwZSByZWplY3RlZGAsXG4gICAgICBlcnJvcmZpbGU6IGAgaW4gZXJyb3JgXG4gICAgfTtcbiAgICBpZiAoT2JqZWN0LmtleXModGV4dHZhbCkuaW5kZXhPZih0eXBlKSA8IDApIHJldHVybjtcbiAgICBjb25zdCBtZXNzYWdlID0ge1xuICAgICAgdHlwZTogQWxlcnRCb3guYWxlcnRjb25maWcudHlwZXMud2FybmluZyxcbiAgICAgIHBhcmVudDogZWwsXG4gICAgICBjb250ZW50OiBgRmlsZXMgJHt0aGlzLnJlamVjdGVkLmpvaW4oJzxicj4nKX0gJHt0ZXh0dmFsW3R5cGVdfWAsXG4gICAgfTtcbiAgICBpZiAoZWwuZGF0YXNldC5oYXNtZXNzYWdlKSB7XG4gICAgICBBbGVydEJveC5yZW1vdmVNZXNzYWdlKG1lc3NhZ2UpO1xuICAgICAgZGVsZXRlIGVsLmRhdGFzZXQuaGFzbWVzc2FnZTtcbiAgICB9IGVsc2Uge1xuICAgICAgZWwuZGF0YXNldC5oYXNtZXNzYWdlID0gdHJ1ZTtcbiAgICAgIEFsZXJ0Qm94LmFkZE1lc3NhZ2UobWVzc2FnZSk7XG4gICAgfVxuICB9XG5cbiAgc2hvd0NvbnRyb2woYWN0aW9uLCBvcHRzKSB7XG4gICAgY29uc3QgcGFydCA9IChvcHRzICYmIG9wdHMucGFydCkgPyBvcHRzLnBhcnQgOiBmYWxzZTtcbiAgICBjb25zdCBiaWdmaWxlID0gKG9wdHMgJiYgb3B0cy5iaWdmaWxlKSA/IG9wdHMuYmlnZmlsZSA6IGZhbHNlO1xuICAgIGNvbnN0IGZpbGVwYXRoID0gKG9wdHMgJiYgb3B0cy5wYXRoKSA/IG9wdHMucGF0aCA6IHRoaXMudXBsb2FkZW50cnkuZ2V0Q3VycmVudERpclBhdGgoKTtcbiAgICBjb25zdCB0YXJnZXQgPSAoKG9wdHMuaGFzT3duUHJvcGVydHkoJ2JpZ2ZpbGUnKSAmJiBiaWdmaWxlICE9PSBmYWxzZSkgPyAnemlwcGVkJyA6ICd6aXAnKTtcbiAgICBsZXQgbWVzc2FnZSwgdGV4dCA9IG51bGw7XG4gICAgLy8gJ3ppcCcgLS0tb25seSBidG4gZm9yIHppcCBhY3Rpb25zIGZvciB0aGUgbW9tZW50XG4gICAgY29uc3QgYnRuID0gdGhpc1t0aGlzLm9wdGlvbnMuYnRucHJlZml4ICsgJ3ppcCcgKyB0YXJnZXRdO1xuICAgIGlmICghYnRuKSByZXR1cm47XG4gICAgYnRuLmRpc2FibGVkID0gZmFsc2U7XG4gICAgbGV0IGNsaWNrX2J0bj1mYWxzZTtcbiAgICBzd2l0Y2ggKGFjdGlvbikge1xuICAgICAgY2FzZSB0aGlzLmV2ZW50bmFtZXMucmVhZHk6XG4gICAgICAgIHRoaXMucmVzZXRDb3VudGVycygpO1xuICAgICAgICBpZiAodGhpcy51cGxvYWRlbnRyeSkgIHRoaXMudXBsb2FkZW50cnkubGlzdCgpLnRoZW4oKCk9PnsgdGhpcy51cGxvYWRlbnRyeS5zZXRPcGVuKHRydWUpO3RoaXMudXBsb2FkZW50cnkgPSBudWxsO30pO1xuICAgICAgICBtZXNzYWdlID0gbnVsbDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIHRoaXMuZXZlbnRuYW1lcy5mb2xsb3c6XG4gICAgICAgICAgbWVzc2FnZSA9IHt9O1xuICAgICAgICAgIGJ0bi5kaXNhYmxlZCA9IHRydWU7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSB0aGlzLmV2ZW50bmFtZXMuYmlnZmlsZTpcbiAgICAgICAgaWYgKGJpZ2ZpbGUgJiYgYmlnZmlsZSAhPT0gJycpIHtcbiAgICAgICAgICBidG4udGV4dENvbnRlbnQgPSBgVXBsb2FkIGJpZyBGaWxlIHNlcGFyYXRlbHlgO1xuICAgICAgICAgIG1lc3NhZ2UgPSB7XG4gICAgICAgICAgICBuYW1lOiB0aGlzLmV2ZW50bmFtZXMuZW5kemlwLFxuICAgICAgICAgICAgcGF0aDogZmlsZXBhdGgsXG4gICAgICAgICAgICBwYXJ0OiBwYXJ0LFxuICAgICAgICAgICAgYmlnZmlsZTogYmlnZmlsZVxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgdGhpcy5ldmVudG5hbWVzLmVuZHppcDpcbiAgICAgICAgaWYgKCFwYXJ0KSB0aGlzLnNob3dDb21wbGV0ZSgpO1xuICAgICAgICAvLyBjb21iaW5lIGVuZHppcCBhbmQgdXBsb2FkIGZvciBwcm9kXG4gICAgICAgLy8gYnRuLnRleHRDb250ZW50ID0gYFVwbG9hZGluZyBmaWxlYCArICgocGFydCkgPyBgIGAgKyBwYXJ0IDogYGApO1xuICAgICAgICBidG4uZGF0YXNldC5tZXNzYWdlID0gSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgIG5hbWU6IHRoaXMuZXZlbnRuYW1lcy5lbmR6aXAsXG4gICAgICAgICAgcGFydDogcGFydCxcbiAgICAgICAgICBwYXRoOiBmaWxlcGF0aCxcbiAgICAgICAgICBiaWdmaWxlOiBiaWdmaWxlLFxuICAgICAgICB9KTtcbiAgICAgICAgIHNldFRpbWVvdXQoICgpID0+IHt0aGlzLmVtaXRUb1ppcChidG4pO30sMTAwMCk7XG4gICAgICAgICByZXR1cm47XG4gICAgICAgIGJyZWFrO1xuICAgIGNhc2UgdGhpcy5ldmVudG5hbWVzLnNlbmRmaWxlOlxuICAgICAgICB0aGlzLmRvbmU9ZmFsc2U7XG4gICAgICAgIGJ0bi5kYXRhc2V0Lm1lc3NhZ2UgPSBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgbmFtZTogdGhpcy5ldmVudG5hbWVzLnNlbmRmaWxlLFxuICAgICAgICAgIHBhdGg6IGZpbGVwYXRoLFxuICAgICAgICAgIHBhcnQ6IHBhcnQsXG4gICAgICAgICAgYmlnZmlsZTogYmlnZmlsZVxuICAgICAgICB9KTtcbiAgICAgICAgc2V0VGltZW91dCggKCkgPT4ge3RoaXMuZW1pdFRvWmlwKGJ0bik7fSwxMDAwKTtcbiAgICAgICAgaWYoYnRuLnByZXZpb3VzRWxlbWVudFNpYmxpbmcgJiYgYnRuLnByZXZpb3VzRWxlbWVudFNpYmxpbmcudGFnTmFtZS50b0xvd2VyQ2FzZSgpIT09XCJzdmdcIikgIGJ0bi5pbnNlcnRBZGphY2VudEhUTUwoJ2JlZm9yZWJlZ2luJywgaHRtbF9zcGlubmVyKCd0ZXh0LXN0b25lLTIwMCBtbC0xIG1yLTIgYWxpZ24tdGV4dC1ib3R0b20gaW5saW5lLWJsb2NrJykpO1xuICAgICAgICByZXR1cm47XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSB0aGlzLmV2ZW50bmFtZXMucGVuZGluZzpcbiAgICAgICAgYnRuLnRleHRDb250ZW50ID0gYCBVcGxvYWRpbmcgYCArICgodGFyZ2V0ICE9PSAnemlwJykgPyAnIGJpZyBmaWxlJyA6ICcnKTtcbiAgICAgICAgYnRuLmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgbWVzc2FnZSA9IHt9O1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgdGhpcy5ldmVudG5hbWVzLmd6aXA6XG4gICAgICAgIHRleHQgPSBgY29tcHJlc3NpbmcgYmlnIGZpbGUgOiR7KG9wdHMgJiYgb3B0cy5iaWdmaWxlKT9maWxlcGF0aCA6YGB9ICR7KG9wdHMgJiYgb3B0cy5zaXplKT9mb3JtYXRfYnl0ZXMob3B0cy5zaXplKTpgYH1gO1xuICAgICAgICBidG4udGV4dENvbnRlbnQgPSB0ZXh0O1xuICAgICAgICBidG4uZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICBtZXNzYWdlID0ge307XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSB0aGlzLmV2ZW50bmFtZXMudGVybWluYXRlOlxuICAgICAgICBpZiAoYnRuLnByZXZpb3VzRWxlbWVudFNpYmxpbmcgJiYgYnRuLnByZXZpb3VzRWxlbWVudFNpYmxpbmcudGFnTmFtZS50b0xvd2VyQ2FzZSgpPT09XCJzdmdcIikgIGJ0bi5wcmV2aW91c0VsZW1lbnRTaWJsaW5nLnJlbW92ZSgpO1xuICAgICAgICBidG4uZGF0YXNldC5tZXNzYWdlID0gSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgIG5hbWU6IHRoaXMuZXZlbnRuYW1lcy5pbml0LFxuICAgICAgICAgIGJpZ2ZpbGU6IGJpZ2ZpbGUsXG4gICAgICAgICAgcGFydDogcGFydCxcbiAgICAgICAgICBwYXRoOiBmaWxlcGF0aFxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5kb25lPXRydWU7XG4gICAgICAgIGJ0bi5jbGFzc0xpc3QuYWRkKGNzcy5oaWRlKTtcbiAgICAgICAgYnRuLmNsaWNrKCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIHRoaXMuZXZlbnRuYW1lcy5lcnJvcmZpbGU6XG4gICAgICBjYXNlIHRoaXMuZXZlbnRuYW1lcy5lcnJvcjpcbiAgICAgICAgYnRuLnRleHRDb250ZW50ID0gKG9wdHMudGV4dCkgPyBvcHRzLnRleHQgOiBgRXJyb3IgYCtKU09OLnN0cmluZ2lmeShtZXNzYWdlKTtcbiAgICAgICAgYnRuLmNsYXNzTGlzdC5hZGQoY3NzLmNvbnNvbGUpO1xuICAgICAgICBidG4uZGlzYWJsZWQ9dHJ1ZTtcbiAgICAgICAgbWVzc2FnZT1udWxsO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGNvbnNvbGUubG9nKCdkZWZhdWx0IGNvbnRyb2wnICsgYWN0aW9uLCBvcHRzKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gICAgaWYgKG1lc3NhZ2UgPT09IG51bGwpIHtcbiAgICAgIGRlbGV0ZSBidG4uZGF0YXNldC5tZXNzYWdlO1xuICAgICAgYnRuLmNsYXNzTGlzdC5hZGQoY3NzLmhpZGUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBidG4uZGF0YXNldC5tZXNzYWdlID0gSlNPTi5zdHJpbmdpZnkobWVzc2FnZSk7XG4gICAgICBidG4uY2xhc3NMaXN0LnJlbW92ZShjc3MuaGlkZSk7XG4gICAgICBpZiAoYnRuLmRpc2FibGVkKSB7XG4gICAgICAgIGJ0bi5jbGFzc0xpc3QuYWRkKGNzcy5jb25zb2xlKTtcbiAgICAgICBpZighYnRuLmNsYXNzTGlzdC5jb250YWlucyhjc3MuY29uc29sZSkgJiYgYnRuLnByZXZpb3VzRWxlbWVudFNpYmxpbmcgJiYgYnRuLnByZXZpb3VzRWxlbWVudFNpYmxpbmcudGFnTmFtZS50b0xvd2VyQ2FzZSgpIT09XCJzdmdcIikgYnRuLmluc2VydEFkamFjZW50SFRNTCgnYmVmb3JlYmVnaW4nLCBodG1sX3NwaW5uZXIoJ3RleHQtc3RvbmUtMjAwIG1sLTEgbXItMiBhbGlnbi10ZXh0LWJvdHRvbSBpbmxpbmUtYmxvY2snKSk7XG4gICAgICB9IGVsc2UgYnRuLmNsYXNzTGlzdC5yZW1vdmUoY3NzLmNvbnNvbGUpO1xuICAgIH1cbiAgfVxuXG4gIGdldEJ0bihpdGVtLCB0YXJnZXQpIHtcbiAgICBjb25zdCBidG5rZXkgPSB0aGlzLm9wdGlvbnMuYnRucHJlZml4ICsgaXRlbSArIHRhcmdldDtcbiAgICBpZiAodGhpc1tidG5rZXldKSByZXR1cm4gdGhpc1tidG5rZXldO1xuICAgIGNvbnN0IGRpc3BsYXkgPSB0aGlzLm9wdGlvbnMuY29udHJvbHNbaXRlbV0uYnRuW3RhcmdldF07XG4gICAgY29uc3QgYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZGlzcGxheSk7XG4gICAgY29uc3QgcGFyZW50ID0gdGhpcy5kaXNwbGF5cHJvZ3Jlc3Npb247XG4gICAgaWYgKCFidG4pIHtcbiAgICAgIHRoaXNbYnRua2V5XSA9IGNyZWF0ZV9ib3goJ2J1dHRvbicsIHtcbiAgICAgICAgaWQ6IGRpc3BsYXksXG4gICAgICAgIGNsYXNzOiBbZGlzcGxheSwgY3NzLmhpZGVdLmNvbmNhdChjc3MuYnV0dG9uLnNwbGl0KCcgJykpXG4gICAgICB9LCBwYXJlbnQpO1xuICAgICAgdGhpc1tidG5rZXldLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKGUpID0+IHtcbiAgICAgICAgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB0aGlzLmVtaXRUb1ppcChlLmN1cnJlbnRUYXJnZXQpO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIHBhcmVudC5hcHBlbmQoYnRuKTtcbiAgICByZXR1cm4gdGhpc1tidG5rZXldO1xuICB9XG5cbiAgaW5pdENvbnRyb2xzKCkge1xuICAgIE9iamVjdC5lbnRyaWVzKHRoaXMub3B0aW9ucy5jb250cm9scykuZm9yRWFjaCgoW2tleSwgY29udHJvbF0sIGkpID0+IHtcbiAgICAgICB0aGlzLmluaXRGaWxlQ291bnRlcihrZXksIGNvbnRyb2wuZGlzcGxheSwgaSk7XG4gICAgICBpZiAoY29udHJvbC5idG4pIHRoaXMuYWN0aXZhdGVDb250cm9scyhrZXksIGNvbnRyb2wuYnRuKTtcbiAgICB9KTtcbiAgfVxuICBhY3RpdmF0ZUNvbnRyb2xzKGtleSwgYnRucykge1xuICAgIE9iamVjdC5rZXlzKGJ0bnMpLmZvckVhY2goKGJ0bikgPT4ge1xuICAgICAgdGhpc1t0aGlzLm9wdGlvbnMuYnRucHJlZml4ICsga2V5ICsgYnRuXSA9IHRoaXMuZ2V0QnRuKGtleSwgYnRuKTtcbiAgICB9KVxuXG4gIH1cblxufSJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/modules/js-my-files.js\n\n}")}}]);