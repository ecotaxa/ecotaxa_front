/*! For license information please see src_modules_table-projects-tools_js.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["src_modules_table-projects-tools_js"],{"./src/modules/table-projects-tools.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{eval('__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ImportList: () => (/* binding */ ImportList)\n/* harmony export */ });\n/* harmony import */ var _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../modules/modules-config.js */ "./src/modules/modules-config.js");\n/* harmony import */ var _modules_utils_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../modules/utils.js */ "./src/modules/utils.js");\n\n\n\n\nfunction ImportList(state, attach = null) {\n  const rowimported = -1;\n  const cellid = state.getCellId(state.cellidname);\n  const toggle = function(tr, value, idx) {\n    tr.hidden = value;\n    /*  if (value === true) tr.classList.add(css.disabled);\n      else {\n        tr.classList.remove(css.disabled);\n        state.dataImport.resetSelector(tr);\n      }*/\n  }\n\n  async function compileProjectRecords(newone = true,selectcells=["creator_users","creator_organisations"]) {\n    const ts = state.dataImport.importzone.tomselect;\n    const ids = (ts) ? ts.items : Array.from(state.dataImport.importzone.selectedOptions).map(option => option.value);\n    if (ids.length === 0) return null;\n    const url = \'/gui/collection/aggregated\' + \'?\' + new URLSearchParams({\n      project_ids: ids.join(\',\'),\n      simulate:"y"\n    });\n    const response = await fetch(url, (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_1__.fetchSettings)({\n      method: \'GET\',\n    }))\n    let results = await response.json();\n    const excluded = results.excluded;\n    delete results.excluded;\n    const collator = new Intl.Collator(undefined, {\n      numeric: true,\n      sensitivity: \'base\'\n    })\n    ["creator"].forEach(key=> {    if (Object.keys(results).indexOf(key+"_users") >= 0 && newone === true) {\n      results[key+"_organisations"] = results[key+"_users"].map(u => u.organisation);\n      results[key+"_organisations"].sort();\n      const users = results[key+"_users"].map(u => ({\n        key: u.id,\n        value: u.name,\n        text: u.name + \' \' + u.email\n      }));\n      results[key+"_users"] = users\n      results[key+"_users"].sort((a, b) => {\n        return collator.compare(a.value, b.value)\n      });\n    };})\n    return results;\n  }\n\n  function initList() {\n    const plugin = state.dataImport;\n    if (plugin.targetimport) {\n      let selected = null;\n      if (plugin.targetimport.tagName.toLowerCase() === \'select\') {\n        selected = [...plugin.targetimport.options].filter(opt => opt.selected);\n        selected = selected.map(opt => parseInt(opt.value));\n      } else selected = plugin.targetimport.value;\n      plugin.selectors.forEach(selector => {\n        if (selected.indexOf(parseInt(selector.value)) >= 0) selector.click();\n      });\n    }\n  }\n\n  function filterByRecord(record, recordindex) {\n    // display only lines with fields values equals to record fields values - criteria is a list of cellnames\n    const criteria_names = [\'instrument\', \'access\'];\n    const criteria_ids = [];\n    criteria_names.forEach(colname => {\n      const index = state.getCellId(colname);\n      if (index > -1) criteria_ids.push(index);\n    });\n    if (criteria_ids.length !== criteria_names.length) return;\n\n    let datas = state.grid.data;\n    const indexes = [];\n    datas = datas.filter((row, i) => {\n      let compare = true;\n      if (i !== recordindex) criteria_ids.forEach(idx => {\n        compare = compare && (record[idx] === row[idx]);\n      });\n      if (compare) indexes.push(String(row[cellid]));\n      return compare;\n    });\n    state.displaySelected(criteria_ids, indexes, cellid, toggle);\n  }\n\n  function resetFilter() {\n    state.displaySelected([], [], cellid, toggle);\n  }\n\n  if (attach) {\n    attach.filterByRecord = filterByRecord;\n    attach.resetFilter = resetFilter;\n    attach.compileProjectRecords = compileProjectRecords;\n    attach.initList = initList;\n  } else return {\n    filterByRecord,\n    resetFilter,\n    initList\n  }\n\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvbW9kdWxlcy90YWJsZS1wcm9qZWN0cy10b29scy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFHc0M7QUFJVDs7O0FBRzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxzQ0FBc0MsZ0VBQWE7QUFDbkQ7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLG1DQUFtQztBQUNuQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLE9BQU87QUFDUDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBOztBQUVBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vc3JjL21vZHVsZXMvdGFibGUtcHJvamVjdHMtdG9vbHMuanM/NzQ4YyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBtb2RlbHMsXG4gIGNzcyxcbn0gZnJvbSAnLi4vbW9kdWxlcy9tb2R1bGVzLWNvbmZpZy5qcyc7XG5pbXBvcnQge1xuICB1bmVzY2FwZV9odG1sLFxuICBmZXRjaFNldHRpbmdzXG59IGZyb20gJy4uL21vZHVsZXMvdXRpbHMuanMnO1xuXG5cbmZ1bmN0aW9uIEltcG9ydExpc3Qoc3RhdGUsIGF0dGFjaCA9IG51bGwpIHtcbiAgY29uc3Qgcm93aW1wb3J0ZWQgPSAtMTtcbiAgY29uc3QgY2VsbGlkID0gc3RhdGUuZ2V0Q2VsbElkKHN0YXRlLmNlbGxpZG5hbWUpO1xuICBjb25zdCB0b2dnbGUgPSBmdW5jdGlvbih0ciwgdmFsdWUsIGlkeCkge1xuICAgIHRyLmhpZGRlbiA9IHZhbHVlO1xuICAgIC8qICBpZiAodmFsdWUgPT09IHRydWUpIHRyLmNsYXNzTGlzdC5hZGQoY3NzLmRpc2FibGVkKTtcbiAgICAgIGVsc2Uge1xuICAgICAgICB0ci5jbGFzc0xpc3QucmVtb3ZlKGNzcy5kaXNhYmxlZCk7XG4gICAgICAgIHN0YXRlLmRhdGFJbXBvcnQucmVzZXRTZWxlY3Rvcih0cik7XG4gICAgICB9Ki9cbiAgfVxuXG4gIGFzeW5jIGZ1bmN0aW9uIGNvbXBpbGVQcm9qZWN0UmVjb3JkcyhuZXdvbmUgPSB0cnVlLHNlbGVjdGNlbGxzPVtcImNyZWF0b3JfdXNlcnNcIixcImNyZWF0b3Jfb3JnYW5pc2F0aW9uc1wiXSkge1xuICAgIGNvbnN0IHRzID0gc3RhdGUuZGF0YUltcG9ydC5pbXBvcnR6b25lLnRvbXNlbGVjdDtcbiAgICBjb25zdCBpZHMgPSAodHMpID8gdHMuaXRlbXMgOiBBcnJheS5mcm9tKHN0YXRlLmRhdGFJbXBvcnQuaW1wb3J0em9uZS5zZWxlY3RlZE9wdGlvbnMpLm1hcChvcHRpb24gPT4gb3B0aW9uLnZhbHVlKTtcbiAgICBpZiAoaWRzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIG51bGw7XG4gICAgY29uc3QgdXJsID0gJy9ndWkvY29sbGVjdGlvbi9hZ2dyZWdhdGVkJyArICc/JyArIG5ldyBVUkxTZWFyY2hQYXJhbXMoe1xuICAgICAgcHJvamVjdF9pZHM6IGlkcy5qb2luKCcsJyksXG4gICAgICBzaW11bGF0ZTpcInlcIlxuICAgIH0pO1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godXJsLCBmZXRjaFNldHRpbmdzKHtcbiAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgfSkpXG4gICAgbGV0IHJlc3VsdHMgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgY29uc3QgZXhjbHVkZWQgPSByZXN1bHRzLmV4Y2x1ZGVkO1xuICAgIGRlbGV0ZSByZXN1bHRzLmV4Y2x1ZGVkO1xuICAgIGNvbnN0IGNvbGxhdG9yID0gbmV3IEludGwuQ29sbGF0b3IodW5kZWZpbmVkLCB7XG4gICAgICBudW1lcmljOiB0cnVlLFxuICAgICAgc2Vuc2l0aXZpdHk6ICdiYXNlJ1xuICAgIH0pXG4gICAgW1wiY3JlYXRvclwiXS5mb3JFYWNoKGtleT0+IHsgICAgaWYgKE9iamVjdC5rZXlzKHJlc3VsdHMpLmluZGV4T2Yoa2V5K1wiX3VzZXJzXCIpID49IDAgJiYgbmV3b25lID09PSB0cnVlKSB7XG4gICAgICByZXN1bHRzW2tleStcIl9vcmdhbmlzYXRpb25zXCJdID0gcmVzdWx0c1trZXkrXCJfdXNlcnNcIl0ubWFwKHUgPT4gdS5vcmdhbmlzYXRpb24pO1xuICAgICAgcmVzdWx0c1trZXkrXCJfb3JnYW5pc2F0aW9uc1wiXS5zb3J0KCk7XG4gICAgICBjb25zdCB1c2VycyA9IHJlc3VsdHNba2V5K1wiX3VzZXJzXCJdLm1hcCh1ID0+ICh7XG4gICAgICAgIGtleTogdS5pZCxcbiAgICAgICAgdmFsdWU6IHUubmFtZSxcbiAgICAgICAgdGV4dDogdS5uYW1lICsgJyAnICsgdS5lbWFpbFxuICAgICAgfSkpO1xuICAgICAgcmVzdWx0c1trZXkrXCJfdXNlcnNcIl0gPSB1c2Vyc1xuICAgICAgcmVzdWx0c1trZXkrXCJfdXNlcnNcIl0uc29ydCgoYSwgYikgPT4ge1xuICAgICAgICByZXR1cm4gY29sbGF0b3IuY29tcGFyZShhLnZhbHVlLCBiLnZhbHVlKVxuICAgICAgfSk7XG4gICAgfTt9KVxuICAgIHJldHVybiByZXN1bHRzO1xuICB9XG5cbiAgZnVuY3Rpb24gaW5pdExpc3QoKSB7XG4gICAgY29uc3QgcGx1Z2luID0gc3RhdGUuZGF0YUltcG9ydDtcbiAgICBpZiAocGx1Z2luLnRhcmdldGltcG9ydCkge1xuICAgICAgbGV0IHNlbGVjdGVkID0gbnVsbDtcbiAgICAgIGlmIChwbHVnaW4udGFyZ2V0aW1wb3J0LnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PT0gJ3NlbGVjdCcpIHtcbiAgICAgICAgc2VsZWN0ZWQgPSBbLi4ucGx1Z2luLnRhcmdldGltcG9ydC5vcHRpb25zXS5maWx0ZXIob3B0ID0+IG9wdC5zZWxlY3RlZCk7XG4gICAgICAgIHNlbGVjdGVkID0gc2VsZWN0ZWQubWFwKG9wdCA9PiBwYXJzZUludChvcHQudmFsdWUpKTtcbiAgICAgIH0gZWxzZSBzZWxlY3RlZCA9IHBsdWdpbi50YXJnZXRpbXBvcnQudmFsdWU7XG4gICAgICBwbHVnaW4uc2VsZWN0b3JzLmZvckVhY2goc2VsZWN0b3IgPT4ge1xuICAgICAgICBpZiAoc2VsZWN0ZWQuaW5kZXhPZihwYXJzZUludChzZWxlY3Rvci52YWx1ZSkpID49IDApIHNlbGVjdG9yLmNsaWNrKCk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBmaWx0ZXJCeVJlY29yZChyZWNvcmQsIHJlY29yZGluZGV4KSB7XG4gICAgLy8gZGlzcGxheSBvbmx5IGxpbmVzIHdpdGggZmllbGRzIHZhbHVlcyBlcXVhbHMgdG8gcmVjb3JkIGZpZWxkcyB2YWx1ZXMgLSBjcml0ZXJpYSBpcyBhIGxpc3Qgb2YgY2VsbG5hbWVzXG4gICAgY29uc3QgY3JpdGVyaWFfbmFtZXMgPSBbJ2luc3RydW1lbnQnLCAnYWNjZXNzJ107XG4gICAgY29uc3QgY3JpdGVyaWFfaWRzID0gW107XG4gICAgY3JpdGVyaWFfbmFtZXMuZm9yRWFjaChjb2xuYW1lID0+IHtcbiAgICAgIGNvbnN0IGluZGV4ID0gc3RhdGUuZ2V0Q2VsbElkKGNvbG5hbWUpO1xuICAgICAgaWYgKGluZGV4ID4gLTEpIGNyaXRlcmlhX2lkcy5wdXNoKGluZGV4KTtcbiAgICB9KTtcbiAgICBpZiAoY3JpdGVyaWFfaWRzLmxlbmd0aCAhPT0gY3JpdGVyaWFfbmFtZXMubGVuZ3RoKSByZXR1cm47XG5cbiAgICBsZXQgZGF0YXMgPSBzdGF0ZS5ncmlkLmRhdGE7XG4gICAgY29uc3QgaW5kZXhlcyA9IFtdO1xuICAgIGRhdGFzID0gZGF0YXMuZmlsdGVyKChyb3csIGkpID0+IHtcbiAgICAgIGxldCBjb21wYXJlID0gdHJ1ZTtcbiAgICAgIGlmIChpICE9PSByZWNvcmRpbmRleCkgY3JpdGVyaWFfaWRzLmZvckVhY2goaWR4ID0+IHtcbiAgICAgICAgY29tcGFyZSA9IGNvbXBhcmUgJiYgKHJlY29yZFtpZHhdID09PSByb3dbaWR4XSk7XG4gICAgICB9KTtcbiAgICAgIGlmIChjb21wYXJlKSBpbmRleGVzLnB1c2goU3RyaW5nKHJvd1tjZWxsaWRdKSk7XG4gICAgICByZXR1cm4gY29tcGFyZTtcbiAgICB9KTtcbiAgICBzdGF0ZS5kaXNwbGF5U2VsZWN0ZWQoY3JpdGVyaWFfaWRzLCBpbmRleGVzLCBjZWxsaWQsIHRvZ2dsZSk7XG4gIH1cblxuICBmdW5jdGlvbiByZXNldEZpbHRlcigpIHtcbiAgICBzdGF0ZS5kaXNwbGF5U2VsZWN0ZWQoW10sIFtdLCBjZWxsaWQsIHRvZ2dsZSk7XG4gIH1cblxuICBpZiAoYXR0YWNoKSB7XG4gICAgYXR0YWNoLmZpbHRlckJ5UmVjb3JkID0gZmlsdGVyQnlSZWNvcmQ7XG4gICAgYXR0YWNoLnJlc2V0RmlsdGVyID0gcmVzZXRGaWx0ZXI7XG4gICAgYXR0YWNoLmNvbXBpbGVQcm9qZWN0UmVjb3JkcyA9IGNvbXBpbGVQcm9qZWN0UmVjb3JkcztcbiAgICBhdHRhY2guaW5pdExpc3QgPSBpbml0TGlzdDtcbiAgfSBlbHNlIHJldHVybiB7XG4gICAgZmlsdGVyQnlSZWNvcmQsXG4gICAgcmVzZXRGaWx0ZXIsXG4gICAgaW5pdExpc3RcbiAgfVxuXG59XG5leHBvcnQge1xuICBJbXBvcnRMaXN0XG59Il0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/modules/table-projects-tools.js\n')}}]);