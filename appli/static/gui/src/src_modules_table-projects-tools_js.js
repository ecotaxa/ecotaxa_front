/*! For license information please see src_modules_table-projects-tools_js.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["src_modules_table-projects-tools_js"],{"./src/modules/table-projects-tools.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ImportList: () => (/* binding */ ImportList)\n/* harmony export */ });\n/* harmony import */ var _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../modules/modules-config.js */ \"./src/modules/modules-config.js\");\n/* harmony import */ var _modules_utils_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../modules/utils.js */ \"./src/modules/utils.js\");\n\n\n\n\nfunction ImportList(state, attach = null) {\n  const rowimported = -1;\n  const cellid = state.getCellId(state.cellidname);\n  const toggle = function(tr, value, idx) {\n    tr.hidden = value;\n    /*  if (value === true) tr.classList.add(css.disabled);\n      else {\n        tr.classList.remove(css.disabled);\n        state.dataImport.resetSelector(tr);\n      }*/\n  }\n\n  async function compileProjectRecords(newone = true) {\n    const ts = state.dataImport.importzone.tomselect;\n    const ids = (ts) ? ts.items : Array.from(state.dataImport.importzone.selectedOptions).map(option => option.value);\n    if (ids.length === 0) return null;\n    const url = '/gui/collection/aggregated' + '?' + new URLSearchParams({\n      project_ids: ids.join(',')\n    });\n    const response = await fetch(url, (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_1__.fetchSettings)({\n      method: 'GET',\n    }))\n    let results = await response.json();\n    const excluded = results.excluded;\n    delete results.excluded;\n    const collator = new Intl.Collator(undefined, {\n      numeric: true,\n      sensitivity: 'base'\n    })\n\n    if (Object.keys(results).indexOf(\"creator_users\") >= 0 && newone === true) {\n      results.creator_organisations = results.creator_users.map(u => u.organisation);\n      results.creator_organisations.sort();\n      const creator_users = results.creator_users.map(u => ({\n        key: u.id,\n        value: u.name,\n        text: u.name + ' ' + u.email\n      }));\n      results.creator_users = creator_users\n      results.creator_users.sort((a, b) => {\n        return collator.compare(a.value, b.value)\n      });\n    }\n\n    return results;\n  }\n\n  function initList() {\n    const plugin = state.dataImport;\n    if (plugin.targetimport) {\n      let selected = null;\n      if (plugin.targetimport.tagName.toLowerCase() === 'select') {\n        selected = [...plugin.targetimport.options].filter(opt => opt.selected);\n        selected = selected.map(opt => parseInt(opt.value));\n      } else selected = plugin.targetimport.value;\n      plugin.selectors.forEach(selector => {\n        if (selected.indexOf(parseInt(selector.value)) >= 0) selector.click();\n      });\n    }\n  }\n\n  function filterByRecord(record, recordindex) {\n    // display only lines with fields values equals to record fields values - criteria is a list of cellnames\n    const criteria_names = ['instrument', 'visible'];\n    const criteria_ids = [];\n    criteria_names.forEach(colname => {\n      const index = state.getCellId(colname);\n      if (index > -1) criteria_ids.push(index);\n    });\n    if (criteria_ids.length !== criteria_names.length) return;\n\n    let datas = state.grid.data;\n    const indexes = [];\n    datas = datas.filter((row, i) => {\n      let compare = true;\n      if (i !== recordindex) criteria_ids.forEach(idx => {\n        compare = compare && (record[idx] === row[idx]);\n      });\n      if (compare) indexes.push(String(row[cellid]));\n      return compare;\n    });\n    state.displaySelected(criteria_ids, indexes, cellid, toggle);\n  }\n\n  function resetFilter() {\n    state.displaySelected([], [], cellid, toggle);\n  }\n\n  if (attach) {\n    attach.filterByRecord = filterByRecord;\n    attach.resetFilter = resetFilter;\n    attach.compileProjectRecords = compileProjectRecords;\n    attach.initList = initList;\n  } else return {\n    filterByRecord,\n    resetFilter,\n    initList\n  }\n\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvbW9kdWxlcy90YWJsZS1wcm9qZWN0cy10b29scy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFHc0M7QUFJVDs7O0FBRzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsc0NBQXNDLGdFQUFhO0FBQ25EO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7O0FBRUEiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvbW9kdWxlcy90YWJsZS1wcm9qZWN0cy10b29scy5qcz83NDhjIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIG1vZGVscyxcbiAgY3NzLFxufSBmcm9tICcuLi9tb2R1bGVzL21vZHVsZXMtY29uZmlnLmpzJztcbmltcG9ydCB7XG4gIHVuZXNjYXBlX2h0bWwsXG4gIGZldGNoU2V0dGluZ3Ncbn0gZnJvbSAnLi4vbW9kdWxlcy91dGlscy5qcyc7XG5cblxuZnVuY3Rpb24gSW1wb3J0TGlzdChzdGF0ZSwgYXR0YWNoID0gbnVsbCkge1xuICBjb25zdCByb3dpbXBvcnRlZCA9IC0xO1xuICBjb25zdCBjZWxsaWQgPSBzdGF0ZS5nZXRDZWxsSWQoc3RhdGUuY2VsbGlkbmFtZSk7XG4gIGNvbnN0IHRvZ2dsZSA9IGZ1bmN0aW9uKHRyLCB2YWx1ZSwgaWR4KSB7XG4gICAgdHIuaGlkZGVuID0gdmFsdWU7XG4gICAgLyogIGlmICh2YWx1ZSA9PT0gdHJ1ZSkgdHIuY2xhc3NMaXN0LmFkZChjc3MuZGlzYWJsZWQpO1xuICAgICAgZWxzZSB7XG4gICAgICAgIHRyLmNsYXNzTGlzdC5yZW1vdmUoY3NzLmRpc2FibGVkKTtcbiAgICAgICAgc3RhdGUuZGF0YUltcG9ydC5yZXNldFNlbGVjdG9yKHRyKTtcbiAgICAgIH0qL1xuICB9XG5cbiAgYXN5bmMgZnVuY3Rpb24gY29tcGlsZVByb2plY3RSZWNvcmRzKG5ld29uZSA9IHRydWUpIHtcbiAgICBjb25zdCB0cyA9IHN0YXRlLmRhdGFJbXBvcnQuaW1wb3J0em9uZS50b21zZWxlY3Q7XG4gICAgY29uc3QgaWRzID0gKHRzKSA/IHRzLml0ZW1zIDogQXJyYXkuZnJvbShzdGF0ZS5kYXRhSW1wb3J0LmltcG9ydHpvbmUuc2VsZWN0ZWRPcHRpb25zKS5tYXAob3B0aW9uID0+IG9wdGlvbi52YWx1ZSk7XG4gICAgaWYgKGlkcy5sZW5ndGggPT09IDApIHJldHVybiBudWxsO1xuICAgIGNvbnN0IHVybCA9ICcvZ3VpL2NvbGxlY3Rpb24vYWdncmVnYXRlZCcgKyAnPycgKyBuZXcgVVJMU2VhcmNoUGFyYW1zKHtcbiAgICAgIHByb2plY3RfaWRzOiBpZHMuam9pbignLCcpXG4gICAgfSk7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwsIGZldGNoU2V0dGluZ3Moe1xuICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICB9KSlcbiAgICBsZXQgcmVzdWx0cyA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICBjb25zdCBleGNsdWRlZCA9IHJlc3VsdHMuZXhjbHVkZWQ7XG4gICAgZGVsZXRlIHJlc3VsdHMuZXhjbHVkZWQ7XG4gICAgY29uc3QgY29sbGF0b3IgPSBuZXcgSW50bC5Db2xsYXRvcih1bmRlZmluZWQsIHtcbiAgICAgIG51bWVyaWM6IHRydWUsXG4gICAgICBzZW5zaXRpdml0eTogJ2Jhc2UnXG4gICAgfSlcblxuICAgIGlmIChPYmplY3Qua2V5cyhyZXN1bHRzKS5pbmRleE9mKFwiY3JlYXRvcl91c2Vyc1wiKSA+PSAwICYmIG5ld29uZSA9PT0gdHJ1ZSkge1xuICAgICAgcmVzdWx0cy5jcmVhdG9yX29yZ2FuaXNhdGlvbnMgPSByZXN1bHRzLmNyZWF0b3JfdXNlcnMubWFwKHUgPT4gdS5vcmdhbmlzYXRpb24pO1xuICAgICAgcmVzdWx0cy5jcmVhdG9yX29yZ2FuaXNhdGlvbnMuc29ydCgpO1xuICAgICAgY29uc3QgY3JlYXRvcl91c2VycyA9IHJlc3VsdHMuY3JlYXRvcl91c2Vycy5tYXAodSA9PiAoe1xuICAgICAgICBrZXk6IHUuaWQsXG4gICAgICAgIHZhbHVlOiB1Lm5hbWUsXG4gICAgICAgIHRleHQ6IHUubmFtZSArICcgJyArIHUuZW1haWxcbiAgICAgIH0pKTtcbiAgICAgIHJlc3VsdHMuY3JlYXRvcl91c2VycyA9IGNyZWF0b3JfdXNlcnNcbiAgICAgIHJlc3VsdHMuY3JlYXRvcl91c2Vycy5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgIHJldHVybiBjb2xsYXRvci5jb21wYXJlKGEudmFsdWUsIGIudmFsdWUpXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0cztcbiAgfVxuXG4gIGZ1bmN0aW9uIGluaXRMaXN0KCkge1xuICAgIGNvbnN0IHBsdWdpbiA9IHN0YXRlLmRhdGFJbXBvcnQ7XG4gICAgaWYgKHBsdWdpbi50YXJnZXRpbXBvcnQpIHtcbiAgICAgIGxldCBzZWxlY3RlZCA9IG51bGw7XG4gICAgICBpZiAocGx1Z2luLnRhcmdldGltcG9ydC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICdzZWxlY3QnKSB7XG4gICAgICAgIHNlbGVjdGVkID0gWy4uLnBsdWdpbi50YXJnZXRpbXBvcnQub3B0aW9uc10uZmlsdGVyKG9wdCA9PiBvcHQuc2VsZWN0ZWQpO1xuICAgICAgICBzZWxlY3RlZCA9IHNlbGVjdGVkLm1hcChvcHQgPT4gcGFyc2VJbnQob3B0LnZhbHVlKSk7XG4gICAgICB9IGVsc2Ugc2VsZWN0ZWQgPSBwbHVnaW4udGFyZ2V0aW1wb3J0LnZhbHVlO1xuICAgICAgcGx1Z2luLnNlbGVjdG9ycy5mb3JFYWNoKHNlbGVjdG9yID0+IHtcbiAgICAgICAgaWYgKHNlbGVjdGVkLmluZGV4T2YocGFyc2VJbnQoc2VsZWN0b3IudmFsdWUpKSA+PSAwKSBzZWxlY3Rvci5jbGljaygpO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gZmlsdGVyQnlSZWNvcmQocmVjb3JkLCByZWNvcmRpbmRleCkge1xuICAgIC8vIGRpc3BsYXkgb25seSBsaW5lcyB3aXRoIGZpZWxkcyB2YWx1ZXMgZXF1YWxzIHRvIHJlY29yZCBmaWVsZHMgdmFsdWVzIC0gY3JpdGVyaWEgaXMgYSBsaXN0IG9mIGNlbGxuYW1lc1xuICAgIGNvbnN0IGNyaXRlcmlhX25hbWVzID0gWydpbnN0cnVtZW50JywgJ3Zpc2libGUnXTtcbiAgICBjb25zdCBjcml0ZXJpYV9pZHMgPSBbXTtcbiAgICBjcml0ZXJpYV9uYW1lcy5mb3JFYWNoKGNvbG5hbWUgPT4ge1xuICAgICAgY29uc3QgaW5kZXggPSBzdGF0ZS5nZXRDZWxsSWQoY29sbmFtZSk7XG4gICAgICBpZiAoaW5kZXggPiAtMSkgY3JpdGVyaWFfaWRzLnB1c2goaW5kZXgpO1xuICAgIH0pO1xuICAgIGlmIChjcml0ZXJpYV9pZHMubGVuZ3RoICE9PSBjcml0ZXJpYV9uYW1lcy5sZW5ndGgpIHJldHVybjtcblxuICAgIGxldCBkYXRhcyA9IHN0YXRlLmdyaWQuZGF0YTtcbiAgICBjb25zdCBpbmRleGVzID0gW107XG4gICAgZGF0YXMgPSBkYXRhcy5maWx0ZXIoKHJvdywgaSkgPT4ge1xuICAgICAgbGV0IGNvbXBhcmUgPSB0cnVlO1xuICAgICAgaWYgKGkgIT09IHJlY29yZGluZGV4KSBjcml0ZXJpYV9pZHMuZm9yRWFjaChpZHggPT4ge1xuICAgICAgICBjb21wYXJlID0gY29tcGFyZSAmJiAocmVjb3JkW2lkeF0gPT09IHJvd1tpZHhdKTtcbiAgICAgIH0pO1xuICAgICAgaWYgKGNvbXBhcmUpIGluZGV4ZXMucHVzaChTdHJpbmcocm93W2NlbGxpZF0pKTtcbiAgICAgIHJldHVybiBjb21wYXJlO1xuICAgIH0pO1xuICAgIHN0YXRlLmRpc3BsYXlTZWxlY3RlZChjcml0ZXJpYV9pZHMsIGluZGV4ZXMsIGNlbGxpZCwgdG9nZ2xlKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlc2V0RmlsdGVyKCkge1xuICAgIHN0YXRlLmRpc3BsYXlTZWxlY3RlZChbXSwgW10sIGNlbGxpZCwgdG9nZ2xlKTtcbiAgfVxuXG4gIGlmIChhdHRhY2gpIHtcbiAgICBhdHRhY2guZmlsdGVyQnlSZWNvcmQgPSBmaWx0ZXJCeVJlY29yZDtcbiAgICBhdHRhY2gucmVzZXRGaWx0ZXIgPSByZXNldEZpbHRlcjtcbiAgICBhdHRhY2guY29tcGlsZVByb2plY3RSZWNvcmRzID0gY29tcGlsZVByb2plY3RSZWNvcmRzO1xuICAgIGF0dGFjaC5pbml0TGlzdCA9IGluaXRMaXN0O1xuICB9IGVsc2UgcmV0dXJuIHtcbiAgICBmaWx0ZXJCeVJlY29yZCxcbiAgICByZXNldEZpbHRlcixcbiAgICBpbml0TGlzdFxuICB9XG5cbn1cbmV4cG9ydCB7XG4gIEltcG9ydExpc3Rcbn0iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/modules/table-projects-tools.js\n")}}]);