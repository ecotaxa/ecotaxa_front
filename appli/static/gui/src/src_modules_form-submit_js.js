/*! For license information please see src_modules_form-submit_js.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["src_modules_form-submit_js"],{"./src/modules/form-submit.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   FormSubmit: () => (/* binding */ FormSubmit)\n/* harmony export */ });\n/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! dompurify */ \"./node_modules/dompurify/dist/purify.js\");\n/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(dompurify__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../modules/modules-config.js */ \"./src/modules/modules-config.js\");\n/* harmony import */ var _modules_utils_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../modules/utils.js */ \"./src/modules/utils.js\");\n\n\n\n\n\n_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.domselectors.captcha = '.js-captcha';\n_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.invalid = 'invalid';\n_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.inputvalid = 'valid';\n_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.required = 'required';\n_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.tshidden = 'ts-hidden-accessible';\nclass FormSubmit {\n  handlers = {\n    validate: [],\n    submit: []\n  };\n  form = null;\n  listener = null;\n  constructor(form, options = {}) {\n    if (!form) return;\n    if (!form.formsubmit) {\n      this.form = form instanceof HTMLElement ? form : document.querySelector(form);\n      const defaultOptions = {\n        fetch: null,\n      };\n      options = Object.assign(options, this.form.dataset);\n      this.options = Object.assign(defaultOptions, options);\n      if (!this.form) return;\n      this.tabs = this.form.querySelectorAll(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.domselectors.component.tabs.tab);\n      this.validateFields(true);\n      this.init();\n      form.formsubmit = this;\n    }\n    return form.formsubmit;\n  }\n  init() {\n\n    // init the form ( options like beforeunload etc...)\n    this.form.addEventListener('keydown', (e) => {\n      // prevent enter submit\n      if (e.key === 'Enter' && e.target instanceof HTMLInputElement) e.preventDefault();\n    });\n    window.addEventListener(\"pageshow\", (e) => {\n      const historytraversal = event.persisted ||\n        (typeof window.performance != \"undefined\" &&\n          window.performance.navigation.type === 2);\n      if (historytraversal) {\n        this.enableForm();\n      }\n    });\n    this.form.addEventListener('validate', (e) => {\n      this.validateFields();\n    });\n    this.form.addEventListener('submit', async (e) => {\n      e.preventDefault();\n      const res = await this.submitForm();\n      return res;\n    });\n    this.specialFields();\n  }\n  specialFields() {\n    // check if there is a password confirm input\n    // add show text for password fields\n\n    this.form.querySelectorAll('input[data-match]').forEach(input => { //\n      const match = input.dataset.match;\n      if (!match) return;\n      const target = document.getElementById(match);\n      if (!target) return;\n      const invalid = (input.dataset.matchinvalid) ? input.dataset.matchinvalid : \"no match\";\n      const check_match = (item, itemtarget) => {\n        const label = item.closest(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.domselectors.component.form.formbox).querySelector('label[for=\"' + item.id + '\"]');\n        const labeltarget = itemtarget.closest(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.domselectors.component.form.formbox).querySelector('label[for=\"' + itemtarget.id + '\"]');\n        const {\n          patternMismatch = false\n        } = item.validity;\n        const customvalidity = (patternMismatch) ? this.getMessage(item, 'invalid') : ``;\n        if (item.checkValidity() === true) {\n          item.setCustomValidity('');\n          if (item == input && label !== null) label.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.invalid);\n          else if (labeltarget !== null) labeltarget.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.invalid);\n          item.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.invalid);\n          if (item.value !== itemtarget.value) {\n            itemtarget.setCustomValidity(invalid);\n            if (labeltarget) {\n              labeltarget.dataset.invalid = invalid;\n              labeltarget.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.invalid);\n            }\n            itemtarget.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.invalid);\n          } else {\n            itemtarget.setCustomValidity(\"\");\n            if (labeltarget) labeltarget.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.invalid);\n            itemtarget.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.invalid);\n          }\n        } else {\n          item.setCustomValidity(customvalidity);\n          label.dataset.invalid = customvalidity;\n          if (label) label.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.invalid);\n          item.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.invalid);\n        }\n        item.focus();\n      };\n      [input, target].forEach(item => {\n        item.addEventListener('keyup', (e) => {\n          const itemtarget = (item === input) ? target : input;\n          const itemsrc = (item === input) ? input : target;\n          check_match(itemsrc, itemtarget);\n        });\n      });\n\n    });\n  }\n  getMessage(field, type = 'invalid') {\n    const {\n      valueMissing = true\n    } = field.validity;\n    if (valueMissing) return `* ` + ((field.dataset.required) ? field.dataset.required : ((this.form.dataset.required) ? this.form.dataset.required : (field.validationMessage) ? (field.validationMessage) : 'required'));\n    else return (field.dataset[type]) ? field.dataset[type] : (field.validationMessage) ? (field.validationMessage) : 'input invalid';\n  }\n  setLabelState(field, valid) {\n    const label = this.getFieldLabel(field);\n    if (label == null) return;\n    if (valid === true) {\n      label.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.invalid);\n    } else {\n      label.dataset.invalid = this.getMessage(field);\n      label.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.invalid);\n      const rect = label.getBoundingClientRect();\n      const x = rect.left;\n      const y = rect.top;\n      window.scrollTo({\n        top: y,\n        left: x,\n        behavior: 'smooth'\n      });\n    }\n  }\n  validateField(field, init = false) {\n    if (['select'].indexOf(field.tagName.toLowerCase()) >= 0) {\n      field.querySelectorAll('option:checked').forEach(option => {\n        option.value = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_2__.decode_HTMLEntities)(dompurify__WEBPACK_IMPORTED_MODULE_0___default().sanitize(option.value));\n      });\n    } else field.value = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_2__.decode_HTMLEntities)(dompurify__WEBPACK_IMPORTED_MODULE_0___default().sanitize(field.value));\n    if (field.tomselect) field.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.tshidden);\n    let rep = field.checkValidity();\n    if (field.tomselect) field.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.tshidden);\n    if (rep && field.dataset.unique !== undefined) {\n      rep = this.validateFieldUnique(field);\n    }\n    const evt = document.createEvent(\"Event\");\n    evt.initEvent(((rep) ? 'valid' : 'invalid'), true, true);\n    field.dispatchEvent(evt);\n    return rep;\n  }\n\n  getFieldLabel(field) {\n    let label = field.closest('[for=\"' + field.name + '\"]') ? field.closest('[for=\"' + field.name + '\"]') : (field.closest('[data-for=\"' + field.name + '\"]')) ? field.closest('[data-for=\"' + field.name + '\"]') : null;\n    if (label === null) {\n      label = (field.closest(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.domselectors.component.form.formbox)) ? ((field.closest(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.domselectors.component.form.formbox).querySelector('.label')) ? field.closest(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.domselectors.component.form.formbox).querySelector('.label') : field.closest(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.domselectors.component.form.formbox).querySelector('label')) : null;\n    }\n    if (label === null) {\n      label = (field.parentElement && field.parentElement.dataset.elem) ? ((field.closest('fieldset')) ? field.closest('fieldset').querySelector('.' + field.parentElement.dataset.elem) : null) : null;\n    }\n\n    return label;\n  }\n  validateFieldUnique(field) {\n    const label = this.getFieldLabel(field);\n    if (String(field.dataset.unique).toLowerCase() === String(field.value).toLowerCase()) {\n      //field.dataset.invalid = window.alertbox.i18nmessages.noduplicate;\n      // just send a warning for the moment\n      if (label) {\n        label.dataset.confirm = window.alertbox.i18nmessages.noduplicate;\n        label.classList.add(window.alertbox.alertconfig.css.confirm);\n      }\n      const callback_cancel = function() {\n        field.dataset.unique = false;\n        if (label) {\n          label.classList.remove(window.alertbox.alertconfig.css.confirm);\n          delete label.dataset.confirm;\n        }\n      }\n      const confirm = window.alertbox.createConfirm(((label) ? label.textContent + ` : ` : ``) + window.alertbox.i18nmessages.noduplicate, {\n        callback_cancel: callback_cancel,\n        buttons: {\n          ok: {\n            text: window.alertbox.i18nmessages.modify\n          },\n          cancel: {\n            text: window.alertbox.i18nmessages.saveanyway\n          }\n        }\n      });\n      return confirm;\n    } else if (label.dataset.confirm) {\n      label.classList.remove(window.alertbox.alertconfig.css.confirm);\n      delete label.dataset.confirm;\n    }\n    return true;\n  }\n  async validateFields(init = false) {\n    //todo: complete validation foreach field type\n    let resp = true,\n      r = true;\n    [...this.form.elements].forEach(field => {\n      if (init === true) {\n        if (!field.dataset.listen) {\n          if (field.required) {\n            const label = this.getFieldLabel(field);\n            if (label) label.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.required);\n          }\n          field.addEventListener('change', (e) => {\n            this.validateField(e.target);\n          });\n          field.dataset.listen = true;\n          field.addEventListener('invalid', (e) => {\n            this.setLabelState(field, false);\n          });\n          field.addEventListener('valid', (e) => {\n            this.setLabelState(field, true);\n          });\n        }\n      } else if (field.name && field.type && (['submit', 'hidden'].indexOf(field.type) < 0 && (['radio', 'checkbox'].indexOf(field.type) < 0 || field.required))) {\n        r = this.validateField(field, false);\n        resp = (resp && r);\n      }\n\n    });\n    if (init === false) {\n      // add/remove error class on tabs tab-control elements\n      this.tabs.forEach(tab => {\n        if (tab.querySelector(':invalid') || tab.querySelector(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.domselectors.component.alert.danger)) tab.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.error);\n        else tab.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.error);\n      });\n      r = await this.execHandler('validate');\n    }\n    return (r && resp);\n  }\n\n  addHandler(type, handler) {\n    this.handlers[type].push(handler);\n  }\n  fieldEnable(enable = true) {\n    this.form.querySelectorAll('input[data-sub=\"enable\"]').forEach(input => {\n      if (enable === true) {\n        input.disabled = false;\n      } else input.disabled = true;\n    });\n  }\n\n  async execHandler(type) {\n    if (this.handlers[type].length === 0) return true;\n    let resp = true;\n    // series\n    /*  for (const handler of this.handlers) {\n          const rep = await handler()\n          resp = (resp && rep)\n      }*/\n    // concurrent\n    await Promise.all(this.handlers[type].map(async handler => {\n      const rep = await handler();\n      resp = (resp && rep);\n    }));\n    //  if (resp === true) this.handlers[type] = [];\n    return resp;\n  }\n  // no redirection when using data-fetch\n  formFetch(format = null) {\n    const formdata = new FormData(this.form);\n    formdata[\"fetch\"] = true;\n    fetch(this.form.action, (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_2__.fetchSettings)({\n        method: 'POST',\n        body: formdata,\n      }))\n      .then(response => {\n        switch (format) {\n          case \"text\":\n          case \"html\":\n            return response.text();\n            break;\n          default:\n            return response.json();\n        }\n      })\n      .then(response => {\n        this.displayResponse(response);\n      })\n      .catch(err => {\n        this.displayResponse(err, true)\n      }).finally(response => {\n        this.form.disabled = true;\n      });\n    return false;\n  }\n\n  async submitForm() {\n    this.fieldEnable();\n    // important async\n    const valid = await this.validateFields(false);\n\n    if (valid) {\n      const isbot = (this.form.querySelector(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.domselectors.captcha)) ? (this.form.dataset.isbot ? (this.form.dataset.isbot === true) : true) : false;\n      if (isbot === true) return false;\n      const yessubmit = await this.execHandler('submit');\n      if (yessubmit) {\n        if (this.options.fetch) this.formFetch(this.options.fetch);\n        else this.form.submit();\n        this.disableForm();\n        return true;\n      }\n    }\n    return false;\n  }\n  enableForm() {\n    this.form.disabled = false;\n    const btn = (this.form.querySelector('[type=\"submit\"] svg'));\n    if (btn) btn.remove();\n  }\n  disableForm() {\n    this.form.disabled = true;\n    const btn = this.form.querySelector('[type=\"submit\"]');\n    if (btn) btn.insertAdjacentHTML('afterbegin', (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_2__.html_spinner)('text-stone-50 ml-1 mr-2 align-text-bottom inline-block'));\n\n  }\n  displayResponse(response, error = false) {\n    const el = document.createElement('div');\n    el.insertAdjacentHTML('afterbegin', response);\n    if (error !== false) el.classList.add('is-error');\n    this.form.parentElement.insertBefore(el, this.form);\n    this.form.remove();\n  }\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1IsS0FBSztBQUNMOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLGdFQUFhO0FBQ3pDO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBLE9BQU87QUFDUDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsNkNBQTZDLG9FQUFZO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0RBQWtELCtEQUFZOztBQUU5RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvbW9kdWxlcy9mb3JtLXN1Ym1pdC5qcz9jNmI3Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB2YWxpZGF0b3IgZnJvbSAndmFsaWRhdG9yJztcbmltcG9ydCBET01QdXJpZnkgZnJvbSAnZG9tcHVyaWZ5JztcbmltcG9ydCB7XG4gIGRvbXNlbGVjdG9ycyxcbiAgY3NzXG59IGZyb20gJy4uL21vZHVsZXMvbW9kdWxlcy1jb25maWcuanMnO1xuaW1wb3J0IHtcbiAgZmV0Y2hTZXR0aW5ncyxcbiAgZGVjb2RlX0hUTUxFbnRpdGllcyxcbiAgaHRtbF9zcGlubmVyLFxufSBmcm9tICcuLi9tb2R1bGVzL3V0aWxzLmpzJztcblxuZG9tc2VsZWN0b3JzLmNhcHRjaGEgPSAnLmpzLWNhcHRjaGEnO1xuY3NzLmludmFsaWQgPSAnaW52YWxpZCc7XG5jc3MuaW5wdXR2YWxpZCA9ICd2YWxpZCc7XG5jc3MucmVxdWlyZWQgPSAncmVxdWlyZWQnO1xuY3NzLnRzaGlkZGVuID0gJ3RzLWhpZGRlbi1hY2Nlc3NpYmxlJztcbmV4cG9ydCBjbGFzcyBGb3JtU3VibWl0IHtcbiAgaGFuZGxlcnMgPSB7XG4gICAgdmFsaWRhdGU6IFtdLFxuICAgIHN1Ym1pdDogW11cbiAgfTtcbiAgZm9ybSA9IG51bGw7XG4gIGxpc3RlbmVyID0gbnVsbDtcbiAgY29uc3RydWN0b3IoZm9ybSwgb3B0aW9ucyA9IHt9KSB7XG4gICAgaWYgKCFmb3JtKSByZXR1cm47XG4gICAgaWYgKCFmb3JtLmZvcm1zdWJtaXQpIHtcbiAgICAgIHRoaXMuZm9ybSA9IGZvcm0gaW5zdGFuY2VvZiBIVE1MRWxlbWVudCA/IGZvcm0gOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGZvcm0pO1xuICAgICAgY29uc3QgZGVmYXVsdE9wdGlvbnMgPSB7XG4gICAgICAgIGZldGNoOiBudWxsLFxuICAgICAgfTtcbiAgICAgIG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKG9wdGlvbnMsIHRoaXMuZm9ybS5kYXRhc2V0KTtcbiAgICAgIHRoaXMub3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oZGVmYXVsdE9wdGlvbnMsIG9wdGlvbnMpO1xuICAgICAgaWYgKCF0aGlzLmZvcm0pIHJldHVybjtcbiAgICAgIHRoaXMudGFicyA9IHRoaXMuZm9ybS5xdWVyeVNlbGVjdG9yQWxsKGRvbXNlbGVjdG9ycy5jb21wb25lbnQudGFicy50YWIpO1xuICAgICAgdGhpcy52YWxpZGF0ZUZpZWxkcyh0cnVlKTtcbiAgICAgIHRoaXMuaW5pdCgpO1xuICAgICAgZm9ybS5mb3Jtc3VibWl0ID0gdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIGZvcm0uZm9ybXN1Ym1pdDtcbiAgfVxuICBpbml0KCkge1xuXG4gICAgLy8gaW5pdCB0aGUgZm9ybSAoIG9wdGlvbnMgbGlrZSBiZWZvcmV1bmxvYWQgZXRjLi4uKVxuICAgIHRoaXMuZm9ybS5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgKGUpID0+IHtcbiAgICAgIC8vIHByZXZlbnQgZW50ZXIgc3VibWl0XG4gICAgICBpZiAoZS5rZXkgPT09ICdFbnRlcicgJiYgZS50YXJnZXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgfSk7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJwYWdlc2hvd1wiLCAoZSkgPT4ge1xuICAgICAgY29uc3QgaGlzdG9yeXRyYXZlcnNhbCA9IGV2ZW50LnBlcnNpc3RlZCB8fFxuICAgICAgICAodHlwZW9mIHdpbmRvdy5wZXJmb3JtYW5jZSAhPSBcInVuZGVmaW5lZFwiICYmXG4gICAgICAgICAgd2luZG93LnBlcmZvcm1hbmNlLm5hdmlnYXRpb24udHlwZSA9PT0gMik7XG4gICAgICBpZiAoaGlzdG9yeXRyYXZlcnNhbCkge1xuICAgICAgICB0aGlzLmVuYWJsZUZvcm0oKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICB0aGlzLmZvcm0uYWRkRXZlbnRMaXN0ZW5lcigndmFsaWRhdGUnLCAoZSkgPT4ge1xuICAgICAgdGhpcy52YWxpZGF0ZUZpZWxkcygpO1xuICAgIH0pO1xuICAgIHRoaXMuZm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCBhc3luYyAoZSkgPT4ge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5zdWJtaXRGb3JtKCk7XG4gICAgICByZXR1cm4gcmVzO1xuICAgIH0pO1xuICAgIHRoaXMuc3BlY2lhbEZpZWxkcygpO1xuICB9XG4gIHNwZWNpYWxGaWVsZHMoKSB7XG4gICAgLy8gY2hlY2sgaWYgdGhlcmUgaXMgYSBwYXNzd29yZCBjb25maXJtIGlucHV0XG4gICAgLy8gYWRkIHNob3cgdGV4dCBmb3IgcGFzc3dvcmQgZmllbGRzXG5cbiAgICB0aGlzLmZvcm0ucXVlcnlTZWxlY3RvckFsbCgnaW5wdXRbZGF0YS1tYXRjaF0nKS5mb3JFYWNoKGlucHV0ID0+IHsgLy9cbiAgICAgIGNvbnN0IG1hdGNoID0gaW5wdXQuZGF0YXNldC5tYXRjaDtcbiAgICAgIGlmICghbWF0Y2gpIHJldHVybjtcbiAgICAgIGNvbnN0IHRhcmdldCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1hdGNoKTtcbiAgICAgIGlmICghdGFyZ2V0KSByZXR1cm47XG4gICAgICBjb25zdCBpbnZhbGlkID0gKGlucHV0LmRhdGFzZXQubWF0Y2hpbnZhbGlkKSA/IGlucHV0LmRhdGFzZXQubWF0Y2hpbnZhbGlkIDogXCJubyBtYXRjaFwiO1xuICAgICAgY29uc3QgY2hlY2tfbWF0Y2ggPSAoaXRlbSwgaXRlbXRhcmdldCkgPT4ge1xuICAgICAgICBjb25zdCBsYWJlbCA9IGl0ZW0uY2xvc2VzdChkb21zZWxlY3RvcnMuY29tcG9uZW50LmZvcm0uZm9ybWJveCkucXVlcnlTZWxlY3RvcignbGFiZWxbZm9yPVwiJyArIGl0ZW0uaWQgKyAnXCJdJyk7XG4gICAgICAgIGNvbnN0IGxhYmVsdGFyZ2V0ID0gaXRlbXRhcmdldC5jbG9zZXN0KGRvbXNlbGVjdG9ycy5jb21wb25lbnQuZm9ybS5mb3JtYm94KS5xdWVyeVNlbGVjdG9yKCdsYWJlbFtmb3I9XCInICsgaXRlbXRhcmdldC5pZCArICdcIl0nKTtcbiAgICAgICAgY29uc3Qge1xuICAgICAgICAgIHBhdHRlcm5NaXNtYXRjaCA9IGZhbHNlXG4gICAgICAgIH0gPSBpdGVtLnZhbGlkaXR5O1xuICAgICAgICBjb25zdCBjdXN0b212YWxpZGl0eSA9IChwYXR0ZXJuTWlzbWF0Y2gpID8gdGhpcy5nZXRNZXNzYWdlKGl0ZW0sICdpbnZhbGlkJykgOiBgYDtcbiAgICAgICAgaWYgKGl0ZW0uY2hlY2tWYWxpZGl0eSgpID09PSB0cnVlKSB7XG4gICAgICAgICAgaXRlbS5zZXRDdXN0b21WYWxpZGl0eSgnJyk7XG4gICAgICAgICAgaWYgKGl0ZW0gPT0gaW5wdXQgJiYgbGFiZWwgIT09IG51bGwpIGxhYmVsLmNsYXNzTGlzdC5yZW1vdmUoY3NzLmludmFsaWQpO1xuICAgICAgICAgIGVsc2UgaWYgKGxhYmVsdGFyZ2V0ICE9PSBudWxsKSBsYWJlbHRhcmdldC5jbGFzc0xpc3QucmVtb3ZlKGNzcy5pbnZhbGlkKTtcbiAgICAgICAgICBpdGVtLmNsYXNzTGlzdC5yZW1vdmUoY3NzLmludmFsaWQpO1xuICAgICAgICAgIGlmIChpdGVtLnZhbHVlICE9PSBpdGVtdGFyZ2V0LnZhbHVlKSB7XG4gICAgICAgICAgICBpdGVtdGFyZ2V0LnNldEN1c3RvbVZhbGlkaXR5KGludmFsaWQpO1xuICAgICAgICAgICAgaWYgKGxhYmVsdGFyZ2V0KSB7XG4gICAgICAgICAgICAgIGxhYmVsdGFyZ2V0LmRhdGFzZXQuaW52YWxpZCA9IGludmFsaWQ7XG4gICAgICAgICAgICAgIGxhYmVsdGFyZ2V0LmNsYXNzTGlzdC5hZGQoY3NzLmludmFsaWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaXRlbXRhcmdldC5jbGFzc0xpc3QuYWRkKGNzcy5pbnZhbGlkKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaXRlbXRhcmdldC5zZXRDdXN0b21WYWxpZGl0eShcIlwiKTtcbiAgICAgICAgICAgIGlmIChsYWJlbHRhcmdldCkgbGFiZWx0YXJnZXQuY2xhc3NMaXN0LnJlbW92ZShjc3MuaW52YWxpZCk7XG4gICAgICAgICAgICBpdGVtdGFyZ2V0LmNsYXNzTGlzdC5yZW1vdmUoY3NzLmludmFsaWQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpdGVtLnNldEN1c3RvbVZhbGlkaXR5KGN1c3RvbXZhbGlkaXR5KTtcbiAgICAgICAgICBsYWJlbC5kYXRhc2V0LmludmFsaWQgPSBjdXN0b212YWxpZGl0eTtcbiAgICAgICAgICBpZiAobGFiZWwpIGxhYmVsLmNsYXNzTGlzdC5hZGQoY3NzLmludmFsaWQpO1xuICAgICAgICAgIGl0ZW0uY2xhc3NMaXN0LmFkZChjc3MuaW52YWxpZCk7XG4gICAgICAgIH1cbiAgICAgICAgaXRlbS5mb2N1cygpO1xuICAgICAgfTtcbiAgICAgIFtpbnB1dCwgdGFyZ2V0XS5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgKGUpID0+IHtcbiAgICAgICAgICBjb25zdCBpdGVtdGFyZ2V0ID0gKGl0ZW0gPT09IGlucHV0KSA/IHRhcmdldCA6IGlucHV0O1xuICAgICAgICAgIGNvbnN0IGl0ZW1zcmMgPSAoaXRlbSA9PT0gaW5wdXQpID8gaW5wdXQgOiB0YXJnZXQ7XG4gICAgICAgICAgY2hlY2tfbWF0Y2goaXRlbXNyYywgaXRlbXRhcmdldCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICB9KTtcbiAgfVxuICBnZXRNZXNzYWdlKGZpZWxkLCB0eXBlID0gJ2ludmFsaWQnKSB7XG4gICAgY29uc3Qge1xuICAgICAgdmFsdWVNaXNzaW5nID0gdHJ1ZVxuICAgIH0gPSBmaWVsZC52YWxpZGl0eTtcbiAgICBpZiAodmFsdWVNaXNzaW5nKSByZXR1cm4gYCogYCArICgoZmllbGQuZGF0YXNldC5yZXF1aXJlZCkgPyBmaWVsZC5kYXRhc2V0LnJlcXVpcmVkIDogKCh0aGlzLmZvcm0uZGF0YXNldC5yZXF1aXJlZCkgPyB0aGlzLmZvcm0uZGF0YXNldC5yZXF1aXJlZCA6IChmaWVsZC52YWxpZGF0aW9uTWVzc2FnZSkgPyAoZmllbGQudmFsaWRhdGlvbk1lc3NhZ2UpIDogJ3JlcXVpcmVkJykpO1xuICAgIGVsc2UgcmV0dXJuIChmaWVsZC5kYXRhc2V0W3R5cGVdKSA/IGZpZWxkLmRhdGFzZXRbdHlwZV0gOiAoZmllbGQudmFsaWRhdGlvbk1lc3NhZ2UpID8gKGZpZWxkLnZhbGlkYXRpb25NZXNzYWdlKSA6ICdpbnB1dCBpbnZhbGlkJztcbiAgfVxuICBzZXRMYWJlbFN0YXRlKGZpZWxkLCB2YWxpZCkge1xuICAgIGNvbnN0IGxhYmVsID0gdGhpcy5nZXRGaWVsZExhYmVsKGZpZWxkKTtcbiAgICBpZiAobGFiZWwgPT0gbnVsbCkgcmV0dXJuO1xuICAgIGlmICh2YWxpZCA9PT0gdHJ1ZSkge1xuICAgICAgbGFiZWwuY2xhc3NMaXN0LnJlbW92ZShjc3MuaW52YWxpZCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxhYmVsLmRhdGFzZXQuaW52YWxpZCA9IHRoaXMuZ2V0TWVzc2FnZShmaWVsZCk7XG4gICAgICBsYWJlbC5jbGFzc0xpc3QuYWRkKGNzcy5pbnZhbGlkKTtcbiAgICAgIGNvbnN0IHJlY3QgPSBsYWJlbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgIGNvbnN0IHggPSByZWN0LmxlZnQ7XG4gICAgICBjb25zdCB5ID0gcmVjdC50b3A7XG4gICAgICB3aW5kb3cuc2Nyb2xsVG8oe1xuICAgICAgICB0b3A6IHksXG4gICAgICAgIGxlZnQ6IHgsXG4gICAgICAgIGJlaGF2aW9yOiAnc21vb3RoJ1xuICAgICAgfSk7XG4gICAgfVxuICB9XG4gIHZhbGlkYXRlRmllbGQoZmllbGQsIGluaXQgPSBmYWxzZSkge1xuICAgIGlmIChbJ3NlbGVjdCddLmluZGV4T2YoZmllbGQudGFnTmFtZS50b0xvd2VyQ2FzZSgpKSA+PSAwKSB7XG4gICAgICBmaWVsZC5xdWVyeVNlbGVjdG9yQWxsKCdvcHRpb246Y2hlY2tlZCcpLmZvckVhY2gob3B0aW9uID0+IHtcbiAgICAgICAgb3B0aW9uLnZhbHVlID0gZGVjb2RlX0hUTUxFbnRpdGllcyhET01QdXJpZnkuc2FuaXRpemUob3B0aW9uLnZhbHVlKSk7XG4gICAgICB9KTtcbiAgICB9IGVsc2UgZmllbGQudmFsdWUgPSBkZWNvZGVfSFRNTEVudGl0aWVzKERPTVB1cmlmeS5zYW5pdGl6ZShmaWVsZC52YWx1ZSkpO1xuICAgIGlmIChmaWVsZC50b21zZWxlY3QpIGZpZWxkLmNsYXNzTGlzdC5yZW1vdmUoY3NzLnRzaGlkZGVuKTtcbiAgICBsZXQgcmVwID0gZmllbGQuY2hlY2tWYWxpZGl0eSgpO1xuICAgIGlmIChmaWVsZC50b21zZWxlY3QpIGZpZWxkLmNsYXNzTGlzdC5hZGQoY3NzLnRzaGlkZGVuKTtcbiAgICBpZiAocmVwICYmIGZpZWxkLmRhdGFzZXQudW5pcXVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHJlcCA9IHRoaXMudmFsaWRhdGVGaWVsZFVuaXF1ZShmaWVsZCk7XG4gICAgfVxuICAgIGNvbnN0IGV2dCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KFwiRXZlbnRcIik7XG4gICAgZXZ0LmluaXRFdmVudCgoKHJlcCkgPyAndmFsaWQnIDogJ2ludmFsaWQnKSwgdHJ1ZSwgdHJ1ZSk7XG4gICAgZmllbGQuZGlzcGF0Y2hFdmVudChldnQpO1xuICAgIHJldHVybiByZXA7XG4gIH1cblxuICBnZXRGaWVsZExhYmVsKGZpZWxkKSB7XG4gICAgbGV0IGxhYmVsID0gZmllbGQuY2xvc2VzdCgnW2Zvcj1cIicgKyBmaWVsZC5uYW1lICsgJ1wiXScpID8gZmllbGQuY2xvc2VzdCgnW2Zvcj1cIicgKyBmaWVsZC5uYW1lICsgJ1wiXScpIDogKGZpZWxkLmNsb3Nlc3QoJ1tkYXRhLWZvcj1cIicgKyBmaWVsZC5uYW1lICsgJ1wiXScpKSA/IGZpZWxkLmNsb3Nlc3QoJ1tkYXRhLWZvcj1cIicgKyBmaWVsZC5uYW1lICsgJ1wiXScpIDogbnVsbDtcbiAgICBpZiAobGFiZWwgPT09IG51bGwpIHtcbiAgICAgIGxhYmVsID0gKGZpZWxkLmNsb3Nlc3QoZG9tc2VsZWN0b3JzLmNvbXBvbmVudC5mb3JtLmZvcm1ib3gpKSA/ICgoZmllbGQuY2xvc2VzdChkb21zZWxlY3RvcnMuY29tcG9uZW50LmZvcm0uZm9ybWJveCkucXVlcnlTZWxlY3RvcignLmxhYmVsJykpID8gZmllbGQuY2xvc2VzdChkb21zZWxlY3RvcnMuY29tcG9uZW50LmZvcm0uZm9ybWJveCkucXVlcnlTZWxlY3RvcignLmxhYmVsJykgOiBmaWVsZC5jbG9zZXN0KGRvbXNlbGVjdG9ycy5jb21wb25lbnQuZm9ybS5mb3JtYm94KS5xdWVyeVNlbGVjdG9yKCdsYWJlbCcpKSA6IG51bGw7XG4gICAgfVxuICAgIGlmIChsYWJlbCA9PT0gbnVsbCkge1xuICAgICAgbGFiZWwgPSAoZmllbGQucGFyZW50RWxlbWVudCAmJiBmaWVsZC5wYXJlbnRFbGVtZW50LmRhdGFzZXQuZWxlbSkgPyAoKGZpZWxkLmNsb3Nlc3QoJ2ZpZWxkc2V0JykpID8gZmllbGQuY2xvc2VzdCgnZmllbGRzZXQnKS5xdWVyeVNlbGVjdG9yKCcuJyArIGZpZWxkLnBhcmVudEVsZW1lbnQuZGF0YXNldC5lbGVtKSA6IG51bGwpIDogbnVsbDtcbiAgICB9XG5cbiAgICByZXR1cm4gbGFiZWw7XG4gIH1cbiAgdmFsaWRhdGVGaWVsZFVuaXF1ZShmaWVsZCkge1xuICAgIGNvbnN0IGxhYmVsID0gdGhpcy5nZXRGaWVsZExhYmVsKGZpZWxkKTtcbiAgICBpZiAoU3RyaW5nKGZpZWxkLmRhdGFzZXQudW5pcXVlKS50b0xvd2VyQ2FzZSgpID09PSBTdHJpbmcoZmllbGQudmFsdWUpLnRvTG93ZXJDYXNlKCkpIHtcbiAgICAgIC8vZmllbGQuZGF0YXNldC5pbnZhbGlkID0gd2luZG93LmFsZXJ0Ym94LmkxOG5tZXNzYWdlcy5ub2R1cGxpY2F0ZTtcbiAgICAgIC8vIGp1c3Qgc2VuZCBhIHdhcm5pbmcgZm9yIHRoZSBtb21lbnRcbiAgICAgIGlmIChsYWJlbCkge1xuICAgICAgICBsYWJlbC5kYXRhc2V0LmNvbmZpcm0gPSB3aW5kb3cuYWxlcnRib3guaTE4bm1lc3NhZ2VzLm5vZHVwbGljYXRlO1xuICAgICAgICBsYWJlbC5jbGFzc0xpc3QuYWRkKHdpbmRvdy5hbGVydGJveC5hbGVydGNvbmZpZy5jc3MuY29uZmlybSk7XG4gICAgICB9XG4gICAgICBjb25zdCBjYWxsYmFja19jYW5jZWwgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgZmllbGQuZGF0YXNldC51bmlxdWUgPSBmYWxzZTtcbiAgICAgICAgaWYgKGxhYmVsKSB7XG4gICAgICAgICAgbGFiZWwuY2xhc3NMaXN0LnJlbW92ZSh3aW5kb3cuYWxlcnRib3guYWxlcnRjb25maWcuY3NzLmNvbmZpcm0pO1xuICAgICAgICAgIGRlbGV0ZSBsYWJlbC5kYXRhc2V0LmNvbmZpcm07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNvbnN0IGNvbmZpcm0gPSB3aW5kb3cuYWxlcnRib3guY3JlYXRlQ29uZmlybSgoKGxhYmVsKSA/IGxhYmVsLnRleHRDb250ZW50ICsgYCA6IGAgOiBgYCkgKyB3aW5kb3cuYWxlcnRib3guaTE4bm1lc3NhZ2VzLm5vZHVwbGljYXRlLCB7XG4gICAgICAgIGNhbGxiYWNrX2NhbmNlbDogY2FsbGJhY2tfY2FuY2VsLFxuICAgICAgICBidXR0b25zOiB7XG4gICAgICAgICAgb2s6IHtcbiAgICAgICAgICAgIHRleHQ6IHdpbmRvdy5hbGVydGJveC5pMThubWVzc2FnZXMubW9kaWZ5XG4gICAgICAgICAgfSxcbiAgICAgICAgICBjYW5jZWw6IHtcbiAgICAgICAgICAgIHRleHQ6IHdpbmRvdy5hbGVydGJveC5pMThubWVzc2FnZXMuc2F2ZWFueXdheVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gY29uZmlybTtcbiAgICB9IGVsc2UgaWYgKGxhYmVsLmRhdGFzZXQuY29uZmlybSkge1xuICAgICAgbGFiZWwuY2xhc3NMaXN0LnJlbW92ZSh3aW5kb3cuYWxlcnRib3guYWxlcnRjb25maWcuY3NzLmNvbmZpcm0pO1xuICAgICAgZGVsZXRlIGxhYmVsLmRhdGFzZXQuY29uZmlybTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgYXN5bmMgdmFsaWRhdGVGaWVsZHMoaW5pdCA9IGZhbHNlKSB7XG4gICAgLy90b2RvOiBjb21wbGV0ZSB2YWxpZGF0aW9uIGZvcmVhY2ggZmllbGQgdHlwZVxuICAgIGxldCByZXNwID0gdHJ1ZSxcbiAgICAgIHIgPSB0cnVlO1xuICAgIFsuLi50aGlzLmZvcm0uZWxlbWVudHNdLmZvckVhY2goZmllbGQgPT4ge1xuICAgICAgaWYgKGluaXQgPT09IHRydWUpIHtcbiAgICAgICAgaWYgKCFmaWVsZC5kYXRhc2V0Lmxpc3Rlbikge1xuICAgICAgICAgIGlmIChmaWVsZC5yZXF1aXJlZCkge1xuICAgICAgICAgICAgY29uc3QgbGFiZWwgPSB0aGlzLmdldEZpZWxkTGFiZWwoZmllbGQpO1xuICAgICAgICAgICAgaWYgKGxhYmVsKSBsYWJlbC5jbGFzc0xpc3QuYWRkKGNzcy5yZXF1aXJlZCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGZpZWxkLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIChlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnZhbGlkYXRlRmllbGQoZS50YXJnZXQpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGZpZWxkLmRhdGFzZXQubGlzdGVuID0gdHJ1ZTtcbiAgICAgICAgICBmaWVsZC5hZGRFdmVudExpc3RlbmVyKCdpbnZhbGlkJywgKGUpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2V0TGFiZWxTdGF0ZShmaWVsZCwgZmFsc2UpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGZpZWxkLmFkZEV2ZW50TGlzdGVuZXIoJ3ZhbGlkJywgKGUpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2V0TGFiZWxTdGF0ZShmaWVsZCwgdHJ1ZSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoZmllbGQubmFtZSAmJiBmaWVsZC50eXBlICYmIChbJ3N1Ym1pdCcsICdoaWRkZW4nXS5pbmRleE9mKGZpZWxkLnR5cGUpIDwgMCAmJiAoWydyYWRpbycsICdjaGVja2JveCddLmluZGV4T2YoZmllbGQudHlwZSkgPCAwIHx8IGZpZWxkLnJlcXVpcmVkKSkpIHtcbiAgICAgICAgciA9IHRoaXMudmFsaWRhdGVGaWVsZChmaWVsZCwgZmFsc2UpO1xuICAgICAgICByZXNwID0gKHJlc3AgJiYgcik7XG4gICAgICB9XG5cbiAgICB9KTtcbiAgICBpZiAoaW5pdCA9PT0gZmFsc2UpIHtcbiAgICAgIC8vIGFkZC9yZW1vdmUgZXJyb3IgY2xhc3Mgb24gdGFicyB0YWItY29udHJvbCBlbGVtZW50c1xuICAgICAgdGhpcy50YWJzLmZvckVhY2godGFiID0+IHtcbiAgICAgICAgaWYgKHRhYi5xdWVyeVNlbGVjdG9yKCc6aW52YWxpZCcpIHx8IHRhYi5xdWVyeVNlbGVjdG9yKGRvbXNlbGVjdG9ycy5jb21wb25lbnQuYWxlcnQuZGFuZ2VyKSkgdGFiLmNsYXNzTGlzdC5hZGQoY3NzLmVycm9yKTtcbiAgICAgICAgZWxzZSB0YWIuY2xhc3NMaXN0LnJlbW92ZShjc3MuZXJyb3IpO1xuICAgICAgfSk7XG4gICAgICByID0gYXdhaXQgdGhpcy5leGVjSGFuZGxlcigndmFsaWRhdGUnKTtcbiAgICB9XG4gICAgcmV0dXJuIChyICYmIHJlc3ApO1xuICB9XG5cbiAgYWRkSGFuZGxlcih0eXBlLCBoYW5kbGVyKSB7XG4gICAgdGhpcy5oYW5kbGVyc1t0eXBlXS5wdXNoKGhhbmRsZXIpO1xuICB9XG4gIGZpZWxkRW5hYmxlKGVuYWJsZSA9IHRydWUpIHtcbiAgICB0aGlzLmZvcm0ucXVlcnlTZWxlY3RvckFsbCgnaW5wdXRbZGF0YS1zdWI9XCJlbmFibGVcIl0nKS5mb3JFYWNoKGlucHV0ID0+IHtcbiAgICAgIGlmIChlbmFibGUgPT09IHRydWUpIHtcbiAgICAgICAgaW5wdXQuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgIH0gZWxzZSBpbnB1dC5kaXNhYmxlZCA9IHRydWU7XG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBleGVjSGFuZGxlcih0eXBlKSB7XG4gICAgaWYgKHRoaXMuaGFuZGxlcnNbdHlwZV0ubGVuZ3RoID09PSAwKSByZXR1cm4gdHJ1ZTtcbiAgICBsZXQgcmVzcCA9IHRydWU7XG4gICAgLy8gc2VyaWVzXG4gICAgLyogIGZvciAoY29uc3QgaGFuZGxlciBvZiB0aGlzLmhhbmRsZXJzKSB7XG4gICAgICAgICAgY29uc3QgcmVwID0gYXdhaXQgaGFuZGxlcigpXG4gICAgICAgICAgcmVzcCA9IChyZXNwICYmIHJlcClcbiAgICAgIH0qL1xuICAgIC8vIGNvbmN1cnJlbnRcbiAgICBhd2FpdCBQcm9taXNlLmFsbCh0aGlzLmhhbmRsZXJzW3R5cGVdLm1hcChhc3luYyBoYW5kbGVyID0+IHtcbiAgICAgIGNvbnN0IHJlcCA9IGF3YWl0IGhhbmRsZXIoKTtcbiAgICAgIHJlc3AgPSAocmVzcCAmJiByZXApO1xuICAgIH0pKTtcbiAgICAvLyAgaWYgKHJlc3AgPT09IHRydWUpIHRoaXMuaGFuZGxlcnNbdHlwZV0gPSBbXTtcbiAgICByZXR1cm4gcmVzcDtcbiAgfVxuICAvLyBubyByZWRpcmVjdGlvbiB3aGVuIHVzaW5nIGRhdGEtZmV0Y2hcbiAgZm9ybUZldGNoKGZvcm1hdCA9IG51bGwpIHtcbiAgICBjb25zdCBmb3JtZGF0YSA9IG5ldyBGb3JtRGF0YSh0aGlzLmZvcm0pO1xuICAgIGZvcm1kYXRhW1wiZmV0Y2hcIl0gPSB0cnVlO1xuICAgIGZldGNoKHRoaXMuZm9ybS5hY3Rpb24sIGZldGNoU2V0dGluZ3Moe1xuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgYm9keTogZm9ybWRhdGEsXG4gICAgICB9KSlcbiAgICAgIC50aGVuKHJlc3BvbnNlID0+IHtcbiAgICAgICAgc3dpdGNoIChmb3JtYXQpIHtcbiAgICAgICAgICBjYXNlIFwidGV4dFwiOlxuICAgICAgICAgIGNhc2UgXCJodG1sXCI6XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UudGV4dCgpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICAudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICAgIHRoaXMuZGlzcGxheVJlc3BvbnNlKHJlc3BvbnNlKTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goZXJyID0+IHtcbiAgICAgICAgdGhpcy5kaXNwbGF5UmVzcG9uc2UoZXJyLCB0cnVlKVxuICAgICAgfSkuZmluYWxseShyZXNwb25zZSA9PiB7XG4gICAgICAgIHRoaXMuZm9ybS5kaXNhYmxlZCA9IHRydWU7XG4gICAgICB9KTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBhc3luYyBzdWJtaXRGb3JtKCkge1xuICAgIHRoaXMuZmllbGRFbmFibGUoKTtcbiAgICAvLyBpbXBvcnRhbnQgYXN5bmNcbiAgICBjb25zdCB2YWxpZCA9IGF3YWl0IHRoaXMudmFsaWRhdGVGaWVsZHMoZmFsc2UpO1xuXG4gICAgaWYgKHZhbGlkKSB7XG4gICAgICBjb25zdCBpc2JvdCA9ICh0aGlzLmZvcm0ucXVlcnlTZWxlY3Rvcihkb21zZWxlY3RvcnMuY2FwdGNoYSkpID8gKHRoaXMuZm9ybS5kYXRhc2V0LmlzYm90ID8gKHRoaXMuZm9ybS5kYXRhc2V0LmlzYm90ID09PSB0cnVlKSA6IHRydWUpIDogZmFsc2U7XG4gICAgICBpZiAoaXNib3QgPT09IHRydWUpIHJldHVybiBmYWxzZTtcbiAgICAgIGNvbnN0IHllc3N1Ym1pdCA9IGF3YWl0IHRoaXMuZXhlY0hhbmRsZXIoJ3N1Ym1pdCcpO1xuICAgICAgaWYgKHllc3N1Ym1pdCkge1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmZldGNoKSB0aGlzLmZvcm1GZXRjaCh0aGlzLm9wdGlvbnMuZmV0Y2gpO1xuICAgICAgICBlbHNlIHRoaXMuZm9ybS5zdWJtaXQoKTtcbiAgICAgICAgdGhpcy5kaXNhYmxlRm9ybSgpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGVuYWJsZUZvcm0oKSB7XG4gICAgdGhpcy5mb3JtLmRpc2FibGVkID0gZmFsc2U7XG4gICAgY29uc3QgYnRuID0gKHRoaXMuZm9ybS5xdWVyeVNlbGVjdG9yKCdbdHlwZT1cInN1Ym1pdFwiXSBzdmcnKSk7XG4gICAgaWYgKGJ0bikgYnRuLnJlbW92ZSgpO1xuICB9XG4gIGRpc2FibGVGb3JtKCkge1xuICAgIHRoaXMuZm9ybS5kaXNhYmxlZCA9IHRydWU7XG4gICAgY29uc3QgYnRuID0gdGhpcy5mb3JtLnF1ZXJ5U2VsZWN0b3IoJ1t0eXBlPVwic3VibWl0XCJdJyk7XG4gICAgaWYgKGJ0bikgYnRuLmluc2VydEFkamFjZW50SFRNTCgnYWZ0ZXJiZWdpbicsIGh0bWxfc3Bpbm5lcigndGV4dC1zdG9uZS01MCBtbC0xIG1yLTIgYWxpZ24tdGV4dC1ib3R0b20gaW5saW5lLWJsb2NrJykpO1xuXG4gIH1cbiAgZGlzcGxheVJlc3BvbnNlKHJlc3BvbnNlLCBlcnJvciA9IGZhbHNlKSB7XG4gICAgY29uc3QgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBlbC5pbnNlcnRBZGphY2VudEhUTUwoJ2FmdGVyYmVnaW4nLCByZXNwb25zZSk7XG4gICAgaWYgKGVycm9yICE9PSBmYWxzZSkgZWwuY2xhc3NMaXN0LmFkZCgnaXMtZXJyb3InKTtcbiAgICB0aGlzLmZvcm0ucGFyZW50RWxlbWVudC5pbnNlcnRCZWZvcmUoZWwsIHRoaXMuZm9ybSk7XG4gICAgdGhpcy5mb3JtLnJlbW92ZSgpO1xuICB9XG59Il0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/modules/form-submit.js\n")}}]);