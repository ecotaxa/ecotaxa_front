"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["src_modules_form-submit_js"],{"./src/modules/form-submit.js"(module,__webpack_exports__,__webpack_require__){eval("{__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   FormSubmit: () => (/* binding */ FormSubmit)\n/* harmony export */ });\n/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! dompurify */ \"./node_modules/dompurify/dist/purify.es.mjs\");\n/* harmony import */ var _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../modules/modules-config.js */ \"./src/modules/modules-config.js\");\n/* harmony import */ var _modules_utils_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../modules/utils.js */ \"./src/modules/utils.js\");\n/* harmony import */ var _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../modules/alert-box.js */ \"./src/modules/alert-box.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_modules_alert_box_js__WEBPACK_IMPORTED_MODULE_3__]);\nvar __webpack_async_dependencies_result__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n_modules_alert_box_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_async_dependencies_result__[0];\n\n\n\n\n\n\n_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.domselectors.captcha = '.js-captcha';\n_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.domselectors.formbox = \".form-box\";\n_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.domselectors.messagepos = \".messagepos\";\n_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.invalid = 'invalid';\n_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.inputvalid = 'valid';\n_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.required = 'required';\n_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.tshidden = 'ts-hidden-accessible';\n\nclass FormSubmit {\n  handlers = {\n    validate: [],\n    submit: []\n  };\n  form = null;\n  listener = null;\n  constructor(form, options = {}) {\n    if (!form) return;\n    if (!form.formsubmit) {\n      this.form = form instanceof HTMLElement ? form : document.querySelector(form);\n      const defaultOptions = {\n        fetch: null,\n      };\n      options = Object.assign(options, this.form.dataset);\n      this.options = Object.assign(defaultOptions, options);\n      if (!this.form) return;\n      this.tabs = this.form.querySelectorAll(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.domselectors.component.tabs.tab);\n      this.validateFields(true);\n      this.init();\n      form.formsubmit = this;\n       }\n    return form.formsubmit;\n  }\n  init() {\n\n    // init the form ( options like beforeunload etc...)\n    this.form.addEventListener('keydown', (e) => {\n      // prevent enter submit\n      if (e.key === 'Enter' && e.target instanceof HTMLInputElement) e.preventDefault();\n    });\n    window.addEventListener(\"pageshow\", (e) => {\n      const historytraversal = event.persisted ||\n        (typeof window.performance != \"undefined\" &&\n          window.performance.navigation.type === 2);\n      if (historytraversal) {\n        this.enableForm();\n      }\n    });\n    this.form.addEventListener('validate', (e) => {\n      this.validateFields();\n    });\n    this.form.addEventListener('submit', async (e) => {\n      e.preventDefault();\n      const res = await this.submitForm();\n      return res;\n    });\n    this.hotModifs();\n    this.specialFields();\n  }\n\n  hotModifs() {\n    // display a message when one og this fields is modified\n    this.form.querySelectorAll('[data-hotmodif]').forEach(field => {\n      const evt = (field.tagName.toLowerCase() == 'input' && field.type === 'text') ? 'keydown' : 'change';\n      const message = (field.dataset.modifmessage) ? field.dataset.modifmessage : this.options.modifmessage;\n      let parent = field.closest(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.domselectors.formbox);\n      parent = (parent) ? parent : field.closest(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.domselectors.messagepos);\n      field.addEventListener(evt, () => {\n        _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_3__.AlertBox.addMessage({\n          type: _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_3__.AlertBox.alertconfig.types.warning,\n          parent: parent,\n          content: message,\n          duration: 4000\n        })\n      })\n    })\n  }\n\n  specialFields() {\n    // check if there is a password confirm input\n    // add show text for password fields\n\n    this.form.querySelectorAll('input[data-match]').forEach(input => { //\n      const match = input.dataset.match;\n      if (!match) return;\n      const target = document.getElementById(match);\n      if (!target) return;\n      const invalid = (input.dataset.matchinvalid) ? input.dataset.matchinvalid : \"no match\";\n      const check_match = (item, itemtarget) => {\n        const label = item.closest(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.domselectors.component.form.formbox).querySelector('label[for=\"' + item.id + '\"]');\n        const labeltarget = itemtarget.closest(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.domselectors.component.form.formbox).querySelector('label[for=\"' + itemtarget.id + '\"]');\n        const {\n          patternMismatch = false\n        } = item.validity;\n        const customvalidity = (patternMismatch) ? this.getMessage(item, 'invalid') : ``;\n        if (item.checkValidity() === true) {\n          item.setCustomValidity('');\n          if (item == input && label !== null) label.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.invalid);\n          else if (labeltarget !== null) labeltarget.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.invalid);\n          item.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.invalid);\n          if (item.value !== itemtarget.value) {\n            itemtarget.setCustomValidity(invalid);\n            if (labeltarget) {\n              labeltarget.dataset.invalid = invalid;\n              labeltarget.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.invalid);\n            }\n            itemtarget.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.invalid);\n          } else {\n            itemtarget.setCustomValidity(\"\");\n            if (labeltarget) labeltarget.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.invalid);\n            itemtarget.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.invalid);\n          }\n        } else {\n          item.setCustomValidity(customvalidity);\n          label.dataset.invalid = customvalidity;\n          if (label) label.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.invalid);\n          item.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.invalid);\n        }\n        item.focus();\n      };\n      [input, target].forEach(item => {\n        item.addEventListener('keyup', (e) => {\n          const itemtarget = (item === input) ? target : input;\n          const itemsrc = (item === input) ? input : target;\n          check_match(itemsrc, itemtarget);\n        });\n      });\n\n    });\n  }\n  getMessage(field, type = 'invalid') {\n    const {\n      valueMissing = true\n    } = field.validity;\n    if (valueMissing) return `* ` + ((field.dataset.required) ? field.dataset.required : ((this.form.dataset.required) ? this.form.dataset.required : (field.validationMessage) ? (field.validationMessage) : 'required'));\n    else return (field.dataset[type]) ? field.dataset[type] : (field.validationMessage) ? (field.validationMessage) : 'input invalid';\n  }\n  setLabelState(field, valid) {\n    const label = this.getFieldLabel(field);\n    if (label == null) return;\n    if (valid === true) {\n      label.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.invalid);\n    } else {\n      label.dataset.invalid = this.getMessage(field);\n      label.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.invalid);\n      const rect = label.getBoundingClientRect();\n      const x = rect.left;\n      const y = rect.top;\n      window.scrollTo({\n        top: y,\n        left: x,\n        behavior: 'smooth'\n      });\n    }\n  }\n  validateField(field, init = false) {\n   if (field.hasOwnProperty('readonly')) return true;\n    if (['select'].indexOf(field.tagName.toLowerCase()) >= 0) {\n      field.querySelectorAll('option:checked').forEach(option => {\n        option.value = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_2__.decode_HTMLEntities)(dompurify__WEBPACK_IMPORTED_MODULE_0__[\"default\"].sanitize(option.value));\n      });\n    } else field.value = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_2__.decode_HTMLEntities)(dompurify__WEBPACK_IMPORTED_MODULE_0__[\"default\"].sanitize(field.value));\n    let rep = field.checkValidity();\n    if (field.tomselect) field.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.tshidden);\n    if (rep && field.dataset.hasOwnProperty('unique')) {\n      rep = this.validateFieldUnique(field);\n    } else if (field.type == \"checkbox\") {\n      rep = true;\n      if (field.required) {\n        const targets = (field.name) ? field.closest('div').querySelectorAll(field.name) : [field];\n        targets.forEach(target => {\n          rep = rep || field.checkValidity(target);\n        });\n      }\n    }\n    const evt = document.createEvent(\"Event\");\n    evt.initEvent(((rep) ? 'valid' : 'invalid'), true, true);\n    field.dispatchEvent(evt);\n    return rep;\n  }\n\n  getFieldLabel(field) {\n    let label = field.closest('[for=\"' + field.name + '\"]') ? field.closest('[for=\"' + field.name + '\"]') : (field.closest('[data-for=\"' + field.name + '\"]')) ? field.closest('[data-for=\"' + field.name + '\"]') : null;\n    if (label === null) {\n      label = (field.closest(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.domselectors.component.form.formbox)) ? ((field.closest(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.domselectors.component.form.formbox).querySelector('.label')) ? field.closest(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.domselectors.component.form.formbox).querySelector('.label') : field.closest(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.domselectors.component.form.formbox).querySelector('label')) : null;\n    }\n    if (label === null) {\n      label = (field.parentElement && field.parentElement.dataset.elem) ? ((field.closest('fieldset')) ? field.closest('fieldset').querySelector('.' + field.parentElement.dataset.elem) : null) : null;\n    }\n\n    return label;\n  }\n  validateFieldUnique(field) {\n    const label = this.getFieldLabel(field);\n    if (String(field.dataset.unique).toLowerCase() === String(field.value).toLowerCase()) {\n      //field.dataset.invalid = AlertBox.i18nmessages.noduplicate;\n      // just send a warning for the moment\n      if (label) {\n        label.dataset.confirm = _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_3__.AlertBox.i18nmessages.noduplicate;\n        label.classList.add(_modules_alert_box_js__WEBPACK_IMPORTED_MODULE_3__.AlertBox.alertconfig.css.confirm);\n      }\n      const callback_cancel = function() {\n        field.dataset.unique = false;\n        if (label) {\n          label.classList.remove(_modules_alert_box_js__WEBPACK_IMPORTED_MODULE_3__.AlertBox.alertconfig.css.confirm);\n          delete label.dataset.confirm;\n        }\n      }\n      const confirm = _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_3__.AlertBox.addConfirm(((label) ? label.textContent + ` : ` : ``) + _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_3__.AlertBox.i18nmessages.noduplicate, {\n        callback_cancel: callback_cancel,\n        buttons: {\n          ok: {\n            text: _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_3__.AlertBox.i18nmessages.modify\n          },\n          cancel: {\n            text: _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_3__.AlertBox.i18nmessages.saveanyway\n          }\n        }\n      });\n      return confirm;\n    } else if (label.dataset.confirm) {\n      label.classList.remove(_modules_alert_box_js__WEBPACK_IMPORTED_MODULE_3__.AlertBox.alertconfig.css.confirm);\n      delete label.dataset.confirm;\n    }\n    return true;\n  }\n  async validateFields(init = false) {\n    //todo: complete validation foreach field type\n    let resp = true,\n      r = true;\n    [...this.form.elements].forEach(field => {\n      if (init === true) {\n        if (!field.dataset.listen && !field.disabled) {\n          if (field.required) {\n            const label = this.getFieldLabel(field);\n            if (label) label.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.required);\n          }\n          field.addEventListener('change', (e) => {\n            this.validateField(e.target);\n          });\n          field.dataset.listen = true;\n          field.addEventListener('invalid', (e) => {\n            this.setLabelState(field, false);\n          });\n          field.addEventListener('valid', (e) => {\n            this.setLabelState(field, true);\n          });\n        }\n      } else if (!field.disabled && !field.readonly && !field.dataset.readonly && field.name && field.type && (['submit', 'hidden'].indexOf(field.type) < 0 && (['radio', 'checkbox'].indexOf(field.type) < 0 || field.required))) {\n        r = this.validateField(field, false);\n         resp = (resp && r);\n      }\n    });\n    if (init === false) {\n      // add/remove error class on tabs tab-control elements\n      this.tabs.forEach(tab => {\n        if (tab.querySelector(':invalid') || tab.querySelector(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.domselectors.component.alert.danger)) tab.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.error);\n        else tab.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.css.error);\n      });\n      r = await this.execHandler('validate');\n    }\n    return (r && resp);\n  }\n\n  addHandler(type, handler) {\n    this.handlers[type].push(handler);\n  }\n  fieldEnable(enable = true) {\n    this.form.querySelectorAll('input[data-sub=\"enable\"]').forEach(input => {\n      if (enable === true) {\n        input.disabled = false;\n      } else input.disabled = true;\n    });\n  }\n\n  async execHandler(type) {\n    if (this.handlers.length ===0 || this.handlers[type].length === 0) return true;\n    let resp = true;\n    // concurrent\n    await Promise.all(this.handlers[type].map(async handler => {\n      const rep = await handler();\n      resp = (resp && rep);\n    }));\n    return resp;\n  }\n  // no redirection when using data-fetch\n  async formFetch(format = null) {\n    const formdata = new FormData(this.form);\n    formdata[\"fetch\"] = true;\n    let response= await fetch(this.form.action, (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_2__.fetchSettings)({\n        method: 'POST',\n        body: formdata,\n      })).catch(err => {\n        this.displayResponse(err, true);\n        this.enableForm()\n      }).finally(response => {\n        this.disableForm();\n      });\n    if (response.redirected) {\n          window.location = response.url;\n          return null;\n        }\n    switch (format) {\n          case \"text\":\n          case \"html\":\n            response= await response.text();\n            return this.displayResponse(response,false);\n            // removed by dead control flow\n\n          default:\n            response= await response.json();\n            return response;\n            // removed by dead control flow\n\n            // removed by dead control flow\n\n        }\n\n\n  }\n\n  async submitForm() {\n    this.fieldEnable();\n    // important async\n    const valid =  await this.validateFields();\n    if (valid) {\n      const isbot = (this.form.querySelector(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_1__.domselectors.captcha)) ? (this.form.dataset.isbot ? (this.form.dataset.isbot === true) : true) : false;\n      if (isbot === true) return false;\n      const yessubmit = await this.execHandler('submit');\n      if (yessubmit) {\n        if (this.options.fetch) return await this.formFetch(this.options.fetch);\n        else this.form.submit();\n        this.disableForm();\n        return true;\n      }\n    }\n    _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_3__.AlertBox.addAlert({\n          type: _modules_alert_box_js__WEBPACK_IMPORTED_MODULE_3__.AlertBox.alertconfig.types.error,\n          parent: this.form,\n          content: 'Form not submitted, please check required fields and warning messages',\n          dismissible: true\n        });\n    this.enableForm();\n    return false;\n  }\n  enableForm() {\n    this.form.disabled = false;\n    const btn = (this.form.querySelector('[type=\"submit\"] svg'));\n    if (btn) btn.remove();\n  }\n  disableForm() {\n    this.form.disabled = true;\n    const btn = this.form.querySelector('[type=\"submit\"]');\n    if (btn) btn.insertAdjacentHTML('afterbegin', (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_2__.html_spinner)('text-stone-50 ml-1 mr-2 align-text-bottom inline-block'));\n\n  }\n  displayResponse(response, error = false) {\n    const el = document.createElement('div');\n    el.id=\"response_\"+this.form.id;\n       el.insertAdjacentHTML('afterbegin', response);\n         if (error !== false) el.classList.add('is-error');\n        this.form.parentElement.insertBefore(el, this.form);\n        this.form.parentElement.insertBefore(el, this.form);\n        this.form.remove();\n  }\n}\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvbW9kdWxlcy9mb3JtLXN1Ym1pdC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBa0M7QUFDQTtBQUlJO0FBS1Q7QUFHSTs7QUFFakMsb0VBQVk7QUFDWixvRUFBWTtBQUNaLG9FQUFZO0FBQ1osMkRBQUc7QUFDSCwyREFBRztBQUNILDJEQUFHO0FBQ0gsMkRBQUc7O0FBRUk7QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0M7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkNBQTZDLG9FQUFZO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUMsb0VBQVk7QUFDN0MsaURBQWlELG9FQUFZO0FBQzdEO0FBQ0EsUUFBUSwyREFBUTtBQUNoQixnQkFBZ0IsMkRBQVE7QUFDeEI7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULE9BQU87QUFDUCxLQUFLO0FBQ0w7O0FBRUE7QUFDQTtBQUNBOztBQUVBLHVFQUF1RTtBQUN2RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQ0FBbUMsb0VBQVk7QUFDL0MsK0NBQStDLG9FQUFZO0FBQzNEO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0Esc0VBQXNFLDJEQUFHO0FBQ3pFLHNFQUFzRSwyREFBRztBQUN6RSxnQ0FBZ0MsMkRBQUc7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3Q0FBd0MsMkRBQUc7QUFDM0M7QUFDQSxxQ0FBcUMsMkRBQUc7QUFDeEMsWUFBWTtBQUNaO0FBQ0EsMERBQTBELDJEQUFHO0FBQzdELHdDQUF3QywyREFBRztBQUMzQztBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0EseUNBQXlDLDJEQUFHO0FBQzVDLDZCQUE2QiwyREFBRztBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULE9BQU87O0FBRVAsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCLDJEQUFHO0FBQ2hDLE1BQU07QUFDTjtBQUNBLDBCQUEwQiwyREFBRztBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsc0VBQW1CLENBQUMsaURBQVM7QUFDcEQsT0FBTztBQUNQLE1BQU0sbUJBQW1CLHNFQUFtQixDQUFDLGlEQUFTO0FBQ3REO0FBQ0EsNkNBQTZDLDJEQUFHO0FBQ2hEO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkIsb0VBQVksNENBQTRDLG9FQUFZLGtFQUFrRSxvRUFBWSxpRUFBaUUsb0VBQVk7QUFDNVA7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQywyREFBUTtBQUN4Qyw0QkFBNEIsMkRBQVE7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUMsMkRBQVE7QUFDekM7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCLDJEQUFRLHlEQUF5RCwyREFBUTtBQUMvRjtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsMkRBQVE7QUFDMUIsV0FBVztBQUNYO0FBQ0Esa0JBQWtCLDJEQUFRO0FBQzFCO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQSxNQUFNO0FBQ04sNkJBQTZCLDJEQUFRO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkNBQTJDLDJEQUFHO0FBQzlDO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsK0RBQStELG9FQUFZLDRDQUE0QywyREFBRztBQUMxSCxrQ0FBa0MsMkRBQUc7QUFDckMsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSLEtBQUs7QUFDTDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnREFBZ0QsZ0VBQWE7QUFDN0Q7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVk7QUFBTTtBQUNsQjtBQUNBO0FBQ0E7QUFDQSxZQUFZO0FBQW1CO0FBQy9CLFlBQVk7QUFBTTtBQUNsQjs7O0FBR0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZDQUE2QyxvRUFBWTtBQUN6RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJLDJEQUFRO0FBQ1osZ0JBQWdCLDJEQUFRO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0RBQWtELCtEQUFZOztBQUU5RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvbW9kdWxlcy9mb3JtLXN1Ym1pdC5qcz9jNmI3Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB2YWxpZGF0b3IgZnJvbSAndmFsaWRhdG9yJztcbmltcG9ydCBET01QdXJpZnkgZnJvbSAnZG9tcHVyaWZ5JztcbmltcG9ydCB7XG4gIGRvbXNlbGVjdG9ycyxcbiAgY3NzXG59IGZyb20gJy4uL21vZHVsZXMvbW9kdWxlcy1jb25maWcuanMnO1xuaW1wb3J0IHtcbiAgZmV0Y2hTZXR0aW5ncyxcbiAgZGVjb2RlX0hUTUxFbnRpdGllcyxcbiAgaHRtbF9zcGlubmVyLFxufSBmcm9tICcuLi9tb2R1bGVzL3V0aWxzLmpzJztcbmltcG9ydCB7XG4gIEFsZXJ0Qm94XG59IGZyb20gJy4uL21vZHVsZXMvYWxlcnQtYm94LmpzJztcblxuZG9tc2VsZWN0b3JzLmNhcHRjaGEgPSAnLmpzLWNhcHRjaGEnO1xuZG9tc2VsZWN0b3JzLmZvcm1ib3ggPSBcIi5mb3JtLWJveFwiO1xuZG9tc2VsZWN0b3JzLm1lc3NhZ2Vwb3MgPSBcIi5tZXNzYWdlcG9zXCI7XG5jc3MuaW52YWxpZCA9ICdpbnZhbGlkJztcbmNzcy5pbnB1dHZhbGlkID0gJ3ZhbGlkJztcbmNzcy5yZXF1aXJlZCA9ICdyZXF1aXJlZCc7XG5jc3MudHNoaWRkZW4gPSAndHMtaGlkZGVuLWFjY2Vzc2libGUnO1xuXG5leHBvcnQgY2xhc3MgRm9ybVN1Ym1pdCB7XG4gIGhhbmRsZXJzID0ge1xuICAgIHZhbGlkYXRlOiBbXSxcbiAgICBzdWJtaXQ6IFtdXG4gIH07XG4gIGZvcm0gPSBudWxsO1xuICBsaXN0ZW5lciA9IG51bGw7XG4gIGNvbnN0cnVjdG9yKGZvcm0sIG9wdGlvbnMgPSB7fSkge1xuICAgIGlmICghZm9ybSkgcmV0dXJuO1xuICAgIGlmICghZm9ybS5mb3Jtc3VibWl0KSB7XG4gICAgICB0aGlzLmZvcm0gPSBmb3JtIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQgPyBmb3JtIDogZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihmb3JtKTtcbiAgICAgIGNvbnN0IGRlZmF1bHRPcHRpb25zID0ge1xuICAgICAgICBmZXRjaDogbnVsbCxcbiAgICAgIH07XG4gICAgICBvcHRpb25zID0gT2JqZWN0LmFzc2lnbihvcHRpb25zLCB0aGlzLmZvcm0uZGF0YXNldCk7XG4gICAgICB0aGlzLm9wdGlvbnMgPSBPYmplY3QuYXNzaWduKGRlZmF1bHRPcHRpb25zLCBvcHRpb25zKTtcbiAgICAgIGlmICghdGhpcy5mb3JtKSByZXR1cm47XG4gICAgICB0aGlzLnRhYnMgPSB0aGlzLmZvcm0ucXVlcnlTZWxlY3RvckFsbChkb21zZWxlY3RvcnMuY29tcG9uZW50LnRhYnMudGFiKTtcbiAgICAgIHRoaXMudmFsaWRhdGVGaWVsZHModHJ1ZSk7XG4gICAgICB0aGlzLmluaXQoKTtcbiAgICAgIGZvcm0uZm9ybXN1Ym1pdCA9IHRoaXM7XG4gICAgICAgfVxuICAgIHJldHVybiBmb3JtLmZvcm1zdWJtaXQ7XG4gIH1cbiAgaW5pdCgpIHtcblxuICAgIC8vIGluaXQgdGhlIGZvcm0gKCBvcHRpb25zIGxpa2UgYmVmb3JldW5sb2FkIGV0Yy4uLilcbiAgICB0aGlzLmZvcm0uYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIChlKSA9PiB7XG4gICAgICAvLyBwcmV2ZW50IGVudGVyIHN1Ym1pdFxuICAgICAgaWYgKGUua2V5ID09PSAnRW50ZXInICYmIGUudGFyZ2V0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH0pO1xuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwicGFnZXNob3dcIiwgKGUpID0+IHtcbiAgICAgIGNvbnN0IGhpc3Rvcnl0cmF2ZXJzYWwgPSBldmVudC5wZXJzaXN0ZWQgfHxcbiAgICAgICAgKHR5cGVvZiB3aW5kb3cucGVyZm9ybWFuY2UgIT0gXCJ1bmRlZmluZWRcIiAmJlxuICAgICAgICAgIHdpbmRvdy5wZXJmb3JtYW5jZS5uYXZpZ2F0aW9uLnR5cGUgPT09IDIpO1xuICAgICAgaWYgKGhpc3Rvcnl0cmF2ZXJzYWwpIHtcbiAgICAgICAgdGhpcy5lbmFibGVGb3JtKCk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgdGhpcy5mb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3ZhbGlkYXRlJywgKGUpID0+IHtcbiAgICAgIHRoaXMudmFsaWRhdGVGaWVsZHMoKTtcbiAgICB9KTtcbiAgICB0aGlzLmZvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgYXN5bmMgKGUpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuc3VibWl0Rm9ybSgpO1xuICAgICAgcmV0dXJuIHJlcztcbiAgICB9KTtcbiAgICB0aGlzLmhvdE1vZGlmcygpO1xuICAgIHRoaXMuc3BlY2lhbEZpZWxkcygpO1xuICB9XG5cbiAgaG90TW9kaWZzKCkge1xuICAgIC8vIGRpc3BsYXkgYSBtZXNzYWdlIHdoZW4gb25lIG9nIHRoaXMgZmllbGRzIGlzIG1vZGlmaWVkXG4gICAgdGhpcy5mb3JtLnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLWhvdG1vZGlmXScpLmZvckVhY2goZmllbGQgPT4ge1xuICAgICAgY29uc3QgZXZ0ID0gKGZpZWxkLnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PSAnaW5wdXQnICYmIGZpZWxkLnR5cGUgPT09ICd0ZXh0JykgPyAna2V5ZG93bicgOiAnY2hhbmdlJztcbiAgICAgIGNvbnN0IG1lc3NhZ2UgPSAoZmllbGQuZGF0YXNldC5tb2RpZm1lc3NhZ2UpID8gZmllbGQuZGF0YXNldC5tb2RpZm1lc3NhZ2UgOiB0aGlzLm9wdGlvbnMubW9kaWZtZXNzYWdlO1xuICAgICAgbGV0IHBhcmVudCA9IGZpZWxkLmNsb3Nlc3QoZG9tc2VsZWN0b3JzLmZvcm1ib3gpO1xuICAgICAgcGFyZW50ID0gKHBhcmVudCkgPyBwYXJlbnQgOiBmaWVsZC5jbG9zZXN0KGRvbXNlbGVjdG9ycy5tZXNzYWdlcG9zKTtcbiAgICAgIGZpZWxkLmFkZEV2ZW50TGlzdGVuZXIoZXZ0LCAoKSA9PiB7XG4gICAgICAgIEFsZXJ0Qm94LmFkZE1lc3NhZ2Uoe1xuICAgICAgICAgIHR5cGU6IEFsZXJ0Qm94LmFsZXJ0Y29uZmlnLnR5cGVzLndhcm5pbmcsXG4gICAgICAgICAgcGFyZW50OiBwYXJlbnQsXG4gICAgICAgICAgY29udGVudDogbWVzc2FnZSxcbiAgICAgICAgICBkdXJhdGlvbjogNDAwMFxuICAgICAgICB9KVxuICAgICAgfSlcbiAgICB9KVxuICB9XG5cbiAgc3BlY2lhbEZpZWxkcygpIHtcbiAgICAvLyBjaGVjayBpZiB0aGVyZSBpcyBhIHBhc3N3b3JkIGNvbmZpcm0gaW5wdXRcbiAgICAvLyBhZGQgc2hvdyB0ZXh0IGZvciBwYXNzd29yZCBmaWVsZHNcblxuICAgIHRoaXMuZm9ybS5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dFtkYXRhLW1hdGNoXScpLmZvckVhY2goaW5wdXQgPT4geyAvL1xuICAgICAgY29uc3QgbWF0Y2ggPSBpbnB1dC5kYXRhc2V0Lm1hdGNoO1xuICAgICAgaWYgKCFtYXRjaCkgcmV0dXJuO1xuICAgICAgY29uc3QgdGFyZ2V0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobWF0Y2gpO1xuICAgICAgaWYgKCF0YXJnZXQpIHJldHVybjtcbiAgICAgIGNvbnN0IGludmFsaWQgPSAoaW5wdXQuZGF0YXNldC5tYXRjaGludmFsaWQpID8gaW5wdXQuZGF0YXNldC5tYXRjaGludmFsaWQgOiBcIm5vIG1hdGNoXCI7XG4gICAgICBjb25zdCBjaGVja19tYXRjaCA9IChpdGVtLCBpdGVtdGFyZ2V0KSA9PiB7XG4gICAgICAgIGNvbnN0IGxhYmVsID0gaXRlbS5jbG9zZXN0KGRvbXNlbGVjdG9ycy5jb21wb25lbnQuZm9ybS5mb3JtYm94KS5xdWVyeVNlbGVjdG9yKCdsYWJlbFtmb3I9XCInICsgaXRlbS5pZCArICdcIl0nKTtcbiAgICAgICAgY29uc3QgbGFiZWx0YXJnZXQgPSBpdGVtdGFyZ2V0LmNsb3Nlc3QoZG9tc2VsZWN0b3JzLmNvbXBvbmVudC5mb3JtLmZvcm1ib3gpLnF1ZXJ5U2VsZWN0b3IoJ2xhYmVsW2Zvcj1cIicgKyBpdGVtdGFyZ2V0LmlkICsgJ1wiXScpO1xuICAgICAgICBjb25zdCB7XG4gICAgICAgICAgcGF0dGVybk1pc21hdGNoID0gZmFsc2VcbiAgICAgICAgfSA9IGl0ZW0udmFsaWRpdHk7XG4gICAgICAgIGNvbnN0IGN1c3RvbXZhbGlkaXR5ID0gKHBhdHRlcm5NaXNtYXRjaCkgPyB0aGlzLmdldE1lc3NhZ2UoaXRlbSwgJ2ludmFsaWQnKSA6IGBgO1xuICAgICAgICBpZiAoaXRlbS5jaGVja1ZhbGlkaXR5KCkgPT09IHRydWUpIHtcbiAgICAgICAgICBpdGVtLnNldEN1c3RvbVZhbGlkaXR5KCcnKTtcbiAgICAgICAgICBpZiAoaXRlbSA9PSBpbnB1dCAmJiBsYWJlbCAhPT0gbnVsbCkgbGFiZWwuY2xhc3NMaXN0LnJlbW92ZShjc3MuaW52YWxpZCk7XG4gICAgICAgICAgZWxzZSBpZiAobGFiZWx0YXJnZXQgIT09IG51bGwpIGxhYmVsdGFyZ2V0LmNsYXNzTGlzdC5yZW1vdmUoY3NzLmludmFsaWQpO1xuICAgICAgICAgIGl0ZW0uY2xhc3NMaXN0LnJlbW92ZShjc3MuaW52YWxpZCk7XG4gICAgICAgICAgaWYgKGl0ZW0udmFsdWUgIT09IGl0ZW10YXJnZXQudmFsdWUpIHtcbiAgICAgICAgICAgIGl0ZW10YXJnZXQuc2V0Q3VzdG9tVmFsaWRpdHkoaW52YWxpZCk7XG4gICAgICAgICAgICBpZiAobGFiZWx0YXJnZXQpIHtcbiAgICAgICAgICAgICAgbGFiZWx0YXJnZXQuZGF0YXNldC5pbnZhbGlkID0gaW52YWxpZDtcbiAgICAgICAgICAgICAgbGFiZWx0YXJnZXQuY2xhc3NMaXN0LmFkZChjc3MuaW52YWxpZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpdGVtdGFyZ2V0LmNsYXNzTGlzdC5hZGQoY3NzLmludmFsaWQpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpdGVtdGFyZ2V0LnNldEN1c3RvbVZhbGlkaXR5KFwiXCIpO1xuICAgICAgICAgICAgaWYgKGxhYmVsdGFyZ2V0KSBsYWJlbHRhcmdldC5jbGFzc0xpc3QucmVtb3ZlKGNzcy5pbnZhbGlkKTtcbiAgICAgICAgICAgIGl0ZW10YXJnZXQuY2xhc3NMaXN0LnJlbW92ZShjc3MuaW52YWxpZCk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGl0ZW0uc2V0Q3VzdG9tVmFsaWRpdHkoY3VzdG9tdmFsaWRpdHkpO1xuICAgICAgICAgIGxhYmVsLmRhdGFzZXQuaW52YWxpZCA9IGN1c3RvbXZhbGlkaXR5O1xuICAgICAgICAgIGlmIChsYWJlbCkgbGFiZWwuY2xhc3NMaXN0LmFkZChjc3MuaW52YWxpZCk7XG4gICAgICAgICAgaXRlbS5jbGFzc0xpc3QuYWRkKGNzcy5pbnZhbGlkKTtcbiAgICAgICAgfVxuICAgICAgICBpdGVtLmZvY3VzKCk7XG4gICAgICB9O1xuICAgICAgW2lucHV0LCB0YXJnZXRdLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCAoZSkgPT4ge1xuICAgICAgICAgIGNvbnN0IGl0ZW10YXJnZXQgPSAoaXRlbSA9PT0gaW5wdXQpID8gdGFyZ2V0IDogaW5wdXQ7XG4gICAgICAgICAgY29uc3QgaXRlbXNyYyA9IChpdGVtID09PSBpbnB1dCkgPyBpbnB1dCA6IHRhcmdldDtcbiAgICAgICAgICBjaGVja19tYXRjaChpdGVtc3JjLCBpdGVtdGFyZ2V0KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgIH0pO1xuICB9XG4gIGdldE1lc3NhZ2UoZmllbGQsIHR5cGUgPSAnaW52YWxpZCcpIHtcbiAgICBjb25zdCB7XG4gICAgICB2YWx1ZU1pc3NpbmcgPSB0cnVlXG4gICAgfSA9IGZpZWxkLnZhbGlkaXR5O1xuICAgIGlmICh2YWx1ZU1pc3NpbmcpIHJldHVybiBgKiBgICsgKChmaWVsZC5kYXRhc2V0LnJlcXVpcmVkKSA/IGZpZWxkLmRhdGFzZXQucmVxdWlyZWQgOiAoKHRoaXMuZm9ybS5kYXRhc2V0LnJlcXVpcmVkKSA/IHRoaXMuZm9ybS5kYXRhc2V0LnJlcXVpcmVkIDogKGZpZWxkLnZhbGlkYXRpb25NZXNzYWdlKSA/IChmaWVsZC52YWxpZGF0aW9uTWVzc2FnZSkgOiAncmVxdWlyZWQnKSk7XG4gICAgZWxzZSByZXR1cm4gKGZpZWxkLmRhdGFzZXRbdHlwZV0pID8gZmllbGQuZGF0YXNldFt0eXBlXSA6IChmaWVsZC52YWxpZGF0aW9uTWVzc2FnZSkgPyAoZmllbGQudmFsaWRhdGlvbk1lc3NhZ2UpIDogJ2lucHV0IGludmFsaWQnO1xuICB9XG4gIHNldExhYmVsU3RhdGUoZmllbGQsIHZhbGlkKSB7XG4gICAgY29uc3QgbGFiZWwgPSB0aGlzLmdldEZpZWxkTGFiZWwoZmllbGQpO1xuICAgIGlmIChsYWJlbCA9PSBudWxsKSByZXR1cm47XG4gICAgaWYgKHZhbGlkID09PSB0cnVlKSB7XG4gICAgICBsYWJlbC5jbGFzc0xpc3QucmVtb3ZlKGNzcy5pbnZhbGlkKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbGFiZWwuZGF0YXNldC5pbnZhbGlkID0gdGhpcy5nZXRNZXNzYWdlKGZpZWxkKTtcbiAgICAgIGxhYmVsLmNsYXNzTGlzdC5hZGQoY3NzLmludmFsaWQpO1xuICAgICAgY29uc3QgcmVjdCA9IGxhYmVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgY29uc3QgeCA9IHJlY3QubGVmdDtcbiAgICAgIGNvbnN0IHkgPSByZWN0LnRvcDtcbiAgICAgIHdpbmRvdy5zY3JvbGxUbyh7XG4gICAgICAgIHRvcDogeSxcbiAgICAgICAgbGVmdDogeCxcbiAgICAgICAgYmVoYXZpb3I6ICdzbW9vdGgnXG4gICAgICB9KTtcbiAgICB9XG4gIH1cbiAgdmFsaWRhdGVGaWVsZChmaWVsZCwgaW5pdCA9IGZhbHNlKSB7XG4gICBpZiAoZmllbGQuaGFzT3duUHJvcGVydHkoJ3JlYWRvbmx5JykpIHJldHVybiB0cnVlO1xuICAgIGlmIChbJ3NlbGVjdCddLmluZGV4T2YoZmllbGQudGFnTmFtZS50b0xvd2VyQ2FzZSgpKSA+PSAwKSB7XG4gICAgICBmaWVsZC5xdWVyeVNlbGVjdG9yQWxsKCdvcHRpb246Y2hlY2tlZCcpLmZvckVhY2gob3B0aW9uID0+IHtcbiAgICAgICAgb3B0aW9uLnZhbHVlID0gZGVjb2RlX0hUTUxFbnRpdGllcyhET01QdXJpZnkuc2FuaXRpemUob3B0aW9uLnZhbHVlKSk7XG4gICAgICB9KTtcbiAgICB9IGVsc2UgZmllbGQudmFsdWUgPSBkZWNvZGVfSFRNTEVudGl0aWVzKERPTVB1cmlmeS5zYW5pdGl6ZShmaWVsZC52YWx1ZSkpO1xuICAgIGxldCByZXAgPSBmaWVsZC5jaGVja1ZhbGlkaXR5KCk7XG4gICAgaWYgKGZpZWxkLnRvbXNlbGVjdCkgZmllbGQuY2xhc3NMaXN0LmFkZChjc3MudHNoaWRkZW4pO1xuICAgIGlmIChyZXAgJiYgZmllbGQuZGF0YXNldC5oYXNPd25Qcm9wZXJ0eSgndW5pcXVlJykpIHtcbiAgICAgIHJlcCA9IHRoaXMudmFsaWRhdGVGaWVsZFVuaXF1ZShmaWVsZCk7XG4gICAgfSBlbHNlIGlmIChmaWVsZC50eXBlID09IFwiY2hlY2tib3hcIikge1xuICAgICAgcmVwID0gdHJ1ZTtcbiAgICAgIGlmIChmaWVsZC5yZXF1aXJlZCkge1xuICAgICAgICBjb25zdCB0YXJnZXRzID0gKGZpZWxkLm5hbWUpID8gZmllbGQuY2xvc2VzdCgnZGl2JykucXVlcnlTZWxlY3RvckFsbChmaWVsZC5uYW1lKSA6IFtmaWVsZF07XG4gICAgICAgIHRhcmdldHMuZm9yRWFjaCh0YXJnZXQgPT4ge1xuICAgICAgICAgIHJlcCA9IHJlcCB8fCBmaWVsZC5jaGVja1ZhbGlkaXR5KHRhcmdldCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBldnQgPSBkb2N1bWVudC5jcmVhdGVFdmVudChcIkV2ZW50XCIpO1xuICAgIGV2dC5pbml0RXZlbnQoKChyZXApID8gJ3ZhbGlkJyA6ICdpbnZhbGlkJyksIHRydWUsIHRydWUpO1xuICAgIGZpZWxkLmRpc3BhdGNoRXZlbnQoZXZ0KTtcbiAgICByZXR1cm4gcmVwO1xuICB9XG5cbiAgZ2V0RmllbGRMYWJlbChmaWVsZCkge1xuICAgIGxldCBsYWJlbCA9IGZpZWxkLmNsb3Nlc3QoJ1tmb3I9XCInICsgZmllbGQubmFtZSArICdcIl0nKSA/IGZpZWxkLmNsb3Nlc3QoJ1tmb3I9XCInICsgZmllbGQubmFtZSArICdcIl0nKSA6IChmaWVsZC5jbG9zZXN0KCdbZGF0YS1mb3I9XCInICsgZmllbGQubmFtZSArICdcIl0nKSkgPyBmaWVsZC5jbG9zZXN0KCdbZGF0YS1mb3I9XCInICsgZmllbGQubmFtZSArICdcIl0nKSA6IG51bGw7XG4gICAgaWYgKGxhYmVsID09PSBudWxsKSB7XG4gICAgICBsYWJlbCA9IChmaWVsZC5jbG9zZXN0KGRvbXNlbGVjdG9ycy5jb21wb25lbnQuZm9ybS5mb3JtYm94KSkgPyAoKGZpZWxkLmNsb3Nlc3QoZG9tc2VsZWN0b3JzLmNvbXBvbmVudC5mb3JtLmZvcm1ib3gpLnF1ZXJ5U2VsZWN0b3IoJy5sYWJlbCcpKSA/IGZpZWxkLmNsb3Nlc3QoZG9tc2VsZWN0b3JzLmNvbXBvbmVudC5mb3JtLmZvcm1ib3gpLnF1ZXJ5U2VsZWN0b3IoJy5sYWJlbCcpIDogZmllbGQuY2xvc2VzdChkb21zZWxlY3RvcnMuY29tcG9uZW50LmZvcm0uZm9ybWJveCkucXVlcnlTZWxlY3RvcignbGFiZWwnKSkgOiBudWxsO1xuICAgIH1cbiAgICBpZiAobGFiZWwgPT09IG51bGwpIHtcbiAgICAgIGxhYmVsID0gKGZpZWxkLnBhcmVudEVsZW1lbnQgJiYgZmllbGQucGFyZW50RWxlbWVudC5kYXRhc2V0LmVsZW0pID8gKChmaWVsZC5jbG9zZXN0KCdmaWVsZHNldCcpKSA/IGZpZWxkLmNsb3Nlc3QoJ2ZpZWxkc2V0JykucXVlcnlTZWxlY3RvcignLicgKyBmaWVsZC5wYXJlbnRFbGVtZW50LmRhdGFzZXQuZWxlbSkgOiBudWxsKSA6IG51bGw7XG4gICAgfVxuXG4gICAgcmV0dXJuIGxhYmVsO1xuICB9XG4gIHZhbGlkYXRlRmllbGRVbmlxdWUoZmllbGQpIHtcbiAgICBjb25zdCBsYWJlbCA9IHRoaXMuZ2V0RmllbGRMYWJlbChmaWVsZCk7XG4gICAgaWYgKFN0cmluZyhmaWVsZC5kYXRhc2V0LnVuaXF1ZSkudG9Mb3dlckNhc2UoKSA9PT0gU3RyaW5nKGZpZWxkLnZhbHVlKS50b0xvd2VyQ2FzZSgpKSB7XG4gICAgICAvL2ZpZWxkLmRhdGFzZXQuaW52YWxpZCA9IEFsZXJ0Qm94LmkxOG5tZXNzYWdlcy5ub2R1cGxpY2F0ZTtcbiAgICAgIC8vIGp1c3Qgc2VuZCBhIHdhcm5pbmcgZm9yIHRoZSBtb21lbnRcbiAgICAgIGlmIChsYWJlbCkge1xuICAgICAgICBsYWJlbC5kYXRhc2V0LmNvbmZpcm0gPSBBbGVydEJveC5pMThubWVzc2FnZXMubm9kdXBsaWNhdGU7XG4gICAgICAgIGxhYmVsLmNsYXNzTGlzdC5hZGQoQWxlcnRCb3guYWxlcnRjb25maWcuY3NzLmNvbmZpcm0pO1xuICAgICAgfVxuICAgICAgY29uc3QgY2FsbGJhY2tfY2FuY2VsID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGZpZWxkLmRhdGFzZXQudW5pcXVlID0gZmFsc2U7XG4gICAgICAgIGlmIChsYWJlbCkge1xuICAgICAgICAgIGxhYmVsLmNsYXNzTGlzdC5yZW1vdmUoQWxlcnRCb3guYWxlcnRjb25maWcuY3NzLmNvbmZpcm0pO1xuICAgICAgICAgIGRlbGV0ZSBsYWJlbC5kYXRhc2V0LmNvbmZpcm07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNvbnN0IGNvbmZpcm0gPSBBbGVydEJveC5hZGRDb25maXJtKCgobGFiZWwpID8gbGFiZWwudGV4dENvbnRlbnQgKyBgIDogYCA6IGBgKSArIEFsZXJ0Qm94LmkxOG5tZXNzYWdlcy5ub2R1cGxpY2F0ZSwge1xuICAgICAgICBjYWxsYmFja19jYW5jZWw6IGNhbGxiYWNrX2NhbmNlbCxcbiAgICAgICAgYnV0dG9uczoge1xuICAgICAgICAgIG9rOiB7XG4gICAgICAgICAgICB0ZXh0OiBBbGVydEJveC5pMThubWVzc2FnZXMubW9kaWZ5XG4gICAgICAgICAgfSxcbiAgICAgICAgICBjYW5jZWw6IHtcbiAgICAgICAgICAgIHRleHQ6IEFsZXJ0Qm94LmkxOG5tZXNzYWdlcy5zYXZlYW55d2F5XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBjb25maXJtO1xuICAgIH0gZWxzZSBpZiAobGFiZWwuZGF0YXNldC5jb25maXJtKSB7XG4gICAgICBsYWJlbC5jbGFzc0xpc3QucmVtb3ZlKEFsZXJ0Qm94LmFsZXJ0Y29uZmlnLmNzcy5jb25maXJtKTtcbiAgICAgIGRlbGV0ZSBsYWJlbC5kYXRhc2V0LmNvbmZpcm07XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIGFzeW5jIHZhbGlkYXRlRmllbGRzKGluaXQgPSBmYWxzZSkge1xuICAgIC8vdG9kbzogY29tcGxldGUgdmFsaWRhdGlvbiBmb3JlYWNoIGZpZWxkIHR5cGVcbiAgICBsZXQgcmVzcCA9IHRydWUsXG4gICAgICByID0gdHJ1ZTtcbiAgICBbLi4udGhpcy5mb3JtLmVsZW1lbnRzXS5mb3JFYWNoKGZpZWxkID0+IHtcbiAgICAgIGlmIChpbml0ID09PSB0cnVlKSB7XG4gICAgICAgIGlmICghZmllbGQuZGF0YXNldC5saXN0ZW4gJiYgIWZpZWxkLmRpc2FibGVkKSB7XG4gICAgICAgICAgaWYgKGZpZWxkLnJlcXVpcmVkKSB7XG4gICAgICAgICAgICBjb25zdCBsYWJlbCA9IHRoaXMuZ2V0RmllbGRMYWJlbChmaWVsZCk7XG4gICAgICAgICAgICBpZiAobGFiZWwpIGxhYmVsLmNsYXNzTGlzdC5hZGQoY3NzLnJlcXVpcmVkKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZmllbGQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKGUpID0+IHtcbiAgICAgICAgICAgIHRoaXMudmFsaWRhdGVGaWVsZChlLnRhcmdldCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgZmllbGQuZGF0YXNldC5saXN0ZW4gPSB0cnVlO1xuICAgICAgICAgIGZpZWxkLmFkZEV2ZW50TGlzdGVuZXIoJ2ludmFsaWQnLCAoZSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZXRMYWJlbFN0YXRlKGZpZWxkLCBmYWxzZSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgZmllbGQuYWRkRXZlbnRMaXN0ZW5lcigndmFsaWQnLCAoZSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZXRMYWJlbFN0YXRlKGZpZWxkLCB0cnVlKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICghZmllbGQuZGlzYWJsZWQgJiYgIWZpZWxkLnJlYWRvbmx5ICYmICFmaWVsZC5kYXRhc2V0LnJlYWRvbmx5ICYmIGZpZWxkLm5hbWUgJiYgZmllbGQudHlwZSAmJiAoWydzdWJtaXQnLCAnaGlkZGVuJ10uaW5kZXhPZihmaWVsZC50eXBlKSA8IDAgJiYgKFsncmFkaW8nLCAnY2hlY2tib3gnXS5pbmRleE9mKGZpZWxkLnR5cGUpIDwgMCB8fCBmaWVsZC5yZXF1aXJlZCkpKSB7XG4gICAgICAgIHIgPSB0aGlzLnZhbGlkYXRlRmllbGQoZmllbGQsIGZhbHNlKTtcbiAgICAgICAgIHJlc3AgPSAocmVzcCAmJiByKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBpZiAoaW5pdCA9PT0gZmFsc2UpIHtcbiAgICAgIC8vIGFkZC9yZW1vdmUgZXJyb3IgY2xhc3Mgb24gdGFicyB0YWItY29udHJvbCBlbGVtZW50c1xuICAgICAgdGhpcy50YWJzLmZvckVhY2godGFiID0+IHtcbiAgICAgICAgaWYgKHRhYi5xdWVyeVNlbGVjdG9yKCc6aW52YWxpZCcpIHx8IHRhYi5xdWVyeVNlbGVjdG9yKGRvbXNlbGVjdG9ycy5jb21wb25lbnQuYWxlcnQuZGFuZ2VyKSkgdGFiLmNsYXNzTGlzdC5hZGQoY3NzLmVycm9yKTtcbiAgICAgICAgZWxzZSB0YWIuY2xhc3NMaXN0LnJlbW92ZShjc3MuZXJyb3IpO1xuICAgICAgfSk7XG4gICAgICByID0gYXdhaXQgdGhpcy5leGVjSGFuZGxlcigndmFsaWRhdGUnKTtcbiAgICB9XG4gICAgcmV0dXJuIChyICYmIHJlc3ApO1xuICB9XG5cbiAgYWRkSGFuZGxlcih0eXBlLCBoYW5kbGVyKSB7XG4gICAgdGhpcy5oYW5kbGVyc1t0eXBlXS5wdXNoKGhhbmRsZXIpO1xuICB9XG4gIGZpZWxkRW5hYmxlKGVuYWJsZSA9IHRydWUpIHtcbiAgICB0aGlzLmZvcm0ucXVlcnlTZWxlY3RvckFsbCgnaW5wdXRbZGF0YS1zdWI9XCJlbmFibGVcIl0nKS5mb3JFYWNoKGlucHV0ID0+IHtcbiAgICAgIGlmIChlbmFibGUgPT09IHRydWUpIHtcbiAgICAgICAgaW5wdXQuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgIH0gZWxzZSBpbnB1dC5kaXNhYmxlZCA9IHRydWU7XG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBleGVjSGFuZGxlcih0eXBlKSB7XG4gICAgaWYgKHRoaXMuaGFuZGxlcnMubGVuZ3RoID09PTAgfHwgdGhpcy5oYW5kbGVyc1t0eXBlXS5sZW5ndGggPT09IDApIHJldHVybiB0cnVlO1xuICAgIGxldCByZXNwID0gdHJ1ZTtcbiAgICAvLyBjb25jdXJyZW50XG4gICAgYXdhaXQgUHJvbWlzZS5hbGwodGhpcy5oYW5kbGVyc1t0eXBlXS5tYXAoYXN5bmMgaGFuZGxlciA9PiB7XG4gICAgICBjb25zdCByZXAgPSBhd2FpdCBoYW5kbGVyKCk7XG4gICAgICByZXNwID0gKHJlc3AgJiYgcmVwKTtcbiAgICB9KSk7XG4gICAgcmV0dXJuIHJlc3A7XG4gIH1cbiAgLy8gbm8gcmVkaXJlY3Rpb24gd2hlbiB1c2luZyBkYXRhLWZldGNoXG4gIGFzeW5jIGZvcm1GZXRjaChmb3JtYXQgPSBudWxsKSB7XG4gICAgY29uc3QgZm9ybWRhdGEgPSBuZXcgRm9ybURhdGEodGhpcy5mb3JtKTtcbiAgICBmb3JtZGF0YVtcImZldGNoXCJdID0gdHJ1ZTtcbiAgICBsZXQgcmVzcG9uc2U9IGF3YWl0IGZldGNoKHRoaXMuZm9ybS5hY3Rpb24sIGZldGNoU2V0dGluZ3Moe1xuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgYm9keTogZm9ybWRhdGEsXG4gICAgICB9KSkuY2F0Y2goZXJyID0+IHtcbiAgICAgICAgdGhpcy5kaXNwbGF5UmVzcG9uc2UoZXJyLCB0cnVlKTtcbiAgICAgICAgdGhpcy5lbmFibGVGb3JtKClcbiAgICAgIH0pLmZpbmFsbHkocmVzcG9uc2UgPT4ge1xuICAgICAgICB0aGlzLmRpc2FibGVGb3JtKCk7XG4gICAgICB9KTtcbiAgICBpZiAocmVzcG9uc2UucmVkaXJlY3RlZCkge1xuICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9IHJlc3BvbnNlLnVybDtcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIHN3aXRjaCAoZm9ybWF0KSB7XG4gICAgICAgICAgY2FzZSBcInRleHRcIjpcbiAgICAgICAgICBjYXNlIFwiaHRtbFwiOlxuICAgICAgICAgICAgcmVzcG9uc2U9IGF3YWl0IHJlc3BvbnNlLnRleHQoKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmRpc3BsYXlSZXNwb25zZShyZXNwb25zZSxmYWxzZSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgcmVzcG9uc2U9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgICAgIHRoaXMuZm9ybS5yZW1vdmUoKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cblxuICB9XG5cbiAgYXN5bmMgc3VibWl0Rm9ybSgpIHtcbiAgICB0aGlzLmZpZWxkRW5hYmxlKCk7XG4gICAgLy8gaW1wb3J0YW50IGFzeW5jXG4gICAgY29uc3QgdmFsaWQgPSAgYXdhaXQgdGhpcy52YWxpZGF0ZUZpZWxkcygpO1xuICAgIGlmICh2YWxpZCkge1xuICAgICAgY29uc3QgaXNib3QgPSAodGhpcy5mb3JtLnF1ZXJ5U2VsZWN0b3IoZG9tc2VsZWN0b3JzLmNhcHRjaGEpKSA/ICh0aGlzLmZvcm0uZGF0YXNldC5pc2JvdCA/ICh0aGlzLmZvcm0uZGF0YXNldC5pc2JvdCA9PT0gdHJ1ZSkgOiB0cnVlKSA6IGZhbHNlO1xuICAgICAgaWYgKGlzYm90ID09PSB0cnVlKSByZXR1cm4gZmFsc2U7XG4gICAgICBjb25zdCB5ZXNzdWJtaXQgPSBhd2FpdCB0aGlzLmV4ZWNIYW5kbGVyKCdzdWJtaXQnKTtcbiAgICAgIGlmICh5ZXNzdWJtaXQpIHtcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5mZXRjaCkgcmV0dXJuIGF3YWl0IHRoaXMuZm9ybUZldGNoKHRoaXMub3B0aW9ucy5mZXRjaCk7XG4gICAgICAgIGVsc2UgdGhpcy5mb3JtLnN1Ym1pdCgpO1xuICAgICAgICB0aGlzLmRpc2FibGVGb3JtKCk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgICBBbGVydEJveC5hZGRBbGVydCh7XG4gICAgICAgICAgdHlwZTogQWxlcnRCb3guYWxlcnRjb25maWcudHlwZXMuZXJyb3IsXG4gICAgICAgICAgcGFyZW50OiB0aGlzLmZvcm0sXG4gICAgICAgICAgY29udGVudDogJ0Zvcm0gbm90IHN1Ym1pdHRlZCwgcGxlYXNlIGNoZWNrIHJlcXVpcmVkIGZpZWxkcyBhbmQgd2FybmluZyBtZXNzYWdlcycsXG4gICAgICAgICAgZGlzbWlzc2libGU6IHRydWVcbiAgICAgICAgfSk7XG4gICAgdGhpcy5lbmFibGVGb3JtKCk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGVuYWJsZUZvcm0oKSB7XG4gICAgdGhpcy5mb3JtLmRpc2FibGVkID0gZmFsc2U7XG4gICAgY29uc3QgYnRuID0gKHRoaXMuZm9ybS5xdWVyeVNlbGVjdG9yKCdbdHlwZT1cInN1Ym1pdFwiXSBzdmcnKSk7XG4gICAgaWYgKGJ0bikgYnRuLnJlbW92ZSgpO1xuICB9XG4gIGRpc2FibGVGb3JtKCkge1xuICAgIHRoaXMuZm9ybS5kaXNhYmxlZCA9IHRydWU7XG4gICAgY29uc3QgYnRuID0gdGhpcy5mb3JtLnF1ZXJ5U2VsZWN0b3IoJ1t0eXBlPVwic3VibWl0XCJdJyk7XG4gICAgaWYgKGJ0bikgYnRuLmluc2VydEFkamFjZW50SFRNTCgnYWZ0ZXJiZWdpbicsIGh0bWxfc3Bpbm5lcigndGV4dC1zdG9uZS01MCBtbC0xIG1yLTIgYWxpZ24tdGV4dC1ib3R0b20gaW5saW5lLWJsb2NrJykpO1xuXG4gIH1cbiAgZGlzcGxheVJlc3BvbnNlKHJlc3BvbnNlLCBlcnJvciA9IGZhbHNlKSB7XG4gICAgY29uc3QgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBlbC5pZD1cInJlc3BvbnNlX1wiK3RoaXMuZm9ybS5pZDtcbiAgICAgICBlbC5pbnNlcnRBZGphY2VudEhUTUwoJ2FmdGVyYmVnaW4nLCByZXNwb25zZSk7XG4gICAgICAgICBpZiAoZXJyb3IgIT09IGZhbHNlKSBlbC5jbGFzc0xpc3QuYWRkKCdpcy1lcnJvcicpO1xuICAgICAgICB0aGlzLmZvcm0ucGFyZW50RWxlbWVudC5pbnNlcnRCZWZvcmUoZWwsIHRoaXMuZm9ybSk7XG4gICAgICAgIHRoaXMuZm9ybS5wYXJlbnRFbGVtZW50Lmluc2VydEJlZm9yZShlbCwgdGhpcy5mb3JtKTtcbiAgICAgICAgdGhpcy5mb3JtLnJlbW92ZSgpO1xuICB9XG59Il0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/modules/form-submit.js\n\n}")}}]);