/*! For license information please see src_modules_files_js-scandir_js.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["src_modules_files_js-scandir_js"],{"./src/modules/files/js-scandir.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   JsScanDir: () => (/* binding */ JsScanDir)\n/* harmony export */ });\n/* harmony import */ var _modules_utils_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../modules/utils.js */ \"./src/modules/utils.js\");\n\nlet instance = null;\n\nclass JsScanDir {\n  _events = {};\n  eventnames = {\n    complete: 'complete',\n    processed: 'file.processed',\n    error: 'file.error',\n  }\n  nextaction;\n  constructor() {\n    if (instance) return instance;\n    this.init();\n    instance = this;\n    return instance;\n  }\n\n  init(container) {\n    (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.add_custom_events)(this);\n\n    this.on(this.eventnames.error, (e) => {\n      consoile.log('scandir recevie error messgae', e)\n    })\n    this.on(this.eventnames.processed, async (e) => {\n      console.log('e', e)\n      //  if (this.nextaction) await this.nextaction();\n    })\n  }\n\n  async processFile(entry, callback = null) {\n    if (callback) await callback();\n  }\n\n  stopOnError(err) {\n    console.log('err', err);\n  }\n  fileType(data) {\n    const mime_type = (signature) => {\n      switch (signature) {\n        case '89504E47':\n          return 'image/png';\n        case '47494638':\n          return 'image/gif';\n        case '25504446':\n          return 'application/pdf';\n        case 'FFD8FFDB':\n        case 'FFD8FFE0':\n        case 'FFD8FFE1':\n          return 'image/jpeg';\n        case '504B0304':\n          return 'application/zip';\n        case 'EFBBBF22':\n          return 'text/tsv'; //'text/tab-separated-values';\n        default:\n          console.log('unknownsign', signature)\n          return 'unknown';\n      }\n    }\n    const uint = new Uint8Array(data);\n    let bytes = []\n    for (let i = 0; i < 4; i++) {\n      bytes.push(uint[i].toString(16))\n    }\n    data = bytes.join('').toUpperCase();\n    return {\n      input: uint,\n      mimetype: mime_type(data)\n    };\n  }\n\n\n  async readDirectory(dir, oncomplete) {\n    const self = this;\n    let errored = false;\n    let direntries = [];\n    const on_error = onerror ? onerror : (err) => {\n      console.log('on_error', err)\n      if (!errored) {\n        errored = true;\n      }\n    };\n    const reader = dir.createReader();\n    const on_read = async function(ents) {\n      if (ents.length && !errored) {\n        direntries = [...direntries, ...ents];\n        await reader.readEntries(on_read, on_error);\n      } else if (!errored) {\n        const complete = async function() {\n          if (oncomplete && direntries.length === 0) {\n            //console.log('dircomplete', dir.name);\n            oncomplete();\n          } else {\n            const entry = direntries.shift();\n            if (entry.isDirectory) await self.readDirectory(entry, complete);\n            else await self.processFile(entry, complete);\n          }\n        }\n        await complete();\n      } else {\n        console.log('treat error readdir');\n      }\n    }\n\n    await reader.readEntries(on_read, on_error);\n\n\n  }\n\n\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvbW9kdWxlcy9maWxlcy9qcy1zY2FuZGlyLmpzIiwibWFwcGluZ3MiOiI7Ozs7O0FBRWdDO0FBQ2hDOztBQUVPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxJQUFJLG9FQUFpQjs7QUFFckI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLE9BQU87QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7O0FBRUE7OztBQUdBOzs7QUFHQSIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9tb2R1bGVzL2ZpbGVzL2pzLXNjYW5kaXIuanM/OTIyNiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBhZGRfY3VzdG9tX2V2ZW50c1xufSBmcm9tICcuLi8uLi9tb2R1bGVzL3V0aWxzLmpzJztcbmxldCBpbnN0YW5jZSA9IG51bGw7XG5cbmV4cG9ydCBjbGFzcyBKc1NjYW5EaXIge1xuICBfZXZlbnRzID0ge307XG4gIGV2ZW50bmFtZXMgPSB7XG4gICAgY29tcGxldGU6ICdjb21wbGV0ZScsXG4gICAgcHJvY2Vzc2VkOiAnZmlsZS5wcm9jZXNzZWQnLFxuICAgIGVycm9yOiAnZmlsZS5lcnJvcicsXG4gIH1cbiAgbmV4dGFjdGlvbjtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgaWYgKGluc3RhbmNlKSByZXR1cm4gaW5zdGFuY2U7XG4gICAgdGhpcy5pbml0KCk7XG4gICAgaW5zdGFuY2UgPSB0aGlzO1xuICAgIHJldHVybiBpbnN0YW5jZTtcbiAgfVxuXG4gIGluaXQoY29udGFpbmVyKSB7XG4gICAgYWRkX2N1c3RvbV9ldmVudHModGhpcyk7XG5cbiAgICB0aGlzLm9uKHRoaXMuZXZlbnRuYW1lcy5lcnJvciwgKGUpID0+IHtcbiAgICAgIGNvbnNvaWxlLmxvZygnc2NhbmRpciByZWNldmllIGVycm9yIG1lc3NnYWUnLCBlKVxuICAgIH0pXG4gICAgdGhpcy5vbih0aGlzLmV2ZW50bmFtZXMucHJvY2Vzc2VkLCBhc3luYyAoZSkgPT4ge1xuICAgICAgY29uc29sZS5sb2coJ2UnLCBlKVxuICAgICAgLy8gIGlmICh0aGlzLm5leHRhY3Rpb24pIGF3YWl0IHRoaXMubmV4dGFjdGlvbigpO1xuICAgIH0pXG4gIH1cblxuICBhc3luYyBwcm9jZXNzRmlsZShlbnRyeSwgY2FsbGJhY2sgPSBudWxsKSB7XG4gICAgaWYgKGNhbGxiYWNrKSBhd2FpdCBjYWxsYmFjaygpO1xuICB9XG5cbiAgc3RvcE9uRXJyb3IoZXJyKSB7XG4gICAgY29uc29sZS5sb2coJ2VycicsIGVycik7XG4gIH1cbiAgZmlsZVR5cGUoZGF0YSkge1xuICAgIGNvbnN0IG1pbWVfdHlwZSA9IChzaWduYXR1cmUpID0+IHtcbiAgICAgIHN3aXRjaCAoc2lnbmF0dXJlKSB7XG4gICAgICAgIGNhc2UgJzg5NTA0RTQ3JzpcbiAgICAgICAgICByZXR1cm4gJ2ltYWdlL3BuZyc7XG4gICAgICAgIGNhc2UgJzQ3NDk0NjM4JzpcbiAgICAgICAgICByZXR1cm4gJ2ltYWdlL2dpZic7XG4gICAgICAgIGNhc2UgJzI1NTA0NDQ2JzpcbiAgICAgICAgICByZXR1cm4gJ2FwcGxpY2F0aW9uL3BkZic7XG4gICAgICAgIGNhc2UgJ0ZGRDhGRkRCJzpcbiAgICAgICAgY2FzZSAnRkZEOEZGRTAnOlxuICAgICAgICBjYXNlICdGRkQ4RkZFMSc6XG4gICAgICAgICAgcmV0dXJuICdpbWFnZS9qcGVnJztcbiAgICAgICAgY2FzZSAnNTA0QjAzMDQnOlxuICAgICAgICAgIHJldHVybiAnYXBwbGljYXRpb24vemlwJztcbiAgICAgICAgY2FzZSAnRUZCQkJGMjInOlxuICAgICAgICAgIHJldHVybiAndGV4dC90c3YnOyAvLyd0ZXh0L3RhYi1zZXBhcmF0ZWQtdmFsdWVzJztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICBjb25zb2xlLmxvZygndW5rbm93bnNpZ24nLCBzaWduYXR1cmUpXG4gICAgICAgICAgcmV0dXJuICd1bmtub3duJztcbiAgICAgIH1cbiAgICB9XG4gICAgY29uc3QgdWludCA9IG5ldyBVaW50OEFycmF5KGRhdGEpO1xuICAgIGxldCBieXRlcyA9IFtdXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCA0OyBpKyspIHtcbiAgICAgIGJ5dGVzLnB1c2godWludFtpXS50b1N0cmluZygxNikpXG4gICAgfVxuICAgIGRhdGEgPSBieXRlcy5qb2luKCcnKS50b1VwcGVyQ2FzZSgpO1xuICAgIHJldHVybiB7XG4gICAgICBpbnB1dDogdWludCxcbiAgICAgIG1pbWV0eXBlOiBtaW1lX3R5cGUoZGF0YSlcbiAgICB9O1xuICB9XG5cblxuICBhc3luYyByZWFkRGlyZWN0b3J5KGRpciwgb25jb21wbGV0ZSkge1xuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuICAgIGxldCBlcnJvcmVkID0gZmFsc2U7XG4gICAgbGV0IGRpcmVudHJpZXMgPSBbXTtcbiAgICBjb25zdCBvbl9lcnJvciA9IG9uZXJyb3IgPyBvbmVycm9yIDogKGVycikgPT4ge1xuICAgICAgY29uc29sZS5sb2coJ29uX2Vycm9yJywgZXJyKVxuICAgICAgaWYgKCFlcnJvcmVkKSB7XG4gICAgICAgIGVycm9yZWQgPSB0cnVlO1xuICAgICAgfVxuICAgIH07XG4gICAgY29uc3QgcmVhZGVyID0gZGlyLmNyZWF0ZVJlYWRlcigpO1xuICAgIGNvbnN0IG9uX3JlYWQgPSBhc3luYyBmdW5jdGlvbihlbnRzKSB7XG4gICAgICBpZiAoZW50cy5sZW5ndGggJiYgIWVycm9yZWQpIHtcbiAgICAgICAgZGlyZW50cmllcyA9IFsuLi5kaXJlbnRyaWVzLCAuLi5lbnRzXTtcbiAgICAgICAgYXdhaXQgcmVhZGVyLnJlYWRFbnRyaWVzKG9uX3JlYWQsIG9uX2Vycm9yKTtcbiAgICAgIH0gZWxzZSBpZiAoIWVycm9yZWQpIHtcbiAgICAgICAgY29uc3QgY29tcGxldGUgPSBhc3luYyBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZiAob25jb21wbGV0ZSAmJiBkaXJlbnRyaWVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgLy9jb25zb2xlLmxvZygnZGlyY29tcGxldGUnLCBkaXIubmFtZSk7XG4gICAgICAgICAgICBvbmNvbXBsZXRlKCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IGVudHJ5ID0gZGlyZW50cmllcy5zaGlmdCgpO1xuICAgICAgICAgICAgaWYgKGVudHJ5LmlzRGlyZWN0b3J5KSBhd2FpdCBzZWxmLnJlYWREaXJlY3RvcnkoZW50cnksIGNvbXBsZXRlKTtcbiAgICAgICAgICAgIGVsc2UgYXdhaXQgc2VsZi5wcm9jZXNzRmlsZShlbnRyeSwgY29tcGxldGUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBhd2FpdCBjb21wbGV0ZSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2coJ3RyZWF0IGVycm9yIHJlYWRkaXInKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBhd2FpdCByZWFkZXIucmVhZEVudHJpZXMob25fcmVhZCwgb25fZXJyb3IpO1xuXG5cbiAgfVxuXG5cbn0iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/modules/files/js-scandir.js\n")}}]);