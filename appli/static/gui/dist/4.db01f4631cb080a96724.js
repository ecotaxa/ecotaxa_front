/*! For license information please see 4.db01f4631cb080a96724.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[4,455,555],{8555:(e,t,s)=>{s.d(t,{FormSubmit:()=>r});var i=s(2838),n=s.n(i),a=s(7114),o=s(4860);a.Do.captcha=".js-captcha",a.AH.invalid="invalid",a.AH.inputvalid="valid",a.AH.required="required",a.AH.tshidden="ts-hidden-accessible";class r{handlers={validate:[],submit:[]};form=null;listener=null;constructor(e,t={}){if(e){if(!e.formsubmit){this.form=e instanceof HTMLElement?e:document.querySelector(e);const s={fetch:null};if(t=Object.assign(t,this.form.dataset),this.options=Object.assign(s,t),!this.form)return;this.tabs=this.form.querySelectorAll(a.Do.component.tabs.tab),this.validateFields(!0),this.init(),e.formsubmit=this}return e.formsubmit}}init(){this.form.addEventListener("keydown",(e=>{"Enter"===e.key&&e.target instanceof HTMLInputElement&&e.preventDefault()})),window.addEventListener("pageshow",(e=>{(event.persisted||void 0!==window.performance&&2===window.performance.navigation.type)&&this.enableForm()})),this.form.addEventListener("validate",(e=>{this.validateFields()})),this.form.addEventListener("submit",(async e=>{e.preventDefault();return await this.submitForm()})),this.specialFields()}specialFields(){this.form.querySelectorAll("input[data-match]").forEach((e=>{const t=e.dataset.match;if(!t)return;const s=document.getElementById(t);if(!s)return;const i=e.dataset.matchinvalid?e.dataset.matchinvalid:"no match",n=(t,s)=>{const n=t.closest(a.Do.component.form.formbox).querySelector('label[for="'+t.id+'"]'),o=s.closest(a.Do.component.form.formbox).querySelector('label[for="'+s.id+'"]'),{patternMismatch:r=!1}=t.validity,l=r?this.getMessage(t,"invalid"):"";!0===t.checkValidity()?(t.setCustomValidity(""),t==e&&null!==n?n.classList.remove(a.AH.invalid):null!==o&&o.classList.remove(a.AH.invalid),t.classList.remove(a.AH.invalid),t.value!==s.value?(s.setCustomValidity(i),o&&(o.dataset.invalid=i,o.classList.add(a.AH.invalid)),s.classList.add(a.AH.invalid)):(s.setCustomValidity(""),o&&o.classList.remove(a.AH.invalid),s.classList.remove(a.AH.invalid))):(t.setCustomValidity(l),n.dataset.invalid=l,n&&n.classList.add(a.AH.invalid),t.classList.add(a.AH.invalid)),t.focus()};[e,s].forEach((t=>{t.addEventListener("keyup",(i=>{n(t===e?e:s,t===e?s:e)}))}))}))}getMessage(e,t="invalid"){const{valueMissing:s=!0}=e.validity;return s?"* "+(e.dataset.required?e.dataset.required:this.form.dataset.required?this.form.dataset.required:e.validationMessage?e.validationMessage:"required"):e.dataset[t]?e.dataset[t]:e.validationMessage?e.validationMessage:"input invalid"}setLabelState(e,t){const s=this.getFieldLabel(e);if(null!=s)if(!0===t)s.classList.remove(a.AH.invalid);else{s.dataset.invalid=this.getMessage(e),s.classList.add(a.AH.invalid);const t=s.getBoundingClientRect(),i=t.left,n=t.top;window.scrollTo({top:n,left:i,behavior:"smooth"})}}validateField(e,t=!1){["select"].indexOf(e.tagName.toLowerCase())>=0?e.querySelectorAll("option:checked").forEach((e=>{e.value=(0,o.c6)(n().sanitize(e.value))})):e.value=(0,o.c6)(n().sanitize(e.value)),e.tomselect&&e.classList.remove(a.AH.tshidden);let s=e.checkValidity();e.tomselect&&e.classList.add(a.AH.tshidden),s&&void 0!==e.dataset.unique&&(s=this.validateFieldUnique(e));const i=document.createEvent("Event");return i.initEvent(s?"valid":"invalid",!0,!0),e.dispatchEvent(i),s}getFieldLabel(e){let t=e.closest('[for="'+e.name+'"]')?e.closest('[for="'+e.name+'"]'):e.closest('[data-for="'+e.name+'"]')?e.closest('[data-for="'+e.name+'"]'):null;return null===t&&(t=e.closest(a.Do.component.form.formbox)?e.closest(a.Do.component.form.formbox).querySelector(".label")?e.closest(a.Do.component.form.formbox).querySelector(".label"):e.closest(a.Do.component.form.formbox).querySelector("label"):null),null===t&&(t=e.parentElement&&e.parentElement.dataset.elem&&e.closest("fieldset")?e.closest("fieldset").querySelector("."+e.parentElement.dataset.elem):null),t}validateFieldUnique(e){const t=this.getFieldLabel(e);if(String(e.dataset.unique).toLowerCase()===String(e.value).toLowerCase()){t&&(t.dataset.confirm=window.alertbox.i18nmessages.noduplicate,t.classList.add(window.alertbox.alertconfig.css.confirm));const s=function(){e.dataset.unique=!1,t&&(t.classList.remove(window.alertbox.alertconfig.css.confirm),delete t.dataset.confirm)};return window.alertbox.createConfirm((t?t.textContent+" : ":"")+window.alertbox.i18nmessages.noduplicate,{callback_cancel:s,buttons:{ok:{text:window.alertbox.i18nmessages.modify},cancel:{text:window.alertbox.i18nmessages.saveanyway}}})}return t.dataset.confirm&&(t.classList.remove(window.alertbox.alertconfig.css.confirm),delete t.dataset.confirm),!0}async validateFields(e=!1){let t=!0,s=!0;return[...this.form.elements].forEach((i=>{if(!0===e){if(!i.dataset.listen){if(i.required){const e=this.getFieldLabel(i);e&&e.classList.add(a.AH.required)}i.addEventListener("change",(e=>{this.validateField(e.target)})),i.dataset.listen=!0,i.addEventListener("invalid",(e=>{this.setLabelState(i,!1)})),i.addEventListener("valid",(e=>{this.setLabelState(i,!0)}))}}else i.name&&i.type&&["submit","hidden"].indexOf(i.type)<0&&(["radio","checkbox"].indexOf(i.type)<0||i.required)&&(s=this.validateField(i,!1),t=t&&s)})),!1===e&&(this.tabs.forEach((e=>{e.querySelector(":invalid")||e.querySelector(a.Do.component.alert.danger)?e.classList.add(a.AH.error):e.classList.remove(a.AH.error)})),s=await this.execHandler("validate")),s&&t}addHandler(e,t){this.handlers[e].push(t)}fieldEnable(e=!0){this.form.querySelectorAll('input[data-sub="enable"]').forEach((t=>{t.disabled=!0!==e}))}async execHandler(e){if(0===this.handlers[e].length)return!0;let t=!0;return await Promise.all(this.handlers[e].map((async e=>{const s=await e();t=t&&s}))),t}formFetch(e=null){const t=new FormData(this.form);return t.fetch=!0,fetch(this.form.action,(0,o.Uc)({method:"POST",body:t})).then((t=>{if(t.redirected)return window.location=t.url,null;switch(e){case"text":case"html":return t.text();default:return t.json()}})).then((e=>{this.displayResponse(e)})).catch((e=>{this.displayResponse(e,!0)})).finally((e=>{this.form.disabled=!0})),!1}async submitForm(){this.fieldEnable();if(await this.validateFields(!1)){if(!0===(!!this.form.querySelector(a.Do.captcha)&&(!this.form.dataset.isbot||!0===this.form.dataset.isbot)))return!1;if(await this.execHandler("submit"))return this.options.fetch?this.formFetch(this.options.fetch):this.form.submit(),this.disableForm(),!0}return!1}enableForm(){this.form.disabled=!1;const e=this.form.querySelector('[type="submit"] svg');e&&e.remove()}disableForm(){this.form.disabled=!0;const e=this.form.querySelector('[type="submit"]');e&&e.insertAdjacentHTML("afterbegin",(0,o.QW)("text-stone-50 ml-1 mr-2 align-text-bottom inline-block"))}displayResponse(e,t=!1){const s=document.createElement("div");s.insertAdjacentHTML("afterbegin",e),!1!==t&&s.classList.add("is-error"),this.form.parentElement.insertBefore(s,this.form),this.form.remove()}}},5455:(e,t,s)=>{s.d(t,{JsTomSelect:()=>g});var i=s(2838),n=s.n(i),a=s(1551),o=s.n(a),r=s(6497),l=s.n(r),d=s(5396),c=s.n(d),m=s(5125),u=s.n(m),h=s(4860),p=s(7114);o().define("remove_button",l()),o().define("clear_button",c()),o().define("caret_position",u());let f={};function v(e,t,s=!1){if(!t)return e.text;let i=[];return Object.keys(e).indexOf(t)>=0?i.push(e[t]):t.indexOf("+")>0&&(!0===s?i.push(e[t.split("+")[0]]):t.split("+").forEach((t=>{t in e&&i.push(e[t])}))),i.join(" ")}class g{applyTo(e,t={},s=null){const i=e.getAttribute("id"),a=e.hasAttribute("multiple"),r=e.dataset.type;let l={url:"",settings:t};switch(e.dataset.create&&"true"===e.dataset.create&&(l.settings.create=!0,l.settings.addPrecedence=!0),e.dataset.empty&&"true"===e.dataset.empty&&(l.settings.allowEmptyOption=!0),e.dataset.maxitems&&(l.settings.maxItems=parseInt(e.dataset.maxitems)),e.dataset.addoption&&(l.settings.addoption=e.dataset.addoption.split(",")),r){case p.Jn.project:const t=a?null:1;l.url="/gui/prjlist/",l.settings={...l.settings,valueField:"id",searchField:"text",labelField:"text",openOnFocus:!1,maxItems:t,allowEmptyOption:!1};break;case p.Jn.user:l.url="/api/users/search?by_name=",l.settings={...l.settings,valueField:"id",searchField:"name",labelField:"name+email",onInitialize:function(){e.currentlist?f=e.currentlist:e.tomselect.items.forEach((e=>{""!==e&&parseInt(e)>0&&(f[e]=!0)}))},onItemAdd:function(t){""!==t&&(f[t]?(window.alertbox?(console.log("itemtoms",e),window.alertbox.addItemMessage({type:window.alertbox.alertconfig.types.danger,parent:e,content:window.alertbox.i18nmessages.exists})):(e.dataset.invalid=window.alertbox.i18nmessages.exists,e.dispatchEvent(new Event("invalid"))),setTimeout((()=>{if(this.removeOption(t),this.revertSettings.tabIndex<0||!e.options.length||!this.revertSettings)this.removeItem(t),f[t]=!0;else{const t=e.options[this.revertSettings.tabIndex].value;this.addItem(t)}window.alertbox?window.alertbox.removeItemMessage({type:window.alertbox.alertconfig.types.danger,parent:e,content:window.alertbox.i18nmessages.exists}):(delete e.dataset.invalid,e.dispatchEvent(new Event("undeterminate")))}),2e3)):f[t]=!0)},onItemRemove:function(t){if(f[t]&&delete f[t],a||!this.revertSettings||""===this.revertSettings.innerHTML&&0===this.revertSettings.tabIndex||this.revertSettings.tabIndex<0)return;const s=e.options[this.revertSettings.tabIndex].value;void 0!==f[s]&&delete f[s]}};break;case p.Jn.instr:l.url="/search/instruments",l.settings={valueField:"id",labelField:"text",searchField:"id",maxItems:1,preload:!0};break;case p.Jn.taxo:o().define("no_close",(()=>{this.close=()=>{}})),l.url="/search/taxo",l.settings={...l.settings,valueField:"id",labelField:"text",searchField:"text",closeAfterSelect:!0,onInitialize:()=>{const t=document.getElementById(i).nextElementSibling;if(!t.classList.contains("ts-wrapper"))return;t.querySelectorAll(p.Do.component.tomselect.tsdelet).forEach((t=>{(t=>{t.addEventListener("click",(t=>{const s=t.currentTarget.closest(p.Do.component.tomselect.item).dataset.value;s&&(t.stopImmediatePropagation(),e.tomselect.removeItem(s))}))})(t)}))}}}const d={create:!1,minOptions:0,maxOptions:null,preload:!1,hideSelected:!0,duplicates:!1,allowEmptyOption:!0,closeAfterSelect:!0,placeholder:e.placeholder?e.placeholder:e.dataset.placeholder?e.dataset.placeholder:"",onDropdownClose:function(){},shouldLoad:function(e){return e.length>2},onItemRemove:function(){return!0},load:function(e,t){e=n().sanitize(e);if(this.loading>10)return void t();let s="";switch(r){case p.Jn.user:s=l.url+encodeURIComponent("%"+e+"%");break;case p.Jn.instr:case p.Jn.taxo:if(s=l.url,0==e.indexOf("_")&&l.settings.addoption&&e==l.settings.addoption[0])return s=null,t(Object.entries([{text:l.settings.addoption[0],id:l.settings.addoption[1]}]));e&&(s+="?q="+encodeURIComponent(e));break;case p.Jn.project:s=l.url,e&&(s+="?filt_title="+encodeURIComponent(e))}null!==s&&fetch(s,(0,h.Uc)()).then((e=>e.json())).then((e=>(r===p.Jn.project&&e.data&&e.data.length&&(e=e.data.map((e=>({id:e[1],text:e[3][0],rights:e[0]})))),r===p.Jn.instr&&e.length&&(e=e.reduce(((e,t,s)=>{let i={id:t=n().sanitize(t),text:t};return e.push(i),e}),[])),e.length&&"object"==typeof e&&(e=Object.entries(e)),t(e)))).catch((e=>{console.log("tomselect-err",e)}))},render:{option:function(e,t){if(null==e)return"";const s=e.hasOwnProperty("optgroup")?`data-optgroup=${e.optgroup}`:"",i=v(e,l.settings.labelField);return`<div class="py-2 flex  ${a?"inline-flex":""} " ${s} data-value="${e[l.settings.valueField]}">${t(i)}</div>`},item:function(e,t){if(null==e)return"";const s=e.optgroup?`item-${e.optgroup}`:"",i=f[e[this.settings.valueField]]?"data-inlist":"",o=v(e,l.settings.labelField,!0);return n().sanitize(`<div class="${a?"flex inline-flex ":""} ${s}"  data-value="${e[this.settings.valueField]}"  ${i}>${t(o)} </div>`)},no_results:function(t,s){return n().sanitize('<div class="no-results">'+(e.dataset.noresults?e.dataset.noresults:"No result found for ")+s(t.input)+"</div>")}}};if(l.settings.plugins={clear_button:{title:e.dataset.clear?e.dataset.clear:"Clear all",html:e=>`<div class="${e.className}" id="clear-${i}" title="${e.title}"><i class="icon ${a?"":"p-[0.125rem]"} icon-x-circle-sm ${a?"":" opacity-50"}"></i></div>`}},l.settings.onClear=function(){return e.tomselect.clear(),!0},a&&(l.settings.plugins={...l.settings.plugins,remove_button:{}},l.settings.plugins={...l.settings.plugins,caret_position:{}}),l.settings=Object.assign(d,l.settings),null!==i){const t=new(o())("#"+i,l.settings);switch(t.wrapper.classList.remove(p.Do.component.tomselect.ident),t.wrapper.classList.remove("js"),t.wrapper.setAttribute("data-component","tom-select"),r){case p.Jn.taxo:t.on("item_add",((e,t)=>{null!==t&&t.classList.add("new")}));break;case p.Jn.project:e.dataset.dest&&t.on("item_add",((s,i)=>{if(s!=e.dataset.value&&t.options[s]&&!i.querySelector("a")){const e={A:"/prj/",V:"/prj/",M:"/gui/prj/edit/"},n=t.options[s].rights,a=Object.keys(n);a&&(a.length>1?(Object.entries(n).forEach((([e,t])=>{i.insertAdjacentHTML("beforeend",` <a data-k="${e}" class="small-caps font-normal ml-2">${t}</a>`)})),i.querySelectorAll("a").forEach((i=>{i.addEventListener("click",(i=>{i.preventDefault(),i.stopPropagation(),window.open(e[i.target.dataset.k]+s,`_proj${s}`).focus(),t.removeItem(s)}))}))):(window.open(e[a[0]]+s,`_proj${s}`).focus(),t.removeItem(s)))}}))}return t}console.log("noid")}getUserList(){return f}}},5004:(e,t,s)=>{s.d(t,{ProjectPrivileges:()=>r});var i=s(2838),n=s.n(i),a=(s(8555),s(5455)),o=s(7114);class r{options;keymessages={oneatleast:"oneatleast",nomanager:"nomanager",nocontact:"nocontact",uhasnopriv:"uhasnopriv",importpriverror:"importpriverror",emptyname:"emptyname"};current_uid;fieldset;fieldset_alert_zone;linemodel;currentlist={};constructor(e,t={}){if(null!==e&&e instanceof HTMLElement!=!1){if(!e.jsprivileges){const s={separ:".new-privilege",addbtn:'[data-add="block"]',target:"member",ident:"member",privilege:"privilege",delet:"delet",contact:"contact",contactfieldname:"contact_user_id",domselectors:{tabcontent:".tab-content"}};if(this.options=Object.assign({},s,t),this.fieldset=e,!this.fieldset)return window.alertbox.classError();this.fieldset_alert_zone=e.querySelector(this.options.domselectors.tabcontent)?e.querySelector(this.options.domselectors.tabcontent):e,this.options.separ=this.options.separ instanceof HTMLElement?this.options.separ:document.querySelector(this.options.separ)?document.querySelector(this.options.separ):null,this.options.addbtn=this.options.addbtn instanceof HTMLElement?this.options.addbtn:document.querySelector(this.options.addbtn),this.options.addbtn&&this.addListener();const i=this.fieldset.querySelectorAll('[data-block="'+this.options.target+'"]');if(0===i.length)return window.alertbox.classError();if(this.linemodel=this.clearLine(i[0].cloneNode(!0),0,-1),this.linemodel.classList.add(o.AH.hide),this.linecontainer=i[0].parentElement,null===this.linecontainer)return window.alertbox.classError();this.current_uid=this.fieldset.dataset.u,i.forEach(((e,t)=>{e.dataset.n=t,this.activateEvents(e)}));const n=this.fieldset.closest("form");n&&(n.formsubmit?(n.formsubmit.addHandler("validate",(()=>this.validateFields())),n.formsubmit.addHandler("submit",(()=>this.formatPrivileges()))):n.addEventListener("submit",(async e=>{if(!1!==this.validateFields())return this.formatPrivileges();e.preventDefault()}))),this.orderRows(),e.jsprivileges=this}return e.jsprivileges}}newLine(e=!1,t=0,s=!1){const i=this.linecontainer.children;let n;if(i.length&&t>0&&(n=this.getLinePrivilege(t)),n)return!0===s?n:null;if(n=this.linemodel.cloneNode(!0),n.classList.remove(o.AH.hide),n){this.linecontainer.append(n);const s=this.fieldset.dataset.n?parseInt(this.fieldset.dataset.n)+1:i.length;if(n=this.clearLine(n,-1,s,this.options.separ?this.options.separ:null),n.dataset.n=s,this.fieldset.dataset.n=s,this.activateEvents(n,0===t),!0===e)return n}return null}addListener(){this.options.target=this.options.addbtn.dataset.target?this.options.addbtn.dataset.target:this.options.target,this.options.addbtn.addEventListener("click",(async e=>{e.preventDefault(),this.newLine()}))}indexElement(e,t,s){return["id","name","for","aria-controls"].forEach((i=>{let n=e.getAttribute(i);null!==n&&(n="name"===i?n.replace("["+t+"]","["+s+"]"):n.replace("_"+t,"_"+s),e.setAttribute(i,n))})),e}indexLine(e,t,s=null){s=null===s?t+1:s;return e.querySelectorAll("[data-elem]").forEach((e=>{e.querySelectorAll("input, select, label, div").forEach((e=>{null!==t&&(e=this.indexElement(e,t,s))}))})),e.dataset.n=parseInt(s),this.fieldset.dataset.n=this.fieldset.dataset.n&&this.fieldset.dataset.n>=s?this.fieldset.dataset.n:s,e}clearLine(e,t=null,s=null,i=null){e.dataset.mod="",e.disabled=!1;return e.querySelectorAll("[data-elem]").forEach((e=>{e.querySelectorAll("input, select, label, div").forEach((e=>{switch(e.disabled=!1,null!==t&&(s=null===s?t+1:s,e=this.indexElement(e,t,s)),e.tagName.toLowerCase()){case"input":e.checked=!1,e.name==this.options.contactfieldname&&(e.value="0",e.disabled=!0);break;case"select":Array.from(e.options).forEach((e=>{parseInt(e.value)>0&&e.remove()})),e.selectedIndex=0,e.tomselect?e.tomselect.destroy():["tom-select","tomselected","ts-hidden-accessible"].forEach((t=>{e.classList.remove(t)}));break;case"div":null!==t&&e.dataset.component&&e.remove()}}))})),i&&(e.classList.add("new"),i.after(e)),e}setLine(e,t={key:"",value:""},s,i){if(!(s=o.tt[s]?o.tt[s]:o.tt.viewers))return;const{member:r,privs:l,contact:d,delet:c}=this.getInputs(e,s);if(!(r&&l&&d&&c))return;t.key=n().sanitize(t.key),t.value=n().sanitize(t.value);let m=r.querySelector('option[value="'+t.key+'"]');if(null===m&&(m=document.createElement("option"),m.value=t.key,m.text=t.value,r.append(m)),m.selected=!0,!r.tomselect){(new a.JsTomSelect).applyTo(r)}l.checked=!0,d.value=t.key,s===o.uZ.manage?(d.disabled=!1,!0!==i||d.checked||(d.checked=!0)):(d.disabled=!0,d.checked=!1)}getInputs(e,t=!1){const s=e.querySelector("[name*='["+this.options.ident+"]']");let i;i=t?e.querySelector('input[name*="['+this.options.privilege+']"][value="'+t+'"]'):e.querySelectorAll('input[name*="['+this.options.privilege+']"]');return{member:s,privs:i,contact:e.querySelector('input[name="'+this.options.contactfieldname+'"]'),delet:e.querySelector("input[name*='["+this.options.delet+"]']")}}async importPrivileges(e,t=!1,s=null,i=null,n=null){!0===t&&this.clearAll();try{return Object.entries(e).forEach((([e,n])=>{n.forEach((n=>{const a=this.newLine(!0,n.id);a&&(this.setLine(a,{key:n.id,value:n.name},e,null!==s&&s.id===n.id),i&&i(a)),t=!1}))})),n&&n(),window.alertbox.dismissAlert(this.keymessages.importpriverror),this.orderRows(),!0}catch(e){return window.alertbox.renderAlert({type:window.alertbox.alertconfig.types.error,content:this.keymessages.importpriverror,dismissible:!0,inverse:!0}),console.log("err",e),!1}}activateEvents(e,t=!1){if(!e)return;const{member:s,privs:i,contact:n,delet:r}=this.getInputs(e);if(!(s&&i&&n&&r))return;const l=e=>[...e.parentElement.children].filter((t=>1==t.nodeType&&t!=e&&t.classList.contains("row")&&null!==t.dataset.block&&t.dataset.block===this.options.target));if(s.currentlist||(s.currentlist=this.currentlist),s.value&&!this.currentlist[s.value]&&(this.currentlist[s.value]=!0),!0===t&&!s.tomselect){(new a.JsTomSelect).applyTo(s)}const d=(t,s,i,n=!1)=>{t&&t.checked&&(t.checked=!0,window.alertbox.hasItemMessages(e)&&window.alertbox.removeItemMessage({type:window.alertbox.alertconfig.types.danger,parent:e,content:this.keymessages.uhasnopriv})),t&&t.value===o.uZ.manage?(i.disabled=!0,s.disabled=!1,window.alertbox.dismissAlert(this.keymessages.nomanager),s.checked&&(window.alertbox.dismissAlert(this.keymessages.nocontact),s.dispatchEvent(new Event("valid")))):(s.checked=!1,i.disabled=!1,s.disabled=!0),!0===n&&c(e),i.ckecked||(window.alertbox.dismissAlert(this.keymessages.nobody),window.alertbox.hasItemMessages(e)&&window.alertbox.removeItemMessage({type:window.alertbox.alertconfig.types.danger,parent:e,content:this.keymessages.oneatleast}))},c=e=>{l(e).forEach((e=>{const t=e.querySelector("input[name*='["+this.options.delet+"]']"),s=e.querySelector('input[name="'+this.options.contactfieldname+'"]'),i=e.querySelector('input[name*="['+this.options.privilege+']"]:checked');d(i,s,t,!1)}))};s.addEventListener("change",(e=>{n.value=s.value,parseInt(s.value)>0&&window.alertbox.hasItemMessages(s)&&window.alertbox.removeItemMessage({type:window.alertbox.alertconfig.types.danger,parent:s,content:this.keymessages.emptyname})})),i.forEach((e=>{e.addEventListener("change",(t=>{e.checked&&d(e,n,r,!1)})),e.checked&&d(e,n,r,!1)})),n.addEventListener("change",(t=>{n.checked?r.disabled=!0:r.disabled=!1;const s=e.querySelector('input[name*="['+this.options.privilege+']"]:checked');d(s,n,r,!0)})),r.addEventListener("click",(t=>{const a=r.closest("label");if(this.fieldset.querySelectorAll('[data-block="'+this.options.target+'"]:not([data-mod="remove"])').length<=1&&t.target.checked)return t.preventDefault(),e.removeAttribute("data-mod"),s.disabled=!1,t.target.disabled=!0,void window.alertbox.addItemMessage({type:window.alertbox.alertconfig.types.danger,parent:e,content:this.keymessages.oneatleast,duration:3e3});t.target.checked?(window.alertbox.hasItemMessages(s)&&window.alertbox.removeItemMessage({type:window.alertbox.alertconfig.types.danger,parent:s}),e.classList.contains("new")?e.remove():(a&&a.dataset.restore&&(a.dataset.title=a.dataset.restore),e.setAttribute("data-mod","remove"),i.forEach((e=>{e.dataset.checked=e.checked,e.checked=!1,e.disabled=!0})),n.checked=!1,n.disabled=!0,s.disabled=!0)):(a&&a.dataset.remove&&(a.dataset.title=a.dataset.remove),e.removeAttribute("data-mod"),i.forEach((e=>{e.disabled=!1,"true"===e.dataset.checked?e.checked=!0:e.checked=!1})),s.disabled=!1)})),r.addEventListener("mouseover",(t=>{if(t.target.disabled){let s=e.querySelector('input[name*="['+this.options.privilege+']"]:checked');if(!s)return;s=s.value.toLowerCase(),t.target.dataset.title=t.target.dataset[s]?t.target.dataset[s]:t.target.dataset.title}})),this.current_uid===s.value&&(r.disabled=!0)}validateFields(e=!1){const t=e=>e.value,s=e=>{const t=e.querySelector('[name*="['+this.options.privilege+']"]:checked');return!(!t||!t.value)},i=this.fieldset.querySelectorAll('[data-block="'+this.options.target+'"]');let n=i.length,a=!0;for(const e of i){const i=e.querySelector('[name*="['+this.options.ident+']"]');if(e.dataset.mod&&"remove"===e.dataset.mod){if(!(n>1))return!1;e.remove(),n--}else if(!t(i)){window.alertbox.addItemMessage({type:window.alertbox.alertconfig.types.danger,parent:i,content:this.keymessages.emptyname}),i.focus();if(!0!==!1)return!1;if(!(n>1))return!1;e.remove(),n--}s(e)?window.alertbox.hasItemMessages(e)&&window.alertbox.removeItemMessage({type:window.alertbox.alertconfig.types.danger,parent:e,content:this.keymessages.uhasnopriv}):(window.alertbox.addItemMessage({type:window.alertbox.alertconfig.types.danger,parent:e,content:this.keymessages.uhasnopriv}),a=!1)}if(0===n)return window.alertbox.renderAlert({type:window.alertbox.alertconfig.types.danger,content:this.keymessages.nobody,dismissible:!0,inverse:!0}),!1;window.alertbox.dismissAlert(this.keymessages.nobody);return(()=>{if(0===this.fieldset.querySelectorAll('[name*="['+this.options.privilege+']"][value="'+o.uZ.manage+'"]:checked').length)return window.alertbox.renderAlert({type:window.alertbox.alertconfig.types.danger,content:this.keymessages.nomanager,dismissible:!0,inverse:!0}),this.tabError(!0),!1;window.alertbox.dismissAlert(this.keymessages.nomanager),this.tabError(!1);return null===this.fieldset.querySelector('[name="'+this.options.contactfieldname+'"]:checked')?(window.alertbox.renderAlert({type:window.alertbox.alertconfig.types.danger,content:this.keymessages.nocontact,dismissible:!0,inverse:!0}),this.tabError(!0),!1):(window.alertbox.dismissAlert(this.keymessages.nocontact),this.tabError(!1),!0)})()&&a}formatPrivileges(){const e=this.fieldset.querySelectorAll('[data-block="'+this.options.target+'"]'),t=e=>{e.querySelectorAll('[name*="members["').forEach((e=>{let t=e.name;t=t.split("["),t.pop(),e.name=t.join("["),e.name.indexOf("["+this.options.privilege+"]")>0&&(e.type="checkbox",e.classList.add("hidden"))}))};return e.forEach((e=>{t(e)})),!0}getLinePrivilege(e){let t=null;const s=this.fieldset.querySelectorAll('[data-block="'+this.options.target+'"]');for(const i of s)if(parseInt(i.querySelector('[name*="['+this.options.ident+']"]').value)===parseInt(e)){t=i;break}return t}clearAll(){this.fieldset.querySelectorAll('[data-block="'+this.options.target+'"]').forEach(((e,t)=>{e.remove()}))}orderRows(){const e=Array.from(this.fieldset.querySelectorAll('[data-block="'+this.options.target+'"]'));if(e.length>2)try{const t=Object.values(o.uZ);e.sort(((e,s)=>{const i=this.getInputs(e),n=this.getInputs(s),a=new String(n.member.options[n.member.selectedIndex].text).toLowerCase().split(" "),o=new String(i.member.options[i.member.selectedIndex].text).toLowerCase().split(" "),r=Array.from(i.privs).filter((e=>e.checked)),l=Array.from(n.privs).filter((e=>e.checked)),d=+!i.contact.checked+" "+t.indexOf(r.length?r[0].value:null)+" "+(o.length>1?o.pop()+" "+o[0]:o[0]),c=+!n.contact.checked+" "+t.indexOf(l.length?l[0].value:null)+" "+(a.length>1?a.pop()+" "+a[0]:a[0]);return c>d?-1:d>c?1:0}));const s=this.linecontainer;e.forEach(((e,t)=>{s.appendChild(e)}))}catch(e){console.log("err not sorted",e)}}tabError(e){const t=this.fieldset.classList.contains(o.Do.component.tabs.tab.substr(1))?this.fieldset:this.fieldset.parentElement.classList.contains(o.Do.component.tabs.tab.substr(1))?this.fieldset.parentElement:null;null!==t&&(!0===e?t.classList.add(o.AH.error):t.classList.remove(o.AH.error))}}}}]);