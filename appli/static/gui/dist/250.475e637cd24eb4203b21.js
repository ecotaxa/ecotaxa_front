/*! For license information please see 250.475e637cd24eb4203b21.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[250,615],{615:(e,t,s)=>{s.d(t,{FormSubmit:()=>d});var i=s(7856),a=s.n(i),l=s(2817),r=s(9162);const o="input-invalid",n="input-valid";l.EY.captcha=".js-captcha";class d{handlers=[];form=null;listener=null;constructor(e,t={}){if(e){if(!e.formsubmit){this.form=e instanceof HTMLElement?e:document.querySelector(e);const s={fetch:null};if(t=Object.assign(t,this.form.dataset),this.options=Object.assign(s,t),!this.form)return;this.tabs=this.form.querySelectorAll(l.EY.component.tabs.tab),this.validateFields(!0),this.init(),e.formsubmit=this}return e.formsubmit}}init(){this.form.addEventListener("keypress",(e=>{"Enter"===e.key&&e.target instanceof HTMLInputElement&&e.preventDefault()})),this.form.addEventListener("submit",(async e=>{e.preventDefault();return await this.submitForm()})),this.specialFields()}specialFields(){this.form.querySelectorAll("input[data-match]").forEach((e=>{const t=e.dataset.match;if(!t)return;const s=document.getElementById(t);if(!s)return;const i=e.dataset.matchinvalid?e.dataset.matchinvalid:"no match",a=(t,a)=>{const l=e.previousElementSibling&&"label"==e.previousElementSibling.tagName.toLowerCase()?e.previousElementSibling:null,r=s.previousElementSibling&&"label"==s.previousElementSibling.tagName.toLowerCase()?s.previousElementSibling:null,{patternMismatch:d=!1}=t.validity,c=d?this.get_message(t,"invalid"):"";!0===t.checkValidity()?(t.dataset.invalid="",t.setCustomValidity(""),t==e&&null!==l?l.classList.remove(o):null!==r&&r.classList.remove(o),t.classList.remove(n),t.value!==a.value?(e.setCustomValidity(i),l&&(l.dataset.invalid=l.dataset.invalid?l.dataset.invalid:i,l.classList.add(o)),e.classList.add(n)):(e.setCustomValidity(""),l&&l.classList.remove(o),e.classList.remove(n))):(t.setCustomValidity(c),t.dataset.invalid=c,l&&l.classList.add(o),t.classList.add(n)),t.focus()};[e,s].forEach((t=>{t.addEventListener("keyup",(i=>{a(t,t===e?s:e)}))}))}))}get_message(e,t="invalid"){if(0==e.checkValidity()){const{valueMissing:s=!0}=e.validity;return s?"* "+(e.dataset.required?e.dataset.required:this.form.dataset.required?this.form.dataset.required:"required"):e.dataset[t]?e.dataset[t]:"input invalid"}return""}validateField(e,t=!1){["textarea","input"].indexOf(e.tagName.toLowerCase()),["select",'input[type="checkbox"]'].indexOf(e.tagName.toLowerCase())>=0?e.querySelectorAll("option:checked").forEach((e=>{e.value=(0,r.Tv)(a().sanitize(e.value))})):e.value=(0,r.Tv)(a().sanitize(e.value));const s=e.checkValidity(),i=this.getFieldLabel(e);return i&&(s?i.classList.remove(o):s||(i.dataset.invalid=this.get_message(e),i.classList.add(o),window.scrollTo({top:parseInt(i.offsetTop),left:parseInt(i.offsetLeft),behavior:"smooth"}))),s}getFieldLabel(e){return e.closest(".form-box")?e.closest(".form-box").querySelector(".label")?e.closest(".form-box").querySelector(".label"):e.closest(".form-box").querySelector("label"):null}validateFields(e=!1){let t=!0;return[...this.form.elements].forEach((s=>{if(s.name)if(!0===e){if(!s.dataset.listen){if(s.hasAttribute("required")&&s.required){const e=this.getFieldLabel(s);e&&e.classList.add("required")}["change","blur"].forEach((t=>{s.addEventListener(t,(t=>{this.validateField(t.currentTarget,e)}))})),s.dataset.listen=!0}}else t=t&&this.validateField(s,e)})),this.tabs.forEach((e=>{e.querySelector(":invalid")||e.querySelector(l.EY.component.alert.danger)?e.classList.add(l.iv.error):e.classList.remove(l.iv.error)})),t}addHandler(e){this.handlers.push(e)}fieldEnable(e=!0){this.form.querySelectorAll('input[data-sub="enable"]').forEach((t=>{t.disabled=!0!==e}))}async submitHandler(){if(!this.validateFields())return!1;if(0===this.handlers.length)return!0;let e=!0;return await Promise.all(this.handlers.map((async t=>{const s=await t();e=e&&s}))),!0===e&&(this.handlers=[]),e}formFetch(e=null){const t=new FormData(this.form);return t.fetch=!0,fetch(this.form.action,(0,r.wv)({method:"POST",body:t})).then((t=>{switch(e){case"text":case"html":return t.text();default:return t.json()}})).then((e=>{this.displayResponse(e)})).catch((e=>{this.displayResponse(e,!0)})).finally((e=>{this.form.disabled=!0})),!1}async submitForm(){if(this.fieldEnable(),this.validateFields(!1)){if(!0===(!!this.form.querySelector(l.EY.captcha)&&(!this.form.dataset.isbot||!0===this.form.dataset.isbot)))return!1;return!!await this.submitHandler()&&(this.options.fetch?this.formFetch(this.options.fetch):this.form.submit(),this.form.disabled=!0,!0)}return!1}displayResponse(e,t=!1){const s=document.createElement("div");s.insertAdjacentHTML("afterbegin",e),!1!==t&&s.classList.add("is-error"),this.form.parentElement.insertBefore(s,this.form),this.form.remove()}}},6250:(e,t,s)=>{s.d(t,{JsImport:()=>a});s(7856),s(615),s(9162);var i=s(2817);class a{typeimport;myFiles;constructor(e,t={}){if(!(e=e instanceof HTMLElement?e:document.querySelector(e)))return;this.container=e;this.options=Object.assign({selector:{displayresult:"results",typeimport:"typeimport",importzone:"file_to_load",showfiles:".showfiles",displayselection:"dirlist"}},t),this.init()}init(){this.container.querySelectorAll('input[name="'+this.options.selector.typeimport+'"]').forEach((e=>{e.addEventListener("change",(e=>{e.currentTarget.checked&&(console.log(e.currentTarget),this.typeimport=e.currentTarget.value,this.showSelection(!0))}))})),this.showSelection()}async showSelection(e=!1){const t=document.getElementById(this.options.selector.displayselection),a=document.getElementById(this.options.selector.displayresult);if(t&&a){if(!this.myFiles){const{JsMyFiles:e}=await s.e(541).then(s.bind(s,8541));this.myFiles=new e(t,{enableupload:!0,enablestore:!0,btnfilelist:this.options.showfiles,upload:{label:t.dataset.uploadlabel?t.dataset.uploadlabel:"upload",callback:()=>{this.addImportPath("/tmp/ecotaxa_user.760/ecotaxa_import"),this.showSubmit()}}})}!0===e&&(()=>{let e=this.typeimport.split("-");e=e.map((e=>new Set([...i.FB[e]?i.FB[e]:[]]))),this.myFiles.container.querySelectorAll("[data-ftype]").forEach((t=>{e.has(t.dataset.ftype)?t.classList.remove("disabled"):t.classList.add("disabled")}))})()}}addImportPath(e){document.getElementById(this.options.selector.importzone).value=e;const t=document.getElementById(this.options.selector.displayresult);t&&(t.innerHTML=`<li>${e.split("/").pop()}</li>`);this.container.querySelector("#"+this.options.selector.importoptions)}showSubmit(e=!0){const t=this.container.querySelector('[type="submit"]');console.log("sub",t),e?(t.classList.remove("hide"),t.disabled=!1):t.disabled=!0}}}}]);