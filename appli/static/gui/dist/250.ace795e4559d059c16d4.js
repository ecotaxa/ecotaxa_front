/*! For license information please see 250.ace795e4559d059c16d4.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[250,615],{615:(e,t,i)=>{i.d(t,{FormSubmit:()=>n});var s=i(7856),a=i.n(s),l=i(2817),o=i(7737);l.EY.captcha=".js-captcha",l.iv.invalid="invalid",l.iv.inputvalid="valid",l.iv.required="required",l.iv.tshidden="ts-hidden-accessible";class n{handlers={validate:[],submit:[]};form=null;listener=null;constructor(e,t={}){if(e){if(!e.formsubmit){this.form=e instanceof HTMLElement?e:document.querySelector(e);const i={fetch:null};if(t=Object.assign(t,this.form.dataset),this.options=Object.assign(i,t),!this.form)return;this.tabs=this.form.querySelectorAll(l.EY.component.tabs.tab),this.validateFields(!0),this.init(),e.formsubmit=this}return e.formsubmit}}init(){this.form.addEventListener("keydown",(e=>{"Enter"===e.key&&e.target instanceof HTMLInputElement&&e.preventDefault()})),window.addEventListener("pageshow",(e=>{(event.persisted||void 0!==window.performance&&2===window.performance.navigation.type)&&this.enableForm()})),this.form.addEventListener("validate",(e=>{this.validateFields()})),this.form.addEventListener("submit",(async e=>{e.preventDefault();return await this.submitForm()})),this.specialFields()}specialFields(){this.form.querySelectorAll("input[data-match]").forEach((e=>{const t=e.dataset.match;if(!t)return;const i=document.getElementById(t);if(!i)return;const s=e.dataset.matchinvalid?e.dataset.matchinvalid:"no match",a=(t,i)=>{const a=t.closest(l.EY.component.form.formbox).querySelector('label[for="'+t.id+'"]'),o=i.closest(l.EY.component.form.formbox).querySelector('label[for="'+i.id+'"]'),{patternMismatch:n=!1}=t.validity,r=n?this.getMessage(t,"invalid"):"";!0===t.checkValidity()?(t.setCustomValidity(""),t==e&&null!==a?a.classList.remove(l.iv.invalid):null!==o&&o.classList.remove(l.iv.invalid),t.classList.remove(l.iv.invalid),t.value!==i.value?(i.setCustomValidity(s),o&&(o.dataset.invalid=s,o.classList.add(l.iv.invalid)),i.classList.add(l.iv.invalid)):(i.setCustomValidity(""),o&&o.classList.remove(l.iv.invalid),i.classList.remove(l.iv.invalid))):(t.setCustomValidity(r),a.dataset.invalid=r,a&&a.classList.add(l.iv.invalid),t.classList.add(l.iv.invalid)),t.focus()};[e,i].forEach((t=>{t.addEventListener("keyup",(s=>{a(t===e?e:i,t===e?i:e)}))}))}))}getMessage(e,t="invalid"){const{valueMissing:i=!0}=e.validity;return i?"* "+(e.dataset.required?e.dataset.required:this.form.dataset.required?this.form.dataset.required:e.validationMessage?e.validationMessage:"required"):e.dataset[t]?e.dataset[t]:e.validationMessage?e.validationMessage:"input invalid"}setLabelState(e,t){const i=this.getFieldLabel(e);if(null!=i)if(!0===t)i.classList.remove(l.iv.invalid);else{i.dataset.invalid=this.getMessage(e),i.classList.add(l.iv.invalid);const t=i.getBoundingClientRect(),s=t.left,a=t.top;window.scrollTo({top:a,left:s,behavior:"smooth"})}}validateField(e,t=!1){["select"].indexOf(e.tagName.toLowerCase())>=0?e.querySelectorAll("option:checked").forEach((e=>{e.value=(0,o.Tv)(a().sanitize(e.value))})):e.value=(0,o.Tv)(a().sanitize(e.value)),e.tomselect&&e.classList.remove(l.iv.tshidden);let i=e.checkValidity();e.tomselect&&e.classList.add(l.iv.tshidden),i&&void 0!==e.dataset.unique&&(i=this.validateFieldUnique(e));const s=document.createEvent("Event");return s.initEvent(i?"valid":"invalid",!0,!0),e.dispatchEvent(s),i}getFieldLabel(e){let t=e.closest('[for="'+e.name+'"]')?e.closest('[for="'+e.name+'"]'):e.closest('[data-for="'+e.name+'"]')?e.closest('[data-for="'+e.name+'"]'):null;return null===t&&(t=e.closest(l.EY.component.form.formbox)?e.closest(l.EY.component.form.formbox).querySelector(".label")?e.closest(l.EY.component.form.formbox).querySelector(".label"):e.closest(l.EY.component.form.formbox).querySelector("label"):null),null===t&&(t=e.parentElement&&e.parentElement.dataset.elem&&e.closest("fieldset")?e.closest("fieldset").querySelector("."+e.parentElement.dataset.elem):null),t}validateFieldUnique(e){const t=this.getFieldLabel(e);if(String(e.dataset.unique).toLowerCase()===String(e.value).toLowerCase()){t&&(t.dataset.confirm=window.alertbox.i18nmessages.noduplicate,t.classList.add(window.alertbox.alertconfig.css.confirm));const i=function(){e.dataset.unique=!1,t&&(t.classList.remove(window.alertbox.alertconfig.css.confirm),delete t.dataset.confirm)};return window.alertbox.createConfirm((t?t.textContent+" : ":"")+window.alertbox.i18nmessages.noduplicate,{callback_cancel:i,buttons:{ok:{text:window.alertbox.i18nmessages.modify},cancel:{text:window.alertbox.i18nmessages.saveanyway}}})}return t.dataset.confirm&&(t.classList.remove(window.alertbox.alertconfig.css.confirm),delete t.dataset.confirm),!0}async validateFields(e=!1){let t=!0,i=!0;return[...this.form.elements].forEach((s=>{if(!0===e){if(!s.dataset.listen){if(s.required){const e=this.getFieldLabel(s);e&&e.classList.add(l.iv.required)}s.addEventListener("change",(e=>{this.validateField(e.target)})),s.dataset.listen=!0,s.addEventListener("invalid",(e=>{this.setLabelState(s,!1)})),s.addEventListener("valid",(e=>{this.setLabelState(s,!0)}))}}else s.name&&s.type&&["submit","hidden"].indexOf(s.type)<0&&(["radio","checkbox"].indexOf(s.type)<0||s.required)&&(i=this.validateField(s,!1),t=t&&i)})),!1===e&&(this.tabs.forEach((e=>{e.querySelector(":invalid")||e.querySelector(l.EY.component.alert.danger)?e.classList.add(l.iv.error):e.classList.remove(l.iv.error)})),i=await this.execHandler("validate")),i&&t}addHandler(e,t){this.handlers[e].push(t)}fieldEnable(e=!0){this.form.querySelectorAll('input[data-sub="enable"]').forEach((t=>{t.disabled=!0!==e}))}async execHandler(e){if(0===this.handlers[e].length)return!0;let t=!0;return await Promise.all(this.handlers[e].map((async e=>{const i=await e();t=t&&i}))),t}formFetch(e=null){const t=new FormData(this.form);return t.fetch=!0,fetch(this.form.action,(0,o.wv)({method:"POST",body:t})).then((t=>{if(t.redirected)return window.location=t.url,null;switch(e){case"text":case"html":return t.text();default:return t.json()}})).then((e=>{this.displayResponse(e)})).catch((e=>{this.displayResponse(e,!0)})).finally((e=>{this.form.disabled=!0})),!1}async submitForm(){this.fieldEnable();if(await this.validateFields(!1)){if(!0===(!!this.form.querySelector(l.EY.captcha)&&(!this.form.dataset.isbot||!0===this.form.dataset.isbot)))return!1;if(await this.execHandler("submit"))return this.options.fetch?this.formFetch(this.options.fetch):this.form.submit(),this.disableForm(),!0}return!1}enableForm(){this.form.disabled=!1;const e=this.form.querySelector('[type="submit"] svg');e&&e.remove()}disableForm(){this.form.disabled=!0;const e=this.form.querySelector('[type="submit"]');e&&e.insertAdjacentHTML("afterbegin",(0,o.IW)("text-stone-50 ml-1 mr-2 align-text-bottom inline-block"))}displayResponse(e,t=!1){const i=document.createElement("div");i.insertAdjacentHTML("afterbegin",e),!1!==t&&i.classList.add("is-error"),this.form.parentElement.insertBefore(i,this.form),this.form.remove()}}},6250:(e,t,i)=>{i.d(t,{JsImport:()=>s});i(7856),i(615),i(7737),i(2817);class s{typeimport;myFiles;constructor(e,t={}){if(!(e=e instanceof HTMLElement?e:document.querySelector(e)))return;this.container=e;this.options=Object.assign({selector:{displayresult:"results",typeimport:"typeimport",importzone:"file_to_load",showfiles:".showfiles",displayselection:"dirlist"}},t),this.init()}init(){this.container.querySelectorAll('input[name="'+this.options.selector.typeimport+'"]').forEach((e=>{e.addEventListener("change",(e=>{e.currentTarget.checked&&(console.log(e.currentTarget),this.typeimport=e.currentTarget.value,this.showSelection(!0))}))})),this.showSelection()}async showSelection(e=!1){const t=document.getElementById(this.options.selector.displayselection),s=document.getElementById(this.options.selector.displayresult);if(t&&s){if(!this.myFiles){const{JsMyFiles:e}=await i.e(144).then(i.bind(i,144));this.myFiles=new e(t,{enableupload:!0,enablestore:!0,btnfilelist:this.options.showfiles,upload:{label:t.dataset.uploadlabel?t.dataset.uploadlabel:"upload",callback:()=>{this.addImportPath("/tmp/ecotaxa_user.760/ecotaxa_import"),this.showSubmit()}}})}!0===e&&(()=>{let e=this.typeimport.split("-");e=e.map((e=>new Set([...filter_files[e]?filter_files[e]:[]]))),this.myFiles.container.querySelectorAll("[data-ftype]").forEach((t=>{e.has(t.dataset.ftype)?t.classList.remove("disabled"):t.classList.add("disabled")}))})()}}addImportPath(e){document.getElementById(this.options.selector.importzone).value=e;const t=document.getElementById(this.options.selector.displayresult);t&&(t.innerHTML=`<li>${e.split("/").pop()}</li>`);this.container.querySelector("#"+this.options.selector.importoptions)}showSubmit(e=!0){const t=this.container.querySelector('[type="submit"]');console.log("sub",t),e?(t.classList.remove("hide"),t.disabled=!1):t.disabled=!0}}}}]);