/*! For license information please see 265.ddcabc2ef55b14789e36.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[265],{1265:(t,e,s)=>{s.a(t,(async(t,n)=>{try{s.d(e,{JsImport:()=>d});s(9418);var i=s(8949),r=s(4860),a=s(7114),o=s(2438),l=s(3438),c=t([i,o,l]);function d(t,e={}){let n=null;if(!(t=t instanceof HTMLElement?t:document.querySelector(t)))return;e={selectors:{typeimport:"typeimport",inputname:"file_to_load",showfiles:".showfiles",importzoneid:"import-list",sourcezone:"dirlist"},url:{import:"gui/import",dirlist:"gui/files"},browse:["directory","file"],textimport:"to import",...e};let c={};c.dirlist=t.dataset.dirlist?t.dataset.dirlist:e.url.dirlist,c.import=t.dataset.import?t.dataset.import:e.url.import,e.selectors.importzoneid=t.dataset.importzoneid?t.dataset.importzoneid:e.selectors.importzoneid,e.browse=t.dataset.browse?t.dataset.browse.split(","):e.browse,e.textimport=t.dataset.textimport?t.dataset.textimport:e.textimport;t.querySelector('[type="submit"]');let d,h="select",p=document.getElementById(e.selectors.inputname);async function u(n=!1){const r=document.getElementById(e.selectors.sourcezone);if(r){if(!d){const{JsMyFiles:n}=await s.e(7).then(s.bind(s,8388));d=new n(r,{import:c.toimport,url:c.dirlist,browse:e.browse,upload:{label:r.dataset.uploadlabel?r.dataset.uploadlabel:"upload",callback:()=>{y(!1)}}}),d.eventnames.clearother="clearother",o.j.on(d.eventnames.clearother,(t=>{m()}),d.uuid),o.j.on(h,(t=>{d.detachDropzone()}),d.uuid),g(d.jsDirList,d.uuid),t.querySelectorAll("[data-import]").forEach((async t=>{t.dataset.request=t.dataset.import,await i.p.makeRequest(t),t.addEventListener("click",(t=>{y()}));const e=t.previousElementSibling||t.nextElementSibling;e&&e.dataset.summary&&e.addEventListener("click",(t=>{y(!1)})),t.jstree.entrycontrols.options.controls={},g(t.jstree,t.jstree.uuid,[l.gt.branch,l.gt.node])}));const a=t.querySelector(".js-accordion")?t.querySelector(".js-accordion"):t.querySelector(".js-tabs");a&&a.dataset.detail&&a.querySelectorAll(a.dataset.detail).forEach((t=>{t.emitevent=()=>{m()}}))}!0===n&&(()=>{let t=undefined.split("-");t=t.map((t=>new Set([...filter_files[t]?filter_files[t]:[]]))),d.container.querySelectorAll("[data-ftype]").forEach((e=>{t.has(e.dataset.ftype)?e.classList.remove("disabled"):e.classList.add("disabled")}))})()}}function m(){null!==n&&(n.setSelected(!1),n.active=!0,n.emitEvent(),n=null)}function g(t,s,i=null){const a={import:{action:"import",class:["control-select"],typentries:i||[l.gt.branch],text:e.toselect?e.toselect:"select to import",callback:function(s){n&&(delete n.label.dataset.selected,n.setSelected(!1));const i=t.getActiventry();if(n===i)return void(n=null);i.options.css.selected,i.setSelected(!0),i.label.dataset.selected=e.textimport,t.entrycontrols.showControls(!1),n=i}}};t.entrycontrols.options.controls={...t.entrycontrols.options.controls,...a};t.entrycontrols.addControl(a.import,0,(function(e){t.activentry&&t.activentry.setSelected(!1),function(t){p.value=t.getCurrentPath().join(r.hx),y()}(e),o.j.emit(h,{value:!1},s)})),t.entrycontrols.activateControl(a.import)}function y(e=!0){const s=t.querySelector('[type="submit"]');e?(s.classList.remove("hide"),s.disabled=!1):s.disabled=!0}!function(){if(!p){const s=t.dataset.importzone?t.dataset.importzone:e.selectors.importzone;let n=document.getElementById(s);null===n&&(n=(0,r.xJ)("div",{id:s},t)),p=(0,r.xJ)("input",{type:"hidden",id:e.selectors.inputname,name:e.selectors.inputname,class:"form-input",required:!0},n);const i=(0,r.xJ)("div",{class:"response-summary"},n);(0,r.xJ)("div",{id:"total-objects",class:a.AH.info,data:{text:"Total objects"}},i),(0,r.xJ)("div",{id:"total-tsv",class:a.AH.info,data:{text:"Total TSV"}},i)}}(),t.querySelectorAll('input[name="'+e.selectors.typeimport+'"]').forEach((t=>{t.addEventListener("change",(e=>{e.currentTarget.checked&&(t=e.currentTarget.value,u(!0))}))})),t.formsubmit.addHandler("submit",(async()=>""!==p.value||(alert("nothing to upload"),!1))),u()}[i,o,l]=c.then?(await c)():c,a.AH.displayimport="displayimport",n()}catch(h){n(h)}}))},3438:(t,e,s)=>{s.a(t,(async(t,n)=>{try{s.d(e,{HK:()=>h,Pc:()=>d,gt:()=>c,v3:()=>p});var i=s(4860),r=s(7114),a=s(7104),o=s(2438),l=t([a,o]);[a,o]=l.then?(await l)():l;const c=Object.freeze({node:"N",branch:"B",root:"R",discard:"D",discarded:"X"}),d={selector:"[data-name]",tags:{tag:"ul",subtag:"li",label:"span"},selectors:{entries:".entries"},draggables:[],prefix:"entry",css:{on:"on",entryN:"entryN",entryB:"entryB",entryR:"entryR",entryD:"entryD",editable:"editable",dragging:"dragging",dragover:"dragover",dragitem:"dragitem",selected:"selected"},event:{name:"eventEntry"}};class h{eventnames={attach:"attach",control:"control"};name;type;label;entries=[];event={listener:window,name:d.event.name,init:{bubbles:!1,cancelable:!0}};constructor(t,e={}){return this.name=t.name,this.type=t.type,this.id=t.id,this.parent=t.parent,this.options={...d,...e},this.uuid=(0,i.UP)(),this.eventnames={...this.eventnames,...this.options.eventnames},this.label=e.label?e.label:null,this.event={name:d.event.name,listener:e.listener?e.listener:this.uuid},this.init(t),this}init(t){const e={name:this.name,type:this.type};null!==this.label&&(e.label=this.label);const s=(0,i.xJ)(this.options.tags.subtag,{draggable:this.isDraggable(),dataset:e}),n=`${this.options.prefix}${this.type}`;this.label=(0,i.xJ)(this.options.tags.label,{class:n,text:t.label?t.label:t.name},s),this.container=s,this.initEvents()}initEvents(){}getParent(){return this.parent}getLabelElement(){return this.label}getParentElement(){return this.container.parentElement.closest(this.options.selector)}getEntries(){return this.entries}getEntriesElement(t=!1){let e=this.container.querySelector(this.options.selectors.entries);return t&&null===e?(0,i.xJ)(this.options.tags.tag,{class:this.options.selectors.entries.substr(1)},this.container):e}appendEntry(t){if(t.parent&&t.parent.entries){const e=t.parent.entries.indexOf(t);delete t.parent.entries[e]}t.parent=this,this.entries.push(t);return this.getEntriesElement(!0).append(t.container),t}newEntry(t){return new h(t,this.options)}setAttributes(t){return t}extraStyles(t){}setDiscard(){}createEntry(t){this.options.css.icons=[],t=this.setAttributes(t),this.extraStyles(t);const e=this.newEntry(t,this.options);return this.appendEntry(e),e.addListeners(),e.setDiscard(),e}findEntry(t){const e=this.getEntries();for(const s of e)if(s.name===t)return s;return null}createListEntries(t){this.getEntriesElement(!0);t.forEach((t=>{t.forEach((t=>{this.createEntry(t)}))}))}removeEntries(){this.entries=[];const t=this.getEntriesElement();t&&t.remove()}isActive(){return this.active}toggleActive(){this.active=!this.active,this.container.classList.toggle(this.options.css.on)}setSelected(t=!0){const e=this.options.css.selected;!0===t?this.container.classList.add(e):this.container.classList.remove(e),this.setOn(t)}setOn(t=!0){this.active=t,!0===t?this.container.classList.add(this.options.css.on):this.container.classList.remove(this.options.css.on)}setOff(){this.setSelected(!1)}getListeners(){let t=[];let e=t=>{t.stopImmediatePropagation(),this.branchListener((()=>{this.emitEvent(this.eventnames.attach)}))};return[c.root,c.discard].indexOf(this.type)<0&&this.type===c.node&&(e=t=>{t.stopImmediatePropagation(),this.toggleActive(),this.emitEvent()}),t.unshift({name:"click",target:"label",func:e}),t}isBranch(t=!0){const e=[c.branch];return t&&e.indexOf(c.root)<0&&e.push(c.root),e.indexOf(this.type)>=0}isDiscarded(){return[c.discard,c.discarded].indexOf(this.type)>=0}emitEvent(t=null,e=null){const s={entry:this};t&&(s.action=t),e?s.event=e:e=this.eventnames.control,o.j.emit(this.event.name,s,this.event.listener)}moveHandlers(){return[{name:"dragstart",func:t=>{this.handleDragStart(t)}},{name:"dragend",func:t=>{this.handleDragEnd(t)}}]}dropHandlers(){return[{name:"dragover",func:t=>{this.handleDragOver(t)}},{name:"drop",func:t=>{this.handleDrop(t)}}]}branchListener(t=null){this.toggleActive(),this.isActive()&&this.branchActivate(t).then((()=>{this.emitEvent()}))}addListeners(){const t=this.getListeners();for(const e of t){("label"===e.target?this.getLabelElement():this.container).addEventListener(e.name,e.func)}}removeListeners(t){for(const e in t){("label"===e.target?this.getLabelElement():this.container).removeEventListener(e.label,e.func)}}destroy(){this.container.remove()}handleDragStart(t){t.stopImmediatePropagation(),this.container.classList.add(this.options.css.dragging),t.dataTransfer.effectAllowed="move",this.emitEvent("dragstart",t)}handleDragOver(t){t.stopPropagation(),t.preventDefault(),this.emitEvent("dragover",t)}handleDragEnd(t){t.stopPropagation(),t.preventDefault(),this.container.classList.remove(this.options.css.dragging),this.emitEvent("dragend",t)}resetDragOver(){document.querySelectorAll("."+this.options.css.dragover).forEach((t=>{t.classList.remove(this.options.css.dragover)}))}handleDrop(t){t.stopImmediatePropagation(),this.emitEvent("drop",t)}setWait(){this.loaded=this.container.dataset.loaded=!1,this.container.classList.add(r.AH.wait)}setLoaded(){this.container.classList.remove(r.AH.wait),this.loaded=this.container.dataset.loaded=!0}findEntry(t,e){const s=this.getEntries();for(const n of s)if(n.name===t&&n.type===e)return n;return null}async branchActivate(t=null){this.loaded?t&&t(this):this.list().then((()=>{t&&t(this)}))}getCurrentPath(){const t=(e,s=[])=>e.name&&(s.push(e.name),null!==(e=e.getParent()))?t(e,s):s;let e=t(this);return e.length>1&&(e=e.reverse()),e}async jsonEntries(t){return await t.json()}isDraggable(){return this.options.draggables&&this.options.draggables.indexOf(this.type)>=0}async list(){if(this.type===c.node)return;const t=this.getUrl?this.getUrl():null;if(null===t)return;this.options.tags.tag,this.options.tags.subtag;this.setWait(),this.removeEntries();const e={headers:new Headers({"content-type":"application/json"})},s=await fetch(t,(0,i.Uc)(e));if(s.ok){const t=await this.jsonEntries(s);if(t.length){let e=[],s=[];for(;t.length>0;){const n=t.shift();!1===n.children?e.push(n):s.push(n)}e.sort(((t,e)=>t.name<e.name)),s.sort(((t,e)=>t.name<e.name)),this.createListEntries([s,e])}this.setLoaded()}else a.y.addMessage({parent:this.container,type:"error",content:s.error+" "+s.text})}moveTo(t){const e=t.getCurrentPath(),s=t.type===c.discard?c.discarded:t.type;e.pop(),e.forEach(((e,n)=>{let i=t.findEntry(e,s);null===i&&(i=t.createEntry({type:s,name:e})),t=i})),null===t.findEntry(this.name,this.type)&&(this.from=this.parent,t.appendEntry(this))}unMove(){this.from&&(this.moveTo(this.from),this.from=null)}}function p(t=document,e={}){let s,n=null;function a(t,e=null,r=null){const a=(0,i.xJ)("span",t.class?{class:t.class}:{}),o=s.children.length;if(null===e||o<e+1?s.append(a):0===e||0===o?s.prepend(a):s.inserBefore(crtl,s.children[e]),t.typentries&&(a.dataset.typentries=t.typentries),t.icon){(0,i.xJ)("i",{class:["icon",t.icon]},a);a.dataset.title=t.text}else a.textContent=t.text;const l=t.trigger?t.trigger:"click";a.addEventListener(l,(e=>{if(null===n)return;const s={callback:()=>{console.log("done",t.action)}};n[t.action]||null===r?n[t.action]&&n[t.action](s):r(n),t.callback&&t.callback(e)})),t.ctrl=a}function o(){null!==n&&(n.container.classList.remove(e.selectors.hascontrols.substr(1)),s.classList.add(r.AH.hide),s.disabled=!0,t.append(s),n=null)}function l(t,e=!1){const s=t.ctrl,i=s.dataset.typentries?s.dataset.typentries.split(","):[],a=e?c.discarded:n.container.dataset.type;i.indexOf(a)>=0?s.classList.remove(r.AH.hide):s.classList.add(r.AH.hide)}function d(){if(null===n)return;const t=n.isDiscarded();Object.values(e.controls).filter((t=>t.icon||t.text)).forEach((e=>{l(e,t)}))}return e=Object.assign({selectors:{typentries:"[data-typentries]",hascontrols:".has-controls"},controls:{list:{action:"list",typentries:["B","T"]}},css:{entrycontrols:"entrycontrols",entries:".entries"}},e),s=(0,i.xJ)("div",{class:[e.css.entrycontrols,r.AH.hide]}),Object.values(e.controls).filter((t=>t.icon||t.text)).forEach((t=>{a(t)})),{options:e,addControl:a,attachControls:function(t){o(),n=t,n.container.prepend(s),n.container.classList.add(e.selectors.hascontrols.substr(1)),d(),s.classList.remove(r.AH.hide),delete s.disabled},detachControls:o,showControls:function(t=!0){!0===t?s.classList.remove(r.AH.hide):s.classList.add(r.AH.hide),s.disabled=!t},activateControls:d,activateControl:l}}n()}catch(u){n(u)}}))}}]);