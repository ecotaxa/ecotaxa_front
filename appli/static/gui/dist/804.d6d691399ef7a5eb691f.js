/*! For license information please see 804.d6d691399ef7a5eb691f.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[804,615],{615:(e,t,i)=>{i.d(t,{FormSubmit:()=>d});var s=i(7856),a=i.n(s),n=i(2817),o=i(9162);const r="input-invalid",l="input-valid";n.EY.captcha=".js-captcha";class d{handlers=[];form=null;listener=null;constructor(e,t={}){if(e){if(!e.formsubmit){this.form=e instanceof HTMLElement?e:document.querySelector(e);const i={fetch:null};if(t=Object.assign(t,this.form.dataset),this.options=Object.assign(i,t),!this.form)return;this.tabs=this.form.querySelectorAll(n.EY.component.tabs.tab),this.validateFields(!0),this.init(),e.formsubmit=this}return e.formsubmit}}init(){this.form.addEventListener("keypress",(e=>{"Enter"===e.key&&e.target instanceof HTMLInputElement&&e.preventDefault()})),this.form.addEventListener("submit",(async e=>{e.preventDefault();return await this.submitForm()})),this.specialFields()}specialFields(){this.form.querySelectorAll("input[data-match]").forEach((e=>{const t=e.dataset.match;if(!t)return;const i=document.getElementById(t);if(!i)return;const s=e.dataset.matchinvalid?e.dataset.matchinvalid:"no match",a=(t,a)=>{const n=e.previousElementSibling&&"label"==e.previousElementSibling.tagName.toLowerCase()?e.previousElementSibling:null,o=i.previousElementSibling&&"label"==i.previousElementSibling.tagName.toLowerCase()?i.previousElementSibling:null,{patternMismatch:d=!1}=t.validity,c=d?this.get_message(t,"invalid"):"";!0===t.checkValidity()?(t.dataset.invalid="",t.setCustomValidity(""),t==e&&null!==n?n.classList.remove(r):null!==o&&o.classList.remove(r),t.classList.remove(l),t.value!==a.value?(e.setCustomValidity(s),n&&(n.dataset.invalid=n.dataset.invalid?n.dataset.invalid:s,n.classList.add(r)),e.classList.add(l)):(e.setCustomValidity(""),n&&n.classList.remove(r),e.classList.remove(l))):(t.setCustomValidity(c),t.dataset.invalid=c,n&&n.classList.add(r),t.classList.add(l)),t.focus()};[e,i].forEach((t=>{t.addEventListener("keyup",(s=>{a(t,t===e?i:e)}))}))}))}get_message(e,t="invalid"){if(0==e.checkValidity()){const{valueMissing:i=!0}=e.validity;return i?"* "+(e.dataset.required?e.dataset.required:this.form.dataset.required?this.form.dataset.required:"required"):e.dataset[t]?e.dataset[t]:"input invalid"}return""}validateField(e,t=!1){["textarea","input"].indexOf(e.tagName.toLowerCase()),["select",'input[type="checkbox"]'].indexOf(e.tagName.toLowerCase())>=0?e.querySelectorAll("option:checked").forEach((e=>{e.value=(0,o.Tv)(a().sanitize(e.value))})):e.value=(0,o.Tv)(a().sanitize(e.value));const i=e.checkValidity(),s=this.getFieldLabel(e);return s&&(i?s.classList.remove(r):i||(s.dataset.invalid=this.get_message(e),s.classList.add(r),window.scrollTo({top:parseInt(s.offsetTop),left:parseInt(s.offsetLeft),behavior:"smooth"}))),i}getFieldLabel(e){return e.closest(".form-box")?e.closest(".form-box").querySelector(".label")?e.closest(".form-box").querySelector(".label"):e.closest(".form-box").querySelector("label"):null}validateFields(e=!1){let t=!0;return[...this.form.elements].forEach((i=>{if(i.name)if(!0===e){if(!i.dataset.listen){if(i.hasAttribute("required")&&i.required){const e=this.getFieldLabel(i);e&&e.classList.add("required")}["change","blur"].forEach((t=>{i.addEventListener(t,(t=>{this.validateField(t.currentTarget,e)}))})),i.dataset.listen=!0}}else t=t&&this.validateField(i,e)})),this.tabs.forEach((e=>{e.querySelector(":invalid")||e.querySelector(n.EY.component.alert.danger)?e.classList.add(n.iv.error):e.classList.remove(n.iv.error)})),t}addHandler(e){this.handlers.push(e)}fieldEnable(e=!0){this.form.querySelectorAll('input[data-sub="enable"]').forEach((t=>{t.disabled=!0!==e}))}async submitHandler(){if(!this.validateFields())return!1;if(0===this.handlers.length)return!0;let e=!0;return await Promise.all(this.handlers.map((async t=>{const i=await t();e=e&&i}))),!0===e&&(this.handlers=[]),e}formFetch(e=null){const t=new FormData(this.form);return t.fetch=!0,fetch(this.form.action,(0,o.wv)({method:"POST",body:t})).then((t=>{switch(e){case"text":case"html":return t.text();default:return t.json()}})).then((e=>{this.displayResponse(e)})).catch((e=>{this.displayResponse(e,!0)})).finally((e=>{this.form.disabled=!0})),!1}async submitForm(){if(this.fieldEnable(),this.validateFields(!1)){if(!0===(!!this.form.querySelector(n.EY.captcha)&&(!this.form.dataset.isbot||!0===this.form.dataset.isbot)))return!1;return!!await this.submitHandler()&&(this.options.fetch?this.formFetch(this.options.fetch):this.form.submit(),this.form.disabled=!0,!0)}return!1}displayResponse(e,t=!1){const i=document.createElement("div");i.insertAdjacentHTML("afterbegin",e),!1!==t&&i.classList.add("is-error"),this.form.parentElement.insertBefore(i,this.form),this.form.remove()}}},8804:(e,t,i)=>{i.d(t,{JsUpload:()=>r});i(7856);var s=i(3778),a=(i(615),i(9162),i(2817));const n=new Set(["zip","gz","png","jpg","jpeg","pdf","doc","docx","ppt","pptx","xls","xlsx","heic","heif","7z","bz2","rar","gif","webp","webm","mp4","mov","mp3","aifc"]);let o=null;class r{zipstream;zipsize=0;pathname;zipname;numfiles=0;sizefiles=0;zipparts=[];counter=0;counterdisplay=null;ziptrigger=null;displaylist=null;timer=0;targetdir="";sent=!1;dropzone;root=".";constructor(e,t=null,i={}){if(o)return o;if(!(e=e instanceof HTMLElement?e:document.querySelector(e)))return;this.container=e,this.callback=t;return this.options=Object.assign({level:0,url:"https://localhost:8000/my_files/",filefield:"file",selector:{makezip:".makezip",droptarget:".droptarget",trigger:".trigger",uploadfile:"uploadfile",formu:"formupload",stepper:"stepper",stepitem:"stepper-item",filetoload:"file_to_load",progress:"progress-upload"},display:{dropzone:"dropzone",counter:"counter",size:"sizetozip",counterzipped:"counterzipped",sizezipped:"sizezipped",dirlist:"dirlist",boxtitle:"boxtitle",timer:"timer"},css:{enabled:"enabled"}},i),this.init(e),o=this,o}init(e){this.dropzone=document.createElement("div"),this.dropzone.id=this.options.display.dropzone,this.dropzone.innerHTML=`<input type="file" class="hidden"  name="${this.options.selector.uploadfile}" id="${this.options.selector.uploadfile}">\n            <div class="${this.options.selector.droptarget.slice(1)}">\n            <div id="${this.options.display.boxtitle}"><span class="${this.options.selector.trigger.slice(1)}">${this.container.dataset.textbrowse}</span>  ${this.container.dataset.textdrop}</div>\n          </div><div><span id="${this.options.display.counter}"></span>/<span id="${this.options.display.counterzipped}"></span></div>\n          <div><span id="${this.options.display.size}"></span>/<span id="${this.options.display.sizezipped}"></span></div><div id="${this.options.display.timer}"></div>\n          <div id="${this.options.selector.makezip.slice(1)}" class="button ${this.options.selector.makezip.slice(1)} ${a.iv.hide} "><div id="${this.options.selector.progress}"></div>${e.dataset.ended}</div>`,e.append(this.dropzone),this.counterdisplay=document.getElementById(this.options.display.counter),this.counterzippeddisplay=document.getElementById(this.options.display.counterzipped),this.sizedisplay=document.getElementById(this.options.display.size),this.sizezippeddisplay=document.getElementById(this.options.display.sizezipped),this.ziptrigger=e.querySelector(this.options.selector.makezip),this.displaylist=document.getElementById(this.options.display.dirlist);const t=this.container.querySelector(this.options.selector.droptarget);t.addEventListener("dragover",(e=>{this.handleDragOver(e)})),t.addEventListener("drop",(async e=>{this.handleDrop(e)})),e.querySelector(this.options.selector.trigger).addEventListener("click",(e=>{let t=e;this.openDirDialog(".tsv,.png,.jpg, .jpeg,.zip,.gz,.7z,.bz2",(e=>{console.log("edrop",t)}))}))}attachDropzone(e){console.log("attch",e),this.targetdir=e.parentElement.dataset.name?e.parentElement.dataset.name:"",console.log("targetdir",this.targetdir),this.dropzone.classList.add(this.options.css.enabled),console.log("att",this.dropzone),e.append(this.dropzone)}detachDropzone(){this.targetdir=null,this.container.classList.remove(this.options.css.enabled)}openDirDialog(e,t){const i=document.createElement("input");i.type="file",i.directory=!0,i.multiple=!0,i.webkitdirectory=!0,i.allowdirs=!0,i.accept=e,i.addEventListener("change",t),i.dispatchEvent(new MouseEvent("click"))}handleDragOver(e){e.preventDefault(),e.dataTransfer.dropEffect="move"}async handleDrop(e){let t;e.dataTransfer?(e.preventDefault(),t=e.dataTransfer):t=e,this.timer=new Date,console.log("dataTransfer ",t.items);const i=[...t.items?t.items:t.files];if(i.length){this.enableDropzone(!1),this.zipname="_upload.zip",this.zip=new s.sZ,this.zipReadableStream=await this.fflToStream();const e=async()=>{this.timer=(new Date-this.timer)/1e3,console.log("item-------------------------------------"+parseInt(this.timer/60)+" --- "+(this.timer-60*parseInt(this.timer/60)),this.zip),this.enableDropzone(),this.zip.end(),this.ziptrigger.classList.remove(a.iv.hide),this.ziptrigger.addEventListener("click",(async e=>(this.ziptrigger.disabled=!0,console.log("upload click"),this.enableDropzone(!1,!0),await this.sendZip())))};for(let t=0;t<i.length;t++){let s=i[t].webkitGetAsEntry();!0===s.isDirectory?(this.zipname=s.name+this.zipname,await this.readDirectory(s,this.root,e)):s.isFile}}}stopOnError(e){console.log("err",e)}enableDropzone(e=!0,t=!1){t&&this.dropzone.classList.add(a.iv.hide),e?this.dropzone.classList.add(this.options.css.enabled):this.dropzone.classList.remove(this.options.css.enabled)}async supportsRequestStreams(){let e=!1;const t=new Request(this.options.url,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}fileType(e){const t=new Uint8Array(e);let i=[];for(let e=0;e<4;e++)i.push(t[e].toString(16));return{input:t,mimetype:(e=>{switch(e){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip";case"EFBBBF22":return"text/tsv";default:return console.log("unknownsign",e),"unknown"}})(e=i.join("").toUpperCase())}}async fflToStream(){const e=this.zip;(new TransformStream).writable.getWriter();return new TransformStream({start(t){e.ondata=(e,i,s)=>{if(e)return console.log("error",e),!1;t.enqueue(i),s&&console.log("final",s)}},flush(e){console.log("terminate ffstrem"),e.terminate()}})}async readDirectory(e,t,i,a=null){console.log("read",e.name);const o=this;let r=!1,l=[],d=[],c=[];const p=a||(e=>{console.log("on_error",e),r||(r=!0)}),h=async function(){const t=c.shift(),i=t.fullPath.slice(1),a=i.slice(i.lastIndexOf(".")+1);o.numfiles++,1===o.numfiles&&fetch(o.options.url.replace("my_files","stream_my_files"),{mode:"cors",method:"POST",credentials:"include",headers:{"Content-Type":"application/zip"},body:o.zipReadableStream.readable,duplex:"half"}).then((e=>{console.log("response",e)})),await t.file((async t=>{const r=n.has(a)?new s.Ud(i):t.size>5e4?new s.wL(i,{level:9}):new s.Tf(i,{level:6});return r.ondata=async function(t,i,s){t?console.log("err add chunk to zipfile"+i,t):s&&(c.length?(console.log("files",c.length),await h()):(console.log("lastfile",e.name),await m()))},await o.zip.add(r),await async function(e,t){const i=e.stream().getReader();for(;;){const{done:e,value:s}=await i.read();if(e)return await t.push(new Uint8Array(0),!0),e;await t.push(s)}}(t,r)}))},u=function(){const e=l.shift();e.isFile?(o.counter++,o.counterdisplay.textContent=o.counter,c.push(e),o.counter--,o.counterdisplay.textContent=o.counter):e.isDirectory&&(console.log("entry is dir",e),d.push(e)),l.length&&u()},m=async function(){for(const t of d)console.log(t),await o.readDirectory(t,e,(async function(){console.log("idir",t.name),c.length&&await h()}))},f=e.createReader(),g=async function(t){t.length&&!r?(l=[...l,...t],await f.readEntries(g,p)):r?console.log("treat error readdir"):(u(),console.log("theend------------------- "+e.name,l.length),await m())};await f.readEntries(g,p),console.log("enddir"+e.name,l.length)}compressionLevel(e){if(!e)return-1;let t=e.split(".");return t=t.length>1?t[t.length-1]:t[0],n.find((e=>e===t))?2:this.options.level}async sendZip(){}}}}]);