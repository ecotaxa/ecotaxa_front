/*! For license information please see 57.b6df329f4dcc5dd75f4d.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[57],{2057:(e,t,s)=>{s.d(t,{JsTomSelect:()=>f});var n=s(7856),i=s.n(n),a=s(6031),o=s.n(a),l=s(2651),r=s.n(l),d=s(4555),c=s.n(d),p=s(4775),u=s.n(p),m=s(7737),g=s(2817);o().define("remove_button",r()),o().define("clear_button",c()),o().define("caret_position",u());let h={};function v(e,t,s=!1){if(!t)return e.text;let n=[];return Object.keys(e).indexOf(t)>=0?n.push(e[t]):t.indexOf("+")>0&&(!0===s?n.push(e[t.split("+")[0]]):t.split("+").forEach((t=>{t in e&&n.push(e[t])}))),n.join(" ")}class f{applyTo(e,t={},s=null){const n=e.getAttribute("id"),a=e.hasAttribute("multiple"),l=e.dataset.type;let r={url:"",settings:t};switch(e.dataset.create&&"true"===e.dataset.create&&(r.settings.create=!0,r.settings.addPrecedence=!0),e.dataset.empty&&"true"===e.dataset.empty&&(r.settings.allowEmptyOption=!0),e.dataset.maxitems&&(r.settings.maxItems=parseInt(e.dataset.maxitems)),e.dataset.addoption&&(r.settings.addoption=e.dataset.addoption.split(",")),l){case g.Cq.project:const t=a?null:1;r.url="/gui/prjlist/",r.settings={...r.settings,valueField:"id",searchField:"text",labelField:"text",openOnFocus:!1,maxItems:t,allowEmptyOption:!1};break;case g.Cq.user:r.url="/api/users/search?by_name=",r.settings={...r.settings,valueField:"id",searchField:"name",labelField:"name+email",onInitialize:function(){e.currentlist?h=e.currentlist:e.tomselect.items.forEach((e=>{""!==e&&parseInt(e)>0&&(h[e]=!0)}))},onItemAdd:function(t){""!==t&&(h[t]?(window.alertbox?(console.log("itemtoms",e),window.alertbox.addItemMessage({type:window.alertbox.alertconfig.types.danger,parent:e,content:window.alertbox.i18nmessages.exists})):(e.dataset.invalid=window.alertbox.i18nmessages.exists,e.dispatchEvent(new Event("invalid"))),setTimeout((()=>{if(this.removeOption(t),this.revertSettings.tabIndex<0||!e.options.length||!this.revertSettings)this.removeItem(t),h[t]=!0;else{const t=e.options[this.revertSettings.tabIndex].value;this.addItem(t)}window.alertbox?window.alertbox.removeItemMessage({type:window.alertbox.alertconfig.types.danger,parent:e,content:window.alertbox.i18nmessages.exists}):(delete e.dataset.invalid,e.dispatchEvent(new Event("undeterminate")))}),2e3)):h[t]=!0)},onItemRemove:function(t){if(h[t]&&delete h[t],a||!this.revertSettings||""===this.revertSettings.innerHTML&&0===this.revertSettings.tabIndex||this.revertSettings.tabIndex<0)return;const s=e.options[this.revertSettings.tabIndex].value;void 0!==h[s]&&delete h[s]}};break;case g.Cq.instr:r.url="/search/instruments",r.settings={valueField:"id",labelField:"text",searchField:"id",maxItems:1,preload:!0};break;case g.Cq.taxo:o().define("no_close",(()=>{this.close=()=>{}})),r.url="/search/taxo",r.settings={...r.settings,valueField:"id",labelField:"text",searchField:"text",closeAfterSelect:!0,onInitialize:()=>{const t=document.getElementById(n).nextElementSibling;if(!t.classList.contains("ts-wrapper"))return;t.querySelectorAll(g.EY.component.tomselect.tsdelet).forEach((t=>{(t=>{t.addEventListener("click",(t=>{const s=t.currentTarget.closest(g.EY.component.tomselect.item).dataset.value;s&&(t.stopImmediatePropagation(),e.tomselect.removeItem(s))}))})(t)}))}}}const d={create:!1,minOptions:0,maxOptions:null,preload:!1,hideSelected:!0,duplicates:!1,allowEmptyOption:!0,closeAfterSelect:!0,placeholder:e.placeholder?e.placeholder:e.dataset.placeholder?e.dataset.placeholder:"",onDropdownClose:function(){},shouldLoad:function(e){return e.length>2},onItemRemove:function(){return!0},load:function(e,t){e=i().sanitize(e);if(this.loading>10)return void t();let s="";switch(l){case g.Cq.user:s=r.url+encodeURIComponent("%"+e+"%");break;case g.Cq.instr:case g.Cq.taxo:if(s=r.url,0==e.indexOf("_")&&r.settings.addoption&&e==r.settings.addoption[0])return s=null,t(Object.entries([{text:r.settings.addoption[0],id:r.settings.addoption[1]}]));e&&(s+="?q="+encodeURIComponent(e));break;case g.Cq.project:s=r.url,e&&(s+="?filt_title="+encodeURIComponent(e))}null!==s&&fetch(s,(0,m.wv)()).then((e=>e.json())).then((e=>(l===g.Cq.project&&e.data&&e.data.length&&(e=e.data.map((e=>({id:e[1],text:e[3][0],rights:e[0]})))),l===g.Cq.instr&&e.length&&(e=e.reduce(((e,t,s)=>{let n={id:t=i().sanitize(t),text:t};return e.push(n),e}),[])),e.length&&"object"==typeof e&&(e=Object.entries(e)),t(e)))).catch((e=>{console.log("tomselect-err",e)}))},render:{option:function(e,t){if(null==e)return"";const s=e.hasOwnProperty("optgroup")?`data-optgroup=${e.optgroup}`:"",n=v(e,r.settings.labelField);return`<div class="py-2 flex  ${a?"inline-flex":""} " ${s} data-value="${e[r.settings.valueField]}">${t(n)}</div>`},item:function(e,t){if(null==e)return"";const s=e.optgroup?`item-${e.optgroup}`:"",n=h[e[this.settings.valueField]]?"data-inlist":"",o=v(e,r.settings.labelField,!0);return i().sanitize(`<div class="${a?"flex inline-flex ":""} ${s}"  data-value="${e[this.settings.valueField]}"  ${n}>${t(o)} </div>`)},no_results:function(t,s){return i().sanitize('<div class="no-results">'+(e.dataset.noresults?e.dataset.noresults:"No result found for ")+s(t.input)+"</div>")}}};if(r.settings.plugins={clear_button:{title:e.dataset.clear?e.dataset.clear:"Clear all",html:e=>`<div class="${e.className}" id="clear-${n}" title="${e.title}"><i class="icon ${a?"":"p-[0.125rem]"} icon-x-circle-sm ${a?"":" opacity-50"}"></i></div>`}},r.settings.onClear=function(){return e.tomselect.clear(),!0},a&&(r.settings.plugins={...r.settings.plugins,remove_button:{}},r.settings.plugins={...r.settings.plugins,caret_position:{}}),r.settings=Object.assign(d,r.settings),null!==n){const t=new(o())("#"+n,r.settings);switch(t.wrapper.classList.remove(g.EY.component.tomselect.ident),t.wrapper.classList.remove("js"),t.wrapper.setAttribute("data-component","tom-select"),l){case g.Cq.taxo:t.on("item_add",((e,t)=>{null!==t&&t.classList.add("new")}));break;case g.Cq.project:e.dataset.dest&&t.on("item_add",((s,n)=>{if(s!=e.dataset.value&&t.options[s]&&!n.querySelector("a")){const e={A:"/prj/",V:"/prj/",M:"/gui/prj/edit/"},i=t.options[s].rights,a=Object.keys(i);a&&(a.length>1?(Object.entries(i).forEach((([e,t])=>{n.insertAdjacentHTML("beforeend",` <a data-k="${e}" class="small-caps font-normal ml-2">${t}</a>`)})),n.querySelectorAll("a").forEach((n=>{n.addEventListener("click",(n=>{n.preventDefault(),n.stopPropagation(),window.open(e[n.target.dataset.k]+s,`_proj${s}`).focus(),t.removeItem(s)}))}))):(window.open(e[a[0]]+s,`_proj${s}`).focus(),t.removeItem(s)))}}))}return t}console.log("noid")}getUserList(){return h}}}}]);