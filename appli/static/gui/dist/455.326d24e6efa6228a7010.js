/*! For license information please see 455.326d24e6efa6228a7010.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[455,555],{8555:(e,t,s)=>{s.a(e,(async(e,i)=>{try{s.d(t,{FormSubmit:()=>c});var a=s(2838),n=s.n(a),o=s(7114),r=s(4860),l=s(7104),d=e([l]);l=(d.then?(await d)():d)[0],o.Do.captcha=".js-captcha",o.Do.formbox=".form-box",o.Do.messagepos=".messagepos",o.AH.invalid="invalid",o.AH.inputvalid="valid",o.AH.required="required",o.AH.tshidden="ts-hidden-accessible";class c{handlers={validate:[],submit:[]};form=null;listener=null;constructor(e,t={}){if(e){if(!e.formsubmit){this.form=e instanceof HTMLElement?e:document.querySelector(e);const s={fetch:null};if(t=Object.assign(t,this.form.dataset),this.options=Object.assign(s,t),!this.form)return;this.tabs=this.form.querySelectorAll(o.Do.component.tabs.tab),this.validateFields(!0),this.init(),e.formsubmit=this}return e.formsubmit}}init(){this.form.addEventListener("keydown",(e=>{"Enter"===e.key&&e.target instanceof HTMLInputElement&&e.preventDefault()})),window.addEventListener("pageshow",(e=>{(event.persisted||void 0!==window.performance&&2===window.performance.navigation.type)&&this.enableForm()})),this.form.addEventListener("validate",(e=>{this.validateFields()})),this.form.addEventListener("submit",(async e=>{e.preventDefault();return await this.submitForm()})),this.hotModifs(),this.specialFields()}hotModifs(){this.form.querySelectorAll("[data-hotmodif]").forEach((e=>{const t="input"==e.tagName.toLowerCase()&&"text"===e.type?"keydown":"change",s=e.dataset.modifmessage?e.dataset.modifmessage:this.options.modifmessage;let i=e.closest(o.Do.formbox);i=i||e.closest(o.Do.messagepos),e.addEventListener(t,(()=>{l.y.addMessage({type:l.y.alertconfig.types.warning,parent:i,content:s,duration:4e3})}))}))}specialFields(){this.form.querySelectorAll("input[data-match]").forEach((e=>{const t=e.dataset.match;if(!t)return;const s=document.getElementById(t);if(!s)return;const i=e.dataset.matchinvalid?e.dataset.matchinvalid:"no match",a=(t,s)=>{const a=t.closest(o.Do.component.form.formbox).querySelector('label[for="'+t.id+'"]'),n=s.closest(o.Do.component.form.formbox).querySelector('label[for="'+s.id+'"]'),{patternMismatch:r=!1}=t.validity,l=r?this.getMessage(t,"invalid"):"";!0===t.checkValidity()?(t.setCustomValidity(""),t==e&&null!==a?a.classList.remove(o.AH.invalid):null!==n&&n.classList.remove(o.AH.invalid),t.classList.remove(o.AH.invalid),t.value!==s.value?(s.setCustomValidity(i),n&&(n.dataset.invalid=i,n.classList.add(o.AH.invalid)),s.classList.add(o.AH.invalid)):(s.setCustomValidity(""),n&&n.classList.remove(o.AH.invalid),s.classList.remove(o.AH.invalid))):(t.setCustomValidity(l),a.dataset.invalid=l,a&&a.classList.add(o.AH.invalid),t.classList.add(o.AH.invalid)),t.focus()};[e,s].forEach((t=>{t.addEventListener("keyup",(i=>{a(t===e?e:s,t===e?s:e)}))}))}))}getMessage(e,t="invalid"){const{valueMissing:s=!0}=e.validity;return s?"* "+(e.dataset.required?e.dataset.required:this.form.dataset.required?this.form.dataset.required:e.validationMessage?e.validationMessage:"required"):e.dataset[t]?e.dataset[t]:e.validationMessage?e.validationMessage:"input invalid"}setLabelState(e,t){const s=this.getFieldLabel(e);if(null!=s)if(!0===t)s.classList.remove(o.AH.invalid);else{s.dataset.invalid=this.getMessage(e),s.classList.add(o.AH.invalid);const t=s.getBoundingClientRect(),i=t.left,a=t.top;window.scrollTo({top:a,left:i,behavior:"smooth"})}}validateField(e,t=!1){["select"].indexOf(e.tagName.toLowerCase())>=0?e.querySelectorAll("option:checked").forEach((e=>{e.value=(0,r.c6)(n().sanitize(e.value))})):e.value=(0,r.c6)(n().sanitize(e.value));let s=e.checkValidity();if(e.tomselect&&e.classList.add(o.AH.tshidden),s&&void 0!==e.dataset.unique)s=this.validateFieldUnique(e);else if("checkbox"==e.type&&(s=!0,e.required)){(e.name?e.closest("div").querySelectorAll(e.name):[e]).forEach((t=>{s=s||e.checkValidity(t)}))}const i=document.createEvent("Event");return i.initEvent(s?"valid":"invalid",!0,!0),e.dispatchEvent(i),s}getFieldLabel(e){let t=e.closest('[for="'+e.name+'"]')?e.closest('[for="'+e.name+'"]'):e.closest('[data-for="'+e.name+'"]')?e.closest('[data-for="'+e.name+'"]'):null;return null===t&&(t=e.closest(o.Do.component.form.formbox)?e.closest(o.Do.component.form.formbox).querySelector(".label")?e.closest(o.Do.component.form.formbox).querySelector(".label"):e.closest(o.Do.component.form.formbox).querySelector("label"):null),null===t&&(t=e.parentElement&&e.parentElement.dataset.elem&&e.closest("fieldset")?e.closest("fieldset").querySelector("."+e.parentElement.dataset.elem):null),t}validateFieldUnique(e){const t=this.getFieldLabel(e);if(String(e.dataset.unique).toLowerCase()===String(e.value).toLowerCase()){t&&(t.dataset.confirm=l.y.i18nmessages.noduplicate,t.classList.add(l.y.alertconfig.css.confirm));const s=function(){e.dataset.unique=!1,t&&(t.classList.remove(l.y.alertconfig.css.confirm),delete t.dataset.confirm)};return l.y.addConfirm((t?t.textContent+" : ":"")+l.y.i18nmessages.noduplicate,{callback_cancel:s,buttons:{ok:{text:l.y.i18nmessages.modify},cancel:{text:l.y.i18nmessages.saveanyway}}})}return t.dataset.confirm&&(t.classList.remove(l.y.alertconfig.css.confirm),delete t.dataset.confirm),!0}async validateFields(e=!1){let t=!0,s=!0;return[...this.form.elements].forEach((i=>{if(!0===e){if(!i.dataset.listen){if(i.required){const e=this.getFieldLabel(i);e&&e.classList.add(o.AH.required)}i.addEventListener("change",(e=>{this.validateField(e.target)})),i.dataset.listen=!0,i.addEventListener("invalid",(e=>{this.setLabelState(i,!1)})),i.addEventListener("valid",(e=>{this.setLabelState(i,!0)}))}}else i.name&&i.type&&["submit","hidden"].indexOf(i.type)<0&&(["radio","checkbox"].indexOf(i.type)<0||i.required)&&(s=this.validateField(i,!1),t=t&&s)})),!1===e&&(this.tabs.forEach((e=>{e.querySelector(":invalid")||e.querySelector(o.Do.component.alert.danger)?e.classList.add(o.AH.error):e.classList.remove(o.AH.error)})),s=await this.execHandler("validate")),s&&t}addHandler(e,t){this.handlers[e].push(t)}fieldEnable(e=!0){this.form.querySelectorAll('input[data-sub="enable"]').forEach((t=>{t.disabled=!0!==e}))}async execHandler(e){if(0===this.handlers[e].length)return!0;let t=!0;return await Promise.all(this.handlers[e].map((async e=>{const s=await e();t=t&&s}))),t}async formFetch(e=null){const t=new FormData(this.form);t.fetch=!0;let s=await fetch(this.form.action,(0,r.Uc)({method:"POST",body:t})).catch((e=>{this.displayResponse(e,!0)})).finally((e=>{this.form.disabled=!0}));if(s.redirected)return window.location=s.url,null;switch(e){case"text":case"html":return s=await s.text(),this.displayResponse(s,!1);default:return s=await s.json(),s}}async submitForm(){this.fieldEnable();if(await this.validateFields(!1)){if(!0===(!!this.form.querySelector(o.Do.captcha)&&(!this.form.dataset.isbot||!0===this.form.dataset.isbot)))return!1;if(await this.execHandler("submit"))return this.options.fetch?await this.formFetch(this.options.fetch):(this.form.submit(),this.disableForm(),!0)}return!1}enableForm(){this.form.disabled=!1;const e=this.form.querySelector('[type="submit"] svg');e&&e.remove()}disableForm(){this.form.disabled=!0;const e=this.form.querySelector('[type="submit"]');e&&e.insertAdjacentHTML("afterbegin",(0,r.QW)("text-stone-50 ml-1 mr-2 align-text-bottom inline-block"))}displayResponse(e,t=!1){const s=document.createElement("div");s.id="response_"+this.form.id,s.insertAdjacentHTML("afterbegin",e),!1!==t&&s.classList.add("is-error"),this.form.parentElement.insertBefore(s,this.form),this.form.parentElement.insertBefore(s,this.form),this.form.remove()}}i()}catch(e){i(e)}}))},5455:(e,t,s)=>{s.a(e,(async(e,i)=>{try{s.d(t,{JsTomSelect:()=>L});var a=s(2838),n=s.n(a),o=s(8448),r=s.n(o),l=s(3530),d=s.n(l),c=s(1377),m=s.n(c),u=s(7456),h=s.n(u),f=s(4860),p=s(7114),g=s(7104),v=s(8555),b=e([g,v]);[g,v]=b.then?(await b)():b,r().define("remove_button",d()),r().define("clear_button",m()),r().define("caret_position",h());let y={};function x(e,t,s=!1){if(!t)return e.text;let i=[];return Object.keys(e).indexOf(t)>=0?i.push(e[t]):t.indexOf("+")>0&&(!0===s?i.push(e[t.split("+")[0]]):t.split("+").forEach((t=>{t in e&&i.push(e[t])}))),i.join(" ")}function w(){return{applyTo:function(e,t={},s=null){const i=e.getAttribute("id"),a=e.hasAttribute("multiple"),o=e.dataset.type;let l={url:"",settings:t};switch(e.dataset.create&&"true"===e.dataset.create&&(l.settings.create=!0,l.settings.addPrecedence=!0),e.dataset.empty&&"true"===e.dataset.empty&&(l.settings.allowEmptyOption=!0),e.dataset.maxitems&&(l.settings.maxItems=parseInt(e.dataset.maxitems)),e.dataset.addoption&&(l.settings.addoption=e.dataset.addoption.split(",")),o){case p.Jn.project:const t=a?null:1;l.url="/gui/prjlist/",l.settings={...l.settings,valueField:"id",searchField:"text",labelField:"text",openOnFocus:!1,maxItems:t,allowEmptyOption:!1};break;case p.Jn.organisation:l.url="/api/organizations/search?name=",l.settings={...l.settings,valueField:"id",searchField:"text",labelField:"text",openOnFocus:!1,allowEmptyOption:!1};break;case p.Jn.person:l.url="/gui/search_persons?name=";const s="gui/persons/create";e.dataset.prefix&&(l.settings.itemprefix=e.dataset.prefix);const n=async function(){return await fetch(s,f.Uc)},o=async function(t,i,a){let n;const o=t.ok?await t.text():await Promise.reject(t),r=e.form.parentElement,d=parseInt(r.offsetTop)+parseInt(document.documentElement.scrollTop);console.log("pos",d),r.classList.remove("relative"),document.body.classList.add(p.AH.hidevscroll);const c=(0,f.xJ)("div",{class:["absolute","z-[100]","bg-white","w-96","h-48","p-8","rounded","drop-shadow","centered"],src:s},r);r.disabled=!0;const m=(0,f.xJ)("div",{class:[p.Do.close.substr(1)],text:"x"},c),u=(0,f.xJ)("div",{class:["h-full","w-full"]},c);m.addEventListener("click",(e=>{c.remove(),delete r.disabled,document.body.classList.remove(p.AH.hidevscroll)})),u.insertAdjacentHTML("afterbegin",o),c.querySelectorAll("[data-href]").forEach((e=>{c.classList.remove("h-48"),c.classList.add("h-auto"),e.addEventListener("click",(async t=>{const s=e.dataset.href+"?type="+e.dataset.type;n=await fetch(s,f.Uc);const o=n.ok?await n.text():await Promise.reject(n);u.innerHTML=o;const r=c.querySelector("form");r.dataset.fetch=!0;const d=new v.FormSubmit(r);let m=c.querySelector("[id='name']");null!==m?m.value=i:(m=c.querySelector("[id='lastname']"),null!==m&&(m.value=i)),u.querySelector("[type='submit']").addEventListener("click",(async t=>{if(t.preventDefault(),n=await d.submitForm(),n.success){const t={id:(i=n[e.dataset.type]).id,name:i.name};"guest"==e.dataset.type?t["name+email"]=i.name+" "+i.email:l.settings.itemprefix&&(t.id=l.settings.itemprefix+t.id),a&&a(t),c.remove(),document.body.classList.remove(p.AH.hidevscroll)}else c.insertAdjacentHTML("afterbegin",n.message)}))}))}))};l.settings={...l.settings,valueField:"id",searchField:"name",labelField:"name+email",onItemRemove:function(t){if(a||!this.revertSettings||""===this.revertSettings.innerHTML&&0===this.revertSettings.tabIndex||this.revertSettings.tabIndex<0)return;e.options[this.revertSettings.tabIndex].value},onItemAdd:function(e){}},e.dataset.create&&(l.settings.create=function(e,t){n(e).then((s=>{o(s,e,t)}))});break;case p.Jn.user:l.url="/api/users/search?by_name=",l.settings={...l.settings,valueField:"id",searchField:"name",labelField:"name+email",onInitialize:function(){e.currentlist?y=e.currentlist:e.tomselect.items.forEach((e=>{""!==e&&parseInt(e)>0&&(y[e]=!0)}))},onItemAdd:function(t){""!==t&&(y[t]?(g.y.addMessage({type:g.y.alertconfig.types.danger,parent:e,content:g.y.i18nmessages.exists}),setTimeout((()=>{if(this.removeOption(t),this.revertSettings.tabIndex<0||!e.options.length||!this.revertSettings)this.removeItem(t),y[t]=!0;else{const t=e.options[this.revertSettings.tabIndex].value;this.addItem(t)}g.y.addMessage({type:g.y.alertconfig.types.danger,parent:e,content:g.y.i18nmessages.exists})}),2e3)):y[t]=!0)},onItemRemove:function(t){if(y[t]&&delete y[t],a||!this.revertSettings||""===this.revertSettings.innerHTML&&0===this.revertSettings.tabIndex||this.revertSettings.tabIndex<0)return;const s=e.options[this.revertSettings.tabIndex].value;void 0!==y[s]&&delete y[s]}};break;case p.Jn.instr:l.url="/search/instruments",l.settings={valueField:"id",labelField:"text",searchField:"id",maxItems:1,preload:!0};break;case p.Jn.taxo:r().define("no_close",(()=>{this.close=()=>{}})),l.url="/search/taxo",l.settings={...l.settings,valueField:"id",labelField:"text",searchField:"text",closeAfterSelect:!0,onInitialize:()=>{const t=document.getElementById(i).nextElementSibling;if(!t.classList.contains("ts-wrapper"))return;t.querySelectorAll(p.Do.component.tomselect.tsdelet).forEach((t=>{(t=>{t.addEventListener("click",(t=>{const s=t.currentTarget.closest(p.Do.component.tomselect.item).dataset.value;s&&(t.stopImmediatePropagation(),e.tomselect.removeItem(s))}))})(t)}))}}}const d={create:!1,minOptions:0,maxOptions:null,preload:!1,hideSelected:!0,duplicates:!1,allowEmptyOption:!0,closeAfterSelect:!0,placeholder:e.placeholder?e.placeholder:e.dataset.placeholder?e.dataset.placeholder:"",onDropdownClose:function(){},shouldLoad:function(e){return e.length>2},onItemRemove:function(){return!0},load:function(e,t){e=n().sanitize(e);if(this.loading>10)return void t();let s="";switch(o){case p.Jn.user:case p.Jn.organisation:case p.Jn.person:s=l.url+encodeURIComponent("%"+e+"%");break;case p.Jn.instr:case p.Jn.taxo:if(s=l.url,0==e.indexOf("_")&&l.settings.addoption&&e==l.settings.addoption[0])return s=null,t(Object.entries([{text:l.settings.addoption[0],id:l.settings.addoption[1]}]));e&&(s+="?q="+encodeURIComponent(e));break;case p.Jn.project:s=l.url,e&&(s+="?filt_title="+encodeURIComponent(e))}null!==s&&fetch(s,(0,f.Uc)()).then((e=>e.json())).then((e=>(o===p.Jn.project?e.data&&e.data.length&&(e=e.data.map((e=>({id:e[1],text:e[3][0],rights:e[0]})))):[p.Jn.instr,p.Jn.organisation].indexOf(o)>=0&&e.length&&(e=e.reduce(((e,t,s)=>{let i={id:t=n().sanitize(t),text:t};return e.push(i),e}),[])),e.length&&"object"==typeof e&&(e=Object.entries(e)),t(e)))).catch((e=>{console.log("tomselect-err",e)}))},render:{option:function(e,t){if(null==e)return"";const s=e.hasOwnProperty("optgroup")?`data-optgroup=${e.optgroup}`:"",i=x(e,l.settings.labelField),n=this.settings.itemprefix&&e[this.settings.valueField].length>this.settings.itemprefix.length&&e[this.settings.valueField].substr(0,this.settings.itemprefix.length)===this.settings.itemprefix?this.settings.itemprefix.replace("_",""):"";return`<div class="py-2 flex  ${a?"inline-flex":""} ${n} " ${s} data-value="${e[l.settings.valueField]}">${t(i)}</div>`},item:function(e,t){if(null==e)return"";const s=e.optgroup?`item-${e.optgroup}`:"",i=y[e[this.settings.valueField]]?"data-inlist":"",o=x(e,l.settings.labelField,!0),r=this.settings.itemprefix&&e[this.settings.valueField].length>this.settings.itemprefix.length&&e[this.settings.valueField].substr(0,this.settings.itemprefix.length)===this.settings.itemprefix?this.settings.itemprefix.replace("_",""):"";return n().sanitize(`<div class="${a?"flex inline-flex ":""} ${r} ${s}"  data-value="${e[this.settings.valueField]}"  ${i}>${t(o)} </div>`)},no_results:function(t,s){return n().sanitize('<div class="no-results">'+(e.dataset.noresults?e.dataset.noresults:"No result found for ")+s(t.input)+"</div>")}}};if(null===e.getAttribute("readonly")&&(l.settings.plugins={clear_button:{title:e.dataset.clear?e.dataset.clear:"Clear all",html:e=>`<div class="${e.className}" id="clear-${i}" title="${e.title}"><i class="icon ${a?"":"p-[0.125rem]"} icon-x-circle-sm ${a?"":" opacity-50"}"></i></div>`}},l.settings.onClear=function(){return e.tomselect.clear(),!0},a&&(l.settings.plugins={...l.settings.plugins,remove_button:{}},l.settings.plugins={...l.settings.plugins,caret_position:{}})),l.settings=Object.assign(d,l.settings),null!==i){const t=new(r())("#"+i,l.settings);switch(t.wrapper.classList.remove(p.Do.component.tomselect.ident),t.wrapper.classList.remove("js"),t.wrapper.setAttribute("data-component","tom-select"),null!==e.getAttribute("readonly")&&t.disable(),o){case p.Jn.taxo:t.on("item_add",((e,t)=>{null!==t&&t.classList.add("new")}));break;case p.Jn.project:e.dataset.dest&&t.on("item_add",((s,i)=>{if(s!=e.dataset.value&&t.options[s]&&!i.querySelector("a")){const e={A:"/prj/",V:"/prj/",M:"/gui/prj/edit/"},a=t.options[s].rights,n=Object.keys(a);n&&(n.length>1?(Object.entries(a).forEach((([e,t])=>{i.insertAdjacentHTML("beforeend",` <a data-k="${e}" class="small-caps font-normal ml-2">${t}</a>`)})),i.querySelectorAll("a").forEach((i=>{i.addEventListener("click",(i=>{i.preventDefault(),i.stopPropagation(),window.open(e[i.target.dataset.k]+s,`_proj${s}`).focus(),t.removeItem(s)}))}))):(window.open(e[n[0]]+s,`_proj${s}`).focus(),t.removeItem(s)))}}))}return t}console.log("noid")}}}const L=w();i()}catch(F){i(F)}}))}}]);