/*! For license information please see 455.93fb1a3d118b0dd881ad.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[455,555],{5455(e,t,s){s.a(e,async(e,i)=>{try{s.d(t,{JsTomSelect:()=>A});var a=s(9418),n=s(8448),o=s.n(n),r=s(3530),l=s.n(r),d=s(1377),c=s.n(d),m=s(7456),u=s.n(m),h=s(3513),p=s.n(h),f=s(4860),g=s(7114),v=s(7104),y=s(8555),b=e([v,y]);[v,y]=b.then?(await b)():b,o().define("remove_button",l()),o().define("clear_button",c()),o().define("caret_position",u()),o().define("drag_drop",p());let x=null;function w(e,t,s=!1){if(!t)return e.text;let i=[];return Object.keys(e).indexOf(t)>=0?i.push(e[t]):t.indexOf("+")>0&&(!0===s?i.push(e[t.split("+")[0]]):t.split("+").forEach(t=>{t in e&&i.push(e[t])})),i.join(" ")}function L(){return{applyTo:function e(t,s={},i=null){const n=t.getAttribute("id"),r=t.hasAttribute("multiple"),l=t.dataset.type;t.dataset.hasOwnProperty("orderitems");let d={url:"",settings:s};switch(t.dataset.hasOwnProperty("create")&&"true"===t.dataset.create&&(d.settings.create=!0,d.settings.addPrecedence=!0),t.dataset.hasOwnProperty("empty")&&"true"===t.dataset.empty&&(d.settings.allowEmptyOption=!0),d.settings.maxItems=t.dataset.hasOwnProperty("maxitems")?parseInt(t.dataset.maxitems):r?null:1,l){case g.Jn.project:d.url="/gui/prjlist/",d.settings={...d.settings,valueField:"id",searchField:"text",labelField:"text",openOnFocus:!1,maxItems:d.settings.maxItems,allowEmptyOption:!1};break;case g.Jn.organisation:d.url="/api/organizations/search?name=",d.settings={...d.settings,valueField:"id",searchField:"text",labelField:"text",openOnFocus:!1,allowEmptyOption:!1};break;case g.Jn.person:d.url="/gui/search_persons?name=";const s="/gui/persons/create/";t.dataset.prefix&&(d.settings.itemprefix=t.dataset.prefix);const i=async function(){return await fetch(s,f.Uc)},a=async function(i,a,n){let o;const r=i.ok?await i.text():await Promise.reject(i),l=t.form.parentElement;l.classList.remove("relative"),document.body.classList.add(g.AH.hidevscroll);const c=(0,f.xJ)("div",{class:["absolute","z-[100]","bg-white","w-96","h-48","p-8","rounded","drop-shadow","centered"],src:s},l);l.disabled=!0;const m=(0,f.xJ)("div",{class:[g.Do.close.substr(1)],text:"x"},c),u=(0,f.xJ)("div",{class:["h-full","w-full"]},c);m.addEventListener("click",e=>{c.remove(),delete l.disabled,document.body.classList.remove(g.AH.hidevscroll)}),u.insertAdjacentHTML("afterbegin",r),c.querySelectorAll("[data-href]").forEach(t=>{c.classList.remove("h-48"),c.classList.add("h-auto"),c.classList.add("overflow-y-auto"),c.classList.add("max-h-full"),t.addEventListener("click",async s=>{const i=t.dataset.href+"?type="+t.dataset.type;o=await fetch(i,f.Uc);const r=o.ok?await o.text():await Promise.reject(o);u.innerHTML=r,u.querySelectorAll(".js-autocomplete").forEach(t=>{e(t)});const l=c.querySelector("form");l.dataset.fetch=!0;const m=new y.FormSubmit(l);let h=c.querySelector("[id='name']");null!==h?h.value=a:(h=c.querySelector("[id='lastname']"),null!==h&&(h.value=a)),u.querySelector("[type='submit']").addEventListener("click",async e=>{if(e.preventDefault(),o=await m.submitForm(),o.success){const e={id:(a=o[t.dataset.type]).id,name:a.name};"guest"==t.dataset.type?e["name+email"]=a.name+" "+a.email:d.settings.itemprefix&&(e.id=d.settings.itemprefix+e.id),n&&n(e),c.remove(),document.body.classList.remove(g.AH.hidevscroll)}else c.insertAdjacentHTML("afterbegin",o.message)})})})};d.settings={...d.settings,valueField:"id",searchField:"name",labelField:"name+email",onItemRemove:function(e){if(r||!this.revertSettings||""===this.revertSettings.innerHTML&&0===this.revertSettings.tabIndex||this.revertSettings.tabIndex<0)return;t.options[this.revertSettings.tabIndex].value},onItemAdd:function(e){}},t.dataset.create&&(d.settings.create=function(e,t){i(e).then(s=>{a(s,e,t)})});break;case g.Jn.user:d.url="/api/users/search?by_name=",d.settings={...d.settings,valueField:"id",searchField:"name",labelField:"name+email",onInitialize:function(){t.currentlist?x=t.currentlist:t.name.indexOf("[")>=0&&(x={},t.tomselect.items.forEach(e=>{""!==e&&parseInt(e)>0&&(x[e]=!0)}))},onItemAdd:function(e){""!==e&&(null!==x&&x[e]?(v.y.addMessage({type:v.y.alertconfig.types.danger,parent:t,content:v.y.i18nmessages.exists}),setTimeout(()=>{if(this.removeOption(e),this.revertSettings.tabIndex<0||!t.options.length||!this.revertSettings)this.removeItem(e),x[e]=!0;else{const e=t.options[this.revertSettings.tabIndex].value;this.addItem(e)}},2e3)):null!==x&&(x[e]=!0))},onItemRemove:function(e){if(null!==x&&x[e]&&delete x[e],r||!this.revertSettings||""===this.revertSettings.innerHTML&&0===this.revertSettings.tabIndex||this.revertSettings.tabIndex<0)return;const s=t.options[this.revertSettings.tabIndex].value;null!==x&&void 0!==x[s]&&delete x[s],""!==this.options.url&&this.removeOption(e)}};break;case g.Jn.instr:d.url="/search/instruments",d.settings={valueField:"id",labelField:"text",searchField:"id",maxItems:1,preload:!0};break;case g.Jn.taxo:d.url="/search/taxo",o().define("no_close",()=>{this.close=()=>{}}),d.settings={...d.settings,valueField:"id",labelField:"text",searchField:"text",status:"status",closeAfterSelect:!0,persist:!1,onInitialize:()=>{const e=document.getElementById(n).nextElementSibling;if(!e.classList.contains("ts-wrapper"))return;e.querySelectorAll(g.Do.component.tomselect.tsdelet).forEach(e=>{(e=>{e.addEventListener("click",e=>{const s=e.currentTarget.closest(g.Do.component.tomselect.item).dataset.value;s&&(e.stopImmediatePropagation(),t.tomselect.removeItem(s))})})(e)})}},t.dataset.hasOwnProperty("worms")&&(d.settings={...d.settings,labelField:"display_name",searchField:"display_name"})}const c={create:!1,minOptions:0,maxOptions:null,preload:!1,hideSelected:!0,duplicates:!1,allowEmptyOption:!0,closeAfterSelect:!0,placeholder:t.placeholder?t.placeholder:t.dataset.placeholder?t.dataset.placeholder:"",onDropdownClose:function(){},shouldLoad:function(e){return e.length>2},onItemRemove:function(){return!0},load:function(e,s){e=a.A.sanitize(e);if(this.loading>10)return void s();let i=d.url;switch(l){case g.Jn.user:case g.Jn.organisation:case g.Jn.person:i+=encodeURIComponent("%"+e+"%");break;case g.Jn.taxo:case g.Jn.instr:e&&(i+="?q="+encodeURIComponent(e)),l==g.Jn.taxo&&(t.dataset.hasOwnProperty("worms")?i+="&worms=true":t.dataset.hasOwnProperty("nodeprecated")||(i+="&withdeprecated=true"));break;case g.Jn.project:e&&(i+="?filt_title="+encodeURIComponent(e))}null!==i&&fetch(i,(0,f.Uc)()).then(e=>e.json()).then(e=>(l===g.Jn.project?e.data&&e.data.length&&(e=e.data.map(e=>({id:e[1],text:e[3][0],rights:e[0]}))):[g.Jn.instr,g.Jn.organisation].indexOf(l)>=0&&e.length&&(e=e.reduce((e,t,s)=>{let i={id:t=a.A.sanitize(t),text:t};return e.push(i),e},[])),e.length&&"object"==typeof e&&(e=Object.entries(e)),this.options+s?s(e):e)).catch(e=>{console.log("tomselect-err ",e)})},render:{option:function(e,t){if(null==e)return"";e.$option&&e.$option.classList&&e.$option.classList.contains(g.AH.deprecated)&&(e.status="D");const s=e.hasOwnProperty("optgroup")?`data-optgroup=${e.optgroup}`:"",i=w(e,d.settings.labelField),a=this.settings.itemprefix&&e[this.settings.valueField].length>this.settings.itemprefix.length&&e[this.settings.valueField].substr(0,this.settings.itemprefix.length)===this.settings.itemprefix?this.settings.itemprefix.replace("_",""):"";return`<div class="py-2 flex  ${r?"inline-flex":""} ${a}  ${e.status&&"D"==e.status?"deprecated":""} " ${s}  data-value="${e[d.settings.valueField]}">${t(i)}</div>`},item:function(e,t){if(null==e)return"";const s=e.optgroup?`item-${e.optgroup}`:"",i=null!==x&&x[e[this.settings.valueField]]?"data-inlist":"",n=w(e,d.settings.labelField,!0),o=this.settings.itemprefix&&e[this.settings.valueField].length>this.settings.itemprefix.length&&e[this.settings.valueField].substr(0,this.settings.itemprefix.length)===this.settings.itemprefix?this.settings.itemprefix.replace("_",""):"";return a.A.sanitize(`<div class="${r?"flex inline-flex ":""} ${o} ${s} ${e.status&&"D"==e.status?"deprecated":""}" data-value="${e[this.settings.valueField]}" ${i}>${t(n)} </div>`)},no_results:function(e,s){return a.A.sanitize('<div class="no-results">'+(t.dataset.noresults?t.dataset.noresults:"No result found for ")+s(e.input)+"</div>")}}};if(null===t.getAttribute("readonly")&&(d.settings.plugins={clear_button:{title:t.dataset.clear?t.dataset.clear:"Clear all",html:e=>`<div class="${e.className}" id="clear-${n}" title="${e.title}"><i class="icon ${r?"":"p-[0.125rem]"} icon-x-circle-sm ${r?"":" opacity-50"}"></i></div>`}},d.settings.onClear=function(){return t.tomselect.clear(),!0},r&&(d.settings.plugins={...d.settings.plugins,remove_button:{}},d.settings.plugins={...d.settings.plugins,caret_position:{}})),t.dataset.orderitems&&(d.settings.plugins={...d.settings.plugins,drag_drop:{}}),d.settings=Object.assign(c,d.settings),t.dataset.noremote&&(d.settings.load=null),null!==n){const e=new(o())("#"+n,d.settings);switch(e.wrapper.classList.remove(g.Do.component.tomselect.ident),e.wrapper.classList.remove("js"),e.wrapper.setAttribute("data-component","tom-select"),null!==t.getAttribute("readonly")&&e.disable(),l){case g.Jn.taxo:if(e.on("item_add",(t,s)=>{if(null!==s){s.classList.add("new");const i=e.getOption(t);null!==i&&i.status&&"D"==i.status&&s.classList.add(g.AH.deprecated)}}),e.on("load",(s,i)=>{s.forEach(s=>{if("D"===s[1].status&&(t.dataset.hasOwnProperty("nodeprecated")&&e.removeOption(s[1].id),s[1].$id)){const t=e.wrapper.querySelector("#"+s[1].$id);null!==t&&t.classList.add(g.AH.deprecated)}})}),t.dataset.hasOwnProperty("discard")){const s=t.dataset.discard;e.on("change",function(){const t=e.wrapper.closest(g.Do.component.tomselect.line);if(null!==t){let e=0;const i=t.querySelectorAll("[data-discard]");i.forEach(t=>{t.value==s&&(e+=1)}),e==i.length?t.classList.add(g.AH.notused):t.classList.remove(g.AH.notused)}})}if(t.dataset.hasOwnProperty("selattr")){const s=t.dataset.selattr,i=t.dataset["id_"+s]?t.dataset["id_"+s].split(","):t.dataset[s].split(","),a=document.createElement("ul");a.classList.add("lineage-list"),a.classList.add(g.AH.hide),e.wrapper.appendChild(a),t.dataset[s].split(",").forEach((t,s)=>{const n=document.createElement("li");n.dataset.id=i[s];const o=n.dataset.id;n.textContent=t,a.appendChild(n),s>0&&n.addEventListener("click",s=>{null===e.getOption(o)&&e.addOption({display_name:t,id:o}),a.classList.add(g.AH.hide),e.addItem(o)})}),e.on("focus",()=>{a.classList.remove("hide")}),["type"].forEach(t=>{e.on(t,()=>{a.classList.add(g.AH.hide)})})}break;case g.Jn.project:if(t.dataset.dest)e.on("item_add",(s,i)=>{if(s!=t.dataset.value&&e.options[s]&&!i.querySelector("a")){const t={A:"/prj/",V:"/prj/",M:"/gui/prj/edit/"},a=e.options[s].rights,n=Object.keys(a);n&&(n.length>1?(Object.entries(a).forEach(([e,t])=>{i.insertAdjacentHTML("beforeend",` <a data-k="${e}" class="small-caps font-normal ml-2">${t}</a>`)}),i.querySelectorAll("a").forEach(i=>{i.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation(),window.open(t[i.target.dataset.k]+s,`_proj${s}`).focus(),e.removeItem(s)})})):(window.open(t[n[0]]+s,`_proj${s}`).focus(),e.removeItem(s)))}});else if(t.dataset.refresh){const s=function(e){const s=document.getElementById(t.dataset.refresh);if(null===s)return;const i=s.dataset.href.split("?");i.length>1&&(i[1]=i[1].split("="),i[1].length>1&&(i[1][1]=t.tomselect.items.join(",")),i[1]=i[1].join("=")),s.dataset.href=i.join("?"),s.click()};e.on("item_add",(i,a)=>{null===s||t.dataset.hasOwnProperty("noaction")||s(e.items.join(","))}),e.on("item_remove",(i,a)=>{null===s||t.dataset.hasOwnProperty("noaction")||s(e.items.join(","))})}}return e}console.log("noid")}}}const A=L();i()}catch(F){i(F)}})},8555(e,t,s){s.a(e,async(e,i)=>{try{s.d(t,{FormSubmit:()=>c});var a=s(9418),n=s(7114),o=s(4860),r=s(7104),l=e([r]),d=l.then?(await l)():l;r=d[0],n.Do.captcha=".js-captcha",n.Do.formbox=".form-box",n.Do.messagepos=".messagepos",n.AH.invalid="invalid",n.AH.inputvalid="valid",n.AH.required="required",n.AH.tshidden="ts-hidden-accessible";class c{handlers={validate:[],submit:[]};form=null;listener=null;constructor(e,t={}){if(e){if(!e.formsubmit){this.form=e instanceof HTMLElement?e:document.querySelector(e);const s={fetch:null};if(t=Object.assign(t,this.form.dataset),this.options=Object.assign(s,t),!this.form)return;this.tabs=this.form.querySelectorAll(n.Do.component.tabs.tab),this.validateFields(!0),this.init(),e.formsubmit=this}return e.formsubmit}}init(){this.form.addEventListener("keydown",e=>{"Enter"===e.key&&e.target instanceof HTMLInputElement&&e.preventDefault()}),window.addEventListener("pageshow",e=>{(event.persisted||void 0!==window.performance&&2===window.performance.navigation.type)&&this.enableForm()}),this.form.addEventListener("validate",e=>{this.validateFields()}),this.form.addEventListener("submit",async e=>{e.preventDefault();return await this.submitForm()}),this.hotModifs(),this.specialFields()}hotModifs(){this.form.querySelectorAll("[data-hotmodif]").forEach(e=>{const t="input"==e.tagName.toLowerCase()&&"text"===e.type?"keydown":"change",s=e.dataset.modifmessage?e.dataset.modifmessage:this.options.modifmessage;let i=e.closest(n.Do.formbox);i=i||e.closest(n.Do.messagepos),e.addEventListener(t,()=>{r.y.addMessage({type:r.y.alertconfig.types.warning,parent:i,content:s,duration:4e3})})})}specialFields(){this.form.querySelectorAll("input[data-match]").forEach(e=>{const t=e.dataset.match;if(!t)return;const s=document.getElementById(t);if(!s)return;const i=e.dataset.matchinvalid?e.dataset.matchinvalid:"no match",a=(t,s)=>{const a=t.closest(n.Do.component.form.formbox).querySelector('label[for="'+t.id+'"]'),o=s.closest(n.Do.component.form.formbox).querySelector('label[for="'+s.id+'"]'),{patternMismatch:r=!1}=t.validity,l=r?this.getMessage(t,"invalid"):"";!0===t.checkValidity()?(t.setCustomValidity(""),t==e&&null!==a?a.classList.remove(n.AH.invalid):null!==o&&o.classList.remove(n.AH.invalid),t.classList.remove(n.AH.invalid),t.value!==s.value?(s.setCustomValidity(i),o&&(o.dataset.invalid=i,o.classList.add(n.AH.invalid)),s.classList.add(n.AH.invalid)):(s.setCustomValidity(""),o&&o.classList.remove(n.AH.invalid),s.classList.remove(n.AH.invalid))):(t.setCustomValidity(l),a.dataset.invalid=l,a&&a.classList.add(n.AH.invalid),t.classList.add(n.AH.invalid)),t.focus()};[e,s].forEach(t=>{t.addEventListener("keyup",i=>{a(t===e?e:s,t===e?s:e)})})})}getMessage(e,t="invalid"){const{valueMissing:s=!0}=e.validity;return s?"* "+(e.dataset.required?e.dataset.required:this.form.dataset.required?this.form.dataset.required:e.validationMessage?e.validationMessage:"required"):e.dataset[t]?e.dataset[t]:e.validationMessage?e.validationMessage:"input invalid"}setLabelState(e,t){const s=this.getFieldLabel(e);if(null!=s)if(!0===t)s.classList.remove(n.AH.invalid);else{s.dataset.invalid=this.getMessage(e),s.classList.add(n.AH.invalid);const t=s.getBoundingClientRect(),i=t.left,a=t.top;window.scrollTo({top:a,left:i,behavior:"smooth"})}}validateField(e,t=!1){if(e.hasOwnProperty("readonly"))return!0;["select"].indexOf(e.tagName.toLowerCase())>=0?e.querySelectorAll("option:checked").forEach(e=>{e.value=(0,o.c6)(a.A.sanitize(e.value))}):e.value=(0,o.c6)(a.A.sanitize(e.value));let s=e.checkValidity();if(e.tomselect&&e.classList.add(n.AH.tshidden),s&&e.dataset.hasOwnProperty("unique"))s=this.validateFieldUnique(e);else if("checkbox"==e.type&&(s=!0,e.required)){(e.name?e.closest("div").querySelectorAll(e.name):[e]).forEach(t=>{s=s||e.checkValidity(t)})}const i=document.createEvent("Event");return i.initEvent(s?"valid":"invalid",!0,!0),e.dispatchEvent(i),s}getFieldLabel(e){let t=e.closest('[for="'+e.name+'"]')?e.closest('[for="'+e.name+'"]'):e.closest('[data-for="'+e.name+'"]')?e.closest('[data-for="'+e.name+'"]'):null;return null===t&&(t=e.closest(n.Do.component.form.formbox)?e.closest(n.Do.component.form.formbox).querySelector(".label")?e.closest(n.Do.component.form.formbox).querySelector(".label"):e.closest(n.Do.component.form.formbox).querySelector("label"):null),null===t&&(t=e.parentElement&&e.parentElement.dataset.elem&&e.closest("fieldset")?e.closest("fieldset").querySelector("."+e.parentElement.dataset.elem):null),t}validateFieldUnique(e){const t=this.getFieldLabel(e);if(String(e.dataset.unique).toLowerCase()===String(e.value).toLowerCase()){t&&(t.dataset.confirm=r.y.i18nmessages.noduplicate,t.classList.add(r.y.alertconfig.css.confirm));const s=function(){e.dataset.unique=!1,t&&(t.classList.remove(r.y.alertconfig.css.confirm),delete t.dataset.confirm)};return r.y.addConfirm((t?t.textContent+" : ":"")+r.y.i18nmessages.noduplicate,{callback_cancel:s,buttons:{ok:{text:r.y.i18nmessages.modify},cancel:{text:r.y.i18nmessages.saveanyway}}})}return t.dataset.confirm&&(t.classList.remove(r.y.alertconfig.css.confirm),delete t.dataset.confirm),!0}async validateFields(e=!1){let t=!0,s=!0;return[...this.form.elements].forEach(i=>{if(!0===e){if(!i.dataset.listen&&!i.disabled){if(i.required){const e=this.getFieldLabel(i);e&&e.classList.add(n.AH.required)}i.addEventListener("change",e=>{this.validateField(e.target)}),i.dataset.listen=!0,i.addEventListener("invalid",e=>{this.setLabelState(i,!1)}),i.addEventListener("valid",e=>{this.setLabelState(i,!0)})}}else!i.disabled&&!i.readonly&&!i.dataset.readonly&&i.name&&i.type&&["submit","hidden"].indexOf(i.type)<0&&(["radio","checkbox"].indexOf(i.type)<0||i.required)&&(s=this.validateField(i,!1),t=t&&s)}),!1===e&&(this.tabs.forEach(e=>{e.querySelector(":invalid")||e.querySelector(n.Do.component.alert.danger)?e.classList.add(n.AH.error):e.classList.remove(n.AH.error)}),s=await this.execHandler("validate")),s&&t}addHandler(e,t){this.handlers[e].push(t)}fieldEnable(e=!0){this.form.querySelectorAll('input[data-sub="enable"]').forEach(t=>{t.disabled=!0!==e})}async execHandler(e){if(0===this.handlers.length||0===this.handlers[e].length)return!0;let t=!0;return await Promise.all(this.handlers[e].map(async e=>{const s=await e();t=t&&s})),t}async formFetch(e=null){const t=new FormData(this.form);t.fetch=!0;let s=await fetch(this.form.action,(0,o.Uc)({method:"POST",body:t})).catch(e=>{this.displayResponse(e,!0),this.enableForm()}).finally(e=>{this.disableForm()});if(s.redirected)return window.location=s.url,null;switch(e){case"text":case"html":return s=await s.text(),this.displayResponse(s,!1);default:return s=await s.json(),s}}async submitForm(){this.fieldEnable();if(await this.validateFields()){if(!0===(!!this.form.querySelector(n.Do.captcha)&&(!this.form.dataset.isbot||!0===this.form.dataset.isbot)))return!1;if(await this.execHandler("submit"))return this.options.fetch?await this.formFetch(this.options.fetch):(this.form.submit(),this.disableForm(),!0)}return r.y.addAlert({type:r.y.alertconfig.types.error,parent:this.form,content:"Form not submitted, please check required fields and warning messages",dismissible:!0}),this.enableForm(),!1}enableForm(){this.form.disabled=!1;const e=this.form.querySelector('[type="submit"] svg');e&&e.remove()}disableForm(){this.form.disabled=!0;const e=this.form.querySelector('[type="submit"]');e&&e.insertAdjacentHTML("afterbegin",(0,o.QW)("text-stone-50 ml-1 mr-2 align-text-bottom inline-block"))}displayResponse(e,t=!1){const s=document.createElement("div");s.id="response_"+this.form.id,s.insertAdjacentHTML("afterbegin",e),!1!==t&&s.classList.add("is-error"),this.form.parentElement.insertBefore(s,this.form),this.form.parentElement.insertBefore(s,this.form),this.form.remove()}}i()}catch(e){i(e)}})}}]);