/*! For license information please see 250.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[250,615],{615:(t,e,s)=>{s.d(e,{FormSubmit:()=>d});var i=s(7856),a=s.n(i),l=s(2817),r=s(9162);const o="input-invalid",n="input-valid";l.EY.captcha=".js-captcha";class d{handlers=[];form=null;listener=null;constructor(t,e={}){if(t){if(!t.formsubmit){this.form=t instanceof HTMLElement?t:document.querySelector(t);const s={fetch:null};if(e=Object.assign(e,this.form.dataset),this.options=Object.assign(s,e),!this.form)return;this.tabs=this.form.querySelectorAll(l.EY.component.tabs.tab),this.validateFields(!0),this.init(),t.formsubmit=this}return t.formsubmit}}init(){this.form.addEventListener("submit",(async t=>{t.preventDefault();return await this.submitForm()})),this.specialFields()}specialFields(){this.form.querySelectorAll("input[data-match]").forEach((t=>{const e=t.dataset.match;if(!e)return;const s=document.getElementById(e);if(!s)return;const i=t.dataset.matchinvalid?t.dataset.matchinvalid:"no match",a=(e,a)=>{const l=t.previousElementSibling&&"label"==t.previousElementSibling.tagName.toLowerCase()?t.previousElementSibling:null,r=s.previousElementSibling&&"label"==s.previousElementSibling.tagName.toLowerCase()?s.previousElementSibling:null,{patternMismatch:d=!1}=e.validity,c=d?this.get_message(e,"invalid"):"";!0===e.checkValidity()?(e.dataset.invalid="",e.setCustomValidity(""),e==t&&null!==l?l.classList.remove(o):null!==r&&r.classList.remove(o),e.classList.remove(n),e.value!==a.value?(t.setCustomValidity(i),l&&(l.dataset.invalid=l.dataset.invalid?l.dataset.invalid:i,l.classList.add(o)),t.classList.add(n)):(t.setCustomValidity(""),l&&l.classList.remove(o),t.classList.remove(n))):(e.setCustomValidity(c),e.dataset.invalid=c,l&&l.classList.add(o),e.classList.add(n)),e.focus()};[t,s].forEach((e=>{e.addEventListener("keyup",(i=>{a(e,e===t?s:t)}))}))}))}get_message(t,e="invalid"){if(0==t.checkValidity()){const{valueMissing:s=!0}=t.validity;return s?"* "+(t.dataset.required?t.dataset.required:this.form.dataset.required?this.form.dataset.required:"required"):t.dataset[e]?t.dataset[e]:"input invalid"}return""}validateField(t,e=!1){["textarea","input"].indexOf(t.tagName.toLowerCase()),["select",'input[type="checkbox"]'].indexOf(t.tagName.toLowerCase())>=0?t.querySelectorAll("option:checked").forEach((t=>{t.value=(0,r.Tv)(a().sanitize(t.value))})):t.value=(0,r.Tv)(a().sanitize(t.value));const s=t.checkValidity(),i=this.getFieldLabel(t);return i&&(s?i.classList.remove(o):s||(i.dataset.invalid=this.get_message(t),i.classList.add(o),window.scrollTo({top:parseInt(i.offsetTop),left:parseInt(i.offsetLeft),behavior:"smooth"}))),s}getFieldLabel(t){return t.closest(".form-box")?t.closest(".form-box").querySelector(".label")?t.closest(".form-box").querySelector(".label"):t.closest(".form-box").querySelector("label"):null}validateFields(t=!1){let e=!0;return[...this.form.elements].forEach((s=>{if(s.name)if(!0===t){if(!s.dataset.listen){if(s.hasAttribute("required")&&s.required){const t=this.getFieldLabel(s);t&&t.classList.add("required")}["change","blur"].forEach((e=>{s.addEventListener(e,(e=>{this.validateField(e.currentTarget,t)}))})),s.dataset.listen=!0}}else e=e&&this.validateField(s,t)})),this.tabs.forEach((t=>{t.querySelector(":invalid")||t.querySelector(l.EY.component.alert.danger)?t.classList.add(l.iv.error):t.classList.remove(l.iv.error)})),e}addHandler(t){this.handlers.push(t)}fieldEnable(t=!0){this.form.querySelectorAll('input[data-sub="enable"]').forEach((e=>{e.disabled=!0!==t}))}async submitHandler(){if(!this.validateFields())return!1;if(0===this.handlers.length)return!0;let t=!0;return await Promise.all(this.handlers.map((async e=>{const s=await e();t=t&&s}))),!0===t&&(this.handlers=[]),t}formFetch(t=null){const e=new FormData(this.form);return e.fetch=!0,fetch(this.form.action,(0,r.wv)({method:"POST",body:e})).then((e=>{switch(t){case"text":case"html":return e.text();default:return e.json()}})).then((t=>{this.displayResponse(t)})).catch((t=>{this.displayResponse(t,!0)})).finally((t=>{this.form.disabled=!0})),!1}async submitForm(){if(this.fieldEnable(),this.validateFields(!1)){if(!0===(!!this.form.querySelector(l.EY.captcha)&&(!this.form.dataset.isbot||!0===this.form.dataset.isbot)))return!1;return!!await this.submitHandler()&&(this.options.fetch?this.formFetch(this.options.fetch):this.form.submit(),this.form.disabled=!0,!0)}return!1}displayResponse(t,e=!1){const s=document.createElement("div");s.insertAdjacentHTML("afterbegin",t),!1!==e&&s.classList.add("is-error"),this.form.parentElement.insertBefore(s,this.form),this.form.remove()}}},6250:(t,e,s)=>{s.d(e,{JsImport:()=>a});s(7856),s(615),s(9162);var i=s(2817);class a{typeimport;myFiles;constructor(t,e={}){if(!(t=t instanceof HTMLElement?t:document.querySelector(t)))return;this.container=t;this.options=Object.assign({selector:{displayresult:"results",typeimport:"typeimport",importzone:"file_to_load",showfiles:".showfiles",displayselection:"dirlist"}},e),this.init()}init(){this.container.querySelectorAll('input[name="'+this.options.selector.typeimport+'"]').forEach((t=>{t.addEventListener("change",(t=>{t.currentTarget.checked&&(console.log(t.currentTarget),this.typeimport=t.currentTarget.value,this.showSelection(!0))}))})),this.showSelection()}async showSelection(t=!1){const e=document.getElementById(this.options.selector.displayselection),a=document.getElementById(this.options.selector.displayresult);if(e&&a){if(!this.myFiles){const{JsMyFiles:t}=await s.e(541).then(s.bind(s,8541));this.myFiles=new t(e,{enableupload:!0,enablestore:!0,btnfilelist:this.options.showfiles,upload:{label:e.dataset.uploadlabel?e.dataset.uploadlabel:"upload",callback:()=>{this.addImportPath("/tmp/ecotaxa_user.760/ecotaxa_import"),this.showSubmit()}}})}!0===t&&(()=>{let t=this.typeimport.split("-");t=t.map((t=>new Set([...i.FB[t]?i.FB[t]:[]]))),this.myFiles.container.querySelectorAll("[data-ftype]").forEach((e=>{t.has(e.dataset.ftype)?e.classList.remove("disabled"):e.classList.add("disabled")}))})()}}addImportPath(t){document.getElementById(this.options.selector.importzone).value=t;const e=document.getElementById(this.options.selector.displayresult);e&&(e.innerHTML=`<li>${t.split("/").pop()}</li>`);this.container.querySelector("#"+this.options.selector.importoptions)}showSubmit(t=!0){const e=this.container.querySelector('[type="submit"]');console.log("sub",e),t?(e.classList.remove("hide"),e.disabled=!1):e.disabled=!0}}}}]);