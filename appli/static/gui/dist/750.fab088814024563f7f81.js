/*! For license information please see 750.fab088814024563f7f81.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[750],{3750(e,t,n){n.d(t,{TaxoMapping:()=>d});var a=n(9418);const s="taxoline",i="mapping-line",l="cancel-line";class d{numlines=0;constructor(e){if(e&&e instanceof HTMLElement){if(!e.taxomapping){const t=e.dataset.name?e.dataset.name:null;if(null===t)return null;this.keepname=t,this.init(e),e.taxomapping=this}return e.taxomapping}}init(e){if(e.dataset.addline){let t={};["select","replace"].forEach(n=>{t[n]=e.querySelector('[data-role="'+n+'"]')}),this.linecontrols=t,t=null;let n=e.querySelector("."+e.dataset.addline);n=null===n?this.createBtn(e):n,n.addEventListener("click",t=>{this.addLine(e)}),this.btn=n}window.addEventListener("pageshow",t=>{(event.persisted||void 0!==window.performance&&2===window.performance.navigation.type)&&this.beforeSubmit(e)}),this.beforeSubmit(e)}createBtn(e){const t=document.createElement("div");return t.classList.add(e.dataset.addline),t.insertAdjacentHTML("afterbegin",'<i class="icon icon-plus-sm block mx-auto"></i>'),t.textContent=e.dataset.addtext?(0,a.A)(e.dataset.addtext).sanitize():"Add",e.append(t),t}addLine(e){let t=!0;if(Object.values(this.linecontrols).forEach(e=>{const n=e.tomselect?e.tomselect.items.length?e.tomselect.items[0]:"":new String(e.value);t=t&&n.length>0}),!1===t)return void(this.btn.dataset.title=e.dataset.notselected?e.dataset.notselected:"select values to replace");this.btn.dataset.title&&delete this.btn.dataset.title;const n=document.createElement("div");n.classList.add(s),n.classList.add("pb-2"),this.numlines++,Object.values(this.linecontrols).forEach(e=>{const t=document.createElement("div");t.classList.add(i),t.classList.add("mr-2");const a=e.dataset.role;if(e.tomselect){const n=e.nextElementSibling.querySelector(".ts-control > div");t.dataset.value=e.value,t.textContent=n.textContent,t.dataset[a]=this.numlines,e.tomselect.clear(!0)}else"select"===e.tagName.toLowerCase()&&(t.dataset.value=e.options[e.selectedIndex].value,t.textContent=e.options[e.selectedIndex].text,n.dataset.index=e.selectedIndex,t.dataset[a]=this.numlines,e.options[e.selectedIndex].disabled=!0,e.selectedIndex=-1);e.parentElement.insertBefore(t,e),n.append(t)}),this.btnCancel(n,e.dataset.cancel?e.dataset.cancel:"cancel"),e.parentElement.insertBefore(n,e)}btnCancel(e,t){const n=document.createElement("div");n.id="cancel_"+this.numlines,n.classList.add(l),["action","name"].forEach(e=>{delete n.dataset[e]}),e.append(n),n.insertAdjacentHTML("afterbegin",'<i class="icon icon-x-mark absolute centered"></i>'),n.addEventListener("click",t=>{this.linecontrols.select.options&&(this.linecontrols.select.options[e.dataset.index].disabled=!1),e.remove()})}beforeSubmit(e){const t=e.closest("form");if(null===t)return;const n=()=>{0===this.numlines&&this.btn&&this.btn.click();let e=t.querySelector('input[name="'+this.keepname+'"]');null!==e&&e.remove(),e=document.createElement("input"),e.type="hidden",e.name=this.keepname;let n={};return t.querySelectorAll("[data-select]").forEach(e=>{if(""!==e.value){const t=e.parentElement.querySelector('[data-replace="'+e.dataset.select+'"]');null!==t&&(n[e.dataset.value]=t.dataset.value)}}),t.append(e),e.value=JSON.stringify(n),!0};t.formsubmit?t.formsubmit.addHandler("submit",n):t.addEventListener("submit",e=>{n()})}}}}]);