/*! For license information please see 804.78d9c46419a6430b0251.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[804,615],{615:(e,t,i)=>{i.d(t,{FormSubmit:()=>r});var s=i(7856),a=i.n(s),n=i(2817),o=i(7737);n.EY.captcha=".js-captcha",n.iv.invalid="invalid",n.iv.inputvalid="valid",n.iv.required="required",n.iv.tshidden="ts-hidden-accessible";class r{handlers={validate:[],submit:[]};form=null;listener=null;constructor(e,t={}){if(e){if(!e.formsubmit){this.form=e instanceof HTMLElement?e:document.querySelector(e);const i={fetch:null};if(t=Object.assign(t,this.form.dataset),this.options=Object.assign(i,t),!this.form)return;this.tabs=this.form.querySelectorAll(n.EY.component.tabs.tab),this.validateFields(!0),this.init(),e.formsubmit=this}return e.formsubmit}}init(){this.form.addEventListener("keydown",(e=>{"Enter"===e.key&&e.target instanceof HTMLInputElement&&e.preventDefault()})),window.addEventListener("pageshow",(e=>{(event.persisted||void 0!==window.performance&&2===window.performance.navigation.type)&&this.enableForm()})),this.form.addEventListener("validate",(e=>{this.validateFields()})),this.form.addEventListener("submit",(async e=>{e.preventDefault();return await this.submitForm()})),this.specialFields()}specialFields(){this.form.querySelectorAll("input[data-match]").forEach((e=>{const t=e.dataset.match;if(!t)return;const i=document.getElementById(t);if(!i)return;const s=e.dataset.matchinvalid?e.dataset.matchinvalid:"no match",a=(t,i)=>{const a=t.closest(n.EY.component.form.formbox).querySelector('label[for="'+t.id+'"]'),o=i.closest(n.EY.component.form.formbox).querySelector('label[for="'+i.id+'"]'),{patternMismatch:r=!1}=t.validity,l=r?this.get_message(t,"invalid"):"";!0===t.checkValidity()?(t.setCustomValidity(""),t==e&&null!==a?a.classList.remove(n.iv.invalid):null!==o&&o.classList.remove(n.iv.invalid),t.classList.remove(n.iv.invalid),t.value!==i.value?(i.setCustomValidity(s),o&&(o.dataset.invalid=s,o.classList.add(n.iv.invalid)),i.classList.add(n.iv.invalid)):(i.setCustomValidity(""),o&&o.classList.remove(n.iv.invalid),i.classList.remove(n.iv.invalid))):(t.setCustomValidity(l),a.dataset.invalid=l,a&&a.classList.add(n.iv.invalid),t.classList.add(n.iv.invalid)),t.focus()};[e,i].forEach((t=>{t.addEventListener("keyup",(s=>{a(t===e?e:i,t===e?i:e)}))}))}))}get_message(e,t="invalid"){const{valueMissing:i=!0}=e.validity;return i?"* "+(e.dataset.required?e.dataset.required:this.form.dataset.required?this.form.dataset.required:e.validationMessage?e.validationMessage:"required"):e.dataset[t]?e.dataset[t]:e.validationMessage?e.validationMessage:"input invalid"}setLabelState(e,t){const i=this.getFieldLabel(e);if(null!=i)if(!0===t)i.classList.remove(n.iv.invalid);else{i.dataset.invalid=this.get_message(e),i.classList.add(n.iv.invalid);const t=i.getBoundingClientRect(),s=t.left,a=t.top;window.scrollTo({top:a,left:s,behavior:"smooth"})}}validateField(e,t=!1){["select"].indexOf(e.tagName.toLowerCase())>=0?e.querySelectorAll("option:checked").forEach((e=>{e.value=(0,o.Tv)(a().sanitize(e.value))})):e.value=(0,o.Tv)(a().sanitize(e.value)),e.tomselect&&e.classList.remove(n.iv.tshidden);let i=e.checkValidity();e.tomselect&&e.classList.add(n.iv.tshidden),i&&void 0!==e.dataset.unique&&(i=this.validateFieldUnique(e));const s=document.createEvent("Event");return s.initEvent(i?"valid":"invalid",!0,!0),e.dispatchEvent(s),i}getFieldLabel(e){let t=e.closest('[for="'+e.name+'"]')?e.closest('[for="'+e.name+'"]'):e.closest('[data-for="'+e.name+'"]')?e.closest('[data-for="'+e.name+'"]'):null;return null===t&&(t=e.closest(n.EY.component.form.formbox)?e.closest(n.EY.component.form.formbox).querySelector(".label")?e.closest(n.EY.component.form.formbox).querySelector(".label"):e.closest(n.EY.component.form.formbox).querySelector("label"):null),null===t&&(t=e.parentElement&&e.parentElement.dataset.elem&&e.closest("fieldset")?e.closest("fieldset").querySelector("."+e.parentElement.dataset.elem):null),t}validateFieldUnique(e){const t=this.getFieldLabel(e);if(String(e.dataset.unique).toLowerCase()===String(e.value).toLowerCase()){t&&(t.dataset.confirm=window.alertbox.i18nmessages.noduplicate,t.classList.add(window.alertbox.alertconfig.css.confirm));const i=function(){e.dataset.unique=!1,t&&(t.classList.remove(window.alertbox.alertconfig.css.confirm),delete t.dataset.confirm)};return window.alertbox.createConfirm((t?t.textContent+" : ":"")+window.alertbox.i18nmessages.noduplicate,{callback_cancel:i,buttons:{ok:{text:window.alertbox.i18nmessages.modify},cancel:{text:window.alertbox.i18nmessages.saveanyway}}})}return t.dataset.confirm&&(t.classList.remove(window.alertbox.alertconfig.css.confirm),delete t.dataset.confirm),!0}async validateFields(e=!1){let t=!0,i=!0;return[...this.form.elements].forEach((s=>{if(!0===e){if(!s.dataset.listen){if(s.required){const e=this.getFieldLabel(s);e&&e.classList.add(n.iv.required)}s.addEventListener("change",(e=>{this.validateField(e.target)})),s.dataset.listen=!0,s.addEventListener("invalid",(e=>{this.setLabelState(s,!1)})),s.addEventListener("valid",(e=>{this.setLabelState(s,!0)}))}}else s.name&&s.type&&["submit","hidden"].indexOf(s.type)<0&&(["radio","checkbox"].indexOf(s.type)<0||s.required)&&(i=this.validateField(s,!1),t=t&&i)})),!1===e&&(this.tabs.forEach((e=>{e.querySelector(":invalid")||e.querySelector(n.EY.component.alert.danger)?e.classList.add(n.iv.error):e.classList.remove(n.iv.error)})),i=await this.execHandler("validate")),i&&t}addHandler(e,t){this.handlers[e].push(t)}fieldEnable(e=!0){this.form.querySelectorAll('input[data-sub="enable"]').forEach((t=>{t.disabled=!0!==e}))}async execHandler(e){if(0===this.handlers[e].length)return!0;let t=!0;return await Promise.all(this.handlers[e].map((async e=>{const i=await e();t=t&&i}))),t}formFetch(e=null){const t=new FormData(this.form);return t.fetch=!0,fetch(this.form.action,(0,o.wv)({method:"POST",body:t})).then((t=>{switch(e){case"text":case"html":return t.text();default:return t.json()}})).then((e=>{this.displayResponse(e)})).catch((e=>{this.displayResponse(e,!0)})).finally((e=>{this.form.disabled=!0})),!1}async submitForm(){this.fieldEnable();if(await this.validateFields(!1)){if(!0===(!!this.form.querySelector(n.EY.captcha)&&(!this.form.dataset.isbot||!0===this.form.dataset.isbot)))return!1;if(await this.execHandler("submit"))return this.options.fetch?this.formFetch(this.options.fetch):this.form.submit(),this.disableForm(),!0}return!1}enableForm(){this.form.disabled=!1;const e=this.form.querySelector('[type="submit"] svg');e&&e.remove()}disableForm(){this.form.disabled=!0;const e=this.form.querySelector('[type="submit"]');e&&e.insertAdjacentHTML("afterbegin",(0,o.IW)("text-stone-50 ml-1 mr-2 align-text-bottom inline-block"))}displayResponse(e,t=!1){const i=document.createElement("div");i.insertAdjacentHTML("afterbegin",e),!1!==t&&i.classList.add("is-error"),this.form.parentElement.insertBefore(i,this.form),this.form.remove()}}},8804:(e,t,i)=>{i.d(t,{JsUpload:()=>r});i(7856);var s=i(3778),a=(i(615),i(7737),i(2817));const n=new Set(["zip","gz","png","jpg","jpeg","pdf","doc","docx","ppt","pptx","xls","xlsx","heic","heif","7z","bz2","rar","gif","webp","webm","mp4","mov","mp3","aifc"]);let o=null;class r{zipstream;zipsize=0;pathname;zipname;numfiles=0;sizefiles=0;zipparts=[];counter=0;counterdisplay=null;ziptrigger=null;displaylist=null;timer=0;targetdir="";sent=!1;dropzone;root=".";constructor(e,t=null,i={}){if(o)return o;if(!(e=e instanceof HTMLElement?e:document.querySelector(e)))return;this.container=e,this.callback=t;return this.options=Object.assign({level:0,url:"https://localhost:8000/my_files/",filefield:"file",selector:{makezip:".makezip",droptarget:".droptarget",trigger:".trigger",uploadfile:"uploadfile",formu:"formupload",stepper:"stepper",stepitem:"stepper-item",filetoload:"file_to_load",progress:"progress-upload"},display:{dropzone:"dropzone",counter:"counter",size:"sizetozip",counterzipped:"counterzipped",sizezipped:"sizezipped",dirlist:"dirlist",boxtitle:"boxtitle",timer:"timer"},css:{enabled:"enabled"}},i),this.init(e),o=this,o}init(e){this.dropzone=document.createElement("div"),this.dropzone.id=this.options.display.dropzone,this.dropzone.innerHTML=`<input type="file" class="hidden"  name="${this.options.selector.uploadfile}" id="${this.options.selector.uploadfile}">\n            <div class="${this.options.selector.droptarget.slice(1)}">\n            <div id="${this.options.display.boxtitle}"><span class="${this.options.selector.trigger.slice(1)}">${this.container.dataset.textbrowse}</span>  ${this.container.dataset.textdrop}</div>\n          </div><div><span id="${this.options.display.counter}"></span>/<span id="${this.options.display.counterzipped}"></span></div>\n          <div><span id="${this.options.display.size}"></span>/<span id="${this.options.display.sizezipped}"></span></div><div id="${this.options.display.timer}"></div>\n          <div id="${this.options.selector.makezip.slice(1)}" class="button ${this.options.selector.makezip.slice(1)} ${a.iv.hide} "><div id="${this.options.selector.progress}"></div>${e.dataset.ended}</div>`,e.append(this.dropzone),this.counterdisplay=document.getElementById(this.options.display.counter),this.counterzippeddisplay=document.getElementById(this.options.display.counterzipped),this.sizedisplay=document.getElementById(this.options.display.size),this.sizezippeddisplay=document.getElementById(this.options.display.sizezipped),this.ziptrigger=e.querySelector(this.options.selector.makezip),this.displaylist=document.getElementById(this.options.display.dirlist);const t=this.container.querySelector(this.options.selector.droptarget);t.addEventListener("dragover",(e=>{this.handleDragOver(e)})),t.addEventListener("drop",(async e=>{this.handleDrop(e)})),e.querySelector(this.options.selector.trigger).addEventListener("click",(e=>{let t=e;this.openDirDialog(".tsv,.png,.jpg, .jpeg,.zip,.gz,.7z,.bz2",(e=>{console.log("edrop",t)}))}))}attachDropzone(e){console.log("attch",e),this.targetdir=e.parentElement.dataset.name?e.parentElement.dataset.name:"",console.log("targetdir",this.targetdir),this.dropzone.classList.add(this.options.css.enabled),console.log("att",this.dropzone),e.append(this.dropzone)}detachDropzone(){this.targetdir=null,this.container.classList.remove(this.options.css.enabled)}openDirDialog(e,t){const i=document.createElement("input");i.type="file",i.directory=!0,i.multiple=!0,i.webkitdirectory=!0,i.allowdirs=!0,i.accept=e,i.addEventListener("change",t),i.dispatchEvent(new MouseEvent("click"))}handleDragOver(e){e.preventDefault(),e.dataTransfer.dropEffect="move"}async handleDrop(e){let t;e.dataTransfer?(e.preventDefault(),t=e.dataTransfer):t=e,this.timer=new Date,console.log("dataTransfer ",t.items);const i=[...t.items?t.items:t.files];if(i.length){this.enableDropzone(!1),this.zipname="_upload.zip",this.zip=new s.sZ,this.zipReadableStream=await this.fflToStream();const e=async()=>{this.timer=(new Date-this.timer)/1e3,console.log("item-------------------------------------"+parseInt(this.timer/60)+" --- "+(this.timer-60*parseInt(this.timer/60)),this.zip),this.enableDropzone(),this.zip.end(),this.ziptrigger.classList.remove(a.iv.hide),this.ziptrigger.addEventListener("click",(async e=>(this.ziptrigger.disabled=!0,console.log("upload click"),this.enableDropzone(!1,!0),await this.sendZip())))};for(let t=0;t<i.length;t++){let s=i[t].webkitGetAsEntry();!0===s.isDirectory?(this.zipname=s.name+this.zipname,await this.readDirectory(s,this.root,e)):s.isFile}}}stopOnError(e){console.log("err",e)}enableDropzone(e=!0,t=!1){t&&this.dropzone.classList.add(a.iv.hide),e?this.dropzone.classList.add(this.options.css.enabled):this.dropzone.classList.remove(this.options.css.enabled)}async supportsRequestStreams(){let e=!1;const t=new Request(this.options.url,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}fileType(e){const t=new Uint8Array(e);let i=[];for(let e=0;e<4;e++)i.push(t[e].toString(16));return{input:t,mimetype:(e=>{switch(e){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip";case"EFBBBF22":return"text/tsv";default:return console.log("unknownsign",e),"unknown"}})(e=i.join("").toUpperCase())}}async fflToStream(){const e=this.zip;(new TransformStream).writable.getWriter();return new TransformStream({start(t){e.ondata=(e,i,s)=>{if(e)return console.log("error",e),!1;t.enqueue(i),s&&console.log("final",s)}},flush(e){console.log("terminate ffstrem"),e.terminate()}})}async readDirectory(e,t,i,a=null){console.log("read",e.name);const o=this;let r=!1,l=[],d=[],c=[];const p=a||(e=>{console.log("on_error",e),r||(r=!0)}),h=async function(){const t=c.shift(),i=t.fullPath.slice(1),a=i.slice(i.lastIndexOf(".")+1);o.numfiles++,1===o.numfiles&&fetch(o.options.url.replace("my_files","stream_my_files"),{mode:"cors",method:"POST",credentials:"include",headers:{"Content-Type":"application/zip"},body:o.zipReadableStream.readable,duplex:"half"}).then((e=>{console.log("response",e)})),await t.file((async t=>{const r=n.has(a)?new s.Ud(i):t.size>5e4?new s.wL(i,{level:9}):new s.Tf(i,{level:6});return r.ondata=async function(t,i,s){t?console.log("err add chunk to zipfile"+i,t):s&&(c.length?(console.log("files",c.length),await h()):(console.log("lastfile",e.name),await u()))},await o.zip.add(r),await async function(e,t){const i=e.stream().getReader();for(;;){const{done:e,value:s}=await i.read();if(e)return await t.push(new Uint8Array(0),!0),e;await t.push(s)}}(t,r)}))},m=function(){const e=l.shift();e.isFile?(o.counter++,o.counterdisplay.textContent=o.counter,c.push(e),o.counter--,o.counterdisplay.textContent=o.counter):e.isDirectory&&(console.log("entry is dir",e),d.push(e)),l.length&&m()},u=async function(){for(const t of d)console.log(t),await o.readDirectory(t,e,(async function(){console.log("idir",t.name),c.length&&await h()}))},f=e.createReader(),v=async function(t){t.length&&!r?(l=[...l,...t],await f.readEntries(v,p)):r?console.log("treat error readdir"):(m(),console.log("theend------------------- "+e.name,l.length),await u())};await f.readEntries(v,p),console.log("enddir"+e.name,l.length)}compressionLevel(e){if(!e)return-1;let t=e.split(".");return t=t.length>1?t[t.length-1]:t[0],n.find((e=>e===t))?2:this.options.level}async sendZip(){}}}}]);