/*! For license information please see 455.08bb376f72faa7c9c4c0.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[455],{5455:(e,t,n)=>{n.d(t,{JsTomSelect:()=>v});var s=n(2838),i=n.n(s),a=n(1551),o=n.n(a),l=n(6497),r=n.n(l),d=n(5396),c=n.n(d),p=n(5125),u=n.n(p),m=n(4860),g=n(7114);o().define("remove_button",r()),o().define("clear_button",c()),o().define("caret_position",u());let h={};function f(e,t,n=!1){if(!t)return e.text;let s=[];return Object.keys(e).indexOf(t)>=0?s.push(e[t]):t.indexOf("+")>0&&(!0===n?s.push(e[t.split("+")[0]]):t.split("+").forEach((t=>{t in e&&s.push(e[t])}))),s.join(" ")}class v{applyTo(e,t={},n=null){const s=e.getAttribute("id"),a=e.hasAttribute("multiple"),l=e.dataset.type;let r={url:"",settings:t};switch(e.dataset.create&&"true"===e.dataset.create&&(r.settings.create=!0,r.settings.addPrecedence=!0),e.dataset.empty&&"true"===e.dataset.empty&&(r.settings.allowEmptyOption=!0),e.dataset.maxitems&&(r.settings.maxItems=parseInt(e.dataset.maxitems)),e.dataset.addoption&&(r.settings.addoption=e.dataset.addoption.split(",")),l){case g.Jn.project:const t=a?null:1;r.url="/gui/prjlist/",r.settings={...r.settings,valueField:"id",searchField:"text",labelField:"text",openOnFocus:!1,maxItems:t,allowEmptyOption:!1};break;case g.Jn.user:r.url="/api/users/search?by_name=",r.settings={...r.settings,valueField:"id",searchField:"name",labelField:"name+email",onInitialize:function(){e.currentlist?h=e.currentlist:e.tomselect.items.forEach((e=>{""!==e&&parseInt(e)>0&&(h[e]=!0)}))},onItemAdd:function(t){""!==t&&(h[t]?(window.alertbox?(console.log("itemtoms",e),window.alertbox.addItemMessage({type:window.alertbox.alertconfig.types.danger,parent:e,content:window.alertbox.i18nmessages.exists})):(e.dataset.invalid=window.alertbox.i18nmessages.exists,e.dispatchEvent(new Event("invalid"))),setTimeout((()=>{if(this.removeOption(t),this.revertSettings.tabIndex<0||!e.options.length||!this.revertSettings)this.removeItem(t),h[t]=!0;else{const t=e.options[this.revertSettings.tabIndex].value;this.addItem(t)}window.alertbox?window.alertbox.removeItemMessage({type:window.alertbox.alertconfig.types.danger,parent:e,content:window.alertbox.i18nmessages.exists}):(delete e.dataset.invalid,e.dispatchEvent(new Event("undeterminate")))}),2e3)):h[t]=!0)},onItemRemove:function(t){if(h[t]&&delete h[t],a||!this.revertSettings||""===this.revertSettings.innerHTML&&0===this.revertSettings.tabIndex||this.revertSettings.tabIndex<0)return;const n=e.options[this.revertSettings.tabIndex].value;void 0!==h[n]&&delete h[n]}};break;case g.Jn.instr:r.url="/search/instruments",r.settings={valueField:"id",labelField:"text",searchField:"id",maxItems:1,preload:!0};break;case g.Jn.taxo:o().define("no_close",(()=>{this.close=()=>{}})),r.url="/search/taxo",r.settings={...r.settings,valueField:"id",labelField:"text",searchField:"text",closeAfterSelect:!0,onInitialize:()=>{const t=document.getElementById(s).nextElementSibling;if(!t.classList.contains("ts-wrapper"))return;t.querySelectorAll(g.Do.component.tomselect.tsdelet).forEach((t=>{(t=>{t.addEventListener("click",(t=>{const n=t.currentTarget.closest(g.Do.component.tomselect.item).dataset.value;n&&(t.stopImmediatePropagation(),e.tomselect.removeItem(n))}))})(t)}))}}}const d={create:!1,minOptions:0,maxOptions:null,preload:!1,hideSelected:!0,duplicates:!1,allowEmptyOption:!0,closeAfterSelect:!0,placeholder:e.placeholder?e.placeholder:e.dataset.placeholder?e.dataset.placeholder:"",onDropdownClose:function(){},shouldLoad:function(e){return e.length>2},onItemRemove:function(){return!0},load:function(e,t){e=i().sanitize(e);if(this.loading>10)return void t();let n="";switch(l){case g.Jn.user:n=r.url+encodeURIComponent("%"+e+"%");break;case g.Jn.instr:case g.Jn.taxo:if(n=r.url,0==e.indexOf("_")&&r.settings.addoption&&e==r.settings.addoption[0])return n=null,t(Object.entries([{text:r.settings.addoption[0],id:r.settings.addoption[1]}]));e&&(n+="?q="+encodeURIComponent(e));break;case g.Jn.project:n=r.url,e&&(n+="?filt_title="+encodeURIComponent(e))}null!==n&&fetch(n,(0,m.Uc)()).then((e=>e.json())).then((e=>(l===g.Jn.project&&e.data&&e.data.length&&(e=e.data.map((e=>({id:e[1],text:e[3][0],rights:e[0]})))),l===g.Jn.instr&&e.length&&(e=e.reduce(((e,t,n)=>{let s={id:t=i().sanitize(t),text:t};return e.push(s),e}),[])),e.length&&"object"==typeof e&&(e=Object.entries(e)),t(e)))).catch((e=>{console.log("tomselect-err",e)}))},render:{option:function(e,t){if(null==e)return"";const n=e.hasOwnProperty("optgroup")?`data-optgroup=${e.optgroup}`:"",s=f(e,r.settings.labelField);return`<div class="py-2 flex  ${a?"inline-flex":""} " ${n} data-value="${e[r.settings.valueField]}">${t(s)}</div>`},item:function(e,t){if(null==e)return"";const n=e.optgroup?`item-${e.optgroup}`:"",s=h[e[this.settings.valueField]]?"data-inlist":"",o=f(e,r.settings.labelField,!0);return i().sanitize(`<div class="${a?"flex inline-flex ":""} ${n}"  data-value="${e[this.settings.valueField]}"  ${s}>${t(o)} </div>`)},no_results:function(t,n){return i().sanitize('<div class="no-results">'+(e.dataset.noresults?e.dataset.noresults:"No result found for ")+n(t.input)+"</div>")}}};if(r.settings.plugins={clear_button:{title:e.dataset.clear?e.dataset.clear:"Clear all",html:e=>`<div class="${e.className}" id="clear-${s}" title="${e.title}"><i class="icon ${a?"":"p-[0.125rem]"} icon-x-circle-sm ${a?"":" opacity-50"}"></i></div>`}},r.settings.onClear=function(){return e.tomselect.clear(),!0},a&&(r.settings.plugins={...r.settings.plugins,remove_button:{}},r.settings.plugins={...r.settings.plugins,caret_position:{}}),r.settings=Object.assign(d,r.settings),null!==s){const t=new(o())("#"+s,r.settings);switch(t.wrapper.classList.remove(g.Do.component.tomselect.ident),t.wrapper.classList.remove("js"),t.wrapper.setAttribute("data-component","tom-select"),l){case g.Jn.taxo:t.on("item_add",((e,t)=>{null!==t&&t.classList.add("new")}));break;case g.Jn.project:e.dataset.dest&&t.on("item_add",((n,s)=>{if(n!=e.dataset.value&&t.options[n]&&!s.querySelector("a")){const e={A:"/prj/",V:"/prj/",M:"/gui/prj/edit/"},i=t.options[n].rights,a=Object.keys(i);a&&(a.length>1?(Object.entries(i).forEach((([e,t])=>{s.insertAdjacentHTML("beforeend",` <a data-k="${e}" class="small-caps font-normal ml-2">${t}</a>`)})),s.querySelectorAll("a").forEach((s=>{s.addEventListener("click",(s=>{s.preventDefault(),s.stopPropagation(),window.open(e[s.target.dataset.k]+n,`_proj${n}`).focus(),t.removeItem(n)}))}))):(window.open(e[a[0]]+n,`_proj${n}`).focus(),t.removeItem(n)))}}))}return t}console.log("noid")}getUserList(){return h}}}}]);