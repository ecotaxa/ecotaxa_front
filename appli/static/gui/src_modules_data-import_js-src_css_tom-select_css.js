/*! For license information please see src_modules_data-import_js-src_css_tom-select_css.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["src_modules_data-import_js-src_css_tom-select_css"],{"./src/modules/data-import.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"DataImport\": () => (/* binding */ DataImport)\n/* harmony export */ });\n/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! dompurify */ \"./node_modules/dompurify/dist/purify.js\");\n/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(dompurify__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _modules_js_tom_select_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../modules/js-tom-select.js */ \"./src/modules/js-tom-select.js\");\n/* harmony import */ var _modules_project_privileges_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../modules/project-privileges.js */ \"./src/modules/project-privileges.js\");\n/* harmony import */ var _modules_utils_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../modules/utils.js */ \"./src/modules/utils.js\");\n/* harmony import */ var _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../modules/modules-config.js */ \"./src/modules/modules-config.js\");\n\n\n\n\n\nconst key_privileges = Object.keys(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.defined_privileges).reduce(function(result, key) {\n  result[key] = key;\n  return result;\n}, {});\nlet instance;\nclass DataImport {\n  content_selector = '.modal-content';\n  imports = [];\n  taxos = [\"preset\", \"extra\"];\n  importcontainer;\n  importzoneid;\n  importid = 'importzone';\n  selectors;\n  button;\n  clearbutton;\n  replacebutton;\n  tabbutton;\n  doc = null;\n  constructor(grid, what = '', selector = null) {\n    if (!grid) return;\n    const doc = (typeof(grid) === 'object') ? grid.dom : document.querySelector(grid);\n    if (!doc) return;\n    what = dompurify__WEBPACK_IMPORTED_MODULE_0___default().sanitize(what);\n    if (!instance || instance.doc !== doc) {\n      // defaultoptions - keep like that\n      const options = {\n        importcontainer: '#data-import-' + what,\n        btns: '.btns-imports',\n        button: '#add-import-' + what,\n        replacebutton: '#replace-import-' + what,\n        clearbutton: \"#clear-import-\" + what,\n        tabbutton: '#tab-import-' + what,\n        selector: 'data-id',\n\n      };\n      this.doc = doc;\n      this.selector = (selector) ? selector : options.selector;\n      this.importcontainer = options.importcontainer instanceof HTMLElement ? options.importcontainer : document.querySelector(options.importcontainer);\n      this.form = (options.form) ? ((options.form) instanceof HTMLElement ? options.form : document.querySelector(options.form)) : this.doc.closest('form');\n      this.button = options.button instanceof HTMLElement ? options.button : document.querySelector(options.button);\n      this.replacebutton = options.replacebutton instanceof HTMLElement ? options.replacebutton : document.querySelector(options.replacebutton);\n      this.clearbutton = options.clearbutton instanceof HTMLElement ? options.clearbutton : document.querySelector(options.clearbutton);\n      this.tabbutton = options.tabbutton instanceof HTMLElement ? options.tabbutton : document.querySelector(options.tabbutton);\n      this.init(grid, options);\n      instance = this;\n\n    }\n    return instance;\n  }\n\n  init(grid, options) {\n\n    // hide importzone\n    this.showImport(false);\n    // remove line of target proj\n\n    let projid = this.form.querySelector('#' + _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.domselectors.projid);\n    if (projid && projid.value) {\n      projid = this.doc.querySelector('[' + this.selector + '=\"' + projid.value + '\"]');\n      if (projid) projid.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.hide);\n\n    }\n    const indextocheck = this.indexToCheck(grid);\n    this.selectors = this.doc.querySelectorAll('[' + this.selector + '] button, [' + this.selector + '] input');\n    this.selectors.forEach(selector => {\n      // checkbox possible\n      const index = Array.from(selector.parentElement.children).indexOf((selector));\n      if (indextocheck && selector.closest('tr').children[indextocheck[index]].innerHTML === '') selector.disabled = true;\n      else {\n        const evt = (selector.tagName.toLowerCase() === 'input') ? 'change' : 'click';\n        const apply_selection = (e) => {\n          const target = e.currentTarget;\n          target.disabled = true;\n          this.toImport(grid, target.parentElement, index);\n        };\n        selector.removeEventListener(evt, apply_selection, false);\n        selector.addEventListener(evt, apply_selection, false);\n      };\n    });\n\n\n    if (this.button) {\n      this.tabbutton.addEventListener('click', (e) => {\n        this.resizeZone(e);\n      });\n      this.showImport(false);\n    }\n  }\n\n  toImport(grid, col, whatpart = 0) {\n    const thcells = Array.from(this.doc.querySelectorAll('thead th'));\n    const rows = Array.from(this.doc.querySelectorAll('tbody tr'));\n    const datajson = grid.data.data; // cell values in json  - no parse\n    if (col.tagName.toLowerCase() !== 'td') col = col.closest('td');\n    const rowindex = (col.parentElement) ? col.parentElement.dataset.index : null;\n    if (rowindex === null) return;\n    let showbtns = true;\n    const cellindex = col.cellIndex; // change cellIndex to TableColIndex if no table component\n    const th = thcells[cellindex];\n    const cols = rows[rowindex];\n    const what = th.dataset.what;\n    if (!what) return;\n    const parts = (th.dataset.parts) ? th.dataset.parts.split(',') : null;\n    let contact = null;\n    const selectcells = (th.dataset.selectcells) ? ((th.dataset.parts) ? [th.dataset.parts.split(',')[whatpart]] : th.dataset.selectcells.split(',')) : null;\n    if (!selectcells) return;\n    if (what === _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.typeimport.settings) this.imports[_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.models.contact] = this.findContact(thcells, datajson[rowindex]);\n    const importzone = (what === _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.typeimport.taxo || what === _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.typeimport.privileges) ? this.createImportzone(what) : null;\n    selectcells.forEach((name, index) => {\n      index = null;\n      thcells.every((t, idx) => {\n        if (t.dataset.name === name) {\n          index = idx;\n          return false;\n        }\n        return true;\n      });\n\n      if (index !== null) {\n        // show import buttons if importzone\n\n        const cell = rows[rowindex].cells[index];\n        const celldata = datajson[rowindex][index].data;\n        cell.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.selected);\n        const thcell = thcells[index];\n        switch (what) {\n          case _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.typeimport.taxo:\n            // accumulate and show in import win - move the form field in modal win to view the changes and benefit of tom-select component functs...\n            const ts = importzone.tomselect;\n            let taxons = celldata;\n            if (taxons) {\n              if (ts) {\n                // merge taxons and options - unique\n                Object.values(ts.options).forEach((opt) => {\n                  let obj = {};\n                  obj[opt[ts.settings.valueField]] = opt[ts.settings.labelField];\n                  if (!taxons[opt[ts.settings.valueField]]) taxons = Object.assign(taxons, obj);\n                });\n                taxons = Object.entries(taxons);\n                // sort taxons\n                taxons.sort((a, b) => {\n                  let x = a[1];\n                  let y = b[1];\n                  return +(x > y) || -(y > x);\n                });\n                ts.clear();\n                ts.clearOptions();\n                // add taxons items\n                taxons.forEach(([key, text]) => {\n                  if (!ts.getItem(key)) {\n                    if (!ts.getOption(key)) {\n                      let obj = {};\n                      obj[ts.settings.valueField] = key;\n                      obj[ts.settings.labelField] = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_3__.unescape_html)(text.trim());\n                      ts.addOption(obj);\n                    }\n                    ts.addItem(key);\n                  }\n                });\n              } else {\n                Object.values(importzone.options).forEach(opt => {\n                  let obj = {};\n                  obj[opt.value] = opt.text;\n                  if (!taxons[opt.value]) taxons = Object.assign(taxons, obj);\n                });\n                taxons = Object.entries(taxons);\n                taxons.sort((a, b) => {\n                  let x = a[1];\n                  let y = b[1];\n                  return +(x > y) || -(y > x);\n                });\n                importzone.innerHTML = ``;\n                taxons.forEach(([key, text]) => {\n                  if (!importzone.querySelector('option[value=\"' + key + '\"]')) importzone.insertAdjacentHTML('beforeend', '<option value=\"' + key + '\" selected>' + text + '</option>');\n                });\n              }\n              showbtns = (taxons.length > 0);\n              taxons = null;\n            }\n\n            break;\n          case _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.typeimport.privileges:\n            const privs = celldata;\n            // set everybody to 'view' if more than one project imported\n            const resetpriv = ((importzone.tomselect && importzone.tomselect.items.length > 0) || (importzone.selectedIndex > 0));\n\n            if (!importzone.dataset.init) {\n              Object.keys(privs).forEach(priv => {\n                importzone.insertAdjacentHTML('afterbegin', `<optgroup value=\"${priv}\" label=\"${priv}\"></optgroup>`);\n              });\n              const jsTomSelect = new _modules_js_tom_select_js__WEBPACK_IMPORTED_MODULE_1__.JsTomSelect();\n              jsTomSelect.applyTo(importzone);\n              importzone.dataset.init = true;\n            }\n\n            if (importzone.tomselect) {\n              // add members grouped by priv\n              const members = [...importzone.tomselect.items];\n              members.forEach(member => {\n                member = importzone.tomselect.options[member];\n                if (member) {\n                  const priv = (resetpriv) ? key_privileges.viewers : member.optgroup;\n\n                  privs[priv].push({\n                    id: member.id,\n                    name: member.name\n                  });\n                } else this.messageZone(member);\n              });\n\n              importzone.tomselect.clear();\n              importzone.tomselect.refreshOptions();\n\n              Object.entries(privs).forEach(([priv, members]) => {\n                members.sort((a, b) => {\n                  return (b.name > a.name);\n                });\n                members.forEach(member => {\n                  const newpriv = (resetpriv) ? key_privileges.viewers : priv; // viewer if more than one project imported\n                  const optgroup = importzone.querySelector('[value=\"' + newpriv + '\"]');\n                  if (importzone.querySelector('option[value=\"' + member.id + '\"]') === null) {\n                    optgroup.insertAdjacentHTML('afterbegin', `<option value=\"${member.id}\" data-optgroup=${newpriv} selected=\"selected\">${member.name}</option>`);\n                    if (importzone.tomselect && !importzone.tomselect.getOption(member.id)) {\n                      importzone.tomselect.addOption({\n                        id: member.id,\n                        name: (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_3__.unescape_html)(member.name),\n                        optgroup: newpriv\n                      });\n                    }\n                  }\n                  importzone.tomselect.addItem(member.id);\n                });\n\n              });\n\n              showbtns = (importzone.tomselect.items.length > 0);\n            }\n\n            break;\n          default:\n\n            if (thcell.dataset.autocomplete) {\n              // select elements where key / value in different columns\n              this.imports[name] = {\n                value: celldata,\n                key: null\n              };\n              let el = null;\n              thcells.every((t, idx) => {\n                if (t.dataset.name == thcell.dataset.autocomplete) {\n                  el = idx;\n                  return false;\n                }\n                return true;\n              });\n              if (el !== null) {\n                el = datajson[rowindex][el];\n\n                this.imports[name].key = el;\n              }\n            } else if (thcell.dataset.value) this.imports[name] = thcell.dataset.value;\n            else this.imports[name] = celldata;\n\n            break;\n        }\n      };\n\n    });\n\n    if (thcells.length) {\n      if (this.button) {\n        this.showImport(showbtns);\n        if (!this.button.dataset.activated && (what === _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.typeimport.taxo || what === _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.typeimport.privileges)) this.activateButtons(what, selectcells);\n      } else this.makeImport(null, selectcells, what, true);\n    }\n    //\n\n  }\n  messageZone(item) {\n    console.log('itemmessage', item);\n  }\n  activateButtons(what, selectcells) {\n\n    this.button.addEventListener('click', (e) => {\n      e.preventDefault();\n      this.makeImport(e.currentTarget, selectcells, what, true);\n\n    });\n    this.replacebutton.addEventListener('click', (e) => {\n      e.preventDefault();\n      this.makeImport(e.currentTarget, selectcells, what, true);\n\n    });\n    this.clearbutton.addEventListener('click', (e) => {\n      if (!this.importcontainer) return;\n      const field = this.importcontainer.querySelector('#' + this.importid);\n      if (field) {\n        if (field.tomselect) {\n          field.tomselect.clear();\n          field.tomselect.refreshOptions();\n        } else field.value = '';\n      }\n      this.selectors.forEach(selector => {\n        if (selector.disabled) {\n          selector.disabled = false;\n          selector.closest('tr').querySelectorAll('.selected').forEach(el => {\n            el.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.selected);\n          });\n        }\n      });\n      this.button.disabled = false;\n      this.replacebutton.disabled = false;\n      //this.showImport(false);\n    });\n    this.button.dataset.activated = true;\n    this.replacebutton.dataset.activated = true;\n  }\n\n  findContact(thcells, cols) {\n    let contact = null;\n    thcells.every((t, idx) => {\n      if (t.dataset.name && t.dataset.name === _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.models.contact) {\n        contact = idx;\n        return false;\n      }\n      return true;\n    });\n    //if (contact) contact = cols[contact] ? JSON.parse(cols[contact].data.trim()) : 0;\n    if (contact) contact = cols[contact] ? cols[contact] : 0;\n\n    return contact;\n  }\n\n  renderPrivileges(importzone, clear = false) {\n    let privileges = {};\n    const tzone = importzone.tomselect;\n    const pushpriv = (member, priv) => {\n      const obj = {\n        id: member.id,\n        name: member.name,\n        priv: priv\n      }\n      if (privileges[priv]) privileges[priv].push(obj);\n      else privileges[priv] = [obj];\n    }\n    if (tzone) {\n      const members = [...tzone.items];\n      const options = Object.assign({}, tzone.options);\n      members.forEach(member => {\n        member = options[member];\n        if (member) pushpriv(member, member.optgroup);\n\n      })\n    } else {\n      importzone.options.forEach(member => {\n        if (member.selected) pushpriv(member, member.dataset.optgroup);\n      })\n    }\n\n    if (this.importPrivileges(privileges, clear)) {\n      if (tzone) {\n        tzone.clear();\n        tzone.clearOptions();\n      } else importzone.innerHTML = ``;\n\n    }\n\n  }\n\n  importPrivileges(privileges, clear = false) {\n    const projectPrivileges = new _modules_project_privileges_js__WEBPACK_IMPORTED_MODULE_2__.ProjectPrivileges();\n    const importedtag = (input) => {\n      this.setImportedTag(input, null);\n    }\n    const dismiss = () => {\n      this.dismiss();\n    }\n    const contact = ((this.imports[_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.models.contact]) ? this.imports[_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.models.contact] : null);\n    return (projectPrivileges.importPrivileges(privileges, clear, contact, importedtag, dismiss));\n  }\n\n  createImportzone(name) {\n    this.showImport(true);\n    let importzone = this.importcontainer.querySelector('#' + this.importid);\n\n\n    if (name === _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.typeimport.privileges) {\n      if (!importzone) {\n        importzone = document.createElement('select');\n        this.importid = importzone.id = this.importid + '-' + name;\n        importzone.dataset.type = _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.models.user;\n        importzone.multiple = true;\n        importzone.dataset.priv = true;\n        this.importcontainer.append(importzone);\n\n      }\n    } else {\n      const import_target = (this.form.querySelector('[name=\"' + name + '\"]')) ? this.form.querySelector('[name=\"' + name + '\"]') : this.form.querySelector('[data-importfield=\"' + name + '\"]');\n      const ts = import_target.tomselect;\n\n      if (!importzone) {\n        if (!import_target) return;\n        this.importzoneid = import_target.id;\n        // tomselect ?\n        importzone = import_target.cloneNode();\n        importzone.classList.remove('tomselected');\n        importzone.classList.remove('ts-hidden-accessible');\n        // keep original id to replace data on apply import\n        importzone.dataset.origin = importzone.id;\n        importzone.id = this.importid;\n        importzone.name = this.importid + '_' + importzone.name;\n        this.importcontainer.insertAdjacentHTML('afterbegin', importzone.outerHTML);\n        if (ts) {\n          importzone = this.importcontainer.querySelector('#' + this.importid);\n          const jsTomSelect = new _modules_js_tom_select_js__WEBPACK_IMPORTED_MODULE_1__.JsTomSelect();\n          jsTomSelect.applyTo(importzone);\n        }\n      }\n    }\n\n    return importzone;\n\n  }\n\n  makeImport(btn, selectcells, what, close = false) {\n    let done = false;\n    const importzone = (this.importcontainer) ? this.importcontainer.querySelector('#' + this.importid) : null;\n    switch (what) {\n      case _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.typeimport.taxo:\n\n        if (!importzone) return false;\n        const import_target = this.form.querySelector('#' + importzone.dataset.origin);\n\n        if (!import_target) return false;\n        const ts = import_target.tomselect;\n        if (ts) {\n          // only if replace specified\n          if (btn.dataset.replace && btn.dataset.replace === 'replace') {\n            ts.clear();\n            ts.clearOptions();\n          }\n\n          const tzone = importzone.tomselect;\n          const items = [...tzone.items];\n          const options = Object.assign({}, tzone.options);\n          items.forEach((e, i) => {\n            let el = {};\n            el[ts.settings.valueField] = e;\n            el[ts.settings.searchField] = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_3__.unescape_html)(options[e][ts.settings.searchField]);\n            if (!ts.getOption(e)) ts.addOption(el);\n            ts.addItem(e);\n          });\n          tzone.clear();\n          tzone.clearOptions();\n        } else {\n          if (btn.dataset.replace && btn.dataset.replace === 'replace') import_target.innerHTML = ``;\n          import_target.innerHTML = dompurify__WEBPACK_IMPORTED_MODULE_0___default().sanitize(importzone.innerHTML);\n          importzone.innerHTML = ``;\n\n        }\n\n        done = true;\n        break;\n      case _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.typeimport.privileges:\n        if (!importzone) return false;\n        done = this.renderPrivileges(importzone, (btn.dataset.replace && btn.dataset.replace === 'replace'));\n        break;\n      default:\n        selectcells.forEach((name, index) => {\n          let input = ((this.form.querySelector('[data-importfield=\"' + name + '\"]')) ? this.form.querySelector('[data-importfield=\"' + name + '\"]') : this.form.querySelector('[name=\"' + name + '\"]'));\n\n          if (input && this.imports[name] !== undefined) {\n            const ts = input.tomselect;\n\n            if (name === 'init_classif_list') {\n              let ids = this.imports[name];\n              if (Array.isArray(ids)) ids = ids.join(',');\n              else ids = ids.replace('[', '').replace(']', '').replaceAll(' ', '');\n              if (ids !== '') {\n                if (ts) ts.wrapper.classList.add('wait-for-results');\n                const formData = new FormData();\n                formData.append('idlist', ids);\n                const url = '/search/taxoresolve' //+ new URLSearchParams({'idlist': ids});\n                fetch(url, (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_3__.fetchSettings)({\n                  'method': 'POST',\n                  'body': formData\n                })).then(response =>\n                  response.json()\n                ).then(results => {\n                  if (ts) {\n                    Object.entries(results).forEach(([key, text]) => {\n                      let el = {};\n                      key = dompurify__WEBPACK_IMPORTED_MODULE_0___default().sanitize(key);\n                      text = dompurify__WEBPACK_IMPORTED_MODULE_0___default().sanitize(text);\n                      el[ts.settings.valueField] = key;\n                      el[ts.settings.searchField] = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_3__.unescape_html)(text);\n\n                      ts.addOption(el);\n                      ts.addItem(el[ts.settings.valueField]);\n                    });\n                  } else {\n                    let options = '';\n                    Object.entries(results).forEach(([key, text]) => {\n                      key = dompurify__WEBPACK_IMPORTED_MODULE_0___default().sanitize(key);\n                      text = dompurify__WEBPACK_IMPORTED_MODULE_0___default().sanitize(text);\n                      options += '<option value =\"' + key + '\" selected>' + text + '</option>';\n                    });\n                    input.innerHTML = options;\n                    options = '';\n                  }\n                  results = null;\n                  if (ts) ts.wrapper.classList.remove('wait-for-results');\n                });\n              }\n            } else if (ts) {\n              let el = {};\n              el[ts.settings.valueField] = this.imports[name]['key'];\n              el[ts.settings.searchField] = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_3__.unescape_html)(this.imports[name]['value']);\n              ts.addOption(el);\n              ts.addItem(el[input.tomselect.settings.valueField]);\n              ts.refreshOptions();\n            } else {\n              const type = (input.type) ? input.type : input.tagName.toLowerCase();\n              switch (input.type) {\n                case 'radio':\n                case 'checkbox':\n                  input = this.form.querySelector('[name=\"' + name + '\"][value=\"' + this.imports[name] + '\"]');\n                  if (input) input.checked = true;\n                  break;\n                  /*case 'checkbox':\n                    // TODO ( multiple selection )\n                    this.form.querySelectorAll('[name=\"' + field + '\"]').forEach(input => {\n                      input.checked = (this.imports[name]['key'] === input.value);\n                    });\n                    break;*/\n                case 'select':\n                  // todo select multiple\n                  let option;\n                  if (this.imports[name]['key']) option = '<option value=\"' + this.imports[name]['key'] + '\" selected >' + this.imports[name]['value'] + '</option>';\n                  else option = '<option value=\"' + this.imports[name] + '\" selected >' + this.imports[name] + '</option>'\n                  input.insertAdjacentHTML('beforeend', option);\n                  break;\n                default:\n\n                  input.value = this.imports[name];\n                  break;\n              }\n            }\n            if (what !== _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.typeimport.settings) input.focus();\n            done = true;\n            // set imported tag to fieldbox\n            this.setImportedTag(input);\n          } else if (name === 'privileges') {\n            done = this.importPrivileges(this.imports[name], false);\n          }\n        });\n        break;\n    }\n    if (done === true && close == true) this.dismiss();\n  }\n\n  setImportedTag(input, selector = '.form-box') {\n    let el = (selector === null) ? input : (input.closest(selector) ? input.closest(selector) : input.closest('fieldset'));\n    if (!el) return;\n    el.dataset.isimported = this.form.dataset.isimported;\n    el.classList.add('imported');\n    const removetag = (e) => {\n      el.removeAttribute('data-isimported');\n      el.classList.remove('imported');\n      input.removeEventListener('change keydown', removetag);\n    }\n    input.addEventListener('change keydown', removetag);\n  }\n\n  dismiss(clear = false) {\n    const container = this.doc.closest('details');\n    if (container) {\n      container.open = false;\n      if (clear === true) container.querySelector(this.content_selector).innerHTML = ``;\n    }\n\n  }\n  indexToCheck(grid) {\n    // index of cells to check if empty and disable row  import btn\n    if (grid.headings && grid.headings[0].dataset.what === _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.typeimport.taxo) {\n\n      // if multiple selectors : search index of cell to import - if empty disable the selector\n      const parts = (grid.headings[0].dataset.parts) ? grid.headings[0].dataset.parts.split(',') : null;\n      if (parts) {\n        const indextocheck = grid.headings.filter((heading, i) => {\n          if (parts.indexOf(heading.dataset.name) >= 0) return i;\n        }).map(v => {\n          return v.cellIndex\n        });\n        return indextocheck;\n      }\n    }\n  }\n  // show / hide importzone and buttons\n  showImport(show) {\n    if (!this.button) return;\n\n    if (show === false) {\n      this.button.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.hide);\n      this.replacebutton.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.hide);\n      this.clearbutton.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.hide);\n      this.importcontainer.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.hide);\n      this.tabbutton.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.hide);\n    } else {\n      this.button.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.hide);\n      this.replacebutton.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.hide);\n      this.clearbutton.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.hide);\n      this.importcontainer.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.hide);\n      this.button.disabled = this.clearbutton.disabled = false;\n      const importzone = this.importcontainer.querySelector('#' + this.importid);\n      if (importzone) {\n        this.tabbutton.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.hide);\n        if (importzone.tomselect && importzone.tomselect.control.offsetHeight < importzone.tomselect.control.scrollHeight) {\n          this.tabbutton.disabled = false;\n        } else this.tabbutton.disabled = true;\n      }\n    }\n  }\n  // resize importzone\n  resizeZone(e) {\n    const div = this.importcontainer.closest(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.domselectors.component[\"import\"].zoneimport);\n    if (!div) return;\n    div.parentElement.classList.toggle(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.showfull);\n    const icon = e.currentTarget.querySelector('i');\n    if (icon) {\n      icon.classList.toggle('icon-arrow-pointing-out');\n      icon.classList.toggle('icon-arrow-pointing-in');\n    }\n  }\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLDJEQUEyRCx1RUFBZTs7QUFFMUU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGdDQUFnQyxnRUFBUTtBQUN4Qyx1Q0FBdUMsZ0VBQVE7QUFDL0MscUNBQXFDLGdFQUFRO0FBQzdDLHlDQUF5QyxnRUFBUTtBQUNqRCxtQ0FBbUMsZ0VBQVE7QUFDM0MsTUFBTTtBQUNOLG1DQUFtQyxnRUFBUTtBQUMzQywwQ0FBMEMsZ0VBQVE7QUFDbEQsd0NBQXdDLGdFQUFRO0FBQ2hELDRDQUE0QyxnRUFBUTtBQUNwRDtBQUNBO0FBQ0E7QUFDQSx3Q0FBd0MsZ0VBQVE7QUFDaEQ7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkNBQTZDLG1HQUF3QztBQUNyRjtBQUNBLHVDQUF1QyxvRUFBWTtBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9tb2R1bGVzL2RhdGEtaW1wb3J0LmpzPzgwYTIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IERPTVB1cmlmeSBmcm9tICdkb21wdXJpZnknO1xuaW1wb3J0IHtcbiAgSnNUb21TZWxlY3Rcbn0gZnJvbSBcIi4uL21vZHVsZXMvanMtdG9tLXNlbGVjdC5qc1wiO1xuaW1wb3J0IHtcbiAgUHJvamVjdFByaXZpbGVnZXNcbn0gZnJvbSAnLi4vbW9kdWxlcy9wcm9qZWN0LXByaXZpbGVnZXMuanMnO1xuaW1wb3J0IHtcbiAgZmV0Y2hTZXR0aW5ncyxcbiAgdW5lc2NhcGVfaHRtbCxcblxufSBmcm9tICcuLi9tb2R1bGVzL3V0aWxzLmpzJztcbmltcG9ydCB7XG4gIG1vZGVscyxcbiAgdHlwZWltcG9ydCxcbiAgY3NzLFxuICBkZWZpbmVkX3ByaXZpbGVnZXMsXG4gIGRvbXNlbGVjdG9yc1xufSBmcm9tICcuLi9tb2R1bGVzL21vZHVsZXMtY29uZmlnLmpzJztcbmNvbnN0IGtleV9wcml2aWxlZ2VzID0gT2JqZWN0LmtleXMoZGVmaW5lZF9wcml2aWxlZ2VzKS5yZWR1Y2UoZnVuY3Rpb24ocmVzdWx0LCBrZXkpIHtcbiAgcmVzdWx0W2tleV0gPSBrZXk7XG4gIHJldHVybiByZXN1bHQ7XG59LCB7fSk7XG5sZXQgaW5zdGFuY2U7XG5leHBvcnQgY2xhc3MgRGF0YUltcG9ydCB7XG4gIGNvbnRlbnRfc2VsZWN0b3IgPSAnLm1vZGFsLWNvbnRlbnQnO1xuICBpbXBvcnRzID0gW107XG4gIHRheG9zID0gW1wicHJlc2V0XCIsIFwiZXh0cmFcIl07XG4gIGltcG9ydGNvbnRhaW5lcjtcbiAgaW1wb3J0em9uZWlkO1xuICBpbXBvcnRpZCA9ICdpbXBvcnR6b25lJztcbiAgc2VsZWN0b3JzO1xuICBidXR0b247XG4gIGNsZWFyYnV0dG9uO1xuICByZXBsYWNlYnV0dG9uO1xuICB0YWJidXR0b247XG4gIGRvYyA9IG51bGw7XG4gIGNvbnN0cnVjdG9yKGdyaWQsIHdoYXQgPSAnJywgc2VsZWN0b3IgPSBudWxsKSB7XG4gICAgaWYgKCFncmlkKSByZXR1cm47XG4gICAgY29uc3QgZG9jID0gKHR5cGVvZihncmlkKSA9PT0gJ29iamVjdCcpID8gZ3JpZC5kb20gOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGdyaWQpO1xuICAgIGlmICghZG9jKSByZXR1cm47XG4gICAgd2hhdCA9IERPTVB1cmlmeS5zYW5pdGl6ZSh3aGF0KTtcbiAgICBpZiAoIWluc3RhbmNlIHx8IGluc3RhbmNlLmRvYyAhPT0gZG9jKSB7XG4gICAgICAvLyBkZWZhdWx0b3B0aW9ucyAtIGtlZXAgbGlrZSB0aGF0XG4gICAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgICBpbXBvcnRjb250YWluZXI6ICcjZGF0YS1pbXBvcnQtJyArIHdoYXQsXG4gICAgICAgIGJ0bnM6ICcuYnRucy1pbXBvcnRzJyxcbiAgICAgICAgYnV0dG9uOiAnI2FkZC1pbXBvcnQtJyArIHdoYXQsXG4gICAgICAgIHJlcGxhY2VidXR0b246ICcjcmVwbGFjZS1pbXBvcnQtJyArIHdoYXQsXG4gICAgICAgIGNsZWFyYnV0dG9uOiBcIiNjbGVhci1pbXBvcnQtXCIgKyB3aGF0LFxuICAgICAgICB0YWJidXR0b246ICcjdGFiLWltcG9ydC0nICsgd2hhdCxcbiAgICAgICAgc2VsZWN0b3I6ICdkYXRhLWlkJyxcblxuICAgICAgfTtcbiAgICAgIHRoaXMuZG9jID0gZG9jO1xuICAgICAgdGhpcy5zZWxlY3RvciA9IChzZWxlY3RvcikgPyBzZWxlY3RvciA6IG9wdGlvbnMuc2VsZWN0b3I7XG4gICAgICB0aGlzLmltcG9ydGNvbnRhaW5lciA9IG9wdGlvbnMuaW1wb3J0Y29udGFpbmVyIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQgPyBvcHRpb25zLmltcG9ydGNvbnRhaW5lciA6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Iob3B0aW9ucy5pbXBvcnRjb250YWluZXIpO1xuICAgICAgdGhpcy5mb3JtID0gKG9wdGlvbnMuZm9ybSkgPyAoKG9wdGlvbnMuZm9ybSkgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCA/IG9wdGlvbnMuZm9ybSA6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Iob3B0aW9ucy5mb3JtKSkgOiB0aGlzLmRvYy5jbG9zZXN0KCdmb3JtJyk7XG4gICAgICB0aGlzLmJ1dHRvbiA9IG9wdGlvbnMuYnV0dG9uIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQgPyBvcHRpb25zLmJ1dHRvbiA6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Iob3B0aW9ucy5idXR0b24pO1xuICAgICAgdGhpcy5yZXBsYWNlYnV0dG9uID0gb3B0aW9ucy5yZXBsYWNlYnV0dG9uIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQgPyBvcHRpb25zLnJlcGxhY2VidXR0b24gOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG9wdGlvbnMucmVwbGFjZWJ1dHRvbik7XG4gICAgICB0aGlzLmNsZWFyYnV0dG9uID0gb3B0aW9ucy5jbGVhcmJ1dHRvbiBpbnN0YW5jZW9mIEhUTUxFbGVtZW50ID8gb3B0aW9ucy5jbGVhcmJ1dHRvbiA6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Iob3B0aW9ucy5jbGVhcmJ1dHRvbik7XG4gICAgICB0aGlzLnRhYmJ1dHRvbiA9IG9wdGlvbnMudGFiYnV0dG9uIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQgPyBvcHRpb25zLnRhYmJ1dHRvbiA6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Iob3B0aW9ucy50YWJidXR0b24pO1xuICAgICAgdGhpcy5pbml0KGdyaWQsIG9wdGlvbnMpO1xuICAgICAgaW5zdGFuY2UgPSB0aGlzO1xuXG4gICAgfVxuICAgIHJldHVybiBpbnN0YW5jZTtcbiAgfVxuXG4gIGluaXQoZ3JpZCwgb3B0aW9ucykge1xuXG4gICAgLy8gaGlkZSBpbXBvcnR6b25lXG4gICAgdGhpcy5zaG93SW1wb3J0KGZhbHNlKTtcbiAgICAvLyByZW1vdmUgbGluZSBvZiB0YXJnZXQgcHJvalxuXG4gICAgbGV0IHByb2ppZCA9IHRoaXMuZm9ybS5xdWVyeVNlbGVjdG9yKCcjJyArIGRvbXNlbGVjdG9ycy5wcm9qaWQpO1xuICAgIGlmIChwcm9qaWQgJiYgcHJvamlkLnZhbHVlKSB7XG4gICAgICBwcm9qaWQgPSB0aGlzLmRvYy5xdWVyeVNlbGVjdG9yKCdbJyArIHRoaXMuc2VsZWN0b3IgKyAnPVwiJyArIHByb2ppZC52YWx1ZSArICdcIl0nKTtcbiAgICAgIGlmIChwcm9qaWQpIHByb2ppZC5jbGFzc0xpc3QuYWRkKGNzcy5oaWRlKTtcblxuICAgIH1cbiAgICBjb25zdCBpbmRleHRvY2hlY2sgPSB0aGlzLmluZGV4VG9DaGVjayhncmlkKTtcbiAgICB0aGlzLnNlbGVjdG9ycyA9IHRoaXMuZG9jLnF1ZXJ5U2VsZWN0b3JBbGwoJ1snICsgdGhpcy5zZWxlY3RvciArICddIGJ1dHRvbiwgWycgKyB0aGlzLnNlbGVjdG9yICsgJ10gaW5wdXQnKTtcbiAgICB0aGlzLnNlbGVjdG9ycy5mb3JFYWNoKHNlbGVjdG9yID0+IHtcbiAgICAgIC8vIGNoZWNrYm94IHBvc3NpYmxlXG4gICAgICBjb25zdCBpbmRleCA9IEFycmF5LmZyb20oc2VsZWN0b3IucGFyZW50RWxlbWVudC5jaGlsZHJlbikuaW5kZXhPZigoc2VsZWN0b3IpKTtcbiAgICAgIGlmIChpbmRleHRvY2hlY2sgJiYgc2VsZWN0b3IuY2xvc2VzdCgndHInKS5jaGlsZHJlbltpbmRleHRvY2hlY2tbaW5kZXhdXS5pbm5lckhUTUwgPT09ICcnKSBzZWxlY3Rvci5kaXNhYmxlZCA9IHRydWU7XG4gICAgICBlbHNlIHtcbiAgICAgICAgY29uc3QgZXZ0ID0gKHNlbGVjdG9yLnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PT0gJ2lucHV0JykgPyAnY2hhbmdlJyA6ICdjbGljayc7XG4gICAgICAgIGNvbnN0IGFwcGx5X3NlbGVjdGlvbiA9IChlKSA9PiB7XG4gICAgICAgICAgY29uc3QgdGFyZ2V0ID0gZS5jdXJyZW50VGFyZ2V0O1xuICAgICAgICAgIHRhcmdldC5kaXNhYmxlZCA9IHRydWU7XG4gICAgICAgICAgdGhpcy50b0ltcG9ydChncmlkLCB0YXJnZXQucGFyZW50RWxlbWVudCwgaW5kZXgpO1xuICAgICAgICB9O1xuICAgICAgICBzZWxlY3Rvci5yZW1vdmVFdmVudExpc3RlbmVyKGV2dCwgYXBwbHlfc2VsZWN0aW9uLCBmYWxzZSk7XG4gICAgICAgIHNlbGVjdG9yLmFkZEV2ZW50TGlzdGVuZXIoZXZ0LCBhcHBseV9zZWxlY3Rpb24sIGZhbHNlKTtcbiAgICAgIH07XG4gICAgfSk7XG5cblxuICAgIGlmICh0aGlzLmJ1dHRvbikge1xuICAgICAgdGhpcy50YWJidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgICB0aGlzLnJlc2l6ZVpvbmUoZSk7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuc2hvd0ltcG9ydChmYWxzZSk7XG4gICAgfVxuICB9XG5cbiAgdG9JbXBvcnQoZ3JpZCwgY29sLCB3aGF0cGFydCA9IDApIHtcbiAgICBjb25zdCB0aGNlbGxzID0gQXJyYXkuZnJvbSh0aGlzLmRvYy5xdWVyeVNlbGVjdG9yQWxsKCd0aGVhZCB0aCcpKTtcbiAgICBjb25zdCByb3dzID0gQXJyYXkuZnJvbSh0aGlzLmRvYy5xdWVyeVNlbGVjdG9yQWxsKCd0Ym9keSB0cicpKTtcbiAgICBjb25zdCBkYXRhanNvbiA9IGdyaWQuZGF0YS5kYXRhOyAvLyBjZWxsIHZhbHVlcyBpbiBqc29uICAtIG5vIHBhcnNlXG4gICAgaWYgKGNvbC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgIT09ICd0ZCcpIGNvbCA9IGNvbC5jbG9zZXN0KCd0ZCcpO1xuICAgIGNvbnN0IHJvd2luZGV4ID0gKGNvbC5wYXJlbnRFbGVtZW50KSA/IGNvbC5wYXJlbnRFbGVtZW50LmRhdGFzZXQuaW5kZXggOiBudWxsO1xuICAgIGlmIChyb3dpbmRleCA9PT0gbnVsbCkgcmV0dXJuO1xuICAgIGxldCBzaG93YnRucyA9IHRydWU7XG4gICAgY29uc3QgY2VsbGluZGV4ID0gY29sLmNlbGxJbmRleDsgLy8gY2hhbmdlIGNlbGxJbmRleCB0byBUYWJsZUNvbEluZGV4IGlmIG5vIHRhYmxlIGNvbXBvbmVudFxuICAgIGNvbnN0IHRoID0gdGhjZWxsc1tjZWxsaW5kZXhdO1xuICAgIGNvbnN0IGNvbHMgPSByb3dzW3Jvd2luZGV4XTtcbiAgICBjb25zdCB3aGF0ID0gdGguZGF0YXNldC53aGF0O1xuICAgIGlmICghd2hhdCkgcmV0dXJuO1xuICAgIGNvbnN0IHBhcnRzID0gKHRoLmRhdGFzZXQucGFydHMpID8gdGguZGF0YXNldC5wYXJ0cy5zcGxpdCgnLCcpIDogbnVsbDtcbiAgICBsZXQgY29udGFjdCA9IG51bGw7XG4gICAgY29uc3Qgc2VsZWN0Y2VsbHMgPSAodGguZGF0YXNldC5zZWxlY3RjZWxscykgPyAoKHRoLmRhdGFzZXQucGFydHMpID8gW3RoLmRhdGFzZXQucGFydHMuc3BsaXQoJywnKVt3aGF0cGFydF1dIDogdGguZGF0YXNldC5zZWxlY3RjZWxscy5zcGxpdCgnLCcpKSA6IG51bGw7XG4gICAgaWYgKCFzZWxlY3RjZWxscykgcmV0dXJuO1xuICAgIGlmICh3aGF0ID09PSB0eXBlaW1wb3J0LnNldHRpbmdzKSB0aGlzLmltcG9ydHNbbW9kZWxzLmNvbnRhY3RdID0gdGhpcy5maW5kQ29udGFjdCh0aGNlbGxzLCBkYXRhanNvbltyb3dpbmRleF0pO1xuICAgIGNvbnN0IGltcG9ydHpvbmUgPSAod2hhdCA9PT0gdHlwZWltcG9ydC50YXhvIHx8IHdoYXQgPT09IHR5cGVpbXBvcnQucHJpdmlsZWdlcykgPyB0aGlzLmNyZWF0ZUltcG9ydHpvbmUod2hhdCkgOiBudWxsO1xuICAgIHNlbGVjdGNlbGxzLmZvckVhY2goKG5hbWUsIGluZGV4KSA9PiB7XG4gICAgICBpbmRleCA9IG51bGw7XG4gICAgICB0aGNlbGxzLmV2ZXJ5KCh0LCBpZHgpID0+IHtcbiAgICAgICAgaWYgKHQuZGF0YXNldC5uYW1lID09PSBuYW1lKSB7XG4gICAgICAgICAgaW5kZXggPSBpZHg7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSk7XG5cbiAgICAgIGlmIChpbmRleCAhPT0gbnVsbCkge1xuICAgICAgICAvLyBzaG93IGltcG9ydCBidXR0b25zIGlmIGltcG9ydHpvbmVcblxuICAgICAgICBjb25zdCBjZWxsID0gcm93c1tyb3dpbmRleF0uY2VsbHNbaW5kZXhdO1xuICAgICAgICBjb25zdCBjZWxsZGF0YSA9IGRhdGFqc29uW3Jvd2luZGV4XVtpbmRleF0uZGF0YTtcbiAgICAgICAgY2VsbC5jbGFzc0xpc3QuYWRkKGNzcy5zZWxlY3RlZCk7XG4gICAgICAgIGNvbnN0IHRoY2VsbCA9IHRoY2VsbHNbaW5kZXhdO1xuICAgICAgICBzd2l0Y2ggKHdoYXQpIHtcbiAgICAgICAgICBjYXNlIHR5cGVpbXBvcnQudGF4bzpcbiAgICAgICAgICAgIC8vIGFjY3VtdWxhdGUgYW5kIHNob3cgaW4gaW1wb3J0IHdpbiAtIG1vdmUgdGhlIGZvcm0gZmllbGQgaW4gbW9kYWwgd2luIHRvIHZpZXcgdGhlIGNoYW5nZXMgYW5kIGJlbmVmaXQgb2YgdG9tLXNlbGVjdCBjb21wb25lbnQgZnVuY3RzLi4uXG4gICAgICAgICAgICBjb25zdCB0cyA9IGltcG9ydHpvbmUudG9tc2VsZWN0O1xuICAgICAgICAgICAgbGV0IHRheG9ucyA9IGNlbGxkYXRhO1xuICAgICAgICAgICAgaWYgKHRheG9ucykge1xuICAgICAgICAgICAgICBpZiAodHMpIHtcbiAgICAgICAgICAgICAgICAvLyBtZXJnZSB0YXhvbnMgYW5kIG9wdGlvbnMgLSB1bmlxdWVcbiAgICAgICAgICAgICAgICBPYmplY3QudmFsdWVzKHRzLm9wdGlvbnMpLmZvckVhY2goKG9wdCkgPT4ge1xuICAgICAgICAgICAgICAgICAgbGV0IG9iaiA9IHt9O1xuICAgICAgICAgICAgICAgICAgb2JqW29wdFt0cy5zZXR0aW5ncy52YWx1ZUZpZWxkXV0gPSBvcHRbdHMuc2V0dGluZ3MubGFiZWxGaWVsZF07XG4gICAgICAgICAgICAgICAgICBpZiAoIXRheG9uc1tvcHRbdHMuc2V0dGluZ3MudmFsdWVGaWVsZF1dKSB0YXhvbnMgPSBPYmplY3QuYXNzaWduKHRheG9ucywgb2JqKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB0YXhvbnMgPSBPYmplY3QuZW50cmllcyh0YXhvbnMpO1xuICAgICAgICAgICAgICAgIC8vIHNvcnQgdGF4b25zXG4gICAgICAgICAgICAgICAgdGF4b25zLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgICAgICAgICAgIGxldCB4ID0gYVsxXTtcbiAgICAgICAgICAgICAgICAgIGxldCB5ID0gYlsxXTtcbiAgICAgICAgICAgICAgICAgIHJldHVybiArKHggPiB5KSB8fCAtKHkgPiB4KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB0cy5jbGVhcigpO1xuICAgICAgICAgICAgICAgIHRzLmNsZWFyT3B0aW9ucygpO1xuICAgICAgICAgICAgICAgIC8vIGFkZCB0YXhvbnMgaXRlbXNcbiAgICAgICAgICAgICAgICB0YXhvbnMuZm9yRWFjaCgoW2tleSwgdGV4dF0pID0+IHtcbiAgICAgICAgICAgICAgICAgIGlmICghdHMuZ2V0SXRlbShrZXkpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghdHMuZ2V0T3B0aW9uKGtleSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICBsZXQgb2JqID0ge307XG4gICAgICAgICAgICAgICAgICAgICAgb2JqW3RzLnNldHRpbmdzLnZhbHVlRmllbGRdID0ga2V5O1xuICAgICAgICAgICAgICAgICAgICAgIG9ialt0cy5zZXR0aW5ncy5sYWJlbEZpZWxkXSA9IHVuZXNjYXBlX2h0bWwodGV4dC50cmltKCkpO1xuICAgICAgICAgICAgICAgICAgICAgIHRzLmFkZE9wdGlvbihvYmopO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRzLmFkZEl0ZW0oa2V5KTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBPYmplY3QudmFsdWVzKGltcG9ydHpvbmUub3B0aW9ucykuZm9yRWFjaChvcHQgPT4ge1xuICAgICAgICAgICAgICAgICAgbGV0IG9iaiA9IHt9O1xuICAgICAgICAgICAgICAgICAgb2JqW29wdC52YWx1ZV0gPSBvcHQudGV4dDtcbiAgICAgICAgICAgICAgICAgIGlmICghdGF4b25zW29wdC52YWx1ZV0pIHRheG9ucyA9IE9iamVjdC5hc3NpZ24odGF4b25zLCBvYmopO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHRheG9ucyA9IE9iamVjdC5lbnRyaWVzKHRheG9ucyk7XG4gICAgICAgICAgICAgICAgdGF4b25zLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgICAgICAgICAgIGxldCB4ID0gYVsxXTtcbiAgICAgICAgICAgICAgICAgIGxldCB5ID0gYlsxXTtcbiAgICAgICAgICAgICAgICAgIHJldHVybiArKHggPiB5KSB8fCAtKHkgPiB4KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpbXBvcnR6b25lLmlubmVySFRNTCA9IGBgO1xuICAgICAgICAgICAgICAgIHRheG9ucy5mb3JFYWNoKChba2V5LCB0ZXh0XSkgPT4ge1xuICAgICAgICAgICAgICAgICAgaWYgKCFpbXBvcnR6b25lLnF1ZXJ5U2VsZWN0b3IoJ29wdGlvblt2YWx1ZT1cIicgKyBrZXkgKyAnXCJdJykpIGltcG9ydHpvbmUuaW5zZXJ0QWRqYWNlbnRIVE1MKCdiZWZvcmVlbmQnLCAnPG9wdGlvbiB2YWx1ZT1cIicgKyBrZXkgKyAnXCIgc2VsZWN0ZWQ+JyArIHRleHQgKyAnPC9vcHRpb24+Jyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgc2hvd2J0bnMgPSAodGF4b25zLmxlbmd0aCA+IDApO1xuICAgICAgICAgICAgICB0YXhvbnMgPSBudWxsO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIHR5cGVpbXBvcnQucHJpdmlsZWdlczpcbiAgICAgICAgICAgIGNvbnN0IHByaXZzID0gY2VsbGRhdGE7XG4gICAgICAgICAgICAvLyBzZXQgZXZlcnlib2R5IHRvICd2aWV3JyBpZiBtb3JlIHRoYW4gb25lIHByb2plY3QgaW1wb3J0ZWRcbiAgICAgICAgICAgIGNvbnN0IHJlc2V0cHJpdiA9ICgoaW1wb3J0em9uZS50b21zZWxlY3QgJiYgaW1wb3J0em9uZS50b21zZWxlY3QuaXRlbXMubGVuZ3RoID4gMCkgfHwgKGltcG9ydHpvbmUuc2VsZWN0ZWRJbmRleCA+IDApKTtcblxuICAgICAgICAgICAgaWYgKCFpbXBvcnR6b25lLmRhdGFzZXQuaW5pdCkge1xuICAgICAgICAgICAgICBPYmplY3Qua2V5cyhwcml2cykuZm9yRWFjaChwcml2ID0+IHtcbiAgICAgICAgICAgICAgICBpbXBvcnR6b25lLmluc2VydEFkamFjZW50SFRNTCgnYWZ0ZXJiZWdpbicsIGA8b3B0Z3JvdXAgdmFsdWU9XCIke3ByaXZ9XCIgbGFiZWw9XCIke3ByaXZ9XCI+PC9vcHRncm91cD5gKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIGNvbnN0IGpzVG9tU2VsZWN0ID0gbmV3IEpzVG9tU2VsZWN0KCk7XG4gICAgICAgICAgICAgIGpzVG9tU2VsZWN0LmFwcGx5VG8oaW1wb3J0em9uZSk7XG4gICAgICAgICAgICAgIGltcG9ydHpvbmUuZGF0YXNldC5pbml0ID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGltcG9ydHpvbmUudG9tc2VsZWN0KSB7XG4gICAgICAgICAgICAgIC8vIGFkZCBtZW1iZXJzIGdyb3VwZWQgYnkgcHJpdlxuICAgICAgICAgICAgICBjb25zdCBtZW1iZXJzID0gWy4uLmltcG9ydHpvbmUudG9tc2VsZWN0Lml0ZW1zXTtcbiAgICAgICAgICAgICAgbWVtYmVycy5mb3JFYWNoKG1lbWJlciA9PiB7XG4gICAgICAgICAgICAgICAgbWVtYmVyID0gaW1wb3J0em9uZS50b21zZWxlY3Qub3B0aW9uc1ttZW1iZXJdO1xuICAgICAgICAgICAgICAgIGlmIChtZW1iZXIpIHtcbiAgICAgICAgICAgICAgICAgIGNvbnN0IHByaXYgPSAocmVzZXRwcml2KSA/IGtleV9wcml2aWxlZ2VzLnZpZXdlcnMgOiBtZW1iZXIub3B0Z3JvdXA7XG5cbiAgICAgICAgICAgICAgICAgIHByaXZzW3ByaXZdLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBpZDogbWVtYmVyLmlkLFxuICAgICAgICAgICAgICAgICAgICBuYW1lOiBtZW1iZXIubmFtZVxuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHRoaXMubWVzc2FnZVpvbmUobWVtYmVyKTtcbiAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgaW1wb3J0em9uZS50b21zZWxlY3QuY2xlYXIoKTtcbiAgICAgICAgICAgICAgaW1wb3J0em9uZS50b21zZWxlY3QucmVmcmVzaE9wdGlvbnMoKTtcblxuICAgICAgICAgICAgICBPYmplY3QuZW50cmllcyhwcml2cykuZm9yRWFjaCgoW3ByaXYsIG1lbWJlcnNdKSA9PiB7XG4gICAgICAgICAgICAgICAgbWVtYmVycy5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gKGIubmFtZSA+IGEubmFtZSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgbWVtYmVycy5mb3JFYWNoKG1lbWJlciA9PiB7XG4gICAgICAgICAgICAgICAgICBjb25zdCBuZXdwcml2ID0gKHJlc2V0cHJpdikgPyBrZXlfcHJpdmlsZWdlcy52aWV3ZXJzIDogcHJpdjsgLy8gdmlld2VyIGlmIG1vcmUgdGhhbiBvbmUgcHJvamVjdCBpbXBvcnRlZFxuICAgICAgICAgICAgICAgICAgY29uc3Qgb3B0Z3JvdXAgPSBpbXBvcnR6b25lLnF1ZXJ5U2VsZWN0b3IoJ1t2YWx1ZT1cIicgKyBuZXdwcml2ICsgJ1wiXScpO1xuICAgICAgICAgICAgICAgICAgaWYgKGltcG9ydHpvbmUucXVlcnlTZWxlY3Rvcignb3B0aW9uW3ZhbHVlPVwiJyArIG1lbWJlci5pZCArICdcIl0nKSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBvcHRncm91cC5pbnNlcnRBZGphY2VudEhUTUwoJ2FmdGVyYmVnaW4nLCBgPG9wdGlvbiB2YWx1ZT1cIiR7bWVtYmVyLmlkfVwiIGRhdGEtb3B0Z3JvdXA9JHtuZXdwcml2fSBzZWxlY3RlZD1cInNlbGVjdGVkXCI+JHttZW1iZXIubmFtZX08L29wdGlvbj5gKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGltcG9ydHpvbmUudG9tc2VsZWN0ICYmICFpbXBvcnR6b25lLnRvbXNlbGVjdC5nZXRPcHRpb24obWVtYmVyLmlkKSkge1xuICAgICAgICAgICAgICAgICAgICAgIGltcG9ydHpvbmUudG9tc2VsZWN0LmFkZE9wdGlvbih7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogbWVtYmVyLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogdW5lc2NhcGVfaHRtbChtZW1iZXIubmFtZSksXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRncm91cDogbmV3cHJpdlxuICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICBpbXBvcnR6b25lLnRvbXNlbGVjdC5hZGRJdGVtKG1lbWJlci5pZCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgc2hvd2J0bnMgPSAoaW1wb3J0em9uZS50b21zZWxlY3QuaXRlbXMubGVuZ3RoID4gMCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGRlZmF1bHQ6XG5cbiAgICAgICAgICAgIGlmICh0aGNlbGwuZGF0YXNldC5hdXRvY29tcGxldGUpIHtcbiAgICAgICAgICAgICAgLy8gc2VsZWN0IGVsZW1lbnRzIHdoZXJlIGtleSAvIHZhbHVlIGluIGRpZmZlcmVudCBjb2x1bW5zXG4gICAgICAgICAgICAgIHRoaXMuaW1wb3J0c1tuYW1lXSA9IHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogY2VsbGRhdGEsXG4gICAgICAgICAgICAgICAga2V5OiBudWxsXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgIGxldCBlbCA9IG51bGw7XG4gICAgICAgICAgICAgIHRoY2VsbHMuZXZlcnkoKHQsIGlkeCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh0LmRhdGFzZXQubmFtZSA9PSB0aGNlbGwuZGF0YXNldC5hdXRvY29tcGxldGUpIHtcbiAgICAgICAgICAgICAgICAgIGVsID0gaWR4O1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIGlmIChlbCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGVsID0gZGF0YWpzb25bcm93aW5kZXhdW2VsXTtcblxuICAgICAgICAgICAgICAgIHRoaXMuaW1wb3J0c1tuYW1lXS5rZXkgPSBlbDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGNlbGwuZGF0YXNldC52YWx1ZSkgdGhpcy5pbXBvcnRzW25hbWVdID0gdGhjZWxsLmRhdGFzZXQudmFsdWU7XG4gICAgICAgICAgICBlbHNlIHRoaXMuaW1wb3J0c1tuYW1lXSA9IGNlbGxkYXRhO1xuXG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgIH0pO1xuXG4gICAgaWYgKHRoY2VsbHMubGVuZ3RoKSB7XG4gICAgICBpZiAodGhpcy5idXR0b24pIHtcbiAgICAgICAgdGhpcy5zaG93SW1wb3J0KHNob3didG5zKTtcbiAgICAgICAgaWYgKCF0aGlzLmJ1dHRvbi5kYXRhc2V0LmFjdGl2YXRlZCAmJiAod2hhdCA9PT0gdHlwZWltcG9ydC50YXhvIHx8IHdoYXQgPT09IHR5cGVpbXBvcnQucHJpdmlsZWdlcykpIHRoaXMuYWN0aXZhdGVCdXR0b25zKHdoYXQsIHNlbGVjdGNlbGxzKTtcbiAgICAgIH0gZWxzZSB0aGlzLm1ha2VJbXBvcnQobnVsbCwgc2VsZWN0Y2VsbHMsIHdoYXQsIHRydWUpO1xuICAgIH1cbiAgICAvL1xuXG4gIH1cbiAgbWVzc2FnZVpvbmUoaXRlbSkge1xuICAgIGNvbnNvbGUubG9nKCdpdGVtbWVzc2FnZScsIGl0ZW0pO1xuICB9XG4gIGFjdGl2YXRlQnV0dG9ucyh3aGF0LCBzZWxlY3RjZWxscykge1xuXG4gICAgdGhpcy5idXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgdGhpcy5tYWtlSW1wb3J0KGUuY3VycmVudFRhcmdldCwgc2VsZWN0Y2VsbHMsIHdoYXQsIHRydWUpO1xuXG4gICAgfSk7XG4gICAgdGhpcy5yZXBsYWNlYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHRoaXMubWFrZUltcG9ydChlLmN1cnJlbnRUYXJnZXQsIHNlbGVjdGNlbGxzLCB3aGF0LCB0cnVlKTtcblxuICAgIH0pO1xuICAgIHRoaXMuY2xlYXJidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgaWYgKCF0aGlzLmltcG9ydGNvbnRhaW5lcikgcmV0dXJuO1xuICAgICAgY29uc3QgZmllbGQgPSB0aGlzLmltcG9ydGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcjJyArIHRoaXMuaW1wb3J0aWQpO1xuICAgICAgaWYgKGZpZWxkKSB7XG4gICAgICAgIGlmIChmaWVsZC50b21zZWxlY3QpIHtcbiAgICAgICAgICBmaWVsZC50b21zZWxlY3QuY2xlYXIoKTtcbiAgICAgICAgICBmaWVsZC50b21zZWxlY3QucmVmcmVzaE9wdGlvbnMoKTtcbiAgICAgICAgfSBlbHNlIGZpZWxkLnZhbHVlID0gJyc7XG4gICAgICB9XG4gICAgICB0aGlzLnNlbGVjdG9ycy5mb3JFYWNoKHNlbGVjdG9yID0+IHtcbiAgICAgICAgaWYgKHNlbGVjdG9yLmRpc2FibGVkKSB7XG4gICAgICAgICAgc2VsZWN0b3IuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgICBzZWxlY3Rvci5jbG9zZXN0KCd0cicpLnF1ZXJ5U2VsZWN0b3JBbGwoJy5zZWxlY3RlZCcpLmZvckVhY2goZWwgPT4ge1xuICAgICAgICAgICAgZWwuY2xhc3NMaXN0LnJlbW92ZShjc3Muc2VsZWN0ZWQpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHRoaXMuYnV0dG9uLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICB0aGlzLnJlcGxhY2VidXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgIC8vdGhpcy5zaG93SW1wb3J0KGZhbHNlKTtcbiAgICB9KTtcbiAgICB0aGlzLmJ1dHRvbi5kYXRhc2V0LmFjdGl2YXRlZCA9IHRydWU7XG4gICAgdGhpcy5yZXBsYWNlYnV0dG9uLmRhdGFzZXQuYWN0aXZhdGVkID0gdHJ1ZTtcbiAgfVxuXG4gIGZpbmRDb250YWN0KHRoY2VsbHMsIGNvbHMpIHtcbiAgICBsZXQgY29udGFjdCA9IG51bGw7XG4gICAgdGhjZWxscy5ldmVyeSgodCwgaWR4KSA9PiB7XG4gICAgICBpZiAodC5kYXRhc2V0Lm5hbWUgJiYgdC5kYXRhc2V0Lm5hbWUgPT09IG1vZGVscy5jb250YWN0KSB7XG4gICAgICAgIGNvbnRhY3QgPSBpZHg7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0pO1xuICAgIC8vaWYgKGNvbnRhY3QpIGNvbnRhY3QgPSBjb2xzW2NvbnRhY3RdID8gSlNPTi5wYXJzZShjb2xzW2NvbnRhY3RdLmRhdGEudHJpbSgpKSA6IDA7XG4gICAgaWYgKGNvbnRhY3QpIGNvbnRhY3QgPSBjb2xzW2NvbnRhY3RdID8gY29sc1tjb250YWN0XSA6IDA7XG5cbiAgICByZXR1cm4gY29udGFjdDtcbiAgfVxuXG4gIHJlbmRlclByaXZpbGVnZXMoaW1wb3J0em9uZSwgY2xlYXIgPSBmYWxzZSkge1xuICAgIGxldCBwcml2aWxlZ2VzID0ge307XG4gICAgY29uc3QgdHpvbmUgPSBpbXBvcnR6b25lLnRvbXNlbGVjdDtcbiAgICBjb25zdCBwdXNocHJpdiA9IChtZW1iZXIsIHByaXYpID0+IHtcbiAgICAgIGNvbnN0IG9iaiA9IHtcbiAgICAgICAgaWQ6IG1lbWJlci5pZCxcbiAgICAgICAgbmFtZTogbWVtYmVyLm5hbWUsXG4gICAgICAgIHByaXY6IHByaXZcbiAgICAgIH1cbiAgICAgIGlmIChwcml2aWxlZ2VzW3ByaXZdKSBwcml2aWxlZ2VzW3ByaXZdLnB1c2gob2JqKTtcbiAgICAgIGVsc2UgcHJpdmlsZWdlc1twcml2XSA9IFtvYmpdO1xuICAgIH1cbiAgICBpZiAodHpvbmUpIHtcbiAgICAgIGNvbnN0IG1lbWJlcnMgPSBbLi4udHpvbmUuaXRlbXNdO1xuICAgICAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe30sIHR6b25lLm9wdGlvbnMpO1xuICAgICAgbWVtYmVycy5mb3JFYWNoKG1lbWJlciA9PiB7XG4gICAgICAgIG1lbWJlciA9IG9wdGlvbnNbbWVtYmVyXTtcbiAgICAgICAgaWYgKG1lbWJlcikgcHVzaHByaXYobWVtYmVyLCBtZW1iZXIub3B0Z3JvdXApO1xuXG4gICAgICB9KVxuICAgIH0gZWxzZSB7XG4gICAgICBpbXBvcnR6b25lLm9wdGlvbnMuZm9yRWFjaChtZW1iZXIgPT4ge1xuICAgICAgICBpZiAobWVtYmVyLnNlbGVjdGVkKSBwdXNocHJpdihtZW1iZXIsIG1lbWJlci5kYXRhc2V0Lm9wdGdyb3VwKTtcbiAgICAgIH0pXG4gICAgfVxuXG4gICAgaWYgKHRoaXMuaW1wb3J0UHJpdmlsZWdlcyhwcml2aWxlZ2VzLCBjbGVhcikpIHtcbiAgICAgIGlmICh0em9uZSkge1xuICAgICAgICB0em9uZS5jbGVhcigpO1xuICAgICAgICB0em9uZS5jbGVhck9wdGlvbnMoKTtcbiAgICAgIH0gZWxzZSBpbXBvcnR6b25lLmlubmVySFRNTCA9IGBgO1xuXG4gICAgfVxuXG4gIH1cblxuICBpbXBvcnRQcml2aWxlZ2VzKHByaXZpbGVnZXMsIGNsZWFyID0gZmFsc2UpIHtcbiAgICBjb25zdCBwcm9qZWN0UHJpdmlsZWdlcyA9IG5ldyBQcm9qZWN0UHJpdmlsZWdlcygpO1xuICAgIGNvbnN0IGltcG9ydGVkdGFnID0gKGlucHV0KSA9PiB7XG4gICAgICB0aGlzLnNldEltcG9ydGVkVGFnKGlucHV0LCBudWxsKTtcbiAgICB9XG4gICAgY29uc3QgZGlzbWlzcyA9ICgpID0+IHtcbiAgICAgIHRoaXMuZGlzbWlzcygpO1xuICAgIH1cbiAgICBjb25zdCBjb250YWN0ID0gKCh0aGlzLmltcG9ydHNbbW9kZWxzLmNvbnRhY3RdKSA/IHRoaXMuaW1wb3J0c1ttb2RlbHMuY29udGFjdF0gOiBudWxsKTtcbiAgICByZXR1cm4gKHByb2plY3RQcml2aWxlZ2VzLmltcG9ydFByaXZpbGVnZXMocHJpdmlsZWdlcywgY2xlYXIsIGNvbnRhY3QsIGltcG9ydGVkdGFnLCBkaXNtaXNzKSk7XG4gIH1cblxuICBjcmVhdGVJbXBvcnR6b25lKG5hbWUpIHtcbiAgICB0aGlzLnNob3dJbXBvcnQodHJ1ZSk7XG4gICAgbGV0IGltcG9ydHpvbmUgPSB0aGlzLmltcG9ydGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcjJyArIHRoaXMuaW1wb3J0aWQpO1xuXG5cbiAgICBpZiAobmFtZSA9PT0gdHlwZWltcG9ydC5wcml2aWxlZ2VzKSB7XG4gICAgICBpZiAoIWltcG9ydHpvbmUpIHtcbiAgICAgICAgaW1wb3J0em9uZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NlbGVjdCcpO1xuICAgICAgICB0aGlzLmltcG9ydGlkID0gaW1wb3J0em9uZS5pZCA9IHRoaXMuaW1wb3J0aWQgKyAnLScgKyBuYW1lO1xuICAgICAgICBpbXBvcnR6b25lLmRhdGFzZXQudHlwZSA9IG1vZGVscy51c2VyO1xuICAgICAgICBpbXBvcnR6b25lLm11bHRpcGxlID0gdHJ1ZTtcbiAgICAgICAgaW1wb3J0em9uZS5kYXRhc2V0LnByaXYgPSB0cnVlO1xuICAgICAgICB0aGlzLmltcG9ydGNvbnRhaW5lci5hcHBlbmQoaW1wb3J0em9uZSk7XG5cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgaW1wb3J0X3RhcmdldCA9ICh0aGlzLmZvcm0ucXVlcnlTZWxlY3RvcignW25hbWU9XCInICsgbmFtZSArICdcIl0nKSkgPyB0aGlzLmZvcm0ucXVlcnlTZWxlY3RvcignW25hbWU9XCInICsgbmFtZSArICdcIl0nKSA6IHRoaXMuZm9ybS5xdWVyeVNlbGVjdG9yKCdbZGF0YS1pbXBvcnRmaWVsZD1cIicgKyBuYW1lICsgJ1wiXScpO1xuICAgICAgY29uc3QgdHMgPSBpbXBvcnRfdGFyZ2V0LnRvbXNlbGVjdDtcblxuICAgICAgaWYgKCFpbXBvcnR6b25lKSB7XG4gICAgICAgIGlmICghaW1wb3J0X3RhcmdldCkgcmV0dXJuO1xuICAgICAgICB0aGlzLmltcG9ydHpvbmVpZCA9IGltcG9ydF90YXJnZXQuaWQ7XG4gICAgICAgIC8vIHRvbXNlbGVjdCA/XG4gICAgICAgIGltcG9ydHpvbmUgPSBpbXBvcnRfdGFyZ2V0LmNsb25lTm9kZSgpO1xuICAgICAgICBpbXBvcnR6b25lLmNsYXNzTGlzdC5yZW1vdmUoJ3RvbXNlbGVjdGVkJyk7XG4gICAgICAgIGltcG9ydHpvbmUuY2xhc3NMaXN0LnJlbW92ZSgndHMtaGlkZGVuLWFjY2Vzc2libGUnKTtcbiAgICAgICAgLy8ga2VlcCBvcmlnaW5hbCBpZCB0byByZXBsYWNlIGRhdGEgb24gYXBwbHkgaW1wb3J0XG4gICAgICAgIGltcG9ydHpvbmUuZGF0YXNldC5vcmlnaW4gPSBpbXBvcnR6b25lLmlkO1xuICAgICAgICBpbXBvcnR6b25lLmlkID0gdGhpcy5pbXBvcnRpZDtcbiAgICAgICAgaW1wb3J0em9uZS5uYW1lID0gdGhpcy5pbXBvcnRpZCArICdfJyArIGltcG9ydHpvbmUubmFtZTtcbiAgICAgICAgdGhpcy5pbXBvcnRjb250YWluZXIuaW5zZXJ0QWRqYWNlbnRIVE1MKCdhZnRlcmJlZ2luJywgaW1wb3J0em9uZS5vdXRlckhUTUwpO1xuICAgICAgICBpZiAodHMpIHtcbiAgICAgICAgICBpbXBvcnR6b25lID0gdGhpcy5pbXBvcnRjb250YWluZXIucXVlcnlTZWxlY3RvcignIycgKyB0aGlzLmltcG9ydGlkKTtcbiAgICAgICAgICBjb25zdCBqc1RvbVNlbGVjdCA9IG5ldyBKc1RvbVNlbGVjdCgpO1xuICAgICAgICAgIGpzVG9tU2VsZWN0LmFwcGx5VG8oaW1wb3J0em9uZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gaW1wb3J0em9uZTtcblxuICB9XG5cbiAgbWFrZUltcG9ydChidG4sIHNlbGVjdGNlbGxzLCB3aGF0LCBjbG9zZSA9IGZhbHNlKSB7XG4gICAgbGV0IGRvbmUgPSBmYWxzZTtcbiAgICBjb25zdCBpbXBvcnR6b25lID0gKHRoaXMuaW1wb3J0Y29udGFpbmVyKSA/IHRoaXMuaW1wb3J0Y29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJyMnICsgdGhpcy5pbXBvcnRpZCkgOiBudWxsO1xuICAgIHN3aXRjaCAod2hhdCkge1xuICAgICAgY2FzZSB0eXBlaW1wb3J0LnRheG86XG5cbiAgICAgICAgaWYgKCFpbXBvcnR6b25lKSByZXR1cm4gZmFsc2U7XG4gICAgICAgIGNvbnN0IGltcG9ydF90YXJnZXQgPSB0aGlzLmZvcm0ucXVlcnlTZWxlY3RvcignIycgKyBpbXBvcnR6b25lLmRhdGFzZXQub3JpZ2luKTtcblxuICAgICAgICBpZiAoIWltcG9ydF90YXJnZXQpIHJldHVybiBmYWxzZTtcbiAgICAgICAgY29uc3QgdHMgPSBpbXBvcnRfdGFyZ2V0LnRvbXNlbGVjdDtcbiAgICAgICAgaWYgKHRzKSB7XG4gICAgICAgICAgLy8gb25seSBpZiByZXBsYWNlIHNwZWNpZmllZFxuICAgICAgICAgIGlmIChidG4uZGF0YXNldC5yZXBsYWNlICYmIGJ0bi5kYXRhc2V0LnJlcGxhY2UgPT09ICdyZXBsYWNlJykge1xuICAgICAgICAgICAgdHMuY2xlYXIoKTtcbiAgICAgICAgICAgIHRzLmNsZWFyT3B0aW9ucygpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnN0IHR6b25lID0gaW1wb3J0em9uZS50b21zZWxlY3Q7XG4gICAgICAgICAgY29uc3QgaXRlbXMgPSBbLi4udHpvbmUuaXRlbXNdO1xuICAgICAgICAgIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHt9LCB0em9uZS5vcHRpb25zKTtcbiAgICAgICAgICBpdGVtcy5mb3JFYWNoKChlLCBpKSA9PiB7XG4gICAgICAgICAgICBsZXQgZWwgPSB7fTtcbiAgICAgICAgICAgIGVsW3RzLnNldHRpbmdzLnZhbHVlRmllbGRdID0gZTtcbiAgICAgICAgICAgIGVsW3RzLnNldHRpbmdzLnNlYXJjaEZpZWxkXSA9IHVuZXNjYXBlX2h0bWwob3B0aW9uc1tlXVt0cy5zZXR0aW5ncy5zZWFyY2hGaWVsZF0pO1xuICAgICAgICAgICAgaWYgKCF0cy5nZXRPcHRpb24oZSkpIHRzLmFkZE9wdGlvbihlbCk7XG4gICAgICAgICAgICB0cy5hZGRJdGVtKGUpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHR6b25lLmNsZWFyKCk7XG4gICAgICAgICAgdHpvbmUuY2xlYXJPcHRpb25zKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKGJ0bi5kYXRhc2V0LnJlcGxhY2UgJiYgYnRuLmRhdGFzZXQucmVwbGFjZSA9PT0gJ3JlcGxhY2UnKSBpbXBvcnRfdGFyZ2V0LmlubmVySFRNTCA9IGBgO1xuICAgICAgICAgIGltcG9ydF90YXJnZXQuaW5uZXJIVE1MID0gRE9NUHVyaWZ5LnNhbml0aXplKGltcG9ydHpvbmUuaW5uZXJIVE1MKTtcbiAgICAgICAgICBpbXBvcnR6b25lLmlubmVySFRNTCA9IGBgO1xuXG4gICAgICAgIH1cblxuICAgICAgICBkb25lID0gdHJ1ZTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIHR5cGVpbXBvcnQucHJpdmlsZWdlczpcbiAgICAgICAgaWYgKCFpbXBvcnR6b25lKSByZXR1cm4gZmFsc2U7XG4gICAgICAgIGRvbmUgPSB0aGlzLnJlbmRlclByaXZpbGVnZXMoaW1wb3J0em9uZSwgKGJ0bi5kYXRhc2V0LnJlcGxhY2UgJiYgYnRuLmRhdGFzZXQucmVwbGFjZSA9PT0gJ3JlcGxhY2UnKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgc2VsZWN0Y2VsbHMuZm9yRWFjaCgobmFtZSwgaW5kZXgpID0+IHtcbiAgICAgICAgICBsZXQgaW5wdXQgPSAoKHRoaXMuZm9ybS5xdWVyeVNlbGVjdG9yKCdbZGF0YS1pbXBvcnRmaWVsZD1cIicgKyBuYW1lICsgJ1wiXScpKSA/IHRoaXMuZm9ybS5xdWVyeVNlbGVjdG9yKCdbZGF0YS1pbXBvcnRmaWVsZD1cIicgKyBuYW1lICsgJ1wiXScpIDogdGhpcy5mb3JtLnF1ZXJ5U2VsZWN0b3IoJ1tuYW1lPVwiJyArIG5hbWUgKyAnXCJdJykpO1xuXG4gICAgICAgICAgaWYgKGlucHV0ICYmIHRoaXMuaW1wb3J0c1tuYW1lXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBjb25zdCB0cyA9IGlucHV0LnRvbXNlbGVjdDtcblxuICAgICAgICAgICAgaWYgKG5hbWUgPT09ICdpbml0X2NsYXNzaWZfbGlzdCcpIHtcbiAgICAgICAgICAgICAgbGV0IGlkcyA9IHRoaXMuaW1wb3J0c1tuYW1lXTtcbiAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoaWRzKSkgaWRzID0gaWRzLmpvaW4oJywnKTtcbiAgICAgICAgICAgICAgZWxzZSBpZHMgPSBpZHMucmVwbGFjZSgnWycsICcnKS5yZXBsYWNlKCddJywgJycpLnJlcGxhY2VBbGwoJyAnLCAnJyk7XG4gICAgICAgICAgICAgIGlmIChpZHMgIT09ICcnKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRzKSB0cy53cmFwcGVyLmNsYXNzTGlzdC5hZGQoJ3dhaXQtZm9yLXJlc3VsdHMnKTtcbiAgICAgICAgICAgICAgICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuICAgICAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnaWRsaXN0JywgaWRzKTtcbiAgICAgICAgICAgICAgICBjb25zdCB1cmwgPSAnL3NlYXJjaC90YXhvcmVzb2x2ZScgLy8rIG5ldyBVUkxTZWFyY2hQYXJhbXMoeydpZGxpc3QnOiBpZHN9KTtcbiAgICAgICAgICAgICAgICBmZXRjaCh1cmwsIGZldGNoU2V0dGluZ3Moe1xuICAgICAgICAgICAgICAgICAgJ21ldGhvZCc6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICAgICdib2R5JzogZm9ybURhdGFcbiAgICAgICAgICAgICAgICB9KSkudGhlbihyZXNwb25zZSA9PlxuICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuanNvbigpXG4gICAgICAgICAgICAgICAgKS50aGVuKHJlc3VsdHMgPT4ge1xuICAgICAgICAgICAgICAgICAgaWYgKHRzKSB7XG4gICAgICAgICAgICAgICAgICAgIE9iamVjdC5lbnRyaWVzKHJlc3VsdHMpLmZvckVhY2goKFtrZXksIHRleHRdKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgbGV0IGVsID0ge307XG4gICAgICAgICAgICAgICAgICAgICAga2V5ID0gRE9NUHVyaWZ5LnNhbml0aXplKGtleSk7XG4gICAgICAgICAgICAgICAgICAgICAgdGV4dCA9IERPTVB1cmlmeS5zYW5pdGl6ZSh0ZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgICBlbFt0cy5zZXR0aW5ncy52YWx1ZUZpZWxkXSA9IGtleTtcbiAgICAgICAgICAgICAgICAgICAgICBlbFt0cy5zZXR0aW5ncy5zZWFyY2hGaWVsZF0gPSB1bmVzY2FwZV9odG1sKHRleHQpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgdHMuYWRkT3B0aW9uKGVsKTtcbiAgICAgICAgICAgICAgICAgICAgICB0cy5hZGRJdGVtKGVsW3RzLnNldHRpbmdzLnZhbHVlRmllbGRdKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBsZXQgb3B0aW9ucyA9ICcnO1xuICAgICAgICAgICAgICAgICAgICBPYmplY3QuZW50cmllcyhyZXN1bHRzKS5mb3JFYWNoKChba2V5LCB0ZXh0XSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgIGtleSA9IERPTVB1cmlmeS5zYW5pdGl6ZShrZXkpO1xuICAgICAgICAgICAgICAgICAgICAgIHRleHQgPSBET01QdXJpZnkuc2FuaXRpemUodGV4dCk7XG4gICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyArPSAnPG9wdGlvbiB2YWx1ZSA9XCInICsga2V5ICsgJ1wiIHNlbGVjdGVkPicgKyB0ZXh0ICsgJzwvb3B0aW9uPic7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBpbnB1dC5pbm5lckhUTUwgPSBvcHRpb25zO1xuICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0gJyc7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICByZXN1bHRzID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgIGlmICh0cykgdHMud3JhcHBlci5jbGFzc0xpc3QucmVtb3ZlKCd3YWl0LWZvci1yZXN1bHRzJyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAodHMpIHtcbiAgICAgICAgICAgICAgbGV0IGVsID0ge307XG4gICAgICAgICAgICAgIGVsW3RzLnNldHRpbmdzLnZhbHVlRmllbGRdID0gdGhpcy5pbXBvcnRzW25hbWVdWydrZXknXTtcbiAgICAgICAgICAgICAgZWxbdHMuc2V0dGluZ3Muc2VhcmNoRmllbGRdID0gdW5lc2NhcGVfaHRtbCh0aGlzLmltcG9ydHNbbmFtZV1bJ3ZhbHVlJ10pO1xuICAgICAgICAgICAgICB0cy5hZGRPcHRpb24oZWwpO1xuICAgICAgICAgICAgICB0cy5hZGRJdGVtKGVsW2lucHV0LnRvbXNlbGVjdC5zZXR0aW5ncy52YWx1ZUZpZWxkXSk7XG4gICAgICAgICAgICAgIHRzLnJlZnJlc2hPcHRpb25zKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBjb25zdCB0eXBlID0gKGlucHV0LnR5cGUpID8gaW5wdXQudHlwZSA6IGlucHV0LnRhZ05hbWUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAncmFkaW8nOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2NoZWNrYm94JzpcbiAgICAgICAgICAgICAgICAgIGlucHV0ID0gdGhpcy5mb3JtLnF1ZXJ5U2VsZWN0b3IoJ1tuYW1lPVwiJyArIG5hbWUgKyAnXCJdW3ZhbHVlPVwiJyArIHRoaXMuaW1wb3J0c1tuYW1lXSArICdcIl0nKTtcbiAgICAgICAgICAgICAgICAgIGlmIChpbnB1dCkgaW5wdXQuY2hlY2tlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgIC8qY2FzZSAnY2hlY2tib3gnOlxuICAgICAgICAgICAgICAgICAgICAvLyBUT0RPICggbXVsdGlwbGUgc2VsZWN0aW9uIClcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mb3JtLnF1ZXJ5U2VsZWN0b3JBbGwoJ1tuYW1lPVwiJyArIGZpZWxkICsgJ1wiXScpLmZvckVhY2goaW5wdXQgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSAodGhpcy5pbXBvcnRzW25hbWVdWydrZXknXSA9PT0gaW5wdXQudmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7Ki9cbiAgICAgICAgICAgICAgICBjYXNlICdzZWxlY3QnOlxuICAgICAgICAgICAgICAgICAgLy8gdG9kbyBzZWxlY3QgbXVsdGlwbGVcbiAgICAgICAgICAgICAgICAgIGxldCBvcHRpb247XG4gICAgICAgICAgICAgICAgICBpZiAodGhpcy5pbXBvcnRzW25hbWVdWydrZXknXSkgb3B0aW9uID0gJzxvcHRpb24gdmFsdWU9XCInICsgdGhpcy5pbXBvcnRzW25hbWVdWydrZXknXSArICdcIiBzZWxlY3RlZCA+JyArIHRoaXMuaW1wb3J0c1tuYW1lXVsndmFsdWUnXSArICc8L29wdGlvbj4nO1xuICAgICAgICAgICAgICAgICAgZWxzZSBvcHRpb24gPSAnPG9wdGlvbiB2YWx1ZT1cIicgKyB0aGlzLmltcG9ydHNbbmFtZV0gKyAnXCIgc2VsZWN0ZWQgPicgKyB0aGlzLmltcG9ydHNbbmFtZV0gKyAnPC9vcHRpb24+J1xuICAgICAgICAgICAgICAgICAgaW5wdXQuaW5zZXJ0QWRqYWNlbnRIVE1MKCdiZWZvcmVlbmQnLCBvcHRpb24pO1xuICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcblxuICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWUgPSB0aGlzLmltcG9ydHNbbmFtZV07XG4gICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHdoYXQgIT09IHR5cGVpbXBvcnQuc2V0dGluZ3MpIGlucHV0LmZvY3VzKCk7XG4gICAgICAgICAgICBkb25lID0gdHJ1ZTtcbiAgICAgICAgICAgIC8vIHNldCBpbXBvcnRlZCB0YWcgdG8gZmllbGRib3hcbiAgICAgICAgICAgIHRoaXMuc2V0SW1wb3J0ZWRUYWcoaW5wdXQpO1xuICAgICAgICAgIH0gZWxzZSBpZiAobmFtZSA9PT0gJ3ByaXZpbGVnZXMnKSB7XG4gICAgICAgICAgICBkb25lID0gdGhpcy5pbXBvcnRQcml2aWxlZ2VzKHRoaXMuaW1wb3J0c1tuYW1lXSwgZmFsc2UpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBpZiAoZG9uZSA9PT0gdHJ1ZSAmJiBjbG9zZSA9PSB0cnVlKSB0aGlzLmRpc21pc3MoKTtcbiAgfVxuXG4gIHNldEltcG9ydGVkVGFnKGlucHV0LCBzZWxlY3RvciA9ICcuZm9ybS1ib3gnKSB7XG4gICAgbGV0IGVsID0gKHNlbGVjdG9yID09PSBudWxsKSA/IGlucHV0IDogKGlucHV0LmNsb3Nlc3Qoc2VsZWN0b3IpID8gaW5wdXQuY2xvc2VzdChzZWxlY3RvcikgOiBpbnB1dC5jbG9zZXN0KCdmaWVsZHNldCcpKTtcbiAgICBpZiAoIWVsKSByZXR1cm47XG4gICAgZWwuZGF0YXNldC5pc2ltcG9ydGVkID0gdGhpcy5mb3JtLmRhdGFzZXQuaXNpbXBvcnRlZDtcbiAgICBlbC5jbGFzc0xpc3QuYWRkKCdpbXBvcnRlZCcpO1xuICAgIGNvbnN0IHJlbW92ZXRhZyA9IChlKSA9PiB7XG4gICAgICBlbC5yZW1vdmVBdHRyaWJ1dGUoJ2RhdGEtaXNpbXBvcnRlZCcpO1xuICAgICAgZWwuY2xhc3NMaXN0LnJlbW92ZSgnaW1wb3J0ZWQnKTtcbiAgICAgIGlucHV0LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NoYW5nZSBrZXlkb3duJywgcmVtb3ZldGFnKTtcbiAgICB9XG4gICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlIGtleWRvd24nLCByZW1vdmV0YWcpO1xuICB9XG5cbiAgZGlzbWlzcyhjbGVhciA9IGZhbHNlKSB7XG4gICAgY29uc3QgY29udGFpbmVyID0gdGhpcy5kb2MuY2xvc2VzdCgnZGV0YWlscycpO1xuICAgIGlmIChjb250YWluZXIpIHtcbiAgICAgIGNvbnRhaW5lci5vcGVuID0gZmFsc2U7XG4gICAgICBpZiAoY2xlYXIgPT09IHRydWUpIGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKHRoaXMuY29udGVudF9zZWxlY3RvcikuaW5uZXJIVE1MID0gYGA7XG4gICAgfVxuXG4gIH1cbiAgaW5kZXhUb0NoZWNrKGdyaWQpIHtcbiAgICAvLyBpbmRleCBvZiBjZWxscyB0byBjaGVjayBpZiBlbXB0eSBhbmQgZGlzYWJsZSByb3cgIGltcG9ydCBidG5cbiAgICBpZiAoZ3JpZC5oZWFkaW5ncyAmJiBncmlkLmhlYWRpbmdzWzBdLmRhdGFzZXQud2hhdCA9PT0gdHlwZWltcG9ydC50YXhvKSB7XG5cbiAgICAgIC8vIGlmIG11bHRpcGxlIHNlbGVjdG9ycyA6IHNlYXJjaCBpbmRleCBvZiBjZWxsIHRvIGltcG9ydCAtIGlmIGVtcHR5IGRpc2FibGUgdGhlIHNlbGVjdG9yXG4gICAgICBjb25zdCBwYXJ0cyA9IChncmlkLmhlYWRpbmdzWzBdLmRhdGFzZXQucGFydHMpID8gZ3JpZC5oZWFkaW5nc1swXS5kYXRhc2V0LnBhcnRzLnNwbGl0KCcsJykgOiBudWxsO1xuICAgICAgaWYgKHBhcnRzKSB7XG4gICAgICAgIGNvbnN0IGluZGV4dG9jaGVjayA9IGdyaWQuaGVhZGluZ3MuZmlsdGVyKChoZWFkaW5nLCBpKSA9PiB7XG4gICAgICAgICAgaWYgKHBhcnRzLmluZGV4T2YoaGVhZGluZy5kYXRhc2V0Lm5hbWUpID49IDApIHJldHVybiBpO1xuICAgICAgICB9KS5tYXAodiA9PiB7XG4gICAgICAgICAgcmV0dXJuIHYuY2VsbEluZGV4XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gaW5kZXh0b2NoZWNrO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICAvLyBzaG93IC8gaGlkZSBpbXBvcnR6b25lIGFuZCBidXR0b25zXG4gIHNob3dJbXBvcnQoc2hvdykge1xuICAgIGlmICghdGhpcy5idXR0b24pIHJldHVybjtcblxuICAgIGlmIChzaG93ID09PSBmYWxzZSkge1xuICAgICAgdGhpcy5idXR0b24uY2xhc3NMaXN0LmFkZChjc3MuaGlkZSk7XG4gICAgICB0aGlzLnJlcGxhY2VidXR0b24uY2xhc3NMaXN0LmFkZChjc3MuaGlkZSk7XG4gICAgICB0aGlzLmNsZWFyYnV0dG9uLmNsYXNzTGlzdC5hZGQoY3NzLmhpZGUpO1xuICAgICAgdGhpcy5pbXBvcnRjb250YWluZXIuY2xhc3NMaXN0LmFkZChjc3MuaGlkZSk7XG4gICAgICB0aGlzLnRhYmJ1dHRvbi5jbGFzc0xpc3QuYWRkKGNzcy5oaWRlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5idXR0b24uY2xhc3NMaXN0LnJlbW92ZShjc3MuaGlkZSk7XG4gICAgICB0aGlzLnJlcGxhY2VidXR0b24uY2xhc3NMaXN0LnJlbW92ZShjc3MuaGlkZSk7XG4gICAgICB0aGlzLmNsZWFyYnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoY3NzLmhpZGUpO1xuICAgICAgdGhpcy5pbXBvcnRjb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZShjc3MuaGlkZSk7XG4gICAgICB0aGlzLmJ1dHRvbi5kaXNhYmxlZCA9IHRoaXMuY2xlYXJidXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgIGNvbnN0IGltcG9ydHpvbmUgPSB0aGlzLmltcG9ydGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcjJyArIHRoaXMuaW1wb3J0aWQpO1xuICAgICAgaWYgKGltcG9ydHpvbmUpIHtcbiAgICAgICAgdGhpcy50YWJidXR0b24uY2xhc3NMaXN0LnJlbW92ZShjc3MuaGlkZSk7XG4gICAgICAgIGlmIChpbXBvcnR6b25lLnRvbXNlbGVjdCAmJiBpbXBvcnR6b25lLnRvbXNlbGVjdC5jb250cm9sLm9mZnNldEhlaWdodCA8IGltcG9ydHpvbmUudG9tc2VsZWN0LmNvbnRyb2wuc2Nyb2xsSGVpZ2h0KSB7XG4gICAgICAgICAgdGhpcy50YWJidXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgfSBlbHNlIHRoaXMudGFiYnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgLy8gcmVzaXplIGltcG9ydHpvbmVcbiAgcmVzaXplWm9uZShlKSB7XG4gICAgY29uc3QgZGl2ID0gdGhpcy5pbXBvcnRjb250YWluZXIuY2xvc2VzdChkb21zZWxlY3RvcnMuY29tcG9uZW50LmltcG9ydC56b25laW1wb3J0KTtcbiAgICBpZiAoIWRpdikgcmV0dXJuO1xuICAgIGRpdi5wYXJlbnRFbGVtZW50LmNsYXNzTGlzdC50b2dnbGUoY3NzLnNob3dmdWxsKTtcbiAgICBjb25zdCBpY29uID0gZS5jdXJyZW50VGFyZ2V0LnF1ZXJ5U2VsZWN0b3IoJ2knKTtcbiAgICBpZiAoaWNvbikge1xuICAgICAgaWNvbi5jbGFzc0xpc3QudG9nZ2xlKCdpY29uLWFycm93LXBvaW50aW5nLW91dCcpO1xuICAgICAgaWNvbi5jbGFzc0xpc3QudG9nZ2xlKCdpY29uLWFycm93LXBvaW50aW5nLWluJyk7XG4gICAgfVxuICB9XG59Il0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/modules/data-import.js\n")}}]);