/*! For license information please see src_modules_data-import_js-src_css_tom-select_css.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["src_modules_data-import_js-src_css_tom-select_css"],{"./src/modules/data-import.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DataImport: () => (/* binding */ DataImport)\n/* harmony export */ });\n/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! dompurify */ \"./node_modules/dompurify/dist/purify.js\");\n/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(dompurify__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _modules_js_tom_select_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../modules/js-tom-select.js */ \"./src/modules/js-tom-select.js\");\n/* harmony import */ var _modules_project_privileges_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../modules/project-privileges.js */ \"./src/modules/project-privileges.js\");\n/* harmony import */ var _modules_utils_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../modules/utils.js */ \"./src/modules/utils.js\");\n/* harmony import */ var _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../modules/modules-config.js */ \"./src/modules/modules-config.js\");\n\n\n\n\n\nconst key_privileges = Object.keys(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.defined_privileges).reduce(function(result, key) {\n  result[key] = key;\n  return result;\n}, {});\nlet instance;\nclass DataImport {\n  content_selector = '.modal-content';\n  imports = [];\n  taxos = [\"preset\", \"extra\"];\n  importcontainer;\n  importzoneid;\n  importid = 'importzone';\n  selectors;\n  button;\n  clearbutton;\n  replacebutton;\n  tabbutton;\n  tbl = null;\n  constructor(tbl, what = null, selector = null) {\n    if (!tbl) return;\n    // tbl is a TableComponent  ?\n    this.tbl = (typeof(tbl) === 'object') ? tbl : null;\n    // get the table from table component or html table element id\n    this.dom = (this.tbl) ? this.tbl.dom : document.getElementById(tbl);\n    if (!this.dom) return;\n    what = (what) ? dompurify__WEBPACK_IMPORTED_MODULE_0___default().sanitize(what) : (tbl && tbl.params && tbl.params.import) ? tbl.params.import : (this.dom.dataset.import) ? dompurify__WEBPACK_IMPORTED_MODULE_0___default().sanitize(this.dom.dataset.import) : null;\n    if (!instance || instance.doc !== this.dom) {\n      // defaultoptions - keep like that\n      const options = {\n        importcontainer: '#data-import-' + what,\n        btns: '.btns-imports',\n        button: '#add-import-' + what,\n        replacebutton: '#replace-import-' + what,\n        tabbutton: '#tab-import-' + what,\n        selector: 'data-id',\n\n      };\n      this.selector = (selector) ? selector : options.selector;\n      this.importcontainer = options.importcontainer instanceof HTMLElement ? options.importcontainer : document.querySelector(options.importcontainer);\n      this.form = (options.form) ? ((options.form) instanceof HTMLElement ? options.form : document.querySelector(options.form)) : this.dom.closest('form');\n      this.button = options.button instanceof HTMLElement ? options.button : document.querySelector(options.button);\n      this.replacebutton = options.replacebutton instanceof HTMLElement ? options.replacebutton : document.querySelector(options.replacebutton);\n      this.tabbutton = options.tabbutton instanceof HTMLElement ? options.tabbutton : document.querySelector(options.tabbutton);\n      this.init(options);\n      instance = this;\n\n    }\n    return instance;\n  }\n\n  init(options) {\n    // hide importzone\n    this.showImport(false);\n    // remove line of target proj\n    let projid = this.form.querySelector('#' + _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.domselectors.projid);\n    if (projid && projid.value) {\n      projid = this.dom.querySelector('[' + this.selector + '=\"' + projid.value + '\"]');\n      if (projid) projid.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.hide);\n\n    }\n    const indextocheck = this.indexToCheck();\n    this.selectors = this.dom.querySelectorAll('[' + this.selector + '] button, [' + this.selector + '] input');\n    this.selectors.forEach(selector => {\n      // checkbox possible\n      const index = Array.from(selector.parentElement.children).indexOf((selector));\n\n      if (indextocheck && selector.closest('tr').children[indextocheck[index]].innerHTML === '') selector.disabled = true;\n      else {\n        const evt = (selector.tagName.toLowerCase() === 'input') ? 'change' : 'click';\n        const apply_selection = (e) => {\n          const target = e.currentTarget;\n          target.disabled = true;\n          this.toImport(target.parentElement, index);\n        };\n        selector.removeEventListener(evt, apply_selection, false);\n        selector.addEventListener(evt, apply_selection, false);\n      };\n    });\n    if (this.button) {\n      this.tabbutton.addEventListener('click', (e) => {\n        this.resizeZone(e);\n      });\n      this.showImport(false);\n    }\n  }\n  columnProperty(name, index, th) {\n    if (this.tbl) return (this.tbl.grid.columns[index].hasOwnProperty(name)) ? this.tbl.grid.columns[index][name] : null;\n    else return (th.dataset[name]) ? th.dataset.name : null;\n  }\n  columnIndex(prop, value) {\n    if (this.tbl) return this.tbl.grid.columns.findIndex(column => (column.hasOwnProperty(prop) && column[prop] === value));\n    else return Array.from(this.dom.querySelectorAll('thead th')).findIndex(th => (th.dataset[prop] && th.dataset[prop] === value));\n  }\n  rowIndex(td, trs) {\n    const ref = (td.parentElement) ? td.parentElement : null;\n    if (!ref) return null;\n    return trs.findIndex(tr => (tr === ref));\n  }\n  toImport(td, whatpart = 0) {\n    const grid = (this.tbl) ? this.tbl.grid : null;\n    const thcells = Array.from(this.dom.querySelectorAll('thead th'));\n    const trs = Array.from(this.dom.querySelectorAll('tbody tr'));\n\n    const datas = (grid) ? grid.data : trs.map(tr => {\n      return Array.from(tr.childNodes).forEach(cell => {\n        return cell.innerText;\n      });\n    }); // cell values in json  - no parse\n    if (td.tagName.toLowerCase() !== 'td') td = td.closest('td');\n    const rowindex = this.rowIndex(td, trs);\n    if (rowindex === null) return;\n    let showbtns = true;\n    const cellindex = td.cellIndex;\n    const th = thcells[cellindex];\n    const tds = trs[rowindex];\n    const what = this.columnProperty('what', cellindex, th);\n    if (!what) return;\n    const parts = this.columnProperty('parts', cellindex, th);\n    let contact = null;\n    let selectcells = this.columnProperty('selectcells', cellindex, th);\n    selectcells = (selectcells) ? ((parts) ? [parts[whatpart]] : selectcells) : null;\n    if (!selectcells) return;\n    if (what === _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.typeimport.settings) this.imports[_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.models.contact] = this.findContact(thcells, datas[rowindex]);\n    const importzone = (what === _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.typeimport.taxo || what === _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.typeimport.privileges) ? this.createImportzone(what) : null;\n    let ts = null;\n    selectcells.forEach((name, index) => {\n      index = this.columnIndex('name', name);\n      if (index >= 0) {\n        // show import buttons if importzone\n        const cell = trs[rowindex].cells[index];\n        const celldata = datas[rowindex][index];\n        cell.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.selected);\n        const thcell = thcells[index];\n        switch (what) {\n          case _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.typeimport.taxo:\n            // accumulate and show in import win - move the form field in modal win to view the changes and benefit of tom-select component functs...\n            ts = importzone.tomselect;\n            let taxons = celldata;\n            if (taxons) {\n              if (ts) {\n                // merge taxons and options - unique\n                Object.values(ts.options).forEach((opt) => {\n                  let obj = {};\n                  obj[opt[ts.settings.valueField]] = opt[ts.settings.labelField];\n                  if (!taxons[opt[ts.settings.valueField]]) taxons = Object.assign(taxons, obj);\n                });\n                taxons = Object.entries(taxons);\n                // sort taxons\n                taxons.sort((a, b) => {\n                  let x = a[1];\n                  let y = b[1];\n                  return +(x > y) || -(y > x);\n                });\n                ts.clear();\n                ts.clearOptions();\n                // add taxons items\n                taxons.forEach(([key, text]) => {\n                  if (!ts.getItem(key)) {\n                    if (!ts.getOption(key)) {\n                      let obj = {};\n                      obj[ts.settings.valueField] = key;\n                      obj[ts.settings.labelField] = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_3__.unescape_html)(text.trim());\n                      ts.addOption(obj);\n                    }\n                    ts.addItem(key);\n                  }\n                });\n              } else {\n                Object.values(importzone.options).forEach(opt => {\n                  let obj = {};\n                  obj[opt.value] = opt.text;\n                  if (!taxons[opt.value]) taxons = Object.assign(taxons, obj);\n                });\n                taxons = Object.entries(taxons);\n                taxons.sort((a, b) => {\n                  let x = a[1];\n                  let y = b[1];\n                  return +(x > y) || -(y > x);\n                });\n                importzone.innerHTML = ``;\n                taxons.forEach(([key, text]) => {\n                  if (!importzone.querySelector('option[value=\"' + key + '\"]')) importzone.insertAdjacentHTML('beforeend', '<option value=\"' + key + '\" selected>' + text + '</option>');\n                });\n              }\n              showbtns = (taxons.length > 0);\n              taxons = null;\n            }\n\n            break;\n          case _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.typeimport.privileges:\n            const privs = celldata;\n            // set everybody to 'view' if more than one project imported\n            const resetpriv = ((ts && ts.items.length > 0) || (importzone.selectedIndex > 0));\n\n            if (!importzone.dataset.init) {\n              /*    const optgroups = [];\n                  Object.keys(privs).forEach(priv => {\n                    //  importzone.insertAdjacentHTML('afterbegin', `<optgroup value=\"${priv}\" label=\"${priv}\"></optgroup>`);\n                    optgroups.push({\n                      value: priv,\n                      label: priv\n                    });\n                  });*/\n              const jsTomSelect = new _modules_js_tom_select_js__WEBPACK_IMPORTED_MODULE_1__.JsTomSelect();\n              jsTomSelect.applyTo(importzone);\n              importzone.dataset.init = true;\n            }\n            ts = importzone.tomselect;\n\n            Object.entries(privs).forEach(([priv, members]) => {\n              members.sort((a, b) => {\n                return (b.name > a.name);\n              });\n              members.forEach(member => {\n                const newpriv = (resetpriv) ? key_privileges.viewers : priv; // viewer if more than one project imported\n                let opt;\n\n                if (ts) {\n                  opt = ts.items.indexOf(member.id);\n                  if (opt >= 0) {\n                    ts.removeItem(member.id);\n                    ts.removeOption(member.id);\n                  }\n\n                  // addoption && addItem\n                  opt = {\n                    optgroup: newpriv\n                  }\n                  opt[ts.settings.valueField] = member.id;\n                  opt[ts.settings.searchField] = member.name;\n                  opt[ts.settings.labelField] = member.name;\n                  ts.addOption(opt);\n                  ts.addItem(member.id);\n                } else {\n                  opt = importzone.querySelector('option[value=\"' + member.id + '\"]');\n                  if (opt === null) {\n                    opt = document.createElement('option');\n                    opt.value = member.id;\n                    opt.dataset.optgroup = newpriv;\n                    opt.selected = opt.defaultSelected = true;\n                    opt.text = member.name;\n                    importzone.add(opt);\n\n                  } else opt.dataset.optgroup = newpriv;\n                }\n              });\n              importzone.tomselect.refreshOptions();\n            });\n\n            showbtns = (((ts) ? ts.items.length : importzone.selectedIndex + 1) > 0);\n\n\n            break;\n          default:\n\n            if (thcell.dataset.autocomplete) {\n              // select elements where key / value in different columns\n              this.imports[name] = {\n                value: celldata,\n                key: null\n              };\n              let el = null;\n              thcells.every((t, idx) => {\n                if (t.dataset.name == thcell.dataset.autocomplete) {\n                  el = idx;\n                  return false;\n                }\n                return true;\n              });\n              if (el !== null) {\n                el = datas[rowindex][el];\n\n                this.imports[name].key = el;\n              }\n            } else if (thcell.dataset.value) this.imports[name] = thcell.dataset.value;\n            else this.imports[name] = celldata;\n\n            break;\n        }\n      };\n    });\n\n    if (thcells.length) {\n      if (this.button) {\n        this.showImport(showbtns);\n        if (!this.button.dataset.activated && (what === _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.typeimport.taxo || what === _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.typeimport.privileges)) this.activateButtons(what, selectcells);\n      } else this.makeImport(null, selectcells, what, true);\n    }\n    //\n\n  }\n  messageZone(item) {\n    console.log('itemmessage', item);\n  }\n  activateButtons(what, selectcells) {\n\n    this.button.addEventListener('click', (e) => {\n      e.preventDefault();\n      this.makeImport(e.currentTarget, selectcells, what, true);\n\n    });\n    this.replacebutton.addEventListener('click', (e) => {\n      e.preventDefault();\n      this.makeImport(e.currentTarget, selectcells, what, true);\n\n    });\n\n    this.button.dataset.activated = true;\n    this.replacebutton.dataset.activated = true;\n  }\n\n  findContact(thcells, tds) {\n    let contact = null;\n    thcells.every((t, idx) => {\n      if (t.dataset.name && t.dataset.name === _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.models.contact) {\n        contact = idx;\n        return false;\n      }\n      return true;\n    });\n    if (contact) contact = tds[contact] ? tds[contact] : 0;\n\n    return contact;\n  }\n\n  renderPrivileges(importzone, replace = false) {\n    let privileges = {};\n    const tzone = importzone.tomselect;\n    const pushpriv = (member, priv) => {\n      const obj = {\n        id: member.id,\n        name: member.name,\n        priv: priv\n      }\n      if (privileges[priv]) privileges[priv].push(obj);\n      else privileges[priv] = [obj];\n    }\n\n    if (tzone) {\n      const members = [...tzone.items];\n      const options = Object.assign({}, tzone.options);\n      members.forEach(member => {\n        member = options[member];\n        if (member) pushpriv(member, member.optgroup);\n\n      })\n    } else {\n      importzone.options.forEach(member => {\n        if (member.selected) pushpriv(member, member.dataset.optgroup);\n      })\n    }\n\n\n    if (this.importPrivileges(privileges, replace)) {\n\n      if (tzone) {\n        tzone.clear();\n        tzone.clearOptions();\n      } else importzone.innerHTML = ``;\n\n    }\n\n  }\n\n  importPrivileges(privileges, clear = false) {\n    const projectPrivileges = new _modules_project_privileges_js__WEBPACK_IMPORTED_MODULE_2__.ProjectPrivileges();\n    const importedtag = (input) => {\n      this.setImportedTag(input, null);\n    }\n    const dismiss = () => {\n      this.dismiss();\n    }\n    const contact = ((this.imports[_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.models.contact]) ? this.imports[_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.models.contact] : null);\n    return (projectPrivileges.importPrivileges(privileges, clear, contact, importedtag, dismiss));\n  }\n  activateClear() {\n    const clearbutton = document.getElementById('clear-' + this.importid);\n    if (!clearbutton) return;\n    clearbutton.addEventListener('click', (e) => {\n      if (!this.importcontainer) return;\n      this.selectors.forEach(selector => {\n        if (selector.disabled) {\n          selector.disabled = false;\n          selector.closest('tr').querySelectorAll('.selected').forEach(el => {\n            el.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.selected);\n          });\n        }\n      });\n      this.button.disabled = false;\n      this.replacebutton.disabled = false;\n      this.showImport(false);\n    });\n  }\n  createImportzone(name) {\n    this.showImport(true);\n    let importzone = this.importcontainer.querySelector('#' + this.importid);\n\n\n    if (name === _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.typeimport.privileges) {\n      if (!importzone) {\n        importzone = document.createElement('select');\n        this.importid = importzone.id = this.importid + '-' + name;\n        importzone.dataset.type = _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.models.user;\n        importzone.multiple = true;\n        importzone.dataset.priv = true;\n        this.importcontainer.append(importzone);\n\n      }\n    } else {\n      const import_target = (this.form.querySelector('[name=\"' + name + '\"]')) ? this.form.querySelector('[name=\"' + name + '\"]') : this.form.querySelector('[data-importfield=\"' + name + '\"]');\n      const ts = import_target.tomselect;\n\n      if (!importzone) {\n        if (!import_target) return;\n        this.importzoneid = import_target.id;\n        // tomselect ?\n        importzone = import_target.cloneNode();\n        importzone.classList.remove('tomselected');\n        importzone.classList.remove('ts-hidden-accessible');\n        // keep original id to replace data on apply import\n        importzone.dataset.origin = importzone.id;\n        importzone.id = this.importid;\n        importzone.name = this.importid + '_' + importzone.name;\n        this.importcontainer.insertAdjacentHTML('afterbegin', importzone.outerHTML);\n        if (ts) {\n          importzone = this.importcontainer.querySelector('#' + this.importid);\n          const jsTomSelect = new _modules_js_tom_select_js__WEBPACK_IMPORTED_MODULE_1__.JsTomSelect();\n          jsTomSelect.applyTo(importzone);\n\n        }\n        this.activateClear();\n\n      }\n    }\n\n    return importzone;\n\n  }\n\n  makeImport(btn, selectcells, what, close = false) {\n    let done = false,\n      ts = null;\n    const importzone = (this.importcontainer) ? this.importcontainer.querySelector('#' + this.importid) : null;\n    switch (what) {\n      case _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.typeimport.taxo:\n\n        if (!importzone) return false;\n        const import_target = this.form.querySelector('#' + importzone.dataset.origin);\n\n        if (!import_target) return false;\n        ts = import_target.tomselect;\n        if (ts) {\n          // only if replace specified\n          if (btn.dataset.replace && btn.dataset.replace === 'replace') {\n            ts.clear();\n            ts.clearOptions();\n          }\n\n          const tzone = importzone.tomselect;\n          const items = [...tzone.items];\n          const options = Object.assign({}, tzone.options);\n          items.forEach((e, i) => {\n            let el = {};\n            el[ts.settings.valueField] = e;\n            el[ts.settings.searchField] = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_3__.unescape_html)(options[e][ts.settings.searchField]);\n            if (!ts.getOption(e)) ts.addOption(el);\n            ts.addItem(e);\n          });\n          tzone.clear();\n          tzone.clearOptions();\n        } else {\n          if (btn.dataset.replace && btn.dataset.replace === 'replace') import_target.innerHTML = ``;\n          import_target.innerHTML = dompurify__WEBPACK_IMPORTED_MODULE_0___default().sanitize(importzone.innerHTML);\n          importzone.innerHTML = ``;\n\n        }\n\n        done = true;\n        break;\n      case _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.typeimport.privileges:\n        if (!importzone) return false;\n        done = this.renderPrivileges(importzone, (btn.dataset.replace && btn.dataset.replace === 'replace'));\n\n        break;\n      default:\n        selectcells.forEach((name, index) => {\n          let input = ((this.form.querySelector('[data-importfield=\"' + name + '\"]')) ? this.form.querySelector('[data-importfield=\"' + name + '\"]') : this.form.querySelector('[name=\"' + name + '\"]'));\n\n          if (input && this.imports[name] !== undefined) {\n            ts = input.tomselect;\n\n            if (name === 'init_classif_list') {\n              let ids = this.imports[name];\n              if (Array.isArray(ids)) ids = ids.join(',');\n              else ids = ids.replace('[', '').replace(']', '').replaceAll(' ', '');\n              if (ids !== '') {\n                if (ts) ts.wrapper.classList.add('wait-for-results');\n                const formData = new FormData();\n                formData.append('idlist', ids);\n                const url = '/search/taxoresolve' //+ new URLSearchParams({'idlist': ids});\n                fetch(url, (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_3__.fetchSettings)({\n                  'method': 'POST',\n                  'body': formData\n                })).then(response =>\n                  response.json()\n                ).then(results => {\n                  if (ts) {\n                    Object.entries(results).forEach(([key, text]) => {\n                      let el = {};\n                      key = dompurify__WEBPACK_IMPORTED_MODULE_0___default().sanitize(key);\n                      text = dompurify__WEBPACK_IMPORTED_MODULE_0___default().sanitize(text);\n                      el[ts.settings.valueField] = key;\n                      el[ts.settings.searchField] = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_3__.unescape_html)(text);\n\n                      ts.addOption(el);\n                      ts.addItem(el[ts.settings.valueField]);\n                    });\n                  } else {\n                    let options = '';\n                    Object.entries(results).forEach(([key, text]) => {\n                      key = dompurify__WEBPACK_IMPORTED_MODULE_0___default().sanitize(key);\n                      text = dompurify__WEBPACK_IMPORTED_MODULE_0___default().sanitize(text);\n                      options += '<option value =\"' + key + '\" selected>' + text + '</option>';\n                    });\n                    input.innerHTML = options;\n                    options = '';\n                  }\n                  results = null;\n                  if (ts) ts.wrapper.classList.remove('wait-for-results');\n                });\n              }\n            } else if (ts) {\n              let el = {};\n              if (typeof(this.imports[name]) == 'string') {\n                el[ts.settings.labelField] = this.imports[name];\n                el[ts.settings.valueField] = this.imports[name];\n                el[ts.settings.searchField] = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_3__.unescape_html)(this.imports[name]);\n              } else {\n                el[ts.settings.labelField] = this.imports[name]['key'];\n                el[ts.settings.valueField] = this.imports[name]['key'];\n                el[ts.settings.searchField] = (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_3__.unescape_html)(this.imports[name]['value']);\n              }\n              ts.addOption(el);\n              ts.addItem(el[input.tomselect.settings.valueField]);\n              //  ts.refreshOptions();\n            } else {\n              const type = (input.type) ? input.type : input.tagName.toLowerCase();\n              switch (input.type) {\n                case 'radio':\n                case 'checkbox':\n                  input = this.form.querySelector('[name=\"' + name + '\"][value=\"' + this.imports[name] + '\"]');\n                  if (input) input.checked = true;\n                  break;\n                  /*case 'checkbox':\n                    // TODO ( multiple selection )\n                    this.form.querySelectorAll('[name=\"' + field + '\"]').forEach(input => {\n                      input.checked = (this.imports[name]['key'] === input.value);\n                    });\n                    break;*/\n                case 'select':\n                  // todo select multiple\n                  let option;\n                  if (this.imports[name]['key']) option = '<option value=\"' + this.imports[name]['key'] + '\" selected >' + this.imports[name]['value'] + '</option>';\n                  else option = '<option value=\"' + this.imports[name] + '\" selected >' + this.imports[name] + '</option>'\n                  input.insertAdjacentHTML('beforeend', option);\n                  break;\n                default:\n\n                  input.value = this.imports[name];\n                  break;\n              }\n            }\n            if (what !== _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.typeimport.settings) input.focus();\n            done = true;\n            // set imported tag to fieldbox\n            this.setImportedTag(input);\n          } else if (name === 'privileges') {\n            done = this.importPrivileges(this.imports[name], false);\n          }\n        });\n        break;\n    }\n    if (done === true && close == true) this.dismiss();\n  }\n\n  setImportedTag(input, selector = '.form-box') {\n    let el = (selector === null) ? input : (input.closest(selector) ? input.closest(selector) : input.closest('fieldset'));\n    if (!el) return;\n    el.dataset.isimported = this.form.dataset.isimported;\n    el.classList.add('imported');\n    const removetag = (e) => {\n      el.removeAttribute('data-isimported');\n      el.classList.remove('imported');\n      input.removeEventListener('change keydown', removetag);\n    }\n    input.addEventListener('change keydown', removetag);\n  }\n\n  dismiss(clear = false) {\n    if (this.button) this.showImport(false);\n    const container = this.dom.closest('details');\n    if (container) {\n      container.open = false;\n      if (clear === true) container.querySelector(this.content_selector).innerHTML = ``;\n    }\n\n  }\n  indexToCheck() {\n    // index of cells to check if empty and disable row  import btn\n    const grid = (this.tbl) ? this.tbl.grid : null;\n    if (!grid) return [0];\n    let index = grid.columns.findIndex(column => (column.what && column.what === _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.typeimport.taxo));\n    if (index === -1) return [0];\n    const parts = (grid.columns[index].parts) ? grid.columns[index].parts : null;\n    if (parts) {\n      const indextocheck = grid.columns.filter((column, i) => {\n        if (parts.indexOf(column.name) >= 0) return i;\n      }).map(v => {\n        return v.index;\n      });\n      return indextocheck;\n    }\n\n  }\n  // show / hide importzone and buttons\n  showImport(show) {\n    if (!this.button) return;\n\n    if (show === false) {\n      this.button.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.hide);\n      this.replacebutton.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.hide);\n      this.importcontainer.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.hide);\n      this.tabbutton.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.hide);\n\n    } else {\n      this.button.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.hide);\n      this.replacebutton.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.hide);\n\n      this.importcontainer.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.hide);\n      this.button.disabled = false;\n      const importzone = this.importcontainer.querySelector('#' + this.importid);\n      if (importzone) {\n        this.tabbutton.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.hide);\n        if (importzone.tomselect && importzone.tomselect.control.offsetHeight < importzone.tomselect.control.scrollHeight) {\n          this.tabbutton.disabled = false;\n        } else this.tabbutton.disabled = true;\n      }\n    }\n  }\n  // resize importzone\n  resizeZone(e) {\n    const div = this.importcontainer.closest(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.domselectors.component.import.zoneimport);\n    if (!div) return;\n    div.parentElement.classList.toggle(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.showfull);\n    const icon = e.currentTarget.querySelector('i');\n    if (icon) {\n      icon.classList.toggle('icon-arrow-pointing-out');\n      icon.classList.toggle('icon-arrow-pointing-in');\n    }\n  }\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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O0FBQ0E7QUFDQSx5QkFBeUIsa0VBQVU7QUFDbkM7QUFDQTtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpRkFBaUYsa0VBQVU7QUFDM0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBLE9BQU87QUFDUDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsZ0NBQWdDLDJEQUFHO0FBQ25DLHVDQUF1QywyREFBRztBQUMxQyx5Q0FBeUMsMkRBQUc7QUFDNUMsbUNBQW1DLDJEQUFHOztBQUV0QyxNQUFNO0FBQ04sbUNBQW1DLDJEQUFHO0FBQ3RDLDBDQUEwQywyREFBRzs7QUFFN0MsNENBQTRDLDJEQUFHO0FBQy9DO0FBQ0E7QUFDQTtBQUNBLHdDQUF3QywyREFBRztBQUMzQztBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2Q0FBNkMsb0VBQVk7QUFDekQ7QUFDQSx1Q0FBdUMsMkRBQUc7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvbW9kdWxlcy9kYXRhLWltcG9ydC5qcz84MGEyIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBET01QdXJpZnkgZnJvbSAnZG9tcHVyaWZ5JztcbmltcG9ydCB7XG4gIEpzVG9tU2VsZWN0XG59IGZyb20gXCIuLi9tb2R1bGVzL2pzLXRvbS1zZWxlY3QuanNcIjtcbmltcG9ydCB7XG4gIFByb2plY3RQcml2aWxlZ2VzXG59IGZyb20gJy4uL21vZHVsZXMvcHJvamVjdC1wcml2aWxlZ2VzLmpzJztcbmltcG9ydCB7XG4gIGZldGNoU2V0dGluZ3MsXG4gIHVuZXNjYXBlX2h0bWwsXG5cbn0gZnJvbSAnLi4vbW9kdWxlcy91dGlscy5qcyc7XG5pbXBvcnQge1xuICBtb2RlbHMsXG4gIHR5cGVpbXBvcnQsXG4gIGNzcyxcbiAgZGVmaW5lZF9wcml2aWxlZ2VzLFxuICBkb21zZWxlY3RvcnNcbn0gZnJvbSAnLi4vbW9kdWxlcy9tb2R1bGVzLWNvbmZpZy5qcyc7XG5jb25zdCBrZXlfcHJpdmlsZWdlcyA9IE9iamVjdC5rZXlzKGRlZmluZWRfcHJpdmlsZWdlcykucmVkdWNlKGZ1bmN0aW9uKHJlc3VsdCwga2V5KSB7XG4gIHJlc3VsdFtrZXldID0ga2V5O1xuICByZXR1cm4gcmVzdWx0O1xufSwge30pO1xubGV0IGluc3RhbmNlO1xuZXhwb3J0IGNsYXNzIERhdGFJbXBvcnQge1xuICBjb250ZW50X3NlbGVjdG9yID0gJy5tb2RhbC1jb250ZW50JztcbiAgaW1wb3J0cyA9IFtdO1xuICB0YXhvcyA9IFtcInByZXNldFwiLCBcImV4dHJhXCJdO1xuICBpbXBvcnRjb250YWluZXI7XG4gIGltcG9ydHpvbmVpZDtcbiAgaW1wb3J0aWQgPSAnaW1wb3J0em9uZSc7XG4gIHNlbGVjdG9ycztcbiAgYnV0dG9uO1xuICBjbGVhcmJ1dHRvbjtcbiAgcmVwbGFjZWJ1dHRvbjtcbiAgdGFiYnV0dG9uO1xuICB0YmwgPSBudWxsO1xuICBjb25zdHJ1Y3Rvcih0YmwsIHdoYXQgPSBudWxsLCBzZWxlY3RvciA9IG51bGwpIHtcbiAgICBpZiAoIXRibCkgcmV0dXJuO1xuICAgIC8vIHRibCBpcyBhIFRhYmxlQ29tcG9uZW50ICA/XG4gICAgdGhpcy50YmwgPSAodHlwZW9mKHRibCkgPT09ICdvYmplY3QnKSA/IHRibCA6IG51bGw7XG4gICAgLy8gZ2V0IHRoZSB0YWJsZSBmcm9tIHRhYmxlIGNvbXBvbmVudCBvciBodG1sIHRhYmxlIGVsZW1lbnQgaWRcbiAgICB0aGlzLmRvbSA9ICh0aGlzLnRibCkgPyB0aGlzLnRibC5kb20gOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0YmwpO1xuICAgIGlmICghdGhpcy5kb20pIHJldHVybjtcbiAgICB3aGF0ID0gKHdoYXQpID8gRE9NUHVyaWZ5LnNhbml0aXplKHdoYXQpIDogKHRibCAmJiB0YmwucGFyYW1zICYmIHRibC5wYXJhbXMuaW1wb3J0KSA/IHRibC5wYXJhbXMuaW1wb3J0IDogKHRoaXMuZG9tLmRhdGFzZXQuaW1wb3J0KSA/IERPTVB1cmlmeS5zYW5pdGl6ZSh0aGlzLmRvbS5kYXRhc2V0LmltcG9ydCkgOiBudWxsO1xuICAgIGlmICghaW5zdGFuY2UgfHwgaW5zdGFuY2UuZG9jICE9PSB0aGlzLmRvbSkge1xuICAgICAgLy8gZGVmYXVsdG9wdGlvbnMgLSBrZWVwIGxpa2UgdGhhdFxuICAgICAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAgICAgaW1wb3J0Y29udGFpbmVyOiAnI2RhdGEtaW1wb3J0LScgKyB3aGF0LFxuICAgICAgICBidG5zOiAnLmJ0bnMtaW1wb3J0cycsXG4gICAgICAgIGJ1dHRvbjogJyNhZGQtaW1wb3J0LScgKyB3aGF0LFxuICAgICAgICByZXBsYWNlYnV0dG9uOiAnI3JlcGxhY2UtaW1wb3J0LScgKyB3aGF0LFxuICAgICAgICB0YWJidXR0b246ICcjdGFiLWltcG9ydC0nICsgd2hhdCxcbiAgICAgICAgc2VsZWN0b3I6ICdkYXRhLWlkJyxcblxuICAgICAgfTtcbiAgICAgIHRoaXMuc2VsZWN0b3IgPSAoc2VsZWN0b3IpID8gc2VsZWN0b3IgOiBvcHRpb25zLnNlbGVjdG9yO1xuICAgICAgdGhpcy5pbXBvcnRjb250YWluZXIgPSBvcHRpb25zLmltcG9ydGNvbnRhaW5lciBpbnN0YW5jZW9mIEhUTUxFbGVtZW50ID8gb3B0aW9ucy5pbXBvcnRjb250YWluZXIgOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG9wdGlvbnMuaW1wb3J0Y29udGFpbmVyKTtcbiAgICAgIHRoaXMuZm9ybSA9IChvcHRpb25zLmZvcm0pID8gKChvcHRpb25zLmZvcm0pIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQgPyBvcHRpb25zLmZvcm0gOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG9wdGlvbnMuZm9ybSkpIDogdGhpcy5kb20uY2xvc2VzdCgnZm9ybScpO1xuICAgICAgdGhpcy5idXR0b24gPSBvcHRpb25zLmJ1dHRvbiBpbnN0YW5jZW9mIEhUTUxFbGVtZW50ID8gb3B0aW9ucy5idXR0b24gOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG9wdGlvbnMuYnV0dG9uKTtcbiAgICAgIHRoaXMucmVwbGFjZWJ1dHRvbiA9IG9wdGlvbnMucmVwbGFjZWJ1dHRvbiBpbnN0YW5jZW9mIEhUTUxFbGVtZW50ID8gb3B0aW9ucy5yZXBsYWNlYnV0dG9uIDogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihvcHRpb25zLnJlcGxhY2VidXR0b24pO1xuICAgICAgdGhpcy50YWJidXR0b24gPSBvcHRpb25zLnRhYmJ1dHRvbiBpbnN0YW5jZW9mIEhUTUxFbGVtZW50ID8gb3B0aW9ucy50YWJidXR0b24gOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG9wdGlvbnMudGFiYnV0dG9uKTtcbiAgICAgIHRoaXMuaW5pdChvcHRpb25zKTtcbiAgICAgIGluc3RhbmNlID0gdGhpcztcblxuICAgIH1cbiAgICByZXR1cm4gaW5zdGFuY2U7XG4gIH1cblxuICBpbml0KG9wdGlvbnMpIHtcbiAgICAvLyBoaWRlIGltcG9ydHpvbmVcbiAgICB0aGlzLnNob3dJbXBvcnQoZmFsc2UpO1xuICAgIC8vIHJlbW92ZSBsaW5lIG9mIHRhcmdldCBwcm9qXG4gICAgbGV0IHByb2ppZCA9IHRoaXMuZm9ybS5xdWVyeVNlbGVjdG9yKCcjJyArIGRvbXNlbGVjdG9ycy5wcm9qaWQpO1xuICAgIGlmIChwcm9qaWQgJiYgcHJvamlkLnZhbHVlKSB7XG4gICAgICBwcm9qaWQgPSB0aGlzLmRvbS5xdWVyeVNlbGVjdG9yKCdbJyArIHRoaXMuc2VsZWN0b3IgKyAnPVwiJyArIHByb2ppZC52YWx1ZSArICdcIl0nKTtcbiAgICAgIGlmIChwcm9qaWQpIHByb2ppZC5jbGFzc0xpc3QuYWRkKGNzcy5oaWRlKTtcblxuICAgIH1cbiAgICBjb25zdCBpbmRleHRvY2hlY2sgPSB0aGlzLmluZGV4VG9DaGVjaygpO1xuICAgIHRoaXMuc2VsZWN0b3JzID0gdGhpcy5kb20ucXVlcnlTZWxlY3RvckFsbCgnWycgKyB0aGlzLnNlbGVjdG9yICsgJ10gYnV0dG9uLCBbJyArIHRoaXMuc2VsZWN0b3IgKyAnXSBpbnB1dCcpO1xuICAgIHRoaXMuc2VsZWN0b3JzLmZvckVhY2goc2VsZWN0b3IgPT4ge1xuICAgICAgLy8gY2hlY2tib3ggcG9zc2libGVcbiAgICAgIGNvbnN0IGluZGV4ID0gQXJyYXkuZnJvbShzZWxlY3Rvci5wYXJlbnRFbGVtZW50LmNoaWxkcmVuKS5pbmRleE9mKChzZWxlY3RvcikpO1xuXG4gICAgICBpZiAoaW5kZXh0b2NoZWNrICYmIHNlbGVjdG9yLmNsb3Nlc3QoJ3RyJykuY2hpbGRyZW5baW5kZXh0b2NoZWNrW2luZGV4XV0uaW5uZXJIVE1MID09PSAnJykgc2VsZWN0b3IuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgZWxzZSB7XG4gICAgICAgIGNvbnN0IGV2dCA9IChzZWxlY3Rvci50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICdpbnB1dCcpID8gJ2NoYW5nZScgOiAnY2xpY2snO1xuICAgICAgICBjb25zdCBhcHBseV9zZWxlY3Rpb24gPSAoZSkgPT4ge1xuICAgICAgICAgIGNvbnN0IHRhcmdldCA9IGUuY3VycmVudFRhcmdldDtcbiAgICAgICAgICB0YXJnZXQuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICAgIHRoaXMudG9JbXBvcnQodGFyZ2V0LnBhcmVudEVsZW1lbnQsIGluZGV4KTtcbiAgICAgICAgfTtcbiAgICAgICAgc2VsZWN0b3IucmVtb3ZlRXZlbnRMaXN0ZW5lcihldnQsIGFwcGx5X3NlbGVjdGlvbiwgZmFsc2UpO1xuICAgICAgICBzZWxlY3Rvci5hZGRFdmVudExpc3RlbmVyKGV2dCwgYXBwbHlfc2VsZWN0aW9uLCBmYWxzZSk7XG4gICAgICB9O1xuICAgIH0pO1xuICAgIGlmICh0aGlzLmJ1dHRvbikge1xuICAgICAgdGhpcy50YWJidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgICB0aGlzLnJlc2l6ZVpvbmUoZSk7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuc2hvd0ltcG9ydChmYWxzZSk7XG4gICAgfVxuICB9XG4gIGNvbHVtblByb3BlcnR5KG5hbWUsIGluZGV4LCB0aCkge1xuICAgIGlmICh0aGlzLnRibCkgcmV0dXJuICh0aGlzLnRibC5ncmlkLmNvbHVtbnNbaW5kZXhdLmhhc093blByb3BlcnR5KG5hbWUpKSA/IHRoaXMudGJsLmdyaWQuY29sdW1uc1tpbmRleF1bbmFtZV0gOiBudWxsO1xuICAgIGVsc2UgcmV0dXJuICh0aC5kYXRhc2V0W25hbWVdKSA/IHRoLmRhdGFzZXQubmFtZSA6IG51bGw7XG4gIH1cbiAgY29sdW1uSW5kZXgocHJvcCwgdmFsdWUpIHtcbiAgICBpZiAodGhpcy50YmwpIHJldHVybiB0aGlzLnRibC5ncmlkLmNvbHVtbnMuZmluZEluZGV4KGNvbHVtbiA9PiAoY29sdW1uLmhhc093blByb3BlcnR5KHByb3ApICYmIGNvbHVtbltwcm9wXSA9PT0gdmFsdWUpKTtcbiAgICBlbHNlIHJldHVybiBBcnJheS5mcm9tKHRoaXMuZG9tLnF1ZXJ5U2VsZWN0b3JBbGwoJ3RoZWFkIHRoJykpLmZpbmRJbmRleCh0aCA9PiAodGguZGF0YXNldFtwcm9wXSAmJiB0aC5kYXRhc2V0W3Byb3BdID09PSB2YWx1ZSkpO1xuICB9XG4gIHJvd0luZGV4KHRkLCB0cnMpIHtcbiAgICBjb25zdCByZWYgPSAodGQucGFyZW50RWxlbWVudCkgPyB0ZC5wYXJlbnRFbGVtZW50IDogbnVsbDtcbiAgICBpZiAoIXJlZikgcmV0dXJuIG51bGw7XG4gICAgcmV0dXJuIHRycy5maW5kSW5kZXgodHIgPT4gKHRyID09PSByZWYpKTtcbiAgfVxuICB0b0ltcG9ydCh0ZCwgd2hhdHBhcnQgPSAwKSB7XG4gICAgY29uc3QgZ3JpZCA9ICh0aGlzLnRibCkgPyB0aGlzLnRibC5ncmlkIDogbnVsbDtcbiAgICBjb25zdCB0aGNlbGxzID0gQXJyYXkuZnJvbSh0aGlzLmRvbS5xdWVyeVNlbGVjdG9yQWxsKCd0aGVhZCB0aCcpKTtcbiAgICBjb25zdCB0cnMgPSBBcnJheS5mcm9tKHRoaXMuZG9tLnF1ZXJ5U2VsZWN0b3JBbGwoJ3Rib2R5IHRyJykpO1xuXG4gICAgY29uc3QgZGF0YXMgPSAoZ3JpZCkgPyBncmlkLmRhdGEgOiB0cnMubWFwKHRyID0+IHtcbiAgICAgIHJldHVybiBBcnJheS5mcm9tKHRyLmNoaWxkTm9kZXMpLmZvckVhY2goY2VsbCA9PiB7XG4gICAgICAgIHJldHVybiBjZWxsLmlubmVyVGV4dDtcbiAgICAgIH0pO1xuICAgIH0pOyAvLyBjZWxsIHZhbHVlcyBpbiBqc29uICAtIG5vIHBhcnNlXG4gICAgaWYgKHRkLnRhZ05hbWUudG9Mb3dlckNhc2UoKSAhPT0gJ3RkJykgdGQgPSB0ZC5jbG9zZXN0KCd0ZCcpO1xuICAgIGNvbnN0IHJvd2luZGV4ID0gdGhpcy5yb3dJbmRleCh0ZCwgdHJzKTtcbiAgICBpZiAocm93aW5kZXggPT09IG51bGwpIHJldHVybjtcbiAgICBsZXQgc2hvd2J0bnMgPSB0cnVlO1xuICAgIGNvbnN0IGNlbGxpbmRleCA9IHRkLmNlbGxJbmRleDtcbiAgICBjb25zdCB0aCA9IHRoY2VsbHNbY2VsbGluZGV4XTtcbiAgICBjb25zdCB0ZHMgPSB0cnNbcm93aW5kZXhdO1xuICAgIGNvbnN0IHdoYXQgPSB0aGlzLmNvbHVtblByb3BlcnR5KCd3aGF0JywgY2VsbGluZGV4LCB0aCk7XG4gICAgaWYgKCF3aGF0KSByZXR1cm47XG4gICAgY29uc3QgcGFydHMgPSB0aGlzLmNvbHVtblByb3BlcnR5KCdwYXJ0cycsIGNlbGxpbmRleCwgdGgpO1xuICAgIGxldCBjb250YWN0ID0gbnVsbDtcbiAgICBsZXQgc2VsZWN0Y2VsbHMgPSB0aGlzLmNvbHVtblByb3BlcnR5KCdzZWxlY3RjZWxscycsIGNlbGxpbmRleCwgdGgpO1xuICAgIHNlbGVjdGNlbGxzID0gKHNlbGVjdGNlbGxzKSA/ICgocGFydHMpID8gW3BhcnRzW3doYXRwYXJ0XV0gOiBzZWxlY3RjZWxscykgOiBudWxsO1xuICAgIGlmICghc2VsZWN0Y2VsbHMpIHJldHVybjtcbiAgICBpZiAod2hhdCA9PT0gdHlwZWltcG9ydC5zZXR0aW5ncykgdGhpcy5pbXBvcnRzW21vZGVscy5jb250YWN0XSA9IHRoaXMuZmluZENvbnRhY3QodGhjZWxscywgZGF0YXNbcm93aW5kZXhdKTtcbiAgICBjb25zdCBpbXBvcnR6b25lID0gKHdoYXQgPT09IHR5cGVpbXBvcnQudGF4byB8fCB3aGF0ID09PSB0eXBlaW1wb3J0LnByaXZpbGVnZXMpID8gdGhpcy5jcmVhdGVJbXBvcnR6b25lKHdoYXQpIDogbnVsbDtcbiAgICBsZXQgdHMgPSBudWxsO1xuICAgIHNlbGVjdGNlbGxzLmZvckVhY2goKG5hbWUsIGluZGV4KSA9PiB7XG4gICAgICBpbmRleCA9IHRoaXMuY29sdW1uSW5kZXgoJ25hbWUnLCBuYW1lKTtcbiAgICAgIGlmIChpbmRleCA+PSAwKSB7XG4gICAgICAgIC8vIHNob3cgaW1wb3J0IGJ1dHRvbnMgaWYgaW1wb3J0em9uZVxuICAgICAgICBjb25zdCBjZWxsID0gdHJzW3Jvd2luZGV4XS5jZWxsc1tpbmRleF07XG4gICAgICAgIGNvbnN0IGNlbGxkYXRhID0gZGF0YXNbcm93aW5kZXhdW2luZGV4XTtcbiAgICAgICAgY2VsbC5jbGFzc0xpc3QuYWRkKGNzcy5zZWxlY3RlZCk7XG4gICAgICAgIGNvbnN0IHRoY2VsbCA9IHRoY2VsbHNbaW5kZXhdO1xuICAgICAgICBzd2l0Y2ggKHdoYXQpIHtcbiAgICAgICAgICBjYXNlIHR5cGVpbXBvcnQudGF4bzpcbiAgICAgICAgICAgIC8vIGFjY3VtdWxhdGUgYW5kIHNob3cgaW4gaW1wb3J0IHdpbiAtIG1vdmUgdGhlIGZvcm0gZmllbGQgaW4gbW9kYWwgd2luIHRvIHZpZXcgdGhlIGNoYW5nZXMgYW5kIGJlbmVmaXQgb2YgdG9tLXNlbGVjdCBjb21wb25lbnQgZnVuY3RzLi4uXG4gICAgICAgICAgICB0cyA9IGltcG9ydHpvbmUudG9tc2VsZWN0O1xuICAgICAgICAgICAgbGV0IHRheG9ucyA9IGNlbGxkYXRhO1xuICAgICAgICAgICAgaWYgKHRheG9ucykge1xuICAgICAgICAgICAgICBpZiAodHMpIHtcbiAgICAgICAgICAgICAgICAvLyBtZXJnZSB0YXhvbnMgYW5kIG9wdGlvbnMgLSB1bmlxdWVcbiAgICAgICAgICAgICAgICBPYmplY3QudmFsdWVzKHRzLm9wdGlvbnMpLmZvckVhY2goKG9wdCkgPT4ge1xuICAgICAgICAgICAgICAgICAgbGV0IG9iaiA9IHt9O1xuICAgICAgICAgICAgICAgICAgb2JqW29wdFt0cy5zZXR0aW5ncy52YWx1ZUZpZWxkXV0gPSBvcHRbdHMuc2V0dGluZ3MubGFiZWxGaWVsZF07XG4gICAgICAgICAgICAgICAgICBpZiAoIXRheG9uc1tvcHRbdHMuc2V0dGluZ3MudmFsdWVGaWVsZF1dKSB0YXhvbnMgPSBPYmplY3QuYXNzaWduKHRheG9ucywgb2JqKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB0YXhvbnMgPSBPYmplY3QuZW50cmllcyh0YXhvbnMpO1xuICAgICAgICAgICAgICAgIC8vIHNvcnQgdGF4b25zXG4gICAgICAgICAgICAgICAgdGF4b25zLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgICAgICAgICAgIGxldCB4ID0gYVsxXTtcbiAgICAgICAgICAgICAgICAgIGxldCB5ID0gYlsxXTtcbiAgICAgICAgICAgICAgICAgIHJldHVybiArKHggPiB5KSB8fCAtKHkgPiB4KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB0cy5jbGVhcigpO1xuICAgICAgICAgICAgICAgIHRzLmNsZWFyT3B0aW9ucygpO1xuICAgICAgICAgICAgICAgIC8vIGFkZCB0YXhvbnMgaXRlbXNcbiAgICAgICAgICAgICAgICB0YXhvbnMuZm9yRWFjaCgoW2tleSwgdGV4dF0pID0+IHtcbiAgICAgICAgICAgICAgICAgIGlmICghdHMuZ2V0SXRlbShrZXkpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghdHMuZ2V0T3B0aW9uKGtleSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICBsZXQgb2JqID0ge307XG4gICAgICAgICAgICAgICAgICAgICAgb2JqW3RzLnNldHRpbmdzLnZhbHVlRmllbGRdID0ga2V5O1xuICAgICAgICAgICAgICAgICAgICAgIG9ialt0cy5zZXR0aW5ncy5sYWJlbEZpZWxkXSA9IHVuZXNjYXBlX2h0bWwodGV4dC50cmltKCkpO1xuICAgICAgICAgICAgICAgICAgICAgIHRzLmFkZE9wdGlvbihvYmopO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRzLmFkZEl0ZW0oa2V5KTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBPYmplY3QudmFsdWVzKGltcG9ydHpvbmUub3B0aW9ucykuZm9yRWFjaChvcHQgPT4ge1xuICAgICAgICAgICAgICAgICAgbGV0IG9iaiA9IHt9O1xuICAgICAgICAgICAgICAgICAgb2JqW29wdC52YWx1ZV0gPSBvcHQudGV4dDtcbiAgICAgICAgICAgICAgICAgIGlmICghdGF4b25zW29wdC52YWx1ZV0pIHRheG9ucyA9IE9iamVjdC5hc3NpZ24odGF4b25zLCBvYmopO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHRheG9ucyA9IE9iamVjdC5lbnRyaWVzKHRheG9ucyk7XG4gICAgICAgICAgICAgICAgdGF4b25zLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgICAgICAgICAgIGxldCB4ID0gYVsxXTtcbiAgICAgICAgICAgICAgICAgIGxldCB5ID0gYlsxXTtcbiAgICAgICAgICAgICAgICAgIHJldHVybiArKHggPiB5KSB8fCAtKHkgPiB4KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpbXBvcnR6b25lLmlubmVySFRNTCA9IGBgO1xuICAgICAgICAgICAgICAgIHRheG9ucy5mb3JFYWNoKChba2V5LCB0ZXh0XSkgPT4ge1xuICAgICAgICAgICAgICAgICAgaWYgKCFpbXBvcnR6b25lLnF1ZXJ5U2VsZWN0b3IoJ29wdGlvblt2YWx1ZT1cIicgKyBrZXkgKyAnXCJdJykpIGltcG9ydHpvbmUuaW5zZXJ0QWRqYWNlbnRIVE1MKCdiZWZvcmVlbmQnLCAnPG9wdGlvbiB2YWx1ZT1cIicgKyBrZXkgKyAnXCIgc2VsZWN0ZWQ+JyArIHRleHQgKyAnPC9vcHRpb24+Jyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgc2hvd2J0bnMgPSAodGF4b25zLmxlbmd0aCA+IDApO1xuICAgICAgICAgICAgICB0YXhvbnMgPSBudWxsO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIHR5cGVpbXBvcnQucHJpdmlsZWdlczpcbiAgICAgICAgICAgIGNvbnN0IHByaXZzID0gY2VsbGRhdGE7XG4gICAgICAgICAgICAvLyBzZXQgZXZlcnlib2R5IHRvICd2aWV3JyBpZiBtb3JlIHRoYW4gb25lIHByb2plY3QgaW1wb3J0ZWRcbiAgICAgICAgICAgIGNvbnN0IHJlc2V0cHJpdiA9ICgodHMgJiYgdHMuaXRlbXMubGVuZ3RoID4gMCkgfHwgKGltcG9ydHpvbmUuc2VsZWN0ZWRJbmRleCA+IDApKTtcblxuICAgICAgICAgICAgaWYgKCFpbXBvcnR6b25lLmRhdGFzZXQuaW5pdCkge1xuICAgICAgICAgICAgICAvKiAgICBjb25zdCBvcHRncm91cHMgPSBbXTtcbiAgICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKHByaXZzKS5mb3JFYWNoKHByaXYgPT4ge1xuICAgICAgICAgICAgICAgICAgICAvLyAgaW1wb3J0em9uZS5pbnNlcnRBZGphY2VudEhUTUwoJ2FmdGVyYmVnaW4nLCBgPG9wdGdyb3VwIHZhbHVlPVwiJHtwcml2fVwiIGxhYmVsPVwiJHtwcml2fVwiPjwvb3B0Z3JvdXA+YCk7XG4gICAgICAgICAgICAgICAgICAgIG9wdGdyb3Vwcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogcHJpdixcbiAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogcHJpdlxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgIH0pOyovXG4gICAgICAgICAgICAgIGNvbnN0IGpzVG9tU2VsZWN0ID0gbmV3IEpzVG9tU2VsZWN0KCk7XG4gICAgICAgICAgICAgIGpzVG9tU2VsZWN0LmFwcGx5VG8oaW1wb3J0em9uZSk7XG4gICAgICAgICAgICAgIGltcG9ydHpvbmUuZGF0YXNldC5pbml0ID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRzID0gaW1wb3J0em9uZS50b21zZWxlY3Q7XG5cbiAgICAgICAgICAgIE9iamVjdC5lbnRyaWVzKHByaXZzKS5mb3JFYWNoKChbcHJpdiwgbWVtYmVyc10pID0+IHtcbiAgICAgICAgICAgICAgbWVtYmVycy5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIChiLm5hbWUgPiBhLm5hbWUpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgbWVtYmVycy5mb3JFYWNoKG1lbWJlciA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgbmV3cHJpdiA9IChyZXNldHByaXYpID8ga2V5X3ByaXZpbGVnZXMudmlld2VycyA6IHByaXY7IC8vIHZpZXdlciBpZiBtb3JlIHRoYW4gb25lIHByb2plY3QgaW1wb3J0ZWRcbiAgICAgICAgICAgICAgICBsZXQgb3B0O1xuXG4gICAgICAgICAgICAgICAgaWYgKHRzKSB7XG4gICAgICAgICAgICAgICAgICBvcHQgPSB0cy5pdGVtcy5pbmRleE9mKG1lbWJlci5pZCk7XG4gICAgICAgICAgICAgICAgICBpZiAob3B0ID49IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdHMucmVtb3ZlSXRlbShtZW1iZXIuaWQpO1xuICAgICAgICAgICAgICAgICAgICB0cy5yZW1vdmVPcHRpb24obWVtYmVyLmlkKTtcbiAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgLy8gYWRkb3B0aW9uICYmIGFkZEl0ZW1cbiAgICAgICAgICAgICAgICAgIG9wdCA9IHtcbiAgICAgICAgICAgICAgICAgICAgb3B0Z3JvdXA6IG5ld3ByaXZcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIG9wdFt0cy5zZXR0aW5ncy52YWx1ZUZpZWxkXSA9IG1lbWJlci5pZDtcbiAgICAgICAgICAgICAgICAgIG9wdFt0cy5zZXR0aW5ncy5zZWFyY2hGaWVsZF0gPSBtZW1iZXIubmFtZTtcbiAgICAgICAgICAgICAgICAgIG9wdFt0cy5zZXR0aW5ncy5sYWJlbEZpZWxkXSA9IG1lbWJlci5uYW1lO1xuICAgICAgICAgICAgICAgICAgdHMuYWRkT3B0aW9uKG9wdCk7XG4gICAgICAgICAgICAgICAgICB0cy5hZGRJdGVtKG1lbWJlci5pZCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIG9wdCA9IGltcG9ydHpvbmUucXVlcnlTZWxlY3Rvcignb3B0aW9uW3ZhbHVlPVwiJyArIG1lbWJlci5pZCArICdcIl0nKTtcbiAgICAgICAgICAgICAgICAgIGlmIChvcHQgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgb3B0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XG4gICAgICAgICAgICAgICAgICAgIG9wdC52YWx1ZSA9IG1lbWJlci5pZDtcbiAgICAgICAgICAgICAgICAgICAgb3B0LmRhdGFzZXQub3B0Z3JvdXAgPSBuZXdwcml2O1xuICAgICAgICAgICAgICAgICAgICBvcHQuc2VsZWN0ZWQgPSBvcHQuZGVmYXVsdFNlbGVjdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgb3B0LnRleHQgPSBtZW1iZXIubmFtZTtcbiAgICAgICAgICAgICAgICAgICAgaW1wb3J0em9uZS5hZGQob3B0KTtcblxuICAgICAgICAgICAgICAgICAgfSBlbHNlIG9wdC5kYXRhc2V0Lm9wdGdyb3VwID0gbmV3cHJpdjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICBpbXBvcnR6b25lLnRvbXNlbGVjdC5yZWZyZXNoT3B0aW9ucygpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHNob3didG5zID0gKCgodHMpID8gdHMuaXRlbXMubGVuZ3RoIDogaW1wb3J0em9uZS5zZWxlY3RlZEluZGV4ICsgMSkgPiAwKTtcblxuXG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBkZWZhdWx0OlxuXG4gICAgICAgICAgICBpZiAodGhjZWxsLmRhdGFzZXQuYXV0b2NvbXBsZXRlKSB7XG4gICAgICAgICAgICAgIC8vIHNlbGVjdCBlbGVtZW50cyB3aGVyZSBrZXkgLyB2YWx1ZSBpbiBkaWZmZXJlbnQgY29sdW1uc1xuICAgICAgICAgICAgICB0aGlzLmltcG9ydHNbbmFtZV0gPSB7XG4gICAgICAgICAgICAgICAgdmFsdWU6IGNlbGxkYXRhLFxuICAgICAgICAgICAgICAgIGtleTogbnVsbFxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICBsZXQgZWwgPSBudWxsO1xuICAgICAgICAgICAgICB0aGNlbGxzLmV2ZXJ5KCh0LCBpZHgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodC5kYXRhc2V0Lm5hbWUgPT0gdGhjZWxsLmRhdGFzZXQuYXV0b2NvbXBsZXRlKSB7XG4gICAgICAgICAgICAgICAgICBlbCA9IGlkeDtcbiAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICBpZiAoZWwgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBlbCA9IGRhdGFzW3Jvd2luZGV4XVtlbF07XG5cbiAgICAgICAgICAgICAgICB0aGlzLmltcG9ydHNbbmFtZV0ua2V5ID0gZWw7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhjZWxsLmRhdGFzZXQudmFsdWUpIHRoaXMuaW1wb3J0c1tuYW1lXSA9IHRoY2VsbC5kYXRhc2V0LnZhbHVlO1xuICAgICAgICAgICAgZWxzZSB0aGlzLmltcG9ydHNbbmFtZV0gPSBjZWxsZGF0YTtcblxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfSk7XG5cbiAgICBpZiAodGhjZWxscy5sZW5ndGgpIHtcbiAgICAgIGlmICh0aGlzLmJ1dHRvbikge1xuICAgICAgICB0aGlzLnNob3dJbXBvcnQoc2hvd2J0bnMpO1xuICAgICAgICBpZiAoIXRoaXMuYnV0dG9uLmRhdGFzZXQuYWN0aXZhdGVkICYmICh3aGF0ID09PSB0eXBlaW1wb3J0LnRheG8gfHwgd2hhdCA9PT0gdHlwZWltcG9ydC5wcml2aWxlZ2VzKSkgdGhpcy5hY3RpdmF0ZUJ1dHRvbnMod2hhdCwgc2VsZWN0Y2VsbHMpO1xuICAgICAgfSBlbHNlIHRoaXMubWFrZUltcG9ydChudWxsLCBzZWxlY3RjZWxscywgd2hhdCwgdHJ1ZSk7XG4gICAgfVxuICAgIC8vXG5cbiAgfVxuICBtZXNzYWdlWm9uZShpdGVtKSB7XG4gICAgY29uc29sZS5sb2coJ2l0ZW1tZXNzYWdlJywgaXRlbSk7XG4gIH1cbiAgYWN0aXZhdGVCdXR0b25zKHdoYXQsIHNlbGVjdGNlbGxzKSB7XG5cbiAgICB0aGlzLmJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB0aGlzLm1ha2VJbXBvcnQoZS5jdXJyZW50VGFyZ2V0LCBzZWxlY3RjZWxscywgd2hhdCwgdHJ1ZSk7XG5cbiAgICB9KTtcbiAgICB0aGlzLnJlcGxhY2VidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgdGhpcy5tYWtlSW1wb3J0KGUuY3VycmVudFRhcmdldCwgc2VsZWN0Y2VsbHMsIHdoYXQsIHRydWUpO1xuXG4gICAgfSk7XG5cbiAgICB0aGlzLmJ1dHRvbi5kYXRhc2V0LmFjdGl2YXRlZCA9IHRydWU7XG4gICAgdGhpcy5yZXBsYWNlYnV0dG9uLmRhdGFzZXQuYWN0aXZhdGVkID0gdHJ1ZTtcbiAgfVxuXG4gIGZpbmRDb250YWN0KHRoY2VsbHMsIHRkcykge1xuICAgIGxldCBjb250YWN0ID0gbnVsbDtcbiAgICB0aGNlbGxzLmV2ZXJ5KCh0LCBpZHgpID0+IHtcbiAgICAgIGlmICh0LmRhdGFzZXQubmFtZSAmJiB0LmRhdGFzZXQubmFtZSA9PT0gbW9kZWxzLmNvbnRhY3QpIHtcbiAgICAgICAgY29udGFjdCA9IGlkeDtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSk7XG4gICAgaWYgKGNvbnRhY3QpIGNvbnRhY3QgPSB0ZHNbY29udGFjdF0gPyB0ZHNbY29udGFjdF0gOiAwO1xuXG4gICAgcmV0dXJuIGNvbnRhY3Q7XG4gIH1cblxuICByZW5kZXJQcml2aWxlZ2VzKGltcG9ydHpvbmUsIHJlcGxhY2UgPSBmYWxzZSkge1xuICAgIGxldCBwcml2aWxlZ2VzID0ge307XG4gICAgY29uc3QgdHpvbmUgPSBpbXBvcnR6b25lLnRvbXNlbGVjdDtcbiAgICBjb25zdCBwdXNocHJpdiA9IChtZW1iZXIsIHByaXYpID0+IHtcbiAgICAgIGNvbnN0IG9iaiA9IHtcbiAgICAgICAgaWQ6IG1lbWJlci5pZCxcbiAgICAgICAgbmFtZTogbWVtYmVyLm5hbWUsXG4gICAgICAgIHByaXY6IHByaXZcbiAgICAgIH1cbiAgICAgIGlmIChwcml2aWxlZ2VzW3ByaXZdKSBwcml2aWxlZ2VzW3ByaXZdLnB1c2gob2JqKTtcbiAgICAgIGVsc2UgcHJpdmlsZWdlc1twcml2XSA9IFtvYmpdO1xuICAgIH1cblxuICAgIGlmICh0em9uZSkge1xuICAgICAgY29uc3QgbWVtYmVycyA9IFsuLi50em9uZS5pdGVtc107XG4gICAgICBjb25zdCBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7fSwgdHpvbmUub3B0aW9ucyk7XG4gICAgICBtZW1iZXJzLmZvckVhY2gobWVtYmVyID0+IHtcbiAgICAgICAgbWVtYmVyID0gb3B0aW9uc1ttZW1iZXJdO1xuICAgICAgICBpZiAobWVtYmVyKSBwdXNocHJpdihtZW1iZXIsIG1lbWJlci5vcHRncm91cCk7XG5cbiAgICAgIH0pXG4gICAgfSBlbHNlIHtcbiAgICAgIGltcG9ydHpvbmUub3B0aW9ucy5mb3JFYWNoKG1lbWJlciA9PiB7XG4gICAgICAgIGlmIChtZW1iZXIuc2VsZWN0ZWQpIHB1c2hwcml2KG1lbWJlciwgbWVtYmVyLmRhdGFzZXQub3B0Z3JvdXApO1xuICAgICAgfSlcbiAgICB9XG5cblxuICAgIGlmICh0aGlzLmltcG9ydFByaXZpbGVnZXMocHJpdmlsZWdlcywgcmVwbGFjZSkpIHtcblxuICAgICAgaWYgKHR6b25lKSB7XG4gICAgICAgIHR6b25lLmNsZWFyKCk7XG4gICAgICAgIHR6b25lLmNsZWFyT3B0aW9ucygpO1xuICAgICAgfSBlbHNlIGltcG9ydHpvbmUuaW5uZXJIVE1MID0gYGA7XG5cbiAgICB9XG5cbiAgfVxuXG4gIGltcG9ydFByaXZpbGVnZXMocHJpdmlsZWdlcywgY2xlYXIgPSBmYWxzZSkge1xuICAgIGNvbnN0IHByb2plY3RQcml2aWxlZ2VzID0gbmV3IFByb2plY3RQcml2aWxlZ2VzKCk7XG4gICAgY29uc3QgaW1wb3J0ZWR0YWcgPSAoaW5wdXQpID0+IHtcbiAgICAgIHRoaXMuc2V0SW1wb3J0ZWRUYWcoaW5wdXQsIG51bGwpO1xuICAgIH1cbiAgICBjb25zdCBkaXNtaXNzID0gKCkgPT4ge1xuICAgICAgdGhpcy5kaXNtaXNzKCk7XG4gICAgfVxuICAgIGNvbnN0IGNvbnRhY3QgPSAoKHRoaXMuaW1wb3J0c1ttb2RlbHMuY29udGFjdF0pID8gdGhpcy5pbXBvcnRzW21vZGVscy5jb250YWN0XSA6IG51bGwpO1xuICAgIHJldHVybiAocHJvamVjdFByaXZpbGVnZXMuaW1wb3J0UHJpdmlsZWdlcyhwcml2aWxlZ2VzLCBjbGVhciwgY29udGFjdCwgaW1wb3J0ZWR0YWcsIGRpc21pc3MpKTtcbiAgfVxuICBhY3RpdmF0ZUNsZWFyKCkge1xuICAgIGNvbnN0IGNsZWFyYnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NsZWFyLScgKyB0aGlzLmltcG9ydGlkKTtcbiAgICBpZiAoIWNsZWFyYnV0dG9uKSByZXR1cm47XG4gICAgY2xlYXJidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgaWYgKCF0aGlzLmltcG9ydGNvbnRhaW5lcikgcmV0dXJuO1xuICAgICAgdGhpcy5zZWxlY3RvcnMuZm9yRWFjaChzZWxlY3RvciA9PiB7XG4gICAgICAgIGlmIChzZWxlY3Rvci5kaXNhYmxlZCkge1xuICAgICAgICAgIHNlbGVjdG9yLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgICAgc2VsZWN0b3IuY2xvc2VzdCgndHInKS5xdWVyeVNlbGVjdG9yQWxsKCcuc2VsZWN0ZWQnKS5mb3JFYWNoKGVsID0+IHtcbiAgICAgICAgICAgIGVsLmNsYXNzTGlzdC5yZW1vdmUoY3NzLnNlbGVjdGVkKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICB0aGlzLmJ1dHRvbi5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgdGhpcy5yZXBsYWNlYnV0dG9uLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICB0aGlzLnNob3dJbXBvcnQoZmFsc2UpO1xuICAgIH0pO1xuICB9XG4gIGNyZWF0ZUltcG9ydHpvbmUobmFtZSkge1xuICAgIHRoaXMuc2hvd0ltcG9ydCh0cnVlKTtcbiAgICBsZXQgaW1wb3J0em9uZSA9IHRoaXMuaW1wb3J0Y29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJyMnICsgdGhpcy5pbXBvcnRpZCk7XG5cblxuICAgIGlmIChuYW1lID09PSB0eXBlaW1wb3J0LnByaXZpbGVnZXMpIHtcbiAgICAgIGlmICghaW1wb3J0em9uZSkge1xuICAgICAgICBpbXBvcnR6b25lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2VsZWN0Jyk7XG4gICAgICAgIHRoaXMuaW1wb3J0aWQgPSBpbXBvcnR6b25lLmlkID0gdGhpcy5pbXBvcnRpZCArICctJyArIG5hbWU7XG4gICAgICAgIGltcG9ydHpvbmUuZGF0YXNldC50eXBlID0gbW9kZWxzLnVzZXI7XG4gICAgICAgIGltcG9ydHpvbmUubXVsdGlwbGUgPSB0cnVlO1xuICAgICAgICBpbXBvcnR6b25lLmRhdGFzZXQucHJpdiA9IHRydWU7XG4gICAgICAgIHRoaXMuaW1wb3J0Y29udGFpbmVyLmFwcGVuZChpbXBvcnR6b25lKTtcblxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBpbXBvcnRfdGFyZ2V0ID0gKHRoaXMuZm9ybS5xdWVyeVNlbGVjdG9yKCdbbmFtZT1cIicgKyBuYW1lICsgJ1wiXScpKSA/IHRoaXMuZm9ybS5xdWVyeVNlbGVjdG9yKCdbbmFtZT1cIicgKyBuYW1lICsgJ1wiXScpIDogdGhpcy5mb3JtLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLWltcG9ydGZpZWxkPVwiJyArIG5hbWUgKyAnXCJdJyk7XG4gICAgICBjb25zdCB0cyA9IGltcG9ydF90YXJnZXQudG9tc2VsZWN0O1xuXG4gICAgICBpZiAoIWltcG9ydHpvbmUpIHtcbiAgICAgICAgaWYgKCFpbXBvcnRfdGFyZ2V0KSByZXR1cm47XG4gICAgICAgIHRoaXMuaW1wb3J0em9uZWlkID0gaW1wb3J0X3RhcmdldC5pZDtcbiAgICAgICAgLy8gdG9tc2VsZWN0ID9cbiAgICAgICAgaW1wb3J0em9uZSA9IGltcG9ydF90YXJnZXQuY2xvbmVOb2RlKCk7XG4gICAgICAgIGltcG9ydHpvbmUuY2xhc3NMaXN0LnJlbW92ZSgndG9tc2VsZWN0ZWQnKTtcbiAgICAgICAgaW1wb3J0em9uZS5jbGFzc0xpc3QucmVtb3ZlKCd0cy1oaWRkZW4tYWNjZXNzaWJsZScpO1xuICAgICAgICAvLyBrZWVwIG9yaWdpbmFsIGlkIHRvIHJlcGxhY2UgZGF0YSBvbiBhcHBseSBpbXBvcnRcbiAgICAgICAgaW1wb3J0em9uZS5kYXRhc2V0Lm9yaWdpbiA9IGltcG9ydHpvbmUuaWQ7XG4gICAgICAgIGltcG9ydHpvbmUuaWQgPSB0aGlzLmltcG9ydGlkO1xuICAgICAgICBpbXBvcnR6b25lLm5hbWUgPSB0aGlzLmltcG9ydGlkICsgJ18nICsgaW1wb3J0em9uZS5uYW1lO1xuICAgICAgICB0aGlzLmltcG9ydGNvbnRhaW5lci5pbnNlcnRBZGphY2VudEhUTUwoJ2FmdGVyYmVnaW4nLCBpbXBvcnR6b25lLm91dGVySFRNTCk7XG4gICAgICAgIGlmICh0cykge1xuICAgICAgICAgIGltcG9ydHpvbmUgPSB0aGlzLmltcG9ydGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcjJyArIHRoaXMuaW1wb3J0aWQpO1xuICAgICAgICAgIGNvbnN0IGpzVG9tU2VsZWN0ID0gbmV3IEpzVG9tU2VsZWN0KCk7XG4gICAgICAgICAganNUb21TZWxlY3QuYXBwbHlUbyhpbXBvcnR6b25lKTtcblxuICAgICAgICB9XG4gICAgICAgIHRoaXMuYWN0aXZhdGVDbGVhcigpO1xuXG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGltcG9ydHpvbmU7XG5cbiAgfVxuXG4gIG1ha2VJbXBvcnQoYnRuLCBzZWxlY3RjZWxscywgd2hhdCwgY2xvc2UgPSBmYWxzZSkge1xuICAgIGxldCBkb25lID0gZmFsc2UsXG4gICAgICB0cyA9IG51bGw7XG4gICAgY29uc3QgaW1wb3J0em9uZSA9ICh0aGlzLmltcG9ydGNvbnRhaW5lcikgPyB0aGlzLmltcG9ydGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcjJyArIHRoaXMuaW1wb3J0aWQpIDogbnVsbDtcbiAgICBzd2l0Y2ggKHdoYXQpIHtcbiAgICAgIGNhc2UgdHlwZWltcG9ydC50YXhvOlxuXG4gICAgICAgIGlmICghaW1wb3J0em9uZSkgcmV0dXJuIGZhbHNlO1xuICAgICAgICBjb25zdCBpbXBvcnRfdGFyZ2V0ID0gdGhpcy5mb3JtLnF1ZXJ5U2VsZWN0b3IoJyMnICsgaW1wb3J0em9uZS5kYXRhc2V0Lm9yaWdpbik7XG5cbiAgICAgICAgaWYgKCFpbXBvcnRfdGFyZ2V0KSByZXR1cm4gZmFsc2U7XG4gICAgICAgIHRzID0gaW1wb3J0X3RhcmdldC50b21zZWxlY3Q7XG4gICAgICAgIGlmICh0cykge1xuICAgICAgICAgIC8vIG9ubHkgaWYgcmVwbGFjZSBzcGVjaWZpZWRcbiAgICAgICAgICBpZiAoYnRuLmRhdGFzZXQucmVwbGFjZSAmJiBidG4uZGF0YXNldC5yZXBsYWNlID09PSAncmVwbGFjZScpIHtcbiAgICAgICAgICAgIHRzLmNsZWFyKCk7XG4gICAgICAgICAgICB0cy5jbGVhck9wdGlvbnMoKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBjb25zdCB0em9uZSA9IGltcG9ydHpvbmUudG9tc2VsZWN0O1xuICAgICAgICAgIGNvbnN0IGl0ZW1zID0gWy4uLnR6b25lLml0ZW1zXTtcbiAgICAgICAgICBjb25zdCBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7fSwgdHpvbmUub3B0aW9ucyk7XG4gICAgICAgICAgaXRlbXMuZm9yRWFjaCgoZSwgaSkgPT4ge1xuICAgICAgICAgICAgbGV0IGVsID0ge307XG4gICAgICAgICAgICBlbFt0cy5zZXR0aW5ncy52YWx1ZUZpZWxkXSA9IGU7XG4gICAgICAgICAgICBlbFt0cy5zZXR0aW5ncy5zZWFyY2hGaWVsZF0gPSB1bmVzY2FwZV9odG1sKG9wdGlvbnNbZV1bdHMuc2V0dGluZ3Muc2VhcmNoRmllbGRdKTtcbiAgICAgICAgICAgIGlmICghdHMuZ2V0T3B0aW9uKGUpKSB0cy5hZGRPcHRpb24oZWwpO1xuICAgICAgICAgICAgdHMuYWRkSXRlbShlKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICB0em9uZS5jbGVhcigpO1xuICAgICAgICAgIHR6b25lLmNsZWFyT3B0aW9ucygpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChidG4uZGF0YXNldC5yZXBsYWNlICYmIGJ0bi5kYXRhc2V0LnJlcGxhY2UgPT09ICdyZXBsYWNlJykgaW1wb3J0X3RhcmdldC5pbm5lckhUTUwgPSBgYDtcbiAgICAgICAgICBpbXBvcnRfdGFyZ2V0LmlubmVySFRNTCA9IERPTVB1cmlmeS5zYW5pdGl6ZShpbXBvcnR6b25lLmlubmVySFRNTCk7XG4gICAgICAgICAgaW1wb3J0em9uZS5pbm5lckhUTUwgPSBgYDtcblxuICAgICAgICB9XG5cbiAgICAgICAgZG9uZSA9IHRydWU7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSB0eXBlaW1wb3J0LnByaXZpbGVnZXM6XG4gICAgICAgIGlmICghaW1wb3J0em9uZSkgcmV0dXJuIGZhbHNlO1xuICAgICAgICBkb25lID0gdGhpcy5yZW5kZXJQcml2aWxlZ2VzKGltcG9ydHpvbmUsIChidG4uZGF0YXNldC5yZXBsYWNlICYmIGJ0bi5kYXRhc2V0LnJlcGxhY2UgPT09ICdyZXBsYWNlJykpO1xuXG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgc2VsZWN0Y2VsbHMuZm9yRWFjaCgobmFtZSwgaW5kZXgpID0+IHtcbiAgICAgICAgICBsZXQgaW5wdXQgPSAoKHRoaXMuZm9ybS5xdWVyeVNlbGVjdG9yKCdbZGF0YS1pbXBvcnRmaWVsZD1cIicgKyBuYW1lICsgJ1wiXScpKSA/IHRoaXMuZm9ybS5xdWVyeVNlbGVjdG9yKCdbZGF0YS1pbXBvcnRmaWVsZD1cIicgKyBuYW1lICsgJ1wiXScpIDogdGhpcy5mb3JtLnF1ZXJ5U2VsZWN0b3IoJ1tuYW1lPVwiJyArIG5hbWUgKyAnXCJdJykpO1xuXG4gICAgICAgICAgaWYgKGlucHV0ICYmIHRoaXMuaW1wb3J0c1tuYW1lXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0cyA9IGlucHV0LnRvbXNlbGVjdDtcblxuICAgICAgICAgICAgaWYgKG5hbWUgPT09ICdpbml0X2NsYXNzaWZfbGlzdCcpIHtcbiAgICAgICAgICAgICAgbGV0IGlkcyA9IHRoaXMuaW1wb3J0c1tuYW1lXTtcbiAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoaWRzKSkgaWRzID0gaWRzLmpvaW4oJywnKTtcbiAgICAgICAgICAgICAgZWxzZSBpZHMgPSBpZHMucmVwbGFjZSgnWycsICcnKS5yZXBsYWNlKCddJywgJycpLnJlcGxhY2VBbGwoJyAnLCAnJyk7XG4gICAgICAgICAgICAgIGlmIChpZHMgIT09ICcnKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRzKSB0cy53cmFwcGVyLmNsYXNzTGlzdC5hZGQoJ3dhaXQtZm9yLXJlc3VsdHMnKTtcbiAgICAgICAgICAgICAgICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuICAgICAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnaWRsaXN0JywgaWRzKTtcbiAgICAgICAgICAgICAgICBjb25zdCB1cmwgPSAnL3NlYXJjaC90YXhvcmVzb2x2ZScgLy8rIG5ldyBVUkxTZWFyY2hQYXJhbXMoeydpZGxpc3QnOiBpZHN9KTtcbiAgICAgICAgICAgICAgICBmZXRjaCh1cmwsIGZldGNoU2V0dGluZ3Moe1xuICAgICAgICAgICAgICAgICAgJ21ldGhvZCc6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICAgICdib2R5JzogZm9ybURhdGFcbiAgICAgICAgICAgICAgICB9KSkudGhlbihyZXNwb25zZSA9PlxuICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuanNvbigpXG4gICAgICAgICAgICAgICAgKS50aGVuKHJlc3VsdHMgPT4ge1xuICAgICAgICAgICAgICAgICAgaWYgKHRzKSB7XG4gICAgICAgICAgICAgICAgICAgIE9iamVjdC5lbnRyaWVzKHJlc3VsdHMpLmZvckVhY2goKFtrZXksIHRleHRdKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgbGV0IGVsID0ge307XG4gICAgICAgICAgICAgICAgICAgICAga2V5ID0gRE9NUHVyaWZ5LnNhbml0aXplKGtleSk7XG4gICAgICAgICAgICAgICAgICAgICAgdGV4dCA9IERPTVB1cmlmeS5zYW5pdGl6ZSh0ZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgICBlbFt0cy5zZXR0aW5ncy52YWx1ZUZpZWxkXSA9IGtleTtcbiAgICAgICAgICAgICAgICAgICAgICBlbFt0cy5zZXR0aW5ncy5zZWFyY2hGaWVsZF0gPSB1bmVzY2FwZV9odG1sKHRleHQpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgdHMuYWRkT3B0aW9uKGVsKTtcbiAgICAgICAgICAgICAgICAgICAgICB0cy5hZGRJdGVtKGVsW3RzLnNldHRpbmdzLnZhbHVlRmllbGRdKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBsZXQgb3B0aW9ucyA9ICcnO1xuICAgICAgICAgICAgICAgICAgICBPYmplY3QuZW50cmllcyhyZXN1bHRzKS5mb3JFYWNoKChba2V5LCB0ZXh0XSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgIGtleSA9IERPTVB1cmlmeS5zYW5pdGl6ZShrZXkpO1xuICAgICAgICAgICAgICAgICAgICAgIHRleHQgPSBET01QdXJpZnkuc2FuaXRpemUodGV4dCk7XG4gICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyArPSAnPG9wdGlvbiB2YWx1ZSA9XCInICsga2V5ICsgJ1wiIHNlbGVjdGVkPicgKyB0ZXh0ICsgJzwvb3B0aW9uPic7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBpbnB1dC5pbm5lckhUTUwgPSBvcHRpb25zO1xuICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0gJyc7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICByZXN1bHRzID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgIGlmICh0cykgdHMud3JhcHBlci5jbGFzc0xpc3QucmVtb3ZlKCd3YWl0LWZvci1yZXN1bHRzJyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAodHMpIHtcbiAgICAgICAgICAgICAgbGV0IGVsID0ge307XG4gICAgICAgICAgICAgIGlmICh0eXBlb2YodGhpcy5pbXBvcnRzW25hbWVdKSA9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIGVsW3RzLnNldHRpbmdzLmxhYmVsRmllbGRdID0gdGhpcy5pbXBvcnRzW25hbWVdO1xuICAgICAgICAgICAgICAgIGVsW3RzLnNldHRpbmdzLnZhbHVlRmllbGRdID0gdGhpcy5pbXBvcnRzW25hbWVdO1xuICAgICAgICAgICAgICAgIGVsW3RzLnNldHRpbmdzLnNlYXJjaEZpZWxkXSA9IHVuZXNjYXBlX2h0bWwodGhpcy5pbXBvcnRzW25hbWVdKTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBlbFt0cy5zZXR0aW5ncy5sYWJlbEZpZWxkXSA9IHRoaXMuaW1wb3J0c1tuYW1lXVsna2V5J107XG4gICAgICAgICAgICAgICAgZWxbdHMuc2V0dGluZ3MudmFsdWVGaWVsZF0gPSB0aGlzLmltcG9ydHNbbmFtZV1bJ2tleSddO1xuICAgICAgICAgICAgICAgIGVsW3RzLnNldHRpbmdzLnNlYXJjaEZpZWxkXSA9IHVuZXNjYXBlX2h0bWwodGhpcy5pbXBvcnRzW25hbWVdWyd2YWx1ZSddKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB0cy5hZGRPcHRpb24oZWwpO1xuICAgICAgICAgICAgICB0cy5hZGRJdGVtKGVsW2lucHV0LnRvbXNlbGVjdC5zZXR0aW5ncy52YWx1ZUZpZWxkXSk7XG4gICAgICAgICAgICAgIC8vICB0cy5yZWZyZXNoT3B0aW9ucygpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgY29uc3QgdHlwZSA9IChpbnB1dC50eXBlKSA/IGlucHV0LnR5cGUgOiBpbnB1dC50YWdOYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3JhZGlvJzpcbiAgICAgICAgICAgICAgICBjYXNlICdjaGVja2JveCc6XG4gICAgICAgICAgICAgICAgICBpbnB1dCA9IHRoaXMuZm9ybS5xdWVyeVNlbGVjdG9yKCdbbmFtZT1cIicgKyBuYW1lICsgJ1wiXVt2YWx1ZT1cIicgKyB0aGlzLmltcG9ydHNbbmFtZV0gKyAnXCJdJyk7XG4gICAgICAgICAgICAgICAgICBpZiAoaW5wdXQpIGlucHV0LmNoZWNrZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAvKmNhc2UgJ2NoZWNrYm94JzpcbiAgICAgICAgICAgICAgICAgICAgLy8gVE9ETyAoIG11bHRpcGxlIHNlbGVjdGlvbiApXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZm9ybS5xdWVyeVNlbGVjdG9yQWxsKCdbbmFtZT1cIicgKyBmaWVsZCArICdcIl0nKS5mb3JFYWNoKGlucHV0ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gKHRoaXMuaW1wb3J0c1tuYW1lXVsna2V5J10gPT09IGlucHV0LnZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrOyovXG4gICAgICAgICAgICAgICAgY2FzZSAnc2VsZWN0JzpcbiAgICAgICAgICAgICAgICAgIC8vIHRvZG8gc2VsZWN0IG11bHRpcGxlXG4gICAgICAgICAgICAgICAgICBsZXQgb3B0aW9uO1xuICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaW1wb3J0c1tuYW1lXVsna2V5J10pIG9wdGlvbiA9ICc8b3B0aW9uIHZhbHVlPVwiJyArIHRoaXMuaW1wb3J0c1tuYW1lXVsna2V5J10gKyAnXCIgc2VsZWN0ZWQgPicgKyB0aGlzLmltcG9ydHNbbmFtZV1bJ3ZhbHVlJ10gKyAnPC9vcHRpb24+JztcbiAgICAgICAgICAgICAgICAgIGVsc2Ugb3B0aW9uID0gJzxvcHRpb24gdmFsdWU9XCInICsgdGhpcy5pbXBvcnRzW25hbWVdICsgJ1wiIHNlbGVjdGVkID4nICsgdGhpcy5pbXBvcnRzW25hbWVdICsgJzwvb3B0aW9uPidcbiAgICAgICAgICAgICAgICAgIGlucHV0Lmluc2VydEFkamFjZW50SFRNTCgnYmVmb3JlZW5kJywgb3B0aW9uKTtcbiAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG5cbiAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlID0gdGhpcy5pbXBvcnRzW25hbWVdO1xuICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh3aGF0ICE9PSB0eXBlaW1wb3J0LnNldHRpbmdzKSBpbnB1dC5mb2N1cygpO1xuICAgICAgICAgICAgZG9uZSA9IHRydWU7XG4gICAgICAgICAgICAvLyBzZXQgaW1wb3J0ZWQgdGFnIHRvIGZpZWxkYm94XG4gICAgICAgICAgICB0aGlzLnNldEltcG9ydGVkVGFnKGlucHV0KTtcbiAgICAgICAgICB9IGVsc2UgaWYgKG5hbWUgPT09ICdwcml2aWxlZ2VzJykge1xuICAgICAgICAgICAgZG9uZSA9IHRoaXMuaW1wb3J0UHJpdmlsZWdlcyh0aGlzLmltcG9ydHNbbmFtZV0sIGZhbHNlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gICAgaWYgKGRvbmUgPT09IHRydWUgJiYgY2xvc2UgPT0gdHJ1ZSkgdGhpcy5kaXNtaXNzKCk7XG4gIH1cblxuICBzZXRJbXBvcnRlZFRhZyhpbnB1dCwgc2VsZWN0b3IgPSAnLmZvcm0tYm94Jykge1xuICAgIGxldCBlbCA9IChzZWxlY3RvciA9PT0gbnVsbCkgPyBpbnB1dCA6IChpbnB1dC5jbG9zZXN0KHNlbGVjdG9yKSA/IGlucHV0LmNsb3Nlc3Qoc2VsZWN0b3IpIDogaW5wdXQuY2xvc2VzdCgnZmllbGRzZXQnKSk7XG4gICAgaWYgKCFlbCkgcmV0dXJuO1xuICAgIGVsLmRhdGFzZXQuaXNpbXBvcnRlZCA9IHRoaXMuZm9ybS5kYXRhc2V0LmlzaW1wb3J0ZWQ7XG4gICAgZWwuY2xhc3NMaXN0LmFkZCgnaW1wb3J0ZWQnKTtcbiAgICBjb25zdCByZW1vdmV0YWcgPSAoZSkgPT4ge1xuICAgICAgZWwucmVtb3ZlQXR0cmlidXRlKCdkYXRhLWlzaW1wb3J0ZWQnKTtcbiAgICAgIGVsLmNsYXNzTGlzdC5yZW1vdmUoJ2ltcG9ydGVkJyk7XG4gICAgICBpbnB1dC5yZW1vdmVFdmVudExpc3RlbmVyKCdjaGFuZ2Uga2V5ZG93bicsIHJlbW92ZXRhZyk7XG4gICAgfVxuICAgIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZSBrZXlkb3duJywgcmVtb3ZldGFnKTtcbiAgfVxuXG4gIGRpc21pc3MoY2xlYXIgPSBmYWxzZSkge1xuICAgIGlmICh0aGlzLmJ1dHRvbikgdGhpcy5zaG93SW1wb3J0KGZhbHNlKTtcbiAgICBjb25zdCBjb250YWluZXIgPSB0aGlzLmRvbS5jbG9zZXN0KCdkZXRhaWxzJyk7XG4gICAgaWYgKGNvbnRhaW5lcikge1xuICAgICAgY29udGFpbmVyLm9wZW4gPSBmYWxzZTtcbiAgICAgIGlmIChjbGVhciA9PT0gdHJ1ZSkgY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IodGhpcy5jb250ZW50X3NlbGVjdG9yKS5pbm5lckhUTUwgPSBgYDtcbiAgICB9XG5cbiAgfVxuICBpbmRleFRvQ2hlY2soKSB7XG4gICAgLy8gaW5kZXggb2YgY2VsbHMgdG8gY2hlY2sgaWYgZW1wdHkgYW5kIGRpc2FibGUgcm93ICBpbXBvcnQgYnRuXG4gICAgY29uc3QgZ3JpZCA9ICh0aGlzLnRibCkgPyB0aGlzLnRibC5ncmlkIDogbnVsbDtcbiAgICBpZiAoIWdyaWQpIHJldHVybiBbMF07XG4gICAgbGV0IGluZGV4ID0gZ3JpZC5jb2x1bW5zLmZpbmRJbmRleChjb2x1bW4gPT4gKGNvbHVtbi53aGF0ICYmIGNvbHVtbi53aGF0ID09PSB0eXBlaW1wb3J0LnRheG8pKTtcbiAgICBpZiAoaW5kZXggPT09IC0xKSByZXR1cm4gWzBdO1xuICAgIGNvbnN0IHBhcnRzID0gKGdyaWQuY29sdW1uc1tpbmRleF0ucGFydHMpID8gZ3JpZC5jb2x1bW5zW2luZGV4XS5wYXJ0cyA6IG51bGw7XG4gICAgaWYgKHBhcnRzKSB7XG4gICAgICBjb25zdCBpbmRleHRvY2hlY2sgPSBncmlkLmNvbHVtbnMuZmlsdGVyKChjb2x1bW4sIGkpID0+IHtcbiAgICAgICAgaWYgKHBhcnRzLmluZGV4T2YoY29sdW1uLm5hbWUpID49IDApIHJldHVybiBpO1xuICAgICAgfSkubWFwKHYgPT4ge1xuICAgICAgICByZXR1cm4gdi5pbmRleDtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGluZGV4dG9jaGVjaztcbiAgICB9XG5cbiAgfVxuICAvLyBzaG93IC8gaGlkZSBpbXBvcnR6b25lIGFuZCBidXR0b25zXG4gIHNob3dJbXBvcnQoc2hvdykge1xuICAgIGlmICghdGhpcy5idXR0b24pIHJldHVybjtcblxuICAgIGlmIChzaG93ID09PSBmYWxzZSkge1xuICAgICAgdGhpcy5idXR0b24uY2xhc3NMaXN0LmFkZChjc3MuaGlkZSk7XG4gICAgICB0aGlzLnJlcGxhY2VidXR0b24uY2xhc3NMaXN0LmFkZChjc3MuaGlkZSk7XG4gICAgICB0aGlzLmltcG9ydGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKGNzcy5oaWRlKTtcbiAgICAgIHRoaXMudGFiYnV0dG9uLmNsYXNzTGlzdC5hZGQoY3NzLmhpZGUpO1xuXG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuYnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoY3NzLmhpZGUpO1xuICAgICAgdGhpcy5yZXBsYWNlYnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoY3NzLmhpZGUpO1xuXG4gICAgICB0aGlzLmltcG9ydGNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKGNzcy5oaWRlKTtcbiAgICAgIHRoaXMuYnV0dG9uLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICBjb25zdCBpbXBvcnR6b25lID0gdGhpcy5pbXBvcnRjb250YWluZXIucXVlcnlTZWxlY3RvcignIycgKyB0aGlzLmltcG9ydGlkKTtcbiAgICAgIGlmIChpbXBvcnR6b25lKSB7XG4gICAgICAgIHRoaXMudGFiYnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoY3NzLmhpZGUpO1xuICAgICAgICBpZiAoaW1wb3J0em9uZS50b21zZWxlY3QgJiYgaW1wb3J0em9uZS50b21zZWxlY3QuY29udHJvbC5vZmZzZXRIZWlnaHQgPCBpbXBvcnR6b25lLnRvbXNlbGVjdC5jb250cm9sLnNjcm9sbEhlaWdodCkge1xuICAgICAgICAgIHRoaXMudGFiYnV0dG9uLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgIH0gZWxzZSB0aGlzLnRhYmJ1dHRvbi5kaXNhYmxlZCA9IHRydWU7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIC8vIHJlc2l6ZSBpbXBvcnR6b25lXG4gIHJlc2l6ZVpvbmUoZSkge1xuICAgIGNvbnN0IGRpdiA9IHRoaXMuaW1wb3J0Y29udGFpbmVyLmNsb3Nlc3QoZG9tc2VsZWN0b3JzLmNvbXBvbmVudC5pbXBvcnQuem9uZWltcG9ydCk7XG4gICAgaWYgKCFkaXYpIHJldHVybjtcbiAgICBkaXYucGFyZW50RWxlbWVudC5jbGFzc0xpc3QudG9nZ2xlKGNzcy5zaG93ZnVsbCk7XG4gICAgY29uc3QgaWNvbiA9IGUuY3VycmVudFRhcmdldC5xdWVyeVNlbGVjdG9yKCdpJyk7XG4gICAgaWYgKGljb24pIHtcbiAgICAgIGljb24uY2xhc3NMaXN0LnRvZ2dsZSgnaWNvbi1hcnJvdy1wb2ludGluZy1vdXQnKTtcbiAgICAgIGljb24uY2xhc3NMaXN0LnRvZ2dsZSgnaWNvbi1hcnJvdy1wb2ludGluZy1pbicpO1xuICAgIH1cbiAgfVxufSJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/modules/data-import.js\n")}}]);