/*! For license information please see src_modules_job-monitor_js.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["src_modules_job-monitor_js"],{"./src/modules/job-monitor.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{eval('__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   jobMonitor: () => (/* binding */ jobMonitor)\n/* harmony export */ });\n/* harmony import */ var _modules_utils_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../modules/utils.js */ "./src/modules/utils.js");\n\n\nfunction jobMonitor(item) {\n  let intervalHandle;\n  const jobid = item.dataset.id;\n  if (!jobid) return;\n  const spinner = item.querySelector(\'#spinner-icon\');\n  const statusdiv = item.querySelector("#statusdiv");\n  let stop = false;\n  const progress_bar = (show, percent = 0, description = ``) => {\n    if (!percent) percent = 0;\n    if (!description) description = "In progress";\n    const progressbar = item.querySelector(\'#progressbar\');\n    if (show === false) {\n      if (spinner) spinner.remove();\n    } else {\n      if (spinner) spinner.classList.remove(\'hidden\');\n      if (progressbar) progressbar.classList.remove(\'hidden\');\n\n\n    }\n\n  }\n  const display_errors = (errors) => {\n    statusdiv.firstChild.innerHTML = `<div class="alert alert-danger">${errors.join(`</div><div>`)}</div>`;\n  }\n  const display_next = async (url) => {\n    fetch(url, (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.fetchSettings)()).then(response => response.text()).then(response => {\n      statusdiv.lastChild.insertAdjacentHTML(\'beforeend\', response);\n    });\n\n  }\n  let html = [];\n  const check_job_status = () => {\n    fetch("/gui/job/status/" + jobid, _modules_utils_js__WEBPACK_IMPORTED_MODULE_0__.fetchSettings).then(response => response.json()).then(job => {\n\n      if (job.errors.length) {\n        clearInterval(intervalHandle);\n        progress_bar(false);\n        display_errors(job.errors);\n      }\n      if (stop === true) return;\n\n      if (job) {\n        switch (job.state) {\n          case "A":\n            // question\n            stop = true;\n            display_next("/gui/job/question/" + job.id);\n            progress_bar(false);\n            clearInterval(intervalHandle);\n            break;\n          case "F":\n            stop = true;\n            progress_bar(false);\n            if (spinner) spinner.remove();\n            clearInterval(intervalHandle);\n            if (job.finalaction) html.push(job.finalaction);\n            if (job.description) statusdiv.firstChild.innerHTML = job.description;\n            //  display_next("/gui/job/show/"+job.id+\'?monitor=true\');\n            break;\n          case "E":\n            stop = true;\n            progress_bar(false);\n            spinner.remove();\n            clearInterval(intervalHandle);\n            display_errors(job.errors);\n            break;\n          case "P":\n            // pending\n            break;\n        }\n        progress_bar(true, job.progress_pct, job.progress_msg);\n      }\n      if (statusdiv) statusdiv.childNodes[1].innerHTML = html.join(\'\');\n      if (job.state && job.state == "E" || (job.state == \'F\' && !job.out)) return;\n      if (stop === false) setTimeout(check_job_status, 1000);\n    });\n  }\n  check_job_status();\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvbW9kdWxlcy9qb2ItbW9uaXRvci5qcy5qcyIsIm1hcHBpbmdzIjoiOzs7OztBQUU2Qjs7QUFFdEI7QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTs7O0FBR0E7O0FBRUE7QUFDQTtBQUNBLHdFQUF3RSwyQkFBMkI7QUFDbkc7QUFDQTtBQUNBLGVBQWUsZ0VBQWE7QUFDNUI7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBLHNDQUFzQyw0REFBYTs7QUFFbkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9tb2R1bGVzL2pvYi1tb25pdG9yLmpzPzIwNTEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgZmV0Y2hTZXR0aW5ncyxcbn0gZnJvbSAnLi4vbW9kdWxlcy91dGlscy5qcyc7XG5cbmV4cG9ydCBmdW5jdGlvbiBqb2JNb25pdG9yKGl0ZW0pIHtcbiAgbGV0IGludGVydmFsSGFuZGxlO1xuICBjb25zdCBqb2JpZCA9IGl0ZW0uZGF0YXNldC5pZDtcbiAgaWYgKCFqb2JpZCkgcmV0dXJuO1xuICBjb25zdCBzcGlubmVyID0gaXRlbS5xdWVyeVNlbGVjdG9yKCcjc3Bpbm5lci1pY29uJyk7XG4gIGNvbnN0IHN0YXR1c2RpdiA9IGl0ZW0ucXVlcnlTZWxlY3RvcihcIiNzdGF0dXNkaXZcIik7XG4gIGxldCBzdG9wID0gZmFsc2U7XG4gIGNvbnN0IHByb2dyZXNzX2JhciA9IChzaG93LCBwZXJjZW50ID0gMCwgZGVzY3JpcHRpb24gPSBgYCkgPT4ge1xuICAgIGlmICghcGVyY2VudCkgcGVyY2VudCA9IDA7XG4gICAgaWYgKCFkZXNjcmlwdGlvbikgZGVzY3JpcHRpb24gPSBcIkluIHByb2dyZXNzXCI7XG4gICAgY29uc3QgcHJvZ3Jlc3NiYXIgPSBpdGVtLnF1ZXJ5U2VsZWN0b3IoJyNwcm9ncmVzc2JhcicpO1xuICAgIGlmIChzaG93ID09PSBmYWxzZSkge1xuICAgICAgaWYgKHNwaW5uZXIpIHNwaW5uZXIucmVtb3ZlKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChzcGlubmVyKSBzcGlubmVyLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpO1xuICAgICAgaWYgKHByb2dyZXNzYmFyKSBwcm9ncmVzc2Jhci5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTtcblxuXG4gICAgfVxuXG4gIH1cbiAgY29uc3QgZGlzcGxheV9lcnJvcnMgPSAoZXJyb3JzKSA9PiB7XG4gICAgc3RhdHVzZGl2LmZpcnN0Q2hpbGQuaW5uZXJIVE1MID0gYDxkaXYgY2xhc3M9XCJhbGVydCBhbGVydC1kYW5nZXJcIj4ke2Vycm9ycy5qb2luKGA8L2Rpdj48ZGl2PmApfTwvZGl2PmA7XG4gIH1cbiAgY29uc3QgZGlzcGxheV9uZXh0ID0gYXN5bmMgKHVybCkgPT4ge1xuICAgIGZldGNoKHVybCwgZmV0Y2hTZXR0aW5ncygpKS50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLnRleHQoKSkudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICBzdGF0dXNkaXYubGFzdENoaWxkLmluc2VydEFkamFjZW50SFRNTCgnYmVmb3JlZW5kJywgcmVzcG9uc2UpO1xuICAgIH0pO1xuXG4gIH1cbiAgbGV0IGh0bWwgPSBbXTtcbiAgY29uc3QgY2hlY2tfam9iX3N0YXR1cyA9ICgpID0+IHtcbiAgICBmZXRjaChcIi9ndWkvam9iL3N0YXR1cy9cIiArIGpvYmlkLCBmZXRjaFNldHRpbmdzKS50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLmpzb24oKSkudGhlbihqb2IgPT4ge1xuXG4gICAgICBpZiAoam9iLmVycm9ycy5sZW5ndGgpIHtcbiAgICAgICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbEhhbmRsZSk7XG4gICAgICAgIHByb2dyZXNzX2JhcihmYWxzZSk7XG4gICAgICAgIGRpc3BsYXlfZXJyb3JzKGpvYi5lcnJvcnMpO1xuICAgICAgfVxuICAgICAgaWYgKHN0b3AgPT09IHRydWUpIHJldHVybjtcblxuICAgICAgaWYgKGpvYikge1xuICAgICAgICBzd2l0Y2ggKGpvYi5zdGF0ZSkge1xuICAgICAgICAgIGNhc2UgXCJBXCI6XG4gICAgICAgICAgICAvLyBxdWVzdGlvblxuICAgICAgICAgICAgc3RvcCA9IHRydWU7XG4gICAgICAgICAgICBkaXNwbGF5X25leHQoXCIvZ3VpL2pvYi9xdWVzdGlvbi9cIiArIGpvYi5pZCk7XG4gICAgICAgICAgICBwcm9ncmVzc19iYXIoZmFsc2UpO1xuICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbEhhbmRsZSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIFwiRlwiOlxuICAgICAgICAgICAgc3RvcCA9IHRydWU7XG4gICAgICAgICAgICBwcm9ncmVzc19iYXIoZmFsc2UpO1xuICAgICAgICAgICAgaWYgKHNwaW5uZXIpIHNwaW5uZXIucmVtb3ZlKCk7XG4gICAgICAgICAgICBjbGVhckludGVydmFsKGludGVydmFsSGFuZGxlKTtcbiAgICAgICAgICAgIGlmIChqb2IuZmluYWxhY3Rpb24pIGh0bWwucHVzaChqb2IuZmluYWxhY3Rpb24pO1xuICAgICAgICAgICAgaWYgKGpvYi5kZXNjcmlwdGlvbikgc3RhdHVzZGl2LmZpcnN0Q2hpbGQuaW5uZXJIVE1MID0gam9iLmRlc2NyaXB0aW9uO1xuICAgICAgICAgICAgLy8gIGRpc3BsYXlfbmV4dChcIi9ndWkvam9iL3Nob3cvXCIram9iLmlkKyc/bW9uaXRvcj10cnVlJyk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIFwiRVwiOlxuICAgICAgICAgICAgc3RvcCA9IHRydWU7XG4gICAgICAgICAgICBwcm9ncmVzc19iYXIoZmFsc2UpO1xuICAgICAgICAgICAgc3Bpbm5lci5yZW1vdmUoKTtcbiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWxIYW5kbGUpO1xuICAgICAgICAgICAgZGlzcGxheV9lcnJvcnMoam9iLmVycm9ycyk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIFwiUFwiOlxuICAgICAgICAgICAgLy8gcGVuZGluZ1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgcHJvZ3Jlc3NfYmFyKHRydWUsIGpvYi5wcm9ncmVzc19wY3QsIGpvYi5wcm9ncmVzc19tc2cpO1xuICAgICAgfVxuICAgICAgaWYgKHN0YXR1c2Rpdikgc3RhdHVzZGl2LmNoaWxkTm9kZXNbMV0uaW5uZXJIVE1MID0gaHRtbC5qb2luKCcnKTtcbiAgICAgIGlmIChqb2Iuc3RhdGUgJiYgam9iLnN0YXRlID09IFwiRVwiIHx8IChqb2Iuc3RhdGUgPT0gJ0YnICYmICFqb2Iub3V0KSkgcmV0dXJuO1xuICAgICAgaWYgKHN0b3AgPT09IGZhbHNlKSBzZXRUaW1lb3V0KGNoZWNrX2pvYl9zdGF0dXMsIDEwMDApO1xuICAgIH0pO1xuICB9XG4gIGNoZWNrX2pvYl9zdGF0dXMoKTtcbn0iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/modules/job-monitor.js\n')}}]);