(()=>{var e,t={655:()=>{},583:()=>{},379:e=>{"use strict";var t=[];function s(e){for(var s=-1,i=0;i<t.length;i++)if(t[i].identifier===e){s=i;break}return s}function i(e,i){for(var a={},r=[],o=0;o<e.length;o++){var l=e[o],d=i.base?l[0]+i.base:l[0],c=a[d]||0,h="".concat(d," ").concat(c);a[d]=c+1;var p=s(h),u={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==p)t[p].references++,t[p].updater(u);else{var g=n(u,i);i.byIndex=o,t.splice(o,0,{identifier:h,updater:g,references:1})}r.push(h)}return r}function n(e,t){var s=t.domAPI(t);s.update(e);return function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;s.update(e=t)}else s.remove()}}e.exports=function(e,n){var a=i(e=e||[],n=n||{});return function(e){e=e||[];for(var r=0;r<a.length;r++){var o=s(a[r]);t[o].references--}for(var l=i(e,n),d=0;d<a.length;d++){var c=s(a[d]);0===t[c].references&&(t[c].updater(),t.splice(c,1))}a=l}}},569:e=>{"use strict";var t={};e.exports=function(e,s){var i=function(e){if(void 0===t[e]){var s=document.querySelector(e);if(window.HTMLIFrameElement&&s instanceof window.HTMLIFrameElement)try{s=s.contentDocument.head}catch(e){s=null}t[e]=s}return t[e]}(e);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(s)}},216:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},565:(e,t,s)=>{"use strict";e.exports=function(e){var t=s.nc;t&&e.setAttribute("nonce",t)}},795:e=>{"use strict";e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(s){!function(e,t,s){var i="";s.supports&&(i+="@supports (".concat(s.supports,") {")),s.media&&(i+="@media ".concat(s.media," {"));var n=void 0!==s.layer;n&&(i+="@layer".concat(s.layer.length>0?" ".concat(s.layer):""," {")),i+=s.css,n&&(i+="}"),s.media&&(i+="}"),s.supports&&(i+="}");var a=s.sourceMap;a&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),t.styleTagTransform(i,e,t.options)}(t,e,s)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},589:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},261:function(e){e.exports=function(){"use strict";function e(e,t){e.split(/\s+/).forEach((e=>{t(e)}))}class t{constructor(){this._events=void 0,this._events={}}on(t,s){e(t,(e=>{this._events[e]=this._events[e]||[],this._events[e].push(s)}))}off(t,s){var i=arguments.length;0!==i?e(t,(e=>{if(1===i)return delete this._events[e];e in this._events!=0&&this._events[e].splice(this._events[e].indexOf(s),1)})):this._events={}}trigger(t,...s){var i=this;e(t,(e=>{if(e in i._events!=0)for(let t of i._events[e])t.apply(i,s)}))}}function s(e){return e.plugins={},class extends e{constructor(...e){super(...e),this.plugins={names:[],settings:{},requested:{},loaded:{}}}static define(t,s){e.plugins[t]={name:t,fn:s}}initializePlugins(e){var t,s;const i=this,n=[];if(Array.isArray(e))e.forEach((e=>{"string"==typeof e?n.push(e):(i.plugins.settings[e.name]=e.options,n.push(e.name))}));else if(e)for(t in e)e.hasOwnProperty(t)&&(i.plugins.settings[t]=e[t],n.push(t));for(;s=n.shift();)i.require(s)}loadPlugin(t){var s=this,i=s.plugins,n=e.plugins[t];if(!e.plugins.hasOwnProperty(t))throw new Error('Unable to find "'+t+'" plugin');i.requested[t]=!0,i.loaded[t]=n.fn.apply(s,[s.plugins.settings[t]||{}]),i.names.push(t)}require(e){var t=this,s=t.plugins;if(!t.plugins.loaded.hasOwnProperty(e)){if(s.requested[e])throw new Error('Plugin has circular dependency ("'+e+'")');t.loadPlugin(e)}return s.loaded[e]}}}var i;const n="[̀-ͯ·ʾ]",a=new RegExp(n,"g");var r;const o={æ:"ae",ⱥ:"a",ø:"o"},l=new RegExp(Object.keys(o).join("|"),"g"),d=[[67,67],[160,160],[192,438],[452,652],[961,961],[1019,1019],[1083,1083],[1281,1289],[1984,1984],[5095,5095],[7429,7441],[7545,7549],[7680,7935],[8580,8580],[9398,9449],[11360,11391],[42792,42793],[42802,42851],[42873,42897],[42912,42922],[64256,64260],[65313,65338],[65345,65370]],c=e=>e.normalize("NFKD").replace(a,"").toLowerCase().replace(l,(function(e){return o[e]})),h=(e,t="|")=>{if(1==e.length)return e[0];var s=1;return e.forEach((e=>{s=Math.max(s,e.length)})),1==s?"["+e.join("")+"]":"(?:"+e.join(t)+")"},p=e=>{if(1===e.length)return[[e]];var t=[];return p(e.substring(1)).forEach((function(s){var i=s.slice(0);i[0]=e.charAt(0)+i[0],t.push(i),(i=s.slice(0)).unshift(e.charAt(0)),t.push(i)})),t},u=()=>{var e={};d.forEach((t=>{for(let i=t[0];i<=t[1];i++){let t=String.fromCharCode(i),n=c(t);if(n!=t.toLowerCase()){n in e||(e[n]=[n]);var s=new RegExp(h(e[n]),"iu");t.match(s)||e[n].push(t)}}}));var t=Object.keys(e);t=t.sort(((e,t)=>t.length-e.length)),i=new RegExp("("+h(t)+n+"*)","g");var s={};return t.sort(((e,t)=>e.length-t.length)).forEach((t=>{var i=p(t).map((t=>(t=t.map((t=>e.hasOwnProperty(t)?h(e[t]):t)),h(t,""))));s[t]=h(i)})),s},g=e=>(void 0===r&&(r=u()),e.normalize("NFKD").toLowerCase().split(i).map((e=>{if(""==e)return"";const t=c(e);if(r.hasOwnProperty(t))return r[t];const s=e.normalize("NFC");return s!=e?h([e,s]):e})).join("")),m=(e,t)=>{if(e)return e[t]},f=(e,t)=>{if(e){for(var s,i=t.split(".");(s=i.shift())&&(e=e[s]););return e}},v=(e,t,s)=>{var i,n;return e?-1===(n=(e+="").search(t.regex))?0:(i=t.string.length/e.length,0===n&&(i+=.5),i*s):0},b=e=>(e+"").replace(/([\$\(-\+\.\?\[-\^\{-\}])/g,"\\$1"),y=(e,t)=>{var s=e[t];if("function"==typeof s)return s;s&&!Array.isArray(s)&&(e[t]=[s])},w=(e,t)=>{if(Array.isArray(e))e.forEach(t);else for(var s in e)e.hasOwnProperty(s)&&t(e[s],s)},S=(e,t)=>"number"==typeof e&&"number"==typeof t?e>t?1:e<t?-1:0:(e=c(e+"").toLowerCase())>(t=c(t+"").toLowerCase())?1:t>e?-1:0;class x{constructor(e,t){this.items=void 0,this.settings=void 0,this.items=e,this.settings=t||{diacritics:!0}}tokenize(e,t,s){if(!e||!e.length)return[];const i=[],n=e.split(/\s+/);var a;return s&&(a=new RegExp("^("+Object.keys(s).map(b).join("|")+"):(.*)$")),n.forEach((e=>{let s,n=null,r=null;a&&(s=e.match(a))&&(n=s[1],e=s[2]),e.length>0&&(r=b(e),this.settings.diacritics&&(r=g(r)),t&&(r="\\b"+r)),i.push({string:e,regex:r?new RegExp(r,"iu"):null,field:n})})),i}getScoreFunction(e,t){var s=this.prepareSearch(e,t);return this._getScoreFunction(s)}_getScoreFunction(e){const t=e.tokens,s=t.length;if(!s)return function(){return 0};const i=e.options.fields,n=e.weights,a=i.length,r=e.getAttrFn;if(!a)return function(){return 1};const o=1===a?function(e,t){const s=i[0].field;return v(r(t,s),e,n[s])}:function(e,t){var s=0;if(e.field){const i=r(t,e.field);!e.regex&&i?s+=1/a:s+=v(i,e,1)}else w(n,((i,n)=>{s+=v(r(t,n),e,i)}));return s/a};return 1===s?function(e){return o(t[0],e)}:"and"===e.options.conjunction?function(e){for(var i,n=0,a=0;n<s;n++){if((i=o(t[n],e))<=0)return 0;a+=i}return a/s}:function(e){var i=0;return w(t,(t=>{i+=o(t,e)})),i/s}}getSortFunction(e,t){var s=this.prepareSearch(e,t);return this._getSortFunction(s)}_getSortFunction(e){var t,s,i;const n=this,a=e.options,r=!e.query&&a.sort_empty?a.sort_empty:a.sort,o=[],l=[];if("function"==typeof r)return r.bind(this);const d=function(t,s){return"$score"===t?s.score:e.getAttrFn(n.items[s.id],t)};if(r)for(t=0,s=r.length;t<s;t++)(e.query||"$score"!==r[t].field)&&o.push(r[t]);if(e.query){for(i=!0,t=0,s=o.length;t<s;t++)if("$score"===o[t].field){i=!1;break}i&&o.unshift({field:"$score",direction:"desc"})}else for(t=0,s=o.length;t<s;t++)if("$score"===o[t].field){o.splice(t,1);break}for(t=0,s=o.length;t<s;t++)l.push("desc"===o[t].direction?-1:1);const c=o.length;if(c){if(1===c){const e=o[0].field,t=l[0];return function(s,i){return t*S(d(e,s),d(e,i))}}return function(e,t){var s,i,n;for(s=0;s<c;s++)if(n=o[s].field,i=l[s]*S(d(n,e),d(n,t)))return i;return 0}}return null}prepareSearch(e,t){const s={};var i=Object.assign({},t);if(y(i,"sort"),y(i,"sort_empty"),i.fields){y(i,"fields");const e=[];i.fields.forEach((t=>{"string"==typeof t&&(t={field:t,weight:1}),e.push(t),s[t.field]="weight"in t?t.weight:1})),i.fields=e}return{options:i,query:e.toLowerCase().trim(),tokens:this.tokenize(e,i.respect_word_boundaries,s),total:0,items:[],weights:s,getAttrFn:i.nesting?f:m}}search(e,t){var s,i,n=this;i=this.prepareSearch(e,t),t=i.options,e=i.query;const a=t.score||n._getScoreFunction(i);e.length?w(n.items,((e,n)=>{s=a(e),(!1===t.filter||s>0)&&i.items.push({score:s,id:n})})):w(n.items,((e,t)=>{i.items.push({score:1,id:t})}));const r=n._getSortFunction(i);return r&&i.items.sort(r),i.total=i.items.length,"number"==typeof t.limit&&(i.items=i.items.slice(0,t.limit)),i}}const L=e=>{if(e.jquery)return e[0];if(e instanceof HTMLElement)return e;if(C(e)){let t=document.createElement("div");return t.innerHTML=e.trim(),t.firstChild}return document.querySelector(e)},C=e=>"string"==typeof e&&e.indexOf("<")>-1,E=e=>e.replace(/['"\\]/g,"\\$&"),A=(e,t)=>{var s=document.createEvent("HTMLEvents");s.initEvent(t,!0,!1),e.dispatchEvent(s)},O=(e,t)=>{Object.assign(e.style,t)},I=(e,...t)=>{var s=k(t);(e=q(e)).map((e=>{s.map((t=>{e.classList.add(t)}))}))},T=(e,...t)=>{var s=k(t);(e=q(e)).map((e=>{s.map((t=>{e.classList.remove(t)}))}))},k=e=>{var t=[];return w(e,(e=>{"string"==typeof e&&(e=e.trim().split(/[\11\12\14\15\40]/)),Array.isArray(e)&&(t=t.concat(e))})),t.filter(Boolean)},q=e=>(Array.isArray(e)||(e=[e]),e),P=(e,t,s)=>{if(!s||s.contains(e))for(;e&&e.matches;){if(e.matches(t))return e;e=e.parentNode}},_=(e,t=0)=>t>0?e[e.length-1]:e[0],F=e=>0===Object.keys(e).length,H=(e,t)=>{if(!e)return-1;t=t||e.nodeName;for(var s=0;e=e.previousElementSibling;)e.matches(t)&&s++;return s},j=(e,t)=>{w(t,((t,s)=>{null==t?e.removeAttribute(s):e.setAttribute(s,""+t)}))},M=(e,t)=>{e.parentNode&&e.parentNode.replaceChild(t,e)},R=(e,t)=>{if(null===t)return;if("string"==typeof t){if(!t.length)return;t=new RegExp(t,"i")}const s=e=>{var s=e.data.match(t);if(s&&e.data.length>0){var i=document.createElement("span");i.className="highlight";var n=e.splitText(s.index);n.splitText(s[0].length);var a=n.cloneNode(!0);return i.appendChild(a),M(n,i),1}return 0},i=e=>{if(1===e.nodeType&&e.childNodes&&!/(script|style)/i.test(e.tagName)&&("highlight"!==e.className||"SPAN"!==e.tagName))for(var t=0;t<e.childNodes.length;++t)t+=n(e.childNodes[t])},n=e=>3===e.nodeType?s(e):(i(e),0);n(e)},D=e=>{var t=e.querySelectorAll("span.highlight");Array.prototype.forEach.call(t,(function(e){var t=e.parentNode;t.replaceChild(e.firstChild,e),t.normalize()}))},N=65,$=13,V=27,z=37,B=38,K=39,Q=40,U=8,Y=46,W=9,G="undefined"!=typeof navigator&&/Mac/.test(navigator.userAgent)?"metaKey":"ctrlKey";var J={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:null,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,shouldOpen:null,maxOptions:50,maxItems:null,hideSelected:null,duplicates:!1,addPrecedence:!1,selectOnTab:!1,preload:null,allowEmptyOption:!1,loadThrottle:300,loadingClass:"loading",dataAttr:null,optgroupField:"optgroup",valueField:"value",labelField:"text",disabledField:"disabled",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"ts-wrapper",controlClass:"ts-control",dropdownClass:"ts-dropdown",dropdownContentClass:"ts-dropdown-content",itemClass:"item",optionClass:"option",dropdownParent:null,controlInput:'<input type="text" autocomplete="off" size="1" />',copyClassesToDropdown:!1,placeholder:null,hidePlaceholder:null,shouldLoad:function(e){return e.length>0},render:{}};const X=e=>null==e?null:Z(e),Z=e=>"boolean"==typeof e?e?"1":"0":e+"",ee=e=>(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),te=(e,t)=>{var s;return function(i,n){var a=this;s&&(a.loading=Math.max(a.loading-1,0),clearTimeout(s)),s=setTimeout((function(){s=null,a.loadedSearches[i]=!0,e.call(a,i,n)}),t)}},se=(e,t,s)=>{var i,n=e.trigger,a={};for(i of(e.trigger=function(){var s=arguments[0];if(-1===t.indexOf(s))return n.apply(e,arguments);a[s]=arguments},s.apply(e,[]),e.trigger=n,t))i in a&&n.apply(e,a[i])},ie=e=>({start:e.selectionStart||0,length:(e.selectionEnd||0)-(e.selectionStart||0)}),ne=(e,t=!1)=>{e&&(e.preventDefault(),t&&e.stopPropagation())},ae=(e,t,s,i)=>{e.addEventListener(t,s,i)},re=(e,t)=>!!t&&!!t[e]&&1==(t.altKey?1:0)+(t.ctrlKey?1:0)+(t.shiftKey?1:0)+(t.metaKey?1:0),oe=(e,t)=>{const s=e.getAttribute("id");return s||(e.setAttribute("id",t),t)},le=e=>e.replace(/[\\"']/g,"\\$&"),de=(e,t)=>{t&&e.append(t)};function ce(e,t){var s=Object.assign({},J,t),i=s.dataAttr,n=s.labelField,a=s.valueField,r=s.disabledField,o=s.optgroupField,l=s.optgroupLabelField,d=s.optgroupValueField,c=e.tagName.toLowerCase(),h=e.getAttribute("placeholder")||e.getAttribute("data-placeholder");if(!h&&!s.allowEmptyOption){let t=e.querySelector('option[value=""]');t&&(h=t.textContent)}var p,u,g,m,f,v,b,y={placeholder:h,options:[],optgroups:[],items:[],maxItems:null},S=()=>{const t=e.getAttribute(i);if(t)y.options=JSON.parse(t),w(y.options,(e=>{y.items.push(e[a])}));else{var r=e.value.trim()||"";if(!s.allowEmptyOption&&!r.length)return;const t=r.split(s.delimiter);w(t,(e=>{const t={};t[n]=e,t[a]=e,y.options.push(t)})),y.items=t}};return"select"===c?(u=y.options,g={},m=1,f=e=>{var t=Object.assign({},e.dataset),s=i&&t[i];return"string"==typeof s&&s.length&&(t=Object.assign(t,JSON.parse(s))),t},v=(e,t)=>{var i=X(e.value);if(null!=i&&(i||s.allowEmptyOption)){if(g.hasOwnProperty(i)){if(t){var l=g[i][o];l?Array.isArray(l)?l.push(t):g[i][o]=[l,t]:g[i][o]=t}}else{var d=f(e);d[n]=d[n]||e.textContent,d[a]=d[a]||i,d[r]=d[r]||e.disabled,d[o]=d[o]||t,d.$option=e,g[i]=d,u.push(d)}e.selected&&y.items.push(i)}},b=e=>{var t,s;(s=f(e))[l]=s[l]||e.getAttribute("label")||"",s[d]=s[d]||m++,s[r]=s[r]||e.disabled,y.optgroups.push(s),t=s[d],w(e.children,(e=>{v(e,t)}))},y.maxItems=e.hasAttribute("multiple")?null:1,w(e.children,(e=>{"optgroup"===(p=e.tagName.toLowerCase())?b(e):"option"===p&&v(e)}))):S(),Object.assign({},J,y,t)}var he=0;class pe extends(s(t)){constructor(e,t){var s;super(),this.control_input=void 0,this.wrapper=void 0,this.dropdown=void 0,this.control=void 0,this.dropdown_content=void 0,this.focus_node=void 0,this.order=0,this.settings=void 0,this.input=void 0,this.tabIndex=void 0,this.is_select_tag=void 0,this.rtl=void 0,this.inputId=void 0,this._destroy=void 0,this.sifter=void 0,this.isOpen=!1,this.isDisabled=!1,this.isRequired=void 0,this.isInvalid=!1,this.isValid=!0,this.isLocked=!1,this.isFocused=!1,this.isInputHidden=!1,this.isSetup=!1,this.ignoreFocus=!1,this.hasOptions=!1,this.currentResults=void 0,this.lastValue="",this.caretPos=0,this.loading=0,this.loadedSearches={},this.activeOption=null,this.activeItems=[],this.optgroups={},this.options={},this.userOptions={},this.items=[],he++;var i=L(e);if(i.tomselect)throw new Error("Tom Select already initialized on this element");i.tomselect=this,s=(window.getComputedStyle&&window.getComputedStyle(i,null)).getPropertyValue("direction");const n=ce(i,t);this.settings=n,this.input=i,this.tabIndex=i.tabIndex||0,this.is_select_tag="select"===i.tagName.toLowerCase(),this.rtl=/rtl/i.test(s),this.inputId=oe(i,"tomselect-"+he),this.isRequired=i.required,this.sifter=new x(this.options,{diacritics:n.diacritics}),n.mode=n.mode||(1===n.maxItems?"single":"multi"),"boolean"!=typeof n.hideSelected&&(n.hideSelected="multi"===n.mode),"boolean"!=typeof n.hidePlaceholder&&(n.hidePlaceholder="multi"!==n.mode);var a=n.createFilter;"function"!=typeof a&&("string"==typeof a&&(a=new RegExp(a)),a instanceof RegExp?n.createFilter=e=>a.test(e):n.createFilter=()=>!0),this.initializePlugins(n.plugins),this.setupCallbacks(),this.setupTemplates();const r=L("<div>"),o=L("<div>"),l=this._render("dropdown"),d=L('<div role="listbox" tabindex="-1">'),c=this.input.getAttribute("class")||"",h=n.mode;var p;I(r,n.wrapperClass,c,h),I(o,n.controlClass),de(r,o),I(l,n.dropdownClass,h),n.copyClassesToDropdown&&I(l,c),I(d,n.dropdownContentClass),de(l,d),L(n.dropdownParent||r).appendChild(l),C(n.controlInput)?(p=L(n.controlInput),w(["autocorrect","autocapitalize","autocomplete"],(e=>{i.getAttribute(e)&&j(p,{[e]:i.getAttribute(e)})})),p.tabIndex=-1,o.appendChild(p),this.focus_node=p):n.controlInput?(p=L(n.controlInput),this.focus_node=p):(p=L("<input/>"),this.focus_node=o),this.wrapper=r,this.dropdown=l,this.dropdown_content=d,this.control=o,this.control_input=p,this.setup()}setup(){const e=this,t=e.settings,s=e.control_input,i=e.dropdown,n=e.dropdown_content,a=e.wrapper,r=e.control,o=e.input,l=e.focus_node,d={passive:!0},c=e.inputId+"-ts-dropdown";j(n,{id:c}),j(l,{role:"combobox","aria-haspopup":"listbox","aria-expanded":"false","aria-controls":c});const h=oe(l,e.inputId+"-ts-control"),p="label[for='"+E(e.inputId)+"']",u=document.querySelector(p),g=e.focus.bind(e);if(u){ae(u,"click",g),j(u,{for:h});const t=oe(u,e.inputId+"-ts-label");j(l,{"aria-labelledby":t}),j(n,{"aria-labelledby":t})}if(a.style.width=o.style.width,e.plugins.names.length){const t="plugin-"+e.plugins.names.join(" plugin-");I([a,i],t)}(null===t.maxItems||t.maxItems>1)&&e.is_select_tag&&j(o,{multiple:"multiple"}),e.settings.placeholder&&j(s,{placeholder:t.placeholder}),!e.settings.splitOn&&e.settings.delimiter&&(e.settings.splitOn=new RegExp("\\s*"+b(e.settings.delimiter)+"+\\s*")),t.load&&t.loadThrottle&&(t.load=te(t.load,t.loadThrottle)),e.control_input.type=o.type,ae(i,"click",(t=>{const s=P(t.target,"[data-selectable]");s&&(e.onOptionSelect(t,s),ne(t,!0))})),ae(r,"click",(t=>{var i=P(t.target,"[data-ts-item]",r);i&&e.onItemSelect(t,i)?ne(t,!0):""==s.value&&(e.onClick(),ne(t,!0))})),ae(l,"keydown",(t=>e.onKeyDown(t))),ae(s,"keypress",(t=>e.onKeyPress(t))),ae(s,"input",(t=>e.onInput(t))),ae(l,"resize",(()=>e.positionDropdown()),d),ae(l,"blur",(t=>e.onBlur(t))),ae(l,"focus",(t=>e.onFocus(t))),ae(l,"paste",(t=>e.onPaste(t)));const m=t=>{const n=t.composedPath()[0];if(!a.contains(n)&&!i.contains(n))return e.isFocused&&e.blur(),void e.inputState();n==s&&e.isOpen?t.stopPropagation():ne(t,!0)};var f=()=>{e.isOpen&&e.positionDropdown()};ae(document,"mousedown",m),ae(window,"scroll",f,d),ae(window,"resize",f,d),this._destroy=()=>{document.removeEventListener("mousedown",m),window.removeEventListener("sroll",f),window.removeEventListener("resize",f),u&&u.removeEventListener("click",g)},this.revertSettings={innerHTML:o.innerHTML,tabIndex:o.tabIndex},o.tabIndex=-1,o.insertAdjacentElement("afterend",e.wrapper),e.sync(!1),t.items=[],delete t.optgroups,delete t.options,ae(o,"invalid",(t=>{e.isValid&&(e.isValid=!1,e.isInvalid=!0,e.refreshState())})),e.updateOriginalInput(),e.refreshItems(),e.close(!1),e.inputState(),e.isSetup=!0,o.disabled?e.disable():e.enable(),e.on("change",this.onChange),I(o,"tomselected","ts-hidden-accessible"),e.trigger("initialize"),!0===t.preload&&e.preload()}setupOptions(e=[],t=[]){this.addOptions(e),w(t,(e=>{this.registerOptionGroup(e)}))}setupTemplates(){var e=this,t=e.settings.labelField,s=e.settings.optgroupLabelField,i={optgroup:e=>{let t=document.createElement("div");return t.className="optgroup",t.appendChild(e.options),t},optgroup_header:(e,t)=>'<div class="optgroup-header">'+t(e[s])+"</div>",option:(e,s)=>"<div>"+s(e[t])+"</div>",item:(e,s)=>"<div>"+s(e[t])+"</div>",option_create:(e,t)=>'<div class="create">Add <strong>'+t(e.input)+"</strong>&hellip;</div>",no_results:()=>'<div class="no-results">No results found</div>',loading:()=>'<div class="spinner"></div>',not_loading:()=>{},dropdown:()=>"<div></div>"};e.settings.render=Object.assign({},i,e.settings.render)}setupCallbacks(){var e,t,s={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",item_select:"onItemSelect",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(e in s)(t=this.settings[s[e]])&&this.on(e,t)}sync(e=!0){const t=this,s=e?ce(t.input,{delimiter:t.settings.delimiter}):t.settings;t.setupOptions(s.options,s.optgroups),t.setValue(s.items||[],!0),t.lastQuery=null}onClick(){var e=this;if(e.activeItems.length>0)return e.clearActiveItems(),void e.focus();e.isFocused&&e.isOpen?e.blur():e.focus()}onMouseDown(){}onChange(){A(this.input,"input"),A(this.input,"change")}onPaste(e){var t=this;t.isInputHidden||t.isLocked?ne(e):t.settings.splitOn&&setTimeout((()=>{var e=t.inputValue();if(e.match(t.settings.splitOn)){var s=e.trim().split(t.settings.splitOn);w(s,(e=>{t.createItem(e)}))}}),0)}onKeyPress(e){var t=this;if(!t.isLocked){var s=String.fromCharCode(e.keyCode||e.which);return t.settings.create&&"multi"===t.settings.mode&&s===t.settings.delimiter?(t.createItem(),void ne(e)):void 0}ne(e)}onKeyDown(e){var t=this;if(t.isLocked)e.keyCode!==W&&ne(e);else{switch(e.keyCode){case N:if(re(G,e)&&""==t.control_input.value)return ne(e),void t.selectAll();break;case V:return t.isOpen&&(ne(e,!0),t.close()),void t.clearActiveItems();case Q:if(!t.isOpen&&t.hasOptions)t.open();else if(t.activeOption){let e=t.getAdjacent(t.activeOption,1);e&&t.setActiveOption(e)}return void ne(e);case B:if(t.activeOption){let e=t.getAdjacent(t.activeOption,-1);e&&t.setActiveOption(e)}return void ne(e);case $:return void(t.canSelect(t.activeOption)?(t.onOptionSelect(e,t.activeOption),ne(e)):t.settings.create&&t.createItem()&&ne(e));case z:return void t.advanceSelection(-1,e);case K:return void t.advanceSelection(1,e);case W:return void(t.settings.selectOnTab&&(t.canSelect(t.activeOption)&&(t.onOptionSelect(e,t.activeOption),ne(e)),t.settings.create&&t.createItem()&&ne(e)));case U:case Y:return void t.deleteSelection(e)}t.isInputHidden&&!re(G,e)&&ne(e)}}onInput(e){var t=this;if(!t.isLocked){var s=t.inputValue();t.lastValue!==s&&(t.lastValue=s,t.settings.shouldLoad.call(t,s)&&t.load(s),t.refreshOptions(),t.trigger("type",s))}}onFocus(e){var t=this,s=t.isFocused;if(t.isDisabled)return t.blur(),void ne(e);t.ignoreFocus||(t.isFocused=!0,"focus"===t.settings.preload&&t.preload(),s||t.trigger("focus"),t.activeItems.length||(t.showInput(),t.refreshOptions(!!t.settings.openOnFocus)),t.refreshState())}onBlur(e){if(!1!==document.hasFocus()){var t=this;if(t.isFocused){t.isFocused=!1,t.ignoreFocus=!1;var s=()=>{t.close(),t.setActiveItem(),t.setCaret(t.items.length),t.trigger("blur")};t.settings.create&&t.settings.createOnBlur?t.createItem(null,!1,s):s()}}}onOptionSelect(e,t){var s,i=this;t.parentElement&&t.parentElement.matches("[data-disabled]")||(t.classList.contains("create")?i.createItem(null,!0,(()=>{i.settings.closeAfterSelect&&i.close()})):void 0!==(s=t.dataset.value)&&(i.lastQuery=null,i.addItem(s),i.settings.closeAfterSelect&&i.close(),!i.settings.hideSelected&&e.type&&/click/.test(e.type)&&i.setActiveOption(t)))}canSelect(e){return!!(this.isOpen&&e&&this.dropdown_content.contains(e))}onItemSelect(e,t){var s=this;return!s.isLocked&&"multi"===s.settings.mode&&(ne(e),s.setActiveItem(t,e),!0)}canLoad(e){return!!this.settings.load&&!this.loadedSearches.hasOwnProperty(e)}load(e){const t=this;if(!t.canLoad(e))return;I(t.wrapper,t.settings.loadingClass),t.loading++;const s=t.loadCallback.bind(t);t.settings.load.call(t,e,s)}loadCallback(e,t){const s=this;s.loading=Math.max(s.loading-1,0),s.lastQuery=null,s.clearActiveOption(),s.setupOptions(e,t),s.refreshOptions(s.isFocused&&!s.isInputHidden),s.loading||T(s.wrapper,s.settings.loadingClass),s.trigger("load",e,t)}preload(){var e=this.wrapper.classList;e.contains("preloaded")||(e.add("preloaded"),this.load(""))}setTextboxValue(e=""){var t=this.control_input;t.value!==e&&(t.value=e,A(t,"update"),this.lastValue=e)}getValue(){return this.is_select_tag&&this.input.hasAttribute("multiple")?this.items:this.items.join(this.settings.delimiter)}setValue(e,t){se(this,t?[]:["change"],(()=>{this.clear(t),this.addItems(e,t)}))}setMaxItems(e){0===e&&(e=null),this.settings.maxItems=e,this.refreshState()}setActiveItem(e,t){var s,i,n,a,r,o,l=this;if("single"!==l.settings.mode){if(!e)return l.clearActiveItems(),void(l.isFocused&&l.showInput());if("click"===(s=t&&t.type.toLowerCase())&&re("shiftKey",t)&&l.activeItems.length){for(o=l.getLastActive(),(n=Array.prototype.indexOf.call(l.control.children,o))>(a=Array.prototype.indexOf.call(l.control.children,e))&&(r=n,n=a,a=r),i=n;i<=a;i++)e=l.control.children[i],-1===l.activeItems.indexOf(e)&&l.setActiveItemClass(e);ne(t)}else"click"===s&&re(G,t)||"keydown"===s&&re("shiftKey",t)?e.classList.contains("active")?l.removeActiveItem(e):l.setActiveItemClass(e):(l.clearActiveItems(),l.setActiveItemClass(e));l.hideInput(),l.isFocused||l.focus()}}setActiveItemClass(e){const t=this,s=t.control.querySelector(".last-active");s&&T(s,"last-active"),I(e,"active last-active"),t.trigger("item_select",e),-1==t.activeItems.indexOf(e)&&t.activeItems.push(e)}removeActiveItem(e){var t=this.activeItems.indexOf(e);this.activeItems.splice(t,1),T(e,"active")}clearActiveItems(){T(this.activeItems,"active"),this.activeItems=[]}setActiveOption(e){e!==this.activeOption&&(this.clearActiveOption(),e&&(this.activeOption=e,j(this.focus_node,{"aria-activedescendant":e.getAttribute("id")}),j(e,{"aria-selected":"true"}),I(e,"active"),this.scrollToOption(e)))}scrollToOption(e,t){if(!e)return;const s=this.dropdown_content,i=s.clientHeight,n=s.scrollTop||0,a=e.offsetHeight,r=e.getBoundingClientRect().top-s.getBoundingClientRect().top+n;r+a>i+n?this.scroll(r-i+a,t):r<n&&this.scroll(r,t)}scroll(e,t){const s=this.dropdown_content;t&&(s.style.scrollBehavior=t),s.scrollTop=e,s.style.scrollBehavior=""}clearActiveOption(){this.activeOption&&(T(this.activeOption,"active"),j(this.activeOption,{"aria-selected":null})),this.activeOption=null,j(this.focus_node,{"aria-activedescendant":null})}selectAll(){const e=this;if("single"===e.settings.mode)return;const t=e.controlChildren();t.length&&(e.hideInput(),e.close(),e.activeItems=t,w(t,(t=>{e.setActiveItemClass(t)})))}inputState(){var e=this;e.control.contains(e.control_input)&&(j(e.control_input,{placeholder:e.settings.placeholder}),e.activeItems.length>0||!e.isFocused&&e.settings.hidePlaceholder&&e.items.length>0?(e.setTextboxValue(),e.isInputHidden=!0):(e.settings.hidePlaceholder&&e.items.length>0&&j(e.control_input,{placeholder:""}),e.isInputHidden=!1),e.wrapper.classList.toggle("input-hidden",e.isInputHidden))}hideInput(){this.inputState()}showInput(){this.inputState()}inputValue(){return this.control_input.value.trim()}focus(){var e=this;e.isDisabled||(e.ignoreFocus=!0,e.control_input.offsetWidth?e.control_input.focus():e.focus_node.focus(),setTimeout((()=>{e.ignoreFocus=!1,e.onFocus()}),0))}blur(){this.focus_node.blur(),this.onBlur()}getScoreFunction(e){return this.sifter.getScoreFunction(e,this.getSearchOptions())}getSearchOptions(){var e=this.settings,t=e.sortField;return"string"==typeof e.sortField&&(t=[{field:e.sortField}]),{fields:e.searchField,conjunction:e.searchConjunction,sort:t,nesting:e.nesting}}search(e){var t,s,i,n=this,a=this.getSearchOptions();if(n.settings.score&&"function"!=typeof(i=n.settings.score.call(n,e)))throw new Error('Tom Select "score" setting must be a function that returns a function');if(e!==n.lastQuery?(n.lastQuery=e,s=n.sifter.search(e,Object.assign(a,{score:i})),n.currentResults=s):s=Object.assign({},n.currentResults),n.settings.hideSelected)for(t=s.items.length-1;t>=0;t--){let e=X(s.items[t].id);e&&-1!==n.items.indexOf(e)&&s.items.splice(t,1)}return s}refreshOptions(e=!0){var t,s,i,n,a,r,o,l,d,c,h;const p={},u=[];var g=this,m=g.inputValue(),f=g.search(m),v=null,b=g.settings.shouldOpen||!1,y=g.dropdown_content;for(g.activeOption&&(d=g.activeOption.dataset.value,c=g.activeOption.closest("[data-group]")),n=f.items.length,"number"==typeof g.settings.maxOptions&&(n=Math.min(n,g.settings.maxOptions)),n>0&&(b=!0),t=0;t<n;t++){let e=f.items[t].id,n=g.options[e],o=g.getOption(e,!0);for(g.settings.hideSelected||o.classList.toggle("selected",g.items.includes(e)),a=n[g.settings.optgroupField]||"",s=0,i=(r=Array.isArray(a)?a:[a])&&r.length;s<i;s++)a=r[s],g.optgroups.hasOwnProperty(a)||(a=""),p.hasOwnProperty(a)||(p[a]=document.createDocumentFragment(),u.push(a)),s>0&&(o=o.cloneNode(!0),j(o,{id:n.$id+"-clone-"+s,"aria-selected":null}),o.classList.add("ts-cloned"),T(o,"active")),v||d!=e||(c?c.dataset.group===a&&(v=o):v=o),p[a].appendChild(o)}this.settings.lockOptgroupOrder&&u.sort(((e,t)=>(g.optgroups[e]&&g.optgroups[e].$order||0)-(g.optgroups[t]&&g.optgroups[t].$order||0))),o=document.createDocumentFragment(),w(u,(e=>{if(g.optgroups.hasOwnProperty(e)&&p[e].children.length){let t=document.createDocumentFragment(),s=g.render("optgroup_header",g.optgroups[e]);de(t,s),de(t,p[e]);let i=g.render("optgroup",{group:g.optgroups[e],options:t});de(o,i)}else de(o,p[e])})),y.innerHTML="",de(y,o),g.settings.highlight&&(D(y),f.query.length&&f.tokens.length&&w(f.tokens,(e=>{R(y,e.regex)})));var S=e=>{let t=g.render(e,{input:m});return t&&(b=!0,y.insertBefore(t,y.firstChild)),t};if(g.loading?S("loading"):g.settings.shouldLoad.call(g,m)?0===f.items.length&&S("no_results"):S("not_loading"),(l=g.canCreate(m))&&(h=S("option_create")),g.hasOptions=f.items.length>0||l,b){if(f.items.length>0){if(!v&&"single"===g.settings.mode&&g.items.length&&(v=g.getOption(g.items[0])),!y.contains(v)){let e=0;h&&!g.settings.addPrecedence&&(e=1),v=g.selectable()[e]}}else h&&(v=h);e&&!g.isOpen&&(g.open(),g.scrollToOption(v,"auto")),g.setActiveOption(v)}else g.clearActiveOption(),e&&g.isOpen&&g.close(!1)}selectable(){return this.dropdown_content.querySelectorAll("[data-selectable]")}addOption(e,t=!1){const s=this;if(Array.isArray(e))return s.addOptions(e,t),!1;const i=X(e[s.settings.valueField]);return null!==i&&!s.options.hasOwnProperty(i)&&(e.$order=e.$order||++s.order,e.$id=s.inputId+"-opt-"+e.$order,s.options[i]=e,s.lastQuery=null,t&&(s.userOptions[i]=t,s.trigger("option_add",i,e)),i)}addOptions(e,t=!1){w(e,(e=>{this.addOption(e,t)}))}registerOption(e){return this.addOption(e)}registerOptionGroup(e){var t=X(e[this.settings.optgroupValueField]);return null!==t&&(e.$order=e.$order||++this.order,this.optgroups[t]=e,t)}addOptionGroup(e,t){var s;t[this.settings.optgroupValueField]=e,(s=this.registerOptionGroup(t))&&this.trigger("optgroup_add",s,t)}removeOptionGroup(e){this.optgroups.hasOwnProperty(e)&&(delete this.optgroups[e],this.clearCache(),this.trigger("optgroup_remove",e))}clearOptionGroups(){this.optgroups={},this.clearCache(),this.trigger("optgroup_clear")}updateOption(e,t){const s=this;var i,n;const a=X(e),r=X(t[s.settings.valueField]);if(null===a)return;if(!s.options.hasOwnProperty(a))return;if("string"!=typeof r)throw new Error("Value must be set in option data");const o=s.getOption(a),l=s.getItem(a);if(t.$order=t.$order||s.options[a].$order,delete s.options[a],s.uncacheValue(r),s.options[r]=t,o){if(s.dropdown_content.contains(o)){const e=s._render("option",t);M(o,e),s.activeOption===o&&s.setActiveOption(e)}o.remove()}l&&(-1!==(n=s.items.indexOf(a))&&s.items.splice(n,1,r),i=s._render("item",t),l.classList.contains("active")&&I(i,"active"),M(l,i)),s.lastQuery=null}removeOption(e,t){const s=this;e=Z(e),s.uncacheValue(e),delete s.userOptions[e],delete s.options[e],s.lastQuery=null,s.trigger("option_remove",e),s.removeItem(e,t)}clearOptions(){this.loadedSearches={},this.userOptions={},this.clearCache();var e={};w(this.options,((t,s)=>{this.items.indexOf(s)>=0&&(e[s]=this.options[s])})),this.options=this.sifter.items=e,this.lastQuery=null,this.trigger("option_clear")}getOption(e,t=!1){const s=X(e);if(null!==s&&this.options.hasOwnProperty(s)){const e=this.options[s];if(e.$div)return e.$div;if(t)return this._render("option",e)}return null}getAdjacent(e,t,s="option"){var i,n=this;if(!e)return null;i="item"==s?n.controlChildren():n.dropdown_content.querySelectorAll("[data-selectable]");for(let s=0;s<i.length;s++)if(i[s]==e)return t>0?i[s+1]:i[s-1];return null}getItem(e){if("object"==typeof e)return e;var t=X(e);return null!==t?this.control.querySelector(`[data-value="${le(t)}"]`):null}addItems(e,t){var s=this,i=Array.isArray(e)?e:[e];for(let e=0,n=(i=i.filter((e=>-1===s.items.indexOf(e)))).length;e<n;e++)s.isPending=e<n-1,s.addItem(i[e],t)}addItem(e,t){se(this,t?[]:["change","dropdown_close"],(()=>{var s,i;const n=this,a=n.settings.mode,r=X(e);if((!r||-1===n.items.indexOf(r)||("single"===a&&n.close(),"single"!==a&&n.settings.duplicates))&&null!==r&&n.options.hasOwnProperty(r)&&("single"===a&&n.clear(t),"multi"!==a||!n.isFull())){if(s=n._render("item",n.options[r]),n.control.contains(s)&&(s=s.cloneNode(!0)),i=n.isFull(),n.items.splice(n.caretPos,0,r),n.insertAtCaret(s),n.isSetup){if(!n.isPending&&n.settings.hideSelected){let e=n.getOption(r),t=n.getAdjacent(e,1);t&&n.setActiveOption(t)}n.isPending||n.settings.closeAfterSelect||n.refreshOptions(n.isFocused&&"single"!==a),0!=n.settings.closeAfterSelect&&n.isFull()?n.close():n.isPending||n.positionDropdown(),n.trigger("item_add",r,s),n.isPending||n.updateOriginalInput({silent:t})}(!n.isPending||!i&&n.isFull())&&(n.inputState(),n.refreshState())}}))}removeItem(e=null,t){const s=this;if(!(e=s.getItem(e)))return;var i,n;const a=e.dataset.value;i=H(e),e.remove(),e.classList.contains("active")&&(n=s.activeItems.indexOf(e),s.activeItems.splice(n,1),T(e,"active")),s.items.splice(i,1),s.lastQuery=null,!s.settings.persist&&s.userOptions.hasOwnProperty(a)&&s.removeOption(a,t),i<s.caretPos&&s.setCaret(s.caretPos-1),s.updateOriginalInput({silent:t}),s.refreshState(),s.positionDropdown(),s.trigger("item_remove",a,e)}createItem(e=null,t=!0,s=(()=>{})){var i,n=this,a=n.caretPos;if(e=e||n.inputValue(),!n.canCreate(e))return s(),!1;n.lock();var r=!1,o=e=>{if(n.unlock(),!e||"object"!=typeof e)return s();var t=X(e[n.settings.valueField]);if("string"!=typeof t)return s();n.setTextboxValue(),n.addOption(e,!0),n.setCaret(a),n.addItem(t),s(e),r=!0};return i="function"==typeof n.settings.create?n.settings.create.call(this,e,o):{[n.settings.labelField]:e,[n.settings.valueField]:e},r||o(i),!0}refreshItems(){var e=this;e.lastQuery=null,e.isSetup&&e.addItems(e.items),e.updateOriginalInput(),e.refreshState()}refreshState(){const e=this;e.refreshValidityState();const t=e.isFull(),s=e.isLocked;e.wrapper.classList.toggle("rtl",e.rtl);const i=e.wrapper.classList;i.toggle("focus",e.isFocused),i.toggle("disabled",e.isDisabled),i.toggle("required",e.isRequired),i.toggle("invalid",!e.isValid),i.toggle("locked",s),i.toggle("full",t),i.toggle("input-active",e.isFocused&&!e.isInputHidden),i.toggle("dropdown-active",e.isOpen),i.toggle("has-options",F(e.options)),i.toggle("has-items",e.items.length>0)}refreshValidityState(){var e=this;e.input.checkValidity&&(e.isValid=e.input.checkValidity(),e.isInvalid=!e.isValid)}isFull(){return null!==this.settings.maxItems&&this.items.length>=this.settings.maxItems}updateOriginalInput(e={}){const t=this;var s,i;const n=t.input.querySelector('option[value=""]');if(t.is_select_tag){const a=[],r=t.input.querySelectorAll("option:checked").length;function o(e,s,i){return e||(e=L('<option value="'+ee(s)+'">'+ee(i)+"</option>")),e!=n&&t.input.append(e),a.push(e),(e!=n||r>0)&&(e.selected=!0),e}t.input.querySelectorAll("option:checked").forEach((e=>{e.selected=!1})),0==t.items.length&&"single"==t.settings.mode?o(n,"",""):t.items.forEach((e=>{s=t.options[e],i=s[t.settings.labelField]||"",a.includes(s.$option)?o(t.input.querySelector(`option[value="${le(e)}"]:not(:checked)`),e,i):s.$option=o(s.$option,e,i)}))}else t.input.value=t.getValue();t.isSetup&&(e.silent||t.trigger("change",t.getValue()))}open(){var e=this;e.isLocked||e.isOpen||"multi"===e.settings.mode&&e.isFull()||(e.isOpen=!0,j(e.focus_node,{"aria-expanded":"true"}),e.refreshState(),O(e.dropdown,{visibility:"hidden",display:"block"}),e.positionDropdown(),O(e.dropdown,{visibility:"visible",display:"block"}),e.focus(),e.trigger("dropdown_open",e.dropdown))}close(e=!0){var t=this,s=t.isOpen;e&&(t.setTextboxValue(),"single"===t.settings.mode&&t.items.length&&t.hideInput()),t.isOpen=!1,j(t.focus_node,{"aria-expanded":"false"}),O(t.dropdown,{display:"none"}),t.settings.hideSelected&&t.clearActiveOption(),t.refreshState(),s&&t.trigger("dropdown_close",t.dropdown)}positionDropdown(){if("body"===this.settings.dropdownParent){var e=this.control,t=e.getBoundingClientRect(),s=e.offsetHeight+t.top+window.scrollY,i=t.left+window.scrollX;O(this.dropdown,{width:t.width+"px",top:s+"px",left:i+"px"})}}clear(e){var t=this;if(t.items.length){var s=t.controlChildren();w(s,(e=>{t.removeItem(e,!0)})),t.showInput(),e||t.updateOriginalInput(),t.trigger("clear")}}insertAtCaret(e){const t=this,s=t.caretPos,i=t.control;i.insertBefore(e,i.children[s]),t.setCaret(s+1)}deleteSelection(e){var t,s,i,n,a=this;t=e&&e.keyCode===U?-1:1,s=ie(a.control_input);const r=[];if(a.activeItems.length)n=_(a.activeItems,t),i=H(n),t>0&&i++,w(a.activeItems,(e=>r.push(e)));else if((a.isFocused||"single"===a.settings.mode)&&a.items.length){const e=a.controlChildren();t<0&&0===s.start&&0===s.length?r.push(e[a.caretPos-1]):t>0&&s.start===a.inputValue().length&&r.push(e[a.caretPos])}const o=r.map((e=>e.dataset.value));if(!o.length||"function"==typeof a.settings.onDelete&&!1===a.settings.onDelete.call(a,o,e))return!1;for(ne(e,!0),void 0!==i&&a.setCaret(i);r.length;)a.removeItem(r.pop());return a.showInput(),a.positionDropdown(),a.refreshOptions(!1),!0}advanceSelection(e,t){var s,i,n=this;n.rtl&&(e*=-1),n.inputValue().length||(re(G,t)||re("shiftKey",t)?(i=(s=n.getLastActive(e))?s.classList.contains("active")?n.getAdjacent(s,e,"item"):s:e>0?n.control_input.nextElementSibling:n.control_input.previousElementSibling)&&(i.classList.contains("active")&&n.removeActiveItem(s),n.setActiveItemClass(i)):n.moveCaret(e))}moveCaret(e){}getLastActive(e){let t=this.control.querySelector(".last-active");if(t)return t;var s=this.control.querySelectorAll(".active");return s?_(s,e):void 0}setCaret(e){this.caretPos=this.items.length}controlChildren(){return Array.from(this.control.querySelectorAll("[data-ts-item]"))}lock(){this.isLocked=!0,this.refreshState()}unlock(){this.isLocked=!1,this.refreshState()}disable(){var e=this;e.input.disabled=!0,e.control_input.disabled=!0,e.focus_node.tabIndex=-1,e.isDisabled=!0,this.close(),e.lock()}enable(){var e=this;e.input.disabled=!1,e.control_input.disabled=!1,e.focus_node.tabIndex=e.tabIndex,e.isDisabled=!1,e.unlock()}destroy(){var e=this,t=e.revertSettings;e.trigger("destroy"),e.off(),e.wrapper.remove(),e.dropdown.remove(),e.input.innerHTML=t.innerHTML,e.input.tabIndex=t.tabIndex,T(e.input,"tomselected","ts-hidden-accessible"),e._destroy(),delete e.input.tomselect}render(e,t){return"function"!=typeof this.settings.render[e]?null:this._render(e,t)}_render(e,t){var s,i,n="";const a=this;return"option"!==e&&"item"!=e||(n=Z(t[a.settings.valueField])),null==(i=a.settings.render[e].call(this,t,ee))||(i=L(i),"option"===e||"option_create"===e?t[a.settings.disabledField]?j(i,{"aria-disabled":"true"}):j(i,{"data-selectable":""}):"optgroup"===e&&(s=t.group[a.settings.optgroupValueField],j(i,{"data-group":s}),t.group[a.settings.disabledField]&&j(i,{"data-disabled":""})),"option"!==e&&"item"!==e||(j(i,{"data-value":n}),"item"===e?(I(i,a.settings.itemClass),j(i,{"data-ts-item":""})):(I(i,a.settings.optionClass),j(i,{role:"option",id:t.$id}),a.options[n].$div=i))),i}clearCache(){w(this.options,((e,t)=>{e.$div&&(e.$div.remove(),delete e.$div)}))}uncacheValue(e){const t=this.getOption(e);t&&t.remove()}canCreate(e){return this.settings.create&&e.length>0&&this.settings.createFilter.call(this,e)}hook(e,t,s){var i=this,n=i[t];i[t]=function(){var t,a;return"after"===e&&(t=n.apply(i,arguments)),a=s.apply(i,arguments),"instead"===e?a:("before"===e&&(t=n.apply(i,arguments)),t)}}}return pe}()}},s={};function i(e){var n=s[e];if(void 0!==n)return n.exports;var a=s[e]={exports:{}};return t[e].call(a.exports,a,a.exports,i),a.exports}i.m=t,i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.f={},i.e=e=>Promise.all(Object.keys(i.f).reduce(((t,s)=>(i.f[s](e,t),t)),[])),i.u=e=>"./js/"+e+".main.js",i.miniCssF=e=>{},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},i.l=(t,s,n,a)=>{if(e[t])e[t].push(s);else{var r,o;if(void 0!==n)for(var l=document.getElementsByTagName("script"),d=0;d<l.length;d++){var c=l[d];if(c.getAttribute("src")==t){r=c;break}}r||(o=!0,(r=document.createElement("script")).charset="utf-8",r.timeout=120,i.nc&&r.setAttribute("nonce",i.nc),r.src=t),e[t]=[s];var h=(s,i)=>{r.onerror=r.onload=null,clearTimeout(p);var n=e[t];if(delete e[t],r.parentNode&&r.parentNode.removeChild(r),n&&n.forEach((e=>e(i))),s)return s(i)},p=setTimeout(h.bind(null,void 0,{type:"timeout",target:r}),12e4);r.onerror=h.bind(null,r.onerror),r.onload=h.bind(null,r.onload),o&&document.head.appendChild(r)}},i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.p="",(()=>{var e={179:0};i.f.j=(t,s)=>{var n=i.o(e,t)?e[t]:void 0;if(0!==n)if(n)s.push(n[2]);else{var a=new Promise(((s,i)=>n=e[t]=[s,i]));s.push(n[2]=a);var r=i.p+i.u(t),o=new Error;i.l(r,(s=>{if(i.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var a=s&&("load"===s.type?"missing":s.type),r=s&&s.target&&s.target.src;o.message="Loading chunk "+t+" failed.\n("+a+": "+r+")",o.name="ChunkLoadError",o.type=a,o.request=r,n[1](o)}}),"chunk-"+t,t)}};var t=(t,s)=>{var n,a,[r,o,l]=s,d=0;if(r.some((t=>0!==e[t]))){for(n in o)i.o(o,n)&&(i.m[n]=o[n]);if(l)l(i)}for(t&&t(s);d<r.length;d++)a=r[d],i.o(e,a)&&e[a]&&e[a][0](),e[a]=0},s=self.webpackChunk=self.webpackChunk||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})(),i.nc=void 0,(()=>{"use strict";var e=i(379),t=i.n(e),s=i(795),n=i.n(s),a=i(569),r=i.n(a),o=i(565),l=i.n(o),d=i(216),c=i.n(d),h=i(589),p=i.n(h),u=i(583),g=i.n(u),m={};m.styleTagTransform=p(),m.setAttributes=l(),m.insert=r().bind(null,"head"),m.domAPI=n(),m.insertStyleElement=c();t()(g(),m);g()&&g().locals&&g().locals;var f=i(655),v=i.n(f),b={};b.styleTagTransform=p(),b.setAttributes=l(),b.insert=r().bind(null,"head"),b.domAPI=n(),b.insertStyleElement=c();t()(v(),b);v()&&v().locals&&v().locals;class y{box;constructor(e){this.box=e instanceof HTMLElement?e:document.querySelector(e)}async build(e,t="warning",s=null,i={}){let n;s=(s=s&&s instanceof HTMLElement?s:document.querySelector(s))||document.querySelector("main"),i=Object.assign({title:"",duration:null,buttons:null,dismissible:!1,inverse:!0,insertafter:!1,callback:null},i);const a=new URLSearchParams;a.append("type",t),a.append("title",void 0===i.title||""===i.title?"":": "+i.title),a.append("message",e),a.append("num",s.querySelectorAll(".alert").length),a.append("inverse",i.inverse),a.append("dismissible",i.dismissible);try{n=await fetch("/gui/alertbox",{method:"POST",body:a})}catch(e){console.log("err",e)}n=await n.text();return n=(new DOMParser).parseFromString(n,"text/html"),n=n.querySelector(".alert"),!0===i.insertafter?this.box=s.parentElement.insertBefore(n,s.nextSibling):(this.box=n,s.prepend(this.box)),i.dismissible&&this.dismissListener(),i.duration&&setTimeout((()=>{this.dismissAlert()}),i.duration),"confirm"!==t||this.waitForAnswer()}dismissAlert(){this.box&&this.box.remove()}dismissListener(){const e=this.box.querySelector("[data-dismiss]");if(!e)return;const t=this;e.addEventListener("click",(e=>{t.dismissAlert()}))}waitForAnswer(){const e=this.box.querySelector(".is-cancel"),t=this.box.querySelector(".is-ok"),s=this;return new Promise(((i,n)=>{e.addEventListener("click",(e=>{i(!1),s.dismissAlert()}),{once:!0}),t.addEventListener("click",(e=>{i(!0),null!==s.options.callback&&s.options.callback(),s.dismissAlert()}),{once:!0})}))}}var w=i(261),S=i.n(w);let x={};class L{apply(e,t=null){const s=e.getAttribute("id"),i=e.hasAttribute("multiple"),n=e.dataset.type;let a={url:"",settings:{}};switch(n){case"user":a.url="/api/users/search?by_name=",a.settings.valueField="id",a.settings.searchField="name",a.settings.labelField="name",a.settings.onInitialize=function(){e.tomselect.items.forEach((e=>{x[e]=!0}))},a.settings.onItemAdd=function(t){if(x[t]){if(!this.revertSettings||this.revertSettings.tabIndex<0)return;const s=e.querySelectorAll("option")[this.revertSettings.tabIndex].value;this.removeOption(t),this.addItem(s),x[t]=!1}else x[t]=!0},a.settings.onItemRemove=function(t){if(x[t]&&delete x[t],!this.revertSettings||this.revertSettings.tabIndex<0)return;const s=e.querySelectorAll("option")[this.revertSettings.tabIndex].value;void 0!==x[s]&&delete x[s]};break;case"instr":a.url="/search/instruments",a.settings.valueField="id",a.settings.labelField="text",a.settings.searchField="id";break;case"taxo":S().define("no_close",(()=>{this.close=()=>{}})),a.url="/search/taxo",a.settings.valueField="id",a.settings.labelField="text",a.settings.searchField="text";const t=t=>{t.addEventListener("click",(t=>{t.stopImmediatePropagation();const s=t.currentTarget.closest(".item").dataset.value;s&&e.tomselect.removeItem(s)}))};a.settings.onInitialize=()=>{const e=document.querySelector("#"+s).nextSibling;if(!e.classList.contains("ts-wrapper"))return;e.querySelectorAll(".item .ts-delet").forEach((e=>{t(e)}))},a.settings.onItemAdd=e=>{null!==(e=document.querySelector('.item[data-value="'+e+'"]'))&&e.classList.add("new"),null!==(e=e.querySelector(".ts-delet"))&&t(e)},a.settings.shouldLoad=e=>e.length>2}const r={create:!1,maxOptions:null,preload:!1,hideSelected:!0,duplicates:!1,allowEmptyOption:!0,onDropdownClose:function(){},shouldLoad:function(e){return e.length>2},load:function(e,t){if(this.loading>10)return void t();let s="";switch(n){case"user":s=a.url+encodeURIComponent("%"+e+"%");break;case"instr":case"taxo":s=a.url,e&&(s+="?q="+encodeURIComponent(e))}null!==s&&fetch(s).then((e=>e.json())).then((e=>("instr"===n&&e.length&&(e=e.reduce(((e,t,s)=>{let i={id:t,text:t};return e.push(i),e}),[])),e.length&&"object"==typeof e&&(e=Object.entries(e)),t(e)))).catch((e=>{console.log("tomselect",e)}))},render:{option:function(e){return null==e?"":`<div class="py-2 flex  ${i?"inline-flex":""} " data-value="${e[a.settings.valueField]}">\n${e[this.settings.labelField].replace("<","&#60;")}\n</div>`},item:function(e){if(null==e)return"";const t=i?'<i class="ts-delet"></i>':"";return'<div class="'+(i?"flex inline-flex":"")+` " data-value="${e[this.settings.valueField]}"> ${t} <span>\n${e[this.settings.labelField].replace("<","&#60;")} </span></div>`},no_results:function(t,s){return'<div class="no-results">'+(e.dataset.noresults?e.dataset.noresults:"No result found for ")+s(t.input)+"</div>"}}};if(a.settings=Object.assign(r,a.settings),null!==s){const e=new(S())("#"+s,a.settings);e.wrapper.classList.remove("js-autocomplete"),e.wrapper.classList.remove("js"),e.wrapper.setAttribute("data-component","tom-select")}}}let C=null;class E{alerts=[];options;users_list={};constructor(e={}){if(!C){const t={groupid:"#section-privileges",separ:".new-privilege",addbtn:'[data-add="block"]',target:"member",contactfieldname:"contact_user_id",privileges:{managers:"Manage",viewers:"View",annotators:"Annotate"}};this.options=Object.assign({},t,e),this.options.separ=this.options.separ instanceof HTMLElement?this.options.separ:document.querySelector(this.options.separ)?document.querySelector(this.options.separ):null,this.options.addbtn=this.options.addbtn instanceof HTMLElement?this.options.addbtn:document.querySelector(this.options.addbtn),null!==this.options.addbtn&&this.addListener();document.querySelectorAll(this.options.groupid+' [data-block="'+this.options.target+'"]').forEach((e=>{this.activateEvents(e)})),C=this}return C}newLine(e=!1){const t=document.querySelectorAll(this.options.groupid+' [data-block="'+this.options.target+'"]');if(0===t.length)return;const s=t.length-1;let i=t[s];return null!==i&&(i=this.clearLine(i.cloneNode(!0),s,this.options.separ?this.options.separ:i),this.activateEvents(i)),!0===e?i:void 0}addListener(){this.options.target=this.options.addbtn.dataset.target?this.options.addbtn.dataset.target:this.options.target,this.options.addbtn.addEventListener("click",(async e=>{e.preventDefault(),this.newLine()}))}clearLine(e,t,s=null){let i=null;e.dataset.mod="",e.disabled=!1;if(e.querySelectorAll("[data-elem]").forEach((e=>{e.querySelectorAll("[data-component]").forEach((e=>{if("tom-select"===e.dataset.component)e.remove()}));e.querySelectorAll("input, select, label").forEach((e=>{if(e.disabled=!1,s){["id","for","aria-controls","name"].forEach((s=>{let i=e.getAttribute(s);null!==i&&(i="name"===s?i.replace("["+t+"]","["+(t+1)+"]"):i.replace("_"+t,"_"+(t+1)),e.setAttribute(s,i))}))}switch(e.tagName.toLowerCase()){case"input":e.checked=!1,"contact_user_id"==e.name&&(e.value="0",e.disabled=!0);break;case"select":e.selectedIndex=-1;break;case"label":e.classList.remove("peer-checked")}e.tomselect&&(i=e,e.tomselect.clear(),e.tomselect.destroy()),e.classList.contains("tomselected")&&(i=e,e.classList.forEach((t=>{0==t.indexOf("ts-")&&e.classList.remove(t)})),e.classList.remove("tomselected"),"select-one"==e.type&&delete e.type)}))})),s&&(e.classList.add("new"),s.after(e)),null!==i){(new L).apply(i),i.tomselect.clearOptions();let e=document.querySelector(this.options.groupid).dataset.options;e=e||[],i.tomselect.addOptions(e)}return e}setLine(e,t={key:"",value:""},s,i){if(!(s=this.options.privileges[s]))return;const{member:n,privs:a,contact:r,delet:o}=this.getInputs(e,s);if(n&&a&&r&&o){if(n.tomselect){let e={};e[n.tomselect.settings.valueField]=t.key,e[n.tomselect.settings.labelField]=t.value,n.tomselect.addOption(e),n.tomselect.addItem(t.key,!1),n.tomselect.sync()}else{const e=n.querySelector('select option[value="'+t.key+'"]');e?e.selected=!0:n.insertAdjacentHTML("beforeend",'<option value="'+t.key+'" selected>'+t.value+"</option>")}a.checked=!0,r.value=t.key,"Manage"===s&&(r.disabled=!1,!0===i&&(r.checked=!0))}}getInputs(e,t=!1){const s=e.querySelector("[name*='[member]']");let i;i=t?e.querySelector('input[name*="[privilege]"][value="'+t+'"]'):e.querySelectorAll('input[name*="[privilege]"]');return{member:s,privs:i,contact:e.querySelector('input[name="contact_user_id"]'),delet:e.querySelector("input[name*='[delet]']")}}activateEvents(e){if(!e)return;const{member:t,privs:s,contact:i,delet:n}=this.getInputs(e);if(!(t&&s&&i&&n))return;const a=(t,s,i,n=!1)=>{t&&"Manage"===t.value?(i.disabled=!0,s.disabled=!1):(s.checked=!1,i.disabled=!1,s.disabled=!0),!0===n&&r(e)},r=e=>{var t;[...(t=e).parentElement.children].filter((e=>1==e.nodeType&&e!=t&&e.classList.contains("row")&&null!==e.dataset.block&&"member"===e.dataset.block)).forEach((e=>{const t=e.querySelector("input[name*='[delet]']"),s=e.querySelector('input[name="contact_user_id"]'),i=e.querySelector('input[name*="[privilege]"]:checked');a(i,s,t,!1)}))};t.addEventListener("change",(e=>{i.value=t.value})),s.forEach((e=>{e.addEventListener("change",(t=>{e.checked&&a(e,i,n,!1)})),e.checked&&a(e,i,n,!1)})),i.addEventListener("change",(t=>{t.target.checked?n.disabled=!0:n.disabled=!1;const s=e.querySelector('input[name*="[privilege]"]:checked');a(s,i,n,!0)})),n.addEventListener("click",(async a=>{if(document.querySelectorAll(this.options.groupid+' [data-block="'+this.options.target+'"]:not([data-mod="remove"])').length<=1&&a.target.checked)return n.disabled=!0,n.checked=!1,void(this.alerts.delet=await(new y).build("oneatleast","warning",a.target.id||"0",{dismissible:!0}));a.target.checked?e.classList.contains("new")?e.remove():(e.setAttribute("data-mod","remove"),s.forEach((e=>{e.disabled=!0,e.checked=!1})),i.checked=!1,i.disabled=!0,t.disabled=!0):(e.removeAttribute("data-mod"),s.forEach((e=>e.disabled=!1)),i.disabled=!1,t.disabled=!1)})),n.addEventListener("mouseover",(t=>{if(t.target.disabled){let s=e.querySelector('input[name*="[privilege]"]:checked');if(!s)return;s=s.value.toLowerCase(),t.target.title=t.target.dataset[s]?t.target.dataset[s]:t.target.title}}))}async cleanPrivileges(){const e=e=>e.querySelector('[name*="[member]"]').value,t=e=>{const t=e.querySelector('[name*="[privilege]"]:checked');return!(!t||!t.value)},s=e=>{e.querySelectorAll('[name*="members["').forEach((e=>{let t=e.name;t=t.split("["),t.pop(),e.name=t.join("["),e.name.indexOf("[privilege]")>0&&(e.type="checkbox",e.classList.add("hidden"))}))};if(!0===await(async e=>{if(0===document.querySelectorAll(e+' [name*="[privilege]"][value="Manage"]:checked').length)return this.alerts.contact=await(new y).build("nomanager","danger",e,{dismissible:!0}),!1;this.alerts.length&&this.alerts.contact&&this.alerts.contact.dismissAlert();return null===document.querySelector(e+' [name="contact_user_id"]:checked')?(this.alerts.contact=(new y).build("nocontact","danger",e,{dismissible:!0}),!1):(this.alerts.length&&this.alerts.contact&&this.alerts.contact.dismissAlert(),!0)})(this.options.groupid)){const i=document.querySelectorAll(this.options.groupid+' [data-block="'+this.options.target+'"]');let n=i.length,a=!0;for(const s of i)if(s.dataset.mod&&"remove"===s.dataset.mod){if(!(n>1))return!1;s.remove(),n--}else if(e(s))t(s)||(await(new y).build("uhasnopriv","warning",s,{dismissible:!0,insertafter:!0}),a=!1);else{const e=s.querySelector('[name*="[member]"]');e.focus(),e.tomselect&&e.tomselect.focus(),await(new y).build("emptyname","warning",s,{dismissible:!0,insertafter:!0});if(!0!==!1)return!1;if(!(n>1))return!1;s.remove(),n--}if(!a)return a;for(const e of i)s(e);return 0!==n||(await(new y).build("nobody","danger",this.options.groupid,{dismissible:!0}),!1)}return!1}clearAll(e=!1){const t=document.querySelectorAll(this.options.groupid+' [data-block="'+this.options.target+'"]');if(t.forEach(((e,t)=>{t>0&&e.remove()})),this.clearLine(t[0],0),this.activateEvents(t[0]),!0===e)return t[0]}async submitPrivileges(){return await this.cleanPrivileges()}}const A=e=>"[object Object]"===Object.prototype.toString.call(e),O=(e,t)=>{const s=document.createElement(e);if(t&&"object"==typeof t)for(const e in t)"html"===e?s.innerHTML=t[e]:s.setAttribute(e,t[e]);return s},I=e=>{e instanceof NodeList?e.forEach((e=>I(e))):e.innerHTML=""},T=(e,t,s)=>O("li",{class:e,html:`<a href="#" data-page="${t}">${s}</a>`}),k=(e,t)=>{let s,i;1===t?(s=0,i=e.length):-1===t&&(s=e.length-1,i=-1);for(let n=!0;n;){n=!1;for(let a=s;a!=i;a+=t)if(e[a+t]&&e[a].value>e[a+t].value){const s=e[a],i=e[a+t],r=s;e[a]=i,e[a+t]=r,n=!0}}return e};class q{constructor(e,t){return this.dt=e,this.rows=t,this}build(e){const t=O("tr");let s=this.dt.headings;return s.length||(s=e.map((()=>""))),s.forEach(((s,i)=>{const n=O("td");e[i]&&e[i].length||(e[i]=""),n.innerHTML=e[i],n.data=e[i],t.appendChild(n)})),t}render(e){return e}add(e){if(Array.isArray(e)){const t=this.dt;Array.isArray(e[0])?e.forEach((e=>{t.data.push(this.build(e))})):t.data.push(this.build(e)),t.data.length&&(t.hasRows=!0),this.update(),t.columns().rebuild()}}remove(e){const t=this.dt;Array.isArray(e)?(e.sort(((e,t)=>t-e)),e.forEach((e=>{t.data.splice(e,1)}))):"all"==e?t.data=[]:t.data.splice(e,1),t.data.length||(t.hasRows=!1),this.update(),t.columns().rebuild()}update(){this.dt.data.forEach(((e,t)=>{e.dataIndex=t}))}findRowIndex(e,t){return this.dt.data.findIndex((s=>s.children[e].innerText.toLowerCase().includes(String(t).toLowerCase())))}findRow(e,t){const s=this.findRowIndex(e,t);if(s<0)return{index:-1,row:null,cols:[]};const i=this.dt.data[s];return{index:s,row:i,cols:[...i.cells].map((e=>e.innerHTML))}}updateRow(e,t){const s=this.build(t);this.dt.data.splice(e,1,s),this.update(),this.dt.columns().rebuild()}}class P{constructor(e){return this.dt=e,this}swap(e){if(e.length&&2===e.length){const t=[];this.dt.headings.forEach(((e,s)=>{t.push(s)}));const s=e[0],i=e[1],n=t[i];t[i]=t[s],t[s]=n,this.order(t)}}order(e){let t,s,i,n,a,r,o;const l=[[],[],[],[]],d=this.dt;e.forEach(((e,i)=>{a=d.headings[e],r="false"!==a.getAttribute("data-sortable"),t=a.cloneNode(!0),t.originalCellIndex=i,t.sortable=r,l[0].push(t),d.hiddenColumns.includes(e)||(s=a.cloneNode(!0),s.originalCellIndex=i,s.sortable=r,l[1].push(s))})),d.data.forEach(((t,s)=>{i=t.cloneNode(!1),n=t.cloneNode(!1),i.dataIndex=n.dataIndex=s,null!==t.searchIndex&&void 0!==t.searchIndex&&(i.searchIndex=n.searchIndex=t.searchIndex),e.forEach((e=>{o=t.cells[e].cloneNode(!0),o.data=t.cells[e].data,i.appendChild(o),d.hiddenColumns.includes(e)||(o=t.cells[e].cloneNode(!0),o.data=t.cells[e].data,n.appendChild(o))})),l[2].push(i),l[3].push(n)})),d.headings=l[0],d.activeHeadings=l[1],d.data=l[2],d.activeRows=l[3],d.update()}hide(e){if(e.length){const t=this.dt;e.forEach((e=>{t.hiddenColumns.includes(e)||t.hiddenColumns.push(e)})),this.rebuild()}}show(e){if(e.length){let t;const s=this.dt;e.forEach((e=>{t=s.hiddenColumns.indexOf(e),t>-1&&s.hiddenColumns.splice(t,1)})),this.rebuild()}}visible(e){let t;const s=this.dt;return e=e||s.headings.map((e=>e.originalCellIndex)),isNaN(e)?Array.isArray(e)&&(t=[],e.forEach((e=>{t.push(!s.hiddenColumns.includes(e))}))):t=!s.hiddenColumns.includes(e),t}add(e){let t;const s=document.createElement("th");if(!this.dt.headings.length)return this.dt.insert({headings:[e.heading],data:e.data.map((e=>[e]))}),void this.rebuild();this.dt.hiddenHeader?s.innerHTML="":e.heading.nodeName?s.appendChild(e.heading):s.innerHTML=e.heading,this.dt.headings.push(s),this.dt.data.forEach(((s,i)=>{e.data[i]&&(t=document.createElement("td"),e.data[i].nodeName?t.appendChild(e.data[i]):t.innerHTML=e.data[i],t.data=t.innerHTML,e.render&&(t.innerHTML=e.render.call(this,t.data,t,s)),s.appendChild(t))})),e.type&&s.setAttribute("data-type",e.type),e.format&&s.setAttribute("data-format",e.format),e.hasOwnProperty("sortable")&&(s.sortable=e.sortable,s.setAttribute("data-sortable",!0===e.sortable?"true":"false")),this.rebuild(),this.dt.renderHeader()}remove(e){Array.isArray(e)?(e.sort(((e,t)=>t-e)),e.forEach((e=>this.remove(e)))):(this.dt.headings.splice(e,1),this.dt.data.forEach((t=>{t.removeChild(t.cells[e])}))),this.rebuild()}filter(e,t,s,i){const n=this.dt;if(n.filterState||(n.filterState={originalData:n.data}),!n.filterState[e]){const t=[...i,()=>!0];n.filterState[e]=function(){let e=0;return()=>t[e++%t.length]}()}const a=n.filterState[e](),r=Array.from(n.filterState.originalData).filter((t=>{const s=t.cells[e],i=s.hasAttribute("data-content")?s.getAttribute("data-content"):s.innerText;return"function"==typeof a?a(i):i===a}));n.data=r,n.data.length?(this.rebuild(),n.update()):(n.clear(),n.hasRows=!1,n.setMessage(n.options.labels.noRows)),s||n.emit("datatable.sort",e,t)}sort(e,t,s){const n=this.dt;if(n.hasHeadings&&(e<0||e>n.headings.length))return!1;const a=n.options.filters&&n.options.filters[n.headings[e].textContent];if(a&&0!==a.length)return void this.filter(e,t,s,a);n.sorting=!0,s||n.emit("datatable.sorting",e,t);let r=n.data;const o=[],l=[];let d=0,c=0;const h=n.headings[e],p=[];if("date"===h.getAttribute("data-type")){let e=!1;h.hasAttribute("data-format")&&(e=h.getAttribute("data-format")),p.push(i.e(568).then(i.bind(i,568)).then((({parseDate:t})=>s=>t(s,e))))}Promise.all(p).then((i=>{const a=i[0];let p,u;Array.from(r).forEach((t=>{const s=t.cells[e],i=s.hasAttribute("data-content")?s.getAttribute("data-content"):s.innerText;let n;n=a?a(i):"string"==typeof i?i.replace(/(\$|,|\s|%)/g,""):i,parseFloat(n)==n?l[c++]={value:Number(n),row:t}:o[d++]={value:"string"==typeof i?i.toLowerCase():i,row:t}})),t||(t=h.classList.contains("asc")?"desc":"asc"),"desc"==t?(p=k(o,-1),u=k(l,-1),h.classList.remove("asc"),h.classList.add("desc")):(p=k(l,1),u=k(o,1),h.classList.remove("desc"),h.classList.add("asc")),n.lastTh&&h!=n.lastTh&&(n.lastTh.classList.remove("desc"),n.lastTh.classList.remove("asc")),n.lastTh=h,r=p.concat(u),n.data=[];const g=[];r.forEach(((e,t)=>{n.data.push(e.row),null!==e.row.searchIndex&&void 0!==e.row.searchIndex&&g.push(t)})),n.searchData=g,this.rebuild(),n.update(),s||n.emit("datatable.sort",e,t)}))}rebuild(){let e,t,s,i;const n=this.dt,a=[];n.activeRows=[],n.activeHeadings=[],n.headings.forEach(((e,t)=>{e.originalCellIndex=t,e.sortable="false"!==e.getAttribute("data-sortable"),n.hiddenColumns.includes(t)||n.activeHeadings.push(e)})),n.data.forEach(((r,o)=>{e=r.cloneNode(!1),t=r.cloneNode(!1),e.dataIndex=t.dataIndex=o,null!==r.searchIndex&&void 0!==r.searchIndex&&(e.searchIndex=t.searchIndex=r.searchIndex),Array.from(r.cells).forEach((a=>{s=a.cloneNode(!0),s.data=a.data,e.appendChild(s),n.hiddenColumns.includes(s.cellIndex)||(i=s.cloneNode(!0),i.data=s.data,t.appendChild(i))})),a.push(e),n.activeRows.push(t)})),n.data=a,n.update()}}const _=function(e){let t=!1,s=!1;if((e=e||this.options.data).headings){t=O("thead");const s=O("tr");e.headings.forEach((e=>{const t=O("th",{html:e});s.appendChild(t)})),t.appendChild(s)}e.data&&e.data.length&&(s=O("tbody"),e.data.forEach((t=>{if(e.headings&&e.headings.length!==t.length)throw new Error("The number of rows do not match the number of headings.");const i=O("tr");t.forEach((e=>{const t=O("td",{html:e});i.appendChild(t)})),s.appendChild(i)}))),t&&(null!==this.dom.tHead&&this.dom.removeChild(this.dom.tHead),this.dom.appendChild(t)),s&&(this.dom.tBodies.length&&this.dom.removeChild(this.dom.tBodies[0]),this.dom.appendChild(s))},F={sortable:!0,searchable:!0,paging:!0,perPage:10,perPageSelect:[5,10,15,20,25],nextPrev:!0,firstLast:!1,prevText:"&lsaquo;",nextText:"&rsaquo;",firstText:"&laquo;",lastText:"&raquo;",ellipsisText:"&hellip;",ascText:"▴",descText:"▾",truncatePager:!0,pagerDelta:2,scrollY:"",fixedColumns:!0,fixedHeight:!1,header:!0,hiddenHeader:!1,footer:!1,labels:{placeholder:"Search...",perPage:"{select} entries per page",noRows:"No entries found",noResults:"No results match your search query",info:"Showing {start} to {end} of {rows} entries"},layout:{top:"{select}{search}",bottom:"{info}{pager}"}};class H{constructor(e,t={}){const s="string"==typeof e?document.querySelector(e):e;if(this.options={...F,...t,layout:{...F.layout,...t.layout},labels:{...F.labels,...t.labels}},this.initialized=!1,this.initialLayout=s.innerHTML,this.initialSortable=this.options.sortable,this.options.header||(this.options.sortable=!1),null===s.tHead&&(!this.options.data||this.options.data&&!this.options.data.headings)&&(this.options.sortable=!1),s.tBodies.length&&!s.tBodies[0].rows.length&&this.options.data&&!this.options.data.data)throw new Error("You seem to be using the data option, but you've not defined any rows.");this.dom=s,this.table=this.dom,this.listeners={onResize:e=>this.onResize(e)},this.init()}static extend(e,t){"function"==typeof t?H.prototype[e]=t:H[e]=t}init(e){if(this.initialized||this.dom.classList.contains("dataTable-table"))return!1;Object.assign(this.options,e||{}),this.currentPage=1,this.onFirstPage=!0,this.hiddenColumns=[],this.columnRenderers=[],this.selectedColumns=[],this.render(),setTimeout((()=>{this.emit("datatable.init"),this.initialized=!0,this.options.plugins&&Object.entries(this.options.plugins).forEach((([e,t])=>{this[e]&&"function"==typeof this[e]&&(this[e]=this[e](t,{createElement:O}),t.enabled&&this[e].init&&"function"==typeof this[e].init&&this[e].init())}))}),10)}render(e){if(e){switch(e){case"page":this.renderPage();break;case"pager":this.renderPager();break;case"header":this.renderHeader()}return!1}const t=this.options;let s="";if(t.data&&_.call(this),this.body=this.dom.tBodies[0],this.head=this.dom.tHead,this.foot=this.dom.tFoot,this.body||(this.body=O("tbody"),this.dom.appendChild(this.body)),this.hasRows=this.body.rows.length>0,!this.head){const e=O("thead"),s=O("tr");this.hasRows&&(Array.from(this.body.rows[0].cells).forEach((()=>{s.appendChild(O("th"))})),e.appendChild(s)),this.head=e,this.dom.insertBefore(this.head,this.body),this.hiddenHeader=t.hiddenHeader}if(this.headings=[],this.hasHeadings=this.head.rows.length>0,this.hasHeadings&&(this.header=this.head.rows[0],this.headings=[].slice.call(this.header.cells)),t.header||this.head&&this.dom.removeChild(this.dom.tHead),t.footer?this.head&&!this.foot&&(this.foot=O("tfoot",{html:this.head.innerHTML}),this.dom.appendChild(this.foot)):this.foot&&this.dom.removeChild(this.dom.tFoot),this.wrapper=O("div",{class:"dataTable-wrapper dataTable-loading"}),s+="<div class='dataTable-top'>",s+=t.layout.top,s+="</div>",t.scrollY.length?s+=`<div class='dataTable-container' style='height: ${t.scrollY}; overflow-Y: auto;'></div>`:s+="<div class='dataTable-container'></div>",s+="<div class='dataTable-bottom'>",s+=t.layout.bottom,s+="</div>",s=s.replace("{info}",t.paging?"<div class='dataTable-info'></div>":""),t.paging&&t.perPageSelect){let e="<div class='dataTable-dropdown'><label>";e+=t.labels.perPage,e+="</label></div>";const i=O("select",{class:"dataTable-selector"});t.perPageSelect.forEach((e=>{const s=e===t.perPage,n=new Option(e,e,s,s);i.add(n)})),e=e.replace("{select}",i.outerHTML),s=s.replace("{select}",e)}else s=s.replace("{select}","");if(t.searchable){const e=`<div class='dataTable-search'><input class='dataTable-input' placeholder='${t.labels.placeholder}' type='text'></div>`;s=s.replace("{search}",e)}else s=s.replace("{search}","");this.hasHeadings&&this.render("header"),this.dom.classList.add("dataTable-table");const i=O("nav",{class:"dataTable-pagination"}),n=O("ul",{class:"dataTable-pagination-list"});i.appendChild(n),s=s.replace(/\{pager\}/g,i.outerHTML),this.wrapper.innerHTML=s,this.container=this.wrapper.querySelector(".dataTable-container"),this.pagers=this.wrapper.querySelectorAll(".dataTable-pagination-list"),this.label=this.wrapper.querySelector(".dataTable-info"),this.dom.parentNode.replaceChild(this.wrapper,this.dom),this.container.appendChild(this.dom),this.rect=this.dom.getBoundingClientRect(),this.data=Array.from(this.body.rows),this.activeRows=this.data.slice(),this.activeHeadings=this.headings.slice(),this.update(),this.setColumns(),this.fixHeight(),this.fixColumns(),t.header||this.wrapper.classList.add("no-header"),t.footer||this.wrapper.classList.add("no-footer"),t.sortable&&this.wrapper.classList.add("sortable"),t.searchable&&this.wrapper.classList.add("searchable"),t.fixedHeight&&this.wrapper.classList.add("fixed-height"),t.fixedColumns&&this.wrapper.classList.add("fixed-columns"),this.bindEvents()}renderPage(){if(this.hasHeadings&&(I(this.header),this.activeHeadings.forEach((e=>this.header.appendChild(e)))),this.hasRows&&this.totalPages){this.currentPage>this.totalPages&&(this.currentPage=1);const e=this.currentPage-1,t=document.createDocumentFragment();this.pages[e].forEach((e=>t.appendChild(this.rows().render(e)))),this.clear(t),this.onFirstPage=1===this.currentPage,this.onLastPage=this.currentPage===this.lastPage}else this.setMessage(this.options.labels.noRows);let e,t=0,s=0,i=0;if(this.totalPages&&(t=this.currentPage-1,s=t*this.options.perPage,i=s+this.pages[t].length,s+=1,e=this.searching?this.searchData.length:this.data.length),this.label&&this.options.labels.info.length){const t=this.options.labels.info.replace("{start}",s).replace("{end}",i).replace("{page}",this.currentPage).replace("{pages}",this.totalPages).replace("{rows}",e);this.label.innerHTML=e?t:""}1==this.currentPage&&this.fixHeight()}renderPager(){if(I(this.pagers),this.totalPages>1){const e="pager",t=document.createDocumentFragment(),s=this.onFirstPage?1:this.currentPage-1,i=this.onLastPage?this.totalPages:this.currentPage+1;this.options.firstLast&&t.appendChild(T(e,1,this.options.firstText)),this.options.nextPrev&&!this.onFirstPage&&t.appendChild(T(e,s,this.options.prevText));let n=this.links;this.options.truncatePager&&(n=((e,t,s,i,n)=>{let a;const r=2*(i=i||2);let o=t-i,l=t+i;const d=[],c=[];t<4-i+r?l=3+r:t>s-(3-i+r)&&(o=s-(2+r));for(let t=1;t<=s;t++)if(1==t||t==s||t>=o&&t<=l){const s=e[t-1];s.classList.remove("active"),d.push(s)}return d.forEach((t=>{const s=t.children[0].getAttribute("data-page");if(a){const t=a.children[0].getAttribute("data-page");if(s-t==2)c.push(e[t]);else if(s-t!=1){const e=O("li",{class:"ellipsis",html:`<a href="#">${n}</a>`});c.push(e)}}c.push(t),a=t})),c})(this.links,this.currentPage,this.pages.length,this.options.pagerDelta,this.options.ellipsisText)),this.links[this.currentPage-1].classList.add("active"),n.forEach((e=>{e.classList.remove("active"),t.appendChild(e)})),this.links[this.currentPage-1].classList.add("active"),this.options.nextPrev&&!this.onLastPage&&t.appendChild(T(e,i,this.options.nextText)),this.options.firstLast&&t.appendChild(T(e,this.totalPages,this.options.lastText)),this.pagers.forEach((e=>{e.appendChild(t.cloneNode(!0))}))}}renderHeader(){this.labels=[],this.headings&&this.headings.length&&this.headings.forEach(((e,t)=>{if(this.labels[t]=e.textContent,e.firstElementChild&&e.firstElementChild.classList.contains("dataTable-sorter")&&(e.innerHTML=e.firstElementChild.innerHTML),e.sortable="false"!==e.getAttribute("data-sortable"),e.originalCellIndex=t,this.options.sortable&&e.sortable){const t=O("a",{href:"#",class:"dataTable-sorter",html:e.innerHTML});e.innerHTML="",e.setAttribute("data-sortable",""),e.appendChild(t)}})),this.fixColumns()}bindEvents(){const e=this.options;if(e.perPageSelect){const t=this.wrapper.querySelector(".dataTable-selector");t&&t.addEventListener("change",(()=>{e.perPage=parseInt(t.value,10),this.update(),this.fixHeight(),this.emit("datatable.perpage",e.perPage)}),!1)}e.searchable&&(this.input=this.wrapper.querySelector(".dataTable-input"),this.input&&this.input.addEventListener("keyup",(()=>this.search(this.input.value)),!1)),this.wrapper.addEventListener("click",(t=>{const s=t.target.closest("a");s&&"a"===s.nodeName.toLowerCase()&&(s.hasAttribute("data-page")?(this.page(s.getAttribute("data-page")),t.preventDefault()):e.sortable&&s.classList.contains("dataTable-sorter")&&"false"!=s.parentNode.getAttribute("data-sortable")&&(this.columns().sort(this.headings.indexOf(s.parentNode)),t.preventDefault()))}),!1),window.addEventListener("resize",this.listeners.onResize)}onResize(){this.rect=this.container.getBoundingClientRect(),this.rect.width&&this.fixColumns()}setColumns(e){e||this.data.forEach((e=>{Array.from(e.cells).forEach((e=>{e.data=e.innerHTML}))})),this.options.columns&&this.headings.length&&this.options.columns.forEach((e=>{Array.isArray(e.select)||(e.select=[e.select]),e.hasOwnProperty("render")&&"function"==typeof e.render&&(this.selectedColumns=this.selectedColumns.concat(e.select),this.columnRenderers.push({columns:e.select,renderer:e.render})),e.select.forEach((t=>{const s=this.headings[t];s&&(e.type&&s.setAttribute("data-type",e.type),e.format&&s.setAttribute("data-format",e.format),e.hasOwnProperty("sortable")&&s.setAttribute("data-sortable",e.sortable),e.hasOwnProperty("hidden")&&!1!==e.hidden&&this.columns().hide([t]),e.hasOwnProperty("sort")&&1===e.select.length&&this.columns().sort(e.select[0],e.sort,!0))}))})),this.hasRows&&(this.data.forEach(((e,t)=>{e.dataIndex=t,Array.from(e.cells).forEach((e=>{e.data=e.innerHTML}))})),this.selectedColumns.length&&this.data.forEach((e=>{Array.from(e.cells).forEach(((t,s)=>{this.selectedColumns.includes(s)&&this.columnRenderers.forEach((i=>{i.columns.includes(s)&&(t.innerHTML=i.renderer.call(this,t.data,t,e))}))}))})),this.columns().rebuild()),this.render("header")}destroy(){this.dom.innerHTML=this.initialLayout,this.dom.classList.remove("dataTable-table"),this.wrapper.parentNode.replaceChild(this.dom,this.wrapper),this.initialized=!1,window.removeEventListener("resize",this.listeners.onResize)}update(){this.wrapper.classList.remove("dataTable-empty"),this.paginate(this),this.render("page"),this.links=[];let e=this.pages.length;for(;e--;){const t=e+1;this.links[e]=T(0===e?"active":"",t,t)}this.sorting=!1,this.render("pager"),this.rows().update(),this.emit("datatable.update")}paginate(){const e=this.options.perPage;let t=this.activeRows;return this.searching&&(t=[],this.searchData.forEach((e=>t.push(this.activeRows[e])))),this.options.paging?this.pages=t.map(((s,i)=>i%e==0?t.slice(i,i+e):null)).filter((e=>e)):this.pages=[t],this.totalPages=this.lastPage=this.pages.length,this.totalPages}fixColumns(){if((this.options.scrollY.length||this.options.fixedColumns)&&this.activeHeadings&&this.activeHeadings.length){let e,t=!1;if(this.columnWidths=[],this.dom.tHead){this.options.scrollY.length&&(t=O("thead"),t.appendChild(O("tr")),t.style.height="0px",this.headerTable&&(this.dom.tHead=this.headerTable.tHead)),this.activeHeadings.forEach((e=>{e.style.width=""}));const e=this.activeHeadings.reduce(((e,t)=>e+t.offsetWidth),0);if(this.activeHeadings.forEach(((s,i)=>{const n=s.offsetWidth,a=n/e*100;if(s.style.width=`${a}%`,this.columnWidths[i]=n,this.options.scrollY.length){const e=O("th");t.firstElementChild.appendChild(e),e.style.width=`${a}%`,e.style.paddingTop="0",e.style.paddingBottom="0",e.style.border="0"}})),this.options.scrollY.length){const e=this.dom.parentElement;if(!this.headerTable){this.headerTable=O("table",{class:"dataTable-table"});const t=O("div",{class:"dataTable-headercontainer"});t.appendChild(this.headerTable),e.parentElement.insertBefore(t,e)}const s=this.dom.tHead;this.dom.replaceChild(t,s),this.headerTable.tHead=s,this.headerTable.parentElement.style.paddingRight=`${this.headerTable.clientWidth-this.dom.clientWidth+parseInt(this.headerTable.parentElement.style.paddingRight||"0",10)}px`,e.scrollHeight>e.clientHeight&&(e.style.overflowY="scroll")}}else{e=[],t=O("thead");const s=O("tr");Array.from(this.dom.tBodies[0].rows[0].cells).forEach((()=>{const t=O("th");s.appendChild(t),e.push(t)})),t.appendChild(s),this.dom.insertBefore(t,this.body);const i=[];e.forEach(((e,t)=>{const s=e.offsetWidth,n=s/this.rect.width*100;i.push(n),this.columnWidths[t]=s})),this.data.forEach((e=>{Array.from(e.cells).forEach(((e,t)=>{this.columns(e.cellIndex).visible()&&(e.style.width=`${i[t]}%`)}))})),this.dom.removeChild(t)}}}fixHeight(){this.options.fixedHeight&&(this.container.style.height=null,this.rect=this.container.getBoundingClientRect(),this.container.style.height=`${this.rect.height}px`)}search(e){return!!this.hasRows&&(e=e.toLowerCase(),this.currentPage=1,this.searching=!0,this.searchData=[],e.length?(this.clear(),this.data.forEach(((t,s)=>{const i=this.searchData.includes(t);e.split(" ").reduce(((e,s)=>{let i=!1,n=null,a=null;for(let e=0;e<t.cells.length;e++)if(n=t.cells[e],a=n.hasAttribute("data-content")?n.getAttribute("data-content"):n.textContent,a.toLowerCase().includes(s)&&this.columns(n.cellIndex).visible()){i=!0;break}return e&&i}),!0)&&!i?(t.searchIndex=s,this.searchData.push(s)):t.searchIndex=null})),this.wrapper.classList.add("search-results"),this.searchData.length?this.update():(this.wrapper.classList.remove("search-results"),this.setMessage(this.options.labels.noResults)),void this.emit("datatable.search",e,this.searchData)):(this.searching=!1,this.update(),this.emit("datatable.search",e,this.searchData),this.wrapper.classList.remove("search-results"),!1))}page(e){return e!=this.currentPage&&(isNaN(e)||(this.currentPage=parseInt(e,10)),!(e>this.pages.length||e<0)&&(this.render("page"),this.render("pager"),void this.emit("datatable.page",e)))}sortColumn(e,t){this.columns().sort(e,t)}insert(e){let t=[];if(A(e)){if(e.headings&&!this.hasHeadings&&!this.hasRows){const t=O("tr");e.headings.forEach((e=>{const s=O("th",{html:e});t.appendChild(s)})),this.head.appendChild(t),this.header=t,this.headings=[].slice.call(t.cells),this.hasHeadings=!0,this.options.sortable=this.initialSortable,this.render("header"),this.activeHeadings=this.headings.slice()}e.data&&Array.isArray(e.data)&&(t=e.data)}else Array.isArray(e)&&e.forEach((e=>{const s=[];Object.entries(e).forEach((([e,t])=>{const i=this.labels.indexOf(e);i>-1&&(s[i]=t)})),t.push(s)}));t.length&&(this.rows().add(t),this.hasRows=!0),this.update(),this.setColumns(),this.fixColumns()}refresh(){this.options.searchable&&(this.input.value="",this.searching=!1),this.currentPage=1,this.onFirstPage=!0,this.update(),this.emit("datatable.refresh")}clear(e){this.body&&I(this.body);let t=this.body;if(this.body||(t=this.dom),e){if("string"==typeof e){document.createDocumentFragment().innerHTML=e}t.appendChild(e)}}export(e){if(!this.hasHeadings&&!this.hasRows)return!1;const t=this.activeHeadings;let s=[];const i=[];let n,a,r,o;if(!A(e))return!1;const l={download:!0,skipColumn:[],lineDelimiter:"\n",columnDelimiter:",",tableName:"myTable",replacer:null,space:4,...e};if(l.type){if("txt"!==l.type&&"csv"!==l.type||(s[0]=this.header),l.selection)if(isNaN(l.selection)){if(Array.isArray(l.selection))for(n=0;n<l.selection.length;n++)s=s.concat(this.pages[l.selection[n]-1])}else s=s.concat(this.pages[l.selection-1]);else s=s.concat(this.activeRows);if(s.length){if("txt"===l.type||"csv"===l.type){for(r="",n=0;n<s.length;n++){for(a=0;a<s[n].cells.length;a++)if(!l.skipColumn.includes(t[a].originalCellIndex)&&this.columns(t[a].originalCellIndex).visible()){let e=s[n].cells[a].textContent;e=e.trim(),e=e.replace(/\s{2,}/g," "),e=e.replace(/\n/g,"  "),e=e.replace(/"/g,'""'),e=e.replace(/#/g,"%23"),e.includes(",")&&(e=`"${e}"`),r+=e+l.columnDelimiter}r=r.trim().substring(0,r.length-1),r+=l.lineDelimiter}r=r.trim().substring(0,r.length-1),l.download&&(r=`data:text/csv;charset=utf-8,${r}`)}else if("sql"===l.type){for(r=`INSERT INTO \`${l.tableName}\` (`,n=0;n<t.length;n++)!l.skipColumn.includes(t[n].originalCellIndex)&&this.columns(t[n].originalCellIndex).visible()&&(r+=`\`${t[n].textContent}\`,`);for(r=r.trim().substring(0,r.length-1),r+=") VALUES ",n=0;n<s.length;n++){for(r+="(",a=0;a<s[n].cells.length;a++)!l.skipColumn.includes(t[a].originalCellIndex)&&this.columns(t[a].originalCellIndex).visible()&&(r+=`"${s[n].cells[a].textContent}",`);r=r.trim().substring(0,r.length-1),r+="),"}r=r.trim().substring(0,r.length-1),r+=";",l.download&&(r=`data:application/sql;charset=utf-8,${r}`)}else if("json"===l.type){for(a=0;a<s.length;a++)for(i[a]=i[a]||{},n=0;n<t.length;n++)!l.skipColumn.includes(t[n].originalCellIndex)&&this.columns(t[n].originalCellIndex).visible()&&(i[a][t[n].textContent]=s[a].cells[n].textContent);r=JSON.stringify(i,l.replacer,l.space),l.download&&(r=`data:application/json;charset=utf-8,${r}`)}return l.download&&(l.filename=l.filename||"datatable_export",l.filename+=`.${l.type}`,r=encodeURI(r),o=document.createElement("a"),o.href=r,o.download=l.filename,document.body.appendChild(o),o.click(),document.body.removeChild(o)),r}}return!1}import(e){let t=!1;if(!A(e))return!1;const s={lineDelimiter:"\n",columnDelimiter:",",removeDoubleQuotes:!1,...e};if(s.data.length||A(s.data)){if("csv"===s.type){t={data:[]};const e=s.data.split(s.lineDelimiter);e.length&&(s.headings&&(t.headings=e[0].split(s.columnDelimiter),s.removeDoubleQuotes&&(t.headings=t.headings.map((e=>e.trim().replace(/(^"|"$)/g,"")))),e.shift()),e.forEach(((e,i)=>{t.data[i]=[];const n=e.split(s.columnDelimiter);n.length&&n.forEach((e=>{s.removeDoubleQuotes&&(e=e.trim().replace(/(^"|"$)/g,"")),t.data[i].push(e)}))})))}else if("json"===s.type){const e=(e=>{let t=!1;try{t=JSON.parse(e)}catch(e){return!1}return!(null===t||!Array.isArray(t)&&!A(t))&&t})(s.data);e&&(t={headings:[],data:[]},e.forEach(((e,s)=>{t.data[s]=[],Object.entries(e).forEach((([e,i])=>{t.headings.includes(e)||t.headings.push(e),t.data[s].push(i)}))})))}A(s.data)&&(t=s.data),t&&this.insert(t)}return!1}print(){const e=this.activeHeadings,t=this.activeRows,s=O("table"),i=O("thead"),n=O("tbody"),a=O("tr");e.forEach((e=>{a.appendChild(O("th",{html:e.textContent}))})),i.appendChild(a),t.forEach((e=>{const t=O("tr");Array.from(e.cells).forEach((e=>{t.appendChild(O("td",{html:e.textContent}))})),n.appendChild(t)})),s.appendChild(i),s.appendChild(n);const r=window.open();r.document.body.appendChild(s),r.print()}setMessage(e){let t=1;this.hasRows?t=this.data[0].cells.length:this.activeHeadings.length&&(t=this.activeHeadings.length),this.wrapper.classList.add("dataTable-empty"),this.label&&(this.label.innerHTML=""),this.totalPages=0,this.render("pager"),this.clear(O("tr",{html:`<td class="dataTables-empty" colspan="${t}">${e}</td>`}))}columns(e){return new P(this,e)}rows(e){return new q(this,e)}on(e,t){this.events=this.events||{},this.events[e]=this.events[e]||[],this.events[e].push(t)}off(e,t){this.events=this.events||{},e in this.events!=!1&&this.events[e].splice(this.events[e].indexOf(t),1)}emit(e){if(this.events=this.events||{},e in this.events!=!1)for(let t=0;t<this.events[e].length;t++)this.events[e][t].apply(this,Array.prototype.slice.call(arguments,1))}}class j{pos=0;throttle=!1;menu=null;constructor(e,t={}){if(!e)return;if("object"!=typeof t)return;const s={menu:null,container:null,offset:0,activeClass:"active",menuItemClass:"nav-item",smoothScroll:{}};(t=Object.assign({},s,t)).smoothScroll=!0===t.smoothScroll&&{}||t.smoothScroll,this.options=Object.assign({},s,t),this.menu=t.menu instanceof HTMLElement?t.menu:document.querySelector(t.menu),this.scrolltarget=this.options.container?this.options.container instanceof HTMLElement?this.options.container:document.querySelector(this.options.container):window,this.scrollListener(e)}scrollListener(e){this.scrolltarget.addEventListener("scroll",(t=>{this.pos=this.scrolltarget.scrollY,this.throttle||this.scrolltarget.requestAnimationFrame((()=>{e(this.pos),this.throttle=!1})),this.throttle=!0}))}}const M=e=>[...e.parentElement.children].indexOf(e),R=e=>{const t=M(e);return e.closest("table").querySelector("thead > tr ").querySelectorAll("th")[t]},D=(e,t)=>{const s=e.parentElement.querySelector(t);return s?M(s):s};let N;class ${imports=[];inputnames={};taxos=["preset","extra"];importcontainer;importzoneid;importid="importzone";button;constructor(e){if(!e)return;const t={importcontainer:"#data-import",button:"#submit-import",action:"data-import"};return this.doc=e instanceof HTMLElement?e:document.querySelector(e),this.importcontainer=t.importcontainer instanceof HTMLElement?t.importcontainer:document.querySelector(t.importcontainer),this.form=t.form?t.form instanceof HTMLElement?t.form:document.querySelector(t.form):this.doc.closest("form"),this.button=t.button instanceof HTMLElement?t.button:document.querySelector(t.button),N=this,N||(N=this),N.init(),N}init(e,t){let s=this.form.querySelector("#projid");s&&s.value&&(s=this.doc.querySelector('[data-id="'+s.value+'"]'),s&&s.parentElement.classList.add("hide"));this.doc.querySelectorAll("button.is, input.is").forEach((e=>{const t="input"===e.tagName.toLowerCase()?"change":"click",s=e=>{const t=e.currentTarget,s=Array.from(t.parentElement.children).indexOf(t);this.toImport(t.parentElement,s)};e.removeEventListener(t,s,!1),e.addEventListener(t,s,!1)})),this.button&&(this.button.disabled=!0)}toImport(e,t=null){"td"!==e.parentElement.tagName.toLowerCase()&&(e=e.closest("th"));const s=R(e),i=s.dataset.what;if(!i)return;const n=s.dataset.whatparts?s.dataset.whatparts.split(","):null,a=e.parentElement.children,r=s.parentElement.children;let o=null;"settings"!==i&&"privileges"!==i||(o=s.parentElement.querySelector('[data-name="contact"]'),o&&(o=M(o),o=a[o].textContent.trim())),Object.entries(r).forEach((([e,r])=>{if(e>0){const l=a[e];let d=!r.dataset.name||null!==n&&n[t]!==r.dataset.name?null:r.dataset.name;if(d&&(this.inputnames[d]=r.dataset.inputname?r.dataset.inputname:d),d)switch(i){case"privileges":"privileges"===d&&this.renderPrivileges(l,d,o);break;case"taxo":if(!this.inputnames[d])return;const e=this.createImportzone(s),t=e.tomselect;let i=l.innerHTML.trim().split(", "),n=D(r,'[data-name="'+r.dataset.autocomplete+'"]');if(null!==n){if(n=a[n].innerHTML.trim(),""===n)return;if(n=n.split(",").sort(),t)n.forEach(((e,s)=>{let n={};n[t.settings.valueField]=e,n[t.settings.labelField]=i[s],t.addOption(n),t.addItem(n[t.settings.valueField])}));else{let t="";n.forEach(((e,s)=>{t+='<option value="'+e+'" selected>'+i[s]+"</option>"})),e.innerHTML=t,t=null}n=i=null}break;default:if("privileges"===d)this.renderPrivileges(l,d,o);else{let e=l.firstChild?l.firstChild.textContent:l.textContent;r.dataset.autocomplete?(this.imports[d]={value:e,key:null},e=D(r,'[data-name="'+r.dataset.autocomplete+'"]'),null!==e&&(e=a[e],e=e.firstChild?e.firstChild.textContent:e.textContent,this.imports[d].key=e.trim())):this.imports[d]=e.trim()}}else console.log("name  "+d,t)}})),r.length&&(this.button&&"taxo"==i?(this.button.classList.remove("hide"),this.button.disabled=!1,this.button.addEventListener("click",(e=>{this.makeImport(i,!0),this.button.disabled=!0}))):"privileges"===i?this.dismiss():this.makeImport(i,!0))}renderPrivileges(e,t,s){const i=new E;let n=i.clearAll(!0),a=!1;e.querySelectorAll("ul").forEach((e=>{const t=e.dataset.r;t&&e.querySelectorAll("li").forEach((e=>{a&&(n=i.newLine(!0)),a=!0;const r=e.dataset.u;r&&i.setLine(n,{key:r,value:e.textContent.trim()},t,s===r)}))}))}createImportzone(e){const t=this.form.querySelector('[name="'+e.dataset.inputname+'"]'),s=t.tomselect;let i=this.importcontainer.querySelector("#"+this.importid);if(!i){if(!t)return;if(this.importzoneid=t.id,i=t.cloneNode(),i.classList.remove("tomselected"),i.classList.remove("ts-hidden-accessible"),i.dataset.origin=i.id,i.id=this.importid,i.name=this.importid+"_"+i.name,this.importcontainer.insertAdjacentHTML("afterbegin",i.outerHTML),s){i=this.importcontainer.querySelector("#"+this.importid);(new L).apply(i),i.tomselect.lock()}}return i}makeImport(e,t=!1){let s=!1;if("taxo"===e){const e=this.importcontainer.querySelector("#"+this.importid);if(!e)return!1;const i=this.form.querySelector("#"+e.dataset.origin);if(!i)return!1;const n=e.tomselect;n?n.items.forEach(((e,t)=>{let s={};s[n.settings.valueField]=e,s[n.settings.labelField]=n.getItem(e).children[1].innerHTML.trim(),i.tomselect.addOption(s),i.tomselect.addItem(e)})):i.innerHTML=e.innerHTML,1==t&&(n&&(n.clear(),n.destroy()),e.innerHTML=""),s=!0}else Object.entries(this.inputnames).forEach((([t,i])=>{let n=this.form.querySelector('[name="'+i+'"]');if(n&&void 0!==this.imports[t]){if(n.tomselect){let e={};e[n.tomselect.settings.valueField]=this.imports[t].key,e[n.tomselect.settings.labelField]=this.imports[t].value,n.tomselect.addOption(e),n.tomselect.addItem(e[n.tomselect.settings.valueField]),n.tomselect.sync()}else{n.type?n.type:n.tagName.toLowerCase();switch(n.type){case"radio":case"checkbox":n=this.form.querySelector('[name="'+i+'"][value="'+this.imports[t]+'"]'),n&&(n.checked=!0);break;case"select":let e;e=this.imports[t].key?'<option value="'+this.imports[t].key+'" selected >'+this.imports[t].value+"</option>":'<option value="'+this.imports[t]+'" selected >'+this.imports[t]+"</option>",n.insertAdjacentHTML("beforeend",e);break;default:if(n.value=this.imports[t],"init_classif_list"===t){const e=document.querySelector("#inittaxo"),s=e.tomselect,i=this.imports[t].replace("[","").replace("]","").replaceAll(" ","");s&&e.tomselect.wrapper.classList.add("wait-for-results");const n="/gui/search/taxoset/";let a=new FormData;a.append("ids",i),console.log("ids",i),fetch(n,{method:"POST",body:a}).then((e=>e.json())).then((t=>{if(s)t.forEach((e=>{let t={};t[s.settings.valueField]=e[0],t[s.settings.labelField]=e[1].replace("<","&#60;"),s.addOption(t),s.addItem(t[s.settings.valueField])}));else{let s="";t.forEach((e=>{s+='<option value ="'+e[0]+'" selected>'+e[1]+"</option>"})),e.innerHTML=s,s=""}t=null,s&&e.tomselect.wrapper.classList.remove("wait-for-results")}))}}}"settings"!==e&&n.focus(),s=!0,this.setImportedTag(n)}}));!0===s&&1==t&&this.dismiss()}setImportedTag(e){let t=e.closest(".form-box");if(!t)return;t.dataset.isimported=this.form.dataset.isimported,t.classList.add("imported");const s=i=>{t.removeAttribute("data-isimported"),t.classList.remove("imported"),e.removeEventListener("change keydown",s)};e.addEventListener("change keydown",s)}dismiss(){const e=this.doc.closest("details");e&&(e.open=!1,e.querySelector(".modal-content").innerHTML="")}}let V=null;class z{handlers=[];form=null;listener=null;constructor(e,t={}){if(!V){if(!e)return;const s={};this.options=Object.assign({},s,t),this.form=e instanceof HTMLElement?e:document.querySelector(e),V=this}return V}addHandler(e){this.handlers.push(e)}async submitHandler(){if(0===this.handlers.length)return!0;let e=!0;return await Promise.all(this.handlers.map((async t=>{const s=await t();e=e&&s}))),!0===e?this.handlers=[]:console.log(this.handlers),e}}class B{listener=null;trigger=null;modal=null;modalcontent=null;constructor(e){return this.modal||this.trigger&&this.trigger===e||(this.trigger=e,"help"===e.dataset.what?this.modal=document.querySelector("#modal-help",".modal-help"):e.dataset.target&&"unique"!==e.dataset.target?this.modal=document.querySelector("#"+e.dataset.target):this.modal=e.closest(".modal-container"),this.modalcontent=this.modal.querySelector(".modal-content"),this.addListeners()),this}addListeners(){const e=this.modal.querySelector("summary");e&&e.addEventListener("toggle",(t=>{const s=document.querySelector("body");e.setAttribute("aria-hidden",!this.modal.open),s.classList.toggle("hidevscroll"),this.toggleAction(e)}))}setContent(e){return e=e instanceof HTMLElement?e.outerHTML:e,this.modalcontent.innerHTML=e,this.modalcontent}getContentSiblings(){return this.modal.querySelectorAll("details")}getBySelector(e){return this.modal.querySelector(e)}modalOpen(){this.modal.open=!0,this.toggleAction(this.trigger)}toggleAction(e){const t=this.modal.querySelector("summary");let s;(e===t||e.dataset.for)&&(s=e.dataset.action,t.dataset.action=0===s.indexOf("close-")?s.replace("close-",""):"close-"+s,e.dataset.for&&(s=e.dataset.action,null!==s&&(e.dataset.action=0===s.indexOf("close-")?s.replace("close-",""):"close-"+s)))}dismissModal(e=!1,t=null){if(e){this.modal.querySelector(t||".modal-content").innerHTML=""}this.trigger.dataset.for&&(this.modal.open=!1,this.toggleAction(this.trigger))}}class K{apply(e=document){if(!e)return;let t;t=e.querySelectorAll("[data-action]"),this.activateActions(t),t=e.querySelectorAll(".alert [data-dismiss], .alert-confirm"),this.activateDismisses(t)}async activateActions(e){let t;e.forEach((async e=>{const s=e.dataset.event||"click";e.addEventListener(s,(async s=>{switch(s.currentTarget.dataset.action){case"submit":s.preventDefault();let a=e.dataset.target?document.querySelector(e.dataset.target):e.closest("form");if(!a)return;const r=new z(a),o=await r.submitHandler();if(!r||o){let e=new FormData(a);for(var[i,n]of e.entries())console.log(i,n);a.submit()}break;case"restore-inpl":document.querySelector(e.dataset.tparentget).append();break;case"gotop":s.preventDefault();const l=e.dataset.target?document.querySelector("#"+e.dataset.target):window;null!==l&&l.scrollTo({top:0,behavior:"smooth"});break;case"dismiss":s.preventDefault();const d=e.dataset.target?e.closest(e.dataset.target):e.parentElement;d&&d.remove();break;case"add-filters":e.addEventListener("click",(t=>{let s=e.closest(".ghost-form");s=s.querySelectorAll("input");let i=e.href;return i=i.split("?"),i[1]=[],s.forEach((e=>{e.checked&&i[1].push(e.name+"="+e.value)})),e.href=i[0]+"?"+i[1].join("&"),!0}));break;case"close-request":t=new B(e),t&&t.dismissModal();break;case"request":const c=(e,s)=>{let i,n=s.dataset.format?s.dataset.format:"html",a=null;switch(s.dataset.what){case"help":t=new B(s);const r=t.modal;let o=null;if(!r)return;s.dataset.for&&(o=e=>{t.getContentSiblings().forEach((e=>{e!==d&&e.removeAttribute("open")})),t.getBySelector("#"+e).open=!0});const l=s.dataset.file?s.dataset.file!==r.dataset.currentfile?s.dataset.file:null:r.dataset.file,d=s.dataset.target?document.querySelector("#"+s.dataset.target+" article"):t?t.getBySelector("#main-help article"):s.closest(".modal-help")?s.closest(".modal-help").querySelector("#main-help article"):null;if(!d)return;d&&l?(i="/gui/help/"+l+"?"+new URLSearchParams({partial:!0}),a=e=>{e=e instanceof HTMLElement?e.outerHTML:e,r.dataset.currentfile=l,d.innerHTML=e,this.apply(d),o&&(o(s.dataset.for),t.modalOpen())}):null===l&&o&&(o(s.dataset.for),t.modalOpen());break;case"about":const c=s.closest("tr").querySelector("[data-id]");if(!c)return;i="/gui/prj/about/"+c.dataset.id+"?"+new URLSearchParams({partial:!0}),n="html",a=e=>{let t=s.nextSibling;const i=s.parentElement;if(i.hasAttribute("open"))if(null!==t)t.classList.remove("hidden");else{t=document.createElement("div");let n="";const a=s.closest("td");if(a){let e=R(a);e&&(e=e.parentElement.querySelector('[data-name="description"]'),e&&(e=M(e),n=a.closest("tr").querySelectorAll("td")[e].contentText))}e=e instanceof HTMLElement?e.outerHTML:e,t.insertAdjacentHTML("beforeend",'<div class="about">'+(""===n?"":"<div>"+n+"</div>")+e+"</div><span data-action=dismiss data-target=tr.about></span>"),i.append(t)}else t&&t.classList.add("hidden")};break;case"settings":t=new B(s),i="/gui/prj/importsettings?"+new URLSearchParams({prjid:s.dataset.projid?s.dataset.projid:"",typeimport:s.dataset.key?s.dataset.key:"settings"}),a=e=>{const s=t.setContent(e);(new Q).apply(s),t.modal.hasAttribute("open")||(t.modal.open=!0)};break;case"taxo":t=new B(s),e.preventDefault(),i="/gui/search/taxotreejson?"+new URLSearchParams({id:"#",targetid:s.dataset.targetid?s.dataset.targetid:""});t.setContent("<h3>Hierarchy</h3><div></div>");n="json",a=e=>{t.modalOpen()}}a&&("json"===n?fetch(i).then((e=>e.json())).then((e=>{a(e)})):fetch(i).then((e=>e.text())).then((e=>{a(e)})).catch((e=>{console.log("request",e)})))};c(s,e);break;case"alert-confirm":e.addEventListener(e.dataset.event?e.dataset.event:"click",(()=>{(new y).build(e.dataset.message?e.dataset.message:"Warning","confirm",e.id?e.id:null,{dismissible:!0,callback:()=>{e.dataset.unlock&&!0===e.dataset.unlock&&(e.disabled=!1)}})}))}}))}))}activateDismisses(e){0!==e.length&&e.forEach((e=>{(e=e.closest(".alert"))&&((e=new y(e)).box.classList.contains("alert-confirm")?e.waitForAnswer():e.dismissListener())}))}}class Q{async apply(e=document){e&&await this.activate(e)}async activate(e){e.querySelectorAll(".js").forEach((async e=>{e.classList.forEach((async t=>{if(0===t.indexOf("js-"))switch(t){case"js-scrollspy":let t=e.dataset.threshold?e.dataset.threshold:100;"hscreen"===t&&(t=screen.height);new j((s=>{s>t&&!e.classList.contains("scrollspy")?e.classList.add("scrollspy"):e.classList.remove("scrollspy")}),{menu:e,container:null,offset:0,activeClass:"active",menuItemClass:"nav-item"});break;case"js-privacy":document.querySelectorAll(".RDOpt").forEach((e=>e.addEventListener("click",(e=>{fetch("/setprivacy/"+e.target.value).then((e=>e.text())).then((e=>{location.reload(!0)}))}))));break;case"js-datatable":const s=!e.dataset.paging||e.dataset.paging,i=new H(e,{searchable:!0,fixedHeight:!1,paging:s,perPage:e.dataset.perpage?e.dataset.perpage:100,perPageSelect:!1,layer:{top:"{info}{search}",bottom:"{pager}{pagination}"}});i.on("datatable.init",(async()=>{e.style.top=e.offsetTop+"px";const t=i.wrapper.querySelector(".dataTable-input");t&&t.classList.add("form-input");let s=i.wrapper.querySelector(".dataTable-filters");const n=i.wrapper.querySelector(".dataTable-top");s&&n&&(s=n.prepend(s));e.querySelectorAll("th");const a=e.closest(".modal-title");if(null!==a){const e=document.querySelector(".dataTable-top");a.parentElement.insertBefore(e,a)}if(e.dataset.caption&&e.querySelector("caption")&&(e.querySelector("caption").contentText=e.dataset.caption),e.dataset.import){new $(e)}(new K).apply(e)})),e.classList.remove("js-datatable");break;case"js-hierarchy":case"js-observer":break;case"js-accordion":const n=document.querySelector(".modal-container");if(null===n)return;const a=n.querySelector(".modal");if(null===a)return["snap-y","snap-mandatoy"].forEach((e=>a.classList.add(e)));n.querySelectorAll("details").forEach((e=>{["snap-always","snap-top"].forEach((t=>{e.classList.add(t)}))}));break;case"js-autocomplete":(new L).apply(e);break;case"js-privilege":const r=new E,o=async()=>await r.submitPrivileges(),l=e.closest("form");new z(l).addHandler(o);break;case"js-tabs":let d=e.querySelectorAll(".tab-control");0===d.length&&(d=e.querySelectorAll("legend"));let c=0;d.forEach(((t,s)=>{const i=t.dataset.target?e.querySelector("#"+t.dataset.target):t.closest(".tab");if(!i)return;const n=(e,t)=>{e.querySelectorAll(".tab-content").forEach((e=>{!0===t?e.classList.remove("hide"):e.classList.add("hide")}))};t.style.left=c+"px",0===s?(i.classList.add("active"),n(i,!0)):n(i,!1),c+=parseInt(t.offsetWidth)+20,t.addEventListener("click",(e=>{if(e.target.disabled)return void e.preventDefault();const t=i.parentElement.querySelector(".active");t&&t.classList.remove("active"),n(t,!1),i.classList.add("active"),n(i,!0)}))}));const h=e.querySelector('[data-dismiss="tabs"]');h&&h.addEventListener("click",(t=>{let s;e.classList.contains("js-tabs")?(e.classList.remove("js-tabs"),d.forEach((e=>e.disabled=!0)),s=e.querySelector(".icon-arrow-pointing-out"),s.classList.remove("icon-arrow-pointing-out"),s.classList.add("icon-arrow-pointing-in")):(e.classList.add("js-tabs"),d.forEach((e=>e.disabled=!1)),s=e.querySelector(".icon-arrow-pointing-in"),s.classList.remove("icon-arrow-pointing-in"),s.classList.add("icon-arrow-pointing-out"))}))}}))}))}}var U=sessionStorage;window.addEventListener("load",(async()=>{document.querySelectorAll("nav .dropdown").forEach((e=>{e.addEventListener("click",(t=>{t.preventDefault(),e.classList.toggle("over")}))}));document.querySelectorAll("[href]").forEach((e=>{if(e.classList.contains("experimental"))return;let t=e.getAttribute("href");t.indexOf("/static")<0&&t.indexOf("//")<0&&0!==t.indexOf("/gui/")&&0!==t.indexOf("#")&&t.indexOf("mailto:")<0&&(e=>{if((e=e.split("prj/")).length>1)if(e[1]=e[1].split("/"),e[1].length>1)switch(e[1][0].trim()){case"edit":case"prjall":case"":return!0}else switch(e[1][0].trim()){case"create":case"edit":case"login":case"about":case"privacy":return!0}return!1})(t)&&e.setAttribute("href","/gui"+t)}));const e=new Q;await e.apply();(new K).apply(document),document.querySelectorAll("form").forEach((e=>{e.querySelectorAll("input,textarea, select").forEach((e=>{if("instr"===e.dataset.validate){const t=e.value;console.log("instr_from_prj",t)}}))}))})),window.addEventListener("unload",(e=>{U.clear()}))})()})();