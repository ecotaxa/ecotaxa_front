/*! For license information please see src_modules_project-privileges_js.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["src_modules_project-privileges_js"],{"./src/modules/form-submit.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   FormSubmit: () => (/* binding */ FormSubmit)\n/* harmony export */ });\n/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! dompurify */ \"./node_modules/dompurify/dist/purify.js\");\n/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(dompurify__WEBPACK_IMPORTED_MODULE_0__);\n\n\nlet instance = null;\nconst formcss = {\n  invalid: 'invalid',\n  inputvalidate: 'input-validate'\n}\nclass FormSubmit {\n  handlers = [];\n  form = null;\n  listener = null;\n  constructor(form, options = {}) {\n    if (!instance) {\n      if (!form) return;\n      const defaultOptions = {};\n      this.options = Object.assign(defaultOptions, options);\n      this.form = form instanceof HTMLElement ? form : document.querySelector(form);\n      if (!this.form) return;\n      this.validateFields(true);\n      this.init();\n      instance = this;\n    }\n    return instance;\n  }\n  init() {\n\n    // init the form ( options like beforeunload etc...)\n    this.form.addEventListener('submit', async (e) => {\n      const res = await this.submitForm();\n      e.preventDefault();\n    });\n    if (this.form.dataset.captcha) {\n      const captcha_handler = async function() {\n        const token = grecaptcha.getResponse();\n        console.log('token ', token)\n        document.getElementById('g-recaptcha-response').value = token;\n        return true;\n      }\n      this.handlers.push(captcha_handler);\n\n    }\n    this.specialFields();\n  }\n  specialFields() {\n    // check if there is a password confirm input\n    this.form.querySelectorAll('input[data-match]').forEach(input => {\n      //\n      const match = input.dataset.match;\n      if (!match) return;\n      const target = document.getElementById(match);\n      if (!target) return;\n      const invalid = (input.dataset.matchinvalid) ? input.dataset.matchinvalid : \"no match\";\n      const label = input.closest('label');\n      const check_match = (item, itemtarget) => {\n        if (item.value !== itemtarget.value) {\n          item.setCustomValidity(invalid);\n          itemtarget.setCustomValidity(invalid);\n          if (input != item) {\n            if (label) label.classList.add(formcss.invalid);\n            input.classList.add(formcss.inputvalidate);\n          }\n        } else {\n          item.setCustomValidity(\"\");\n          itemtarget.setCustomValidity(\"\");\n          item.dataset.invalid = '';\n          itemtarget.dataset.invalid = '';\n          if (input != item) {\n            if (label) label.classList.remove(formcss.invalid);\n            input.classList.remove(formcss.inputvalidate);\n\n          }\n        }\n        item.reportValidity();\n        itemtarget.reportValidity();\n        item.focus();\n      };\n      [input, target].forEach(item => {\n        item.addEventListener('keyup', (e) => {\n          const itemtarget = (item === input) ? target : input;\n          check_match(item, itemtarget);\n        });\n      });\n\n    });\n  }\n\n  validateField(field) {\n\n    const get_message = (field, type) => {\n      let message = 'invalid';\n      if (field.required) message = (field.dataset.required) ? field.dataset.required : ((this.form.dataset.required) ? this.form.dataset.required : 'invalid');\n      if (message === 'invalid') message = (field.dataset.invalid) ? field.dataset.invalid : ((this.form.dataset.invalid) ? this.form.dataset.invalid : 'invalid input');\n      return message;\n    }\n    if (['textarea', 'input'].indexOf(field.tagName.toLowerCase()) >= 0) {\n      field.value = dompurify__WEBPACK_IMPORTED_MODULE_0___default().sanitize(field.value);\n    }\n\n    const rep = field.checkValidity();\n    if (field.classList.contains('select-one')) {\n      console.log('select rep', rep);\n    }\n    const label = field.closest('.form-box') ? field.closest('.form-box').querySelector('label') : null;\n\n    if (rep && label) label.classList.remove(formcss.invalid);\n\n    else if (!rep) {\n      if (label) {\n        label.dataset.invalid = get_message(field);\n        label.classList.add(formcss.invalid);\n        window.scrollTo({\n          top: parseInt(label.offsetTop),\n          left: parseInt(label.offsetLeft),\n          behavior: 'smooth'\n        });\n      }\n\n    }\n    return rep;\n  }\n\n  validateFields(init = false) {\n    //todo: complete validation foreach field type\n    let resp = true;\n    // .required input for tom-select component\n    this.form.querySelectorAll('input,textarea, select').forEach(field => {\n\n      if (init === true) {\n\n        if (!field.dataset.listen) {\n          if (field.hasAttribute('required') && field.required) {\n            const label = field.closest('.form-box') ? field.closest('.form-box').querySelector('label') : field.parentElement.querySelector('label');\n            if (label) label.classList.add('required');\n          }\n\n          ['change', 'blur'].forEach(evt => {\n            field.addEventListener(evt, (e) => {\n              this.validateField(e.currentTarget);\n            });\n          });\n          field.dataset.listen = true;\n        }\n      } else resp = (resp && this.validateField(field));\n    });\n    return resp;\n  }\n\n  addHandler(handler) {\n    this.handlers.push(handler);\n  }\n  fieldEnable() {\n    this.form.querySelectorAll('input[data-sub=\"enable\"]').forEach(input => {\n      input.removeAttribute('disabled');\n    });\n  }\n  async submitHandler() {\n    if (!this.validateFields()) return false;\n    if (this.handlers.length === 0) return true;\n    let resp = true;\n    // series\n    /*  for (const handler of this.handlers) {\n          const rep = await handler()\n          resp = (resp && rep)\n      }*/\n    // concurrent\n    await Promise.all(this.handlers.map(async handler => {\n      const rep = await handler();\n      resp = (resp && rep);\n    }));\n    if (resp === true) this.handlers = [];\n    console.log('resp', resp)\n    return resp;\n  }\n  async submitForm() {\n    if (this.validateFields(false)) {\n      const yessubmit = await this.submitHandler();\n      if (yessubmit) {\n        this.fieldEnable();\n        this.form.submit();\n      } else return false;\n    } else return false;\n  }\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvbW9kdWxlcy9mb3JtLXN1Ym1pdC5qcy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBa0M7QUFDQTtBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0M7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsT0FBTzs7QUFFUCxLQUFLO0FBQ0w7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IseURBQWtCO0FBQ3RDOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixXQUFXO0FBQ1g7QUFDQTtBQUNBLFFBQVE7QUFDUixLQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSLE1BQU07QUFDTjtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vc3JjL21vZHVsZXMvZm9ybS1zdWJtaXQuanM/YzZiNyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdmFsaWRhdG9yIGZyb20gJ3ZhbGlkYXRvcic7XG5pbXBvcnQgRE9NUHVyaWZ5IGZyb20gJ2RvbXB1cmlmeSc7XG5sZXQgaW5zdGFuY2UgPSBudWxsO1xuY29uc3QgZm9ybWNzcyA9IHtcbiAgaW52YWxpZDogJ2ludmFsaWQnLFxuICBpbnB1dHZhbGlkYXRlOiAnaW5wdXQtdmFsaWRhdGUnXG59XG5leHBvcnQgY2xhc3MgRm9ybVN1Ym1pdCB7XG4gIGhhbmRsZXJzID0gW107XG4gIGZvcm0gPSBudWxsO1xuICBsaXN0ZW5lciA9IG51bGw7XG4gIGNvbnN0cnVjdG9yKGZvcm0sIG9wdGlvbnMgPSB7fSkge1xuICAgIGlmICghaW5zdGFuY2UpIHtcbiAgICAgIGlmICghZm9ybSkgcmV0dXJuO1xuICAgICAgY29uc3QgZGVmYXVsdE9wdGlvbnMgPSB7fTtcbiAgICAgIHRoaXMub3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oZGVmYXVsdE9wdGlvbnMsIG9wdGlvbnMpO1xuICAgICAgdGhpcy5mb3JtID0gZm9ybSBpbnN0YW5jZW9mIEhUTUxFbGVtZW50ID8gZm9ybSA6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZm9ybSk7XG4gICAgICBpZiAoIXRoaXMuZm9ybSkgcmV0dXJuO1xuICAgICAgdGhpcy52YWxpZGF0ZUZpZWxkcyh0cnVlKTtcbiAgICAgIHRoaXMuaW5pdCgpO1xuICAgICAgaW5zdGFuY2UgPSB0aGlzO1xuICAgIH1cbiAgICByZXR1cm4gaW5zdGFuY2U7XG4gIH1cbiAgaW5pdCgpIHtcblxuICAgIC8vIGluaXQgdGhlIGZvcm0gKCBvcHRpb25zIGxpa2UgYmVmb3JldW5sb2FkIGV0Yy4uLilcbiAgICB0aGlzLmZvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgYXN5bmMgKGUpID0+IHtcbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuc3VibWl0Rm9ybSgpO1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH0pO1xuICAgIGlmICh0aGlzLmZvcm0uZGF0YXNldC5jYXB0Y2hhKSB7XG4gICAgICBjb25zdCBjYXB0Y2hhX2hhbmRsZXIgPSBhc3luYyBmdW5jdGlvbigpIHtcbiAgICAgICAgY29uc3QgdG9rZW4gPSBncmVjYXB0Y2hhLmdldFJlc3BvbnNlKCk7XG4gICAgICAgIGNvbnNvbGUubG9nKCd0b2tlbiAnLCB0b2tlbilcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ctcmVjYXB0Y2hhLXJlc3BvbnNlJykudmFsdWUgPSB0b2tlbjtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICB0aGlzLmhhbmRsZXJzLnB1c2goY2FwdGNoYV9oYW5kbGVyKTtcblxuICAgIH1cbiAgICB0aGlzLnNwZWNpYWxGaWVsZHMoKTtcbiAgfVxuICBzcGVjaWFsRmllbGRzKCkge1xuICAgIC8vIGNoZWNrIGlmIHRoZXJlIGlzIGEgcGFzc3dvcmQgY29uZmlybSBpbnB1dFxuICAgIHRoaXMuZm9ybS5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dFtkYXRhLW1hdGNoXScpLmZvckVhY2goaW5wdXQgPT4ge1xuICAgICAgLy9cbiAgICAgIGNvbnN0IG1hdGNoID0gaW5wdXQuZGF0YXNldC5tYXRjaDtcbiAgICAgIGlmICghbWF0Y2gpIHJldHVybjtcbiAgICAgIGNvbnN0IHRhcmdldCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1hdGNoKTtcbiAgICAgIGlmICghdGFyZ2V0KSByZXR1cm47XG4gICAgICBjb25zdCBpbnZhbGlkID0gKGlucHV0LmRhdGFzZXQubWF0Y2hpbnZhbGlkKSA/IGlucHV0LmRhdGFzZXQubWF0Y2hpbnZhbGlkIDogXCJubyBtYXRjaFwiO1xuICAgICAgY29uc3QgbGFiZWwgPSBpbnB1dC5jbG9zZXN0KCdsYWJlbCcpO1xuICAgICAgY29uc3QgY2hlY2tfbWF0Y2ggPSAoaXRlbSwgaXRlbXRhcmdldCkgPT4ge1xuICAgICAgICBpZiAoaXRlbS52YWx1ZSAhPT0gaXRlbXRhcmdldC52YWx1ZSkge1xuICAgICAgICAgIGl0ZW0uc2V0Q3VzdG9tVmFsaWRpdHkoaW52YWxpZCk7XG4gICAgICAgICAgaXRlbXRhcmdldC5zZXRDdXN0b21WYWxpZGl0eShpbnZhbGlkKTtcbiAgICAgICAgICBpZiAoaW5wdXQgIT0gaXRlbSkge1xuICAgICAgICAgICAgaWYgKGxhYmVsKSBsYWJlbC5jbGFzc0xpc3QuYWRkKGZvcm1jc3MuaW52YWxpZCk7XG4gICAgICAgICAgICBpbnB1dC5jbGFzc0xpc3QuYWRkKGZvcm1jc3MuaW5wdXR2YWxpZGF0ZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGl0ZW0uc2V0Q3VzdG9tVmFsaWRpdHkoXCJcIik7XG4gICAgICAgICAgaXRlbXRhcmdldC5zZXRDdXN0b21WYWxpZGl0eShcIlwiKTtcbiAgICAgICAgICBpdGVtLmRhdGFzZXQuaW52YWxpZCA9ICcnO1xuICAgICAgICAgIGl0ZW10YXJnZXQuZGF0YXNldC5pbnZhbGlkID0gJyc7XG4gICAgICAgICAgaWYgKGlucHV0ICE9IGl0ZW0pIHtcbiAgICAgICAgICAgIGlmIChsYWJlbCkgbGFiZWwuY2xhc3NMaXN0LnJlbW92ZShmb3JtY3NzLmludmFsaWQpO1xuICAgICAgICAgICAgaW5wdXQuY2xhc3NMaXN0LnJlbW92ZShmb3JtY3NzLmlucHV0dmFsaWRhdGUpO1xuXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGl0ZW0ucmVwb3J0VmFsaWRpdHkoKTtcbiAgICAgICAgaXRlbXRhcmdldC5yZXBvcnRWYWxpZGl0eSgpO1xuICAgICAgICBpdGVtLmZvY3VzKCk7XG4gICAgICB9O1xuICAgICAgW2lucHV0LCB0YXJnZXRdLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCAoZSkgPT4ge1xuICAgICAgICAgIGNvbnN0IGl0ZW10YXJnZXQgPSAoaXRlbSA9PT0gaW5wdXQpID8gdGFyZ2V0IDogaW5wdXQ7XG4gICAgICAgICAgY2hlY2tfbWF0Y2goaXRlbSwgaXRlbXRhcmdldCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICB9KTtcbiAgfVxuXG4gIHZhbGlkYXRlRmllbGQoZmllbGQpIHtcblxuICAgIGNvbnN0IGdldF9tZXNzYWdlID0gKGZpZWxkLCB0eXBlKSA9PiB7XG4gICAgICBsZXQgbWVzc2FnZSA9ICdpbnZhbGlkJztcbiAgICAgIGlmIChmaWVsZC5yZXF1aXJlZCkgbWVzc2FnZSA9IChmaWVsZC5kYXRhc2V0LnJlcXVpcmVkKSA/IGZpZWxkLmRhdGFzZXQucmVxdWlyZWQgOiAoKHRoaXMuZm9ybS5kYXRhc2V0LnJlcXVpcmVkKSA/IHRoaXMuZm9ybS5kYXRhc2V0LnJlcXVpcmVkIDogJ2ludmFsaWQnKTtcbiAgICAgIGlmIChtZXNzYWdlID09PSAnaW52YWxpZCcpIG1lc3NhZ2UgPSAoZmllbGQuZGF0YXNldC5pbnZhbGlkKSA/IGZpZWxkLmRhdGFzZXQuaW52YWxpZCA6ICgodGhpcy5mb3JtLmRhdGFzZXQuaW52YWxpZCkgPyB0aGlzLmZvcm0uZGF0YXNldC5pbnZhbGlkIDogJ2ludmFsaWQgaW5wdXQnKTtcbiAgICAgIHJldHVybiBtZXNzYWdlO1xuICAgIH1cbiAgICBpZiAoWyd0ZXh0YXJlYScsICdpbnB1dCddLmluZGV4T2YoZmllbGQudGFnTmFtZS50b0xvd2VyQ2FzZSgpKSA+PSAwKSB7XG4gICAgICBmaWVsZC52YWx1ZSA9IERPTVB1cmlmeS5zYW5pdGl6ZShmaWVsZC52YWx1ZSk7XG4gICAgfVxuXG4gICAgY29uc3QgcmVwID0gZmllbGQuY2hlY2tWYWxpZGl0eSgpO1xuICAgIGlmIChmaWVsZC5jbGFzc0xpc3QuY29udGFpbnMoJ3NlbGVjdC1vbmUnKSkge1xuICAgICAgY29uc29sZS5sb2coJ3NlbGVjdCByZXAnLCByZXApO1xuICAgIH1cbiAgICBjb25zdCBsYWJlbCA9IGZpZWxkLmNsb3Nlc3QoJy5mb3JtLWJveCcpID8gZmllbGQuY2xvc2VzdCgnLmZvcm0tYm94JykucXVlcnlTZWxlY3RvcignbGFiZWwnKSA6IG51bGw7XG5cbiAgICBpZiAocmVwICYmIGxhYmVsKSBsYWJlbC5jbGFzc0xpc3QucmVtb3ZlKGZvcm1jc3MuaW52YWxpZCk7XG5cbiAgICBlbHNlIGlmICghcmVwKSB7XG4gICAgICBpZiAobGFiZWwpIHtcbiAgICAgICAgbGFiZWwuZGF0YXNldC5pbnZhbGlkID0gZ2V0X21lc3NhZ2UoZmllbGQpO1xuICAgICAgICBsYWJlbC5jbGFzc0xpc3QuYWRkKGZvcm1jc3MuaW52YWxpZCk7XG4gICAgICAgIHdpbmRvdy5zY3JvbGxUbyh7XG4gICAgICAgICAgdG9wOiBwYXJzZUludChsYWJlbC5vZmZzZXRUb3ApLFxuICAgICAgICAgIGxlZnQ6IHBhcnNlSW50KGxhYmVsLm9mZnNldExlZnQpLFxuICAgICAgICAgIGJlaGF2aW9yOiAnc21vb3RoJ1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgIH1cbiAgICByZXR1cm4gcmVwO1xuICB9XG5cbiAgdmFsaWRhdGVGaWVsZHMoaW5pdCA9IGZhbHNlKSB7XG4gICAgLy90b2RvOiBjb21wbGV0ZSB2YWxpZGF0aW9uIGZvcmVhY2ggZmllbGQgdHlwZVxuICAgIGxldCByZXNwID0gdHJ1ZTtcbiAgICAvLyAucmVxdWlyZWQgaW5wdXQgZm9yIHRvbS1zZWxlY3QgY29tcG9uZW50XG4gICAgdGhpcy5mb3JtLnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0LHRleHRhcmVhLCBzZWxlY3QnKS5mb3JFYWNoKGZpZWxkID0+IHtcblxuICAgICAgaWYgKGluaXQgPT09IHRydWUpIHtcblxuICAgICAgICBpZiAoIWZpZWxkLmRhdGFzZXQubGlzdGVuKSB7XG4gICAgICAgICAgaWYgKGZpZWxkLmhhc0F0dHJpYnV0ZSgncmVxdWlyZWQnKSAmJiBmaWVsZC5yZXF1aXJlZCkge1xuICAgICAgICAgICAgY29uc3QgbGFiZWwgPSBmaWVsZC5jbG9zZXN0KCcuZm9ybS1ib3gnKSA/IGZpZWxkLmNsb3Nlc3QoJy5mb3JtLWJveCcpLnF1ZXJ5U2VsZWN0b3IoJ2xhYmVsJykgOiBmaWVsZC5wYXJlbnRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ2xhYmVsJyk7XG4gICAgICAgICAgICBpZiAobGFiZWwpIGxhYmVsLmNsYXNzTGlzdC5hZGQoJ3JlcXVpcmVkJyk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgWydjaGFuZ2UnLCAnYmx1ciddLmZvckVhY2goZXZ0ID0+IHtcbiAgICAgICAgICAgIGZpZWxkLmFkZEV2ZW50TGlzdGVuZXIoZXZ0LCAoZSkgPT4ge1xuICAgICAgICAgICAgICB0aGlzLnZhbGlkYXRlRmllbGQoZS5jdXJyZW50VGFyZ2V0KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGZpZWxkLmRhdGFzZXQubGlzdGVuID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHJlc3AgPSAocmVzcCAmJiB0aGlzLnZhbGlkYXRlRmllbGQoZmllbGQpKTtcbiAgICB9KTtcbiAgICByZXR1cm4gcmVzcDtcbiAgfVxuXG4gIGFkZEhhbmRsZXIoaGFuZGxlcikge1xuICAgIHRoaXMuaGFuZGxlcnMucHVzaChoYW5kbGVyKTtcbiAgfVxuICBmaWVsZEVuYWJsZSgpIHtcbiAgICB0aGlzLmZvcm0ucXVlcnlTZWxlY3RvckFsbCgnaW5wdXRbZGF0YS1zdWI9XCJlbmFibGVcIl0nKS5mb3JFYWNoKGlucHV0ID0+IHtcbiAgICAgIGlucHV0LnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgICB9KTtcbiAgfVxuICBhc3luYyBzdWJtaXRIYW5kbGVyKCkge1xuICAgIGlmICghdGhpcy52YWxpZGF0ZUZpZWxkcygpKSByZXR1cm4gZmFsc2U7XG4gICAgaWYgKHRoaXMuaGFuZGxlcnMubGVuZ3RoID09PSAwKSByZXR1cm4gdHJ1ZTtcbiAgICBsZXQgcmVzcCA9IHRydWU7XG4gICAgLy8gc2VyaWVzXG4gICAgLyogIGZvciAoY29uc3QgaGFuZGxlciBvZiB0aGlzLmhhbmRsZXJzKSB7XG4gICAgICAgICAgY29uc3QgcmVwID0gYXdhaXQgaGFuZGxlcigpXG4gICAgICAgICAgcmVzcCA9IChyZXNwICYmIHJlcClcbiAgICAgIH0qL1xuICAgIC8vIGNvbmN1cnJlbnRcbiAgICBhd2FpdCBQcm9taXNlLmFsbCh0aGlzLmhhbmRsZXJzLm1hcChhc3luYyBoYW5kbGVyID0+IHtcbiAgICAgIGNvbnN0IHJlcCA9IGF3YWl0IGhhbmRsZXIoKTtcbiAgICAgIHJlc3AgPSAocmVzcCAmJiByZXApO1xuICAgIH0pKTtcbiAgICBpZiAocmVzcCA9PT0gdHJ1ZSkgdGhpcy5oYW5kbGVycyA9IFtdO1xuICAgIGNvbnNvbGUubG9nKCdyZXNwJywgcmVzcClcbiAgICByZXR1cm4gcmVzcDtcbiAgfVxuICBhc3luYyBzdWJtaXRGb3JtKCkge1xuICAgIGlmICh0aGlzLnZhbGlkYXRlRmllbGRzKGZhbHNlKSkge1xuICAgICAgY29uc3QgeWVzc3VibWl0ID0gYXdhaXQgdGhpcy5zdWJtaXRIYW5kbGVyKCk7XG4gICAgICBpZiAoeWVzc3VibWl0KSB7XG4gICAgICAgIHRoaXMuZmllbGRFbmFibGUoKTtcbiAgICAgICAgdGhpcy5mb3JtLnN1Ym1pdCgpO1xuICAgICAgfSBlbHNlIHJldHVybiBmYWxzZTtcbiAgICB9IGVsc2UgcmV0dXJuIGZhbHNlO1xuICB9XG59Il0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/modules/form-submit.js\n")},"./src/modules/project-privileges.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ProjectPrivileges: () => (/* binding */ ProjectPrivileges)\n/* harmony export */ });\n/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! dompurify */ \"./node_modules/dompurify/dist/purify.js\");\n/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(dompurify__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _modules_form_submit_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../modules/form-submit.js */ \"./src/modules/form-submit.js\");\n/* harmony import */ var _modules_alert_boxes_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../modules/alert-boxes.js */ \"./src/modules/alert-boxes.js\");\n/* harmony import */ var _modules_js_tom_select_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../modules/js-tom-select.js */ \"./src/modules/js-tom-select.js\");\n/* harmony import */ var _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../modules/modules-config.js */ \"./src/modules/modules-config.js\");\n// privileges of a project\n// line with member name , priviliege , is contact , and delete functionality\n\n\n\n\n\n\nconst codemessages = {\n  oneatleast: 'oneatleast',\n  nomanager: 'nomanager',\n  nocontact: 'nocontact',\n  uhasnopriv: 'uhasnopriv',\n  importpriverror: 'importpriverror',\n  emptyname: 'emptyname'\n}\nlet instance = null;\nclass ProjectPrivileges {\n  //TODO: rewrite to not depend on DOM select\n  options;\n  alertBox;\n  // current user id;\n  current_uid;\n  fieldset;\n  fieldset_alert_zone;\n  // unique users\n  constructor(options = {}) {\n    if (!instance) {\n      const defaultOptions = {\n        groupid: \"#section-privileges\",\n        separ: '.new-privilege',\n        addbtn: '[data-add=\"block\"]',\n        target: 'member',\n        ident: 'member',\n        privilege: 'privilege',\n        delet: 'delet',\n        contact: 'contact',\n        contactfieldname: 'contact_user_id',\n\n      };\n      this.options = Object.assign({}, defaultOptions, options);\n      this.fieldset = document.querySelector(this.options.groupid);\n      if (!this.fieldset) return;\n      this.fieldset_alert_zone = this.fieldset.querySelector('.tab-content') ? this.fieldset.querySelector('.tab-content') : this.fieldset;\n      this.options.separ = this.options.separ instanceof HTMLElement ? this.options.separ : (document.querySelector(this.options.separ) ? document.querySelector(this.options.separ) : null);\n      this.options.addbtn = this.options.addbtn instanceof HTMLElement ? this.options.addbtn : document.querySelector(this.options.addbtn);\n      if (this.options.addbtn) this.addListener();\n      const lines = this.fieldset.querySelectorAll('[data-block=\"' + this.options.target + '\"]');\n      this.current_uid = this.fieldset.dataset.u;\n      this.alertBox = new _modules_alert_boxes_js__WEBPACK_IMPORTED_MODULE_2__.AlertBox();\n      lines.forEach((line) => {\n        this.activateEvents(line);\n      });\n\n      //remove deleted , clean && validate datas , format names before sending the form\n      const form = this.fieldset.closest('form');\n      const formSubmit = new _modules_form_submit_js__WEBPACK_IMPORTED_MODULE_1__.FormSubmit(form);\n      // handler - verify privileges before settings form submit\n      const submit_privileges = async () => {\n        const resp = await this.cleanPrivileges();\n        return resp;\n      }\n      formSubmit.addHandler(submit_privileges);\n      instance = this;\n    }\n    return instance;\n  }\n\n  newLine(ret = false, check = 0) {\n    let line;\n    if (check > 0) {\n      line = this.getLinePrivilege(check);\n      if (line) return line;\n    }\n    const lines = this.fieldset.querySelectorAll('[data-block=\"' + this.options.target + '\"]');\n\n    if (lines.length === 0) return;\n    const n = lines.length - 1;\n    line = lines[n];\n    if (line !== null) {\n      line = this.clearLine(line.cloneNode(true), n, (this.options.separ ? this.options.separ : line));\n\n      this.activateEvents(line);\n\n    }\n    if (ret === true) return line;\n  }\n\n  addListener() {\n    this.options.target = (this.options.addbtn.dataset.target) ? this.options.addbtn.dataset.target : this.options.target;\n    this.options.addbtn.addEventListener('click', async (e) => {\n      e.preventDefault();\n      this.newLine();\n    })\n  }\n\n  clearLine(line, n, separ = null) {\n    /*clean line element */\n\n    let has_autocomplete = null;\n    line.dataset.mod = '';\n    line.disabled = false;\n    const elems = line.querySelectorAll('[data-elem]');\n    elems.forEach((elem) => {\n      // change loop index - necessary for tailwindcss peerchecked to work otherwise not if name ends with []\n      //remove components\n      const rms = elem.querySelectorAll('[data-component]')\n      rms.forEach((rm) => {\n        switch (rm.dataset.component) {\n          case 'tom-select':\n            rm.remove();\n            break;\n        }\n      })\n      // clean and reset events\n      const els = elem.querySelectorAll('input, select, label');\n      els.forEach((el) => {\n\n        el.disabled = false;\n        if (separ) { // change names and id when adding a new row - not if clear only\n          const keys = ['id', 'for', 'aria-controls', 'name'];\n          keys.forEach((key) => {\n            let val = el.getAttribute(key);\n            if (val !== null) {\n              if (key === 'name') val = val.replace('[' + n + ']', '[' + (n + 1) + ']');\n              else val = val.replace('_' + n, '_' + (n + 1));\n              el.setAttribute(key, val);\n            }\n          });\n        }\n        switch (el.tagName.toLowerCase()) {\n          case 'input':\n            //el.indeterminate = true;\n            el.checked = false;\n            // disable contact as privilege is empty\n            if (el.name == this.options.contactfieldname) {\n              el.value = \"0\";\n              el.disabled = true;\n            }\n            break;\n          case 'select':\n            el.selectedIndex = -1;\n            break;\n          case 'label':\n            el.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.peerchecked);\n            break;\n        }\n        if (el.tomselect) {\n          has_autocomplete = el;\n          el.tomselect.clear();\n          el.tomselect.destroy();\n\n        }\n        if (el.classList.contains(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.component.autocomplete.tomselected)) {\n          has_autocomplete = el;\n          el.classList.forEach(cl => {\n            if (cl.indexOf('ts-') == 0) el.classList.remove(cl);\n          })\n          el.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.component.autocomplete.tomselected);\n          if (el.type == \"select-one\") delete el.type;\n\n        }\n\n      })\n\n    })\n    /* add functionnalities */\n    if (separ) {\n      line.classList.add('new');\n      separ.after(line);\n    }\n    /* clear and add tom-select functionalities - only after adding line to the dom*/\n    if (has_autocomplete !== null) {\n      const jsTomSelect = new _modules_js_tom_select_js__WEBPACK_IMPORTED_MODULE_3__.JsTomSelect();\n      jsTomSelect.applyTo(has_autocomplete);\n      has_autocomplete.tomselect.clearOptions();\n      let options = this.fieldset.dataset.options;\n      options = (options) ? options : [];\n      has_autocomplete.tomselect.addOptions(options);\n    };\n\n\n    return line;\n  }\n\n  setLine(line, mb = {\n    key: '',\n    value: ''\n  }, priv, ct) {\n\n    priv = _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.defined_privileges[priv] ? _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.defined_privileges[priv] : _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.defined_privileges.viewers;\n    if (!priv) return;\n    const {\n      member,\n      privs,\n      contact,\n      delet\n    } = this.getInputs(line, priv);\n    if (!member || !privs || !contact || !delet) return;\n\n    // sanitize\n    mb.key = dompurify__WEBPACK_IMPORTED_MODULE_0___default().sanitize(mb.key);\n    mb.value = dompurify__WEBPACK_IMPORTED_MODULE_0___default().sanitize(mb.value);\n    const ts = member.tomselect;\n    if (ts) {\n      ts.clear();\n      const addmb = {}\n      addmb[ts.settings.valueField] = mb.key;\n      addmb[ts.settings.labelField] = addmb[ts.settings.searchField] = mb.value;\n      ts.addOption(addmb);\n      ts.setValue([mb.key]);\n    } else {\n      const selected = member.querySelector('select option[value=\"' + mb.key + '\"]');\n      if (selected) selected.selected = true;\n      else member.insertAdjacentHTML('beforeend', '<option value=\"' + mb.key + '\" selected>' + mb.value + '</option>');\n\n    }\n    privs.checked = true;\n    contact.value = mb.key;\n    if (priv === _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.rights.manage) {\n      contact.disabled = false;\n      if (ct === true) contact.checked = true;\n    }\n\n  }\n  getInputs(line, priv = false) {\n    const member = line.querySelector(\"[name*='[\" + this.options.ident + \"]']\");\n    let privs;\n    if (priv) {\n      privs = line.querySelector('input[name*=\"[' + this.options.privilege + ']\"][value=\"' + priv + '\"]');\n    } else privs = line.querySelectorAll('input[name*=\"[' + this.options.privilege + ']\"]');\n    const contact = line.querySelector('input[name=\"' + this.options.contactfieldname + '\"]');\n    const delet = line.querySelector(\"input[name*='[\" + this.options.delet + \"]']\");\n\n    return {\n      member: member,\n      privs: privs,\n      contact: contact,\n      delet: delet\n    };\n  }\n  async importPrivileges(privileges, replace = false, contact = null, importedtag = null, dismiss = null) {\n    let lastline = !replace;\n\n    try {\n      Object.entries(privileges).forEach(([priv, members]) => {\n        members.forEach((member) => {\n          if (!lastline) lastline = this.clearAll(true);\n          else lastline = this.newLine(true, member.id);\n          if (lastline) {\n            this.setLine(lastline, {\n              key: member.id,\n              value: member.name,\n            }, priv, (contact && (parseInt(contact.id) === parseInt(member.id))));\n            if (importedtag) importedtag(lastline);\n\n          }\n\n        });\n\n      });\n      if (dismiss) dismiss();\n      this.alertBox.dismissAlert(codemessages.importpriverror);\n      return true;\n    } catch (err) {\n      await this.alertBox.build({\n        dismissible: true,\n        message: codemessages.importpriverror,\n        codeid: true,\n        parent: this.fieldset_alert_zone,\n        type: _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.alertconfig.danger,\n      });\n      console.log('err', err);\n      return false;\n    }\n  }\n  activateEvents(line) {\n    if (!line) return;\n    const {\n      member,\n      privs,\n      contact,\n      delet\n    } = this.getInputs(line);\n    if (!member || !privs || !contact || !delet) {\n      return;\n    }\n    const siblings = s => [...s.parentElement.children].filter(c => c.nodeType == 1 && c != s && c.classList.contains('row') && c.dataset.block !== null && c.dataset.block === this.options.target);\n\n    // enable/disable contact when privilege changes\n    const lineSettings = (pr, ct, dl, synchro = false) => {\n\n      if (pr && pr.value === _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.rights.manage) {\n        // manager - can't delete line - can choose as contact\n        dl.disabled = true;\n        ct.disabled = false;\n        // dismiss related alert\n        this.alertBox.dismissAlert(codemessages.nomanager);\n        if (ct.checked) {\n          this.alertBox.dismissAlert(codemessages.nocontact);\n        }\n      } else {\n        // not manager - can delet line - cannot chose as contact\n        //  if (ct.checked === true) ct.dispatchEvent(new Event('click'));\n        ct.checked = false;\n        dl.disabled = false;\n        ct.disabled = true;\n      }\n\n      if (synchro === true) {\n        synchroSiblings(line);\n      }\n      // dismiss alerts\n      if (!dl.ckecked) {\n        this.alertBox.dismissAlert(codemessages.nobody);\n        this.alertBox.dismissAlert(codemessages.oneatleast);\n      }\n    }\n    const synchroSiblings = (line) => {\n      const lns = siblings(line);\n      lns.forEach((ln) => {\n        const dl = ln.querySelector(\"input[name*='[\" + this.options.delet + \"]']\");\n        const ct = ln.querySelector('input[name=\"' + this.options.contactfieldname + '\"]');\n        const pr = ln.querySelector('input[name*=\"[' + this.options.privilege + ']\"]:checked');\n        lineSettings(pr, ct, dl, false);\n\n      })\n    }\n\n    member.addEventListener('change', (e) => {\n      contact.value = member.value;\n      // dismiss alert\n      if (member.value) {\n        this.alertBox.dismissAlert(codemessages.emptyname);\n        this.alertBox.dismissAlert(codemessages.oneatleast);\n        this.alertBox.dismissAlert(codemessages.nobody);\n      }\n    })\n\n    privs.forEach((priv) => {\n      priv.addEventListener('change', (e) => {\n        if (priv.checked) lineSettings(priv, contact, delet, false);\n      });\n\n      if (priv.checked) lineSettings(priv, contact, delet, false);\n    })\n\n    contact.addEventListener('change', (e) => {\n      if (e.target.checked) delet.disabled = true;\n      else delet.disabled = false;\n      const priv = line.querySelector('input[name*=\"[' + this.options.privilege + ']\"]:checked');\n      lineSettings(priv, contact, delet, true);\n      // enable otherwise\n\n    })\n\n    // delet ok for all when new line\n    //\n    delet.addEventListener('click', (e) => {\n      // at least one priv line\n      const deletlabel = delet.closest('label');\n      const lines = this.fieldset.querySelectorAll('[data-block=\"' + this.options.target + '\"]:not([data-mod=\"remove\"])');\n      if (lines.length <= 1 && e.target.checked) {\n        delet.disabled = true;\n        delet.checked = false;\n        this.alertBox.build({\n          dismissible: true,\n          message: codemessages.oneatleast,\n          codemessage: codemessages.oneatleast,\n          type: _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.alertconfig.warning,\n          parent: (e.currentTarget.id || null)\n        });\n        return;\n      } else if (e.target.checked) {\n        this.alertBox.dismissAlert(codemessages.oneatleast);\n        if (line.classList.contains('new')) {\n          line.remove();\n        } else {\n          if (deletlabel && deletlabel.dataset.restore) deletlabel.setAttribute('title', deletlabel.dataset.restore);\n          line.setAttribute('data-mod', 'remove');\n          privs.forEach(priv => {\n            priv.disabled = true;\n            priv.checked = false;\n          })\n          contact.checked = false;\n          contact.disabled = true;\n          member.disabled = true;\n        }\n      } else {\n        if (deletlabel && deletlabel.dataset.remove) deletlabel.setAttribute('title', deletlabel.dataset.remove);\n        line.removeAttribute('data-mod');\n        privs.forEach(priv => priv.disabled = false);\n        contact.disabled = false;\n        member.disabled = false;\n      }\n    });\n    // delet mouseover - explain why it is disabled when manage is checked\n    delet.addEventListener('mouseover', (e) => {\n      if (e.target.disabled) {\n        let pr = line.querySelector('input[name*=\"[' + this.options.privilege + ']\"]:checked');\n        if (!pr) return;\n        pr = pr.value.toLowerCase()\n        e.target.title = (e.target.dataset[pr]) ? e.target.dataset[pr] : e.target.title\n      }\n    })\n    // disable delet if user is the only manager\n    if (this.current_uid === member.value) delet.disabled = true;\n\n\n  }\n\n  // send clean data on submit\n  async cleanPrivileges() {\n    // check managers and contact_user_id on submit\n\n    const checkContact = async () => {\n      // check if one manager at least\n      const managers = this.fieldset.querySelectorAll('[name*=\"[' + this.options.privilege + ']\"][value=\"' + _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.rights.manage + '\"]:checked');\n      let n = managers.length;\n\n      if (n === 0) {\n        await this.alertBox.build({\n          dismissible: true,\n          message: codemessages.nomanager,\n          codeid: true,\n          type: _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.alertconfig.danger,\n          parent: this.fieldset_alert_zone,\n        });\n        return false;\n      } else this.alertBox.dismissAlert(codemessages.nomanager);\n      // check contact\n      const contact = this.fieldset.querySelector('[name=\"' + this.options.contactfieldname + '\"]:checked');\n\n      if (contact === null) {\n        await this.alertBox.build({\n          dismissible: true,\n          codeid: true,\n          message: codemessages.nocontact,\n          type: _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.alertconfig.danger,\n          parent: this.fieldset_alert_zone\n        });\n        return false;\n      }\n      this.alertBox.dismissAlert(codemessages.nocontact);\n      return true;\n    }\n    const hasMember = (line) => {\n      const member = line.querySelector('[name*=\"[' + this.options.ident + ']\"]');\n      return (member.value);\n    }\n    const hasPriv = (line) => {\n      const priv = line.querySelector('[name*=\"[' + this.options.privilege + ']\"]:checked');\n      if (priv && priv.value) return true;\n      return false;\n    }\n    const formatPrivilege = (line) => {\n\n      const els = line.querySelectorAll('[name*=\"members[\"');\n      els.forEach((el) => {\n        let name = el.name;\n        name = name.split('[');\n        name.pop();\n        el.name = name.join('[');\n        if (el.name.indexOf('[' + this.options.privilege + ']') > 0) {\n          el.type = 'checkbox';\n          el.classList.add('hidden');\n        }\n\n      })\n    }\n    const hascontact = await checkContact();\n    if (hascontact === true) {\n      const lines = this.fieldset.querySelectorAll('[data-block=\"' + this.options.target + '\"]');\n      let n = lines.length;\n      let verif = true;\n      for (const line of lines) {\n        if (line.dataset.mod && line.dataset.mod === 'remove') {\n          if (n > 1) {\n            line.remove();\n            n--;\n          } else return false;\n        } else if (!hasMember(line)) {\n          const lineno = line.querySelector('[name*=\"[' + this.options.ident + ']\"]');\n          lineno.focus();\n          if (lineno.tomselect) lineno.tomselect.focus();\n          await this.alertBox.build({\n            dismissible: true,\n            insertafter: true,\n            message: codemessages.emptyname,\n            codeid: true,\n            type: _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.alertconfig.warning,\n            parent: line\n          });\n          const resp = false; // no confimbox just wait for user action\n          // callback when confirmbox response is chosen if 'confirm'\n          if (resp === true) {\n            if (n > 1) {\n              line.remove();\n              n--;\n            } else return false;\n\n          } else return false;\n        } else if (!hasPriv(line)) {\n          this.alertBox.dismissAlert(codemessages.emptyname);\n          await this.alertBox.build({\n            dismissible: true,\n            insertafter: true,\n            codeid: true,\n            message: codemessages.uhasnopriv,\n            type: _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.alertconfig.warning,\n            parent: line\n          });\n          verif = false;\n        } else this.alertBox.dismissAlert(codemessages.uhasnopriv);\n      }\n      if (!verif) return verif;\n      for (const line of lines) {\n        formatPrivilege(line);\n      }\n\n      if (n === 0) {\n        await this.alertBox.build({\n          dismissible: true,\n          codeid: true,\n          message: codemessages.nobody,\n          type: _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.alertconfig.warning,\n          parent: this.fieldset_alert_zone\n        });\n        return false;\n      } else this.alertBox.dismissAlert(codemessages.nobody);\n      return true;\n    } else return false;\n  }\n  getLinePrivilege(id) {\n    let privilege = null;\n    const lines = this.fieldset.querySelectorAll('[data-block=\"' + this.options.target + '\"]')\n    for (const line of lines) {\n      if (parseInt(line.querySelector('[name*=\"[' + this.options.ident + ']\"]').value) === parseInt(id)) {\n        privilege = line;\n        break;\n      }\n    }\n\n    return privilege;\n  }\n\n  clearAll(ret = false) {\n    const lines = this.fieldset.querySelectorAll('[data-block=\"' + this.options.target + '\"]');\n    let keepindex = -1;\n    lines.forEach((line, index) => {\n      const {\n        member,\n        privs,\n        contact,\n        delet\n      } = this.getInputs(line);\n      if (this.current_uid === member.value) keepindex = index;\n      if (index > 0 || (keepindex > 0 && keepindex !== index)) line.remove();\n    });\n    //\n    console.log('keepindex', keepindex)\n    const line = this.newLine(true);\n    if (keepindex !== 0) {\n      lines[0].remove();\n      console.log('rem line0', lines)\n    }\n    if (ret === true) return line;\n  }\n\n\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZO0FBQ1osVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsMkVBQW1CO0FBQ3JDO0FBQ0EsV0FBVztBQUNYLDhCQUE4QjtBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYzs7QUFFZCxZQUFZO0FBQ1osVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQiwyRUFBbUI7QUFDckM7QUFDQSxXQUFXO0FBQ1g7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLDJFQUFtQjtBQUNuQztBQUNBLFNBQVM7QUFDVDtBQUNBLFFBQVE7QUFDUjtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvbW9kdWxlcy9wcm9qZWN0LXByaXZpbGVnZXMuanM/ZGQyMyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBwcml2aWxlZ2VzIG9mIGEgcHJvamVjdFxuLy8gbGluZSB3aXRoIG1lbWJlciBuYW1lICwgcHJpdmlsaWVnZSAsIGlzIGNvbnRhY3QgLCBhbmQgZGVsZXRlIGZ1bmN0aW9uYWxpdHlcbmltcG9ydCBET01QdXJpZnkgZnJvbSAnZG9tcHVyaWZ5JztcbmltcG9ydCB7XG4gIEZvcm1TdWJtaXQsXG59IGZyb20gXCIuLi9tb2R1bGVzL2Zvcm0tc3VibWl0LmpzXCI7XG5pbXBvcnQge1xuICBBbGVydEJveFxufSBmcm9tIFwiLi4vbW9kdWxlcy9hbGVydC1ib3hlcy5qc1wiO1xuaW1wb3J0IHtcbiAgSnNUb21TZWxlY3Rcbn0gZnJvbSBcIi4uL21vZHVsZXMvanMtdG9tLXNlbGVjdC5qc1wiO1xuXG5pbXBvcnQge1xuICByaWdodHMsXG4gIGRlZmluZWRfcHJpdmlsZWdlcyxcbiAgYWxlcnRjb25maWcsXG4gIGNzc1xufSBmcm9tICcuLi9tb2R1bGVzL21vZHVsZXMtY29uZmlnLmpzJztcbmNvbnN0IGNvZGVtZXNzYWdlcyA9IHtcbiAgb25lYXRsZWFzdDogJ29uZWF0bGVhc3QnLFxuICBub21hbmFnZXI6ICdub21hbmFnZXInLFxuICBub2NvbnRhY3Q6ICdub2NvbnRhY3QnLFxuICB1aGFzbm9wcml2OiAndWhhc25vcHJpdicsXG4gIGltcG9ydHByaXZlcnJvcjogJ2ltcG9ydHByaXZlcnJvcicsXG4gIGVtcHR5bmFtZTogJ2VtcHR5bmFtZSdcbn1cbmxldCBpbnN0YW5jZSA9IG51bGw7XG5leHBvcnQgY2xhc3MgUHJvamVjdFByaXZpbGVnZXMge1xuICAvL1RPRE86IHJld3JpdGUgdG8gbm90IGRlcGVuZCBvbiBET00gc2VsZWN0XG4gIG9wdGlvbnM7XG4gIGFsZXJ0Qm94O1xuICAvLyBjdXJyZW50IHVzZXIgaWQ7XG4gIGN1cnJlbnRfdWlkO1xuICBmaWVsZHNldDtcbiAgZmllbGRzZXRfYWxlcnRfem9uZTtcbiAgLy8gdW5pcXVlIHVzZXJzXG4gIGNvbnN0cnVjdG9yKG9wdGlvbnMgPSB7fSkge1xuICAgIGlmICghaW5zdGFuY2UpIHtcbiAgICAgIGNvbnN0IGRlZmF1bHRPcHRpb25zID0ge1xuICAgICAgICBncm91cGlkOiBcIiNzZWN0aW9uLXByaXZpbGVnZXNcIixcbiAgICAgICAgc2VwYXI6ICcubmV3LXByaXZpbGVnZScsXG4gICAgICAgIGFkZGJ0bjogJ1tkYXRhLWFkZD1cImJsb2NrXCJdJyxcbiAgICAgICAgdGFyZ2V0OiAnbWVtYmVyJyxcbiAgICAgICAgaWRlbnQ6ICdtZW1iZXInLFxuICAgICAgICBwcml2aWxlZ2U6ICdwcml2aWxlZ2UnLFxuICAgICAgICBkZWxldDogJ2RlbGV0JyxcbiAgICAgICAgY29udGFjdDogJ2NvbnRhY3QnLFxuICAgICAgICBjb250YWN0ZmllbGRuYW1lOiAnY29udGFjdF91c2VyX2lkJyxcblxuICAgICAgfTtcbiAgICAgIHRoaXMub3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe30sIGRlZmF1bHRPcHRpb25zLCBvcHRpb25zKTtcbiAgICAgIHRoaXMuZmllbGRzZXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHRoaXMub3B0aW9ucy5ncm91cGlkKTtcbiAgICAgIGlmICghdGhpcy5maWVsZHNldCkgcmV0dXJuO1xuICAgICAgdGhpcy5maWVsZHNldF9hbGVydF96b25lID0gdGhpcy5maWVsZHNldC5xdWVyeVNlbGVjdG9yKCcudGFiLWNvbnRlbnQnKSA/IHRoaXMuZmllbGRzZXQucXVlcnlTZWxlY3RvcignLnRhYi1jb250ZW50JykgOiB0aGlzLmZpZWxkc2V0O1xuICAgICAgdGhpcy5vcHRpb25zLnNlcGFyID0gdGhpcy5vcHRpb25zLnNlcGFyIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQgPyB0aGlzLm9wdGlvbnMuc2VwYXIgOiAoZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih0aGlzLm9wdGlvbnMuc2VwYXIpID8gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih0aGlzLm9wdGlvbnMuc2VwYXIpIDogbnVsbCk7XG4gICAgICB0aGlzLm9wdGlvbnMuYWRkYnRuID0gdGhpcy5vcHRpb25zLmFkZGJ0biBpbnN0YW5jZW9mIEhUTUxFbGVtZW50ID8gdGhpcy5vcHRpb25zLmFkZGJ0biA6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5vcHRpb25zLmFkZGJ0bik7XG4gICAgICBpZiAodGhpcy5vcHRpb25zLmFkZGJ0bikgdGhpcy5hZGRMaXN0ZW5lcigpO1xuICAgICAgY29uc3QgbGluZXMgPSB0aGlzLmZpZWxkc2V0LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLWJsb2NrPVwiJyArIHRoaXMub3B0aW9ucy50YXJnZXQgKyAnXCJdJyk7XG4gICAgICB0aGlzLmN1cnJlbnRfdWlkID0gdGhpcy5maWVsZHNldC5kYXRhc2V0LnU7XG4gICAgICB0aGlzLmFsZXJ0Qm94ID0gbmV3IEFsZXJ0Qm94KCk7XG4gICAgICBsaW5lcy5mb3JFYWNoKChsaW5lKSA9PiB7XG4gICAgICAgIHRoaXMuYWN0aXZhdGVFdmVudHMobGluZSk7XG4gICAgICB9KTtcblxuICAgICAgLy9yZW1vdmUgZGVsZXRlZCAsIGNsZWFuICYmIHZhbGlkYXRlIGRhdGFzICwgZm9ybWF0IG5hbWVzIGJlZm9yZSBzZW5kaW5nIHRoZSBmb3JtXG4gICAgICBjb25zdCBmb3JtID0gdGhpcy5maWVsZHNldC5jbG9zZXN0KCdmb3JtJyk7XG4gICAgICBjb25zdCBmb3JtU3VibWl0ID0gbmV3IEZvcm1TdWJtaXQoZm9ybSk7XG4gICAgICAvLyBoYW5kbGVyIC0gdmVyaWZ5IHByaXZpbGVnZXMgYmVmb3JlIHNldHRpbmdzIGZvcm0gc3VibWl0XG4gICAgICBjb25zdCBzdWJtaXRfcHJpdmlsZWdlcyA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzcCA9IGF3YWl0IHRoaXMuY2xlYW5Qcml2aWxlZ2VzKCk7XG4gICAgICAgIHJldHVybiByZXNwO1xuICAgICAgfVxuICAgICAgZm9ybVN1Ym1pdC5hZGRIYW5kbGVyKHN1Ym1pdF9wcml2aWxlZ2VzKTtcbiAgICAgIGluc3RhbmNlID0gdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIGluc3RhbmNlO1xuICB9XG5cbiAgbmV3TGluZShyZXQgPSBmYWxzZSwgY2hlY2sgPSAwKSB7XG4gICAgbGV0IGxpbmU7XG4gICAgaWYgKGNoZWNrID4gMCkge1xuICAgICAgbGluZSA9IHRoaXMuZ2V0TGluZVByaXZpbGVnZShjaGVjayk7XG4gICAgICBpZiAobGluZSkgcmV0dXJuIGxpbmU7XG4gICAgfVxuICAgIGNvbnN0IGxpbmVzID0gdGhpcy5maWVsZHNldC5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1ibG9jaz1cIicgKyB0aGlzLm9wdGlvbnMudGFyZ2V0ICsgJ1wiXScpO1xuXG4gICAgaWYgKGxpbmVzLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xuICAgIGNvbnN0IG4gPSBsaW5lcy5sZW5ndGggLSAxO1xuICAgIGxpbmUgPSBsaW5lc1tuXTtcbiAgICBpZiAobGluZSAhPT0gbnVsbCkge1xuICAgICAgbGluZSA9IHRoaXMuY2xlYXJMaW5lKGxpbmUuY2xvbmVOb2RlKHRydWUpLCBuLCAodGhpcy5vcHRpb25zLnNlcGFyID8gdGhpcy5vcHRpb25zLnNlcGFyIDogbGluZSkpO1xuXG4gICAgICB0aGlzLmFjdGl2YXRlRXZlbnRzKGxpbmUpO1xuXG4gICAgfVxuICAgIGlmIChyZXQgPT09IHRydWUpIHJldHVybiBsaW5lO1xuICB9XG5cbiAgYWRkTGlzdGVuZXIoKSB7XG4gICAgdGhpcy5vcHRpb25zLnRhcmdldCA9ICh0aGlzLm9wdGlvbnMuYWRkYnRuLmRhdGFzZXQudGFyZ2V0KSA/IHRoaXMub3B0aW9ucy5hZGRidG4uZGF0YXNldC50YXJnZXQgOiB0aGlzLm9wdGlvbnMudGFyZ2V0O1xuICAgIHRoaXMub3B0aW9ucy5hZGRidG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoZSkgPT4ge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgdGhpcy5uZXdMaW5lKCk7XG4gICAgfSlcbiAgfVxuXG4gIGNsZWFyTGluZShsaW5lLCBuLCBzZXBhciA9IG51bGwpIHtcbiAgICAvKmNsZWFuIGxpbmUgZWxlbWVudCAqL1xuXG4gICAgbGV0IGhhc19hdXRvY29tcGxldGUgPSBudWxsO1xuICAgIGxpbmUuZGF0YXNldC5tb2QgPSAnJztcbiAgICBsaW5lLmRpc2FibGVkID0gZmFsc2U7XG4gICAgY29uc3QgZWxlbXMgPSBsaW5lLnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLWVsZW1dJyk7XG4gICAgZWxlbXMuZm9yRWFjaCgoZWxlbSkgPT4ge1xuICAgICAgLy8gY2hhbmdlIGxvb3AgaW5kZXggLSBuZWNlc3NhcnkgZm9yIHRhaWx3aW5kY3NzIHBlZXJjaGVja2VkIHRvIHdvcmsgb3RoZXJ3aXNlIG5vdCBpZiBuYW1lIGVuZHMgd2l0aCBbXVxuICAgICAgLy9yZW1vdmUgY29tcG9uZW50c1xuICAgICAgY29uc3Qgcm1zID0gZWxlbS5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1jb21wb25lbnRdJylcbiAgICAgIHJtcy5mb3JFYWNoKChybSkgPT4ge1xuICAgICAgICBzd2l0Y2ggKHJtLmRhdGFzZXQuY29tcG9uZW50KSB7XG4gICAgICAgICAgY2FzZSAndG9tLXNlbGVjdCc6XG4gICAgICAgICAgICBybS5yZW1vdmUoKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgLy8gY2xlYW4gYW5kIHJlc2V0IGV2ZW50c1xuICAgICAgY29uc3QgZWxzID0gZWxlbS5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dCwgc2VsZWN0LCBsYWJlbCcpO1xuICAgICAgZWxzLmZvckVhY2goKGVsKSA9PiB7XG5cbiAgICAgICAgZWwuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgaWYgKHNlcGFyKSB7IC8vIGNoYW5nZSBuYW1lcyBhbmQgaWQgd2hlbiBhZGRpbmcgYSBuZXcgcm93IC0gbm90IGlmIGNsZWFyIG9ubHlcbiAgICAgICAgICBjb25zdCBrZXlzID0gWydpZCcsICdmb3InLCAnYXJpYS1jb250cm9scycsICduYW1lJ107XG4gICAgICAgICAga2V5cy5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgICAgICAgIGxldCB2YWwgPSBlbC5nZXRBdHRyaWJ1dGUoa2V5KTtcbiAgICAgICAgICAgIGlmICh2YWwgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgaWYgKGtleSA9PT0gJ25hbWUnKSB2YWwgPSB2YWwucmVwbGFjZSgnWycgKyBuICsgJ10nLCAnWycgKyAobiArIDEpICsgJ10nKTtcbiAgICAgICAgICAgICAgZWxzZSB2YWwgPSB2YWwucmVwbGFjZSgnXycgKyBuLCAnXycgKyAobiArIDEpKTtcbiAgICAgICAgICAgICAgZWwuc2V0QXR0cmlidXRlKGtleSwgdmFsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBzd2l0Y2ggKGVsLnRhZ05hbWUudG9Mb3dlckNhc2UoKSkge1xuICAgICAgICAgIGNhc2UgJ2lucHV0JzpcbiAgICAgICAgICAgIC8vZWwuaW5kZXRlcm1pbmF0ZSA9IHRydWU7XG4gICAgICAgICAgICBlbC5jaGVja2VkID0gZmFsc2U7XG4gICAgICAgICAgICAvLyBkaXNhYmxlIGNvbnRhY3QgYXMgcHJpdmlsZWdlIGlzIGVtcHR5XG4gICAgICAgICAgICBpZiAoZWwubmFtZSA9PSB0aGlzLm9wdGlvbnMuY29udGFjdGZpZWxkbmFtZSkge1xuICAgICAgICAgICAgICBlbC52YWx1ZSA9IFwiMFwiO1xuICAgICAgICAgICAgICBlbC5kaXNhYmxlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlICdzZWxlY3QnOlxuICAgICAgICAgICAgZWwuc2VsZWN0ZWRJbmRleCA9IC0xO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSAnbGFiZWwnOlxuICAgICAgICAgICAgZWwuY2xhc3NMaXN0LnJlbW92ZShjc3MucGVlcmNoZWNrZWQpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGVsLnRvbXNlbGVjdCkge1xuICAgICAgICAgIGhhc19hdXRvY29tcGxldGUgPSBlbDtcbiAgICAgICAgICBlbC50b21zZWxlY3QuY2xlYXIoKTtcbiAgICAgICAgICBlbC50b21zZWxlY3QuZGVzdHJveSgpO1xuXG4gICAgICAgIH1cbiAgICAgICAgaWYgKGVsLmNsYXNzTGlzdC5jb250YWlucyhjc3MuY29tcG9uZW50LmF1dG9jb21wbGV0ZS50b21zZWxlY3RlZCkpIHtcbiAgICAgICAgICBoYXNfYXV0b2NvbXBsZXRlID0gZWw7XG4gICAgICAgICAgZWwuY2xhc3NMaXN0LmZvckVhY2goY2wgPT4ge1xuICAgICAgICAgICAgaWYgKGNsLmluZGV4T2YoJ3RzLScpID09IDApIGVsLmNsYXNzTGlzdC5yZW1vdmUoY2wpO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgZWwuY2xhc3NMaXN0LnJlbW92ZShjc3MuY29tcG9uZW50LmF1dG9jb21wbGV0ZS50b21zZWxlY3RlZCk7XG4gICAgICAgICAgaWYgKGVsLnR5cGUgPT0gXCJzZWxlY3Qtb25lXCIpIGRlbGV0ZSBlbC50eXBlO1xuXG4gICAgICAgIH1cblxuICAgICAgfSlcblxuICAgIH0pXG4gICAgLyogYWRkIGZ1bmN0aW9ubmFsaXRpZXMgKi9cbiAgICBpZiAoc2VwYXIpIHtcbiAgICAgIGxpbmUuY2xhc3NMaXN0LmFkZCgnbmV3Jyk7XG4gICAgICBzZXBhci5hZnRlcihsaW5lKTtcbiAgICB9XG4gICAgLyogY2xlYXIgYW5kIGFkZCB0b20tc2VsZWN0IGZ1bmN0aW9uYWxpdGllcyAtIG9ubHkgYWZ0ZXIgYWRkaW5nIGxpbmUgdG8gdGhlIGRvbSovXG4gICAgaWYgKGhhc19hdXRvY29tcGxldGUgIT09IG51bGwpIHtcbiAgICAgIGNvbnN0IGpzVG9tU2VsZWN0ID0gbmV3IEpzVG9tU2VsZWN0KCk7XG4gICAgICBqc1RvbVNlbGVjdC5hcHBseVRvKGhhc19hdXRvY29tcGxldGUpO1xuICAgICAgaGFzX2F1dG9jb21wbGV0ZS50b21zZWxlY3QuY2xlYXJPcHRpb25zKCk7XG4gICAgICBsZXQgb3B0aW9ucyA9IHRoaXMuZmllbGRzZXQuZGF0YXNldC5vcHRpb25zO1xuICAgICAgb3B0aW9ucyA9IChvcHRpb25zKSA/IG9wdGlvbnMgOiBbXTtcbiAgICAgIGhhc19hdXRvY29tcGxldGUudG9tc2VsZWN0LmFkZE9wdGlvbnMob3B0aW9ucyk7XG4gICAgfTtcblxuXG4gICAgcmV0dXJuIGxpbmU7XG4gIH1cblxuICBzZXRMaW5lKGxpbmUsIG1iID0ge1xuICAgIGtleTogJycsXG4gICAgdmFsdWU6ICcnXG4gIH0sIHByaXYsIGN0KSB7XG5cbiAgICBwcml2ID0gZGVmaW5lZF9wcml2aWxlZ2VzW3ByaXZdID8gZGVmaW5lZF9wcml2aWxlZ2VzW3ByaXZdIDogZGVmaW5lZF9wcml2aWxlZ2VzLnZpZXdlcnM7XG4gICAgaWYgKCFwcml2KSByZXR1cm47XG4gICAgY29uc3Qge1xuICAgICAgbWVtYmVyLFxuICAgICAgcHJpdnMsXG4gICAgICBjb250YWN0LFxuICAgICAgZGVsZXRcbiAgICB9ID0gdGhpcy5nZXRJbnB1dHMobGluZSwgcHJpdik7XG4gICAgaWYgKCFtZW1iZXIgfHwgIXByaXZzIHx8ICFjb250YWN0IHx8ICFkZWxldCkgcmV0dXJuO1xuXG4gICAgLy8gc2FuaXRpemVcbiAgICBtYi5rZXkgPSBET01QdXJpZnkuc2FuaXRpemUobWIua2V5KTtcbiAgICBtYi52YWx1ZSA9IERPTVB1cmlmeS5zYW5pdGl6ZShtYi52YWx1ZSk7XG4gICAgY29uc3QgdHMgPSBtZW1iZXIudG9tc2VsZWN0O1xuICAgIGlmICh0cykge1xuICAgICAgdHMuY2xlYXIoKTtcbiAgICAgIGNvbnN0IGFkZG1iID0ge31cbiAgICAgIGFkZG1iW3RzLnNldHRpbmdzLnZhbHVlRmllbGRdID0gbWIua2V5O1xuICAgICAgYWRkbWJbdHMuc2V0dGluZ3MubGFiZWxGaWVsZF0gPSBhZGRtYlt0cy5zZXR0aW5ncy5zZWFyY2hGaWVsZF0gPSBtYi52YWx1ZTtcbiAgICAgIHRzLmFkZE9wdGlvbihhZGRtYik7XG4gICAgICB0cy5zZXRWYWx1ZShbbWIua2V5XSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IHNlbGVjdGVkID0gbWVtYmVyLnF1ZXJ5U2VsZWN0b3IoJ3NlbGVjdCBvcHRpb25bdmFsdWU9XCInICsgbWIua2V5ICsgJ1wiXScpO1xuICAgICAgaWYgKHNlbGVjdGVkKSBzZWxlY3RlZC5zZWxlY3RlZCA9IHRydWU7XG4gICAgICBlbHNlIG1lbWJlci5pbnNlcnRBZGphY2VudEhUTUwoJ2JlZm9yZWVuZCcsICc8b3B0aW9uIHZhbHVlPVwiJyArIG1iLmtleSArICdcIiBzZWxlY3RlZD4nICsgbWIudmFsdWUgKyAnPC9vcHRpb24+Jyk7XG5cbiAgICB9XG4gICAgcHJpdnMuY2hlY2tlZCA9IHRydWU7XG4gICAgY29udGFjdC52YWx1ZSA9IG1iLmtleTtcbiAgICBpZiAocHJpdiA9PT0gcmlnaHRzLm1hbmFnZSkge1xuICAgICAgY29udGFjdC5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgaWYgKGN0ID09PSB0cnVlKSBjb250YWN0LmNoZWNrZWQgPSB0cnVlO1xuICAgIH1cblxuICB9XG4gIGdldElucHV0cyhsaW5lLCBwcml2ID0gZmFsc2UpIHtcbiAgICBjb25zdCBtZW1iZXIgPSBsaW5lLnF1ZXJ5U2VsZWN0b3IoXCJbbmFtZSo9J1tcIiArIHRoaXMub3B0aW9ucy5pZGVudCArIFwiXSddXCIpO1xuICAgIGxldCBwcml2cztcbiAgICBpZiAocHJpdikge1xuICAgICAgcHJpdnMgPSBsaW5lLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWUqPVwiWycgKyB0aGlzLm9wdGlvbnMucHJpdmlsZWdlICsgJ11cIl1bdmFsdWU9XCInICsgcHJpdiArICdcIl0nKTtcbiAgICB9IGVsc2UgcHJpdnMgPSBsaW5lLnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0W25hbWUqPVwiWycgKyB0aGlzLm9wdGlvbnMucHJpdmlsZWdlICsgJ11cIl0nKTtcbiAgICBjb25zdCBjb250YWN0ID0gbGluZS5xdWVyeVNlbGVjdG9yKCdpbnB1dFtuYW1lPVwiJyArIHRoaXMub3B0aW9ucy5jb250YWN0ZmllbGRuYW1lICsgJ1wiXScpO1xuICAgIGNvbnN0IGRlbGV0ID0gbGluZS5xdWVyeVNlbGVjdG9yKFwiaW5wdXRbbmFtZSo9J1tcIiArIHRoaXMub3B0aW9ucy5kZWxldCArIFwiXSddXCIpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIG1lbWJlcjogbWVtYmVyLFxuICAgICAgcHJpdnM6IHByaXZzLFxuICAgICAgY29udGFjdDogY29udGFjdCxcbiAgICAgIGRlbGV0OiBkZWxldFxuICAgIH07XG4gIH1cbiAgYXN5bmMgaW1wb3J0UHJpdmlsZWdlcyhwcml2aWxlZ2VzLCByZXBsYWNlID0gZmFsc2UsIGNvbnRhY3QgPSBudWxsLCBpbXBvcnRlZHRhZyA9IG51bGwsIGRpc21pc3MgPSBudWxsKSB7XG4gICAgbGV0IGxhc3RsaW5lID0gIXJlcGxhY2U7XG5cbiAgICB0cnkge1xuICAgICAgT2JqZWN0LmVudHJpZXMocHJpdmlsZWdlcykuZm9yRWFjaCgoW3ByaXYsIG1lbWJlcnNdKSA9PiB7XG4gICAgICAgIG1lbWJlcnMuZm9yRWFjaCgobWVtYmVyKSA9PiB7XG4gICAgICAgICAgaWYgKCFsYXN0bGluZSkgbGFzdGxpbmUgPSB0aGlzLmNsZWFyQWxsKHRydWUpO1xuICAgICAgICAgIGVsc2UgbGFzdGxpbmUgPSB0aGlzLm5ld0xpbmUodHJ1ZSwgbWVtYmVyLmlkKTtcbiAgICAgICAgICBpZiAobGFzdGxpbmUpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0TGluZShsYXN0bGluZSwge1xuICAgICAgICAgICAgICBrZXk6IG1lbWJlci5pZCxcbiAgICAgICAgICAgICAgdmFsdWU6IG1lbWJlci5uYW1lLFxuICAgICAgICAgICAgfSwgcHJpdiwgKGNvbnRhY3QgJiYgKHBhcnNlSW50KGNvbnRhY3QuaWQpID09PSBwYXJzZUludChtZW1iZXIuaWQpKSkpO1xuICAgICAgICAgICAgaWYgKGltcG9ydGVkdGFnKSBpbXBvcnRlZHRhZyhsYXN0bGluZSk7XG5cbiAgICAgICAgICB9XG5cbiAgICAgICAgfSk7XG5cbiAgICAgIH0pO1xuICAgICAgaWYgKGRpc21pc3MpIGRpc21pc3MoKTtcbiAgICAgIHRoaXMuYWxlcnRCb3guZGlzbWlzc0FsZXJ0KGNvZGVtZXNzYWdlcy5pbXBvcnRwcml2ZXJyb3IpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBhd2FpdCB0aGlzLmFsZXJ0Qm94LmJ1aWxkKHtcbiAgICAgICAgZGlzbWlzc2libGU6IHRydWUsXG4gICAgICAgIG1lc3NhZ2U6IGNvZGVtZXNzYWdlcy5pbXBvcnRwcml2ZXJyb3IsXG4gICAgICAgIGNvZGVpZDogdHJ1ZSxcbiAgICAgICAgcGFyZW50OiB0aGlzLmZpZWxkc2V0X2FsZXJ0X3pvbmUsXG4gICAgICAgIHR5cGU6IGFsZXJ0Y29uZmlnLmRhbmdlcixcbiAgICAgIH0pO1xuICAgICAgY29uc29sZS5sb2coJ2VycicsIGVycik7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG4gIGFjdGl2YXRlRXZlbnRzKGxpbmUpIHtcbiAgICBpZiAoIWxpbmUpIHJldHVybjtcbiAgICBjb25zdCB7XG4gICAgICBtZW1iZXIsXG4gICAgICBwcml2cyxcbiAgICAgIGNvbnRhY3QsXG4gICAgICBkZWxldFxuICAgIH0gPSB0aGlzLmdldElucHV0cyhsaW5lKTtcbiAgICBpZiAoIW1lbWJlciB8fCAhcHJpdnMgfHwgIWNvbnRhY3QgfHwgIWRlbGV0KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHNpYmxpbmdzID0gcyA9PiBbLi4ucy5wYXJlbnRFbGVtZW50LmNoaWxkcmVuXS5maWx0ZXIoYyA9PiBjLm5vZGVUeXBlID09IDEgJiYgYyAhPSBzICYmIGMuY2xhc3NMaXN0LmNvbnRhaW5zKCdyb3cnKSAmJiBjLmRhdGFzZXQuYmxvY2sgIT09IG51bGwgJiYgYy5kYXRhc2V0LmJsb2NrID09PSB0aGlzLm9wdGlvbnMudGFyZ2V0KTtcblxuICAgIC8vIGVuYWJsZS9kaXNhYmxlIGNvbnRhY3Qgd2hlbiBwcml2aWxlZ2UgY2hhbmdlc1xuICAgIGNvbnN0IGxpbmVTZXR0aW5ncyA9IChwciwgY3QsIGRsLCBzeW5jaHJvID0gZmFsc2UpID0+IHtcblxuICAgICAgaWYgKHByICYmIHByLnZhbHVlID09PSByaWdodHMubWFuYWdlKSB7XG4gICAgICAgIC8vIG1hbmFnZXIgLSBjYW4ndCBkZWxldGUgbGluZSAtIGNhbiBjaG9vc2UgYXMgY29udGFjdFxuICAgICAgICBkbC5kaXNhYmxlZCA9IHRydWU7XG4gICAgICAgIGN0LmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgIC8vIGRpc21pc3MgcmVsYXRlZCBhbGVydFxuICAgICAgICB0aGlzLmFsZXJ0Qm94LmRpc21pc3NBbGVydChjb2RlbWVzc2FnZXMubm9tYW5hZ2VyKTtcbiAgICAgICAgaWYgKGN0LmNoZWNrZWQpIHtcbiAgICAgICAgICB0aGlzLmFsZXJ0Qm94LmRpc21pc3NBbGVydChjb2RlbWVzc2FnZXMubm9jb250YWN0KTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gbm90IG1hbmFnZXIgLSBjYW4gZGVsZXQgbGluZSAtIGNhbm5vdCBjaG9zZSBhcyBjb250YWN0XG4gICAgICAgIC8vICBpZiAoY3QuY2hlY2tlZCA9PT0gdHJ1ZSkgY3QuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoJ2NsaWNrJykpO1xuICAgICAgICBjdC5jaGVja2VkID0gZmFsc2U7XG4gICAgICAgIGRsLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgIGN0LmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgaWYgKHN5bmNocm8gPT09IHRydWUpIHtcbiAgICAgICAgc3luY2hyb1NpYmxpbmdzKGxpbmUpO1xuICAgICAgfVxuICAgICAgLy8gZGlzbWlzcyBhbGVydHNcbiAgICAgIGlmICghZGwuY2tlY2tlZCkge1xuICAgICAgICB0aGlzLmFsZXJ0Qm94LmRpc21pc3NBbGVydChjb2RlbWVzc2FnZXMubm9ib2R5KTtcbiAgICAgICAgdGhpcy5hbGVydEJveC5kaXNtaXNzQWxlcnQoY29kZW1lc3NhZ2VzLm9uZWF0bGVhc3QpO1xuICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBzeW5jaHJvU2libGluZ3MgPSAobGluZSkgPT4ge1xuICAgICAgY29uc3QgbG5zID0gc2libGluZ3MobGluZSk7XG4gICAgICBsbnMuZm9yRWFjaCgobG4pID0+IHtcbiAgICAgICAgY29uc3QgZGwgPSBsbi5xdWVyeVNlbGVjdG9yKFwiaW5wdXRbbmFtZSo9J1tcIiArIHRoaXMub3B0aW9ucy5kZWxldCArIFwiXSddXCIpO1xuICAgICAgICBjb25zdCBjdCA9IGxuLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWU9XCInICsgdGhpcy5vcHRpb25zLmNvbnRhY3RmaWVsZG5hbWUgKyAnXCJdJyk7XG4gICAgICAgIGNvbnN0IHByID0gbG4ucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZSo9XCJbJyArIHRoaXMub3B0aW9ucy5wcml2aWxlZ2UgKyAnXVwiXTpjaGVja2VkJyk7XG4gICAgICAgIGxpbmVTZXR0aW5ncyhwciwgY3QsIGRsLCBmYWxzZSk7XG5cbiAgICAgIH0pXG4gICAgfVxuXG4gICAgbWVtYmVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIChlKSA9PiB7XG4gICAgICBjb250YWN0LnZhbHVlID0gbWVtYmVyLnZhbHVlO1xuICAgICAgLy8gZGlzbWlzcyBhbGVydFxuICAgICAgaWYgKG1lbWJlci52YWx1ZSkge1xuICAgICAgICB0aGlzLmFsZXJ0Qm94LmRpc21pc3NBbGVydChjb2RlbWVzc2FnZXMuZW1wdHluYW1lKTtcbiAgICAgICAgdGhpcy5hbGVydEJveC5kaXNtaXNzQWxlcnQoY29kZW1lc3NhZ2VzLm9uZWF0bGVhc3QpO1xuICAgICAgICB0aGlzLmFsZXJ0Qm94LmRpc21pc3NBbGVydChjb2RlbWVzc2FnZXMubm9ib2R5KTtcbiAgICAgIH1cbiAgICB9KVxuXG4gICAgcHJpdnMuZm9yRWFjaCgocHJpdikgPT4ge1xuICAgICAgcHJpdi5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoZSkgPT4ge1xuICAgICAgICBpZiAocHJpdi5jaGVja2VkKSBsaW5lU2V0dGluZ3MocHJpdiwgY29udGFjdCwgZGVsZXQsIGZhbHNlKTtcbiAgICAgIH0pO1xuXG4gICAgICBpZiAocHJpdi5jaGVja2VkKSBsaW5lU2V0dGluZ3MocHJpdiwgY29udGFjdCwgZGVsZXQsIGZhbHNlKTtcbiAgICB9KVxuXG4gICAgY29udGFjdC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoZSkgPT4ge1xuICAgICAgaWYgKGUudGFyZ2V0LmNoZWNrZWQpIGRlbGV0LmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgIGVsc2UgZGVsZXQuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgIGNvbnN0IHByaXYgPSBsaW5lLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWUqPVwiWycgKyB0aGlzLm9wdGlvbnMucHJpdmlsZWdlICsgJ11cIl06Y2hlY2tlZCcpO1xuICAgICAgbGluZVNldHRpbmdzKHByaXYsIGNvbnRhY3QsIGRlbGV0LCB0cnVlKTtcbiAgICAgIC8vIGVuYWJsZSBvdGhlcndpc2VcblxuICAgIH0pXG5cbiAgICAvLyBkZWxldCBvayBmb3IgYWxsIHdoZW4gbmV3IGxpbmVcbiAgICAvL1xuICAgIGRlbGV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgIC8vIGF0IGxlYXN0IG9uZSBwcml2IGxpbmVcbiAgICAgIGNvbnN0IGRlbGV0bGFiZWwgPSBkZWxldC5jbG9zZXN0KCdsYWJlbCcpO1xuICAgICAgY29uc3QgbGluZXMgPSB0aGlzLmZpZWxkc2V0LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLWJsb2NrPVwiJyArIHRoaXMub3B0aW9ucy50YXJnZXQgKyAnXCJdOm5vdChbZGF0YS1tb2Q9XCJyZW1vdmVcIl0pJyk7XG4gICAgICBpZiAobGluZXMubGVuZ3RoIDw9IDEgJiYgZS50YXJnZXQuY2hlY2tlZCkge1xuICAgICAgICBkZWxldC5kaXNhYmxlZCA9IHRydWU7XG4gICAgICAgIGRlbGV0LmNoZWNrZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5hbGVydEJveC5idWlsZCh7XG4gICAgICAgICAgZGlzbWlzc2libGU6IHRydWUsXG4gICAgICAgICAgbWVzc2FnZTogY29kZW1lc3NhZ2VzLm9uZWF0bGVhc3QsXG4gICAgICAgICAgY29kZW1lc3NhZ2U6IGNvZGVtZXNzYWdlcy5vbmVhdGxlYXN0LFxuICAgICAgICAgIHR5cGU6IGFsZXJ0Y29uZmlnLndhcm5pbmcsXG4gICAgICAgICAgcGFyZW50OiAoZS5jdXJyZW50VGFyZ2V0LmlkIHx8IG51bGwpXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9IGVsc2UgaWYgKGUudGFyZ2V0LmNoZWNrZWQpIHtcbiAgICAgICAgdGhpcy5hbGVydEJveC5kaXNtaXNzQWxlcnQoY29kZW1lc3NhZ2VzLm9uZWF0bGVhc3QpO1xuICAgICAgICBpZiAobGluZS5jbGFzc0xpc3QuY29udGFpbnMoJ25ldycpKSB7XG4gICAgICAgICAgbGluZS5yZW1vdmUoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAoZGVsZXRsYWJlbCAmJiBkZWxldGxhYmVsLmRhdGFzZXQucmVzdG9yZSkgZGVsZXRsYWJlbC5zZXRBdHRyaWJ1dGUoJ3RpdGxlJywgZGVsZXRsYWJlbC5kYXRhc2V0LnJlc3RvcmUpO1xuICAgICAgICAgIGxpbmUuc2V0QXR0cmlidXRlKCdkYXRhLW1vZCcsICdyZW1vdmUnKTtcbiAgICAgICAgICBwcml2cy5mb3JFYWNoKHByaXYgPT4ge1xuICAgICAgICAgICAgcHJpdi5kaXNhYmxlZCA9IHRydWU7XG4gICAgICAgICAgICBwcml2LmNoZWNrZWQgPSBmYWxzZTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIGNvbnRhY3QuY2hlY2tlZCA9IGZhbHNlO1xuICAgICAgICAgIGNvbnRhY3QuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICAgIG1lbWJlci5kaXNhYmxlZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChkZWxldGxhYmVsICYmIGRlbGV0bGFiZWwuZGF0YXNldC5yZW1vdmUpIGRlbGV0bGFiZWwuc2V0QXR0cmlidXRlKCd0aXRsZScsIGRlbGV0bGFiZWwuZGF0YXNldC5yZW1vdmUpO1xuICAgICAgICBsaW5lLnJlbW92ZUF0dHJpYnV0ZSgnZGF0YS1tb2QnKTtcbiAgICAgICAgcHJpdnMuZm9yRWFjaChwcml2ID0+IHByaXYuZGlzYWJsZWQgPSBmYWxzZSk7XG4gICAgICAgIGNvbnRhY3QuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgbWVtYmVyLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICB9XG4gICAgfSk7XG4gICAgLy8gZGVsZXQgbW91c2VvdmVyIC0gZXhwbGFpbiB3aHkgaXQgaXMgZGlzYWJsZWQgd2hlbiBtYW5hZ2UgaXMgY2hlY2tlZFxuICAgIGRlbGV0LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlb3ZlcicsIChlKSA9PiB7XG4gICAgICBpZiAoZS50YXJnZXQuZGlzYWJsZWQpIHtcbiAgICAgICAgbGV0IHByID0gbGluZS5xdWVyeVNlbGVjdG9yKCdpbnB1dFtuYW1lKj1cIlsnICsgdGhpcy5vcHRpb25zLnByaXZpbGVnZSArICddXCJdOmNoZWNrZWQnKTtcbiAgICAgICAgaWYgKCFwcikgcmV0dXJuO1xuICAgICAgICBwciA9IHByLnZhbHVlLnRvTG93ZXJDYXNlKClcbiAgICAgICAgZS50YXJnZXQudGl0bGUgPSAoZS50YXJnZXQuZGF0YXNldFtwcl0pID8gZS50YXJnZXQuZGF0YXNldFtwcl0gOiBlLnRhcmdldC50aXRsZVxuICAgICAgfVxuICAgIH0pXG4gICAgLy8gZGlzYWJsZSBkZWxldCBpZiB1c2VyIGlzIHRoZSBvbmx5IG1hbmFnZXJcbiAgICBpZiAodGhpcy5jdXJyZW50X3VpZCA9PT0gbWVtYmVyLnZhbHVlKSBkZWxldC5kaXNhYmxlZCA9IHRydWU7XG5cblxuICB9XG5cbiAgLy8gc2VuZCBjbGVhbiBkYXRhIG9uIHN1Ym1pdFxuICBhc3luYyBjbGVhblByaXZpbGVnZXMoKSB7XG4gICAgLy8gY2hlY2sgbWFuYWdlcnMgYW5kIGNvbnRhY3RfdXNlcl9pZCBvbiBzdWJtaXRcblxuICAgIGNvbnN0IGNoZWNrQ29udGFjdCA9IGFzeW5jICgpID0+IHtcbiAgICAgIC8vIGNoZWNrIGlmIG9uZSBtYW5hZ2VyIGF0IGxlYXN0XG4gICAgICBjb25zdCBtYW5hZ2VycyA9IHRoaXMuZmllbGRzZXQucXVlcnlTZWxlY3RvckFsbCgnW25hbWUqPVwiWycgKyB0aGlzLm9wdGlvbnMucHJpdmlsZWdlICsgJ11cIl1bdmFsdWU9XCInICsgcmlnaHRzLm1hbmFnZSArICdcIl06Y2hlY2tlZCcpO1xuICAgICAgbGV0IG4gPSBtYW5hZ2Vycy5sZW5ndGg7XG5cbiAgICAgIGlmIChuID09PSAwKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuYWxlcnRCb3guYnVpbGQoe1xuICAgICAgICAgIGRpc21pc3NpYmxlOiB0cnVlLFxuICAgICAgICAgIG1lc3NhZ2U6IGNvZGVtZXNzYWdlcy5ub21hbmFnZXIsXG4gICAgICAgICAgY29kZWlkOiB0cnVlLFxuICAgICAgICAgIHR5cGU6IGFsZXJ0Y29uZmlnLmRhbmdlcixcbiAgICAgICAgICBwYXJlbnQ6IHRoaXMuZmllbGRzZXRfYWxlcnRfem9uZSxcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH0gZWxzZSB0aGlzLmFsZXJ0Qm94LmRpc21pc3NBbGVydChjb2RlbWVzc2FnZXMubm9tYW5hZ2VyKTtcbiAgICAgIC8vIGNoZWNrIGNvbnRhY3RcbiAgICAgIGNvbnN0IGNvbnRhY3QgPSB0aGlzLmZpZWxkc2V0LnF1ZXJ5U2VsZWN0b3IoJ1tuYW1lPVwiJyArIHRoaXMub3B0aW9ucy5jb250YWN0ZmllbGRuYW1lICsgJ1wiXTpjaGVja2VkJyk7XG5cbiAgICAgIGlmIChjb250YWN0ID09PSBudWxsKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuYWxlcnRCb3guYnVpbGQoe1xuICAgICAgICAgIGRpc21pc3NpYmxlOiB0cnVlLFxuICAgICAgICAgIGNvZGVpZDogdHJ1ZSxcbiAgICAgICAgICBtZXNzYWdlOiBjb2RlbWVzc2FnZXMubm9jb250YWN0LFxuICAgICAgICAgIHR5cGU6IGFsZXJ0Y29uZmlnLmRhbmdlcixcbiAgICAgICAgICBwYXJlbnQ6IHRoaXMuZmllbGRzZXRfYWxlcnRfem9uZVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgdGhpcy5hbGVydEJveC5kaXNtaXNzQWxlcnQoY29kZW1lc3NhZ2VzLm5vY29udGFjdCk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgY29uc3QgaGFzTWVtYmVyID0gKGxpbmUpID0+IHtcbiAgICAgIGNvbnN0IG1lbWJlciA9IGxpbmUucXVlcnlTZWxlY3RvcignW25hbWUqPVwiWycgKyB0aGlzLm9wdGlvbnMuaWRlbnQgKyAnXVwiXScpO1xuICAgICAgcmV0dXJuIChtZW1iZXIudmFsdWUpO1xuICAgIH1cbiAgICBjb25zdCBoYXNQcml2ID0gKGxpbmUpID0+IHtcbiAgICAgIGNvbnN0IHByaXYgPSBsaW5lLnF1ZXJ5U2VsZWN0b3IoJ1tuYW1lKj1cIlsnICsgdGhpcy5vcHRpb25zLnByaXZpbGVnZSArICddXCJdOmNoZWNrZWQnKTtcbiAgICAgIGlmIChwcml2ICYmIHByaXYudmFsdWUpIHJldHVybiB0cnVlO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25zdCBmb3JtYXRQcml2aWxlZ2UgPSAobGluZSkgPT4ge1xuXG4gICAgICBjb25zdCBlbHMgPSBsaW5lLnF1ZXJ5U2VsZWN0b3JBbGwoJ1tuYW1lKj1cIm1lbWJlcnNbXCInKTtcbiAgICAgIGVscy5mb3JFYWNoKChlbCkgPT4ge1xuICAgICAgICBsZXQgbmFtZSA9IGVsLm5hbWU7XG4gICAgICAgIG5hbWUgPSBuYW1lLnNwbGl0KCdbJyk7XG4gICAgICAgIG5hbWUucG9wKCk7XG4gICAgICAgIGVsLm5hbWUgPSBuYW1lLmpvaW4oJ1snKTtcbiAgICAgICAgaWYgKGVsLm5hbWUuaW5kZXhPZignWycgKyB0aGlzLm9wdGlvbnMucHJpdmlsZWdlICsgJ10nKSA+IDApIHtcbiAgICAgICAgICBlbC50eXBlID0gJ2NoZWNrYm94JztcbiAgICAgICAgICBlbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTtcbiAgICAgICAgfVxuXG4gICAgICB9KVxuICAgIH1cbiAgICBjb25zdCBoYXNjb250YWN0ID0gYXdhaXQgY2hlY2tDb250YWN0KCk7XG4gICAgaWYgKGhhc2NvbnRhY3QgPT09IHRydWUpIHtcbiAgICAgIGNvbnN0IGxpbmVzID0gdGhpcy5maWVsZHNldC5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1ibG9jaz1cIicgKyB0aGlzLm9wdGlvbnMudGFyZ2V0ICsgJ1wiXScpO1xuICAgICAgbGV0IG4gPSBsaW5lcy5sZW5ndGg7XG4gICAgICBsZXQgdmVyaWYgPSB0cnVlO1xuICAgICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7XG4gICAgICAgIGlmIChsaW5lLmRhdGFzZXQubW9kICYmIGxpbmUuZGF0YXNldC5tb2QgPT09ICdyZW1vdmUnKSB7XG4gICAgICAgICAgaWYgKG4gPiAxKSB7XG4gICAgICAgICAgICBsaW5lLnJlbW92ZSgpO1xuICAgICAgICAgICAgbi0tO1xuICAgICAgICAgIH0gZWxzZSByZXR1cm4gZmFsc2U7XG4gICAgICAgIH0gZWxzZSBpZiAoIWhhc01lbWJlcihsaW5lKSkge1xuICAgICAgICAgIGNvbnN0IGxpbmVubyA9IGxpbmUucXVlcnlTZWxlY3RvcignW25hbWUqPVwiWycgKyB0aGlzLm9wdGlvbnMuaWRlbnQgKyAnXVwiXScpO1xuICAgICAgICAgIGxpbmVuby5mb2N1cygpO1xuICAgICAgICAgIGlmIChsaW5lbm8udG9tc2VsZWN0KSBsaW5lbm8udG9tc2VsZWN0LmZvY3VzKCk7XG4gICAgICAgICAgYXdhaXQgdGhpcy5hbGVydEJveC5idWlsZCh7XG4gICAgICAgICAgICBkaXNtaXNzaWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGluc2VydGFmdGVyOiB0cnVlLFxuICAgICAgICAgICAgbWVzc2FnZTogY29kZW1lc3NhZ2VzLmVtcHR5bmFtZSxcbiAgICAgICAgICAgIGNvZGVpZDogdHJ1ZSxcbiAgICAgICAgICAgIHR5cGU6IGFsZXJ0Y29uZmlnLndhcm5pbmcsXG4gICAgICAgICAgICBwYXJlbnQ6IGxpbmVcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBjb25zdCByZXNwID0gZmFsc2U7IC8vIG5vIGNvbmZpbWJveCBqdXN0IHdhaXQgZm9yIHVzZXIgYWN0aW9uXG4gICAgICAgICAgLy8gY2FsbGJhY2sgd2hlbiBjb25maXJtYm94IHJlc3BvbnNlIGlzIGNob3NlbiBpZiAnY29uZmlybSdcbiAgICAgICAgICBpZiAocmVzcCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgaWYgKG4gPiAxKSB7XG4gICAgICAgICAgICAgIGxpbmUucmVtb3ZlKCk7XG4gICAgICAgICAgICAgIG4tLTtcbiAgICAgICAgICAgIH0gZWxzZSByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgICB9IGVsc2UgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9IGVsc2UgaWYgKCFoYXNQcml2KGxpbmUpKSB7XG4gICAgICAgICAgdGhpcy5hbGVydEJveC5kaXNtaXNzQWxlcnQoY29kZW1lc3NhZ2VzLmVtcHR5bmFtZSk7XG4gICAgICAgICAgYXdhaXQgdGhpcy5hbGVydEJveC5idWlsZCh7XG4gICAgICAgICAgICBkaXNtaXNzaWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGluc2VydGFmdGVyOiB0cnVlLFxuICAgICAgICAgICAgY29kZWlkOiB0cnVlLFxuICAgICAgICAgICAgbWVzc2FnZTogY29kZW1lc3NhZ2VzLnVoYXNub3ByaXYsXG4gICAgICAgICAgICB0eXBlOiBhbGVydGNvbmZpZy53YXJuaW5nLFxuICAgICAgICAgICAgcGFyZW50OiBsaW5lXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgdmVyaWYgPSBmYWxzZTtcbiAgICAgICAgfSBlbHNlIHRoaXMuYWxlcnRCb3guZGlzbWlzc0FsZXJ0KGNvZGVtZXNzYWdlcy51aGFzbm9wcml2KTtcbiAgICAgIH1cbiAgICAgIGlmICghdmVyaWYpIHJldHVybiB2ZXJpZjtcbiAgICAgIGZvciAoY29uc3QgbGluZSBvZiBsaW5lcykge1xuICAgICAgICBmb3JtYXRQcml2aWxlZ2UobGluZSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChuID09PSAwKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuYWxlcnRCb3guYnVpbGQoe1xuICAgICAgICAgIGRpc21pc3NpYmxlOiB0cnVlLFxuICAgICAgICAgIGNvZGVpZDogdHJ1ZSxcbiAgICAgICAgICBtZXNzYWdlOiBjb2RlbWVzc2FnZXMubm9ib2R5LFxuICAgICAgICAgIHR5cGU6IGFsZXJ0Y29uZmlnLndhcm5pbmcsXG4gICAgICAgICAgcGFyZW50OiB0aGlzLmZpZWxkc2V0X2FsZXJ0X3pvbmVcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH0gZWxzZSB0aGlzLmFsZXJ0Qm94LmRpc21pc3NBbGVydChjb2RlbWVzc2FnZXMubm9ib2R5KTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gZWxzZSByZXR1cm4gZmFsc2U7XG4gIH1cbiAgZ2V0TGluZVByaXZpbGVnZShpZCkge1xuICAgIGxldCBwcml2aWxlZ2UgPSBudWxsO1xuICAgIGNvbnN0IGxpbmVzID0gdGhpcy5maWVsZHNldC5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1ibG9jaz1cIicgKyB0aGlzLm9wdGlvbnMudGFyZ2V0ICsgJ1wiXScpXG4gICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7XG4gICAgICBpZiAocGFyc2VJbnQobGluZS5xdWVyeVNlbGVjdG9yKCdbbmFtZSo9XCJbJyArIHRoaXMub3B0aW9ucy5pZGVudCArICddXCJdJykudmFsdWUpID09PSBwYXJzZUludChpZCkpIHtcbiAgICAgICAgcHJpdmlsZWdlID0gbGluZTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHByaXZpbGVnZTtcbiAgfVxuXG4gIGNsZWFyQWxsKHJldCA9IGZhbHNlKSB7XG4gICAgY29uc3QgbGluZXMgPSB0aGlzLmZpZWxkc2V0LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLWJsb2NrPVwiJyArIHRoaXMub3B0aW9ucy50YXJnZXQgKyAnXCJdJyk7XG4gICAgbGV0IGtlZXBpbmRleCA9IC0xO1xuICAgIGxpbmVzLmZvckVhY2goKGxpbmUsIGluZGV4KSA9PiB7XG4gICAgICBjb25zdCB7XG4gICAgICAgIG1lbWJlcixcbiAgICAgICAgcHJpdnMsXG4gICAgICAgIGNvbnRhY3QsXG4gICAgICAgIGRlbGV0XG4gICAgICB9ID0gdGhpcy5nZXRJbnB1dHMobGluZSk7XG4gICAgICBpZiAodGhpcy5jdXJyZW50X3VpZCA9PT0gbWVtYmVyLnZhbHVlKSBrZWVwaW5kZXggPSBpbmRleDtcbiAgICAgIGlmIChpbmRleCA+IDAgfHwgKGtlZXBpbmRleCA+IDAgJiYga2VlcGluZGV4ICE9PSBpbmRleCkpIGxpbmUucmVtb3ZlKCk7XG4gICAgfSk7XG4gICAgLy9cbiAgICBjb25zb2xlLmxvZygna2VlcGluZGV4Jywga2VlcGluZGV4KVxuICAgIGNvbnN0IGxpbmUgPSB0aGlzLm5ld0xpbmUodHJ1ZSk7XG4gICAgaWYgKGtlZXBpbmRleCAhPT0gMCkge1xuICAgICAgbGluZXNbMF0ucmVtb3ZlKCk7XG4gICAgICBjb25zb2xlLmxvZygncmVtIGxpbmUwJywgbGluZXMpXG4gICAgfVxuICAgIGlmIChyZXQgPT09IHRydWUpIHJldHVybiBsaW5lO1xuICB9XG5cblxufSJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/modules/project-privileges.js\n")}}]);