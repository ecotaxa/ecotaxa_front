/*! For license information please see src_modules_project-privileges_js.js.LICENSE.txt */
(self.webpackChunk=self.webpackChunk||[]).push([["src_modules_project-privileges_js"],{"./node_modules/mini-css-extract-plugin/dist/loader.js??ruleSet[1].rules[2].use[1]!./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[2].use[2]!./node_modules/postcss-loader/dist/cjs.js!./src/css/tom-select.css":()=>{eval("// extracted by mini-css-extract-plugin//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvbWluaS1jc3MtZXh0cmFjdC1wbHVnaW4vZGlzdC9sb2FkZXIuanM/P3J1bGVTZXRbMV0ucnVsZXNbMl0udXNlWzFdIS4vbm9kZV9tb2R1bGVzL2Nzcy1sb2FkZXIvZGlzdC9janMuanM/P3J1bGVTZXRbMV0ucnVsZXNbMl0udXNlWzJdIS4vbm9kZV9tb2R1bGVzL3Bvc3Rjc3MtbG9hZGVyL2Rpc3QvY2pzLmpzIS4vc3JjL2Nzcy90b20tc2VsZWN0LmNzcy5qcyIsIm1hcHBpbmdzIjoiQUFBQSIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9jc3MvdG9tLXNlbGVjdC5jc3M/ZDQwMSJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBleHRyYWN0ZWQgYnkgbWluaS1jc3MtZXh0cmFjdC1wbHVnaW4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./node_modules/mini-css-extract-plugin/dist/loader.js??ruleSet[1].rules[2].use[1]!./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[2].use[2]!./node_modules/postcss-loader/dist/cjs.js!./src/css/tom-select.css\n")},"./src/css/tom-select.css":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";eval('__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _node_modules_style_loader_dist_runtime_injectStylesIntoStyleTag_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! !../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js */ "./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js");\n/* harmony import */ var _node_modules_style_loader_dist_runtime_injectStylesIntoStyleTag_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_injectStylesIntoStyleTag_js__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _node_modules_style_loader_dist_runtime_styleDomAPI_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! !../../node_modules/style-loader/dist/runtime/styleDomAPI.js */ "./node_modules/style-loader/dist/runtime/styleDomAPI.js");\n/* harmony import */ var _node_modules_style_loader_dist_runtime_styleDomAPI_js__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_styleDomAPI_js__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _node_modules_style_loader_dist_runtime_insertBySelector_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! !../../node_modules/style-loader/dist/runtime/insertBySelector.js */ "./node_modules/style-loader/dist/runtime/insertBySelector.js");\n/* harmony import */ var _node_modules_style_loader_dist_runtime_insertBySelector_js__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_insertBySelector_js__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _node_modules_style_loader_dist_runtime_setAttributesWithoutAttributes_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! !../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js */ "./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js");\n/* harmony import */ var _node_modules_style_loader_dist_runtime_setAttributesWithoutAttributes_js__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_setAttributesWithoutAttributes_js__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var _node_modules_style_loader_dist_runtime_insertStyleElement_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! !../../node_modules/style-loader/dist/runtime/insertStyleElement.js */ "./node_modules/style-loader/dist/runtime/insertStyleElement.js");\n/* harmony import */ var _node_modules_style_loader_dist_runtime_insertStyleElement_js__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_insertStyleElement_js__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var _node_modules_style_loader_dist_runtime_styleTagTransform_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! !../../node_modules/style-loader/dist/runtime/styleTagTransform.js */ "./node_modules/style-loader/dist/runtime/styleTagTransform.js");\n/* harmony import */ var _node_modules_style_loader_dist_runtime_styleTagTransform_js__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_styleTagTransform_js__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var _node_modules_mini_css_extract_plugin_dist_loader_js_ruleSet_1_rules_2_use_1_node_modules_css_loader_dist_cjs_js_ruleSet_1_rules_2_use_2_node_modules_postcss_loader_dist_cjs_js_tom_select_css__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! !!../../node_modules/mini-css-extract-plugin/dist/loader.js??ruleSet[1].rules[2].use[1]!../../node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[2].use[2]!../../node_modules/postcss-loader/dist/cjs.js!./tom-select.css */ "./node_modules/mini-css-extract-plugin/dist/loader.js??ruleSet[1].rules[2].use[1]!./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[2].use[2]!./node_modules/postcss-loader/dist/cjs.js!./src/css/tom-select.css");\n/* harmony import */ var _node_modules_mini_css_extract_plugin_dist_loader_js_ruleSet_1_rules_2_use_1_node_modules_css_loader_dist_cjs_js_ruleSet_1_rules_2_use_2_node_modules_postcss_loader_dist_cjs_js_tom_select_css__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(_node_modules_mini_css_extract_plugin_dist_loader_js_ruleSet_1_rules_2_use_1_node_modules_css_loader_dist_cjs_js_ruleSet_1_rules_2_use_2_node_modules_postcss_loader_dist_cjs_js_tom_select_css__WEBPACK_IMPORTED_MODULE_6__);\n/* harmony reexport (unknown) */ var __WEBPACK_REEXPORT_OBJECT__ = {};\n/* harmony reexport (unknown) */ for(const __WEBPACK_IMPORT_KEY__ in _node_modules_mini_css_extract_plugin_dist_loader_js_ruleSet_1_rules_2_use_1_node_modules_css_loader_dist_cjs_js_ruleSet_1_rules_2_use_2_node_modules_postcss_loader_dist_cjs_js_tom_select_css__WEBPACK_IMPORTED_MODULE_6__) if(__WEBPACK_IMPORT_KEY__ !== "default") __WEBPACK_REEXPORT_OBJECT__[__WEBPACK_IMPORT_KEY__] = () => _node_modules_mini_css_extract_plugin_dist_loader_js_ruleSet_1_rules_2_use_1_node_modules_css_loader_dist_cjs_js_ruleSet_1_rules_2_use_2_node_modules_postcss_loader_dist_cjs_js_tom_select_css__WEBPACK_IMPORTED_MODULE_6__[__WEBPACK_IMPORT_KEY__]\n/* harmony reexport (unknown) */ __webpack_require__.d(__webpack_exports__, __WEBPACK_REEXPORT_OBJECT__);\n\n      \n      \n      \n      \n      \n      \n      \n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = (_node_modules_style_loader_dist_runtime_styleTagTransform_js__WEBPACK_IMPORTED_MODULE_5___default());\noptions.setAttributes = (_node_modules_style_loader_dist_runtime_setAttributesWithoutAttributes_js__WEBPACK_IMPORTED_MODULE_3___default());\n\n      options.insert = _node_modules_style_loader_dist_runtime_insertBySelector_js__WEBPACK_IMPORTED_MODULE_2___default().bind(null, "head");\n    \noptions.domAPI = (_node_modules_style_loader_dist_runtime_styleDomAPI_js__WEBPACK_IMPORTED_MODULE_1___default());\noptions.insertStyleElement = (_node_modules_style_loader_dist_runtime_insertStyleElement_js__WEBPACK_IMPORTED_MODULE_4___default());\n\nvar update = _node_modules_style_loader_dist_runtime_injectStylesIntoStyleTag_js__WEBPACK_IMPORTED_MODULE_0___default()((_node_modules_mini_css_extract_plugin_dist_loader_js_ruleSet_1_rules_2_use_1_node_modules_css_loader_dist_cjs_js_ruleSet_1_rules_2_use_2_node_modules_postcss_loader_dist_cjs_js_tom_select_css__WEBPACK_IMPORTED_MODULE_6___default()), options);\n\n\n\n\n       /* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((_node_modules_mini_css_extract_plugin_dist_loader_js_ruleSet_1_rules_2_use_1_node_modules_css_loader_dist_cjs_js_ruleSet_1_rules_2_use_2_node_modules_postcss_loader_dist_cjs_js_tom_select_css__WEBPACK_IMPORTED_MODULE_6___default()) && (_node_modules_mini_css_extract_plugin_dist_loader_js_ruleSet_1_rules_2_use_1_node_modules_css_loader_dist_cjs_js_ruleSet_1_rules_2_use_2_node_modules_postcss_loader_dist_cjs_js_tom_select_css__WEBPACK_IMPORTED_MODULE_6___default().locals) ? (_node_modules_mini_css_extract_plugin_dist_loader_js_ruleSet_1_rules_2_use_1_node_modules_css_loader_dist_cjs_js_ruleSet_1_rules_2_use_2_node_modules_postcss_loader_dist_cjs_js_tom_select_css__WEBPACK_IMPORTED_MODULE_6___default().locals) : undefined);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvY3NzL3RvbS1zZWxlY3QuY3NzLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFDQSxNQUFrRztBQUNsRyxNQUF3RjtBQUN4RixNQUErRjtBQUMvRixNQUFrSDtBQUNsSCxNQUEyRztBQUMzRyxNQUEyRztBQUMzRyxNQUEyUTtBQUMzUTtBQUNBOztBQUVBOztBQUVBLDRCQUE0QixxR0FBbUI7QUFDL0Msd0JBQXdCLGtIQUFhOztBQUVyQyx1QkFBdUIsdUdBQWE7QUFDcEM7QUFDQSxpQkFBaUIsK0ZBQU07QUFDdkIsNkJBQTZCLHNHQUFrQjs7QUFFL0MsYUFBYSwwR0FBRyxDQUFDLHdPQUFPOzs7O0FBSXFOO0FBQzdPLE9BQU8saUVBQWUsd09BQU8sSUFBSSwrT0FBYyxHQUFHLCtPQUFjLFlBQVksRUFBQyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9jc3MvdG9tLXNlbGVjdC5jc3M/YTVlOCJdLCJzb3VyY2VzQ29udGVudCI6WyJcbiAgICAgIGltcG9ydCBBUEkgZnJvbSBcIiEuLi8uLi9ub2RlX21vZHVsZXMvc3R5bGUtbG9hZGVyL2Rpc3QvcnVudGltZS9pbmplY3RTdHlsZXNJbnRvU3R5bGVUYWcuanNcIjtcbiAgICAgIGltcG9ydCBkb21BUEkgZnJvbSBcIiEuLi8uLi9ub2RlX21vZHVsZXMvc3R5bGUtbG9hZGVyL2Rpc3QvcnVudGltZS9zdHlsZURvbUFQSS5qc1wiO1xuICAgICAgaW1wb3J0IGluc2VydEZuIGZyb20gXCIhLi4vLi4vbm9kZV9tb2R1bGVzL3N0eWxlLWxvYWRlci9kaXN0L3J1bnRpbWUvaW5zZXJ0QnlTZWxlY3Rvci5qc1wiO1xuICAgICAgaW1wb3J0IHNldEF0dHJpYnV0ZXMgZnJvbSBcIiEuLi8uLi9ub2RlX21vZHVsZXMvc3R5bGUtbG9hZGVyL2Rpc3QvcnVudGltZS9zZXRBdHRyaWJ1dGVzV2l0aG91dEF0dHJpYnV0ZXMuanNcIjtcbiAgICAgIGltcG9ydCBpbnNlcnRTdHlsZUVsZW1lbnQgZnJvbSBcIiEuLi8uLi9ub2RlX21vZHVsZXMvc3R5bGUtbG9hZGVyL2Rpc3QvcnVudGltZS9pbnNlcnRTdHlsZUVsZW1lbnQuanNcIjtcbiAgICAgIGltcG9ydCBzdHlsZVRhZ1RyYW5zZm9ybUZuIGZyb20gXCIhLi4vLi4vbm9kZV9tb2R1bGVzL3N0eWxlLWxvYWRlci9kaXN0L3J1bnRpbWUvc3R5bGVUYWdUcmFuc2Zvcm0uanNcIjtcbiAgICAgIGltcG9ydCBjb250ZW50LCAqIGFzIG5hbWVkRXhwb3J0IGZyb20gXCIhIS4uLy4uL25vZGVfbW9kdWxlcy9taW5pLWNzcy1leHRyYWN0LXBsdWdpbi9kaXN0L2xvYWRlci5qcz8/cnVsZVNldFsxXS5ydWxlc1syXS51c2VbMV0hLi4vLi4vbm9kZV9tb2R1bGVzL2Nzcy1sb2FkZXIvZGlzdC9janMuanM/P3J1bGVTZXRbMV0ucnVsZXNbMl0udXNlWzJdIS4uLy4uL25vZGVfbW9kdWxlcy9wb3N0Y3NzLWxvYWRlci9kaXN0L2Nqcy5qcyEuL3RvbS1zZWxlY3QuY3NzXCI7XG4gICAgICBcbiAgICAgIFxuXG52YXIgb3B0aW9ucyA9IHt9O1xuXG5vcHRpb25zLnN0eWxlVGFnVHJhbnNmb3JtID0gc3R5bGVUYWdUcmFuc2Zvcm1Gbjtcbm9wdGlvbnMuc2V0QXR0cmlidXRlcyA9IHNldEF0dHJpYnV0ZXM7XG5cbiAgICAgIG9wdGlvbnMuaW5zZXJ0ID0gaW5zZXJ0Rm4uYmluZChudWxsLCBcImhlYWRcIik7XG4gICAgXG5vcHRpb25zLmRvbUFQSSA9IGRvbUFQSTtcbm9wdGlvbnMuaW5zZXJ0U3R5bGVFbGVtZW50ID0gaW5zZXJ0U3R5bGVFbGVtZW50O1xuXG52YXIgdXBkYXRlID0gQVBJKGNvbnRlbnQsIG9wdGlvbnMpO1xuXG5cblxuZXhwb3J0ICogZnJvbSBcIiEhLi4vLi4vbm9kZV9tb2R1bGVzL21pbmktY3NzLWV4dHJhY3QtcGx1Z2luL2Rpc3QvbG9hZGVyLmpzPz9ydWxlU2V0WzFdLnJ1bGVzWzJdLnVzZVsxXSEuLi8uLi9ub2RlX21vZHVsZXMvY3NzLWxvYWRlci9kaXN0L2Nqcy5qcz8/cnVsZVNldFsxXS5ydWxlc1syXS51c2VbMl0hLi4vLi4vbm9kZV9tb2R1bGVzL3Bvc3Rjc3MtbG9hZGVyL2Rpc3QvY2pzLmpzIS4vdG9tLXNlbGVjdC5jc3NcIjtcbiAgICAgICBleHBvcnQgZGVmYXVsdCBjb250ZW50ICYmIGNvbnRlbnQubG9jYWxzID8gY29udGVudC5sb2NhbHMgOiB1bmRlZmluZWQ7XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/css/tom-select.css\n')},"./src/modules/form-submit.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"FormSubmit\": () => (/* binding */ FormSubmit)\n/* harmony export */ });\n/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! dompurify */ \"./node_modules/dompurify/dist/purify.js\");\n/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(dompurify__WEBPACK_IMPORTED_MODULE_0__);\n\n\nlet instance = null;\nconst formcss = {\n  invalid: 'invalid',\n  inputvalidate: 'input-validate'\n}\nclass FormSubmit {\n  handlers = [];\n  form = null;\n  listener = null;\n  constructor(form, options = {}) {\n    if (!instance) {\n      if (!form) return;\n      const defaultOptions = {};\n      this.options = Object.assign(defaultOptions, options);\n      this.form = form instanceof HTMLElement ? form : document.querySelector(form);\n      this.validateFields(true);\n      this.init();\n      instance = this;\n    }\n    return instance;\n  }\n  init() {\n    // init the form ( options like beforeunload etc...)\n    this.form.addEventListener('submit', async (e) => {\n      console.log('----------------formsubmit', e)\n      const res = await this.submitForm();\n      e.preventDefault();\n    });\n    // check if there is a password confirm input\n    this.form.querySelectorAll('input[data-match]').forEach(input => {\n      //\n      const match = input.dataset.match;\n      if (!match) return;\n      const target = document.getElementById(match);\n      if (!target) return;\n      const invalid = (input.dataset.matchinvalid) ? input.dataset.matchinvalid : \"no match\";\n      const label = input.closest('label');\n      const check_match = (item, itemtarget) => {\n        if (item.value !== itemtarget.value) {\n          item.setCustomValidity(invalid);\n          itemtarget.setCustomValidity(invalid);\n          if (input != item) {\n            if (label) label.classList.add(formcss.invalid);\n            input.classList.add(formcss.inputvalidate);\n          }\n        } else {\n          item.setCustomValidity(\"\");\n          itemtarget.setCustomValidity(\"\");\n          item.dataset.invalid = '';\n          itemtarget.dataset.invalid = '';\n          if (input != item) {\n            if (label) label.classList.remove(formcss.invalid);\n            input.classList.remove(formcss.inputvalidate);\n\n          }\n        }\n        item.reportValidity();\n        itemtarget.reportValidity();\n        item.focus();\n      };\n      [input, target].forEach(item => {\n        item.addEventListener('keyup', (e) => {\n          const itemtarget = (item === input) ? target : input;\n          check_match(item, itemtarget);\n        });\n      });\n\n    });\n  }\n\n  validateField(field) {\n\n    const get_message = (field) => {\n      let message = 'invalid';\n      if (field.required) message = (field.dataset.required) ? field.dataset.required : ((this.form.dataset.required) ? this.form.dataset.required : 'invalid');\n      if (message === 'invalid') message = (field.dataset.invalid) ? field.dataset.invalid : ((this.form.dataset.invalid) ? this.form.dataset.invalid : 'invalid input');\n      return message;\n    }\n\n\n    field.value = dompurify__WEBPACK_IMPORTED_MODULE_0___default().sanitize(field.value);\n    const rep = field.checkValidity();\n    const label = field.closest('.form-box') ? field.closest('.form-box').querySelector('label') : null;\n\n    if (rep && label) label.classList.remove(formcss.invalid);\n\n    else if (!rep) {\n      if (label) {\n        label.dataset.invalid = get_message(field);\n        label.classList.add(formcss.invalid);\n      }\n\n    }\n\n    if (field.classList.contains('tomselected') && field.nextElementSibling) {\n      field.nextElementSibling.classList.add(formcss.inputvalidate);\n    } else field.classList.add(formcss.inputvalidate);\n\n    return rep;\n  }\n\n  validateFields(init = false) {\n\n    // todo: complete validation foreach field type\n    let resp = true;\n\n    this.form.querySelectorAll('input,textarea, select').forEach(field => {\n      if (init === true) {\n        if (!field.dataset.listen) {\n          ['change', 'blur'].forEach(evt => {\n            field.addEventListener(evt, (e) => {\n              this.validateField(e.currentTarget);\n            });\n          });\n          field.dataset.listen = true;\n        }\n      } else {\n        const rep = this.validateField(field);\n        resp = (resp && rep);\n      }\n\n\n    });\n    return resp;\n  }\n  addHandler(handler) {\n    this.handlers.push(handler);\n  }\n  fieldEnable() {\n    this.form.querySelectorAll('input[data-sub=\"enable\"]').forEach(input => {\n      input.removeAttribute('disabled');\n    });\n  }\n  async submitHandler() {\n    if (!this.validateFields()) return false;\n    if (this.handlers.length === 0) return true;\n    let resp = true;\n    // series\n    /*  for (const handler of this.handlers) {\n          const rep = await handler()\n          resp = (resp && rep)\n      }*/\n    // concurrent\n    await Promise.all(this.handlers.map(async handler => {\n      const rep = await handler();\n      resp = (resp && rep);\n    }));\n    if (resp === true) this.handlers = [];\n    console.log('resp', resp)\n    return resp;\n  }\n  async submitForm() {\n    if (this.validateFields(false)) {\n      const yessubmit = await this.submitHandler();\n      if (yessubmit) {\n        this.fieldEnable();\n        this.form.submit();\n      } else return false;\n    } else return false;\n  }\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvbW9kdWxlcy9mb3JtLXN1Ym1pdC5qcy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBa0M7QUFDQTtBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0M7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULE9BQU87O0FBRVAsS0FBSztBQUNMOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0Esa0JBQWtCLHlEQUFrQjtBQUNwQztBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLE1BQU07O0FBRU47QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixXQUFXO0FBQ1g7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7OztBQUdBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUixNQUFNO0FBQ047QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9tb2R1bGVzL2Zvcm0tc3VibWl0LmpzP2M2YjciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHZhbGlkYXRvciBmcm9tICd2YWxpZGF0b3InO1xuaW1wb3J0IERPTVB1cmlmeSBmcm9tICdkb21wdXJpZnknO1xubGV0IGluc3RhbmNlID0gbnVsbDtcbmNvbnN0IGZvcm1jc3MgPSB7XG4gIGludmFsaWQ6ICdpbnZhbGlkJyxcbiAgaW5wdXR2YWxpZGF0ZTogJ2lucHV0LXZhbGlkYXRlJ1xufVxuZXhwb3J0IGNsYXNzIEZvcm1TdWJtaXQge1xuICBoYW5kbGVycyA9IFtdO1xuICBmb3JtID0gbnVsbDtcbiAgbGlzdGVuZXIgPSBudWxsO1xuICBjb25zdHJ1Y3Rvcihmb3JtLCBvcHRpb25zID0ge30pIHtcbiAgICBpZiAoIWluc3RhbmNlKSB7XG4gICAgICBpZiAoIWZvcm0pIHJldHVybjtcbiAgICAgIGNvbnN0IGRlZmF1bHRPcHRpb25zID0ge307XG4gICAgICB0aGlzLm9wdGlvbnMgPSBPYmplY3QuYXNzaWduKGRlZmF1bHRPcHRpb25zLCBvcHRpb25zKTtcbiAgICAgIHRoaXMuZm9ybSA9IGZvcm0gaW5zdGFuY2VvZiBIVE1MRWxlbWVudCA/IGZvcm0gOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGZvcm0pO1xuICAgICAgdGhpcy52YWxpZGF0ZUZpZWxkcyh0cnVlKTtcbiAgICAgIHRoaXMuaW5pdCgpO1xuICAgICAgaW5zdGFuY2UgPSB0aGlzO1xuICAgIH1cbiAgICByZXR1cm4gaW5zdGFuY2U7XG4gIH1cbiAgaW5pdCgpIHtcbiAgICAvLyBpbml0IHRoZSBmb3JtICggb3B0aW9ucyBsaWtlIGJlZm9yZXVubG9hZCBldGMuLi4pXG4gICAgdGhpcy5mb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIGFzeW5jIChlKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZygnLS0tLS0tLS0tLS0tLS0tLWZvcm1zdWJtaXQnLCBlKVxuICAgICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5zdWJtaXRGb3JtKCk7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgfSk7XG4gICAgLy8gY2hlY2sgaWYgdGhlcmUgaXMgYSBwYXNzd29yZCBjb25maXJtIGlucHV0XG4gICAgdGhpcy5mb3JtLnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0W2RhdGEtbWF0Y2hdJykuZm9yRWFjaChpbnB1dCA9PiB7XG4gICAgICAvL1xuICAgICAgY29uc3QgbWF0Y2ggPSBpbnB1dC5kYXRhc2V0Lm1hdGNoO1xuICAgICAgaWYgKCFtYXRjaCkgcmV0dXJuO1xuICAgICAgY29uc3QgdGFyZ2V0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobWF0Y2gpO1xuICAgICAgaWYgKCF0YXJnZXQpIHJldHVybjtcbiAgICAgIGNvbnN0IGludmFsaWQgPSAoaW5wdXQuZGF0YXNldC5tYXRjaGludmFsaWQpID8gaW5wdXQuZGF0YXNldC5tYXRjaGludmFsaWQgOiBcIm5vIG1hdGNoXCI7XG4gICAgICBjb25zdCBsYWJlbCA9IGlucHV0LmNsb3Nlc3QoJ2xhYmVsJyk7XG4gICAgICBjb25zdCBjaGVja19tYXRjaCA9IChpdGVtLCBpdGVtdGFyZ2V0KSA9PiB7XG4gICAgICAgIGlmIChpdGVtLnZhbHVlICE9PSBpdGVtdGFyZ2V0LnZhbHVlKSB7XG4gICAgICAgICAgaXRlbS5zZXRDdXN0b21WYWxpZGl0eShpbnZhbGlkKTtcbiAgICAgICAgICBpdGVtdGFyZ2V0LnNldEN1c3RvbVZhbGlkaXR5KGludmFsaWQpO1xuICAgICAgICAgIGlmIChpbnB1dCAhPSBpdGVtKSB7XG4gICAgICAgICAgICBpZiAobGFiZWwpIGxhYmVsLmNsYXNzTGlzdC5hZGQoZm9ybWNzcy5pbnZhbGlkKTtcbiAgICAgICAgICAgIGlucHV0LmNsYXNzTGlzdC5hZGQoZm9ybWNzcy5pbnB1dHZhbGlkYXRlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaXRlbS5zZXRDdXN0b21WYWxpZGl0eShcIlwiKTtcbiAgICAgICAgICBpdGVtdGFyZ2V0LnNldEN1c3RvbVZhbGlkaXR5KFwiXCIpO1xuICAgICAgICAgIGl0ZW0uZGF0YXNldC5pbnZhbGlkID0gJyc7XG4gICAgICAgICAgaXRlbXRhcmdldC5kYXRhc2V0LmludmFsaWQgPSAnJztcbiAgICAgICAgICBpZiAoaW5wdXQgIT0gaXRlbSkge1xuICAgICAgICAgICAgaWYgKGxhYmVsKSBsYWJlbC5jbGFzc0xpc3QucmVtb3ZlKGZvcm1jc3MuaW52YWxpZCk7XG4gICAgICAgICAgICBpbnB1dC5jbGFzc0xpc3QucmVtb3ZlKGZvcm1jc3MuaW5wdXR2YWxpZGF0ZSk7XG5cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaXRlbS5yZXBvcnRWYWxpZGl0eSgpO1xuICAgICAgICBpdGVtdGFyZ2V0LnJlcG9ydFZhbGlkaXR5KCk7XG4gICAgICAgIGl0ZW0uZm9jdXMoKTtcbiAgICAgIH07XG4gICAgICBbaW5wdXQsIHRhcmdldF0uZm9yRWFjaChpdGVtID0+IHtcbiAgICAgICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIChlKSA9PiB7XG4gICAgICAgICAgY29uc3QgaXRlbXRhcmdldCA9IChpdGVtID09PSBpbnB1dCkgPyB0YXJnZXQgOiBpbnB1dDtcbiAgICAgICAgICBjaGVja19tYXRjaChpdGVtLCBpdGVtdGFyZ2V0KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgIH0pO1xuICB9XG5cbiAgdmFsaWRhdGVGaWVsZChmaWVsZCkge1xuXG4gICAgY29uc3QgZ2V0X21lc3NhZ2UgPSAoZmllbGQpID0+IHtcbiAgICAgIGxldCBtZXNzYWdlID0gJ2ludmFsaWQnO1xuICAgICAgaWYgKGZpZWxkLnJlcXVpcmVkKSBtZXNzYWdlID0gKGZpZWxkLmRhdGFzZXQucmVxdWlyZWQpID8gZmllbGQuZGF0YXNldC5yZXF1aXJlZCA6ICgodGhpcy5mb3JtLmRhdGFzZXQucmVxdWlyZWQpID8gdGhpcy5mb3JtLmRhdGFzZXQucmVxdWlyZWQgOiAnaW52YWxpZCcpO1xuICAgICAgaWYgKG1lc3NhZ2UgPT09ICdpbnZhbGlkJykgbWVzc2FnZSA9IChmaWVsZC5kYXRhc2V0LmludmFsaWQpID8gZmllbGQuZGF0YXNldC5pbnZhbGlkIDogKCh0aGlzLmZvcm0uZGF0YXNldC5pbnZhbGlkKSA/IHRoaXMuZm9ybS5kYXRhc2V0LmludmFsaWQgOiAnaW52YWxpZCBpbnB1dCcpO1xuICAgICAgcmV0dXJuIG1lc3NhZ2U7XG4gICAgfVxuXG5cbiAgICBmaWVsZC52YWx1ZSA9IERPTVB1cmlmeS5zYW5pdGl6ZShmaWVsZC52YWx1ZSk7XG4gICAgY29uc3QgcmVwID0gZmllbGQuY2hlY2tWYWxpZGl0eSgpO1xuICAgIGNvbnN0IGxhYmVsID0gZmllbGQuY2xvc2VzdCgnLmZvcm0tYm94JykgPyBmaWVsZC5jbG9zZXN0KCcuZm9ybS1ib3gnKS5xdWVyeVNlbGVjdG9yKCdsYWJlbCcpIDogbnVsbDtcblxuICAgIGlmIChyZXAgJiYgbGFiZWwpIGxhYmVsLmNsYXNzTGlzdC5yZW1vdmUoZm9ybWNzcy5pbnZhbGlkKTtcblxuICAgIGVsc2UgaWYgKCFyZXApIHtcbiAgICAgIGlmIChsYWJlbCkge1xuICAgICAgICBsYWJlbC5kYXRhc2V0LmludmFsaWQgPSBnZXRfbWVzc2FnZShmaWVsZCk7XG4gICAgICAgIGxhYmVsLmNsYXNzTGlzdC5hZGQoZm9ybWNzcy5pbnZhbGlkKTtcbiAgICAgIH1cblxuICAgIH1cblxuICAgIGlmIChmaWVsZC5jbGFzc0xpc3QuY29udGFpbnMoJ3RvbXNlbGVjdGVkJykgJiYgZmllbGQubmV4dEVsZW1lbnRTaWJsaW5nKSB7XG4gICAgICBmaWVsZC5uZXh0RWxlbWVudFNpYmxpbmcuY2xhc3NMaXN0LmFkZChmb3JtY3NzLmlucHV0dmFsaWRhdGUpO1xuICAgIH0gZWxzZSBmaWVsZC5jbGFzc0xpc3QuYWRkKGZvcm1jc3MuaW5wdXR2YWxpZGF0ZSk7XG5cbiAgICByZXR1cm4gcmVwO1xuICB9XG5cbiAgdmFsaWRhdGVGaWVsZHMoaW5pdCA9IGZhbHNlKSB7XG5cbiAgICAvLyB0b2RvOiBjb21wbGV0ZSB2YWxpZGF0aW9uIGZvcmVhY2ggZmllbGQgdHlwZVxuICAgIGxldCByZXNwID0gdHJ1ZTtcblxuICAgIHRoaXMuZm9ybS5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dCx0ZXh0YXJlYSwgc2VsZWN0JykuZm9yRWFjaChmaWVsZCA9PiB7XG4gICAgICBpZiAoaW5pdCA9PT0gdHJ1ZSkge1xuICAgICAgICBpZiAoIWZpZWxkLmRhdGFzZXQubGlzdGVuKSB7XG4gICAgICAgICAgWydjaGFuZ2UnLCAnYmx1ciddLmZvckVhY2goZXZ0ID0+IHtcbiAgICAgICAgICAgIGZpZWxkLmFkZEV2ZW50TGlzdGVuZXIoZXZ0LCAoZSkgPT4ge1xuICAgICAgICAgICAgICB0aGlzLnZhbGlkYXRlRmllbGQoZS5jdXJyZW50VGFyZ2V0KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGZpZWxkLmRhdGFzZXQubGlzdGVuID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgcmVwID0gdGhpcy52YWxpZGF0ZUZpZWxkKGZpZWxkKTtcbiAgICAgICAgcmVzcCA9IChyZXNwICYmIHJlcCk7XG4gICAgICB9XG5cblxuICAgIH0pO1xuICAgIHJldHVybiByZXNwO1xuICB9XG4gIGFkZEhhbmRsZXIoaGFuZGxlcikge1xuICAgIHRoaXMuaGFuZGxlcnMucHVzaChoYW5kbGVyKTtcbiAgfVxuICBmaWVsZEVuYWJsZSgpIHtcbiAgICB0aGlzLmZvcm0ucXVlcnlTZWxlY3RvckFsbCgnaW5wdXRbZGF0YS1zdWI9XCJlbmFibGVcIl0nKS5mb3JFYWNoKGlucHV0ID0+IHtcbiAgICAgIGlucHV0LnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgICB9KTtcbiAgfVxuICBhc3luYyBzdWJtaXRIYW5kbGVyKCkge1xuICAgIGlmICghdGhpcy52YWxpZGF0ZUZpZWxkcygpKSByZXR1cm4gZmFsc2U7XG4gICAgaWYgKHRoaXMuaGFuZGxlcnMubGVuZ3RoID09PSAwKSByZXR1cm4gdHJ1ZTtcbiAgICBsZXQgcmVzcCA9IHRydWU7XG4gICAgLy8gc2VyaWVzXG4gICAgLyogIGZvciAoY29uc3QgaGFuZGxlciBvZiB0aGlzLmhhbmRsZXJzKSB7XG4gICAgICAgICAgY29uc3QgcmVwID0gYXdhaXQgaGFuZGxlcigpXG4gICAgICAgICAgcmVzcCA9IChyZXNwICYmIHJlcClcbiAgICAgIH0qL1xuICAgIC8vIGNvbmN1cnJlbnRcbiAgICBhd2FpdCBQcm9taXNlLmFsbCh0aGlzLmhhbmRsZXJzLm1hcChhc3luYyBoYW5kbGVyID0+IHtcbiAgICAgIGNvbnN0IHJlcCA9IGF3YWl0IGhhbmRsZXIoKTtcbiAgICAgIHJlc3AgPSAocmVzcCAmJiByZXApO1xuICAgIH0pKTtcbiAgICBpZiAocmVzcCA9PT0gdHJ1ZSkgdGhpcy5oYW5kbGVycyA9IFtdO1xuICAgIGNvbnNvbGUubG9nKCdyZXNwJywgcmVzcClcbiAgICByZXR1cm4gcmVzcDtcbiAgfVxuICBhc3luYyBzdWJtaXRGb3JtKCkge1xuICAgIGlmICh0aGlzLnZhbGlkYXRlRmllbGRzKGZhbHNlKSkge1xuICAgICAgY29uc3QgeWVzc3VibWl0ID0gYXdhaXQgdGhpcy5zdWJtaXRIYW5kbGVyKCk7XG4gICAgICBpZiAoeWVzc3VibWl0KSB7XG4gICAgICAgIHRoaXMuZmllbGRFbmFibGUoKTtcbiAgICAgICAgdGhpcy5mb3JtLnN1Ym1pdCgpO1xuICAgICAgfSBlbHNlIHJldHVybiBmYWxzZTtcbiAgICB9IGVsc2UgcmV0dXJuIGZhbHNlO1xuICB9XG59Il0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/modules/form-submit.js\n")},"./src/modules/js-tom-select.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"JsTomSelect\": () => (/* binding */ JsTomSelect)\n/* harmony export */ });\n/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! dompurify */ \"./node_modules/dompurify/dist/purify.js\");\n/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(dompurify__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var tom_select_dist_js_tom_select_base_min_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! tom-select/dist/js/tom-select.base.min.js */ \"./node_modules/tom-select/dist/js/tom-select.base.min.js\");\n/* harmony import */ var tom_select_dist_js_tom_select_base_min_js__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(tom_select_dist_js_tom_select_base_min_js__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _css_tom_select_css__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../css/tom-select.css */ \"./src/css/tom-select.css\");\n/* harmony import */ var _modules_utils_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../modules/utils.js */ \"./src/modules/utils.js\");\n/* harmony import */ var _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../modules/modules-config.js */ \"./src/modules/modules-config.js\");\n\n\n\n\n\nlet users_list = {};\n\n// settings for autocomplete select component - users , instruments , taxons\nclass JsTomSelect {\n  applyTo(item, siblings = null) {\n    const id = item.getAttribute('id');\n    const multiple = item.hasAttribute('multiple');\n    const type = item.dataset.type;\n    let option = {\n        url: '',\n        settings: {}\n      },\n      init_canceltag = (tag) => {\n        tag.addEventListener('click', (e) => {\n          const v = e.currentTarget.closest(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.domselectors.component.tomselect.item).dataset.value;\n          if (v) {\n            e.stopImmediatePropagation();\n            item.tomselect.removeItem(v);\n          }\n        })\n      };\n\n    switch (type) {\n      case _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.models.project:\n        option.url = \"/gui/prjlist/\";\n        option.settings = {\n          valueField: 'id',\n          searchField: 'text',\n          labelField: 'text',\n          openOnFocus: false,\n          maxItems: 1,\n          allowEmptyOption: false,\n          onItemAdd: function(e) {\n            if (e != item.dataset.value) {\n              let href = window.location.href.split('/');\n              href.pop();\n              href = href.join('/') + '/' + e;\n\n              window.open(href, '_blank').focus();\n            }\n            this.removeItem(e);\n            return;\n          }\n        };\n        break;\n\n      case _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.models.user:\n        option.url = \"/api/users/search?by_name=\";\n        option.settings = {\n          valueField: 'id',\n          searchField: 'name',\n          labelField: 'name',\n          onInitialize: function() {\n            item.tomselect.items.forEach(e => {\n              users_list[e] = true;\n            });\n          },\n          onItemAdd: function(e) {\n            if (users_list[e]) {\n              if (!this.revertSettings || this.revertSettings.tabIndex < 0 || !item.querySelectorAll('option')) return;\n              const revert = item.querySelectorAll('option')[this.revertSettings.tabIndex].value;\n              this.removeOption(e);\n              this.addItem(revert);\n              users_list[e] = false;\n            } else users_list[e] = true;\n          },\n          onItemRemove: function(e) {\n            if (users_list[e]) delete users_list[e];\n            if (!this.revertSettings || this.revertSettings.tabIndex < 0) return;\n            const revert = item.querySelectorAll('option')[this.revertSettings.tabIndex].value;\n            if (users_list[revert] !== undefined) delete users_list[revert];\n          }\n        };\n        break;\n      case _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.models.instr:\n        option.url = \"/search/instruments\";\n        option.settings = {\n          valueField: 'id',\n          labelField: 'text',\n          searchField: 'id',\n          maxItems: 1,\n          preload: true\n        };\n        break;\n      case _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.models.taxo:\n        tom_select_dist_js_tom_select_base_min_js__WEBPACK_IMPORTED_MODULE_1___default().define('no_close', () => {\n          this.close = () => {};\n        });\n        //option.settings.plugins.push('no-close')\n        option.url = \"/search/taxo\";\n        option.settings = {\n          valueField: 'id',\n          labelField: 'text',\n          searchField: 'text',\n          onInitialize: () => {\n            const wrapper = document.getElementById(id).nextElementSibling;\n            if (!wrapper.classList.contains('ts-wrapper')) return;\n            const tags = wrapper.querySelectorAll(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.domselectors.component.tomselect.tsdelet);\n            tags.forEach(tag => {\n              init_canceltag(tag);\n            })\n          }\n\n        }\n        break;\n    }\n    const default_settings = {\n      create: false,\n      maxOptions: null,\n      preload: false,\n      hideSelected: true,\n      duplicates: false,\n      allowEmptyOption: true,\n      closeAfterSelect: true,\n      placeholder: (item.placeholder) ? item.placeholder : ((item.dataset.placeholder) ? item.dataset.placeholder : ''),\n      onDropdownClose: function() {\n\n      },\n      shouldLoad: function(query) {\n        return query.length > 2\n      },\n\n      load: function(query, callback) {\n        query = dompurify__WEBPACK_IMPORTED_MODULE_0___default().sanitize(query);\n\n        const self = this;\n        if (self.loading > 10) {\n\n          callback();\n          return;\n        }\n        let url = '';\n        switch (type) {\n          case _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.models.user:\n            url = option.url + encodeURIComponent('%' + query + '%');\n            break;\n          case _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.models.instr:\n          case _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.models.taxo:\n            url = option.url;\n            if (query) url += '?q=' + encodeURIComponent(query);\n\n            break;\n          case _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.models.project:\n            url = option.url;\n            if (query) url += '?filt_title=' + encodeURIComponent(query); //+ '&filt_instrum=' + encodeURIComponent(query);\n            break;\n        }\n        if (url !== null) fetch(url, (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_3__.fetchSettings)()).then(response => response.json()).then(json => {\n          if (type === _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.models.project) {\n            if (json.data && json.data.length) json = json.data.map(row => {\n              return {\n                id: row[1],\n                text: row[3][0]\n              }\n\n            });\n          }\n          if (type === _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.models.instr && json.length) json = json.reduce((result, a, v) => {\n            a = dompurify__WEBPACK_IMPORTED_MODULE_0___default().sanitize(a);\n            let obj = {\n              id: a,\n              text: a\n            }\n            result.push(obj);\n            return result;\n          }, []);\n\n          if (json.length && typeof json == 'object') json = Object.entries(json);\n          return callback(json);\n\n        }).catch(err => {\n          console.log('tomselect-err', err);\n        });\n      },\n\n      render: {\n        option: function(el, escape) {\n          if (el === undefined || el === null) return ``;\n          // add optgroup\n          const optgroup = (el.optgroup) ? `data-optgroup=${el.optgroup}` : ``;\n          return `<div class=\"py-2 flex  ${ ((multiple)?'inline-flex':'') } \" ${optgroup} data-value=\"${el[option.settings.valueField]}\">${ escape(el[this.settings.labelField]) }</div>`;\n        },\n        item: function(el, escape) {\n          if (el === undefined || el === null) return ``; // add optgroup\n          const optgroup = (el.optgroup) ? `item-${el.optgroup}` : ``;\n          // add cancel icon for multiple selections\n          const cancel = ((multiple) ? `<i class=\"${_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.domselectors.component.tomselect.tsdelet.substr(1)}\"></i>` : ``);\n          return dompurify__WEBPACK_IMPORTED_MODULE_0___default().sanitize(`<div class=\"` + ((multiple) ? `flex inline-flex ` : ``) + ` ${optgroup}\" data-value=\"${el[this.settings.valueField]}\">${ escape(el[this.settings.labelField])} ${ cancel }</div>`);\n        },\n        no_results: function(data, escape) {\n          return dompurify__WEBPACK_IMPORTED_MODULE_0___default().sanitize('<div class=\"no-results\">' + ((item.dataset.noresults) ? item.dataset.noresults : 'No result found for ') + escape(data.input) + '</div>');\n        },\n      }\n    }\n\n    option.settings = Object.assign(default_settings, option.settings)\n    if (id !== null) {\n      const ts = new (tom_select_dist_js_tom_select_base_min_js__WEBPACK_IMPORTED_MODULE_1___default())('#' + id, option.settings);\n\n      ts.wrapper.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.domselectors.component.tomselect.ident);\n      ts.wrapper.classList.remove('js');\n      // add\n      ts.wrapper.setAttribute('data-component', 'tom-select');\n      switch (type) {\n        case 'taxo':\n          ts.on('item_add', (v, el) => {\n            if (el !== null) el.classList.add('new');\n            el = el.querySelector('.ts-delet');\n            if (el !== null) init_canceltag(el);\n          });\n          break;\n        case 'user':\n          if (item.dataset.priv) ts.on(\"item_add\", function(v, el) {\n            el = el.querySelector(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.domselectors.component.tomselect.tsdelet);\n            if (el !== null) init_canceltag(el);\n          });\n          break;\n      }\n      return ts;\n    } else console.log('noid');\n\n  }\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvbW9kdWxlcy9qcy10b20tc2VsZWN0LmpzLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQWtDO0FBQ2dDO0FBQ2pCO0FBR3BCO0FBSVM7QUFDdEM7O0FBRUE7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQSw0Q0FBNEMsNkZBQXFDO0FBQ2pGO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUOztBQUVBO0FBQ0EsV0FBVyxzRUFBYztBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxXQUFXLG1FQUFXO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYztBQUNkLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVyxvRUFBWTtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLG1FQUFXO0FBQ3RCLFFBQVEsdUZBQWdCO0FBQ3hCO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtEQUFrRCxnR0FBd0M7QUFDMUY7QUFDQTtBQUNBLGFBQWE7QUFDYjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPO0FBQ1A7QUFDQTtBQUNBLE9BQU87O0FBRVA7QUFDQSxnQkFBZ0IseURBQWtCOztBQUVsQztBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlLG1FQUFXO0FBQzFCO0FBQ0E7QUFDQSxlQUFlLG9FQUFZO0FBQzNCLGVBQWUsbUVBQVc7QUFDMUI7QUFDQTs7QUFFQTtBQUNBLGVBQWUsc0VBQWM7QUFDN0I7QUFDQSwwRUFBMEU7QUFDMUU7QUFDQTtBQUNBLHFDQUFxQyxnRUFBYTtBQUNsRCx1QkFBdUIsc0VBQWM7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxhQUFhO0FBQ2I7QUFDQSx1QkFBdUIsb0VBQVk7QUFDbkMsZ0JBQWdCLHlEQUFrQjtBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXOztBQUVYO0FBQ0E7O0FBRUEsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNULE9BQU87O0FBRVA7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0REFBNEQsWUFBWTtBQUN4RSw0Q0FBNEMsZ0NBQWdDLElBQUksVUFBVSxjQUFjLCtCQUErQixLQUFLLHNDQUFzQztBQUNsTCxTQUFTO0FBQ1Q7QUFDQSwwREFBMEQ7QUFDMUQsbURBQW1ELFlBQVk7QUFDL0Q7QUFDQSxvREFBb0QsdUdBQStDLElBQUk7QUFDdkcsaUJBQWlCLHlEQUFrQixnRUFBZ0UsU0FBUyxnQkFBZ0IsNkJBQTZCLEtBQUssc0NBQXNDLEdBQUcsUUFBUTtBQUMvTSxTQUFTO0FBQ1Q7QUFDQSxpQkFBaUIseURBQWtCO0FBQ25DLFNBQVM7QUFDVDtBQUNBOztBQUVBO0FBQ0E7QUFDQSxxQkFBcUIsa0ZBQVM7O0FBRTlCLGtDQUFrQyw4RkFBc0M7QUFDeEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQyxnR0FBd0M7QUFDMUU7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsTUFBTTs7QUFFTjtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vc3JjL21vZHVsZXMvanMtdG9tLXNlbGVjdC5qcz9mNDAyIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBET01QdXJpZnkgZnJvbSAnZG9tcHVyaWZ5JztcbmltcG9ydCBUb21TZWxlY3QgZnJvbSAndG9tLXNlbGVjdC9kaXN0L2pzL3RvbS1zZWxlY3QuYmFzZS5taW4uanMnO1xuaW1wb3J0IHRvbVNlbGVjdGNzcyBmcm9tIFwiLi4vY3NzL3RvbS1zZWxlY3QuY3NzXCI7XG5pbXBvcnQge1xuICBmZXRjaFNldHRpbmdzXG59IGZyb20gJy4uL21vZHVsZXMvdXRpbHMuanMnO1xuaW1wb3J0IHtcbiAgbW9kZWxzLFxuICBkb21zZWxlY3RvcnNcbn0gZnJvbSAnLi4vbW9kdWxlcy9tb2R1bGVzLWNvbmZpZy5qcyc7XG5sZXQgdXNlcnNfbGlzdCA9IHt9O1xuXG4vLyBzZXR0aW5ncyBmb3IgYXV0b2NvbXBsZXRlIHNlbGVjdCBjb21wb25lbnQgLSB1c2VycyAsIGluc3RydW1lbnRzICwgdGF4b25zXG5leHBvcnQgY2xhc3MgSnNUb21TZWxlY3Qge1xuICBhcHBseVRvKGl0ZW0sIHNpYmxpbmdzID0gbnVsbCkge1xuICAgIGNvbnN0IGlkID0gaXRlbS5nZXRBdHRyaWJ1dGUoJ2lkJyk7XG4gICAgY29uc3QgbXVsdGlwbGUgPSBpdGVtLmhhc0F0dHJpYnV0ZSgnbXVsdGlwbGUnKTtcbiAgICBjb25zdCB0eXBlID0gaXRlbS5kYXRhc2V0LnR5cGU7XG4gICAgbGV0IG9wdGlvbiA9IHtcbiAgICAgICAgdXJsOiAnJyxcbiAgICAgICAgc2V0dGluZ3M6IHt9XG4gICAgICB9LFxuICAgICAgaW5pdF9jYW5jZWx0YWcgPSAodGFnKSA9PiB7XG4gICAgICAgIHRhZy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgICAgY29uc3QgdiA9IGUuY3VycmVudFRhcmdldC5jbG9zZXN0KGRvbXNlbGVjdG9ycy5jb21wb25lbnQudG9tc2VsZWN0Lml0ZW0pLmRhdGFzZXQudmFsdWU7XG4gICAgICAgICAgaWYgKHYpIHtcbiAgICAgICAgICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICBpdGVtLnRvbXNlbGVjdC5yZW1vdmVJdGVtKHYpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgIH07XG5cbiAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgIGNhc2UgbW9kZWxzLnByb2plY3Q6XG4gICAgICAgIG9wdGlvbi51cmwgPSBcIi9ndWkvcHJqbGlzdC9cIjtcbiAgICAgICAgb3B0aW9uLnNldHRpbmdzID0ge1xuICAgICAgICAgIHZhbHVlRmllbGQ6ICdpZCcsXG4gICAgICAgICAgc2VhcmNoRmllbGQ6ICd0ZXh0JyxcbiAgICAgICAgICBsYWJlbEZpZWxkOiAndGV4dCcsXG4gICAgICAgICAgb3Blbk9uRm9jdXM6IGZhbHNlLFxuICAgICAgICAgIG1heEl0ZW1zOiAxLFxuICAgICAgICAgIGFsbG93RW1wdHlPcHRpb246IGZhbHNlLFxuICAgICAgICAgIG9uSXRlbUFkZDogZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgaWYgKGUgIT0gaXRlbS5kYXRhc2V0LnZhbHVlKSB7XG4gICAgICAgICAgICAgIGxldCBocmVmID0gd2luZG93LmxvY2F0aW9uLmhyZWYuc3BsaXQoJy8nKTtcbiAgICAgICAgICAgICAgaHJlZi5wb3AoKTtcbiAgICAgICAgICAgICAgaHJlZiA9IGhyZWYuam9pbignLycpICsgJy8nICsgZTtcblxuICAgICAgICAgICAgICB3aW5kb3cub3BlbihocmVmLCAnX2JsYW5rJykuZm9jdXMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMucmVtb3ZlSXRlbShlKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIG1vZGVscy51c2VyOlxuICAgICAgICBvcHRpb24udXJsID0gXCIvYXBpL3VzZXJzL3NlYXJjaD9ieV9uYW1lPVwiO1xuICAgICAgICBvcHRpb24uc2V0dGluZ3MgPSB7XG4gICAgICAgICAgdmFsdWVGaWVsZDogJ2lkJyxcbiAgICAgICAgICBzZWFyY2hGaWVsZDogJ25hbWUnLFxuICAgICAgICAgIGxhYmVsRmllbGQ6ICduYW1lJyxcbiAgICAgICAgICBvbkluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaXRlbS50b21zZWxlY3QuaXRlbXMuZm9yRWFjaChlID0+IHtcbiAgICAgICAgICAgICAgdXNlcnNfbGlzdFtlXSA9IHRydWU7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIG9uSXRlbUFkZDogZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgaWYgKHVzZXJzX2xpc3RbZV0pIHtcbiAgICAgICAgICAgICAgaWYgKCF0aGlzLnJldmVydFNldHRpbmdzIHx8IHRoaXMucmV2ZXJ0U2V0dGluZ3MudGFiSW5kZXggPCAwIHx8ICFpdGVtLnF1ZXJ5U2VsZWN0b3JBbGwoJ29wdGlvbicpKSByZXR1cm47XG4gICAgICAgICAgICAgIGNvbnN0IHJldmVydCA9IGl0ZW0ucXVlcnlTZWxlY3RvckFsbCgnb3B0aW9uJylbdGhpcy5yZXZlcnRTZXR0aW5ncy50YWJJbmRleF0udmFsdWU7XG4gICAgICAgICAgICAgIHRoaXMucmVtb3ZlT3B0aW9uKGUpO1xuICAgICAgICAgICAgICB0aGlzLmFkZEl0ZW0ocmV2ZXJ0KTtcbiAgICAgICAgICAgICAgdXNlcnNfbGlzdFtlXSA9IGZhbHNlO1xuICAgICAgICAgICAgfSBlbHNlIHVzZXJzX2xpc3RbZV0gPSB0cnVlO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgb25JdGVtUmVtb3ZlOiBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBpZiAodXNlcnNfbGlzdFtlXSkgZGVsZXRlIHVzZXJzX2xpc3RbZV07XG4gICAgICAgICAgICBpZiAoIXRoaXMucmV2ZXJ0U2V0dGluZ3MgfHwgdGhpcy5yZXZlcnRTZXR0aW5ncy50YWJJbmRleCA8IDApIHJldHVybjtcbiAgICAgICAgICAgIGNvbnN0IHJldmVydCA9IGl0ZW0ucXVlcnlTZWxlY3RvckFsbCgnb3B0aW9uJylbdGhpcy5yZXZlcnRTZXR0aW5ncy50YWJJbmRleF0udmFsdWU7XG4gICAgICAgICAgICBpZiAodXNlcnNfbGlzdFtyZXZlcnRdICE9PSB1bmRlZmluZWQpIGRlbGV0ZSB1c2Vyc19saXN0W3JldmVydF07XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgbW9kZWxzLmluc3RyOlxuICAgICAgICBvcHRpb24udXJsID0gXCIvc2VhcmNoL2luc3RydW1lbnRzXCI7XG4gICAgICAgIG9wdGlvbi5zZXR0aW5ncyA9IHtcbiAgICAgICAgICB2YWx1ZUZpZWxkOiAnaWQnLFxuICAgICAgICAgIGxhYmVsRmllbGQ6ICd0ZXh0JyxcbiAgICAgICAgICBzZWFyY2hGaWVsZDogJ2lkJyxcbiAgICAgICAgICBtYXhJdGVtczogMSxcbiAgICAgICAgICBwcmVsb2FkOiB0cnVlXG4gICAgICAgIH07XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBtb2RlbHMudGF4bzpcbiAgICAgICAgVG9tU2VsZWN0LmRlZmluZSgnbm9fY2xvc2UnLCAoKSA9PiB7XG4gICAgICAgICAgdGhpcy5jbG9zZSA9ICgpID0+IHt9O1xuICAgICAgICB9KTtcbiAgICAgICAgLy9vcHRpb24uc2V0dGluZ3MucGx1Z2lucy5wdXNoKCduby1jbG9zZScpXG4gICAgICAgIG9wdGlvbi51cmwgPSBcIi9zZWFyY2gvdGF4b1wiO1xuICAgICAgICBvcHRpb24uc2V0dGluZ3MgPSB7XG4gICAgICAgICAgdmFsdWVGaWVsZDogJ2lkJyxcbiAgICAgICAgICBsYWJlbEZpZWxkOiAndGV4dCcsXG4gICAgICAgICAgc2VhcmNoRmllbGQ6ICd0ZXh0JyxcbiAgICAgICAgICBvbkluaXRpYWxpemU6ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHdyYXBwZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCkubmV4dEVsZW1lbnRTaWJsaW5nO1xuICAgICAgICAgICAgaWYgKCF3cmFwcGVyLmNsYXNzTGlzdC5jb250YWlucygndHMtd3JhcHBlcicpKSByZXR1cm47XG4gICAgICAgICAgICBjb25zdCB0YWdzID0gd3JhcHBlci5xdWVyeVNlbGVjdG9yQWxsKGRvbXNlbGVjdG9ycy5jb21wb25lbnQudG9tc2VsZWN0LnRzZGVsZXQpO1xuICAgICAgICAgICAgdGFncy5mb3JFYWNoKHRhZyA9PiB7XG4gICAgICAgICAgICAgIGluaXRfY2FuY2VsdGFnKHRhZyk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgIH1cblxuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBjb25zdCBkZWZhdWx0X3NldHRpbmdzID0ge1xuICAgICAgY3JlYXRlOiBmYWxzZSxcbiAgICAgIG1heE9wdGlvbnM6IG51bGwsXG4gICAgICBwcmVsb2FkOiBmYWxzZSxcbiAgICAgIGhpZGVTZWxlY3RlZDogdHJ1ZSxcbiAgICAgIGR1cGxpY2F0ZXM6IGZhbHNlLFxuICAgICAgYWxsb3dFbXB0eU9wdGlvbjogdHJ1ZSxcbiAgICAgIGNsb3NlQWZ0ZXJTZWxlY3Q6IHRydWUsXG4gICAgICBwbGFjZWhvbGRlcjogKGl0ZW0ucGxhY2Vob2xkZXIpID8gaXRlbS5wbGFjZWhvbGRlciA6ICgoaXRlbS5kYXRhc2V0LnBsYWNlaG9sZGVyKSA/IGl0ZW0uZGF0YXNldC5wbGFjZWhvbGRlciA6ICcnKSxcbiAgICAgIG9uRHJvcGRvd25DbG9zZTogZnVuY3Rpb24oKSB7XG5cbiAgICAgIH0sXG4gICAgICBzaG91bGRMb2FkOiBmdW5jdGlvbihxdWVyeSkge1xuICAgICAgICByZXR1cm4gcXVlcnkubGVuZ3RoID4gMlxuICAgICAgfSxcblxuICAgICAgbG9hZDogZnVuY3Rpb24ocXVlcnksIGNhbGxiYWNrKSB7XG4gICAgICAgIHF1ZXJ5ID0gRE9NUHVyaWZ5LnNhbml0aXplKHF1ZXJ5KTtcblxuICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcbiAgICAgICAgaWYgKHNlbGYubG9hZGluZyA+IDEwKSB7XG5cbiAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBsZXQgdXJsID0gJyc7XG4gICAgICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgICAgIGNhc2UgbW9kZWxzLnVzZXI6XG4gICAgICAgICAgICB1cmwgPSBvcHRpb24udXJsICsgZW5jb2RlVVJJQ29tcG9uZW50KCclJyArIHF1ZXJ5ICsgJyUnKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgbW9kZWxzLmluc3RyOlxuICAgICAgICAgIGNhc2UgbW9kZWxzLnRheG86XG4gICAgICAgICAgICB1cmwgPSBvcHRpb24udXJsO1xuICAgICAgICAgICAgaWYgKHF1ZXJ5KSB1cmwgKz0gJz9xPScgKyBlbmNvZGVVUklDb21wb25lbnQocXVlcnkpO1xuXG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIG1vZGVscy5wcm9qZWN0OlxuICAgICAgICAgICAgdXJsID0gb3B0aW9uLnVybDtcbiAgICAgICAgICAgIGlmIChxdWVyeSkgdXJsICs9ICc/ZmlsdF90aXRsZT0nICsgZW5jb2RlVVJJQ29tcG9uZW50KHF1ZXJ5KTsgLy8rICcmZmlsdF9pbnN0cnVtPScgKyBlbmNvZGVVUklDb21wb25lbnQocXVlcnkpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHVybCAhPT0gbnVsbCkgZmV0Y2godXJsLCBmZXRjaFNldHRpbmdzKCkpLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuanNvbigpKS50aGVuKGpzb24gPT4ge1xuICAgICAgICAgIGlmICh0eXBlID09PSBtb2RlbHMucHJvamVjdCkge1xuICAgICAgICAgICAgaWYgKGpzb24uZGF0YSAmJiBqc29uLmRhdGEubGVuZ3RoKSBqc29uID0ganNvbi5kYXRhLm1hcChyb3cgPT4ge1xuICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGlkOiByb3dbMV0sXG4gICAgICAgICAgICAgICAgdGV4dDogcm93WzNdWzBdXG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICh0eXBlID09PSBtb2RlbHMuaW5zdHIgJiYganNvbi5sZW5ndGgpIGpzb24gPSBqc29uLnJlZHVjZSgocmVzdWx0LCBhLCB2KSA9PiB7XG4gICAgICAgICAgICBhID0gRE9NUHVyaWZ5LnNhbml0aXplKGEpO1xuICAgICAgICAgICAgbGV0IG9iaiA9IHtcbiAgICAgICAgICAgICAgaWQ6IGEsXG4gICAgICAgICAgICAgIHRleHQ6IGFcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlc3VsdC5wdXNoKG9iaik7XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgIH0sIFtdKTtcblxuICAgICAgICAgIGlmIChqc29uLmxlbmd0aCAmJiB0eXBlb2YganNvbiA9PSAnb2JqZWN0JykganNvbiA9IE9iamVjdC5lbnRyaWVzKGpzb24pO1xuICAgICAgICAgIHJldHVybiBjYWxsYmFjayhqc29uKTtcblxuICAgICAgICB9KS5jYXRjaChlcnIgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCd0b21zZWxlY3QtZXJyJywgZXJyKTtcbiAgICAgICAgfSk7XG4gICAgICB9LFxuXG4gICAgICByZW5kZXI6IHtcbiAgICAgICAgb3B0aW9uOiBmdW5jdGlvbihlbCwgZXNjYXBlKSB7XG4gICAgICAgICAgaWYgKGVsID09PSB1bmRlZmluZWQgfHwgZWwgPT09IG51bGwpIHJldHVybiBgYDtcbiAgICAgICAgICAvLyBhZGQgb3B0Z3JvdXBcbiAgICAgICAgICBjb25zdCBvcHRncm91cCA9IChlbC5vcHRncm91cCkgPyBgZGF0YS1vcHRncm91cD0ke2VsLm9wdGdyb3VwfWAgOiBgYDtcbiAgICAgICAgICByZXR1cm4gYDxkaXYgY2xhc3M9XCJweS0yIGZsZXggICR7ICgobXVsdGlwbGUpPydpbmxpbmUtZmxleCc6JycpIH0gXCIgJHtvcHRncm91cH0gZGF0YS12YWx1ZT1cIiR7ZWxbb3B0aW9uLnNldHRpbmdzLnZhbHVlRmllbGRdfVwiPiR7IGVzY2FwZShlbFt0aGlzLnNldHRpbmdzLmxhYmVsRmllbGRdKSB9PC9kaXY+YDtcbiAgICAgICAgfSxcbiAgICAgICAgaXRlbTogZnVuY3Rpb24oZWwsIGVzY2FwZSkge1xuICAgICAgICAgIGlmIChlbCA9PT0gdW5kZWZpbmVkIHx8IGVsID09PSBudWxsKSByZXR1cm4gYGA7IC8vIGFkZCBvcHRncm91cFxuICAgICAgICAgIGNvbnN0IG9wdGdyb3VwID0gKGVsLm9wdGdyb3VwKSA/IGBpdGVtLSR7ZWwub3B0Z3JvdXB9YCA6IGBgO1xuICAgICAgICAgIC8vIGFkZCBjYW5jZWwgaWNvbiBmb3IgbXVsdGlwbGUgc2VsZWN0aW9uc1xuICAgICAgICAgIGNvbnN0IGNhbmNlbCA9ICgobXVsdGlwbGUpID8gYDxpIGNsYXNzPVwiJHtkb21zZWxlY3RvcnMuY29tcG9uZW50LnRvbXNlbGVjdC50c2RlbGV0LnN1YnN0cigxKX1cIj48L2k+YCA6IGBgKTtcbiAgICAgICAgICByZXR1cm4gRE9NUHVyaWZ5LnNhbml0aXplKGA8ZGl2IGNsYXNzPVwiYCArICgobXVsdGlwbGUpID8gYGZsZXggaW5saW5lLWZsZXggYCA6IGBgKSArIGAgJHtvcHRncm91cH1cIiBkYXRhLXZhbHVlPVwiJHtlbFt0aGlzLnNldHRpbmdzLnZhbHVlRmllbGRdfVwiPiR7IGVzY2FwZShlbFt0aGlzLnNldHRpbmdzLmxhYmVsRmllbGRdKX0gJHsgY2FuY2VsIH08L2Rpdj5gKTtcbiAgICAgICAgfSxcbiAgICAgICAgbm9fcmVzdWx0czogZnVuY3Rpb24oZGF0YSwgZXNjYXBlKSB7XG4gICAgICAgICAgcmV0dXJuIERPTVB1cmlmeS5zYW5pdGl6ZSgnPGRpdiBjbGFzcz1cIm5vLXJlc3VsdHNcIj4nICsgKChpdGVtLmRhdGFzZXQubm9yZXN1bHRzKSA/IGl0ZW0uZGF0YXNldC5ub3Jlc3VsdHMgOiAnTm8gcmVzdWx0IGZvdW5kIGZvciAnKSArIGVzY2FwZShkYXRhLmlucHV0KSArICc8L2Rpdj4nKTtcbiAgICAgICAgfSxcbiAgICAgIH1cbiAgICB9XG5cbiAgICBvcHRpb24uc2V0dGluZ3MgPSBPYmplY3QuYXNzaWduKGRlZmF1bHRfc2V0dGluZ3MsIG9wdGlvbi5zZXR0aW5ncylcbiAgICBpZiAoaWQgIT09IG51bGwpIHtcbiAgICAgIGNvbnN0IHRzID0gbmV3IFRvbVNlbGVjdCgnIycgKyBpZCwgb3B0aW9uLnNldHRpbmdzKTtcblxuICAgICAgdHMud3JhcHBlci5jbGFzc0xpc3QucmVtb3ZlKGRvbXNlbGVjdG9ycy5jb21wb25lbnQudG9tc2VsZWN0LmlkZW50KTtcbiAgICAgIHRzLndyYXBwZXIuY2xhc3NMaXN0LnJlbW92ZSgnanMnKTtcbiAgICAgIC8vIGFkZFxuICAgICAgdHMud3JhcHBlci5zZXRBdHRyaWJ1dGUoJ2RhdGEtY29tcG9uZW50JywgJ3RvbS1zZWxlY3QnKTtcbiAgICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgICBjYXNlICd0YXhvJzpcbiAgICAgICAgICB0cy5vbignaXRlbV9hZGQnLCAodiwgZWwpID0+IHtcbiAgICAgICAgICAgIGlmIChlbCAhPT0gbnVsbCkgZWwuY2xhc3NMaXN0LmFkZCgnbmV3Jyk7XG4gICAgICAgICAgICBlbCA9IGVsLnF1ZXJ5U2VsZWN0b3IoJy50cy1kZWxldCcpO1xuICAgICAgICAgICAgaWYgKGVsICE9PSBudWxsKSBpbml0X2NhbmNlbHRhZyhlbCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ3VzZXInOlxuICAgICAgICAgIGlmIChpdGVtLmRhdGFzZXQucHJpdikgdHMub24oXCJpdGVtX2FkZFwiLCBmdW5jdGlvbih2LCBlbCkge1xuICAgICAgICAgICAgZWwgPSBlbC5xdWVyeVNlbGVjdG9yKGRvbXNlbGVjdG9ycy5jb21wb25lbnQudG9tc2VsZWN0LnRzZGVsZXQpO1xuICAgICAgICAgICAgaWYgKGVsICE9PSBudWxsKSBpbml0X2NhbmNlbHRhZyhlbCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICByZXR1cm4gdHM7XG4gICAgfSBlbHNlIGNvbnNvbGUubG9nKCdub2lkJyk7XG5cbiAgfVxufSJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/modules/js-tom-select.js\n")},"./src/modules/project-privileges.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"ProjectPrivileges\": () => (/* binding */ ProjectPrivileges)\n/* harmony export */ });\n/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! dompurify */ \"./node_modules/dompurify/dist/purify.js\");\n/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(dompurify__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _modules_form_submit_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../modules/form-submit.js */ \"./src/modules/form-submit.js\");\n/* harmony import */ var _modules_alert_boxes_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../modules/alert-boxes.js */ \"./src/modules/alert-boxes.js\");\n/* harmony import */ var _modules_js_tom_select_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../modules/js-tom-select.js */ \"./src/modules/js-tom-select.js\");\n/* harmony import */ var _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../modules/modules-config.js */ \"./src/modules/modules-config.js\");\n// privileges of a project\n// line with member name , priviliege , is contact , and delete functionality\n\n\n\n\n\n\nconst codemessages = {\n  oneatleast: 'oneatleast',\n  nomanager: 'nomanager',\n  nocontact: 'nocontact',\n  uhasnopriv: 'uhasnopriv',\n  importpriverror: 'importpriverror',\n  emptyname: 'emptyname'\n}\nlet instance = null;\nclass ProjectPrivileges {\n  //TODO: rewrite to not depend on DOM select\n  options;\n  alertBox;\n  // current user id;\n  current_uid;\n  fieldset;\n  fieldset_alert_zone;\n  // unique users\n  constructor(options = {}) {\n    if (!instance) {\n      const defaultOptions = {\n        groupid: \"#section-privileges\",\n        separ: '.new-privilege',\n        addbtn: '[data-add=\"block\"]',\n        target: 'member',\n        ident: 'member',\n        privilege: 'privilege',\n        delet: 'delet',\n        contact: 'contact',\n        contactfieldname: 'contact_user_id',\n\n      };\n      this.options = Object.assign({}, defaultOptions, options);\n      this.fieldset = document.querySelector(this.options.groupid);\n      if (!this.fieldset) return;\n      this.fieldset_alert_zone = this.fieldset.querySelector('.tab-content') ? this.fieldset.querySelector('.tab-content') : this.fieldset;\n      this.options.separ = this.options.separ instanceof HTMLElement ? this.options.separ : (document.querySelector(this.options.separ) ? document.querySelector(this.options.separ) : null);\n      this.options.addbtn = this.options.addbtn instanceof HTMLElement ? this.options.addbtn : document.querySelector(this.options.addbtn);\n      if (this.options.addbtn) this.addListener();\n      const lines = this.fieldset.querySelectorAll('[data-block=\"' + this.options.target + '\"]');\n      this.current_uid = this.fieldset.dataset.u;\n      this.alertBox = new _modules_alert_boxes_js__WEBPACK_IMPORTED_MODULE_2__.AlertBox();\n      lines.forEach((line) => {\n        this.activateEvents(line);\n      });\n\n      //remove deleted , clean && validate datas , format names before sending the form\n      const form = this.fieldset.closest('form');\n      const formSubmit = new _modules_form_submit_js__WEBPACK_IMPORTED_MODULE_1__.FormSubmit(form);\n      // handler - verify privileges before settings form submit\n      const submit_privileges = async () => {\n        const resp = await this.cleanPrivileges();\n        return resp;\n      }\n      formSubmit.addHandler(submit_privileges);\n      instance = this;\n    }\n    return instance;\n  }\n\n  newLine(ret = false, check = 0) {\n    let line;\n    if (check > 0) {\n      line = this.getLinePrivilege(check);\n      if (line) return line;\n    }\n    const lines = this.fieldset.querySelectorAll('[data-block=\"' + this.options.target + '\"]');\n\n    if (lines.length === 0) return;\n    const n = lines.length - 1;\n    line = lines[n];\n    if (line !== null) {\n      line = this.clearLine(line.cloneNode(true), n, (this.options.separ ? this.options.separ : line));\n\n      this.activateEvents(line);\n\n    }\n    if (ret === true) return line;\n  }\n\n  addListener() {\n    this.options.target = (this.options.addbtn.dataset.target) ? this.options.addbtn.dataset.target : this.options.target;\n    this.options.addbtn.addEventListener('click', async (e) => {\n      e.preventDefault();\n      this.newLine();\n    })\n  }\n\n  clearLine(line, n, separ = null) {\n    /*clean line element */\n\n    let has_autocomplete = null;\n    line.dataset.mod = '';\n    line.disabled = false;\n    const elems = line.querySelectorAll('[data-elem]');\n    elems.forEach((elem) => {\n      // change loop index - necessary for tailwindcss peerchecked to work otherwise not if name ends with []\n      //remove components\n      const rms = elem.querySelectorAll('[data-component]')\n      rms.forEach((rm) => {\n        switch (rm.dataset.component) {\n          case 'tom-select':\n            rm.remove();\n            break;\n        }\n      })\n      // clean and reset events\n      const els = elem.querySelectorAll('input, select, label');\n      els.forEach((el) => {\n\n        el.disabled = false;\n        if (separ) { // change names and id when adding a new row - not if clear only\n          const keys = ['id', 'for', 'aria-controls', 'name'];\n          keys.forEach((key) => {\n            let val = el.getAttribute(key);\n            if (val !== null) {\n              if (key === 'name') val = val.replace('[' + n + ']', '[' + (n + 1) + ']');\n              else val = val.replace('_' + n, '_' + (n + 1));\n              el.setAttribute(key, val);\n            }\n          });\n        }\n        switch (el.tagName.toLowerCase()) {\n          case 'input':\n            //el.indeterminate = true;\n            el.checked = false;\n            // disable contact as privilege is empty\n            if (el.name == this.options.contactfieldname) {\n              el.value = \"0\";\n              el.disabled = true;\n            }\n            break;\n          case 'select':\n            el.selectedIndex = -1;\n            break;\n          case 'label':\n            el.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.peerchecked);\n            break;\n        }\n        if (el.tomselect) {\n          has_autocomplete = el;\n          el.tomselect.clear();\n          el.tomselect.destroy();\n\n        }\n        if (el.classList.contains(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.component.autocomplete.tomselected)) {\n          has_autocomplete = el;\n          el.classList.forEach(cl => {\n            if (cl.indexOf('ts-') == 0) el.classList.remove(cl);\n          })\n          el.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.css.component.autocomplete.tomselected);\n          if (el.type == \"select-one\") delete el.type;\n\n        }\n\n      })\n\n    })\n    /* add functionnalities */\n    if (separ) {\n      line.classList.add('new');\n      separ.after(line);\n    }\n    /* clear and add tom-select functionalities - only after adding line to the dom*/\n    if (has_autocomplete !== null) {\n      const jsTomSelect = new _modules_js_tom_select_js__WEBPACK_IMPORTED_MODULE_3__.JsTomSelect();\n      jsTomSelect.applyTo(has_autocomplete);\n      has_autocomplete.tomselect.clearOptions();\n      let options = this.fieldset.dataset.options;\n      options = (options) ? options : [];\n      has_autocomplete.tomselect.addOptions(options);\n    };\n\n\n    return line;\n  }\n\n  setLine(line, mb = {\n    key: '',\n    value: ''\n  }, priv, ct) {\n\n    priv = _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.defined_privileges[priv] ? _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.defined_privileges[priv] : _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.defined_privileges.viewers;\n    if (!priv) return;\n    const {\n      member,\n      privs,\n      contact,\n      delet\n    } = this.getInputs(line, priv);\n\n    if (!member || !privs || !contact || !delet) return;\n    // sanitize\n\n    mb.key = dompurify__WEBPACK_IMPORTED_MODULE_0___default().sanitize(mb.key);\n    mb.value = dompurify__WEBPACK_IMPORTED_MODULE_0___default().sanitize(mb.value);\n    if (member.tomselect) {\n\n      let addmb = {}\n      addmb[member.tomselect.settings.valueField] = mb.key;\n      addmb[member.tomselect.settings.labelField] = mb.value;\n      if (!member.tomselect.getOption(mb.key)) member.tomselect.addOption(addmb);\n      member.tomselect.addItem(mb.key, false);\n      member.tomselect.refreshOptions();\n    } else {\n      const selected = member.querySelector('select option[value=\"' + mb.key + '\"]');\n      if (selected) selected.selected = true;\n      else member.insertAdjacentHTML('beforeend', '<option value=\"' + mb.key + '\" selected>' + mb.value + '</option>');\n\n    }\n    privs.checked = true;\n    contact.value = mb.key;\n    if (priv === _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.rights.manage) {\n      contact.disabled = false;\n      if (ct === true) contact.checked = true;\n    }\n\n  }\n  getInputs(line, priv = false) {\n\n    const member = line.querySelector(\"[name*='[\" + this.options.ident + \"]']\");\n\n    let privs;\n    if (priv) {\n      privs = line.querySelector('input[name*=\"[' + this.options.privilege + ']\"][value=\"' + priv + '\"]');\n    } else privs = line.querySelectorAll('input[name*=\"[' + this.options.privilege + ']\"]');\n    const contact = line.querySelector('input[name=\"' + this.options.contactfieldname + '\"]');\n    const delet = line.querySelector(\"input[name*='[\" + this.options.delet + \"]']\");\n\n    return {\n      member: member,\n      privs: privs,\n      contact: contact,\n      delet: delet\n    };\n  }\n  async importPrivileges(privileges, clear = false, contact = null, importedtag = null, dismiss = null) {\n    let lastline = (clear === true) ? null : true;\n    try {\n      Object.entries(privileges).forEach(([priv, members]) => {\n        members.forEach((member) => {\n          if (!lastline) lastline = this.clearAll(true);\n          else lastline = this.newLine(true, member.id);\n\n          if (lastline) {\n\n            this.setLine(lastline, {\n              key: member.id,\n              value: member.name,\n            }, priv, (contact && (parseInt(contact.id) === parseInt(member.id))));\n            if (importedtag) importedtag(lastline);\n            if (dismiss) dismiss();\n          }\n\n        });\n\n      });\n      this.alertBox.dismissAlert(codemessages.importpriverror);\n      return true;\n    } catch (err) {\n      await this.alertBox.build({\n        dismissible: true,\n        message: codemessages.importpriverror,\n        codeid: true,\n        parent: this.fieldset_alert_zone,\n        type: _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.alertconfig.danger,\n      });\n      console.log('err', err);\n      return false;\n    }\n  }\n  activateEvents(line) {\n    if (!line) return;\n    const {\n      member,\n      privs,\n      contact,\n      delet\n    } = this.getInputs(line);\n    if (!member || !privs || !contact || !delet) {\n      return;\n    }\n    const siblings = s => [...s.parentElement.children].filter(c => c.nodeType == 1 && c != s && c.classList.contains('row') && c.dataset.block !== null && c.dataset.block === this.options.target);\n\n    // enable/disable contact when privilege changes\n    const lineSettings = (pr, ct, dl, synchro = false) => {\n\n      if (pr && pr.value === _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.rights.manage) {\n        // manager - can't delete line - can choose as contact\n        dl.disabled = true;\n        ct.disabled = false;\n        // dismiss related alert\n        this.alertBox.dismissAlert(codemessages.nomanager);\n        if (ct.checked) {\n          this.alertBox.dismissAlert(codemessages.nocontact);\n        }\n      } else {\n        // not manager - can delet line - cannot chose as contact\n        //  if (ct.checked === true) ct.dispatchEvent(new Event('click'));\n        ct.checked = false;\n        dl.disabled = false;\n        ct.disabled = true;\n      }\n\n      if (synchro === true) {\n        synchroSiblings(line);\n      }\n      // dismiss alerts\n      if (!dl.ckecked) {\n        this.alertBox.dismissAlert(codemessages.nobody);\n        this.alertBox.dismissAlert(codemessages.oneatleast);\n      }\n    }\n    const synchroSiblings = (line) => {\n      const lns = siblings(line);\n      lns.forEach((ln) => {\n        const dl = ln.querySelector(\"input[name*='[\" + this.options.delet + \"]']\");\n        const ct = ln.querySelector('input[name=\"' + this.options.contactfieldname + '\"]');\n        const pr = ln.querySelector('input[name*=\"[' + this.options.privilege + ']\"]:checked');\n        lineSettings(pr, ct, dl, false);\n\n      })\n    }\n\n    member.addEventListener('change', (e) => {\n      contact.value = member.value;\n      // dismiss alert\n      if (member.value) {\n        this.alertBox.dismissAlert(codemessages.emptyname);\n        this.alertBox.dismissAlert(codemessages.oneatleast);\n        this.alertBox.dismissAlert(codemessages.nobody);\n      }\n    })\n\n    privs.forEach((priv) => {\n      priv.addEventListener('change', (e) => {\n        if (priv.checked) lineSettings(priv, contact, delet, false);\n      });\n\n      if (priv.checked) lineSettings(priv, contact, delet, false);\n    })\n\n    contact.addEventListener('change', (e) => {\n      if (e.target.checked) delet.disabled = true;\n      else delet.disabled = false;\n      const priv = line.querySelector('input[name*=\"[' + this.options.privilege + ']\"]:checked');\n      lineSettings(priv, contact, delet, true);\n      // enable otherwise\n\n    })\n\n    // delet ok for all when new line\n    //\n    delet.addEventListener('click', (e) => {\n      // at least one priv line\n      const deletlabel = delet.closest('label');\n      const lines = this.fieldset.querySelectorAll('[data-block=\"' + this.options.target + '\"]:not([data-mod=\"remove\"])');\n      if (lines.length <= 1 && e.target.checked) {\n        delet.disabled = true;\n        delet.checked = false;\n        this.alertBox.build({\n          dismissible: true,\n          message: codemessages.oneatleast,\n          codemessage: codemessages.oneatleast,\n          type: _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.alertconfig.warning,\n          parent: (e.currentTarget.id || null)\n        });\n        return;\n      } else if (e.target.checked) {\n        this.alertBox.dismissAlert(codemessages.oneatleast);\n        if (line.classList.contains('new')) {\n          line.remove();\n        } else {\n          if (deletlabel && deletlabel.dataset.restore) deletlabel.setAttribute('title', deletlabel.dataset.restore);\n          line.setAttribute('data-mod', 'remove');\n          privs.forEach(priv => {\n            priv.disabled = true;\n            priv.checked = false;\n          })\n          contact.checked = false;\n          contact.disabled = true;\n          member.disabled = true;\n        }\n      } else {\n        if (deletlabel && deletlabel.dataset.remove) deletlabel.setAttribute('title', deletlabel.dataset.remove);\n        line.removeAttribute('data-mod');\n        privs.forEach(priv => priv.disabled = false);\n        contact.disabled = false;\n        member.disabled = false;\n      }\n    });\n    // delet mouseover - explain why it is disabled when manage is checked\n    delet.addEventListener('mouseover', (e) => {\n      if (e.target.disabled) {\n        let pr = line.querySelector('input[name*=\"[' + this.options.privilege + ']\"]:checked');\n        if (!pr) return;\n        pr = pr.value.toLowerCase()\n        e.target.title = (e.target.dataset[pr]) ? e.target.dataset[pr] : e.target.title\n      }\n    })\n    // disable delet if user is the only manager\n    if (this.current_uid === member.value) delet.disabled = true;\n\n\n  }\n\n  // send clean data on submit\n  async cleanPrivileges() {\n    // check managers and contact_user_id on submit\n\n    const checkContact = async () => {\n      // check if one manager at least\n      const managers = this.fieldset.querySelectorAll('[name*=\"[' + this.options.privilege + ']\"][value=\"' + _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.rights.manage + '\"]:checked');\n      let n = managers.length;\n\n      if (n === 0) {\n        await this.alertBox.build({\n          dismissible: true,\n          message: codemessages.nomanager,\n          codeid: true,\n          type: _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.alertconfig.danger,\n          parent: this.fieldset_alert_zone,\n        });\n        return false;\n      } else this.alertBox.dismissAlert(codemessages.nomanager);\n      // check contact\n      const contact = this.fieldset.querySelector('[name=\"' + this.options.contactfieldname + '\"]:checked');\n\n      if (contact === null) {\n        await this.alertBox.build({\n          dismissible: true,\n          codeid: true,\n          message: codemessages.nocontact,\n          type: _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.alertconfig.danger,\n          parent: this.fieldset_alert_zone\n        });\n        return false;\n      }\n      this.alertBox.dismissAlert(codemessages.nocontact);\n      return true;\n    }\n    const hasMember = (line) => {\n      const member = line.querySelector('[name*=\"[' + this.options.ident + ']\"]');\n      return (member.value);\n    }\n    const hasPriv = (line) => {\n      const priv = line.querySelector('[name*=\"[' + this.options.privilege + ']\"]:checked');\n      if (priv && priv.value) return true;\n      return false;\n    }\n    const formatPrivilege = (line) => {\n\n      const els = line.querySelectorAll('[name*=\"members[\"');\n      els.forEach((el) => {\n        let name = el.name;\n        name = name.split('[');\n        name.pop();\n        el.name = name.join('[');\n        if (el.name.indexOf('[' + this.options.privilege + ']') > 0) {\n          el.type = 'checkbox';\n          el.classList.add('hidden');\n        }\n\n      })\n    }\n    const hascontact = await checkContact();\n    if (hascontact === true) {\n      const lines = this.fieldset.querySelectorAll('[data-block=\"' + this.options.target + '\"]');\n      let n = lines.length;\n      let verif = true;\n      for (const line of lines) {\n        if (line.dataset.mod && line.dataset.mod === 'remove') {\n          if (n > 1) {\n            line.remove();\n            n--;\n          } else return false;\n        } else if (!hasMember(line)) {\n          const lineno = line.querySelector('[name*=\"[' + this.options.ident + ']\"]');\n          lineno.focus();\n          if (lineno.tomselect) lineno.tomselect.focus();\n          await this.alertBox.build({\n            dismissible: true,\n            insertafter: true,\n            message: codemessages.emptyname,\n            codeid: true,\n            type: _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.alertconfig.warning,\n            parent: line\n          });\n          const resp = false; // no confimbox just wait for user action\n          // callback when confirmbox response is chosen if 'confirm'\n          if (resp === true) {\n            if (n > 1) {\n              line.remove();\n              n--;\n            } else return false;\n\n          } else return false;\n        } else if (!hasPriv(line)) {\n          this.alertBox.dismissAlert(codemessages.emptyname);\n          await this.alertBox.build({\n            dismissible: true,\n            insertafter: true,\n            codeid: true,\n            message: codemessages.uhasnopriv,\n            type: _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.alertconfig.warning,\n            parent: line\n          });\n          verif = false;\n        } else this.alertBox.dismissAlert(codemessages.uhasnopriv);\n      }\n      if (!verif) return verif;\n      for (const line of lines) {\n        formatPrivilege(line);\n      }\n\n      if (n === 0) {\n        await this.alertBox.build({\n          dismissible: true,\n          codeid: true,\n          message: codemessages.nobody,\n          type: _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_4__.alertconfig.warning,\n          parent: this.fieldset_alert_zone\n        });\n        return false;\n      } else this.alertBox.dismissAlert(codemessages.nobody);\n      return true;\n    } else return false;\n  }\n  getLinePrivilege(id) {\n    let privilege = null;\n    const lines = this.fieldset.querySelectorAll('[data-block=\"' + this.options.target + '\"]')\n    for (const line of lines) {\n      if (parseInt(line.querySelector('[name*=\"[' + this.options.ident + ']\"]').value) === parseInt(id)) {\n        privilege = line;\n        break;\n      }\n    }\n\n    return privilege;\n  }\n\n  clearAll(ret = false) {\n    const lines = this.fieldset.querySelectorAll('[data-block=\"' + this.options.target + '\"]');\n\n    lines.forEach((line, index) => {\n      const {\n        member,\n        privs,\n        contact,\n        delet\n      } = this.getInputs(line);\n      if (index > 0 && (this.current_uid !== member.value)) line.remove();\n    });\n    //\n    this.clearLine(lines[0], 0);\n    this.activateEvents(lines[0]);\n    if (ret === true) return lines[0];\n  }\n\n\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvbW9kdWxlcy9wcm9qZWN0LXByaXZpbGVnZXMuanMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDa0M7QUFHQztBQUdBO0FBR0U7O0FBT0M7QUFDdEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxxQ0FBcUM7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQiw2REFBUTtBQUNsQztBQUNBO0FBQ0EsT0FBTzs7QUFFUDtBQUNBO0FBQ0EsNkJBQTZCLCtEQUFVO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQyx1RUFBZTtBQUMvQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxrQ0FBa0MsOEZBQXNDO0FBQ3hFO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWCw4QkFBOEIsOEZBQXNDO0FBQ3BFOztBQUVBOztBQUVBLE9BQU87O0FBRVAsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCLGtFQUFXO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVILFdBQVcsMEVBQWtCLFNBQVMsMEVBQWtCLFNBQVMsa0ZBQTBCO0FBQzNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07O0FBRU47QUFDQTs7QUFFQSxhQUFhLHlEQUFrQjtBQUMvQixlQUFlLHlEQUFrQjtBQUNqQzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQixxRUFBYTtBQUM5QjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7O0FBRUEsU0FBUzs7QUFFVCxPQUFPO0FBQ1A7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYywwRUFBa0I7QUFDaEMsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQSw2QkFBNkIscUVBQWE7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBTztBQUNQOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBLE9BQU87O0FBRVA7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLDJFQUFtQjtBQUNuQztBQUNBLFNBQVM7QUFDVDtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOzs7QUFHQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLDZHQUE2RyxxRUFBYTtBQUMxSDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLDBFQUFrQjtBQUNsQztBQUNBLFNBQVM7QUFDVDtBQUNBLFFBQVE7QUFDUjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsMEVBQWtCO0FBQ2xDO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVk7QUFDWixVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQiwyRUFBbUI7QUFDckM7QUFDQSxXQUFXO0FBQ1gsOEJBQThCO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjOztBQUVkLFlBQVk7QUFDWixVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLDJFQUFtQjtBQUNyQztBQUNBLFdBQVc7QUFDWDtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsMkVBQW1CO0FBQ25DO0FBQ0EsU0FBUztBQUNUO0FBQ0EsUUFBUTtBQUNSO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvbW9kdWxlcy9wcm9qZWN0LXByaXZpbGVnZXMuanM/ZGQyMyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBwcml2aWxlZ2VzIG9mIGEgcHJvamVjdFxuLy8gbGluZSB3aXRoIG1lbWJlciBuYW1lICwgcHJpdmlsaWVnZSAsIGlzIGNvbnRhY3QgLCBhbmQgZGVsZXRlIGZ1bmN0aW9uYWxpdHlcbmltcG9ydCBET01QdXJpZnkgZnJvbSAnZG9tcHVyaWZ5JztcbmltcG9ydCB7XG4gIEZvcm1TdWJtaXQsXG59IGZyb20gXCIuLi9tb2R1bGVzL2Zvcm0tc3VibWl0LmpzXCI7XG5pbXBvcnQge1xuICBBbGVydEJveFxufSBmcm9tIFwiLi4vbW9kdWxlcy9hbGVydC1ib3hlcy5qc1wiO1xuaW1wb3J0IHtcbiAgSnNUb21TZWxlY3Rcbn0gZnJvbSBcIi4uL21vZHVsZXMvanMtdG9tLXNlbGVjdC5qc1wiO1xuXG5pbXBvcnQge1xuICByaWdodHMsXG4gIGRlZmluZWRfcHJpdmlsZWdlcyxcbiAgYWxlcnRjb25maWcsXG4gIGNzc1xufSBmcm9tICcuLi9tb2R1bGVzL21vZHVsZXMtY29uZmlnLmpzJztcbmNvbnN0IGNvZGVtZXNzYWdlcyA9IHtcbiAgb25lYXRsZWFzdDogJ29uZWF0bGVhc3QnLFxuICBub21hbmFnZXI6ICdub21hbmFnZXInLFxuICBub2NvbnRhY3Q6ICdub2NvbnRhY3QnLFxuICB1aGFzbm9wcml2OiAndWhhc25vcHJpdicsXG4gIGltcG9ydHByaXZlcnJvcjogJ2ltcG9ydHByaXZlcnJvcicsXG4gIGVtcHR5bmFtZTogJ2VtcHR5bmFtZSdcbn1cbmxldCBpbnN0YW5jZSA9IG51bGw7XG5leHBvcnQgY2xhc3MgUHJvamVjdFByaXZpbGVnZXMge1xuICAvL1RPRE86IHJld3JpdGUgdG8gbm90IGRlcGVuZCBvbiBET00gc2VsZWN0XG4gIG9wdGlvbnM7XG4gIGFsZXJ0Qm94O1xuICAvLyBjdXJyZW50IHVzZXIgaWQ7XG4gIGN1cnJlbnRfdWlkO1xuICBmaWVsZHNldDtcbiAgZmllbGRzZXRfYWxlcnRfem9uZTtcbiAgLy8gdW5pcXVlIHVzZXJzXG4gIGNvbnN0cnVjdG9yKG9wdGlvbnMgPSB7fSkge1xuICAgIGlmICghaW5zdGFuY2UpIHtcbiAgICAgIGNvbnN0IGRlZmF1bHRPcHRpb25zID0ge1xuICAgICAgICBncm91cGlkOiBcIiNzZWN0aW9uLXByaXZpbGVnZXNcIixcbiAgICAgICAgc2VwYXI6ICcubmV3LXByaXZpbGVnZScsXG4gICAgICAgIGFkZGJ0bjogJ1tkYXRhLWFkZD1cImJsb2NrXCJdJyxcbiAgICAgICAgdGFyZ2V0OiAnbWVtYmVyJyxcbiAgICAgICAgaWRlbnQ6ICdtZW1iZXInLFxuICAgICAgICBwcml2aWxlZ2U6ICdwcml2aWxlZ2UnLFxuICAgICAgICBkZWxldDogJ2RlbGV0JyxcbiAgICAgICAgY29udGFjdDogJ2NvbnRhY3QnLFxuICAgICAgICBjb250YWN0ZmllbGRuYW1lOiAnY29udGFjdF91c2VyX2lkJyxcblxuICAgICAgfTtcbiAgICAgIHRoaXMub3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe30sIGRlZmF1bHRPcHRpb25zLCBvcHRpb25zKTtcbiAgICAgIHRoaXMuZmllbGRzZXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHRoaXMub3B0aW9ucy5ncm91cGlkKTtcbiAgICAgIGlmICghdGhpcy5maWVsZHNldCkgcmV0dXJuO1xuICAgICAgdGhpcy5maWVsZHNldF9hbGVydF96b25lID0gdGhpcy5maWVsZHNldC5xdWVyeVNlbGVjdG9yKCcudGFiLWNvbnRlbnQnKSA/IHRoaXMuZmllbGRzZXQucXVlcnlTZWxlY3RvcignLnRhYi1jb250ZW50JykgOiB0aGlzLmZpZWxkc2V0O1xuICAgICAgdGhpcy5vcHRpb25zLnNlcGFyID0gdGhpcy5vcHRpb25zLnNlcGFyIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQgPyB0aGlzLm9wdGlvbnMuc2VwYXIgOiAoZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih0aGlzLm9wdGlvbnMuc2VwYXIpID8gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih0aGlzLm9wdGlvbnMuc2VwYXIpIDogbnVsbCk7XG4gICAgICB0aGlzLm9wdGlvbnMuYWRkYnRuID0gdGhpcy5vcHRpb25zLmFkZGJ0biBpbnN0YW5jZW9mIEhUTUxFbGVtZW50ID8gdGhpcy5vcHRpb25zLmFkZGJ0biA6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5vcHRpb25zLmFkZGJ0bik7XG4gICAgICBpZiAodGhpcy5vcHRpb25zLmFkZGJ0bikgdGhpcy5hZGRMaXN0ZW5lcigpO1xuICAgICAgY29uc3QgbGluZXMgPSB0aGlzLmZpZWxkc2V0LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLWJsb2NrPVwiJyArIHRoaXMub3B0aW9ucy50YXJnZXQgKyAnXCJdJyk7XG4gICAgICB0aGlzLmN1cnJlbnRfdWlkID0gdGhpcy5maWVsZHNldC5kYXRhc2V0LnU7XG4gICAgICB0aGlzLmFsZXJ0Qm94ID0gbmV3IEFsZXJ0Qm94KCk7XG4gICAgICBsaW5lcy5mb3JFYWNoKChsaW5lKSA9PiB7XG4gICAgICAgIHRoaXMuYWN0aXZhdGVFdmVudHMobGluZSk7XG4gICAgICB9KTtcblxuICAgICAgLy9yZW1vdmUgZGVsZXRlZCAsIGNsZWFuICYmIHZhbGlkYXRlIGRhdGFzICwgZm9ybWF0IG5hbWVzIGJlZm9yZSBzZW5kaW5nIHRoZSBmb3JtXG4gICAgICBjb25zdCBmb3JtID0gdGhpcy5maWVsZHNldC5jbG9zZXN0KCdmb3JtJyk7XG4gICAgICBjb25zdCBmb3JtU3VibWl0ID0gbmV3IEZvcm1TdWJtaXQoZm9ybSk7XG4gICAgICAvLyBoYW5kbGVyIC0gdmVyaWZ5IHByaXZpbGVnZXMgYmVmb3JlIHNldHRpbmdzIGZvcm0gc3VibWl0XG4gICAgICBjb25zdCBzdWJtaXRfcHJpdmlsZWdlcyA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzcCA9IGF3YWl0IHRoaXMuY2xlYW5Qcml2aWxlZ2VzKCk7XG4gICAgICAgIHJldHVybiByZXNwO1xuICAgICAgfVxuICAgICAgZm9ybVN1Ym1pdC5hZGRIYW5kbGVyKHN1Ym1pdF9wcml2aWxlZ2VzKTtcbiAgICAgIGluc3RhbmNlID0gdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIGluc3RhbmNlO1xuICB9XG5cbiAgbmV3TGluZShyZXQgPSBmYWxzZSwgY2hlY2sgPSAwKSB7XG4gICAgbGV0IGxpbmU7XG4gICAgaWYgKGNoZWNrID4gMCkge1xuICAgICAgbGluZSA9IHRoaXMuZ2V0TGluZVByaXZpbGVnZShjaGVjayk7XG4gICAgICBpZiAobGluZSkgcmV0dXJuIGxpbmU7XG4gICAgfVxuICAgIGNvbnN0IGxpbmVzID0gdGhpcy5maWVsZHNldC5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1ibG9jaz1cIicgKyB0aGlzLm9wdGlvbnMudGFyZ2V0ICsgJ1wiXScpO1xuXG4gICAgaWYgKGxpbmVzLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xuICAgIGNvbnN0IG4gPSBsaW5lcy5sZW5ndGggLSAxO1xuICAgIGxpbmUgPSBsaW5lc1tuXTtcbiAgICBpZiAobGluZSAhPT0gbnVsbCkge1xuICAgICAgbGluZSA9IHRoaXMuY2xlYXJMaW5lKGxpbmUuY2xvbmVOb2RlKHRydWUpLCBuLCAodGhpcy5vcHRpb25zLnNlcGFyID8gdGhpcy5vcHRpb25zLnNlcGFyIDogbGluZSkpO1xuXG4gICAgICB0aGlzLmFjdGl2YXRlRXZlbnRzKGxpbmUpO1xuXG4gICAgfVxuICAgIGlmIChyZXQgPT09IHRydWUpIHJldHVybiBsaW5lO1xuICB9XG5cbiAgYWRkTGlzdGVuZXIoKSB7XG4gICAgdGhpcy5vcHRpb25zLnRhcmdldCA9ICh0aGlzLm9wdGlvbnMuYWRkYnRuLmRhdGFzZXQudGFyZ2V0KSA/IHRoaXMub3B0aW9ucy5hZGRidG4uZGF0YXNldC50YXJnZXQgOiB0aGlzLm9wdGlvbnMudGFyZ2V0O1xuICAgIHRoaXMub3B0aW9ucy5hZGRidG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoZSkgPT4ge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgdGhpcy5uZXdMaW5lKCk7XG4gICAgfSlcbiAgfVxuXG4gIGNsZWFyTGluZShsaW5lLCBuLCBzZXBhciA9IG51bGwpIHtcbiAgICAvKmNsZWFuIGxpbmUgZWxlbWVudCAqL1xuXG4gICAgbGV0IGhhc19hdXRvY29tcGxldGUgPSBudWxsO1xuICAgIGxpbmUuZGF0YXNldC5tb2QgPSAnJztcbiAgICBsaW5lLmRpc2FibGVkID0gZmFsc2U7XG4gICAgY29uc3QgZWxlbXMgPSBsaW5lLnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLWVsZW1dJyk7XG4gICAgZWxlbXMuZm9yRWFjaCgoZWxlbSkgPT4ge1xuICAgICAgLy8gY2hhbmdlIGxvb3AgaW5kZXggLSBuZWNlc3NhcnkgZm9yIHRhaWx3aW5kY3NzIHBlZXJjaGVja2VkIHRvIHdvcmsgb3RoZXJ3aXNlIG5vdCBpZiBuYW1lIGVuZHMgd2l0aCBbXVxuICAgICAgLy9yZW1vdmUgY29tcG9uZW50c1xuICAgICAgY29uc3Qgcm1zID0gZWxlbS5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1jb21wb25lbnRdJylcbiAgICAgIHJtcy5mb3JFYWNoKChybSkgPT4ge1xuICAgICAgICBzd2l0Y2ggKHJtLmRhdGFzZXQuY29tcG9uZW50KSB7XG4gICAgICAgICAgY2FzZSAndG9tLXNlbGVjdCc6XG4gICAgICAgICAgICBybS5yZW1vdmUoKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgLy8gY2xlYW4gYW5kIHJlc2V0IGV2ZW50c1xuICAgICAgY29uc3QgZWxzID0gZWxlbS5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dCwgc2VsZWN0LCBsYWJlbCcpO1xuICAgICAgZWxzLmZvckVhY2goKGVsKSA9PiB7XG5cbiAgICAgICAgZWwuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgaWYgKHNlcGFyKSB7IC8vIGNoYW5nZSBuYW1lcyBhbmQgaWQgd2hlbiBhZGRpbmcgYSBuZXcgcm93IC0gbm90IGlmIGNsZWFyIG9ubHlcbiAgICAgICAgICBjb25zdCBrZXlzID0gWydpZCcsICdmb3InLCAnYXJpYS1jb250cm9scycsICduYW1lJ107XG4gICAgICAgICAga2V5cy5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgICAgICAgIGxldCB2YWwgPSBlbC5nZXRBdHRyaWJ1dGUoa2V5KTtcbiAgICAgICAgICAgIGlmICh2YWwgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgaWYgKGtleSA9PT0gJ25hbWUnKSB2YWwgPSB2YWwucmVwbGFjZSgnWycgKyBuICsgJ10nLCAnWycgKyAobiArIDEpICsgJ10nKTtcbiAgICAgICAgICAgICAgZWxzZSB2YWwgPSB2YWwucmVwbGFjZSgnXycgKyBuLCAnXycgKyAobiArIDEpKTtcbiAgICAgICAgICAgICAgZWwuc2V0QXR0cmlidXRlKGtleSwgdmFsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBzd2l0Y2ggKGVsLnRhZ05hbWUudG9Mb3dlckNhc2UoKSkge1xuICAgICAgICAgIGNhc2UgJ2lucHV0JzpcbiAgICAgICAgICAgIC8vZWwuaW5kZXRlcm1pbmF0ZSA9IHRydWU7XG4gICAgICAgICAgICBlbC5jaGVja2VkID0gZmFsc2U7XG4gICAgICAgICAgICAvLyBkaXNhYmxlIGNvbnRhY3QgYXMgcHJpdmlsZWdlIGlzIGVtcHR5XG4gICAgICAgICAgICBpZiAoZWwubmFtZSA9PSB0aGlzLm9wdGlvbnMuY29udGFjdGZpZWxkbmFtZSkge1xuICAgICAgICAgICAgICBlbC52YWx1ZSA9IFwiMFwiO1xuICAgICAgICAgICAgICBlbC5kaXNhYmxlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlICdzZWxlY3QnOlxuICAgICAgICAgICAgZWwuc2VsZWN0ZWRJbmRleCA9IC0xO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSAnbGFiZWwnOlxuICAgICAgICAgICAgZWwuY2xhc3NMaXN0LnJlbW92ZShjc3MucGVlcmNoZWNrZWQpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGVsLnRvbXNlbGVjdCkge1xuICAgICAgICAgIGhhc19hdXRvY29tcGxldGUgPSBlbDtcbiAgICAgICAgICBlbC50b21zZWxlY3QuY2xlYXIoKTtcbiAgICAgICAgICBlbC50b21zZWxlY3QuZGVzdHJveSgpO1xuXG4gICAgICAgIH1cbiAgICAgICAgaWYgKGVsLmNsYXNzTGlzdC5jb250YWlucyhjc3MuY29tcG9uZW50LmF1dG9jb21wbGV0ZS50b21zZWxlY3RlZCkpIHtcbiAgICAgICAgICBoYXNfYXV0b2NvbXBsZXRlID0gZWw7XG4gICAgICAgICAgZWwuY2xhc3NMaXN0LmZvckVhY2goY2wgPT4ge1xuICAgICAgICAgICAgaWYgKGNsLmluZGV4T2YoJ3RzLScpID09IDApIGVsLmNsYXNzTGlzdC5yZW1vdmUoY2wpO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgZWwuY2xhc3NMaXN0LnJlbW92ZShjc3MuY29tcG9uZW50LmF1dG9jb21wbGV0ZS50b21zZWxlY3RlZCk7XG4gICAgICAgICAgaWYgKGVsLnR5cGUgPT0gXCJzZWxlY3Qtb25lXCIpIGRlbGV0ZSBlbC50eXBlO1xuXG4gICAgICAgIH1cblxuICAgICAgfSlcblxuICAgIH0pXG4gICAgLyogYWRkIGZ1bmN0aW9ubmFsaXRpZXMgKi9cbiAgICBpZiAoc2VwYXIpIHtcbiAgICAgIGxpbmUuY2xhc3NMaXN0LmFkZCgnbmV3Jyk7XG4gICAgICBzZXBhci5hZnRlcihsaW5lKTtcbiAgICB9XG4gICAgLyogY2xlYXIgYW5kIGFkZCB0b20tc2VsZWN0IGZ1bmN0aW9uYWxpdGllcyAtIG9ubHkgYWZ0ZXIgYWRkaW5nIGxpbmUgdG8gdGhlIGRvbSovXG4gICAgaWYgKGhhc19hdXRvY29tcGxldGUgIT09IG51bGwpIHtcbiAgICAgIGNvbnN0IGpzVG9tU2VsZWN0ID0gbmV3IEpzVG9tU2VsZWN0KCk7XG4gICAgICBqc1RvbVNlbGVjdC5hcHBseVRvKGhhc19hdXRvY29tcGxldGUpO1xuICAgICAgaGFzX2F1dG9jb21wbGV0ZS50b21zZWxlY3QuY2xlYXJPcHRpb25zKCk7XG4gICAgICBsZXQgb3B0aW9ucyA9IHRoaXMuZmllbGRzZXQuZGF0YXNldC5vcHRpb25zO1xuICAgICAgb3B0aW9ucyA9IChvcHRpb25zKSA/IG9wdGlvbnMgOiBbXTtcbiAgICAgIGhhc19hdXRvY29tcGxldGUudG9tc2VsZWN0LmFkZE9wdGlvbnMob3B0aW9ucyk7XG4gICAgfTtcblxuXG4gICAgcmV0dXJuIGxpbmU7XG4gIH1cblxuICBzZXRMaW5lKGxpbmUsIG1iID0ge1xuICAgIGtleTogJycsXG4gICAgdmFsdWU6ICcnXG4gIH0sIHByaXYsIGN0KSB7XG5cbiAgICBwcml2ID0gZGVmaW5lZF9wcml2aWxlZ2VzW3ByaXZdID8gZGVmaW5lZF9wcml2aWxlZ2VzW3ByaXZdIDogZGVmaW5lZF9wcml2aWxlZ2VzLnZpZXdlcnM7XG4gICAgaWYgKCFwcml2KSByZXR1cm47XG4gICAgY29uc3Qge1xuICAgICAgbWVtYmVyLFxuICAgICAgcHJpdnMsXG4gICAgICBjb250YWN0LFxuICAgICAgZGVsZXRcbiAgICB9ID0gdGhpcy5nZXRJbnB1dHMobGluZSwgcHJpdik7XG5cbiAgICBpZiAoIW1lbWJlciB8fCAhcHJpdnMgfHwgIWNvbnRhY3QgfHwgIWRlbGV0KSByZXR1cm47XG4gICAgLy8gc2FuaXRpemVcblxuICAgIG1iLmtleSA9IERPTVB1cmlmeS5zYW5pdGl6ZShtYi5rZXkpO1xuICAgIG1iLnZhbHVlID0gRE9NUHVyaWZ5LnNhbml0aXplKG1iLnZhbHVlKTtcbiAgICBpZiAobWVtYmVyLnRvbXNlbGVjdCkge1xuXG4gICAgICBsZXQgYWRkbWIgPSB7fVxuICAgICAgYWRkbWJbbWVtYmVyLnRvbXNlbGVjdC5zZXR0aW5ncy52YWx1ZUZpZWxkXSA9IG1iLmtleTtcbiAgICAgIGFkZG1iW21lbWJlci50b21zZWxlY3Quc2V0dGluZ3MubGFiZWxGaWVsZF0gPSBtYi52YWx1ZTtcbiAgICAgIGlmICghbWVtYmVyLnRvbXNlbGVjdC5nZXRPcHRpb24obWIua2V5KSkgbWVtYmVyLnRvbXNlbGVjdC5hZGRPcHRpb24oYWRkbWIpO1xuICAgICAgbWVtYmVyLnRvbXNlbGVjdC5hZGRJdGVtKG1iLmtleSwgZmFsc2UpO1xuICAgICAgbWVtYmVyLnRvbXNlbGVjdC5yZWZyZXNoT3B0aW9ucygpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBzZWxlY3RlZCA9IG1lbWJlci5xdWVyeVNlbGVjdG9yKCdzZWxlY3Qgb3B0aW9uW3ZhbHVlPVwiJyArIG1iLmtleSArICdcIl0nKTtcbiAgICAgIGlmIChzZWxlY3RlZCkgc2VsZWN0ZWQuc2VsZWN0ZWQgPSB0cnVlO1xuICAgICAgZWxzZSBtZW1iZXIuaW5zZXJ0QWRqYWNlbnRIVE1MKCdiZWZvcmVlbmQnLCAnPG9wdGlvbiB2YWx1ZT1cIicgKyBtYi5rZXkgKyAnXCIgc2VsZWN0ZWQ+JyArIG1iLnZhbHVlICsgJzwvb3B0aW9uPicpO1xuXG4gICAgfVxuICAgIHByaXZzLmNoZWNrZWQgPSB0cnVlO1xuICAgIGNvbnRhY3QudmFsdWUgPSBtYi5rZXk7XG4gICAgaWYgKHByaXYgPT09IHJpZ2h0cy5tYW5hZ2UpIHtcbiAgICAgIGNvbnRhY3QuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgIGlmIChjdCA9PT0gdHJ1ZSkgY29udGFjdC5jaGVja2VkID0gdHJ1ZTtcbiAgICB9XG5cbiAgfVxuICBnZXRJbnB1dHMobGluZSwgcHJpdiA9IGZhbHNlKSB7XG5cbiAgICBjb25zdCBtZW1iZXIgPSBsaW5lLnF1ZXJ5U2VsZWN0b3IoXCJbbmFtZSo9J1tcIiArIHRoaXMub3B0aW9ucy5pZGVudCArIFwiXSddXCIpO1xuXG4gICAgbGV0IHByaXZzO1xuICAgIGlmIChwcml2KSB7XG4gICAgICBwcml2cyA9IGxpbmUucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZSo9XCJbJyArIHRoaXMub3B0aW9ucy5wcml2aWxlZ2UgKyAnXVwiXVt2YWx1ZT1cIicgKyBwcml2ICsgJ1wiXScpO1xuICAgIH0gZWxzZSBwcml2cyA9IGxpbmUucXVlcnlTZWxlY3RvckFsbCgnaW5wdXRbbmFtZSo9XCJbJyArIHRoaXMub3B0aW9ucy5wcml2aWxlZ2UgKyAnXVwiXScpO1xuICAgIGNvbnN0IGNvbnRhY3QgPSBsaW5lLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWU9XCInICsgdGhpcy5vcHRpb25zLmNvbnRhY3RmaWVsZG5hbWUgKyAnXCJdJyk7XG4gICAgY29uc3QgZGVsZXQgPSBsaW5lLnF1ZXJ5U2VsZWN0b3IoXCJpbnB1dFtuYW1lKj0nW1wiICsgdGhpcy5vcHRpb25zLmRlbGV0ICsgXCJdJ11cIik7XG5cbiAgICByZXR1cm4ge1xuICAgICAgbWVtYmVyOiBtZW1iZXIsXG4gICAgICBwcml2czogcHJpdnMsXG4gICAgICBjb250YWN0OiBjb250YWN0LFxuICAgICAgZGVsZXQ6IGRlbGV0XG4gICAgfTtcbiAgfVxuICBhc3luYyBpbXBvcnRQcml2aWxlZ2VzKHByaXZpbGVnZXMsIGNsZWFyID0gZmFsc2UsIGNvbnRhY3QgPSBudWxsLCBpbXBvcnRlZHRhZyA9IG51bGwsIGRpc21pc3MgPSBudWxsKSB7XG4gICAgbGV0IGxhc3RsaW5lID0gKGNsZWFyID09PSB0cnVlKSA/IG51bGwgOiB0cnVlO1xuICAgIHRyeSB7XG4gICAgICBPYmplY3QuZW50cmllcyhwcml2aWxlZ2VzKS5mb3JFYWNoKChbcHJpdiwgbWVtYmVyc10pID0+IHtcbiAgICAgICAgbWVtYmVycy5mb3JFYWNoKChtZW1iZXIpID0+IHtcbiAgICAgICAgICBpZiAoIWxhc3RsaW5lKSBsYXN0bGluZSA9IHRoaXMuY2xlYXJBbGwodHJ1ZSk7XG4gICAgICAgICAgZWxzZSBsYXN0bGluZSA9IHRoaXMubmV3TGluZSh0cnVlLCBtZW1iZXIuaWQpO1xuXG4gICAgICAgICAgaWYgKGxhc3RsaW5lKSB7XG5cbiAgICAgICAgICAgIHRoaXMuc2V0TGluZShsYXN0bGluZSwge1xuICAgICAgICAgICAgICBrZXk6IG1lbWJlci5pZCxcbiAgICAgICAgICAgICAgdmFsdWU6IG1lbWJlci5uYW1lLFxuICAgICAgICAgICAgfSwgcHJpdiwgKGNvbnRhY3QgJiYgKHBhcnNlSW50KGNvbnRhY3QuaWQpID09PSBwYXJzZUludChtZW1iZXIuaWQpKSkpO1xuICAgICAgICAgICAgaWYgKGltcG9ydGVkdGFnKSBpbXBvcnRlZHRhZyhsYXN0bGluZSk7XG4gICAgICAgICAgICBpZiAoZGlzbWlzcykgZGlzbWlzcygpO1xuICAgICAgICAgIH1cblxuICAgICAgICB9KTtcblxuICAgICAgfSk7XG4gICAgICB0aGlzLmFsZXJ0Qm94LmRpc21pc3NBbGVydChjb2RlbWVzc2FnZXMuaW1wb3J0cHJpdmVycm9yKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgYXdhaXQgdGhpcy5hbGVydEJveC5idWlsZCh7XG4gICAgICAgIGRpc21pc3NpYmxlOiB0cnVlLFxuICAgICAgICBtZXNzYWdlOiBjb2RlbWVzc2FnZXMuaW1wb3J0cHJpdmVycm9yLFxuICAgICAgICBjb2RlaWQ6IHRydWUsXG4gICAgICAgIHBhcmVudDogdGhpcy5maWVsZHNldF9hbGVydF96b25lLFxuICAgICAgICB0eXBlOiBhbGVydGNvbmZpZy5kYW5nZXIsXG4gICAgICB9KTtcbiAgICAgIGNvbnNvbGUubG9nKCdlcnInLCBlcnIpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuICBhY3RpdmF0ZUV2ZW50cyhsaW5lKSB7XG4gICAgaWYgKCFsaW5lKSByZXR1cm47XG4gICAgY29uc3Qge1xuICAgICAgbWVtYmVyLFxuICAgICAgcHJpdnMsXG4gICAgICBjb250YWN0LFxuICAgICAgZGVsZXRcbiAgICB9ID0gdGhpcy5nZXRJbnB1dHMobGluZSk7XG4gICAgaWYgKCFtZW1iZXIgfHwgIXByaXZzIHx8ICFjb250YWN0IHx8ICFkZWxldCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBzaWJsaW5ncyA9IHMgPT4gWy4uLnMucGFyZW50RWxlbWVudC5jaGlsZHJlbl0uZmlsdGVyKGMgPT4gYy5ub2RlVHlwZSA9PSAxICYmIGMgIT0gcyAmJiBjLmNsYXNzTGlzdC5jb250YWlucygncm93JykgJiYgYy5kYXRhc2V0LmJsb2NrICE9PSBudWxsICYmIGMuZGF0YXNldC5ibG9jayA9PT0gdGhpcy5vcHRpb25zLnRhcmdldCk7XG5cbiAgICAvLyBlbmFibGUvZGlzYWJsZSBjb250YWN0IHdoZW4gcHJpdmlsZWdlIGNoYW5nZXNcbiAgICBjb25zdCBsaW5lU2V0dGluZ3MgPSAocHIsIGN0LCBkbCwgc3luY2hybyA9IGZhbHNlKSA9PiB7XG5cbiAgICAgIGlmIChwciAmJiBwci52YWx1ZSA9PT0gcmlnaHRzLm1hbmFnZSkge1xuICAgICAgICAvLyBtYW5hZ2VyIC0gY2FuJ3QgZGVsZXRlIGxpbmUgLSBjYW4gY2hvb3NlIGFzIGNvbnRhY3RcbiAgICAgICAgZGwuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICBjdC5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgICAvLyBkaXNtaXNzIHJlbGF0ZWQgYWxlcnRcbiAgICAgICAgdGhpcy5hbGVydEJveC5kaXNtaXNzQWxlcnQoY29kZW1lc3NhZ2VzLm5vbWFuYWdlcik7XG4gICAgICAgIGlmIChjdC5jaGVja2VkKSB7XG4gICAgICAgICAgdGhpcy5hbGVydEJveC5kaXNtaXNzQWxlcnQoY29kZW1lc3NhZ2VzLm5vY29udGFjdCk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIG5vdCBtYW5hZ2VyIC0gY2FuIGRlbGV0IGxpbmUgLSBjYW5ub3QgY2hvc2UgYXMgY29udGFjdFxuICAgICAgICAvLyAgaWYgKGN0LmNoZWNrZWQgPT09IHRydWUpIGN0LmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCdjbGljaycpKTtcbiAgICAgICAgY3QuY2hlY2tlZCA9IGZhbHNlO1xuICAgICAgICBkbC5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgICBjdC5kaXNhYmxlZCA9IHRydWU7XG4gICAgICB9XG5cbiAgICAgIGlmIChzeW5jaHJvID09PSB0cnVlKSB7XG4gICAgICAgIHN5bmNocm9TaWJsaW5ncyhsaW5lKTtcbiAgICAgIH1cbiAgICAgIC8vIGRpc21pc3MgYWxlcnRzXG4gICAgICBpZiAoIWRsLmNrZWNrZWQpIHtcbiAgICAgICAgdGhpcy5hbGVydEJveC5kaXNtaXNzQWxlcnQoY29kZW1lc3NhZ2VzLm5vYm9keSk7XG4gICAgICAgIHRoaXMuYWxlcnRCb3guZGlzbWlzc0FsZXJ0KGNvZGVtZXNzYWdlcy5vbmVhdGxlYXN0KTtcbiAgICAgIH1cbiAgICB9XG4gICAgY29uc3Qgc3luY2hyb1NpYmxpbmdzID0gKGxpbmUpID0+IHtcbiAgICAgIGNvbnN0IGxucyA9IHNpYmxpbmdzKGxpbmUpO1xuICAgICAgbG5zLmZvckVhY2goKGxuKSA9PiB7XG4gICAgICAgIGNvbnN0IGRsID0gbG4ucXVlcnlTZWxlY3RvcihcImlucHV0W25hbWUqPSdbXCIgKyB0aGlzLm9wdGlvbnMuZGVsZXQgKyBcIl0nXVwiKTtcbiAgICAgICAgY29uc3QgY3QgPSBsbi5xdWVyeVNlbGVjdG9yKCdpbnB1dFtuYW1lPVwiJyArIHRoaXMub3B0aW9ucy5jb250YWN0ZmllbGRuYW1lICsgJ1wiXScpO1xuICAgICAgICBjb25zdCBwciA9IGxuLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWUqPVwiWycgKyB0aGlzLm9wdGlvbnMucHJpdmlsZWdlICsgJ11cIl06Y2hlY2tlZCcpO1xuICAgICAgICBsaW5lU2V0dGluZ3MocHIsIGN0LCBkbCwgZmFsc2UpO1xuXG4gICAgICB9KVxuICAgIH1cblxuICAgIG1lbWJlci5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoZSkgPT4ge1xuICAgICAgY29udGFjdC52YWx1ZSA9IG1lbWJlci52YWx1ZTtcbiAgICAgIC8vIGRpc21pc3MgYWxlcnRcbiAgICAgIGlmIChtZW1iZXIudmFsdWUpIHtcbiAgICAgICAgdGhpcy5hbGVydEJveC5kaXNtaXNzQWxlcnQoY29kZW1lc3NhZ2VzLmVtcHR5bmFtZSk7XG4gICAgICAgIHRoaXMuYWxlcnRCb3guZGlzbWlzc0FsZXJ0KGNvZGVtZXNzYWdlcy5vbmVhdGxlYXN0KTtcbiAgICAgICAgdGhpcy5hbGVydEJveC5kaXNtaXNzQWxlcnQoY29kZW1lc3NhZ2VzLm5vYm9keSk7XG4gICAgICB9XG4gICAgfSlcblxuICAgIHByaXZzLmZvckVhY2goKHByaXYpID0+IHtcbiAgICAgIHByaXYuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKGUpID0+IHtcbiAgICAgICAgaWYgKHByaXYuY2hlY2tlZCkgbGluZVNldHRpbmdzKHByaXYsIGNvbnRhY3QsIGRlbGV0LCBmYWxzZSk7XG4gICAgICB9KTtcblxuICAgICAgaWYgKHByaXYuY2hlY2tlZCkgbGluZVNldHRpbmdzKHByaXYsIGNvbnRhY3QsIGRlbGV0LCBmYWxzZSk7XG4gICAgfSlcblxuICAgIGNvbnRhY3QuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKGUpID0+IHtcbiAgICAgIGlmIChlLnRhcmdldC5jaGVja2VkKSBkZWxldC5kaXNhYmxlZCA9IHRydWU7XG4gICAgICBlbHNlIGRlbGV0LmRpc2FibGVkID0gZmFsc2U7XG4gICAgICBjb25zdCBwcml2ID0gbGluZS5xdWVyeVNlbGVjdG9yKCdpbnB1dFtuYW1lKj1cIlsnICsgdGhpcy5vcHRpb25zLnByaXZpbGVnZSArICddXCJdOmNoZWNrZWQnKTtcbiAgICAgIGxpbmVTZXR0aW5ncyhwcml2LCBjb250YWN0LCBkZWxldCwgdHJ1ZSk7XG4gICAgICAvLyBlbmFibGUgb3RoZXJ3aXNlXG5cbiAgICB9KVxuXG4gICAgLy8gZGVsZXQgb2sgZm9yIGFsbCB3aGVuIG5ldyBsaW5lXG4gICAgLy9cbiAgICBkZWxldC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAvLyBhdCBsZWFzdCBvbmUgcHJpdiBsaW5lXG4gICAgICBjb25zdCBkZWxldGxhYmVsID0gZGVsZXQuY2xvc2VzdCgnbGFiZWwnKTtcbiAgICAgIGNvbnN0IGxpbmVzID0gdGhpcy5maWVsZHNldC5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1ibG9jaz1cIicgKyB0aGlzLm9wdGlvbnMudGFyZ2V0ICsgJ1wiXTpub3QoW2RhdGEtbW9kPVwicmVtb3ZlXCJdKScpO1xuICAgICAgaWYgKGxpbmVzLmxlbmd0aCA8PSAxICYmIGUudGFyZ2V0LmNoZWNrZWQpIHtcbiAgICAgICAgZGVsZXQuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICBkZWxldC5jaGVja2VkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuYWxlcnRCb3guYnVpbGQoe1xuICAgICAgICAgIGRpc21pc3NpYmxlOiB0cnVlLFxuICAgICAgICAgIG1lc3NhZ2U6IGNvZGVtZXNzYWdlcy5vbmVhdGxlYXN0LFxuICAgICAgICAgIGNvZGVtZXNzYWdlOiBjb2RlbWVzc2FnZXMub25lYXRsZWFzdCxcbiAgICAgICAgICB0eXBlOiBhbGVydGNvbmZpZy53YXJuaW5nLFxuICAgICAgICAgIHBhcmVudDogKGUuY3VycmVudFRhcmdldC5pZCB8fCBudWxsKVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfSBlbHNlIGlmIChlLnRhcmdldC5jaGVja2VkKSB7XG4gICAgICAgIHRoaXMuYWxlcnRCb3guZGlzbWlzc0FsZXJ0KGNvZGVtZXNzYWdlcy5vbmVhdGxlYXN0KTtcbiAgICAgICAgaWYgKGxpbmUuY2xhc3NMaXN0LmNvbnRhaW5zKCduZXcnKSkge1xuICAgICAgICAgIGxpbmUucmVtb3ZlKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKGRlbGV0bGFiZWwgJiYgZGVsZXRsYWJlbC5kYXRhc2V0LnJlc3RvcmUpIGRlbGV0bGFiZWwuc2V0QXR0cmlidXRlKCd0aXRsZScsIGRlbGV0bGFiZWwuZGF0YXNldC5yZXN0b3JlKTtcbiAgICAgICAgICBsaW5lLnNldEF0dHJpYnV0ZSgnZGF0YS1tb2QnLCAncmVtb3ZlJyk7XG4gICAgICAgICAgcHJpdnMuZm9yRWFjaChwcml2ID0+IHtcbiAgICAgICAgICAgIHByaXYuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICAgICAgcHJpdi5jaGVja2VkID0gZmFsc2U7XG4gICAgICAgICAgfSlcbiAgICAgICAgICBjb250YWN0LmNoZWNrZWQgPSBmYWxzZTtcbiAgICAgICAgICBjb250YWN0LmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgICBtZW1iZXIuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoZGVsZXRsYWJlbCAmJiBkZWxldGxhYmVsLmRhdGFzZXQucmVtb3ZlKSBkZWxldGxhYmVsLnNldEF0dHJpYnV0ZSgndGl0bGUnLCBkZWxldGxhYmVsLmRhdGFzZXQucmVtb3ZlKTtcbiAgICAgICAgbGluZS5yZW1vdmVBdHRyaWJ1dGUoJ2RhdGEtbW9kJyk7XG4gICAgICAgIHByaXZzLmZvckVhY2gocHJpdiA9PiBwcml2LmRpc2FibGVkID0gZmFsc2UpO1xuICAgICAgICBjb250YWN0LmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgIG1lbWJlci5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgfVxuICAgIH0pO1xuICAgIC8vIGRlbGV0IG1vdXNlb3ZlciAtIGV4cGxhaW4gd2h5IGl0IGlzIGRpc2FibGVkIHdoZW4gbWFuYWdlIGlzIGNoZWNrZWRcbiAgICBkZWxldC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW92ZXInLCAoZSkgPT4ge1xuICAgICAgaWYgKGUudGFyZ2V0LmRpc2FibGVkKSB7XG4gICAgICAgIGxldCBwciA9IGxpbmUucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZSo9XCJbJyArIHRoaXMub3B0aW9ucy5wcml2aWxlZ2UgKyAnXVwiXTpjaGVja2VkJyk7XG4gICAgICAgIGlmICghcHIpIHJldHVybjtcbiAgICAgICAgcHIgPSBwci52YWx1ZS50b0xvd2VyQ2FzZSgpXG4gICAgICAgIGUudGFyZ2V0LnRpdGxlID0gKGUudGFyZ2V0LmRhdGFzZXRbcHJdKSA/IGUudGFyZ2V0LmRhdGFzZXRbcHJdIDogZS50YXJnZXQudGl0bGVcbiAgICAgIH1cbiAgICB9KVxuICAgIC8vIGRpc2FibGUgZGVsZXQgaWYgdXNlciBpcyB0aGUgb25seSBtYW5hZ2VyXG4gICAgaWYgKHRoaXMuY3VycmVudF91aWQgPT09IG1lbWJlci52YWx1ZSkgZGVsZXQuZGlzYWJsZWQgPSB0cnVlO1xuXG5cbiAgfVxuXG4gIC8vIHNlbmQgY2xlYW4gZGF0YSBvbiBzdWJtaXRcbiAgYXN5bmMgY2xlYW5Qcml2aWxlZ2VzKCkge1xuICAgIC8vIGNoZWNrIG1hbmFnZXJzIGFuZCBjb250YWN0X3VzZXJfaWQgb24gc3VibWl0XG5cbiAgICBjb25zdCBjaGVja0NvbnRhY3QgPSBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBjaGVjayBpZiBvbmUgbWFuYWdlciBhdCBsZWFzdFxuICAgICAgY29uc3QgbWFuYWdlcnMgPSB0aGlzLmZpZWxkc2V0LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tuYW1lKj1cIlsnICsgdGhpcy5vcHRpb25zLnByaXZpbGVnZSArICddXCJdW3ZhbHVlPVwiJyArIHJpZ2h0cy5tYW5hZ2UgKyAnXCJdOmNoZWNrZWQnKTtcbiAgICAgIGxldCBuID0gbWFuYWdlcnMubGVuZ3RoO1xuXG4gICAgICBpZiAobiA9PT0gMCkge1xuICAgICAgICBhd2FpdCB0aGlzLmFsZXJ0Qm94LmJ1aWxkKHtcbiAgICAgICAgICBkaXNtaXNzaWJsZTogdHJ1ZSxcbiAgICAgICAgICBtZXNzYWdlOiBjb2RlbWVzc2FnZXMubm9tYW5hZ2VyLFxuICAgICAgICAgIGNvZGVpZDogdHJ1ZSxcbiAgICAgICAgICB0eXBlOiBhbGVydGNvbmZpZy5kYW5nZXIsXG4gICAgICAgICAgcGFyZW50OiB0aGlzLmZpZWxkc2V0X2FsZXJ0X3pvbmUsXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9IGVsc2UgdGhpcy5hbGVydEJveC5kaXNtaXNzQWxlcnQoY29kZW1lc3NhZ2VzLm5vbWFuYWdlcik7XG4gICAgICAvLyBjaGVjayBjb250YWN0XG4gICAgICBjb25zdCBjb250YWN0ID0gdGhpcy5maWVsZHNldC5xdWVyeVNlbGVjdG9yKCdbbmFtZT1cIicgKyB0aGlzLm9wdGlvbnMuY29udGFjdGZpZWxkbmFtZSArICdcIl06Y2hlY2tlZCcpO1xuXG4gICAgICBpZiAoY29udGFjdCA9PT0gbnVsbCkge1xuICAgICAgICBhd2FpdCB0aGlzLmFsZXJ0Qm94LmJ1aWxkKHtcbiAgICAgICAgICBkaXNtaXNzaWJsZTogdHJ1ZSxcbiAgICAgICAgICBjb2RlaWQ6IHRydWUsXG4gICAgICAgICAgbWVzc2FnZTogY29kZW1lc3NhZ2VzLm5vY29udGFjdCxcbiAgICAgICAgICB0eXBlOiBhbGVydGNvbmZpZy5kYW5nZXIsXG4gICAgICAgICAgcGFyZW50OiB0aGlzLmZpZWxkc2V0X2FsZXJ0X3pvbmVcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHRoaXMuYWxlcnRCb3guZGlzbWlzc0FsZXJ0KGNvZGVtZXNzYWdlcy5ub2NvbnRhY3QpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGNvbnN0IGhhc01lbWJlciA9IChsaW5lKSA9PiB7XG4gICAgICBjb25zdCBtZW1iZXIgPSBsaW5lLnF1ZXJ5U2VsZWN0b3IoJ1tuYW1lKj1cIlsnICsgdGhpcy5vcHRpb25zLmlkZW50ICsgJ11cIl0nKTtcbiAgICAgIHJldHVybiAobWVtYmVyLnZhbHVlKTtcbiAgICB9XG4gICAgY29uc3QgaGFzUHJpdiA9IChsaW5lKSA9PiB7XG4gICAgICBjb25zdCBwcml2ID0gbGluZS5xdWVyeVNlbGVjdG9yKCdbbmFtZSo9XCJbJyArIHRoaXMub3B0aW9ucy5wcml2aWxlZ2UgKyAnXVwiXTpjaGVja2VkJyk7XG4gICAgICBpZiAocHJpdiAmJiBwcml2LnZhbHVlKSByZXR1cm4gdHJ1ZTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uc3QgZm9ybWF0UHJpdmlsZWdlID0gKGxpbmUpID0+IHtcblxuICAgICAgY29uc3QgZWxzID0gbGluZS5xdWVyeVNlbGVjdG9yQWxsKCdbbmFtZSo9XCJtZW1iZXJzW1wiJyk7XG4gICAgICBlbHMuZm9yRWFjaCgoZWwpID0+IHtcbiAgICAgICAgbGV0IG5hbWUgPSBlbC5uYW1lO1xuICAgICAgICBuYW1lID0gbmFtZS5zcGxpdCgnWycpO1xuICAgICAgICBuYW1lLnBvcCgpO1xuICAgICAgICBlbC5uYW1lID0gbmFtZS5qb2luKCdbJyk7XG4gICAgICAgIGlmIChlbC5uYW1lLmluZGV4T2YoJ1snICsgdGhpcy5vcHRpb25zLnByaXZpbGVnZSArICddJykgPiAwKSB7XG4gICAgICAgICAgZWwudHlwZSA9ICdjaGVja2JveCc7XG4gICAgICAgICAgZWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7XG4gICAgICAgIH1cblxuICAgICAgfSlcbiAgICB9XG4gICAgY29uc3QgaGFzY29udGFjdCA9IGF3YWl0IGNoZWNrQ29udGFjdCgpO1xuICAgIGlmIChoYXNjb250YWN0ID09PSB0cnVlKSB7XG4gICAgICBjb25zdCBsaW5lcyA9IHRoaXMuZmllbGRzZXQucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtYmxvY2s9XCInICsgdGhpcy5vcHRpb25zLnRhcmdldCArICdcIl0nKTtcbiAgICAgIGxldCBuID0gbGluZXMubGVuZ3RoO1xuICAgICAgbGV0IHZlcmlmID0gdHJ1ZTtcbiAgICAgIGZvciAoY29uc3QgbGluZSBvZiBsaW5lcykge1xuICAgICAgICBpZiAobGluZS5kYXRhc2V0Lm1vZCAmJiBsaW5lLmRhdGFzZXQubW9kID09PSAncmVtb3ZlJykge1xuICAgICAgICAgIGlmIChuID4gMSkge1xuICAgICAgICAgICAgbGluZS5yZW1vdmUoKTtcbiAgICAgICAgICAgIG4tLTtcbiAgICAgICAgICB9IGVsc2UgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9IGVsc2UgaWYgKCFoYXNNZW1iZXIobGluZSkpIHtcbiAgICAgICAgICBjb25zdCBsaW5lbm8gPSBsaW5lLnF1ZXJ5U2VsZWN0b3IoJ1tuYW1lKj1cIlsnICsgdGhpcy5vcHRpb25zLmlkZW50ICsgJ11cIl0nKTtcbiAgICAgICAgICBsaW5lbm8uZm9jdXMoKTtcbiAgICAgICAgICBpZiAobGluZW5vLnRvbXNlbGVjdCkgbGluZW5vLnRvbXNlbGVjdC5mb2N1cygpO1xuICAgICAgICAgIGF3YWl0IHRoaXMuYWxlcnRCb3guYnVpbGQoe1xuICAgICAgICAgICAgZGlzbWlzc2libGU6IHRydWUsXG4gICAgICAgICAgICBpbnNlcnRhZnRlcjogdHJ1ZSxcbiAgICAgICAgICAgIG1lc3NhZ2U6IGNvZGVtZXNzYWdlcy5lbXB0eW5hbWUsXG4gICAgICAgICAgICBjb2RlaWQ6IHRydWUsXG4gICAgICAgICAgICB0eXBlOiBhbGVydGNvbmZpZy53YXJuaW5nLFxuICAgICAgICAgICAgcGFyZW50OiBsaW5lXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgY29uc3QgcmVzcCA9IGZhbHNlOyAvLyBubyBjb25maW1ib3gganVzdCB3YWl0IGZvciB1c2VyIGFjdGlvblxuICAgICAgICAgIC8vIGNhbGxiYWNrIHdoZW4gY29uZmlybWJveCByZXNwb25zZSBpcyBjaG9zZW4gaWYgJ2NvbmZpcm0nXG4gICAgICAgICAgaWYgKHJlc3AgPT09IHRydWUpIHtcbiAgICAgICAgICAgIGlmIChuID4gMSkge1xuICAgICAgICAgICAgICBsaW5lLnJlbW92ZSgpO1xuICAgICAgICAgICAgICBuLS07XG4gICAgICAgICAgICB9IGVsc2UgcmV0dXJuIGZhbHNlO1xuXG4gICAgICAgICAgfSBlbHNlIHJldHVybiBmYWxzZTtcbiAgICAgICAgfSBlbHNlIGlmICghaGFzUHJpdihsaW5lKSkge1xuICAgICAgICAgIHRoaXMuYWxlcnRCb3guZGlzbWlzc0FsZXJ0KGNvZGVtZXNzYWdlcy5lbXB0eW5hbWUpO1xuICAgICAgICAgIGF3YWl0IHRoaXMuYWxlcnRCb3guYnVpbGQoe1xuICAgICAgICAgICAgZGlzbWlzc2libGU6IHRydWUsXG4gICAgICAgICAgICBpbnNlcnRhZnRlcjogdHJ1ZSxcbiAgICAgICAgICAgIGNvZGVpZDogdHJ1ZSxcbiAgICAgICAgICAgIG1lc3NhZ2U6IGNvZGVtZXNzYWdlcy51aGFzbm9wcml2LFxuICAgICAgICAgICAgdHlwZTogYWxlcnRjb25maWcud2FybmluZyxcbiAgICAgICAgICAgIHBhcmVudDogbGluZVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHZlcmlmID0gZmFsc2U7XG4gICAgICAgIH0gZWxzZSB0aGlzLmFsZXJ0Qm94LmRpc21pc3NBbGVydChjb2RlbWVzc2FnZXMudWhhc25vcHJpdik7XG4gICAgICB9XG4gICAgICBpZiAoIXZlcmlmKSByZXR1cm4gdmVyaWY7XG4gICAgICBmb3IgKGNvbnN0IGxpbmUgb2YgbGluZXMpIHtcbiAgICAgICAgZm9ybWF0UHJpdmlsZWdlKGxpbmUpO1xuICAgICAgfVxuXG4gICAgICBpZiAobiA9PT0gMCkge1xuICAgICAgICBhd2FpdCB0aGlzLmFsZXJ0Qm94LmJ1aWxkKHtcbiAgICAgICAgICBkaXNtaXNzaWJsZTogdHJ1ZSxcbiAgICAgICAgICBjb2RlaWQ6IHRydWUsXG4gICAgICAgICAgbWVzc2FnZTogY29kZW1lc3NhZ2VzLm5vYm9keSxcbiAgICAgICAgICB0eXBlOiBhbGVydGNvbmZpZy53YXJuaW5nLFxuICAgICAgICAgIHBhcmVudDogdGhpcy5maWVsZHNldF9hbGVydF96b25lXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9IGVsc2UgdGhpcy5hbGVydEJveC5kaXNtaXNzQWxlcnQoY29kZW1lc3NhZ2VzLm5vYm9keSk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGVsc2UgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGdldExpbmVQcml2aWxlZ2UoaWQpIHtcbiAgICBsZXQgcHJpdmlsZWdlID0gbnVsbDtcbiAgICBjb25zdCBsaW5lcyA9IHRoaXMuZmllbGRzZXQucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtYmxvY2s9XCInICsgdGhpcy5vcHRpb25zLnRhcmdldCArICdcIl0nKVxuICAgIGZvciAoY29uc3QgbGluZSBvZiBsaW5lcykge1xuICAgICAgaWYgKHBhcnNlSW50KGxpbmUucXVlcnlTZWxlY3RvcignW25hbWUqPVwiWycgKyB0aGlzLm9wdGlvbnMuaWRlbnQgKyAnXVwiXScpLnZhbHVlKSA9PT0gcGFyc2VJbnQoaWQpKSB7XG4gICAgICAgIHByaXZpbGVnZSA9IGxpbmU7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBwcml2aWxlZ2U7XG4gIH1cblxuICBjbGVhckFsbChyZXQgPSBmYWxzZSkge1xuICAgIGNvbnN0IGxpbmVzID0gdGhpcy5maWVsZHNldC5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1ibG9jaz1cIicgKyB0aGlzLm9wdGlvbnMudGFyZ2V0ICsgJ1wiXScpO1xuXG4gICAgbGluZXMuZm9yRWFjaCgobGluZSwgaW5kZXgpID0+IHtcbiAgICAgIGNvbnN0IHtcbiAgICAgICAgbWVtYmVyLFxuICAgICAgICBwcml2cyxcbiAgICAgICAgY29udGFjdCxcbiAgICAgICAgZGVsZXRcbiAgICAgIH0gPSB0aGlzLmdldElucHV0cyhsaW5lKTtcbiAgICAgIGlmIChpbmRleCA+IDAgJiYgKHRoaXMuY3VycmVudF91aWQgIT09IG1lbWJlci52YWx1ZSkpIGxpbmUucmVtb3ZlKCk7XG4gICAgfSk7XG4gICAgLy9cbiAgICB0aGlzLmNsZWFyTGluZShsaW5lc1swXSwgMCk7XG4gICAgdGhpcy5hY3RpdmF0ZUV2ZW50cyhsaW5lc1swXSk7XG4gICAgaWYgKHJldCA9PT0gdHJ1ZSkgcmV0dXJuIGxpbmVzWzBdO1xuICB9XG5cblxufSJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/modules/project-privileges.js\n")}}]);