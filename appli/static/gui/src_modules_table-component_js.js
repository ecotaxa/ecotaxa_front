/*! For license information please see src_modules_table-component_js.js.LICENSE.txt */
(self.webpackChunk=self.webpackChunk||[]).push([["src_modules_table-component_js"],{"./src/modules/table-component.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"TableComponent\": () => (/* binding */ TableComponent)\n/* harmony export */ });\n/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! dompurify */ \"./node_modules/dompurify/dist/purify.js\");\n/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(dompurify__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var simple_datatables__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! simple-datatables */ \"./node_modules/simple-datatables/dist/module.js\");\n/* harmony import */ var deep_equal__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! deep-equal */ \"./node_modules/deep-equal/index.js\");\n/* harmony import */ var deep_equal__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(deep_equal__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var diff_dom__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! diff-dom */ \"./node_modules/diff-dom/dist/module.js\");\n/* harmony import */ var _modules_utils_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../modules/utils.js */ \"./src/modules/utils.js\");\n/* harmony import */ var _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../modules/modules-config.js */ \"./src/modules/modules-config.js\");\n\n\n\n\n\n\nlet instance = [];\n// valid fetch urlparts\nconst fetchfroms = {\n  prjlist: '/gui/prjlist/',\n  prjsamplestats: '/gui/prjsamplestats',\n  userslist: '/gui/admin/userslist'\n};\n// specifc css\nconst tablecss = {\n  showfull: 'showfull',\n  tipinline: \"tip-inline\",\n  searchresults: \"search-results\",\n  selectaction: \"selectaction\",\n  absinput: 'absinput',\n  disabled: 'datatable-disabled',\n  ascending: 'datable-ascending',\n  descending: 'datatable-descending',\n  tipover: 'tipover absolute z-10 text-stone-50 rounded bg-stone-600 px-2 py-0.5 -mt-5 ml-12 '\n};\nconst tableselectors = {\n  datatable: '.datatable-table',\n  datatable_wrapper: '.datatable-wrapper',\n  datatable_top: '.datatable-top',\n  datatable_search: '.datatable-input',\n  table_filters: 'table-filters',\n  datatable_sorter: '.datatable-sorter',\n  details: 'details[data-what=\"about\"]',\n  tip: '.' + _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.component.table.tip,\n  tipover: '.tipover',\n  wait: 'wait-please',\n  sorton: '.sorton',\n};\n\nObject.freeze(tablecss);\nObject.freeze(tableselectors);\nconst dynamics = {};\nclass TableComponent {\n  instanceid = null;\n  columns = {};\n  headings = [];\n  datas = [];\n  grid = null;\n  params = null;\n  importfields = null;\n\n  constructor(container, options = {}) {\n    if (!container) return;\n    container = container instanceof HTMLElement ? container : document.querySelector(container);\n    if (!container) return;\n    //can select multiples tables in one page  or load data in the same table\n    this.instanceid = (container.dataset.instanceid) ? container.dataset.instanceid : document.querySelectorAll('table').length;\n    if (!instance[this.instanceid] || !deep_equal__WEBPACK_IMPORTED_MODULE_2___default()(container.dataset, instance[this.instanceid].params)) {\n      this.init(container);\n    } else this.refresh();\n    return instance[this.instanceid];\n\n  }\n  init(container) {\n    this.params = container.dataset;\n    // only valid from values - fetchfroms\n    this.params.from = (this.params.from) ? dompurify__WEBPACK_IMPORTED_MODULE_0___default().sanitize(this.params.from) : null;\n    const from = (this.params.from) ? ((Object.keys(fetchfroms).indexOf(this.params.from) >= 0) ? window.location.href.split('/gui/')[0] + fetchfroms[this.params.from] : null) : null;\n    if (from) {\n      if (this.params.defer) this.deferLoad(container, from);\n      else this.fetchData(container, from);\n    } else {\n      this.tableActivate(container).then(() => {\n        instance[this.instanceid] = this;\n      });\n    }\n  }\n\n  waitActivate(container) {\n    let waitdiv = container.querySelector('#' + tableselectors.wait);\n    if (!waitdiv) {\n      waitdiv = document.createElement('div');\n      waitdiv.id = tableselectors.wait;\n      container.append(waitdiv);\n    }\n    this.waitdiv = waitdiv;\n    this.timer = new Date();\n  }\n\n  waitDesactivate(message = null, type = 'info') {\n    if (!this.waitdiv) return;\n    if (message) this.waitdiv.innerHTML = `<div class=\"${type}\">${message}</div>`;\n    else this.waitdiv.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.hide);\n  }\n\n  deferLoad(container, from) {\n    const btn = container.querySelector(this.params.defer);\n    if (!btn) return;\n\n    btn.addEventListener('click', (e) => {\n      this.fetchData(container, from);\n      btn.remove();\n    });\n  }\n  fetchData(container, fromurl, pagestart = 0) {\n    this.waitActivate(container);\n    const pagesize = (this.params.pagesize) ? this.params.pagesize : 0;\n\n    let from = (this.params.import) ? fromurl + '?' + new URLSearchParams({\n      typeimport: dompurify__WEBPACK_IMPORTED_MODULE_0___default().sanitize(this.params.import),\n      window_start: pagestart,\n      window_size: pagesize,\n      gz: true,\n    }) : ((pagesize) ? fromurl + '?' + new URLSearchParams({\n      window_start: pagestart,\n      window_size: pagesize,\n      listall: ((this.params.listall) ? this.params.listall : false)\n    }) : fromurl + '?' + new URLSearchParams({\n      listall: ((this.params.listall) ? this.params.listall : false)\n    }));\n    if (this.params.fromid) from += '/' + this.params.fromid;\n    fetch(from, (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_4__.fetchSettings)()).then(response => {\n      if (response.ok) return response.json();\n      return Promise.reject(response);\n    }).then(async tabledef => {\n      if (this.waitdiv) this.waitdiv.innerHTML = ((this.waitdiv.dataset.loaded) ? dompurify__WEBPACK_IMPORTED_MODULE_0___default().sanitize(this.waitdiv.dataset.loaded) : default_messages.dataloaded);\n      if (tabledef.columns) this.columns = tabledef.columns;\n      else if (this.params.columns) {\n        this.columns = JSON.parse(this.params.columns);\n      }\n      if (pagestart === 0) {\n        container.addEventListener('dissmisstable', (e) => {\n          console.log('destroy table');\n          this.destroy();\n        });\n        this.tableActivate(container, tabledef).then(() => {\n          instance[this.instanceid] = this;\n        });\n        // dismiss table when dismiss modal\n\n\n      } else if (tabledef.length) this.tableInsertRows(tabledef);\n      else pagesize = 0;\n      if (pagesize > 0) this.fetchData(container, fromurl, pagestart + pagesize);\n    }).catch(response => {\n      return this.waitDesactivate(`Status ${response.status} ${response.statusText}`, 'error');\n      console.log(response.json());\n    });\n\n  }\n\n  async tableActivate(container, tabledef = null) {\n    let table = container.querySelector('table');\n    if (!table) {\n      table = document.createElement('table');\n      container.append(table);\n    }\n    table.id = 'table-' + container.id;\n    let options = {\n      type: \"main\",\n      searchable: (this.params.searchable) ? (this.params.searchable === 'true') : false,\n      sortable: (this.params.sortable) ? (this.params.sortable === 'true') : false,\n      paginate: (this.params.paginate) ? (this.params.paginate === 'true') : false,\n      fixedHeight: false,\n      paging: (this.params.paging) ? (this.params.paging === 'true') : false,\n      noPaging: true,\n      perPage: (this.params.paging) ? ((this.params.perpage) ? (this.params.perpage === 'true') : 100) : 1000000,\n      perPageSelect: (this.params.paging === 'true') ? [10, 50, 100, 500, 1000] : false,\n      scrollY: \"\",\n      footer: (this.params.footer) ? (this.params.footer === 'true') : ((container.querySelector('tfoot')) ? true : false),\n      labels: (this.params.labels) ? this.params.labels : {\n        placeholder: \"Search...\",\n        perPage: \"{select} entries per page\",\n        noRows: \"No entries found\",\n        info: \"Showing {start} to {end} of {rows} entries\",\n        noResults: \"No result match your search query\"\n      },\n    };\n    if (tabledef) {\n      tabledef = await this.convertDatas(tabledef);\n      const lastused = (tabledef.lastused) ? tabledef.lastused : [];\n      const cellidname = ((this.params.hasOwnProperty(\"cellid\")) ? this.params.cellid : 'id');\n\n      options = { ...options,\n        ...{\n          data: {\n            headings: tabledef.headings,\n            data: tabledef.data\n          },\n          columns: tabledef.columns,\n          rowRender: (rowValue, tr, rowIndex) => {\n            rowValue.forEach(value => {\n              return dompurify__WEBPACK_IMPORTED_MODULE_0___default().sanitize(value);\n            })\n            const id = this.getCellData(rowIndex, cellidname);\n            tr.attributes = (tr.hasOwnProperty('attributes')) ? tr.attributes : {};\n            tr.attributes['data-id'] = id;\n            if (lastused.indexOf(id) >= 0) {\n              tr.attributes[\"class\"] = (tr.attributes[\"class\"]) ? tr.attributes[\"class\"] + \" last-used\" : \"last-used\";\n            }\n          }\n        }\n      };\n    } else {\n      const footer = table.querySelectorAll('tfoot th');\n      if (footer.length) options.footer = true;\n      options.rowRender = function(rowValue, tr, rowIndex) {\n        rowValue.forEach(value => {\n          return dompurify__WEBPACK_IMPORTED_MODULE_0___default().sanitize(value);\n        })\n      }\n      options.tableRender = function(tableValue, table) {\n        const l = table.childNodes.length - 1;\n        if (table.childNodes[l].nodeName === 'TFOOT' && footer.length) {\n          const footercells = Array.from(footer).map(cell => {\n            return (0,diff_dom__WEBPACK_IMPORTED_MODULE_3__.nodeToObj)(cell);\n          });\n\n          table.childNodes[l].childNodes = [{\n            nodeName: \"TR\",\n            childnodes: footercells\n          }];\n\n        }\n      }\n    }\n\n    /*  DataTable.extend('search', (query) => {\n      this.searchTable(query);\n    });*/\n\n    this.grid = new simple_datatables__WEBPACK_IMPORTED_MODULE_1__.DataTable(table, options);\n\n    this.grid.on('datatable.init', () => {\n      // hide and move waitdiv in the wrapper for inner elements display\n      this.waitDesactivate();\n      // move import zones and/or search zone - reorg the page display\n      container.style.top = container.offsetTop + 'px';\n      // fetch once the same table\n      container.dataset.table = this.params.table = true;\n      this.grid.dom.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.hide);\n      this.datas = null;\n      const search = this.grid.wrapperDOM.querySelector(tableselectors.datatable_search);\n      if (search) {\n        // style like any other form element\n        search.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.input);\n      }\n      this.initPlugins(container);\n\n    });\n\n\n  }\n  tableAppendRows(rows) {\n    console.log('rows');\n  }\n  destroy() {\n    if (this.dataImport) this.dataImport = null;\n    this.grid = null;\n    delete instance[this.instanceid];\n  }\n  refresh(e) {\n    if (this.dataImport && this.dataImport.selectors) this.dataImport.selectors.forEach(selector => {\n      if (this.disabled) this.disabled = false;\n    });\n  }\n  labelFormatter(field, column) {\n    let align = ``;\n    if (['number', 'progress', 'decimal'].find(format => format === column.format)) align = _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.right;\n    if (column.subfield) return `${column.label} <span class=\"sublabel\">${column.sublabel}</span>`;\n    else if (column.label) return `<span class=\"col-${field} ${align}\">${column.label}</span>`;\n    else return ``;\n  }\n  getCellId(name, state = null) {\n    return this.headings.indexOf(name);\n  }\n  getCellData(rowIndex, name) {\n    const cellIndex = this.getCellId(name);\n    if (cellIndex < 0) return null;\n    return (this.grid) ? ((this.grid.data.data[rowIndex]) ? this.grid.data.data[rowIndex][cellIndex].data : null) : (this.datas && this.datas[rowIndex]) ? this.datas[rowIndex][cellIndex] : null;\n  }\n\n\n  setTextNode(value) {\n    return {\n      nodeName: \"#text\",\n      data: value\n    };\n  }\n\n  async convertDatas(tabledef) {\n\n    const headings = Object.entries(this.columns).map(([key, column], index) => {\n      const heading = {\n        data: key,\n        text: (column.label) ? column.label : ``,\n        //  html: this.labelFormatter(key, column),\n      }\n      if (column.hasOwnProperty('hidden')) heading['hidden'] = true;\n      return heading;\n    });\n    const keys = Object.keys(this.columns);\n    this.headings = keys;\n    const columns = this.convertColumns();\n    // convert json rows => sorted array by columns\n    if (!tabledef.hasOwnProperty('data') || (tabledef.hasOwnProperty('type') && tabledef.type === \"json\")) {\n      tabledef = ((tabledef.hasOwnProperty('data')) ? tabledef.data : tabledef).map((data) => {\n        let row = [];\n        let hidden = [];\n        keys.forEach((key, index) => {\n          let r = row;\n          if (data.hasOwnProperty(key)) r.push((data[key] === NaN) ? null : data[key]);\n          else r.push(null);\n        });\n        return [...row, ...hidden];\n      });\n      this.datas = tabledef;\n      tabledef = {\n        data: tabledef\n      }\n    } else {\n      const l = tabledef.data.length;\n      for (let i = 0; i < l; i++) {\n        const lr = tabledef.data[i].length;\n        for (let j = 0; j < lr; j++) {\n          tabledef.data[i][j] = tabledef.data[i][j];\n        }\n      }\n    }\n    this.datas = tabledef.data;\n    tabledef.columns = columns;\n    tabledef.headings = headings;\n    let formatters = {\n      controls: (value, td, rowIndex, cellIndex) => {\n        const column = Object.values(this.columns)[cellIndex];\n        const id = this.getCellData(rowIndex, column.field);\n        const actions = (column.actions) ? column.actions : null;\n        if (!actions) return ``;\n        let controls = [];\n        Object.entries(actions).forEach(([key, action]) => {\n          controls.push({\n            nodeName: \"A\",\n            attributes: {\n              class: `btn is-${key} `,\n              href: `${action.link}/${id}`\n            },\n            childNodes: [this.setTextNode(action.label)]\n          });\n\n        });\n        if (!td.hasOwnProperty('attributes')) td.attributes = {};\n        td.attributes.class = _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.component.table.controls;\n        td.childNodes = controls;\n\n      },\n      select: (value, td, rowIndex, cellIndex) => {\n        const column = Object.values(this.columns)[cellIndex];\n        value = (isNaN(value)) ? this.getCellData(rowIndex, column.field) : value;\n\n        td.childNodes = [{\n          nodeName: \"INPUT\",\n          attributes: {\n            type: \"radio\",\n            name: `${this.instanceid}select`,\n            value: String(value)\n          }\n        }];\n\n      },\n      selectmultiple: (value, td, rowIndex, cellIndex) => {\n        const column = Object.values(this.columns)[cellIndex];\n        value = (isNaN(value)) ? ((column.hasOwnProperty('field')) ? this.getCellData(rowIndex, column.field) : value) : value;\n        td.childNodes = [{\n          nodeName: \"INPUT\",\n          attributes: {\n            type: \"checkbox\",\n            name: `${this.instanceid}select[]`,\n            value: String(value)\n          }\n        }];\n\n      },\n      decimal: (value, td, rowIndex, cellIndex) => {\n        if (isNaN(value)) value = 0;\n        value = parseFloat(value).toFixed(2);\n        if (value - parseInt(value) === 0) value = parseInt(value);\n\n        if (!td.hasOwnProperty('attributes')) td.attributes = {};\n        td.attributes.class = _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.number;\n        td.childNodes[0].data = value;\n      },\n      number: (value, td, rowIndex, cellIndex) => {\n        if (isNaN(value)) value = 0;\n        if (!td.hasOwnProperty('attributes')) td.attributes = {};\n        td.attributes.class = _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.number;\n        td.childNodes[0].data = value;\n      },\n      check: (value, td, rowIndex, cellIndex) => {\n\n        if (isNaN(value)) value = ``;\n        switch (value) {\n          case true:\n          case 'Y':\n          case 1:\n            value = \"\";\n            break;\n          default:\n            value = \"no-\";\n            break;\n        }\n        const icon = {\n          nodeName: \"I\",\n          attributes: {\n            class: `icon-sm  icon-${value}check `\n          },\n          childNodes: []\n        }\n        const column = Object.values(this.columns)[cellIndex];\n        const id = this.getCellData(rowIndex, column.field);\n        if (column.hasOwnProperty(\"toggle\")) td.childNodes = [{\n          nodeName: \"A\",\n          attributes: {\n            \"data-request\": \"toggle\",\n            \"data-action\": `${column.toggle.link}/${id}`,\n            \"href\": \"javascript:void()\"\n\n          },\n          childNodes: [icon]\n\n        }]\n        else td.childNodes = [icon];\n      },\n      text: (value, td, rowIndex, cellIndex) => {\n        if (value === null) td.childNodes = [];\n        else {\n          value = value.replaceAll('\\r\\n', ', ');\n          if (value !== ``) td.childNodes = [{\n            nodeName: \"DIV\",\n            attributes: {\n              class: _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.component.table.tip\n            },\n            childNodes: [this.setTextNode(value)]\n          }];\n          else td.childNodes = [];\n        }\n\n      },\n      default: (value, td, rowIndex, cellIndex) => {\n        if (value === null || value === ``) td.childNodes = [];\n        else td.childNodes = [this.setTextNode(value)];\n      }\n\n    }\n    let tablecustom = null;\n\n    switch (this.params.from) {\n      case 'prjlist':\n        tablecustom = await __webpack_require__.e(/*! import() */ \"src_modules_table-project_js\").then(__webpack_require__.bind(__webpack_require__, /*! ../modules/table-project.js */ \"./src/modules/table-project.js\"));\n        this.cellid = _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.models.projid;\n        break;\n      case 'prjsamplestats':\n        tablecustom = await __webpack_require__.e(/*! import() */ \"src_modules_table-sample_js\").then(__webpack_require__.bind(__webpack_require__, /*! ../modules/table-sample.js */ \"./src/modules/table-sample.js\"));\n        this.cellid = _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.models.sampleid;\n        break;\n      default:\n        this.cellid = 'id';\n        break;\n    }\n\n    formatters = (tablecustom) ? { ...formatters,\n      ...tablecustom.default(this)\n    } : formatters;\n    Object.entries(this.columns).forEach(([field, column], index) => {\n      if (!column.hasOwnProperty('hidden')) {\n        const select = (column.select && column.select == _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.models.controls) ? _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.models.controls : ((column.selectcells) ? _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.models.imports : column.select)\n        const format = (column.format) ? column.format : ((column.subfield) ? column.subfield : ((select) ? select : \"default\"));\n        if (formatters && formatters[format]) tabledef.columns[index].render = formatters[format];\n      }\n    });\n    return tabledef;\n  }\n\n  convertColumns() {\n    const map_column = (key, column, index) => {\n      if (!column) return {\n        select: index,\n        name: key,\n\n        hidden: true\n      };\n      const col = {\n        select: index,\n        name: this.labelFormatter(key, column),\n      };\n      if (column.notsortable) col.sortable = false;\n      if (!column.notsearchable) col.searchable = true;\n      if (column.hidden) col.hidden = Boolean(column.hidden);\n      if (column.sort && column.sort === \"desc\") column.sortSequence = [\"desc\", \"asc\"];\n      if (['number', 'decimal'].find(format => format === column.format)) col.type = 'number';\n      let render = null;\n      switch (key) {\n        case 'select':\n          const select = (column.select && column.select == \"controls\") ? \"controls\" : ((column.selectcells) ? \"imports\" : column.select)\n          if (select) {\n            this.importfields = (column.selectcells) ? column.selectcells : null;\n            col.sortable = false;\n            col.searchable = false;\n          }\n          break;\n      }\n      return col;\n    }\n    return Object.entries(this.columns).map(([key, column], index) => map_column(key, column, index));\n\n  }\n  initEvents() {\n    this.grid.on('datatable.update', () => {\n      if (this.dom.classList.contains('hide')) this.dom.classList.remove('hide');\n\n    });\n  }\n  initPlugins(container) {\n    if (this.params.import && this.initImport) this.initImport();\n    if (this.params.expand) this.makeExpandable(container);\n    if (this.params.export) this.makeExportable(container);\n    if (this.params.details || this.grid.dom.querySelector(tableselectors.details)) this.initDetails();\n    else this.initEvents();\n    if (this.params.onselect) this.initSelect(container);\n    if (this.grid.dom.querySelector(tableselectors.tip)) this.initTips();\n    if (this.grid.dom.querySelectorAll('thead [data-altsort]').length) this.initAlternateSort(this.grid.dom.querySelectorAll('thead [data-altsort]'));\n    if (this.params.filters) {\n      const top = this.grid.wrapperDOM.querySelector(tableselectors.datatable_top);\n      if (top && top.children.length) {\n        const filters = document.querySelector(tableselectors.table_filters);\n        // insert  filters node  in datatable top\n        if (filters) top.prepend(filters);\n      }\n    }\n  }\n  initSelect(container) {\n    const inputs = this.grid.dom.querySelectorAll('input[name^=\"' + this.instanceid + '\"]');\n    if (inputs.length === 0) return;\n    const inputname = inputs[0].name;\n    let selectaction = container.querySelector('.' + tablecss.selectaction);\n    if (!selectaction) return;\n    document.body.append(selectaction);\n    selectaction.querySelector('a').addEventListener('click', (e) => {\n      let vals = [];\n      inputs.forEach(input => {\n        if (input.checked) vals.push(input.value);\n      });\n      e.currentTarget.href = this.params.onselect + encodeURI(vals.join(','));\n    });\n    const close = selectaction.querySelector('[data-dismiss]');\n    if (close) close.addEventListener('click', (e) => {\n      e.preventDefault();\n      e.stopImmediatePropagation();\n      popup_selected(null, null);\n    });\n\n    const popup_selected = (top = null, left = null, forceclose = false) => {\n      if (selectaction.dataset.close) {\n        document.body.append(selectaction);\n        close.classList.remove('hidden');\n        selectaction.classList.add(tablecss.absinput);\n      }\n      if (top !== null && left !== null) {\n        selectaction.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.hide);\n        selectaction.style.top = top + 'px';\n        selectaction.style.left = left + 'px';\n\n      } else {\n        if (forceclose === true) {\n          selectaction.classList.add(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.hide);\n          delete selectaction.dataset.close;\n        } else {\n          selectaction.dataset.close = true;\n          close.classList.add('hidden');\n          const toptable = this.grid.wrapperDOM.querySelector(tableselectors.datatable_top) ? this.grid.wrapperDOM.querySelector(tableselectors.datatable_top) : this.grid.wrapperDOM;\n          toptable.prepend(selectaction);\n          selectaction.classList.remove(tablecss.absinput);\n\n        }\n      }\n    }\n    inputs.forEach(input => {\n      input.addEventListener('change', (e) => {\n        if (input.checked) popup_selected(input.offsetTop, input.offsetLeft);\n        else {\n          if (this.grid.dom.querySelectorAll('input[name^=\"' + this.instanceid + '\"]:checked').length === 0) popup_selected(null, null, true);\n        }\n      });\n    });\n  }\n  async initDetails() { // TODO : generic\n    // about - one div to display cell details make it appear as table row expanding\n    const wrapper = this.grid.wrapperDOM;\n\n    const about = wrapper.querySelector('#' + tablecss.tipinline) ? wrapper.querySelector('#' + tablecss.tipinline) : tablecss.tipinline;\n    if (!dynamics.JsDetail) {\n      const {\n        JsDetail\n      } = await\n      __webpack_require__.e(/*! import() */ \"src_modules_js-detail_js\").then(__webpack_require__.bind(__webpack_require__, /*! ../modules/js-detail.js */ \"./src/modules/js-detail.js\"));\n      dynamics.JsDetail = JsDetail;\n    }\n    const jsDetail = new dynamics.JsDetail(about, wrapper, {\n      waitdiv: this.waitdiv\n    }); // specific to about details in table\n    // hide / show disable details zone\n    const callbackclose = (el, callback = null) => {\n      jsDetail.activeDetail(false);\n      if (callback) callback();\n    }\n\n    const callbackopen = (el, callback = null) => {\n      jsDetail.activeDetail(true);\n      if (jsDetail.current && jsDetail.current === el) {\n        jsDetail.expandDetail(el);\n        if (callback) callback();\n      } else {\n        if (jsDetail.current) jsDetail.current.querySelector('summary').click();\n        const url = this.params.detailsurl + el.dataset.id + '?' +\n          new URLSearchParams({\n            partial: true\n          });\n        jsDetail.activeDetail(true);\n        // append to cell details and display\n\n        fetch(url, (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_4__.fetchSettings)()).then(response => response.text()).then(html => {\n          jsDetail.expandDetail(el, html);\n          if (callback) callback();\n        }).catch(err => {\n          console.log('request', err);\n        })\n      }\n\n    }\n    if (!dynamics.JsAccordion) {\n      const {\n        JsAccordion\n      } = await __webpack_require__.e(/*! import() */ \"src_modules_js-accordion_js\").then(__webpack_require__.bind(__webpack_require__, /*! ../modules/js-accordion.js */ \"./src/modules/js-accordion.js\"));\n      dynamics.JsAccordion = JsAccordion;\n    }\n\n    const refresh_details = () => {\n      if (this.grid.dom.classList.contains(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.hide)) this.grid.dom.classList.remove(_modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.hide);\n      const details = this.grid.dom.querySelectorAll(tableselectors.details);\n      if (!details) return;\n      details.forEach(item => {\n        if (!item.dataset.id) return;\n\n        item = new dynamics.JsAccordion(item, callbackopen, callbackclose, jsDetail.detail);\n      });\n    }\n\n    // remove details when sorting\n    this.grid.on('datatable.sort', function(column, direction) {\n      jsDetail.activeDetail(false);\n    });\n    let timesearch = false;\n    this.grid.on('datatable.search', (query, matched) => {\n      if (!this.grid.dom.dataset.issearching) {\n        jsDetail.activeDetail(false);\n        this.grid.dom.dataset.issearching = true\n      }\n      // trouble when match is empty and returning to full table - remove hide ( in refresh_details)\n\n      /*  if (this.grid.dom.classList.contains('datatable-empty') && matched === []) {\n          thid.grid.dom.querySelector('.datatable-search > input').addEventListener('click', (e) => {\n            this.update();\n            this.grid.wrapperDOM.classList.remove(\"search-results\");\n            this.grid.dom.classList.remove('hide');\n            return false;\n          }, {\n            once: true\n          });\n        }*/\n    });\n    this.grid.on('datatable.update', () => {\n      if (timesearch === false) {\n        timesearch = true;\n        setTimeout(() => {\n          refresh_details();\n          delete this.grid.dom.dataset.issearching;\n          timesearch = false;\n        }, 300);\n      }\n    });\n    refresh_details();\n  }\n\n  initAlternateSort(cols) {\n    const columns = this.grid.data.headings;\n    let coltosort;\n    const sortalternate = (col) => {\n      let todir;\n      // keep the same dir if sort on col changes\n      if (col.dataset.sortactive === String(coltosort)) {\n        todir = (col.classList.contains(tablecss.ascending)) ? tablecss.descending : tablecss.ascending;\n      } else todir = (col.classList.contains(tablecss.descending)) ? tablecss.descending : tablecss.ascending;\n      columns.sort(coltosort, todir);\n      this.grid.on('datatable.sort', (column, direction) => {\n        if (coltosort !== col.cellIndex) {\n          col.classList.remove(tablecss.ascending);\n          col.classList.remove(tablecss.descending);\n          this.grid.headings[coltosort].classList.remove(direction);\n          col.classList.add(direction);\n        }\n        col.dataset.sortactive = coltosort;\n      });\n\n    }\n    cols.forEach(col => {\n      const altsort = (col.dataset.altsort) ? col.dataset.altsort.split(',') : null;\n      if (!altsort) return;\n      col.querySelector(tablecss.datatable_sorter).classList.add(tablecss.disabled);\n      const control = col.querySelector(tableselectors.sorton);\n      // prevents imbricated links\n      col.append(control);\n      const triggers = col.querySelectorAll('[role=\"button\"]');\n      coltosort = col.cellIndex;\n      col.addEventListener('click', (e) => {\n        sortalternate(col);\n      }, false);\n      const changecoltosort = (col, index) => {\n        if (index === 0) coltosort = col.cellIndex;\n        else coltosort = this.grid.headings.findIndex(heading => (heading.dataset.name === altsort[index - 1]));\n      }\n      col.dataset.sortactive = col.cellIndex;\n      triggers.forEach((trigger, index) => {\n        trigger.addEventListener('click', (e) => {\n          e.preventDefault();\n          const active = e.currentTarget.parentElement.querySelector('.active');\n          if (active) active.classList.remove('active');\n          e.currentTarget.classList.add('active');\n          changecoltosort(col, index);\n        });\n      });\n      if (col.dataset.tip) {\n\n        Object.values(this.grid.dom.rows).forEach((row, index) => {\n          if (index === 0) return;\n          const coltip = this.grid.headings.findIndex(heading => (heading.dataset.name === altsort[parseInt(col.dataset.tip) - 1]));\n          if (coltip === col.cellIndex) return;\n\n          row.cells[col.cellIndex].addEventListener('mouseenter', (e) => {\n            const tip = document.createElement('div');\n            tip.setAttribute('class', tablecss.tipover);\n            tip.innerHTML = row.cells[coltip].innerHTML;\n            e.currentTarget.append(tip);\n          });\n          row.cells[col.cellIndex].addEventListener('mouseout', (e) => {\n            const tip = e.currentTarget.querySelector(tableselectors.tipover);\n            if (tip) tip.remove();\n          });\n        });\n      }\n    });\n\n  }\n\n\n  closeShowfull() {\n    const showfull = document.querySelector('.' + _modules_modules_config_js__WEBPACK_IMPORTED_MODULE_5__.css.component.table.tip + '.' + tablecss.showfull);\n    if (showfull) showfull.click();\n  }\n  makeExpandable(container) {\n    if (container.querySelector('table').offsetHeight < container.offsetHeight + container.querySelector('table tbody tr').offsetHeight) return;\n    const btn = document.createElement('div');\n    btn.classList.add('button-expand');\n    btn.classList.add('border-t');\n    btn.title = this.params.expand;\n    btn.innerHTML = `<span class=\"small-caps block mx-auto p-0\">${this.params.expand}</span><i class=\"clear-both p-0 mx-auto icon icon-chevron-down hover:fill-secondblue-500\"></i><span class=\"small-caps block mx-auto p-0 hidden\">${\n                  this.params.shrink}</span>`;\n    container.parentElement.insertBefore(btn, container.nextElementSibling);\n    container.classList.add('overflow-y-hidden');\n    container.classList.remove('max-tabstat-h');\n    container.parentElement.style.height = 'auto';\n    const h = parseInt(this.grid.wrapperDOM.querySelector('tbody tr').offsetHeight) * ((this.params.maxrows) ? this.params.maxrows : 20);\n    container.classList.add('max-h-[' + h + 'px]');\n    container.style.height = h + 'px';\n    btn.addEventListener('click', (e) => {\n      this.closeShowfull();\n      btn.classList.toggle('border-t');\n      btn.classList.toggle('border-b');\n      const ico = btn.querySelector('i');\n      ico.classList.toggle('icon-chevron-down');\n      ico.classList.toggle('icon-chevron-up');\n      container.classList.toggle('overflow-y-hidden');\n      container.classList.toggle('max-h-[' + h + 'px]');\n      btn.querySelectorAll('span').forEach(span => {\n        span.classList.toggle('hidden');\n      });\n      if (container.classList.contains('overflow-y-hidden')) container.style.height = h + 'px';\n      else container.style.height = 'auto';\n    });\n  }\n  makeExportable(container) {\n    const btn = document.createElement('div');\n    btn.classList.add('button-export');\n    btn.classList.add('is-pick');\n    btn.innerHTML = `<i class=\"icon icon-arrow-down-on-square\"></i><span>${((this.params.exportlabel) ? this.params.exportlabel : 'export to ' + this.params.export)}</span>`;\n    container.prepend(btn);\n    const columns = this.grid.columns;\n    let exclude_columns = [];\n    Object.keys(this.columns).forEach((name, index) => {\n      if (name === 'select') exclude_columns.push(index);\n    });\n    btn.addEventListener('click', async (e) => {\n      e.preventDefault();\n      if (exclude_columns.length) columns.hide(exclude_columns);\n      if (!this.dynamics) this.dynamics = {};\n      if (!this.dynamics.exportCSV) {\n        const {\n          exportCSV // or exportJSON, exportSQL\n        } = await\n        Promise.resolve(/*! import() */).then(__webpack_require__.bind(__webpack_require__, /*! simple-datatables */ \"./node_modules/simple-datatables/dist/module.js\"));\n\n        this.dynamics.exportCSV = exportCSV;\n      }\n      let str = this.dynamics.exportCSV(this.grid, {\n        download: false,\n        lineDelimiter: \"\\n\",\n        columnDelimiter: \"\\t\",\n      });\n      str = encodeURI(`data:text/tsv;charset=utf-8,${str}`);\n\n      (0,_modules_utils_js__WEBPACK_IMPORTED_MODULE_4__.download_url)(str, ((container.id) ? container.id : 'stats_proj') + '.tsv');\n      if (exclude_columns.length) columns.show(exclude_columns);\n    });\n  }\n  initTips() {\n    // show big cell content\n    let current = null;\n    this.grid.dom.querySelectorAll(tableselectors.tip).forEach(tip => {\n      tip.addEventListener('mouseenter', (e) => {\n        if (tip.classList.contains(tablecss.showfull) || (tip.scrollHeight > tip.offsetHeight)) {\n          tip.style.cursor = 'pointer';\n        }\n      });\n      tip.addEventListener('click', (e) => {\n        const styleparent = window.getComputedStyle(tip.parentElement);\n        const style = window.getComputedStyle(tip.parentElement);\n        if (tip.classList.contains(tablecss.showfull)) {\n          tip.classList.remove(tablecss.showfull);\n          tip.parentElement.style.minHeight = 'none';\n          tip.parentElement.style.height = 'auto';\n          tip.style.maxWidth = tip.dataset.w + 'px';\n          tip.style.padding = tip.dataset.p + 'px';\n          current = null;\n        } else if (tip.scrollHeight > tip.offsetHeight) {\n          if (current) current.classList.remove(tablecss.showfull);\n          const h = parseInt(tip.clientHeight);\n          tip.parentElement.style.minHeight = tip.parentElement.style.height = (((h < parseInt(styleparent.maxHeight)) ? h : parseInt(styleparent.maxHeight)) - 2 * parseInt(styleparent.padding)) + 'px';\n          if (!tip.dataset.w) tip.dataset.w = parseInt(tip.clientWidth);\n          if (!tip.dataset.p) tip.dataset.p = parseInt(style.padding);\n          tip.style.maxWidth = parseInt(tip.clientWidth) + 'px';\n          tip.classList.add(tablecss.showfull);\n          tip.style.top = (parseInt(tip.offsetTop) - parseInt(styleparent.padding)) + 'px';\n          current = tip;\n\n        }\n\n      });\n    });\n  }\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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O0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9tb2R1bGVzL3RhYmxlLWNvbXBvbmVudC5qcz81ZWUxIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBET01QdXJpZnkgZnJvbSAnZG9tcHVyaWZ5JztcbmltcG9ydCB7XG4gIERhdGFUYWJsZVxufSBmcm9tIFwic2ltcGxlLWRhdGF0YWJsZXNcIjtcbmltcG9ydCBlcXVhbCBmcm9tICdkZWVwLWVxdWFsJztcbmltcG9ydCB7XG4gIG5vZGVUb09ialxufSBmcm9tIFwiZGlmZi1kb21cIjtcbmltcG9ydCB7XG4gIGZldGNoU2V0dGluZ3MsXG4gIGRvd25sb2FkX3VybFxufSBmcm9tICcuLi9tb2R1bGVzL3V0aWxzLmpzJztcbmltcG9ydCB7XG4gIGNzcyxcbiAgbW9kZWxzLFxuICBkb21zZWxlY3RvcnNcbn0gZnJvbSAnLi4vbW9kdWxlcy9tb2R1bGVzLWNvbmZpZy5qcyc7XG5sZXQgaW5zdGFuY2UgPSBbXTtcbi8vIHZhbGlkIGZldGNoIHVybHBhcnRzXG5jb25zdCBmZXRjaGZyb21zID0ge1xuICBwcmpsaXN0OiAnL2d1aS9wcmpsaXN0LycsXG4gIHByanNhbXBsZXN0YXRzOiAnL2d1aS9wcmpzYW1wbGVzdGF0cycsXG4gIHVzZXJzbGlzdDogJy9ndWkvYWRtaW4vdXNlcnNsaXN0J1xufTtcbi8vIHNwZWNpZmMgY3NzXG5jb25zdCB0YWJsZWNzcyA9IHtcbiAgc2hvd2Z1bGw6ICdzaG93ZnVsbCcsXG4gIHRpcGlubGluZTogXCJ0aXAtaW5saW5lXCIsXG4gIHNlYXJjaHJlc3VsdHM6IFwic2VhcmNoLXJlc3VsdHNcIixcbiAgc2VsZWN0YWN0aW9uOiBcInNlbGVjdGFjdGlvblwiLFxuICBhYnNpbnB1dDogJ2Fic2lucHV0JyxcbiAgZGlzYWJsZWQ6ICdkYXRhdGFibGUtZGlzYWJsZWQnLFxuICBhc2NlbmRpbmc6ICdkYXRhYmxlLWFzY2VuZGluZycsXG4gIGRlc2NlbmRpbmc6ICdkYXRhdGFibGUtZGVzY2VuZGluZycsXG4gIHRpcG92ZXI6ICd0aXBvdmVyIGFic29sdXRlIHotMTAgdGV4dC1zdG9uZS01MCByb3VuZGVkIGJnLXN0b25lLTYwMCBweC0yIHB5LTAuNSAtbXQtNSBtbC0xMiAnXG59O1xuY29uc3QgdGFibGVzZWxlY3RvcnMgPSB7XG4gIGRhdGF0YWJsZTogJy5kYXRhdGFibGUtdGFibGUnLFxuICBkYXRhdGFibGVfd3JhcHBlcjogJy5kYXRhdGFibGUtd3JhcHBlcicsXG4gIGRhdGF0YWJsZV90b3A6ICcuZGF0YXRhYmxlLXRvcCcsXG4gIGRhdGF0YWJsZV9zZWFyY2g6ICcuZGF0YXRhYmxlLWlucHV0JyxcbiAgdGFibGVfZmlsdGVyczogJ3RhYmxlLWZpbHRlcnMnLFxuICBkYXRhdGFibGVfc29ydGVyOiAnLmRhdGF0YWJsZS1zb3J0ZXInLFxuICBkZXRhaWxzOiAnZGV0YWlsc1tkYXRhLXdoYXQ9XCJhYm91dFwiXScsXG4gIHRpcDogJy4nICsgY3NzLmNvbXBvbmVudC50YWJsZS50aXAsXG4gIHRpcG92ZXI6ICcudGlwb3ZlcicsXG4gIHdhaXQ6ICd3YWl0LXBsZWFzZScsXG4gIHNvcnRvbjogJy5zb3J0b24nLFxufTtcblxuT2JqZWN0LmZyZWV6ZSh0YWJsZWNzcyk7XG5PYmplY3QuZnJlZXplKHRhYmxlc2VsZWN0b3JzKTtcbmNvbnN0IGR5bmFtaWNzID0ge307XG5leHBvcnQgY2xhc3MgVGFibGVDb21wb25lbnQge1xuICBpbnN0YW5jZWlkID0gbnVsbDtcbiAgY29sdW1ucyA9IHt9O1xuICBoZWFkaW5ncyA9IFtdO1xuICBkYXRhcyA9IFtdO1xuICBncmlkID0gbnVsbDtcbiAgcGFyYW1zID0gbnVsbDtcbiAgaW1wb3J0ZmllbGRzID0gbnVsbDtcblxuICBjb25zdHJ1Y3Rvcihjb250YWluZXIsIG9wdGlvbnMgPSB7fSkge1xuICAgIGlmICghY29udGFpbmVyKSByZXR1cm47XG4gICAgY29udGFpbmVyID0gY29udGFpbmVyIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQgPyBjb250YWluZXIgOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lcik7XG4gICAgaWYgKCFjb250YWluZXIpIHJldHVybjtcbiAgICAvL2NhbiBzZWxlY3QgbXVsdGlwbGVzIHRhYmxlcyBpbiBvbmUgcGFnZSAgb3IgbG9hZCBkYXRhIGluIHRoZSBzYW1lIHRhYmxlXG4gICAgdGhpcy5pbnN0YW5jZWlkID0gKGNvbnRhaW5lci5kYXRhc2V0Lmluc3RhbmNlaWQpID8gY29udGFpbmVyLmRhdGFzZXQuaW5zdGFuY2VpZCA6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ3RhYmxlJykubGVuZ3RoO1xuICAgIGlmICghaW5zdGFuY2VbdGhpcy5pbnN0YW5jZWlkXSB8fCAhZXF1YWwoY29udGFpbmVyLmRhdGFzZXQsIGluc3RhbmNlW3RoaXMuaW5zdGFuY2VpZF0ucGFyYW1zKSkge1xuICAgICAgdGhpcy5pbml0KGNvbnRhaW5lcik7XG4gICAgfSBlbHNlIHRoaXMucmVmcmVzaCgpO1xuICAgIHJldHVybiBpbnN0YW5jZVt0aGlzLmluc3RhbmNlaWRdO1xuXG4gIH1cbiAgaW5pdChjb250YWluZXIpIHtcbiAgICB0aGlzLnBhcmFtcyA9IGNvbnRhaW5lci5kYXRhc2V0O1xuICAgIC8vIG9ubHkgdmFsaWQgZnJvbSB2YWx1ZXMgLSBmZXRjaGZyb21zXG4gICAgdGhpcy5wYXJhbXMuZnJvbSA9ICh0aGlzLnBhcmFtcy5mcm9tKSA/IERPTVB1cmlmeS5zYW5pdGl6ZSh0aGlzLnBhcmFtcy5mcm9tKSA6IG51bGw7XG4gICAgY29uc3QgZnJvbSA9ICh0aGlzLnBhcmFtcy5mcm9tKSA/ICgoT2JqZWN0LmtleXMoZmV0Y2hmcm9tcykuaW5kZXhPZih0aGlzLnBhcmFtcy5mcm9tKSA+PSAwKSA/IHdpbmRvdy5sb2NhdGlvbi5ocmVmLnNwbGl0KCcvZ3VpLycpWzBdICsgZmV0Y2hmcm9tc1t0aGlzLnBhcmFtcy5mcm9tXSA6IG51bGwpIDogbnVsbDtcbiAgICBpZiAoZnJvbSkge1xuICAgICAgaWYgKHRoaXMucGFyYW1zLmRlZmVyKSB0aGlzLmRlZmVyTG9hZChjb250YWluZXIsIGZyb20pO1xuICAgICAgZWxzZSB0aGlzLmZldGNoRGF0YShjb250YWluZXIsIGZyb20pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnRhYmxlQWN0aXZhdGUoY29udGFpbmVyKS50aGVuKCgpID0+IHtcbiAgICAgICAgaW5zdGFuY2VbdGhpcy5pbnN0YW5jZWlkXSA9IHRoaXM7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICB3YWl0QWN0aXZhdGUoY29udGFpbmVyKSB7XG4gICAgbGV0IHdhaXRkaXYgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcignIycgKyB0YWJsZXNlbGVjdG9ycy53YWl0KTtcbiAgICBpZiAoIXdhaXRkaXYpIHtcbiAgICAgIHdhaXRkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgIHdhaXRkaXYuaWQgPSB0YWJsZXNlbGVjdG9ycy53YWl0O1xuICAgICAgY29udGFpbmVyLmFwcGVuZCh3YWl0ZGl2KTtcbiAgICB9XG4gICAgdGhpcy53YWl0ZGl2ID0gd2FpdGRpdjtcbiAgICB0aGlzLnRpbWVyID0gbmV3IERhdGUoKTtcbiAgfVxuXG4gIHdhaXREZXNhY3RpdmF0ZShtZXNzYWdlID0gbnVsbCwgdHlwZSA9ICdpbmZvJykge1xuICAgIGlmICghdGhpcy53YWl0ZGl2KSByZXR1cm47XG4gICAgaWYgKG1lc3NhZ2UpIHRoaXMud2FpdGRpdi5pbm5lckhUTUwgPSBgPGRpdiBjbGFzcz1cIiR7dHlwZX1cIj4ke21lc3NhZ2V9PC9kaXY+YDtcbiAgICBlbHNlIHRoaXMud2FpdGRpdi5jbGFzc0xpc3QuYWRkKGNzcy5oaWRlKTtcbiAgfVxuXG4gIGRlZmVyTG9hZChjb250YWluZXIsIGZyb20pIHtcbiAgICBjb25zdCBidG4gPSBjb250YWluZXIucXVlcnlTZWxlY3Rvcih0aGlzLnBhcmFtcy5kZWZlcik7XG4gICAgaWYgKCFidG4pIHJldHVybjtcblxuICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICB0aGlzLmZldGNoRGF0YShjb250YWluZXIsIGZyb20pO1xuICAgICAgYnRuLnJlbW92ZSgpO1xuICAgIH0pO1xuICB9XG4gIGZldGNoRGF0YShjb250YWluZXIsIGZyb211cmwsIHBhZ2VzdGFydCA9IDApIHtcbiAgICB0aGlzLndhaXRBY3RpdmF0ZShjb250YWluZXIpO1xuICAgIGNvbnN0IHBhZ2VzaXplID0gKHRoaXMucGFyYW1zLnBhZ2VzaXplKSA/IHRoaXMucGFyYW1zLnBhZ2VzaXplIDogMDtcblxuICAgIGxldCBmcm9tID0gKHRoaXMucGFyYW1zLmltcG9ydCkgPyBmcm9tdXJsICsgJz8nICsgbmV3IFVSTFNlYXJjaFBhcmFtcyh7XG4gICAgICB0eXBlaW1wb3J0OiBET01QdXJpZnkuc2FuaXRpemUodGhpcy5wYXJhbXMuaW1wb3J0KSxcbiAgICAgIHdpbmRvd19zdGFydDogcGFnZXN0YXJ0LFxuICAgICAgd2luZG93X3NpemU6IHBhZ2VzaXplLFxuICAgICAgZ3o6IHRydWUsXG4gICAgfSkgOiAoKHBhZ2VzaXplKSA/IGZyb211cmwgKyAnPycgKyBuZXcgVVJMU2VhcmNoUGFyYW1zKHtcbiAgICAgIHdpbmRvd19zdGFydDogcGFnZXN0YXJ0LFxuICAgICAgd2luZG93X3NpemU6IHBhZ2VzaXplLFxuICAgICAgbGlzdGFsbDogKCh0aGlzLnBhcmFtcy5saXN0YWxsKSA/IHRoaXMucGFyYW1zLmxpc3RhbGwgOiBmYWxzZSlcbiAgICB9KSA6IGZyb211cmwgKyAnPycgKyBuZXcgVVJMU2VhcmNoUGFyYW1zKHtcbiAgICAgIGxpc3RhbGw6ICgodGhpcy5wYXJhbXMubGlzdGFsbCkgPyB0aGlzLnBhcmFtcy5saXN0YWxsIDogZmFsc2UpXG4gICAgfSkpO1xuICAgIGlmICh0aGlzLnBhcmFtcy5mcm9taWQpIGZyb20gKz0gJy8nICsgdGhpcy5wYXJhbXMuZnJvbWlkO1xuICAgIGZldGNoKGZyb20sIGZldGNoU2V0dGluZ3MoKSkudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICBpZiAocmVzcG9uc2Uub2spIHJldHVybiByZXNwb25zZS5qc29uKCk7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QocmVzcG9uc2UpO1xuICAgIH0pLnRoZW4oYXN5bmMgdGFibGVkZWYgPT4ge1xuICAgICAgaWYgKHRoaXMud2FpdGRpdikgdGhpcy53YWl0ZGl2LmlubmVySFRNTCA9ICgodGhpcy53YWl0ZGl2LmRhdGFzZXQubG9hZGVkKSA/IERPTVB1cmlmeS5zYW5pdGl6ZSh0aGlzLndhaXRkaXYuZGF0YXNldC5sb2FkZWQpIDogZGVmYXVsdF9tZXNzYWdlcy5kYXRhbG9hZGVkKTtcbiAgICAgIGlmICh0YWJsZWRlZi5jb2x1bW5zKSB0aGlzLmNvbHVtbnMgPSB0YWJsZWRlZi5jb2x1bW5zO1xuICAgICAgZWxzZSBpZiAodGhpcy5wYXJhbXMuY29sdW1ucykge1xuICAgICAgICB0aGlzLmNvbHVtbnMgPSBKU09OLnBhcnNlKHRoaXMucGFyYW1zLmNvbHVtbnMpO1xuICAgICAgfVxuICAgICAgaWYgKHBhZ2VzdGFydCA9PT0gMCkge1xuICAgICAgICBjb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcignZGlzc21pc3N0YWJsZScsIChlKSA9PiB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ2Rlc3Ryb3kgdGFibGUnKTtcbiAgICAgICAgICB0aGlzLmRlc3Ryb3koKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMudGFibGVBY3RpdmF0ZShjb250YWluZXIsIHRhYmxlZGVmKS50aGVuKCgpID0+IHtcbiAgICAgICAgICBpbnN0YW5jZVt0aGlzLmluc3RhbmNlaWRdID0gdGhpcztcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIGRpc21pc3MgdGFibGUgd2hlbiBkaXNtaXNzIG1vZGFsXG5cblxuICAgICAgfSBlbHNlIGlmICh0YWJsZWRlZi5sZW5ndGgpIHRoaXMudGFibGVJbnNlcnRSb3dzKHRhYmxlZGVmKTtcbiAgICAgIGVsc2UgcGFnZXNpemUgPSAwO1xuICAgICAgaWYgKHBhZ2VzaXplID4gMCkgdGhpcy5mZXRjaERhdGEoY29udGFpbmVyLCBmcm9tdXJsLCBwYWdlc3RhcnQgKyBwYWdlc2l6ZSk7XG4gICAgfSkuY2F0Y2gocmVzcG9uc2UgPT4ge1xuICAgICAgcmV0dXJuIHRoaXMud2FpdERlc2FjdGl2YXRlKGBTdGF0dXMgJHtyZXNwb25zZS5zdGF0dXN9ICR7cmVzcG9uc2Uuc3RhdHVzVGV4dH1gLCAnZXJyb3InKTtcbiAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlLmpzb24oKSk7XG4gICAgfSk7XG5cbiAgfVxuXG4gIGFzeW5jIHRhYmxlQWN0aXZhdGUoY29udGFpbmVyLCB0YWJsZWRlZiA9IG51bGwpIHtcbiAgICBsZXQgdGFibGUgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcigndGFibGUnKTtcbiAgICBpZiAoIXRhYmxlKSB7XG4gICAgICB0YWJsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RhYmxlJyk7XG4gICAgICBjb250YWluZXIuYXBwZW5kKHRhYmxlKTtcbiAgICB9XG4gICAgdGFibGUuaWQgPSAndGFibGUtJyArIGNvbnRhaW5lci5pZDtcbiAgICBsZXQgb3B0aW9ucyA9IHtcbiAgICAgIHR5cGU6IFwibWFpblwiLFxuICAgICAgc2VhcmNoYWJsZTogKHRoaXMucGFyYW1zLnNlYXJjaGFibGUpID8gKHRoaXMucGFyYW1zLnNlYXJjaGFibGUgPT09ICd0cnVlJykgOiBmYWxzZSxcbiAgICAgIHNvcnRhYmxlOiAodGhpcy5wYXJhbXMuc29ydGFibGUpID8gKHRoaXMucGFyYW1zLnNvcnRhYmxlID09PSAndHJ1ZScpIDogZmFsc2UsXG4gICAgICBwYWdpbmF0ZTogKHRoaXMucGFyYW1zLnBhZ2luYXRlKSA/ICh0aGlzLnBhcmFtcy5wYWdpbmF0ZSA9PT0gJ3RydWUnKSA6IGZhbHNlLFxuICAgICAgZml4ZWRIZWlnaHQ6IGZhbHNlLFxuICAgICAgcGFnaW5nOiAodGhpcy5wYXJhbXMucGFnaW5nKSA/ICh0aGlzLnBhcmFtcy5wYWdpbmcgPT09ICd0cnVlJykgOiBmYWxzZSxcbiAgICAgIG5vUGFnaW5nOiB0cnVlLFxuICAgICAgcGVyUGFnZTogKHRoaXMucGFyYW1zLnBhZ2luZykgPyAoKHRoaXMucGFyYW1zLnBlcnBhZ2UpID8gKHRoaXMucGFyYW1zLnBlcnBhZ2UgPT09ICd0cnVlJykgOiAxMDApIDogMTAwMDAwMCxcbiAgICAgIHBlclBhZ2VTZWxlY3Q6ICh0aGlzLnBhcmFtcy5wYWdpbmcgPT09ICd0cnVlJykgPyBbMTAsIDUwLCAxMDAsIDUwMCwgMTAwMF0gOiBmYWxzZSxcbiAgICAgIHNjcm9sbFk6IFwiXCIsXG4gICAgICBmb290ZXI6ICh0aGlzLnBhcmFtcy5mb290ZXIpID8gKHRoaXMucGFyYW1zLmZvb3RlciA9PT0gJ3RydWUnKSA6ICgoY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJ3Rmb290JykpID8gdHJ1ZSA6IGZhbHNlKSxcbiAgICAgIGxhYmVsczogKHRoaXMucGFyYW1zLmxhYmVscykgPyB0aGlzLnBhcmFtcy5sYWJlbHMgOiB7XG4gICAgICAgIHBsYWNlaG9sZGVyOiBcIlNlYXJjaC4uLlwiLFxuICAgICAgICBwZXJQYWdlOiBcIntzZWxlY3R9IGVudHJpZXMgcGVyIHBhZ2VcIixcbiAgICAgICAgbm9Sb3dzOiBcIk5vIGVudHJpZXMgZm91bmRcIixcbiAgICAgICAgaW5mbzogXCJTaG93aW5nIHtzdGFydH0gdG8ge2VuZH0gb2Yge3Jvd3N9IGVudHJpZXNcIixcbiAgICAgICAgbm9SZXN1bHRzOiBcIk5vIHJlc3VsdCBtYXRjaCB5b3VyIHNlYXJjaCBxdWVyeVwiXG4gICAgICB9LFxuICAgIH07XG4gICAgaWYgKHRhYmxlZGVmKSB7XG4gICAgICB0YWJsZWRlZiA9IGF3YWl0IHRoaXMuY29udmVydERhdGFzKHRhYmxlZGVmKTtcbiAgICAgIGNvbnN0IGxhc3R1c2VkID0gKHRhYmxlZGVmLmxhc3R1c2VkKSA/IHRhYmxlZGVmLmxhc3R1c2VkIDogW107XG4gICAgICBjb25zdCBjZWxsaWRuYW1lID0gKCh0aGlzLnBhcmFtcy5oYXNPd25Qcm9wZXJ0eShcImNlbGxpZFwiKSkgPyB0aGlzLnBhcmFtcy5jZWxsaWQgOiAnaWQnKTtcblxuICAgICAgb3B0aW9ucyA9IHsgLi4ub3B0aW9ucyxcbiAgICAgICAgLi4ue1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIGhlYWRpbmdzOiB0YWJsZWRlZi5oZWFkaW5ncyxcbiAgICAgICAgICAgIGRhdGE6IHRhYmxlZGVmLmRhdGFcbiAgICAgICAgICB9LFxuICAgICAgICAgIGNvbHVtbnM6IHRhYmxlZGVmLmNvbHVtbnMsXG4gICAgICAgICAgcm93UmVuZGVyOiAocm93VmFsdWUsIHRyLCByb3dJbmRleCkgPT4ge1xuICAgICAgICAgICAgcm93VmFsdWUuZm9yRWFjaCh2YWx1ZSA9PiB7XG4gICAgICAgICAgICAgIHJldHVybiBET01QdXJpZnkuc2FuaXRpemUodmFsdWUpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIGNvbnN0IGlkID0gdGhpcy5nZXRDZWxsRGF0YShyb3dJbmRleCwgY2VsbGlkbmFtZSk7XG4gICAgICAgICAgICB0ci5hdHRyaWJ1dGVzID0gKHRyLmhhc093blByb3BlcnR5KCdhdHRyaWJ1dGVzJykpID8gdHIuYXR0cmlidXRlcyA6IHt9O1xuICAgICAgICAgICAgdHIuYXR0cmlidXRlc1snZGF0YS1pZCddID0gaWQ7XG4gICAgICAgICAgICBpZiAobGFzdHVzZWQuaW5kZXhPZihpZCkgPj0gMCkge1xuICAgICAgICAgICAgICB0ci5hdHRyaWJ1dGVzW1wiY2xhc3NcIl0gPSAodHIuYXR0cmlidXRlc1tcImNsYXNzXCJdKSA/IHRyLmF0dHJpYnV0ZXNbXCJjbGFzc1wiXSArIFwiIGxhc3QtdXNlZFwiIDogXCJsYXN0LXVzZWRcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IGZvb3RlciA9IHRhYmxlLnF1ZXJ5U2VsZWN0b3JBbGwoJ3Rmb290IHRoJyk7XG4gICAgICBpZiAoZm9vdGVyLmxlbmd0aCkgb3B0aW9ucy5mb290ZXIgPSB0cnVlO1xuICAgICAgb3B0aW9ucy5yb3dSZW5kZXIgPSBmdW5jdGlvbihyb3dWYWx1ZSwgdHIsIHJvd0luZGV4KSB7XG4gICAgICAgIHJvd1ZhbHVlLmZvckVhY2godmFsdWUgPT4ge1xuICAgICAgICAgIHJldHVybiBET01QdXJpZnkuc2FuaXRpemUodmFsdWUpO1xuICAgICAgICB9KVxuICAgICAgfVxuICAgICAgb3B0aW9ucy50YWJsZVJlbmRlciA9IGZ1bmN0aW9uKHRhYmxlVmFsdWUsIHRhYmxlKSB7XG4gICAgICAgIGNvbnN0IGwgPSB0YWJsZS5jaGlsZE5vZGVzLmxlbmd0aCAtIDE7XG4gICAgICAgIGlmICh0YWJsZS5jaGlsZE5vZGVzW2xdLm5vZGVOYW1lID09PSAnVEZPT1QnICYmIGZvb3Rlci5sZW5ndGgpIHtcbiAgICAgICAgICBjb25zdCBmb290ZXJjZWxscyA9IEFycmF5LmZyb20oZm9vdGVyKS5tYXAoY2VsbCA9PiB7XG4gICAgICAgICAgICByZXR1cm4gbm9kZVRvT2JqKGNlbGwpO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgdGFibGUuY2hpbGROb2Rlc1tsXS5jaGlsZE5vZGVzID0gW3tcbiAgICAgICAgICAgIG5vZGVOYW1lOiBcIlRSXCIsXG4gICAgICAgICAgICBjaGlsZG5vZGVzOiBmb290ZXJjZWxsc1xuICAgICAgICAgIH1dO1xuXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKiAgRGF0YVRhYmxlLmV4dGVuZCgnc2VhcmNoJywgKHF1ZXJ5KSA9PiB7XG4gICAgICB0aGlzLnNlYXJjaFRhYmxlKHF1ZXJ5KTtcbiAgICB9KTsqL1xuXG4gICAgdGhpcy5ncmlkID0gbmV3IERhdGFUYWJsZSh0YWJsZSwgb3B0aW9ucyk7XG5cbiAgICB0aGlzLmdyaWQub24oJ2RhdGF0YWJsZS5pbml0JywgKCkgPT4ge1xuICAgICAgLy8gaGlkZSBhbmQgbW92ZSB3YWl0ZGl2IGluIHRoZSB3cmFwcGVyIGZvciBpbm5lciBlbGVtZW50cyBkaXNwbGF5XG4gICAgICB0aGlzLndhaXREZXNhY3RpdmF0ZSgpO1xuICAgICAgLy8gbW92ZSBpbXBvcnQgem9uZXMgYW5kL29yIHNlYXJjaCB6b25lIC0gcmVvcmcgdGhlIHBhZ2UgZGlzcGxheVxuICAgICAgY29udGFpbmVyLnN0eWxlLnRvcCA9IGNvbnRhaW5lci5vZmZzZXRUb3AgKyAncHgnO1xuICAgICAgLy8gZmV0Y2ggb25jZSB0aGUgc2FtZSB0YWJsZVxuICAgICAgY29udGFpbmVyLmRhdGFzZXQudGFibGUgPSB0aGlzLnBhcmFtcy50YWJsZSA9IHRydWU7XG4gICAgICB0aGlzLmdyaWQuZG9tLmNsYXNzTGlzdC5yZW1vdmUoY3NzLmhpZGUpO1xuICAgICAgdGhpcy5kYXRhcyA9IG51bGw7XG4gICAgICBjb25zdCBzZWFyY2ggPSB0aGlzLmdyaWQud3JhcHBlckRPTS5xdWVyeVNlbGVjdG9yKHRhYmxlc2VsZWN0b3JzLmRhdGF0YWJsZV9zZWFyY2gpO1xuICAgICAgaWYgKHNlYXJjaCkge1xuICAgICAgICAvLyBzdHlsZSBsaWtlIGFueSBvdGhlciBmb3JtIGVsZW1lbnRcbiAgICAgICAgc2VhcmNoLmNsYXNzTGlzdC5hZGQoY3NzLmlucHV0KTtcbiAgICAgIH1cbiAgICAgIHRoaXMuaW5pdFBsdWdpbnMoY29udGFpbmVyKTtcblxuICAgIH0pO1xuXG5cbiAgfVxuICB0YWJsZUFwcGVuZFJvd3Mocm93cykge1xuICAgIGNvbnNvbGUubG9nKCdyb3dzJyk7XG4gIH1cbiAgZGVzdHJveSgpIHtcbiAgICBpZiAodGhpcy5kYXRhSW1wb3J0KSB0aGlzLmRhdGFJbXBvcnQgPSBudWxsO1xuICAgIHRoaXMuZ3JpZCA9IG51bGw7XG4gICAgZGVsZXRlIGluc3RhbmNlW3RoaXMuaW5zdGFuY2VpZF07XG4gIH1cbiAgcmVmcmVzaChlKSB7XG4gICAgaWYgKHRoaXMuZGF0YUltcG9ydCAmJiB0aGlzLmRhdGFJbXBvcnQuc2VsZWN0b3JzKSB0aGlzLmRhdGFJbXBvcnQuc2VsZWN0b3JzLmZvckVhY2goc2VsZWN0b3IgPT4ge1xuICAgICAgaWYgKHRoaXMuZGlzYWJsZWQpIHRoaXMuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICB9KTtcbiAgfVxuICBsYWJlbEZvcm1hdHRlcihmaWVsZCwgY29sdW1uKSB7XG4gICAgbGV0IGFsaWduID0gYGA7XG4gICAgaWYgKFsnbnVtYmVyJywgJ3Byb2dyZXNzJywgJ2RlY2ltYWwnXS5maW5kKGZvcm1hdCA9PiBmb3JtYXQgPT09IGNvbHVtbi5mb3JtYXQpKSBhbGlnbiA9IGNzcy5yaWdodDtcbiAgICBpZiAoY29sdW1uLnN1YmZpZWxkKSByZXR1cm4gYCR7Y29sdW1uLmxhYmVsfSA8c3BhbiBjbGFzcz1cInN1YmxhYmVsXCI+JHtjb2x1bW4uc3VibGFiZWx9PC9zcGFuPmA7XG4gICAgZWxzZSBpZiAoY29sdW1uLmxhYmVsKSByZXR1cm4gYDxzcGFuIGNsYXNzPVwiY29sLSR7ZmllbGR9ICR7YWxpZ259XCI+JHtjb2x1bW4ubGFiZWx9PC9zcGFuPmA7XG4gICAgZWxzZSByZXR1cm4gYGA7XG4gIH1cbiAgZ2V0Q2VsbElkKG5hbWUsIHN0YXRlID0gbnVsbCkge1xuICAgIHJldHVybiB0aGlzLmhlYWRpbmdzLmluZGV4T2YobmFtZSk7XG4gIH1cbiAgZ2V0Q2VsbERhdGEocm93SW5kZXgsIG5hbWUpIHtcbiAgICBjb25zdCBjZWxsSW5kZXggPSB0aGlzLmdldENlbGxJZChuYW1lKTtcbiAgICBpZiAoY2VsbEluZGV4IDwgMCkgcmV0dXJuIG51bGw7XG4gICAgcmV0dXJuICh0aGlzLmdyaWQpID8gKCh0aGlzLmdyaWQuZGF0YS5kYXRhW3Jvd0luZGV4XSkgPyB0aGlzLmdyaWQuZGF0YS5kYXRhW3Jvd0luZGV4XVtjZWxsSW5kZXhdLmRhdGEgOiBudWxsKSA6ICh0aGlzLmRhdGFzICYmIHRoaXMuZGF0YXNbcm93SW5kZXhdKSA/IHRoaXMuZGF0YXNbcm93SW5kZXhdW2NlbGxJbmRleF0gOiBudWxsO1xuICB9XG5cblxuICBzZXRUZXh0Tm9kZSh2YWx1ZSkge1xuICAgIHJldHVybiB7XG4gICAgICBub2RlTmFtZTogXCIjdGV4dFwiLFxuICAgICAgZGF0YTogdmFsdWVcbiAgICB9O1xuICB9XG5cbiAgYXN5bmMgY29udmVydERhdGFzKHRhYmxlZGVmKSB7XG5cbiAgICBjb25zdCBoZWFkaW5ncyA9IE9iamVjdC5lbnRyaWVzKHRoaXMuY29sdW1ucykubWFwKChba2V5LCBjb2x1bW5dLCBpbmRleCkgPT4ge1xuICAgICAgY29uc3QgaGVhZGluZyA9IHtcbiAgICAgICAgZGF0YToga2V5LFxuICAgICAgICB0ZXh0OiAoY29sdW1uLmxhYmVsKSA/IGNvbHVtbi5sYWJlbCA6IGBgLFxuICAgICAgICAvLyAgaHRtbDogdGhpcy5sYWJlbEZvcm1hdHRlcihrZXksIGNvbHVtbiksXG4gICAgICB9XG4gICAgICBpZiAoY29sdW1uLmhhc093blByb3BlcnR5KCdoaWRkZW4nKSkgaGVhZGluZ1snaGlkZGVuJ10gPSB0cnVlO1xuICAgICAgcmV0dXJuIGhlYWRpbmc7XG4gICAgfSk7XG4gICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKHRoaXMuY29sdW1ucyk7XG4gICAgdGhpcy5oZWFkaW5ncyA9IGtleXM7XG4gICAgY29uc3QgY29sdW1ucyA9IHRoaXMuY29udmVydENvbHVtbnMoKTtcbiAgICAvLyBjb252ZXJ0IGpzb24gcm93cyA9PiBzb3J0ZWQgYXJyYXkgYnkgY29sdW1uc1xuICAgIGlmICghdGFibGVkZWYuaGFzT3duUHJvcGVydHkoJ2RhdGEnKSB8fCAodGFibGVkZWYuaGFzT3duUHJvcGVydHkoJ3R5cGUnKSAmJiB0YWJsZWRlZi50eXBlID09PSBcImpzb25cIikpIHtcbiAgICAgIHRhYmxlZGVmID0gKCh0YWJsZWRlZi5oYXNPd25Qcm9wZXJ0eSgnZGF0YScpKSA/IHRhYmxlZGVmLmRhdGEgOiB0YWJsZWRlZikubWFwKChkYXRhKSA9PiB7XG4gICAgICAgIGxldCByb3cgPSBbXTtcbiAgICAgICAgbGV0IGhpZGRlbiA9IFtdO1xuICAgICAgICBrZXlzLmZvckVhY2goKGtleSwgaW5kZXgpID0+IHtcbiAgICAgICAgICBsZXQgciA9IHJvdztcbiAgICAgICAgICBpZiAoZGF0YS5oYXNPd25Qcm9wZXJ0eShrZXkpKSByLnB1c2goKGRhdGFba2V5XSA9PT0gTmFOKSA/IG51bGwgOiBkYXRhW2tleV0pO1xuICAgICAgICAgIGVsc2Ugci5wdXNoKG51bGwpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIFsuLi5yb3csIC4uLmhpZGRlbl07XG4gICAgICB9KTtcbiAgICAgIHRoaXMuZGF0YXMgPSB0YWJsZWRlZjtcbiAgICAgIHRhYmxlZGVmID0ge1xuICAgICAgICBkYXRhOiB0YWJsZWRlZlxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBsID0gdGFibGVkZWYuZGF0YS5sZW5ndGg7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGw7IGkrKykge1xuICAgICAgICBjb25zdCBsciA9IHRhYmxlZGVmLmRhdGFbaV0ubGVuZ3RoO1xuICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGxyOyBqKyspIHtcbiAgICAgICAgICB0YWJsZWRlZi5kYXRhW2ldW2pdID0gdGFibGVkZWYuZGF0YVtpXVtqXTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLmRhdGFzID0gdGFibGVkZWYuZGF0YTtcbiAgICB0YWJsZWRlZi5jb2x1bW5zID0gY29sdW1ucztcbiAgICB0YWJsZWRlZi5oZWFkaW5ncyA9IGhlYWRpbmdzO1xuICAgIGxldCBmb3JtYXR0ZXJzID0ge1xuICAgICAgY29udHJvbHM6ICh2YWx1ZSwgdGQsIHJvd0luZGV4LCBjZWxsSW5kZXgpID0+IHtcbiAgICAgICAgY29uc3QgY29sdW1uID0gT2JqZWN0LnZhbHVlcyh0aGlzLmNvbHVtbnMpW2NlbGxJbmRleF07XG4gICAgICAgIGNvbnN0IGlkID0gdGhpcy5nZXRDZWxsRGF0YShyb3dJbmRleCwgY29sdW1uLmZpZWxkKTtcbiAgICAgICAgY29uc3QgYWN0aW9ucyA9IChjb2x1bW4uYWN0aW9ucykgPyBjb2x1bW4uYWN0aW9ucyA6IG51bGw7XG4gICAgICAgIGlmICghYWN0aW9ucykgcmV0dXJuIGBgO1xuICAgICAgICBsZXQgY29udHJvbHMgPSBbXTtcbiAgICAgICAgT2JqZWN0LmVudHJpZXMoYWN0aW9ucykuZm9yRWFjaCgoW2tleSwgYWN0aW9uXSkgPT4ge1xuICAgICAgICAgIGNvbnRyb2xzLnB1c2goe1xuICAgICAgICAgICAgbm9kZU5hbWU6IFwiQVwiLFxuICAgICAgICAgICAgYXR0cmlidXRlczoge1xuICAgICAgICAgICAgICBjbGFzczogYGJ0biBpcy0ke2tleX0gYCxcbiAgICAgICAgICAgICAgaHJlZjogYCR7YWN0aW9uLmxpbmt9LyR7aWR9YFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNoaWxkTm9kZXM6IFt0aGlzLnNldFRleHROb2RlKGFjdGlvbi5sYWJlbCldXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgfSk7XG4gICAgICAgIGlmICghdGQuaGFzT3duUHJvcGVydHkoJ2F0dHJpYnV0ZXMnKSkgdGQuYXR0cmlidXRlcyA9IHt9O1xuICAgICAgICB0ZC5hdHRyaWJ1dGVzLmNsYXNzID0gY3NzLmNvbXBvbmVudC50YWJsZS5jb250cm9scztcbiAgICAgICAgdGQuY2hpbGROb2RlcyA9IGNvbnRyb2xzO1xuXG4gICAgICB9LFxuICAgICAgc2VsZWN0OiAodmFsdWUsIHRkLCByb3dJbmRleCwgY2VsbEluZGV4KSA9PiB7XG4gICAgICAgIGNvbnN0IGNvbHVtbiA9IE9iamVjdC52YWx1ZXModGhpcy5jb2x1bW5zKVtjZWxsSW5kZXhdO1xuICAgICAgICB2YWx1ZSA9IChpc05hTih2YWx1ZSkpID8gdGhpcy5nZXRDZWxsRGF0YShyb3dJbmRleCwgY29sdW1uLmZpZWxkKSA6IHZhbHVlO1xuXG4gICAgICAgIHRkLmNoaWxkTm9kZXMgPSBbe1xuICAgICAgICAgIG5vZGVOYW1lOiBcIklOUFVUXCIsXG4gICAgICAgICAgYXR0cmlidXRlczoge1xuICAgICAgICAgICAgdHlwZTogXCJyYWRpb1wiLFxuICAgICAgICAgICAgbmFtZTogYCR7dGhpcy5pbnN0YW5jZWlkfXNlbGVjdGAsXG4gICAgICAgICAgICB2YWx1ZTogU3RyaW5nKHZhbHVlKVxuICAgICAgICAgIH1cbiAgICAgICAgfV07XG5cbiAgICAgIH0sXG4gICAgICBzZWxlY3RtdWx0aXBsZTogKHZhbHVlLCB0ZCwgcm93SW5kZXgsIGNlbGxJbmRleCkgPT4ge1xuICAgICAgICBjb25zdCBjb2x1bW4gPSBPYmplY3QudmFsdWVzKHRoaXMuY29sdW1ucylbY2VsbEluZGV4XTtcbiAgICAgICAgdmFsdWUgPSAoaXNOYU4odmFsdWUpKSA/ICgoY29sdW1uLmhhc093blByb3BlcnR5KCdmaWVsZCcpKSA/IHRoaXMuZ2V0Q2VsbERhdGEocm93SW5kZXgsIGNvbHVtbi5maWVsZCkgOiB2YWx1ZSkgOiB2YWx1ZTtcbiAgICAgICAgdGQuY2hpbGROb2RlcyA9IFt7XG4gICAgICAgICAgbm9kZU5hbWU6IFwiSU5QVVRcIixcbiAgICAgICAgICBhdHRyaWJ1dGVzOiB7XG4gICAgICAgICAgICB0eXBlOiBcImNoZWNrYm94XCIsXG4gICAgICAgICAgICBuYW1lOiBgJHt0aGlzLmluc3RhbmNlaWR9c2VsZWN0W11gLFxuICAgICAgICAgICAgdmFsdWU6IFN0cmluZyh2YWx1ZSlcbiAgICAgICAgICB9XG4gICAgICAgIH1dO1xuXG4gICAgICB9LFxuICAgICAgZGVjaW1hbDogKHZhbHVlLCB0ZCwgcm93SW5kZXgsIGNlbGxJbmRleCkgPT4ge1xuICAgICAgICBpZiAoaXNOYU4odmFsdWUpKSB2YWx1ZSA9IDA7XG4gICAgICAgIHZhbHVlID0gcGFyc2VGbG9hdCh2YWx1ZSkudG9GaXhlZCgyKTtcbiAgICAgICAgaWYgKHZhbHVlIC0gcGFyc2VJbnQodmFsdWUpID09PSAwKSB2YWx1ZSA9IHBhcnNlSW50KHZhbHVlKTtcblxuICAgICAgICBpZiAoIXRkLmhhc093blByb3BlcnR5KCdhdHRyaWJ1dGVzJykpIHRkLmF0dHJpYnV0ZXMgPSB7fTtcbiAgICAgICAgdGQuYXR0cmlidXRlcy5jbGFzcyA9IGNzcy5udW1iZXI7XG4gICAgICAgIHRkLmNoaWxkTm9kZXNbMF0uZGF0YSA9IHZhbHVlO1xuICAgICAgfSxcbiAgICAgIG51bWJlcjogKHZhbHVlLCB0ZCwgcm93SW5kZXgsIGNlbGxJbmRleCkgPT4ge1xuICAgICAgICBpZiAoaXNOYU4odmFsdWUpKSB2YWx1ZSA9IDA7XG4gICAgICAgIGlmICghdGQuaGFzT3duUHJvcGVydHkoJ2F0dHJpYnV0ZXMnKSkgdGQuYXR0cmlidXRlcyA9IHt9O1xuICAgICAgICB0ZC5hdHRyaWJ1dGVzLmNsYXNzID0gY3NzLm51bWJlcjtcbiAgICAgICAgdGQuY2hpbGROb2Rlc1swXS5kYXRhID0gdmFsdWU7XG4gICAgICB9LFxuICAgICAgY2hlY2s6ICh2YWx1ZSwgdGQsIHJvd0luZGV4LCBjZWxsSW5kZXgpID0+IHtcblxuICAgICAgICBpZiAoaXNOYU4odmFsdWUpKSB2YWx1ZSA9IGBgO1xuICAgICAgICBzd2l0Y2ggKHZhbHVlKSB7XG4gICAgICAgICAgY2FzZSB0cnVlOlxuICAgICAgICAgIGNhc2UgJ1knOlxuICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgIHZhbHVlID0gXCJcIjtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICB2YWx1ZSA9IFwibm8tXCI7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBpY29uID0ge1xuICAgICAgICAgIG5vZGVOYW1lOiBcIklcIixcbiAgICAgICAgICBhdHRyaWJ1dGVzOiB7XG4gICAgICAgICAgICBjbGFzczogYGljb24tc20gIGljb24tJHt2YWx1ZX1jaGVjayBgXG4gICAgICAgICAgfSxcbiAgICAgICAgICBjaGlsZE5vZGVzOiBbXVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNvbHVtbiA9IE9iamVjdC52YWx1ZXModGhpcy5jb2x1bW5zKVtjZWxsSW5kZXhdO1xuICAgICAgICBjb25zdCBpZCA9IHRoaXMuZ2V0Q2VsbERhdGEocm93SW5kZXgsIGNvbHVtbi5maWVsZCk7XG4gICAgICAgIGlmIChjb2x1bW4uaGFzT3duUHJvcGVydHkoXCJ0b2dnbGVcIikpIHRkLmNoaWxkTm9kZXMgPSBbe1xuICAgICAgICAgIG5vZGVOYW1lOiBcIkFcIixcbiAgICAgICAgICBhdHRyaWJ1dGVzOiB7XG4gICAgICAgICAgICBcImRhdGEtcmVxdWVzdFwiOiBcInRvZ2dsZVwiLFxuICAgICAgICAgICAgXCJkYXRhLWFjdGlvblwiOiBgJHtjb2x1bW4udG9nZ2xlLmxpbmt9LyR7aWR9YCxcbiAgICAgICAgICAgIFwiaHJlZlwiOiBcImphdmFzY3JpcHQ6dm9pZCgpXCJcblxuICAgICAgICAgIH0sXG4gICAgICAgICAgY2hpbGROb2RlczogW2ljb25dXG5cbiAgICAgICAgfV1cbiAgICAgICAgZWxzZSB0ZC5jaGlsZE5vZGVzID0gW2ljb25dO1xuICAgICAgfSxcbiAgICAgIHRleHQ6ICh2YWx1ZSwgdGQsIHJvd0luZGV4LCBjZWxsSW5kZXgpID0+IHtcbiAgICAgICAgaWYgKHZhbHVlID09PSBudWxsKSB0ZC5jaGlsZE5vZGVzID0gW107XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIHZhbHVlID0gdmFsdWUucmVwbGFjZUFsbCgnXFxyXFxuJywgJywgJyk7XG4gICAgICAgICAgaWYgKHZhbHVlICE9PSBgYCkgdGQuY2hpbGROb2RlcyA9IFt7XG4gICAgICAgICAgICBub2RlTmFtZTogXCJESVZcIixcbiAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHtcbiAgICAgICAgICAgICAgY2xhc3M6IGNzcy5jb21wb25lbnQudGFibGUudGlwXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY2hpbGROb2RlczogW3RoaXMuc2V0VGV4dE5vZGUodmFsdWUpXVxuICAgICAgICAgIH1dO1xuICAgICAgICAgIGVsc2UgdGQuY2hpbGROb2RlcyA9IFtdO1xuICAgICAgICB9XG5cbiAgICAgIH0sXG4gICAgICBkZWZhdWx0OiAodmFsdWUsIHRkLCByb3dJbmRleCwgY2VsbEluZGV4KSA9PiB7XG4gICAgICAgIGlmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gYGApIHRkLmNoaWxkTm9kZXMgPSBbXTtcbiAgICAgICAgZWxzZSB0ZC5jaGlsZE5vZGVzID0gW3RoaXMuc2V0VGV4dE5vZGUodmFsdWUpXTtcbiAgICAgIH1cblxuICAgIH1cbiAgICBsZXQgdGFibGVjdXN0b20gPSBudWxsO1xuXG4gICAgc3dpdGNoICh0aGlzLnBhcmFtcy5mcm9tKSB7XG4gICAgICBjYXNlICdwcmpsaXN0JzpcbiAgICAgICAgdGFibGVjdXN0b20gPSBhd2FpdCBpbXBvcnQoJy4uL21vZHVsZXMvdGFibGUtcHJvamVjdC5qcycpO1xuICAgICAgICB0aGlzLmNlbGxpZCA9IG1vZGVscy5wcm9qaWQ7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAncHJqc2FtcGxlc3RhdHMnOlxuICAgICAgICB0YWJsZWN1c3RvbSA9IGF3YWl0IGltcG9ydCgnLi4vbW9kdWxlcy90YWJsZS1zYW1wbGUuanMnKTtcbiAgICAgICAgdGhpcy5jZWxsaWQgPSBtb2RlbHMuc2FtcGxlaWQ7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdGhpcy5jZWxsaWQgPSAnaWQnO1xuICAgICAgICBicmVhaztcbiAgICB9XG5cbiAgICBmb3JtYXR0ZXJzID0gKHRhYmxlY3VzdG9tKSA/IHsgLi4uZm9ybWF0dGVycyxcbiAgICAgIC4uLnRhYmxlY3VzdG9tLmRlZmF1bHQodGhpcylcbiAgICB9IDogZm9ybWF0dGVycztcbiAgICBPYmplY3QuZW50cmllcyh0aGlzLmNvbHVtbnMpLmZvckVhY2goKFtmaWVsZCwgY29sdW1uXSwgaW5kZXgpID0+IHtcbiAgICAgIGlmICghY29sdW1uLmhhc093blByb3BlcnR5KCdoaWRkZW4nKSkge1xuICAgICAgICBjb25zdCBzZWxlY3QgPSAoY29sdW1uLnNlbGVjdCAmJiBjb2x1bW4uc2VsZWN0ID09IG1vZGVscy5jb250cm9scykgPyBtb2RlbHMuY29udHJvbHMgOiAoKGNvbHVtbi5zZWxlY3RjZWxscykgPyBtb2RlbHMuaW1wb3J0cyA6IGNvbHVtbi5zZWxlY3QpXG4gICAgICAgIGNvbnN0IGZvcm1hdCA9IChjb2x1bW4uZm9ybWF0KSA/IGNvbHVtbi5mb3JtYXQgOiAoKGNvbHVtbi5zdWJmaWVsZCkgPyBjb2x1bW4uc3ViZmllbGQgOiAoKHNlbGVjdCkgPyBzZWxlY3QgOiBcImRlZmF1bHRcIikpO1xuICAgICAgICBpZiAoZm9ybWF0dGVycyAmJiBmb3JtYXR0ZXJzW2Zvcm1hdF0pIHRhYmxlZGVmLmNvbHVtbnNbaW5kZXhdLnJlbmRlciA9IGZvcm1hdHRlcnNbZm9ybWF0XTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gdGFibGVkZWY7XG4gIH1cblxuICBjb252ZXJ0Q29sdW1ucygpIHtcbiAgICBjb25zdCBtYXBfY29sdW1uID0gKGtleSwgY29sdW1uLCBpbmRleCkgPT4ge1xuICAgICAgaWYgKCFjb2x1bW4pIHJldHVybiB7XG4gICAgICAgIHNlbGVjdDogaW5kZXgsXG4gICAgICAgIG5hbWU6IGtleSxcblxuICAgICAgICBoaWRkZW46IHRydWVcbiAgICAgIH07XG4gICAgICBjb25zdCBjb2wgPSB7XG4gICAgICAgIHNlbGVjdDogaW5kZXgsXG4gICAgICAgIG5hbWU6IHRoaXMubGFiZWxGb3JtYXR0ZXIoa2V5LCBjb2x1bW4pLFxuICAgICAgfTtcbiAgICAgIGlmIChjb2x1bW4ubm90c29ydGFibGUpIGNvbC5zb3J0YWJsZSA9IGZhbHNlO1xuICAgICAgaWYgKCFjb2x1bW4ubm90c2VhcmNoYWJsZSkgY29sLnNlYXJjaGFibGUgPSB0cnVlO1xuICAgICAgaWYgKGNvbHVtbi5oaWRkZW4pIGNvbC5oaWRkZW4gPSBCb29sZWFuKGNvbHVtbi5oaWRkZW4pO1xuICAgICAgaWYgKGNvbHVtbi5zb3J0ICYmIGNvbHVtbi5zb3J0ID09PSBcImRlc2NcIikgY29sdW1uLnNvcnRTZXF1ZW5jZSA9IFtcImRlc2NcIiwgXCJhc2NcIl07XG4gICAgICBpZiAoWydudW1iZXInLCAnZGVjaW1hbCddLmZpbmQoZm9ybWF0ID0+IGZvcm1hdCA9PT0gY29sdW1uLmZvcm1hdCkpIGNvbC50eXBlID0gJ251bWJlcic7XG4gICAgICBsZXQgcmVuZGVyID0gbnVsbDtcbiAgICAgIHN3aXRjaCAoa2V5KSB7XG4gICAgICAgIGNhc2UgJ3NlbGVjdCc6XG4gICAgICAgICAgY29uc3Qgc2VsZWN0ID0gKGNvbHVtbi5zZWxlY3QgJiYgY29sdW1uLnNlbGVjdCA9PSBcImNvbnRyb2xzXCIpID8gXCJjb250cm9sc1wiIDogKChjb2x1bW4uc2VsZWN0Y2VsbHMpID8gXCJpbXBvcnRzXCIgOiBjb2x1bW4uc2VsZWN0KVxuICAgICAgICAgIGlmIChzZWxlY3QpIHtcbiAgICAgICAgICAgIHRoaXMuaW1wb3J0ZmllbGRzID0gKGNvbHVtbi5zZWxlY3RjZWxscykgPyBjb2x1bW4uc2VsZWN0Y2VsbHMgOiBudWxsO1xuICAgICAgICAgICAgY29sLnNvcnRhYmxlID0gZmFsc2U7XG4gICAgICAgICAgICBjb2wuc2VhcmNoYWJsZSA9IGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIHJldHVybiBjb2w7XG4gICAgfVxuICAgIHJldHVybiBPYmplY3QuZW50cmllcyh0aGlzLmNvbHVtbnMpLm1hcCgoW2tleSwgY29sdW1uXSwgaW5kZXgpID0+IG1hcF9jb2x1bW4oa2V5LCBjb2x1bW4sIGluZGV4KSk7XG5cbiAgfVxuICBpbml0RXZlbnRzKCkge1xuICAgIHRoaXMuZ3JpZC5vbignZGF0YXRhYmxlLnVwZGF0ZScsICgpID0+IHtcbiAgICAgIGlmICh0aGlzLmRvbS5jbGFzc0xpc3QuY29udGFpbnMoJ2hpZGUnKSkgdGhpcy5kb20uY2xhc3NMaXN0LnJlbW92ZSgnaGlkZScpO1xuXG4gICAgfSk7XG4gIH1cbiAgaW5pdFBsdWdpbnMoY29udGFpbmVyKSB7XG4gICAgaWYgKHRoaXMucGFyYW1zLmltcG9ydCAmJiB0aGlzLmluaXRJbXBvcnQpIHRoaXMuaW5pdEltcG9ydCgpO1xuICAgIGlmICh0aGlzLnBhcmFtcy5leHBhbmQpIHRoaXMubWFrZUV4cGFuZGFibGUoY29udGFpbmVyKTtcbiAgICBpZiAodGhpcy5wYXJhbXMuZXhwb3J0KSB0aGlzLm1ha2VFeHBvcnRhYmxlKGNvbnRhaW5lcik7XG4gICAgaWYgKHRoaXMucGFyYW1zLmRldGFpbHMgfHwgdGhpcy5ncmlkLmRvbS5xdWVyeVNlbGVjdG9yKHRhYmxlc2VsZWN0b3JzLmRldGFpbHMpKSB0aGlzLmluaXREZXRhaWxzKCk7XG4gICAgZWxzZSB0aGlzLmluaXRFdmVudHMoKTtcbiAgICBpZiAodGhpcy5wYXJhbXMub25zZWxlY3QpIHRoaXMuaW5pdFNlbGVjdChjb250YWluZXIpO1xuICAgIGlmICh0aGlzLmdyaWQuZG9tLnF1ZXJ5U2VsZWN0b3IodGFibGVzZWxlY3RvcnMudGlwKSkgdGhpcy5pbml0VGlwcygpO1xuICAgIGlmICh0aGlzLmdyaWQuZG9tLnF1ZXJ5U2VsZWN0b3JBbGwoJ3RoZWFkIFtkYXRhLWFsdHNvcnRdJykubGVuZ3RoKSB0aGlzLmluaXRBbHRlcm5hdGVTb3J0KHRoaXMuZ3JpZC5kb20ucXVlcnlTZWxlY3RvckFsbCgndGhlYWQgW2RhdGEtYWx0c29ydF0nKSk7XG4gICAgaWYgKHRoaXMucGFyYW1zLmZpbHRlcnMpIHtcbiAgICAgIGNvbnN0IHRvcCA9IHRoaXMuZ3JpZC53cmFwcGVyRE9NLnF1ZXJ5U2VsZWN0b3IodGFibGVzZWxlY3RvcnMuZGF0YXRhYmxlX3RvcCk7XG4gICAgICBpZiAodG9wICYmIHRvcC5jaGlsZHJlbi5sZW5ndGgpIHtcbiAgICAgICAgY29uc3QgZmlsdGVycyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGFibGVzZWxlY3RvcnMudGFibGVfZmlsdGVycyk7XG4gICAgICAgIC8vIGluc2VydCAgZmlsdGVycyBub2RlICBpbiBkYXRhdGFibGUgdG9wXG4gICAgICAgIGlmIChmaWx0ZXJzKSB0b3AucHJlcGVuZChmaWx0ZXJzKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgaW5pdFNlbGVjdChjb250YWluZXIpIHtcbiAgICBjb25zdCBpbnB1dHMgPSB0aGlzLmdyaWQuZG9tLnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0W25hbWVePVwiJyArIHRoaXMuaW5zdGFuY2VpZCArICdcIl0nKTtcbiAgICBpZiAoaW5wdXRzLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xuICAgIGNvbnN0IGlucHV0bmFtZSA9IGlucHV0c1swXS5uYW1lO1xuICAgIGxldCBzZWxlY3RhY3Rpb24gPSBjb250YWluZXIucXVlcnlTZWxlY3RvcignLicgKyB0YWJsZWNzcy5zZWxlY3RhY3Rpb24pO1xuICAgIGlmICghc2VsZWN0YWN0aW9uKSByZXR1cm47XG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmQoc2VsZWN0YWN0aW9uKTtcbiAgICBzZWxlY3RhY3Rpb24ucXVlcnlTZWxlY3RvcignYScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgIGxldCB2YWxzID0gW107XG4gICAgICBpbnB1dHMuZm9yRWFjaChpbnB1dCA9PiB7XG4gICAgICAgIGlmIChpbnB1dC5jaGVja2VkKSB2YWxzLnB1c2goaW5wdXQudmFsdWUpO1xuICAgICAgfSk7XG4gICAgICBlLmN1cnJlbnRUYXJnZXQuaHJlZiA9IHRoaXMucGFyYW1zLm9uc2VsZWN0ICsgZW5jb2RlVVJJKHZhbHMuam9pbignLCcpKTtcbiAgICB9KTtcbiAgICBjb25zdCBjbG9zZSA9IHNlbGVjdGFjdGlvbi5xdWVyeVNlbGVjdG9yKCdbZGF0YS1kaXNtaXNzXScpO1xuICAgIGlmIChjbG9zZSkgY2xvc2UuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcbiAgICAgIHBvcHVwX3NlbGVjdGVkKG51bGwsIG51bGwpO1xuICAgIH0pO1xuXG4gICAgY29uc3QgcG9wdXBfc2VsZWN0ZWQgPSAodG9wID0gbnVsbCwgbGVmdCA9IG51bGwsIGZvcmNlY2xvc2UgPSBmYWxzZSkgPT4ge1xuICAgICAgaWYgKHNlbGVjdGFjdGlvbi5kYXRhc2V0LmNsb3NlKSB7XG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kKHNlbGVjdGFjdGlvbik7XG4gICAgICAgIGNsb3NlLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpO1xuICAgICAgICBzZWxlY3RhY3Rpb24uY2xhc3NMaXN0LmFkZCh0YWJsZWNzcy5hYnNpbnB1dCk7XG4gICAgICB9XG4gICAgICBpZiAodG9wICE9PSBudWxsICYmIGxlZnQgIT09IG51bGwpIHtcbiAgICAgICAgc2VsZWN0YWN0aW9uLmNsYXNzTGlzdC5yZW1vdmUoY3NzLmhpZGUpO1xuICAgICAgICBzZWxlY3RhY3Rpb24uc3R5bGUudG9wID0gdG9wICsgJ3B4JztcbiAgICAgICAgc2VsZWN0YWN0aW9uLnN0eWxlLmxlZnQgPSBsZWZ0ICsgJ3B4JztcblxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGZvcmNlY2xvc2UgPT09IHRydWUpIHtcbiAgICAgICAgICBzZWxlY3RhY3Rpb24uY2xhc3NMaXN0LmFkZChjc3MuaGlkZSk7XG4gICAgICAgICAgZGVsZXRlIHNlbGVjdGFjdGlvbi5kYXRhc2V0LmNsb3NlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHNlbGVjdGFjdGlvbi5kYXRhc2V0LmNsb3NlID0gdHJ1ZTtcbiAgICAgICAgICBjbG9zZS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTtcbiAgICAgICAgICBjb25zdCB0b3B0YWJsZSA9IHRoaXMuZ3JpZC53cmFwcGVyRE9NLnF1ZXJ5U2VsZWN0b3IodGFibGVzZWxlY3RvcnMuZGF0YXRhYmxlX3RvcCkgPyB0aGlzLmdyaWQud3JhcHBlckRPTS5xdWVyeVNlbGVjdG9yKHRhYmxlc2VsZWN0b3JzLmRhdGF0YWJsZV90b3ApIDogdGhpcy5ncmlkLndyYXBwZXJET007XG4gICAgICAgICAgdG9wdGFibGUucHJlcGVuZChzZWxlY3RhY3Rpb24pO1xuICAgICAgICAgIHNlbGVjdGFjdGlvbi5jbGFzc0xpc3QucmVtb3ZlKHRhYmxlY3NzLmFic2lucHV0KTtcblxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGlucHV0cy5mb3JFYWNoKGlucHV0ID0+IHtcbiAgICAgIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIChlKSA9PiB7XG4gICAgICAgIGlmIChpbnB1dC5jaGVja2VkKSBwb3B1cF9zZWxlY3RlZChpbnB1dC5vZmZzZXRUb3AsIGlucHV0Lm9mZnNldExlZnQpO1xuICAgICAgICBlbHNlIHtcbiAgICAgICAgICBpZiAodGhpcy5ncmlkLmRvbS5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dFtuYW1lXj1cIicgKyB0aGlzLmluc3RhbmNlaWQgKyAnXCJdOmNoZWNrZWQnKS5sZW5ndGggPT09IDApIHBvcHVwX3NlbGVjdGVkKG51bGwsIG51bGwsIHRydWUpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuICBhc3luYyBpbml0RGV0YWlscygpIHsgLy8gVE9ETyA6IGdlbmVyaWNcbiAgICAvLyBhYm91dCAtIG9uZSBkaXYgdG8gZGlzcGxheSBjZWxsIGRldGFpbHMgbWFrZSBpdCBhcHBlYXIgYXMgdGFibGUgcm93IGV4cGFuZGluZ1xuICAgIGNvbnN0IHdyYXBwZXIgPSB0aGlzLmdyaWQud3JhcHBlckRPTTtcblxuICAgIGNvbnN0IGFib3V0ID0gd3JhcHBlci5xdWVyeVNlbGVjdG9yKCcjJyArIHRhYmxlY3NzLnRpcGlubGluZSkgPyB3cmFwcGVyLnF1ZXJ5U2VsZWN0b3IoJyMnICsgdGFibGVjc3MudGlwaW5saW5lKSA6IHRhYmxlY3NzLnRpcGlubGluZTtcbiAgICBpZiAoIWR5bmFtaWNzLkpzRGV0YWlsKSB7XG4gICAgICBjb25zdCB7XG4gICAgICAgIEpzRGV0YWlsXG4gICAgICB9ID0gYXdhaXRcbiAgICAgIGltcG9ydCgnLi4vbW9kdWxlcy9qcy1kZXRhaWwuanMnKTtcbiAgICAgIGR5bmFtaWNzLkpzRGV0YWlsID0gSnNEZXRhaWw7XG4gICAgfVxuICAgIGNvbnN0IGpzRGV0YWlsID0gbmV3IGR5bmFtaWNzLkpzRGV0YWlsKGFib3V0LCB3cmFwcGVyLCB7XG4gICAgICB3YWl0ZGl2OiB0aGlzLndhaXRkaXZcbiAgICB9KTsgLy8gc3BlY2lmaWMgdG8gYWJvdXQgZGV0YWlscyBpbiB0YWJsZVxuICAgIC8vIGhpZGUgLyBzaG93IGRpc2FibGUgZGV0YWlscyB6b25lXG4gICAgY29uc3QgY2FsbGJhY2tjbG9zZSA9IChlbCwgY2FsbGJhY2sgPSBudWxsKSA9PiB7XG4gICAgICBqc0RldGFpbC5hY3RpdmVEZXRhaWwoZmFsc2UpO1xuICAgICAgaWYgKGNhbGxiYWNrKSBjYWxsYmFjaygpO1xuICAgIH1cblxuICAgIGNvbnN0IGNhbGxiYWNrb3BlbiA9IChlbCwgY2FsbGJhY2sgPSBudWxsKSA9PiB7XG4gICAgICBqc0RldGFpbC5hY3RpdmVEZXRhaWwodHJ1ZSk7XG4gICAgICBpZiAoanNEZXRhaWwuY3VycmVudCAmJiBqc0RldGFpbC5jdXJyZW50ID09PSBlbCkge1xuICAgICAgICBqc0RldGFpbC5leHBhbmREZXRhaWwoZWwpO1xuICAgICAgICBpZiAoY2FsbGJhY2spIGNhbGxiYWNrKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoanNEZXRhaWwuY3VycmVudCkganNEZXRhaWwuY3VycmVudC5xdWVyeVNlbGVjdG9yKCdzdW1tYXJ5JykuY2xpY2soKTtcbiAgICAgICAgY29uc3QgdXJsID0gdGhpcy5wYXJhbXMuZGV0YWlsc3VybCArIGVsLmRhdGFzZXQuaWQgKyAnPycgK1xuICAgICAgICAgIG5ldyBVUkxTZWFyY2hQYXJhbXMoe1xuICAgICAgICAgICAgcGFydGlhbDogdHJ1ZVxuICAgICAgICAgIH0pO1xuICAgICAgICBqc0RldGFpbC5hY3RpdmVEZXRhaWwodHJ1ZSk7XG4gICAgICAgIC8vIGFwcGVuZCB0byBjZWxsIGRldGFpbHMgYW5kIGRpc3BsYXlcblxuICAgICAgICBmZXRjaCh1cmwsIGZldGNoU2V0dGluZ3MoKSkudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS50ZXh0KCkpLnRoZW4oaHRtbCA9PiB7XG4gICAgICAgICAganNEZXRhaWwuZXhwYW5kRGV0YWlsKGVsLCBodG1sKTtcbiAgICAgICAgICBpZiAoY2FsbGJhY2spIGNhbGxiYWNrKCk7XG4gICAgICAgIH0pLmNhdGNoKGVyciA9PiB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ3JlcXVlc3QnLCBlcnIpO1xuICAgICAgICB9KVxuICAgICAgfVxuXG4gICAgfVxuICAgIGlmICghZHluYW1pY3MuSnNBY2NvcmRpb24pIHtcbiAgICAgIGNvbnN0IHtcbiAgICAgICAgSnNBY2NvcmRpb25cbiAgICAgIH0gPSBhd2FpdCBpbXBvcnQoJy4uL21vZHVsZXMvanMtYWNjb3JkaW9uLmpzJyk7XG4gICAgICBkeW5hbWljcy5Kc0FjY29yZGlvbiA9IEpzQWNjb3JkaW9uO1xuICAgIH1cblxuICAgIGNvbnN0IHJlZnJlc2hfZGV0YWlscyA9ICgpID0+IHtcbiAgICAgIGlmICh0aGlzLmdyaWQuZG9tLmNsYXNzTGlzdC5jb250YWlucyhjc3MuaGlkZSkpIHRoaXMuZ3JpZC5kb20uY2xhc3NMaXN0LnJlbW92ZShjc3MuaGlkZSk7XG4gICAgICBjb25zdCBkZXRhaWxzID0gdGhpcy5ncmlkLmRvbS5xdWVyeVNlbGVjdG9yQWxsKHRhYmxlc2VsZWN0b3JzLmRldGFpbHMpO1xuICAgICAgaWYgKCFkZXRhaWxzKSByZXR1cm47XG4gICAgICBkZXRhaWxzLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgIGlmICghaXRlbS5kYXRhc2V0LmlkKSByZXR1cm47XG5cbiAgICAgICAgaXRlbSA9IG5ldyBkeW5hbWljcy5Kc0FjY29yZGlvbihpdGVtLCBjYWxsYmFja29wZW4sIGNhbGxiYWNrY2xvc2UsIGpzRGV0YWlsLmRldGFpbCk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyByZW1vdmUgZGV0YWlscyB3aGVuIHNvcnRpbmdcbiAgICB0aGlzLmdyaWQub24oJ2RhdGF0YWJsZS5zb3J0JywgZnVuY3Rpb24oY29sdW1uLCBkaXJlY3Rpb24pIHtcbiAgICAgIGpzRGV0YWlsLmFjdGl2ZURldGFpbChmYWxzZSk7XG4gICAgfSk7XG4gICAgbGV0IHRpbWVzZWFyY2ggPSBmYWxzZTtcbiAgICB0aGlzLmdyaWQub24oJ2RhdGF0YWJsZS5zZWFyY2gnLCAocXVlcnksIG1hdGNoZWQpID0+IHtcbiAgICAgIGlmICghdGhpcy5ncmlkLmRvbS5kYXRhc2V0Lmlzc2VhcmNoaW5nKSB7XG4gICAgICAgIGpzRGV0YWlsLmFjdGl2ZURldGFpbChmYWxzZSk7XG4gICAgICAgIHRoaXMuZ3JpZC5kb20uZGF0YXNldC5pc3NlYXJjaGluZyA9IHRydWVcbiAgICAgIH1cbiAgICAgIC8vIHRyb3VibGUgd2hlbiBtYXRjaCBpcyBlbXB0eSBhbmQgcmV0dXJuaW5nIHRvIGZ1bGwgdGFibGUgLSByZW1vdmUgaGlkZSAoIGluIHJlZnJlc2hfZGV0YWlscylcblxuICAgICAgLyogIGlmICh0aGlzLmdyaWQuZG9tLmNsYXNzTGlzdC5jb250YWlucygnZGF0YXRhYmxlLWVtcHR5JykgJiYgbWF0Y2hlZCA9PT0gW10pIHtcbiAgICAgICAgICB0aGlkLmdyaWQuZG9tLnF1ZXJ5U2VsZWN0b3IoJy5kYXRhdGFibGUtc2VhcmNoID4gaW5wdXQnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZSgpO1xuICAgICAgICAgICAgdGhpcy5ncmlkLndyYXBwZXJET00uY2xhc3NMaXN0LnJlbW92ZShcInNlYXJjaC1yZXN1bHRzXCIpO1xuICAgICAgICAgICAgdGhpcy5ncmlkLmRvbS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlJyk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfSwge1xuICAgICAgICAgICAgb25jZTogdHJ1ZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9Ki9cbiAgICB9KTtcbiAgICB0aGlzLmdyaWQub24oJ2RhdGF0YWJsZS51cGRhdGUnLCAoKSA9PiB7XG4gICAgICBpZiAodGltZXNlYXJjaCA9PT0gZmFsc2UpIHtcbiAgICAgICAgdGltZXNlYXJjaCA9IHRydWU7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgIHJlZnJlc2hfZGV0YWlscygpO1xuICAgICAgICAgIGRlbGV0ZSB0aGlzLmdyaWQuZG9tLmRhdGFzZXQuaXNzZWFyY2hpbmc7XG4gICAgICAgICAgdGltZXNlYXJjaCA9IGZhbHNlO1xuICAgICAgICB9LCAzMDApO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHJlZnJlc2hfZGV0YWlscygpO1xuICB9XG5cbiAgaW5pdEFsdGVybmF0ZVNvcnQoY29scykge1xuICAgIGNvbnN0IGNvbHVtbnMgPSB0aGlzLmdyaWQuZGF0YS5oZWFkaW5ncztcbiAgICBsZXQgY29sdG9zb3J0O1xuICAgIGNvbnN0IHNvcnRhbHRlcm5hdGUgPSAoY29sKSA9PiB7XG4gICAgICBsZXQgdG9kaXI7XG4gICAgICAvLyBrZWVwIHRoZSBzYW1lIGRpciBpZiBzb3J0IG9uIGNvbCBjaGFuZ2VzXG4gICAgICBpZiAoY29sLmRhdGFzZXQuc29ydGFjdGl2ZSA9PT0gU3RyaW5nKGNvbHRvc29ydCkpIHtcbiAgICAgICAgdG9kaXIgPSAoY29sLmNsYXNzTGlzdC5jb250YWlucyh0YWJsZWNzcy5hc2NlbmRpbmcpKSA/IHRhYmxlY3NzLmRlc2NlbmRpbmcgOiB0YWJsZWNzcy5hc2NlbmRpbmc7XG4gICAgICB9IGVsc2UgdG9kaXIgPSAoY29sLmNsYXNzTGlzdC5jb250YWlucyh0YWJsZWNzcy5kZXNjZW5kaW5nKSkgPyB0YWJsZWNzcy5kZXNjZW5kaW5nIDogdGFibGVjc3MuYXNjZW5kaW5nO1xuICAgICAgY29sdW1ucy5zb3J0KGNvbHRvc29ydCwgdG9kaXIpO1xuICAgICAgdGhpcy5ncmlkLm9uKCdkYXRhdGFibGUuc29ydCcsIChjb2x1bW4sIGRpcmVjdGlvbikgPT4ge1xuICAgICAgICBpZiAoY29sdG9zb3J0ICE9PSBjb2wuY2VsbEluZGV4KSB7XG4gICAgICAgICAgY29sLmNsYXNzTGlzdC5yZW1vdmUodGFibGVjc3MuYXNjZW5kaW5nKTtcbiAgICAgICAgICBjb2wuY2xhc3NMaXN0LnJlbW92ZSh0YWJsZWNzcy5kZXNjZW5kaW5nKTtcbiAgICAgICAgICB0aGlzLmdyaWQuaGVhZGluZ3NbY29sdG9zb3J0XS5jbGFzc0xpc3QucmVtb3ZlKGRpcmVjdGlvbik7XG4gICAgICAgICAgY29sLmNsYXNzTGlzdC5hZGQoZGlyZWN0aW9uKTtcbiAgICAgICAgfVxuICAgICAgICBjb2wuZGF0YXNldC5zb3J0YWN0aXZlID0gY29sdG9zb3J0O1xuICAgICAgfSk7XG5cbiAgICB9XG4gICAgY29scy5mb3JFYWNoKGNvbCA9PiB7XG4gICAgICBjb25zdCBhbHRzb3J0ID0gKGNvbC5kYXRhc2V0LmFsdHNvcnQpID8gY29sLmRhdGFzZXQuYWx0c29ydC5zcGxpdCgnLCcpIDogbnVsbDtcbiAgICAgIGlmICghYWx0c29ydCkgcmV0dXJuO1xuICAgICAgY29sLnF1ZXJ5U2VsZWN0b3IodGFibGVjc3MuZGF0YXRhYmxlX3NvcnRlcikuY2xhc3NMaXN0LmFkZCh0YWJsZWNzcy5kaXNhYmxlZCk7XG4gICAgICBjb25zdCBjb250cm9sID0gY29sLnF1ZXJ5U2VsZWN0b3IodGFibGVzZWxlY3RvcnMuc29ydG9uKTtcbiAgICAgIC8vIHByZXZlbnRzIGltYnJpY2F0ZWQgbGlua3NcbiAgICAgIGNvbC5hcHBlbmQoY29udHJvbCk7XG4gICAgICBjb25zdCB0cmlnZ2VycyA9IGNvbC5xdWVyeVNlbGVjdG9yQWxsKCdbcm9sZT1cImJ1dHRvblwiXScpO1xuICAgICAgY29sdG9zb3J0ID0gY29sLmNlbGxJbmRleDtcbiAgICAgIGNvbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgIHNvcnRhbHRlcm5hdGUoY29sKTtcbiAgICAgIH0sIGZhbHNlKTtcbiAgICAgIGNvbnN0IGNoYW5nZWNvbHRvc29ydCA9IChjb2wsIGluZGV4KSA9PiB7XG4gICAgICAgIGlmIChpbmRleCA9PT0gMCkgY29sdG9zb3J0ID0gY29sLmNlbGxJbmRleDtcbiAgICAgICAgZWxzZSBjb2x0b3NvcnQgPSB0aGlzLmdyaWQuaGVhZGluZ3MuZmluZEluZGV4KGhlYWRpbmcgPT4gKGhlYWRpbmcuZGF0YXNldC5uYW1lID09PSBhbHRzb3J0W2luZGV4IC0gMV0pKTtcbiAgICAgIH1cbiAgICAgIGNvbC5kYXRhc2V0LnNvcnRhY3RpdmUgPSBjb2wuY2VsbEluZGV4O1xuICAgICAgdHJpZ2dlcnMuZm9yRWFjaCgodHJpZ2dlciwgaW5kZXgpID0+IHtcbiAgICAgICAgdHJpZ2dlci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIGNvbnN0IGFjdGl2ZSA9IGUuY3VycmVudFRhcmdldC5wYXJlbnRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hY3RpdmUnKTtcbiAgICAgICAgICBpZiAoYWN0aXZlKSBhY3RpdmUuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XG4gICAgICAgICAgZS5jdXJyZW50VGFyZ2V0LmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xuICAgICAgICAgIGNoYW5nZWNvbHRvc29ydChjb2wsIGluZGV4KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIGlmIChjb2wuZGF0YXNldC50aXApIHtcblxuICAgICAgICBPYmplY3QudmFsdWVzKHRoaXMuZ3JpZC5kb20ucm93cykuZm9yRWFjaCgocm93LCBpbmRleCkgPT4ge1xuICAgICAgICAgIGlmIChpbmRleCA9PT0gMCkgcmV0dXJuO1xuICAgICAgICAgIGNvbnN0IGNvbHRpcCA9IHRoaXMuZ3JpZC5oZWFkaW5ncy5maW5kSW5kZXgoaGVhZGluZyA9PiAoaGVhZGluZy5kYXRhc2V0Lm5hbWUgPT09IGFsdHNvcnRbcGFyc2VJbnQoY29sLmRhdGFzZXQudGlwKSAtIDFdKSk7XG4gICAgICAgICAgaWYgKGNvbHRpcCA9PT0gY29sLmNlbGxJbmRleCkgcmV0dXJuO1xuXG4gICAgICAgICAgcm93LmNlbGxzW2NvbC5jZWxsSW5kZXhdLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZW50ZXInLCAoZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgdGlwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICB0aXAuc2V0QXR0cmlidXRlKCdjbGFzcycsIHRhYmxlY3NzLnRpcG92ZXIpO1xuICAgICAgICAgICAgdGlwLmlubmVySFRNTCA9IHJvdy5jZWxsc1tjb2x0aXBdLmlubmVySFRNTDtcbiAgICAgICAgICAgIGUuY3VycmVudFRhcmdldC5hcHBlbmQodGlwKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByb3cuY2VsbHNbY29sLmNlbGxJbmRleF0uYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdXQnLCAoZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgdGlwID0gZS5jdXJyZW50VGFyZ2V0LnF1ZXJ5U2VsZWN0b3IodGFibGVzZWxlY3RvcnMudGlwb3Zlcik7XG4gICAgICAgICAgICBpZiAodGlwKSB0aXAucmVtb3ZlKCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuXG4gIH1cblxuXG4gIGNsb3NlU2hvd2Z1bGwoKSB7XG4gICAgY29uc3Qgc2hvd2Z1bGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuJyArIGNzcy5jb21wb25lbnQudGFibGUudGlwICsgJy4nICsgdGFibGVjc3Muc2hvd2Z1bGwpO1xuICAgIGlmIChzaG93ZnVsbCkgc2hvd2Z1bGwuY2xpY2soKTtcbiAgfVxuICBtYWtlRXhwYW5kYWJsZShjb250YWluZXIpIHtcbiAgICBpZiAoY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJ3RhYmxlJykub2Zmc2V0SGVpZ2h0IDwgY29udGFpbmVyLm9mZnNldEhlaWdodCArIGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCd0YWJsZSB0Ym9keSB0cicpLm9mZnNldEhlaWdodCkgcmV0dXJuO1xuICAgIGNvbnN0IGJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGJ0bi5jbGFzc0xpc3QuYWRkKCdidXR0b24tZXhwYW5kJyk7XG4gICAgYnRuLmNsYXNzTGlzdC5hZGQoJ2JvcmRlci10Jyk7XG4gICAgYnRuLnRpdGxlID0gdGhpcy5wYXJhbXMuZXhwYW5kO1xuICAgIGJ0bi5pbm5lckhUTUwgPSBgPHNwYW4gY2xhc3M9XCJzbWFsbC1jYXBzIGJsb2NrIG14LWF1dG8gcC0wXCI+JHt0aGlzLnBhcmFtcy5leHBhbmR9PC9zcGFuPjxpIGNsYXNzPVwiY2xlYXItYm90aCBwLTAgbXgtYXV0byBpY29uIGljb24tY2hldnJvbi1kb3duIGhvdmVyOmZpbGwtc2Vjb25kYmx1ZS01MDBcIj48L2k+PHNwYW4gY2xhc3M9XCJzbWFsbC1jYXBzIGJsb2NrIG14LWF1dG8gcC0wIGhpZGRlblwiPiR7XG4gICAgICAgICAgICAgICAgICB0aGlzLnBhcmFtcy5zaHJpbmt9PC9zcGFuPmA7XG4gICAgY29udGFpbmVyLnBhcmVudEVsZW1lbnQuaW5zZXJ0QmVmb3JlKGJ0biwgY29udGFpbmVyLm5leHRFbGVtZW50U2libGluZyk7XG4gICAgY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ292ZXJmbG93LXktaGlkZGVuJyk7XG4gICAgY29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoJ21heC10YWJzdGF0LWgnKTtcbiAgICBjb250YWluZXIucGFyZW50RWxlbWVudC5zdHlsZS5oZWlnaHQgPSAnYXV0byc7XG4gICAgY29uc3QgaCA9IHBhcnNlSW50KHRoaXMuZ3JpZC53cmFwcGVyRE9NLnF1ZXJ5U2VsZWN0b3IoJ3Rib2R5IHRyJykub2Zmc2V0SGVpZ2h0KSAqICgodGhpcy5wYXJhbXMubWF4cm93cykgPyB0aGlzLnBhcmFtcy5tYXhyb3dzIDogMjApO1xuICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdtYXgtaC1bJyArIGggKyAncHhdJyk7XG4gICAgY29udGFpbmVyLnN0eWxlLmhlaWdodCA9IGggKyAncHgnO1xuICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICB0aGlzLmNsb3NlU2hvd2Z1bGwoKTtcbiAgICAgIGJ0bi5jbGFzc0xpc3QudG9nZ2xlKCdib3JkZXItdCcpO1xuICAgICAgYnRuLmNsYXNzTGlzdC50b2dnbGUoJ2JvcmRlci1iJyk7XG4gICAgICBjb25zdCBpY28gPSBidG4ucXVlcnlTZWxlY3RvcignaScpO1xuICAgICAgaWNvLmNsYXNzTGlzdC50b2dnbGUoJ2ljb24tY2hldnJvbi1kb3duJyk7XG4gICAgICBpY28uY2xhc3NMaXN0LnRvZ2dsZSgnaWNvbi1jaGV2cm9uLXVwJyk7XG4gICAgICBjb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgnb3ZlcmZsb3cteS1oaWRkZW4nKTtcbiAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdtYXgtaC1bJyArIGggKyAncHhdJyk7XG4gICAgICBidG4ucXVlcnlTZWxlY3RvckFsbCgnc3BhbicpLmZvckVhY2goc3BhbiA9PiB7XG4gICAgICAgIHNwYW4uY2xhc3NMaXN0LnRvZ2dsZSgnaGlkZGVuJyk7XG4gICAgICB9KTtcbiAgICAgIGlmIChjb250YWluZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdvdmVyZmxvdy15LWhpZGRlbicpKSBjb250YWluZXIuc3R5bGUuaGVpZ2h0ID0gaCArICdweCc7XG4gICAgICBlbHNlIGNvbnRhaW5lci5zdHlsZS5oZWlnaHQgPSAnYXV0byc7XG4gICAgfSk7XG4gIH1cbiAgbWFrZUV4cG9ydGFibGUoY29udGFpbmVyKSB7XG4gICAgY29uc3QgYnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgYnRuLmNsYXNzTGlzdC5hZGQoJ2J1dHRvbi1leHBvcnQnKTtcbiAgICBidG4uY2xhc3NMaXN0LmFkZCgnaXMtcGljaycpO1xuICAgIGJ0bi5pbm5lckhUTUwgPSBgPGkgY2xhc3M9XCJpY29uIGljb24tYXJyb3ctZG93bi1vbi1zcXVhcmVcIj48L2k+PHNwYW4+JHsoKHRoaXMucGFyYW1zLmV4cG9ydGxhYmVsKSA/IHRoaXMucGFyYW1zLmV4cG9ydGxhYmVsIDogJ2V4cG9ydCB0byAnICsgdGhpcy5wYXJhbXMuZXhwb3J0KX08L3NwYW4+YDtcbiAgICBjb250YWluZXIucHJlcGVuZChidG4pO1xuICAgIGNvbnN0IGNvbHVtbnMgPSB0aGlzLmdyaWQuY29sdW1ucztcbiAgICBsZXQgZXhjbHVkZV9jb2x1bW5zID0gW107XG4gICAgT2JqZWN0LmtleXModGhpcy5jb2x1bW5zKS5mb3JFYWNoKChuYW1lLCBpbmRleCkgPT4ge1xuICAgICAgaWYgKG5hbWUgPT09ICdzZWxlY3QnKSBleGNsdWRlX2NvbHVtbnMucHVzaChpbmRleCk7XG4gICAgfSk7XG4gICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKGUpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGlmIChleGNsdWRlX2NvbHVtbnMubGVuZ3RoKSBjb2x1bW5zLmhpZGUoZXhjbHVkZV9jb2x1bW5zKTtcbiAgICAgIGlmICghdGhpcy5keW5hbWljcykgdGhpcy5keW5hbWljcyA9IHt9O1xuICAgICAgaWYgKCF0aGlzLmR5bmFtaWNzLmV4cG9ydENTVikge1xuICAgICAgICBjb25zdCB7XG4gICAgICAgICAgZXhwb3J0Q1NWIC8vIG9yIGV4cG9ydEpTT04sIGV4cG9ydFNRTFxuICAgICAgICB9ID0gYXdhaXRcbiAgICAgICAgaW1wb3J0KFwic2ltcGxlLWRhdGF0YWJsZXNcIik7XG5cbiAgICAgICAgdGhpcy5keW5hbWljcy5leHBvcnRDU1YgPSBleHBvcnRDU1Y7XG4gICAgICB9XG4gICAgICBsZXQgc3RyID0gdGhpcy5keW5hbWljcy5leHBvcnRDU1YodGhpcy5ncmlkLCB7XG4gICAgICAgIGRvd25sb2FkOiBmYWxzZSxcbiAgICAgICAgbGluZURlbGltaXRlcjogXCJcXG5cIixcbiAgICAgICAgY29sdW1uRGVsaW1pdGVyOiBcIlxcdFwiLFxuICAgICAgfSk7XG4gICAgICBzdHIgPSBlbmNvZGVVUkkoYGRhdGE6dGV4dC90c3Y7Y2hhcnNldD11dGYtOCwke3N0cn1gKTtcblxuICAgICAgZG93bmxvYWRfdXJsKHN0ciwgKChjb250YWluZXIuaWQpID8gY29udGFpbmVyLmlkIDogJ3N0YXRzX3Byb2onKSArICcudHN2Jyk7XG4gICAgICBpZiAoZXhjbHVkZV9jb2x1bW5zLmxlbmd0aCkgY29sdW1ucy5zaG93KGV4Y2x1ZGVfY29sdW1ucyk7XG4gICAgfSk7XG4gIH1cbiAgaW5pdFRpcHMoKSB7XG4gICAgLy8gc2hvdyBiaWcgY2VsbCBjb250ZW50XG4gICAgbGV0IGN1cnJlbnQgPSBudWxsO1xuICAgIHRoaXMuZ3JpZC5kb20ucXVlcnlTZWxlY3RvckFsbCh0YWJsZXNlbGVjdG9ycy50aXApLmZvckVhY2godGlwID0+IHtcbiAgICAgIHRpcC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWVudGVyJywgKGUpID0+IHtcbiAgICAgICAgaWYgKHRpcC5jbGFzc0xpc3QuY29udGFpbnModGFibGVjc3Muc2hvd2Z1bGwpIHx8ICh0aXAuc2Nyb2xsSGVpZ2h0ID4gdGlwLm9mZnNldEhlaWdodCkpIHtcbiAgICAgICAgICB0aXAuc3R5bGUuY3Vyc29yID0gJ3BvaW50ZXInO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHRpcC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgIGNvbnN0IHN0eWxlcGFyZW50ID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUodGlwLnBhcmVudEVsZW1lbnQpO1xuICAgICAgICBjb25zdCBzdHlsZSA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHRpcC5wYXJlbnRFbGVtZW50KTtcbiAgICAgICAgaWYgKHRpcC5jbGFzc0xpc3QuY29udGFpbnModGFibGVjc3Muc2hvd2Z1bGwpKSB7XG4gICAgICAgICAgdGlwLmNsYXNzTGlzdC5yZW1vdmUodGFibGVjc3Muc2hvd2Z1bGwpO1xuICAgICAgICAgIHRpcC5wYXJlbnRFbGVtZW50LnN0eWxlLm1pbkhlaWdodCA9ICdub25lJztcbiAgICAgICAgICB0aXAucGFyZW50RWxlbWVudC5zdHlsZS5oZWlnaHQgPSAnYXV0byc7XG4gICAgICAgICAgdGlwLnN0eWxlLm1heFdpZHRoID0gdGlwLmRhdGFzZXQudyArICdweCc7XG4gICAgICAgICAgdGlwLnN0eWxlLnBhZGRpbmcgPSB0aXAuZGF0YXNldC5wICsgJ3B4JztcbiAgICAgICAgICBjdXJyZW50ID0gbnVsbDtcbiAgICAgICAgfSBlbHNlIGlmICh0aXAuc2Nyb2xsSGVpZ2h0ID4gdGlwLm9mZnNldEhlaWdodCkge1xuICAgICAgICAgIGlmIChjdXJyZW50KSBjdXJyZW50LmNsYXNzTGlzdC5yZW1vdmUodGFibGVjc3Muc2hvd2Z1bGwpO1xuICAgICAgICAgIGNvbnN0IGggPSBwYXJzZUludCh0aXAuY2xpZW50SGVpZ2h0KTtcbiAgICAgICAgICB0aXAucGFyZW50RWxlbWVudC5zdHlsZS5taW5IZWlnaHQgPSB0aXAucGFyZW50RWxlbWVudC5zdHlsZS5oZWlnaHQgPSAoKChoIDwgcGFyc2VJbnQoc3R5bGVwYXJlbnQubWF4SGVpZ2h0KSkgPyBoIDogcGFyc2VJbnQoc3R5bGVwYXJlbnQubWF4SGVpZ2h0KSkgLSAyICogcGFyc2VJbnQoc3R5bGVwYXJlbnQucGFkZGluZykpICsgJ3B4JztcbiAgICAgICAgICBpZiAoIXRpcC5kYXRhc2V0LncpIHRpcC5kYXRhc2V0LncgPSBwYXJzZUludCh0aXAuY2xpZW50V2lkdGgpO1xuICAgICAgICAgIGlmICghdGlwLmRhdGFzZXQucCkgdGlwLmRhdGFzZXQucCA9IHBhcnNlSW50KHN0eWxlLnBhZGRpbmcpO1xuICAgICAgICAgIHRpcC5zdHlsZS5tYXhXaWR0aCA9IHBhcnNlSW50KHRpcC5jbGllbnRXaWR0aCkgKyAncHgnO1xuICAgICAgICAgIHRpcC5jbGFzc0xpc3QuYWRkKHRhYmxlY3NzLnNob3dmdWxsKTtcbiAgICAgICAgICB0aXAuc3R5bGUudG9wID0gKHBhcnNlSW50KHRpcC5vZmZzZXRUb3ApIC0gcGFyc2VJbnQoc3R5bGVwYXJlbnQucGFkZGluZykpICsgJ3B4JztcbiAgICAgICAgICBjdXJyZW50ID0gdGlwO1xuXG4gICAgICAgIH1cblxuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cbn0iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/modules/table-component.js\n")},"?4f7e":()=>{}}]);