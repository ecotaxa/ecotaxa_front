{% extends "layout.html" %}


{% block body %}
  <h3>PREDICTION: Choice of Learning Set data source</h3>
  {{ filters_info|safe }}

  <div class="row">
    <div class="col-md-offset-1 col-md-4">
      <button class='btn btn-primary' onclick='SubmitProjectSelection();'>Next: Choose objects in selected
        projects
      </button>
    </div>

    <div class="panel panel-default col-md-6">
      <p>A Learning Set AKA <a
          href="https://en.wikipedia.org/wiki/Training,_validation,_and_test_sets#Training_data_set">Training
        Data Set</a> is built using validated data from one or several projects.<br>
        Inside these projects, you will be able, in next pages, to specify: <br>
        &nbsp;&nbsp;&nbsp;&nbsp;- Which categories you're interested in predicting.<br>
        &nbsp;&nbsp;&nbsp;&nbsp;- How many objects you want to use as reference for the prediction.<br>
        &nbsp;&nbsp;&nbsp;&nbsp;- For these objects, which features are relevant to the prediction.<br>
        This Learning set will then be used for running the prediction task.
        &nbsp;<span data-toggle="tooltip"
                    data-placement="right" data-html="true"
                    title="
<p style='text-align: left'>You can run the Subset tool to :<br><ul style='text-align: left'>
<li>Create a Learning set that you will later improve
<li>Check validation of a project using a randomly limited number of objects from the project</ul></p>"
                    class="glyphicon glyphicon-question-sign"></span>
      </p>
    </div>
  </div>
  <div class="row">
    <div class="panel panel-default col-md-offset-4" style='display: inline-block; margin-bottom: 8px'>
      <div class="panel-body" style="padding: 5px;">
        <form method="post" id="search">
          <input type="hidden" value="" name="srcs" id="search_srcs">
          Filter on title :
          <input style="width: 100px;" name="filt_title" id="filt_title"
                 value="{{ request.form.get('filt_title','') }}" type="text">
          # Matching features &ge;
          <input style="width: 30px;" name="filt_featurenbr" id="filt_featurenbr"
                 value="{{ request.form.get('filt_featurenbr','10') }}" type="text">
          Instrument :
          <input style="width: 100px;" name="filt_instrum" id="filt_instrum"
                 value="{{ request.form.get('filt_instrum','') }}" type="text">
          <span class="glyphicon glyphicon-question-sign" onclick="DispInstrumList();"
                style="cursor: pointer;"></span>
          <button type="button" onclick='FilterWithProjectSelection();' class="btn btn-primary">Filter
          </button>
        </form>
      </div>
    </div>
  </div>
  <table style='margin-left: 10px;width: 95%'>
    <tr>
      <td>
      </td>
    </tr>
  </table>
  <table class='table table-bordered table-verycondensed table-hover' style='margin-left: 10px;width: 95%'>
    <tr>
      <th style='width:20px'></th>
      <th># - Title</th>
      <th style='width:100px'># Validated</th>
      <th style='width:100px'># Matching features</th>
      <th style='width:100px'>CNN Network</th>
    </tr>
    {{ TblBody|safe }}
  </table>
  <script>
      $(function () {
          $('[data-toggle="tooltip"]').tooltip()
      })

      function SubmitProjectSelection() {
          var srclst = $(".selproj:checked").map(function () {
              return $(this).data('prjid');
          }).get().join(',');
          PostDynForm("?{{ url|safe }}", {src: srclst});
      }

      function FilterWithProjectSelection() {
          var srclst = $(".selproj:checked").map(function () {
              return $(this).data('prjid');
          }).get().join(',');
          $('#search_srcs').prop("value", srclst);
          $('#search').submit();
      }

      function DispInstrumList(projid) {
          $("#PopupDetails .modal-content").html("Loading...");
          $('#PopupDetails .modal-lg').css('width', $(window).width() / 2);
          $('#PopupDetails').modal({});
          var url = "/search/instrumlist"
          if (typeof (projid) != "undefined")
              url += "?projid=" + projid
          $("#PopupDetails .modal-content").load(url);
      }

  </script>
  <div id="PopupDetails" class="modal " tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        ...
      </div>
    </div>
  </div>
{% endblock %}